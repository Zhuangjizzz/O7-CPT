# Chapter4 Building Blocks for Analog Integrated Circuits

Chapter Outline
4.1 Design Considerations in Monolithic Circuits ..... 334
4.2 BJT Characteristics and Models Revisited ..... 342
4.3 MOSFET Characteristics and Models Revisited ..... 357
4.4 Darlington, Cascode, and Cascade Configurations ..... 371
4.5 Differential Pairs ..... 386
4.6 Common-Mode Rejection Ratio in Differential Pairs ..... 396
4.7 Input Offset Voltage/Current in Differential Pairs ..... 404
4.8 Current Mirrors ..... 409
4.9 Differential Pairs with Active Loads ..... 421
4.10 Bipolar Output Stages ..... 432
4.11 CMOS Output Stages ..... 440
Appendix 4A: Editing SPICE Netlists ..... 445
References ..... 446
Problems ..... 446

As mentioned in Chapter 2, following its invention in 1947, the bipolar junction transistor (BJT) was first put to use as a replacement for the much bulkier, power hungry and far less reliable vacuum tube. In fact, the first transistor circuits were virtual replicas of vacuum-tube circuit prototypes, if with suitable scaling of the power supplies and surrounding components. Broadly speaking, they belong to the class of circuits that we have investigated so far and that are generally referred to as discrete circuits.

Toward the end of the 1950s it was realized that the dramatic miniaturization and reduction in power consumption brought about by the transistor could be exploited further by fabricating entire circuits (transistors, diodes, resistors, and small capacitors, along with their interconnections) in monolithic form, that is, on the same piece of semiconductor material, or chip. Also called an integrated circuit (IC), it was first implemented in 1958 by Jack Kilby at Texas Instruments, and, independently, in 1959
by Robert Noyce at Fairchild Semiconductor. The 1960s saw a feverish activity that resulted in the development of the first monolithic operational amplifier by Fairchild Semiconductor (mA Series) along with the digital IC families known as transistortransistor logic (TTL) by Texas Instruments (7400 Series) and emitter-coupled logic (ECL) by Motorola (10K Series).

Meanwhile, in the early 1960s the field-effect transistor of the metal-oxidesemiconductor type (MOSFET) became a commercial reality. Compared to the BJT, the MOSFET offered the advantages of smaller size and lower power consumption. This alternative technology led to the development of the first battery-powered electronic calculators and wristwatches, as well as a low-power alternative to the prevailing TTL bipolar logic family, namely, the CMOS digital family of the 4000 Series, by RCA. These products were followed by the first microprocessor, by Intel, in 1971. Since then, IC electronics has progressed exponentially and has penetrated virtually every aspect of modern life. This impressive growth has been governed by Moore's law, roughly stating that thanks to continued advances in IC fabrication, the number of devices that can be integrated on a given chip area doubles every approximately 18 months. Originally formulated in 1965, this law still holds to this day, though it has been pointed out that technology is bound to approach physical limits that will eventually lead to the demise of this law.

The BJT, after having been the dominant semiconductor device for nearly three decades, has been overtaken by the MOSFET, especially in high-density ICs, owing to the MOSFET's aforementioned advantages of smaller size and lower power consumption. Nonetheless, the BJT continues to be the device of choice in highperformance general-purpose analog ICs. It is also preferred in specialized discrete designs, thanks to the availability of a wide selection of devices. It is also possible to fabricate BJTs and MOSFETs simultaneously on the same chip, if at an increase in the number of fabrication steps and cost. The resulting technology, aptly known as BiCMOS technology, exploits the advantages of both transistor types to provide even more innovative design solutions. Contemporary ICs tend to combine digital as well as analog functions on the same chip, this being the reason for the name mixed-signal or also mixed-mode ICs. As a rule, one would try to implement as many functions as possible in digital form, and use analog circuitry only when interfacing to the external physical world, which is analog by nature.

CHAPTER HIGHLIGHTS

The chapter begins with a comparison between discreet and monolithic design. This is followed by a review of BJT and FET characteristics emphasizing second-order effects that were deliberately omitted in the earlier introductory chapters, but that are relevant to monolithic circuit realizations. Also reviewed are the basic single-transistor configurations of Chapters 2 and 3, but from a monolithic perspective, where the functions of dc biasing and output loading are no longer provided by resistors, but by other transistors operating as current sources or sinks.

Next, the chapter investigates a variety of multiple-transistor circuit configurations that have become standard building blocks for analog ICs. These include the Darlington and cascode configurations, differential pairs, current mirrors, dc current
sources and sinks, active-loaded gain stages, and push-pull output stages. Particular attention is devoted to the differential pair because it forms the core of most analog ICs. First, we investigate the pair for the idealized case of perfectly matched components, then we examine the effect of fabrication mismatches upon input offset errors and the common-mode rejection ratio. Whenever possible, BJT and FET realizations are covered in parallel both to void duplications and to compare the two technologies in their similarities and differences.

This chapter exposes the student to a variety of clever design solutions that contribute to making analog electronics a most fascinating discipline. But the best is yet to come, in the next chapter, when these building blocks will be combined together in the design of some representative analog ICs.

It is reassuring to know that no matter how sophisticated a given circuit, the tools we use to comprehend it are still those mastered in a basic electric circuits course, namely, Ohm's law, Kirchhoff's laws (KVL and KCL), Th√©venin's/Norton's reductions, and the test-signal technique to find terminal resistances in the presence of dependent sources.

The chapter makes abundant use of PSpice both as a software oscilloscope to display transfer curves and waveforms, and as a verification tool for dc and ac hand calculations.

## 4.1 DESIGN CONSIDERATIONS IN MONOLITHIC CIRCUITS

The widespread usage of monolithic circuits, also called integrated circuits (ICs), stems from our ability to fabricate large numbers of interconnected devices on the same semiconductor chip while keeping power consumption suitably low. Compared to their discrete predecessors, ICs present unique constraints as well as advantages for the designer. The most relevant ones are as follows:

- Capacitors are highly undesirable in IC technology as they tend to take up inordinate amounts of chip area. While small capacitors (on the order of a few picofarads or less) are still acceptable, large-valued ones such as those used for ac coupling and ac bypassing in the discrete CE and CS amplifier examples of Chapters 2 and 3 must definitely be ruled out. Consequently, inter-stage coupling must be of the dc type, and suitable techniques must be devised to avoid ac bypass capacitors. All considered, these constraints turn out to be a blessing because once they are met, a monolithic circuit will function all the way down to dc. By contrast, the discrete designs of Chapters 2 and 3 will function properly only above a certain frequency, as at low frequencies capacitors will start acting as open circuits, no longer providing the intended functions of coupling and bypass.
- Resistors too tend to take up precious chip area, though not as severely as capacitors, so they too must be avoided whenever possible. When implemented with the same materials that are utilized to form the regions of a transistor, monolithic resistances also suffer from gross tolerances and can be quite sensitive to temperature. On the other hand, transistors are the most natural devices in IC technology, both in terms of size and ease of fabrication, so in monolithic implementations, resistive functions such as dc biasing must be rephrased in terms of transistors.
- Devices fabricated simultaneously on the same chip tend to exhibit highly matched characteristics. True, these characteristics are sensitive to temperature and also drift with time, but if two or more devices are fabricated in close proximity to each other so that they share the same environment, their characteristics will track over a range of environmental variations. Matching and tracking are exploited on purpose in IC design to implement clever functions that would be far more difficult to achieve in discrete form. Two popular examples are current mirrors and differential pairs, to be investigated in great detail as we proceed.

### An Illustrative Example

To illustrate similarities as well as differences between discrete and monolithic design, let us reconsider the familiar CE configuration of Fig. 4.1, which in the days of discrete designs preceding ICs was the workhorse of voltage amplification. As long as each capacitor acts as an ac short compared to the equivalent resistance presented by the surrounding circuitry, the small-signal gain takes on the form

$$
\begin{equation*}
a=\frac{v_{o}}{v_{i}}=-g_{m}\left(r_{o} / / R_{C}\right) \tag{4.1a}
\end{equation*}
$$

To convert this design to a form suited to monolithic fabrication we need to get rid of the capacitors and replace the resistors with suitably biased transistors whenever possible. Following are the relevant steps:

- The function of $C_{1}$ in Fig. 4.1 is to resolve the dc difference between the input source (typically with a dc component of 0 V ) and the base (typically biased at $1 / 3 V_{C C}$ ) while providing an ac short between source and base ( $\left.v_{b} \rightarrow v_{i}\right)$. The best way to get rid of $C_{1}$ is to couple the input source to the base directly, as in Fig. 4.2a. Dc coupling also eliminates the need for the biasing resistors $R_{1}$ and $R_{2}$.
- The function of $R_{E}$ in Fig. 4.1 is to establish the bias current $I_{E}$, whereas that of $C_{2}$ is to ensure an ac ground at the emitter $\left(v_{e} \rightarrow 0\right)$. Both functions can be met, at least in principle, by biasing the emitter negatively via a suitable voltage source $V_{B E 1}=V_{T} \ln \left(I_{C 1} / I_{s 1}\right)$, as also shown in Fig. 4.2a.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-035.jpg?height=541&width=619&top_left_y=1542&top_left_x=200)

FIGURE 4.1 A discrete voltage amplifier.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-036.jpg?height=625&width=701&top_left_y=216&top_left_x=462)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-036.jpg?height=468&width=372&top_left_y=374&top_left_x=1228)

GND
(b)

FIGURE 4.2 (a) Conceptual circuit showing how to turn the discrete amplifier of Fig. 4.1 into a form suitable to monolithic fabrication. (b) Ac equivalent of the circuit of (a).

- The function of $R_{C}$ in Fig. 4.1 is to bias the collector, typically at $V_{O} \cong 2 / 3 V_{C C}$, while also setting the gain, as per Eq. $4.1 a$. The best way to get rid of $R_{C}$ is to replace it with a pnp BJT operating as a current source, as also shown in Fig. 4.2a. Once this is done, the ac equivalent becomes as in Fig. 4.2b, where $r_{o p}$ is the ac resistance seen looking into $Q_{4}$ 's collector, now playing the role of $R_{C}$ in the expression for the gain. Consequently, Eq. (4.1a) becomes

$$
\begin{equation*}
a=\frac{v_{o}}{v_{i}}=-g_{m n}\left(r_{o n} / / r_{o p}\right) \tag{4.1b}
\end{equation*}
$$

where we are using subscripts $n$ and $p$ to distinguish between the parameters of the $n p n$ and $p n p$ BJTs. Given that $R_{C}$ (a passive element) has been replaced by a transistor (an active element), $Q_{4}$ is aptly referred to as an active load.

We observe that for Eq. (4.1b) to hold, both BJTs must operate in the forwardactive region or at most at the edge of saturation (EOS). $Q_{1}$ will be in the active region so long as $v_{O} \geq v_{O(\text { min })}$, where $v_{O(\text { min })}=V_{E 1}+V_{C E 1(\mathrm{EOS})}$. But, $V_{E 1}=-V_{B E 1}$, so

$$
\begin{equation*}
v_{O(\min )}=V_{C E 1(\mathrm{EOS})}-V_{B E 1} \tag{4.2a}
\end{equation*}
$$

Similarly, $Q_{4}$ will be in the active region so long as $v_{O} \leq v_{O(\max )}$, where

$$
\begin{equation*}
v_{O(\max )}=V_{C C}-V_{E C 4(\mathrm{EOS})} \tag{4.2b}
\end{equation*}
$$

The voltages $v_{O(\min )}$ and $v_{O(\max )}$ define the lower and upper limits of the linear output voltage range, commonly known as the output voltage swing (OVS). It is apparent that Eq. (4.1b) will hold only so long as we confine $v_{o}$ within this range, that is, for $v_{O(\min )} \leq v_{O} \leq v_{O(\text { max })}$.
(a) In the circuit of Fig. $4.2 a$ let $Q_{1}$ have $I_{s}=10 \mathrm{fA}, V_{A}=100 \mathrm{~V}$, and $V_{C E(\operatorname{EOS})}=$

### EXAMPLE 4.1

0.2 V , and let $Q_{4}$ have $I_{s}=5 \mathrm{fA}, V_{A}=75 \mathrm{~V}$, and $V_{E C(\mathrm{EOS})}=0.2 \mathrm{~V}$. If $V_{C C}=10 \mathrm{~V}$, specify suitable values for $V_{B E}$ and $V_{E B}$ so that with $v_{I}=0$ the BJTs draw 1 mA and $V_{O}$ lies in the middle of the OVS.
(b) Find the ac gain $a$ as well as $v_{o}(t)$ if $v_{I}(t)=V_{I}+v_{i}(t)=0 \mathrm{~V}+(2.5 \mathrm{mV}) \cos \omega t$. Does $v_{o}(t)$ fall within the linear output range at all times?

### Solution

(a) By Eq. (4.2) we have

$$
v_{O(\min )} \cong 0.2-0.7=-0.5 \mathrm{~V} \quad v_{O(\max )} \cong 10-0.2=9.8 \mathrm{~V}
$$

To bias the output in the middle of the OVS we need

$$
V_{O}=\frac{1}{2}\left[v_{O(\max )}+v_{O(\min )}\right]=\frac{1}{2}(9.8-0.5)=4.65 \mathrm{~V}
$$

For $Q_{1}$ we have, by Eq. (2.21),

$$
I_{C 1}=I_{s} e^{V_{B E 1} / V_{T}}\left(1+\frac{V_{C E 1}}{V_{A 1}}\right)
$$

or

$$
10^{-3}=10 \times 10^{-15} \times e^{V_{B E} /(26 \mathrm{mV})}\left(1+\frac{4.65-(-0.7)}{100}\right)
$$

Solving, we get $V_{B E 1}=657.2 \mathrm{mV}$. Adapting the above expression to $Q_{4}$ 's collector current yields

$$
10^{-3}=5 \times 10^{-15} \times e^{V_{E A /} /(26 \mathrm{mV})}\left(1+\frac{10-4.65}{75}\right)
$$

which gives $V_{E B 4}=674.8 \mathrm{mV}$.
(b) We have $g_{m n}=1 /(26 \Omega), r_{o n}=100 \mathrm{k} \Omega$, and $r_{o p}=75 \mathrm{k} \Omega$, so Eq. (4.1b) gives

$$
a=-\frac{100 / / 75}{0.026}=-1,648 \mathrm{~V} / \mathrm{V}
$$

Finally, since $(2.5 \mathrm{mV}) \times 1648=4.12 \mathrm{~V}$, we have

$$
v_{o}(t)=V_{O}+v_{o}(t)=4.65 \mathrm{~V}+(4.12 \mathrm{~V}) \cos \left(\omega t-180^{\circ}\right)
$$

Note that $v_{O}$ alternates between $4.65+4.12=8.77 \mathrm{~V}$ and $4.65-4.12=0.53 \mathrm{~V}$, indicating that the condition $v_{O(\min )}<v_{O}<v_{O(\max )}$ is satisfied at all times.

We observe that the gain achievable with an active load can be much higher than with a discrete load, thanks to the fact that usually $r_{o p} \gg R_{C}$. High gains are especially welcome in negative-feedback systems such as op amp circuits, where the higher the gain the more pronounced the benefits of negative feedback tend to be (this will become clear when we study negative feedback in Chapter 7.)

As we move along we shall see that we can increase gain further by suitably raising the effective resistance seen looking into $Q_{4}$ 's collector, for instance, by introducing emitter degeneration for $Q_{4}$. If this resistance is made much higher than $r_{o n}$, then the ac gain of Eq. (4.1b) simplifies as $a=a_{\text {intrinsic }}$, where

$$
\begin{equation*}
a_{\text {intrinsic }}=-g_{m} r_{o}=-\frac{V_{A}}{V_{T}} \tag{4.3}
\end{equation*}
$$

Here, $V_{A}$ is the Early voltage of the amplifying BJT ( $Q_{1}$ in the present case), $V_{T}$ is the thermal voltage ( 26 mV at $T=300 \mathrm{~K}$ ), and $a_{\text {intrinsic }}$ is the maximum gain achievable with a single BJT, a gain aptly called the intrinsic gain. In Example 4.1 we have $a_{\text {intrinsic }}=-100 / 0.026=-3846 \mathrm{~V} / \mathrm{V}$. Compare this with the case of a typical passive load of the types investigated in Chapter 2, say $R_{C}=10 \mathrm{k} \Omega$, which would give $a=-(100 / / 10) / 0.026=-350 \mathrm{~V} / \mathrm{V}$, a whole order of magnitude lower than the intrinsic gain!

At this point we wonder how to implement the sources $V_{B E 1}$ and $V_{E B 4}$ of Fig. 4.2a. Example 4.1 indicates that their values must be accurate within millivolts. We also know that these values drift with temperature by about $-2 \mathrm{mV} /{ }^{\circ} \mathrm{C}$, so we need biasing schemes capable of assuring stable collector currents against a range of fabrication and environmental variations. In IC technology these schemes are made possible by the aforementioned availability of matching and tracking, as it will be demonstrated next.

### Emitter-Coupled Pairs

The scheme shown in Fig. 4.3a utilizes a current sink $\left(2 I_{E}\right)$ to provide dc biasing, and a second BJT ( $Q_{2}$ ) to provide a low ac-resistance path between $Q_{1}$ 's emitter and ground. (Viewed this way, $Q_{2}$ in effect replaces the ac bypass capacitance $C_{2}$ of Fig. 4.1.) If $Q_{1}$ and $Q_{2}$ are matched, then for $v_{i}=0$ the sink current $2 I_{E E}$ will split equally between the two BJTs as they experience the same $V_{B E}$ drop. Moreover, the two currents $I_{E}$ will track each other over a range of thermal variations in $V_{B E}$.

The ac resistance between $Q_{1}$ 's emitter and ground is the resistance seen looking into $Q_{2}$ 's emitter, or $r_{e 2}=\alpha_{02} / g_{m 2} \cong 1 / g_{m 2}\left(=1 / g_{m 1}\right)$. This resistance, though not zero, is small ( $26 \Omega$ at 1 mA ) and introduces emitter degeneration for $Q_{1}$, as depicted in the ac equivalent of Fig. 4.3b. The degenerated transconductance is

$$
\begin{equation*}
G_{m}=\frac{g_{m 1}}{1+g_{m 1} r_{e 2}} \cong \frac{g_{m 1}}{1+g_{m 1} / g_{m 2}}=\frac{g_{m}}{2} \tag{4.4}
\end{equation*}
$$

where the $n$ and $p$ subscripts have been dropped as the BJTs have identical $g_{m}$ s. Because of degeneration the voltage gain will also be reduced, but this price is well worth the elimination of $C_{2}$. In fact, even with degeneration, gain continues to remain fairly high, and it does so all the way down to dc!
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-039.jpg?height=670&width=574&top_left_y=210&top_left_x=199)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-039.jpg?height=494&width=321&top_left_y=389&top_left_x=767)
(b)

FIGURE 4.3 (a) Biasing scheme for the amplifier $Q_{1}$, and
(b) ac equivalent for the entire circuit.

### Current Mirrors

Next, we wish to investigate a suitable IC scheme to bias $Q_{4}$. Since the current $I_{C 4}$ sourced by $Q_{4}$ must at all times equal the current $I_{C 1}$ sunk by $Q_{1}$, it is apparent that $V_{E B}$ must be adjusted continuously against any thermal variations. The scheme of Fig. 4.4 does this automatically via $Q_{2}$ and the diode-connected transistor $Q_{3}$ as follows: as we know, $I_{C 2}$ matches $I_{C 1}$; moreover, in response to $I_{C 2}, Q_{3}$ develops a voltage drop $V_{E B}$ that is in turn transmitted to $Q_{4}$. Being matched and subject to the same $V_{E B}$ drive,
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-039.jpg?height=639&width=437&top_left_y=1484&top_left_x=190)

FIGURE 4.4 Biasing scheme for the active load $Q_{4}$.
$Q_{4}$ will draw as much collector current as $Q_{3}$, this being the reason why $Q_{4}$ is said to mirror $Q_{3}$. Ignoring base currents, we summarize by stating that $I_{C 4}$ mirrors $I_{C 3}$, which is the same as $I_{C 2}$, which in turn tracks $I_{C 1}$. Consequently, $I_{C 4}$ will track $I_{C 1}$ regardless of any thermal drift of $V_{E B}$ or $V_{B E}$ ! The current mirror, already introduced in its most basic form in Chapters 2 and 3, finds wide application both in bipolar and CMOS ICs and will be investigated in great depth in Section 4.8.

### Monolithic Voltage Amplifiers

Aptly referred to as an emitter-coupled pair (EC pair), the $Q_{1}-Q_{2}$ pair of Fig. 4.4 exhibits an interesting and useful symmetry: just like $Q_{2}$ provides a low-resistance to $Q_{1}$ 's emitter, $Q_{1}$ provides the same function for $Q_{2}$. This reciprocity suggests that we can apply the input to either of the two bases, or even drive the two bases simultaneously with separate signals, thus increasing the circuit's flexibility. In fact we shall see that the two base signals influence the output in equal but opposite amounts, indicating that the output depends on the difference between the inputs, this being the reason why the EC pair is also referred to as a differential pair. Differential pairs form the input stages of a wide variety of monolithic circuits, such as operational amplifiers and voltage comparators, and they will be investigated in great depth in Section 4.5.

Figure $4.5 a$ shows a popular monolithic counterpart of the discrete design of Fig. 4.1. Its basic ingredients are as follows:

- The EC pair $Q_{1}-Q_{2}$ provides signal amplification, and it does so in differential form.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-040.jpg?height=905&width=1431&top_left_y=1177&top_left_x=219)

FIGURE 4.5 High-gain monolithic amplifiers: (a) bipolar and (b) CMOS.

- The current mirror $Q_{3}-Q_{4}$ forms an active load for the EC pair, assuring high gain and also converting the input signal difference to a single-ended output. As we move along we shall see that the gain is

$$
\begin{equation*}
a=\frac{v_{o}}{v_{i 1}-v_{i 2}}=-g_{m n}\left(r_{o n} / / r_{o p}\right) \tag{4.5}
\end{equation*}
$$

- Another current mirror $\left(Q_{5}-Q_{6}\right)$ is used to provide the dc bias for the EC pair. Here, $R$ establishes the current into the diode-connected BJT $Q_{5}$, and $Q_{6}$ then mirrors this current (now re-labeled as $I_{E E}$ ) to the EC pair, but at a higher outputresistance level ( $r_{o 6}$ in the present case).

Compared to the discrete predecessor of Fig. 4.1, the monolithic version of Fig. $4.5 a$ might seem far more complex and expensive to fabricate. However, considering that it uses no capacitors and just one resistor, and that transistors are the preferred devices in IC technology, the monolithic version is highly desirable indeed. It is also more flexible as it responds to the difference between a pair of input signals, not to mention its ability to provide much higher voltage gains.

By the time MOS technology became commercially viable, the canons of IC design were already well established in bipolar technology, so it was a straightforward matter to transfer them directly to the new technology. Shown in Fig. 4.5b is the CMOS counterpart of the bipolar version of Fig. 4.5a. In this example even the current-setting resistor $R$ has been replaced by a transistor, namely, the diode-connected MOSFET $M_{7}$, whose $W / L$ ratio is chosen so as to achieve the desired bias current $I_{S S}$. As we move along, we shall see that Eq. (4.5) applies to the CMOS amplifier version as well, the only difference being in the lower transconductances of FETs. (The circuits of Fig. 4.5 will be investigated in great depth in Section 4.9.)

Figure 4.6 shows a PSpice circuit to display the VTC of the bipolar amplifier of Fig. 4.5a. The steepness of the curve confirms the high gain of the circuit. Also shown are the saturation limits of the linear region of operation.

### What to Expect

The discussion leading to the amplifiers of Fig. 4.5 provides a nutshell overview of the most relevant considerations in monolithic design:

- Avoid the use of on-chip resistors and capacitors. If capacitors are required, they should be on the order of a few picofarads or less.
- Resistances will continue to appear in our circuits and calculations, but for the most part they will be the resistances of small-signal transistor models, such as $r_{o p}$ and $r_{e 2}$ of Fig. 4.3b.
- Exploit the availability of matched and tracking characteristics to devise creative design solutions, such as current mirrors and differential pairs.
- Even though IC design follows a different set of rules than discrete design, the study of ICs still relies very heavily on the foundations provided by Chapters 1 through 3.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-042.jpg?height=727&width=1342&top_left_y=200&top_left_x=301)

FIGURE 4.6 (a) PSpice circuit to plot (b) the VTC of the monolithic amplifier of Fig. 4.5a. The following parameters are assumed: Qn: $I_{s}=2 \mathrm{fA}, \beta_{F}=200, V_{A}=100 \mathrm{~V}$. Qp: $I_{s}=1 \mathrm{fA}, \beta_{F}=50$, $V_{A}=50 \mathrm{~V}$.

- We shall make frequent use of PSpice simulation to corroborate the result of hand analysis as well as to investigate higher-order nuances that often escape paper-and-pencil calculations.

In order to proceed, we need to investigate in more systematic detail the currentmirror and differential-pair concepts introduced above, as well as a variety of other canonical blocks that are at the basis of contemporary monolithic design. However, before embarking on these tasks, we need to reexamine the characteristics and models for active devices (both BJTs and MOSFETs) in finer detail.

## 4.2 BJT CHARACTERISTICS AND MODELS REVISITED

The BJT characteristics and models of Chapter 2 were deliberately kept as simple as possible to allow the beginner to focus on the essentials of discrete circuit design and develop a basic feel for circuit operation. As we embark upon the study of monolithic circuits, we need to suitably refine our BJT models to include second-order effects that tend to play more prominent roles in these types of circuits.

### Base Width Modulation Revisited

In our study of npn BJT operation we found that increasing $v_{C E}$ expands the width of the base-collector depletion region, thus shrinking the effective base width $W_{B}$. This phenomenon, known as the Early effect, yields a steeper profile of excess electrons within the base, ultimately raising the collector current $i_{C}$ because it is proportional to
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-043.jpg?height=330&width=1184&top_left_y=218&top_left_x=204)

FIGURE 4.7 Small-signal BJT model including $r_{\mu}$.
this profile's slope. There is yet another more subtle effect of base-width modulation, for a reduction in $W_{B}$ reduces also the recombination component $i_{B B}$ of the total base current $i_{B}$. We recall that $i_{B}=i_{B E}+i_{B B}$, where $i_{B E}$ is the diffusion component from base to emitter, and $i_{B B}$ is the recombination component within the base. According to Eq. (2.14), $i_{B B}$ is proportional to the excess charge in the base region, in turn proportional to the volume $A_{E} \times W_{B}$, so a reduction in $W_{B}$ will also reduce $i_{B B}$, and hence, $i_{B}$. In summary, if we increase $v_{C E}$ while keeping $v_{B E}$ constant, we witness (a) an increase in the current $i_{C}$ drawn from the $v_{C E}$ source, and (b) a decrease in the current $i_{B}$ drawn from the $v_{B E}$ source. In small-signal operation we model the former by means of the familiar resistance $r_{o}$ between collector and emitter, and the latter by means of an additional resistance $r_{\mu}$ between collector and base. The resulting more refined model is depicted in Fig. 4.7.

Assuming $v_{B E}$ is held constant, we find $r_{\mu}$ as

$$
\frac{1}{r_{\mu}}=\frac{d i_{B B}}{d v_{C E}}=\frac{d i_{C}}{d v_{C E}} \frac{d i_{B B}}{d i_{C}}=\frac{1}{r_{o}} \frac{d i_{B B}}{d i_{C}}
$$

or

$$
\begin{equation*}
r_{\mu}=\frac{i_{c}}{i_{b b}} r_{o} \tag{4.6}
\end{equation*}
$$

where $i_{c}$ and $i_{b b}$ are small-signal variations of $i_{C}$ and $i_{B B}$. If $i_{B}$ consisted entirely of $i_{B B}$, then we would have $i_{c} / i_{b b}=i_{c} / i_{b}=\beta_{0}$, and Eq. (4.6) would give $r_{\mu}=r_{\mu(\min )}$, where

$$
\begin{equation*}
r_{\mu(\min )}=\beta_{0} r_{o} \tag{4.7}
\end{equation*}
$$

However, $i_{B B}$ is only a fraction of $i_{B}$, so if we write $i_{b b}=(1 / m) i_{b}, m \geq 1$, then Eq. (4.6) becomes

$$
\begin{equation*}
r_{\mu}=m \beta_{0} r_{o} \tag{4.8}
\end{equation*}
$$

In monolithic npn BJTs, $i_{B E}$ usually dominates and $i_{B B}$ is on the order of only $10 \%$ of $i_{B}(m=10)$, so it is common practice to assume $r_{\mu} \cong 10 \beta_{0} r_{o}$. Because of its sheer size, $r_{\mu}$ is usually ignored except for a few special cases, as we shall see. In lateral pnp BJTs (see Fig 2.3) the recombination component is far more significant, so in this case $r_{\mu}$ is closer to the lower limit of Eq. (4.7).

### Bulk Resistances in the BJT

The materials making up the emitter, base, and collector regions exhibit nonzero resistances that need to be taken into account in high-accuracy BJT modeling. To include these higher-order effects, the small-signal model is augmented as in Fig. 4.8. To understand the origin of these bias-independent resistances, also called bulk resistances, refer to the BJT structure of Figs. 2.1 and 2.2:

- The emitter region is short and heavily doped, so its bulk resistance $r_{e x}$ (not to be confused with $\left.r_{e}=\alpha_{0} / g_{m}\right)$ is rather small and fixed. In monolithic BJTs $r_{e x}$ is on the order of just a few Ohms.
- The base region is doped more lightly than the emitter and it also forms a longer conductive path, especially transversally, so $r_{b}$ is one to two orders of magnitude higher than $r_{e x}$. In monolithic BJTs $r_{b}$ typically ranges from 50 to $500 \Omega$. Note that the voltage controlling the dependent source is the internal voltage $v_{\pi}$, not the terminal voltage $v_{b e}$ ! For $r_{e x} \cong 0$, the two are related as $v_{\pi}=v_{b e} \times r_{\pi} /\left(r_{b}+r_{\pi}\right)$.
- The collector region is doped even more lightly in order to assure an adequately high value of $B V_{C E O}$, and it forms an even longer conductive path. This would result in an unacceptably high bulk resistance. In the planar process this drawback is reduced drastically by fabricating a highly conductive buried layer, as shown in Fig. 2.2. This heavily doped layer provides a low-resistance path for electrons once they have crossed from the $p$ base into the $n^{-}$collector region and thence to the buried layer itself. By this artifice, the overall resistance $r_{c}$ is kept in the range of 20 to $500 \Omega$. (Nowadays the $n^{+}$collector diffusion is extended all the way to the buried layer so as to minimize $r_{c}$.)

The model of Fig. 4.8 is referred to as a low-frequency model. When studying the frequency response of BJT circuits, in Chapter 6, we will need to augment this model with appropriate parasitic capacitances. At low operating frequencies these capacitances act as open circuits and will thus be ignored. Not so at high frequencies, where they become significant and tend to alter circuit behavior dramatically. To keep hand calculations manageable we will ignore $r_{b}, r_{e x}, r_{c}$, and $r_{\mu}$ whenever possible. Only when their presence has an appreciable impact shall we take them into proper consideration.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-044.jpg?height=393&width=781&top_left_y=1635&top_left_x=448)

FIGURE 4.8 Complete small-signal model of the BJT at low frequencies.

### The Small-Signal Resistances Seen Looking into the Terminals of a BJT

While investigating the resistance-transformation abilities of the BJT in connection with Fig. 2.42, we stipulated an ac grounded collector in order to keep our derivations simple. The results obtained there provide good approximations for discrete designs, where the net equivalent resistance external to the collector is not very large. However, in monolithic circuits the collector is often terminated on an active load whose equivalent resistance can be quite high, rendering the results of Chapter 2 no longer adequate. We need to reexamine the resistance transformation ability of the BJT but using the more general ac circuit of Fig. 4.9. The main novelty now is the coupling established by $r_{o}$ between $R_{C}$ and the internal circuitry of the BJT model. As usual, we utilize lower-case subscripts to distinguish the small-signal resistances $R_{b}, R_{e}$, and $R_{c}$ from the external resistances $R_{B}$, $R_{E}$, and $R_{C}$.

- The Resistance $\boldsymbol{R}_{b}$ Seen Looking into the Base. The circuit to find this resistance is shown in Fig. 4.10a. Ignoring $r_{\mu}$ because of its sheer size, we use Ohm's law to write

$$
i_{b}=\frac{v_{b}-v_{e}}{r_{\pi}}
$$

We need another equation to eliminate $v_{e}$, so we apply KCL at node $v_{e}$ and write

$$
\frac{v_{b}-v_{e}}{r_{\pi}}+\beta_{0} i_{b}+\frac{v_{c}-v_{e}}{r_{o}}=\frac{v_{e}}{R_{E}}
$$

Now, we need yet another equation to eliminate $v_{c}$, so we again apply KCL at $v_{c}$ and write

$$
\frac{0-v_{c}}{R_{C}}=\beta_{0} i_{b}+\frac{v_{c}-v_{e}}{r_{o}}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-045.jpg?height=602&width=1224&top_left_y=1484&top_left_x=142)

FIGURE 4.9 The small-signal resistances seen looking into the BJT's terminals.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-046.jpg?height=456&width=1516&top_left_y=218&top_left_x=111)

FIGURE 4.10 Test circuits to find (a) $R_{b}$ and (b) $R_{e}$.

Eliminating $v_{e}$ and $v_{c}$, collecting, and taking the ratio $R_{b}=v_{b} / i_{b}$ gives, after some algebra,

$$
\begin{equation*}
R_{b}=r_{\pi}+\left(\beta_{0}+1\right)\left(R_{E} / / r_{o}\right) \times \frac{1+R_{C} /\left[\left(\beta_{0}+1\right) r_{o}\right]}{1+R_{C} /\left(R_{E}+r_{o}\right)} \tag{4.9}
\end{equation*}
$$

It is apparent that as long as $R_{C} \ll\left(\beta_{0}+1\right) r_{o}$ and $R_{C} \ll\left(R_{E}+r_{o}\right)$, Eq. (4.9) reduces to the familiar form $R_{b}=r_{\pi}+\left(\beta_{0}+1\right)\left(R_{E} / / r_{o}\right)$. In the discrete designs of Chapter 2, $R_{C}$ was always small enough to meet these conditions. However, this is not necessarily the case in monolithic designs, where the collector may be terminated on an active load and therefore $R_{C}$ can be quite large. In fact, you can verify that in the limit $R_{C} \rightarrow \infty$, Eq. (4.9) gives $R_{b} \rightarrow r_{\pi}+R_{E}$ ! To justify this surprising result, note that letting $R_{C}=\infty$ in Fig. 4.10a will force the current $\beta_{0} i_{b}$ to circulate entirely in $r_{o}$, making the two elements act as a self-contained subcircuit. Consequently, the source $v_{i}$ sees just $r_{\pi}$ in series with $R_{E}$ !

EXAMPLE 4.2 Let the BJT of Fig. 4.9 have $\beta_{0}=100, r_{\pi}=2.6 \mathrm{k} \Omega$, and $r_{o}=100 \mathrm{k} \Omega$. If $R_{E}$ $=1.0 \mathrm{k} \Omega$, find $R_{b}$ in the limits $R_{C} \rightarrow 0$ and $R_{C} \rightarrow \infty$. For what value of $R_{C}$ does $R_{b}$ drop to $90 \%$ of the value corresponding to $R_{C} \rightarrow 0$ ?

### Solution

By Eq. (4.9),

$$
\begin{aligned}
& \lim _{R_{c} \rightarrow 0} R_{b}=r_{\pi}+\left(\beta_{0}+1\right)\left(R_{E} / / r_{o}\right)=2.6+101(1 / / 100) \cong 103 \mathrm{k} \Omega \\
& \lim _{R_{c} \rightarrow \infty} R_{b}=r_{\pi}+R_{E}=2.6+1=3.6 \mathrm{k} \Omega
\end{aligned}
$$

Imposing

$$
0.9 \times 103=2.6+(1 / / 100) \frac{1+R_{C} /(101 \times 100)}{1+R_{C} /(1+100)}
$$

and solving gives $R_{C}=11.5 \mathrm{k} \Omega$.

- The Resistance $\boldsymbol{R}_{e}$ Seen Looking into the Emitter. Summing currents into the emitter node of Fig. 4.10b gives

$$
\left(\beta_{0}+1\right) i_{b}+i_{e}+\frac{v_{c}-v_{e}}{r_{o}}=0
$$

We need two additional equations to eliminate $i_{b}$ and $v_{c}$. Again ignoring $r_{\mu}$, we use Ohm's law to write

$$
i_{b}=\frac{0-v_{e}}{R_{B}+r_{\pi}}
$$

Moreover, KCL at the collector node gives

$$
\frac{0-v_{c}}{R_{C}}=\beta_{0} i_{b}+\frac{v_{c}-v_{e}}{r_{o}}
$$

Eliminating, collecting and solving for the ratio $R_{e}=v_{e} / i_{e}$ gives, after some algebra,

$$
\begin{equation*}
R_{e}=\left(\frac{R_{B}+r_{\pi}}{\beta_{0}+1} / / r_{o}\right) \times \frac{1+R_{C} / r_{o}}{1+R_{C} /\left[\left(\beta_{0}+1\right) r_{o}+R_{B}+r_{\pi}\right]} \tag{4.10}
\end{equation*}
$$

As long as $R_{C} \ll r_{o}$ this equation reduces to the familiar form of discrete designs, namely, $R_{e} \cong\left[\left(R_{B}+r_{\pi}\right) /\left(\beta_{0}+1\right)\right] / / r_{o}$, which is small because of the term $\left(\beta_{0}+1\right)$ in the denominator. However, if the collector is terminated on a current source, $R_{C}$ can be sufficiently large to raise $R_{e}$ dramatically. In fact, one can easily verify that in the limit $R_{C} \rightarrow \infty$ Eq. (4.10) gives $R_{e} \rightarrow R_{B}+r_{\pi}$ ! Again, with the collector ac open circuited, the current $\beta_{0} i_{b}$ will circulate exclusively in $r_{o}$, making the two elements act as a self-contained subcircuit. Consequently, the source $v_{e}$ sees just $r_{\pi}$ in series with $R_{B}$.

- The Resistance $\boldsymbol{R}_{\boldsymbol{c}}$ Seen Looking into the Collector. With sufficient emitter degeneration the resistance seen looking into the collector can be quite large, so ignoring $r_{\mu}$ may no longer be acceptable. Unfortunately, the inclusion of $r_{\mu}$ in the calculations complicates the algebra significantly and without providing much insight. A quicker, if approximate, approach is to investigate the effects of $r_{o}$ and $r_{\mu}$ separately and then combine them together. For the test circuit of Fig. 4.11a we ignore $r_{\mu}$ and recycle familiar results to write $i_{c 1}=v_{c} / R_{c 1}$, where

$$
\begin{equation*}
R_{c 1} \cong r_{o}\left[1+\frac{g_{m}\left(r_{n} / / R_{E}\right)}{1+R_{B} /\left(r_{\pi}+R_{E}\right)}\right] \tag{4.11}
\end{equation*}
$$

In the circuit of Fig. $4.11 b$ we ignore $r_{o}$ and apply KCL,

$$
i_{c 2}=\frac{v_{c}-v_{b}}{r_{\mu}}+\frac{g_{m}}{1+g_{m} R_{E}} v_{b}
$$

By the voltage divider formula,

$$
v_{b}=\frac{R_{B} / / R_{b}}{\left(R_{B} / / R_{b}\right)+r_{\mu}} v_{c} \cong \frac{R_{B} / / R_{b}}{r_{\mu}} v_{c}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-048.jpg?height=473&width=1612&top_left_y=205&top_left_x=32)

FIGURE 4.11 Test circuits to find the contributions to $R_{c}$ due to (a) $r_{o}$ and (b) $r_{\mu}$.
where we have used the fact that in circuits of practical interest $r_{\mu} \gg R_{B} / / R_{b}, R_{b}=$ $r_{\pi}+\left(\beta_{0}+1\right) R_{E}$. Clearly $v_{b}$ is much smaller than $v_{c}$, so we can simplify further, as

$$
i_{c 2}=\frac{v_{c}}{r_{\mu}}+\frac{g_{m}}{1+g_{m} R_{E}} \frac{R_{B} / / R_{b}}{r_{\mu}} v_{c} \cong \frac{1}{r_{\mu}}\left(1+\frac{R_{B} / / R_{b}}{R_{E}+1 / g_{m}}\right) v_{c}=\frac{v_{c}}{R_{c 2}}
$$

where

$$
\begin{equation*}
R_{c 2}=\frac{r_{\mu}}{1+\left(R_{B} / / R_{b}\right) /\left(R_{E}+1 / g_{m}\right)} \tag{4.12}
\end{equation*}
$$

With $r_{o}$ and $r_{\mu}$ present simultaneously, the overall current drawn from the $v_{c}$ source is $i_{c} \cong i_{c 1}+i_{c 2}=v_{c} / R_{c 1}+v_{c} / R_{c 2}$. Letting $R_{c}=v_{c} / i_{c}$, we find

$$
\begin{equation*}
R_{c} \cong R_{c 1} / / R_{c 2} \cong r_{o}\left[1+\frac{g_{m}\left(r_{\pi} / / R_{E}\right)}{1+R_{B} /\left(r_{\pi}+R_{E}\right)}\right] / /\left[\frac{r_{\mu}}{1+\left(R_{B} / / R_{b}\right) /\left(R_{E}+1 / g_{m}\right)}\right] \tag{4.13}
\end{equation*}
$$

We observe that the presence of $R_{B}$ reduces both $R_{c 1}$ and $R_{c 2}$. In applications where it is desired to maximize $R_{c}$, it would be best to keep $R_{B}$ as small as the design will allow.

EXAMPLE 4.3 Let the BJT of Fig. 4.9 have $\beta_{0}=100, r_{\pi}=2.6 \mathrm{k} \Omega, r_{o}=100 \mathrm{k} \Omega$, and $r_{\mu}=2 \beta_{0} r_{o}$. If $R_{B}=10 \mathrm{k} \Omega$ and $R_{E}=1.0 \mathrm{k} \Omega$, estimate $R_{c}$. What happens if $R_{B}=0$ ? Compare with PSpice.

### Solution

We have $g_{m}=100 / 2600=1 /(26 \Omega)$ and $r_{\mu}=2 \times 100 \times 100=20 \mathrm{M} \Omega$. Equations (4.11) through (4.13) give

$$
\begin{aligned}
& R_{c 1} \cong 100\left(1+\frac{(2.6 / / 1) / 0.026}{1+10 /(2.6+1)}\right)=835 \mathrm{k} \Omega \\
& R_{c 2}=\frac{20}{1+(10 / / 103.6) /(1+0.026)} \cong 2 \mathrm{M} \Omega \\
& R_{c} \cong 835 / / 2,000=591 \mathrm{k} \Omega
\end{aligned}
$$

With $R_{B}=0$ we get $R_{c 1}=2.88 \mathrm{M} \Omega, R_{c 2}=r_{\mu}=20 \mathrm{M} \Omega$, and $R_{c}=2.88 / / 20,000=$ $2.52 \mathrm{M} \Omega$, in excellent agreement with PSpice, which gives $R_{c}=594 \mathrm{k} \Omega$ for $R_{B}=10 \mathrm{k} \Omega$, and $R_{c}=2.52 \mathrm{M} \Omega$ for $R_{B}=0$.

As mentioned, a monolithic transistor amplifier is likely to be biased and/or loaded by another transistor configured as a current source or sink, so it is instructive to reexamine the basic CE, CC, and CB configurations from the perspective of monolithic design. To focus on the distinguishing aspects of this type of design, we first investigate a circuit in the absence of loading and for the case of ideal current sources/ sinks (to keep things simple we also assume $r_{\mu}=\infty$ ). Then, we adapt our results to the case of non-ideal sources/sinks, in the presence of output loading, and with $r_{\mu} \neq \infty$.

### The CE Configuration with an Idealized Active Load

Recall that the common-emitter (CE) configuration (with or without emitter degeneration) is best suited to voltage amplification. The monolithic rendition of Fig. 4.12 uses the current source $I_{L O A D}$ as an active load, and the voltage source $V_{B I A S}$ to bias the BJT. We assume that $V_{B I A S}$ has been adjusted so as to bias the collector well within the linear region of operation. We readily find the input and output resistances by adapting Eqs. (4.9) and (4.13) in the limits $R_{B} \rightarrow 0, R_{C} \rightarrow \infty$, and $r_{\mu} \rightarrow \infty$. The results are

$$
\begin{equation*}
R_{i}=r_{\pi}+R_{E} \tag{4.14}
\end{equation*}
$$

$$
\begin{equation*}
R_{o}=r_{o}\left[1+g_{m}\left(r_{\pi} / / R_{E}\right)\right] \tag{4.15}
\end{equation*}
$$

Comparing to the case $R_{C} \rightarrow 0$, for which the familiar expression $R_{i}=r_{\pi}+$ $\left(\beta_{0}+1\right)\left(R_{E} / / r_{o}\right)$ holds, one may find Eq. (4.14) surprising. However, we readily justify it by turning to the ac equivalent of Fig. 4.13, where we observe that in the limit $R_{C} \rightarrow \infty$ the collector acts as an open circuit, at least on an ac basis. This means that the $g_{m} v_{\pi}$ current must circulate entirely in $r_{o}$, so these two elements act as a self-contained subcircuit. In this case the source $v_{i}$ sees just $r_{\pi}$ in series with $R_{E}$ ! Here is one significant difference between monolithic (high $R_{C}$ ) and discrete (low $R_{C}$ ) design!
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-049.jpg?height=527&width=490&top_left_y=1559&top_left_x=206)

| CE-ED |
| :--- |
| $R_{i}=r_{\pi}+R_{E}$ |
| $a_{o c}=-g_{m} r_{o} \frac{1-R_{E} /\left(\beta_{o} r_{o}\right)}{1+R_{E} / r_{\pi}}$ |
| $R_{o}=r_{o}\left[1+g_{m}\left(r_{\pi} / / R_{E}\right)\right]$ |

| $\mathbf{C E}\left(\boldsymbol{R}_{E}=\mathbf{0}\right)$ |
| :--- |
| $R_{i}=r_{\pi}$ |
| $a_{o c}=a_{\text {intrinic }}=-g_{m} r_{o}$ |
| $R_{o}=r_{o}$ |

FIGURE 4.12 Voltage amplifier with an ideal active load, and its small-signal characteristics for $r_{\mu}=\infty$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-050.jpg?height=371&width=811&top_left_y=200&top_left_x=447)

FIGURE 4.13 Ac equivalent of the voltage amplifier of Fig. 4.12.

To find the voltage gain, consider again Fig. 4.13 in the limit $R_{C} \rightarrow \infty$. By KVL and Ohm's Law,

$$
v_{o}=v_{i}-v_{\pi}-r_{o} g_{m} v_{\pi}=v_{i}-\left(1+g_{m} r_{o}\right) v_{\pi}
$$

By the voltage divider formula,

$$
v_{\pi}=\frac{r_{\pi}}{r_{\pi}+R_{E}} v_{i}
$$

Substituting $v_{\pi}$, collecting, and solving for the ratio $v_{o} / v_{i}$ we get, after some algebra,

$$
\begin{equation*}
a_{o c}=\lim _{R_{c} \rightarrow \infty} \frac{v_{o}}{v_{i}}=-g_{m} r_{o} \frac{1-R_{E} /\left(\beta_{0} r_{o}\right)}{1+R_{E} / r_{\pi}} \tag{4.16a}
\end{equation*}
$$

where $a_{o c}$ is the open-circuit voltage gain, also called the unloaded voltage gain. A practical circuit has $R_{E} /\left(\beta_{0} r_{o}\right) \ll 1$, so this gain simplifies to

$$
\begin{equation*}
a_{o c} \cong \frac{-g_{m} r_{o}}{1+R_{E} / r_{\pi}} \tag{4.16b}
\end{equation*}
$$

The above expressions were derived in the presence of emitter degeneration, but we readily adapt them to the nondegenerated case by letting $R_{E}=0$. This gives $R_{i}=r_{\pi}, R_{o}=r_{o}$, and $a_{o c}=a_{\text {intrinsic }}$, where

$$
\begin{equation*}
a_{\text {intrinsic }}=-g_{m} r_{o}=-\frac{V_{A}}{V_{T}} \tag{4.17}
\end{equation*}
$$

is called the BJT's intrinsic gain. This is the maximum voltage gain achievable with a CE amplifier.

In actual application the amplifier is likely to drive some finite load resistance, and the $I_{\text {LOAD }}$ current source is likely to exhibit some finite parallel resistance. Moreover, $r_{\mu} \neq \infty$. Lumping all these resistances together and denoting the result as $R_{C}$, we find the loaded gain via the voltage divider formula,

$$
\begin{equation*}
\frac{v_{o}}{v_{i}} \cong-a_{o c} \times \frac{R_{C}}{R_{o}+R_{C}} \tag{4.18}
\end{equation*}
$$

Note that the presence of $R_{C}$ will also alter the input resistance $R_{i}$, as per Eq. (4.9).

### Exercise 4.1

Show that for $R_{C} \ll r_{o}$, Eqs. (4.9) and (4.18) can be put in the more familiar forms of discrete design

$$
\begin{equation*}
R_{i} \cong r_{\pi}+\left(\beta_{0}+1\right) R_{E} \quad \frac{v_{o}}{v_{i}} \cong-\frac{R_{C}}{r_{e}+R_{E}} \tag{4.19}
\end{equation*}
$$

Let the BJT of Fig. 4.12 have $g_{m}=1 / 25 \mathrm{~A} / \mathrm{V}, r_{\pi}=4.0 \mathrm{k} \Omega$, and $r_{o}=50 \mathrm{k} \Omega$. EXAMPLE 4.4 Assuming $r_{\mu}=\infty$, find $R_{i}, R_{o}$, and $v_{o} / v_{i}$ if:
(a) $R_{E}=0$ and $R_{C}=\infty$.
(b) $R_{E}=1.0 \mathrm{k} \Omega$ and $R_{C}=\infty$.
(c) $R_{E}=1.0 \mathrm{k} \Omega$ and $R_{C}$ is adjusted so that $R_{C}=R_{o}$.
(d) $R_{E}=1.0 \mathrm{k} \Omega$ and $R_{C}=10 \mathrm{k} \Omega$. Comment on your results at each step.
(e) Repeat parts (a) and (b) assuming $r_{\mu}=5 \beta_{0} r_{o}$.

### Solution

(a) With $R_{E}=0$ and $R_{C}=\infty$ the BJT amplifies by its intrinsic gain, and we have

$$
\begin{aligned}
& R_{i}=r_{\pi}=4.0 \mathrm{k} \Omega \\
& R_{o}=r_{o}=50 \mathrm{k} \Omega \\
& a_{\text {intrinsic }}=-g_{m} r_{o}=-50 / 0.025=-2000 \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

(b) With emitter degeneration we expect an increase in $R_{i}$ and $R_{o}$ and a drop in $a$,

$$
\begin{aligned}
& R_{i}=r_{\pi}+R_{E}=4+1=5 \mathrm{k} \Omega \\
& R_{o}=r_{o}\left[1+g_{m}\left(r_{n} / R_{E}\right)\right]=50[1+(4 / / 1) / 0.025]=1.65 \mathrm{M} \Omega \\
& \frac{v_{o}}{v_{i}} \cong \frac{-g_{m} r_{o}}{1+R_{E} / r_{\pi}}=\frac{-2000}{1+1 / 4}=-1600 \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

(c) We still have $R_{o}=1.65 \mathrm{M} \Omega$. However, loading the collector with $R_{C}=R_{o}=$ $1.65 \mathrm{M} \Omega$ will reduce gain to one-half the unloaded value, by Eq. (4.18). Thus

$$
\frac{v_{o}}{v_{i}}=-1600 \frac{1.65}{1.65+1.65}=-800 \mathrm{~V} / \mathrm{V}
$$

Moreover, $R_{i}$ will increase because of the coupling action by $r_{o}$. Using Eq. (4.9) with $\beta_{0}=g_{m} r_{\pi}=160$,

$$
R_{i}=4+161(1 / / 50) \times \frac{1+1650 /(161 \times 50)}{1+1650 /(1+50)}=9.7 \mathrm{k} \Omega
$$

(d) Using again Eqs (4.18) and (4.9), but with $R_{C}=10 \mathrm{k} \Omega$, we now get

$$
\frac{v_{o}}{v_{i}}=-9.63 \mathrm{~V} / \mathrm{V} \quad R_{i}=136 \mathrm{k} \Omega
$$

With $R_{C}$ this low, we could have used the familiar expressions of Eq. (4.19) to estimate

$$
\frac{v_{o}}{v_{i}} \cong-\frac{10}{0.025+1}=-9.76 \mathrm{~V} / \mathrm{V} \quad R_{i} \cong 4+161 \times 1=165 \mathrm{k} \Omega
$$

which are in fair agreement with the above. It is apparent that reducing $R_{C}$ lowers $a$ while raising $R_{i}$. The difference between monolithic and discrete design is evidenced further in Exercise 4.3, p. 357.
(e) We have $r_{\mu}=5 \times 160 \times 50=40 \mathrm{M} \Omega$. To assess the impact of $r_{\mu}$ we adapt Eq. (4.18). Thus, in (a) gain drops to $-2000 \times 40 /(0.05+40)=-1997 \mathrm{~V} / \mathrm{V}$ and in $(b)$ gain drops to $-1600 \times 40 /(1.65+40)=-1537 \mathrm{~V} / \mathrm{V}$. In both cases the change is fairly small, indicating that we can ignore $r_{\mu}$, at least in this example.

### Exercise 4.2

Use Eq. (4.16a) to predict the gain of the circuit of Fig. 4.12 if (a) $R_{E}=\beta_{0} r_{o}$, and (b) $R_{E}=\infty$. Hence, justify your results via physical reasoning.

### The CC Configuration with an Idealized Active Load

Recall that the common-collector (CC) configuration is best suited to voltage buffering. The IC rendition of Fig. 4.14 admits the ac equivalent of Fig. 4.15, which we wish to investigate in the limit $R_{E} \rightarrow \infty$. In the absence of $r_{\mu}$ the resistance seen looking into the base would be $r_{\pi}+\left(\beta_{0}+1\right) r_{o} \cong \beta_{0} r_{o}$. This is large and comparable to $r_{\mu}$ ( $=m \beta_{0} r_{o}$ ), so taking the latter into account, we write, for $R_{E} \rightarrow \infty$,

$$
\begin{equation*}
R_{i} \cong\left(\beta_{0} r_{o}\right) / /\left(m \beta_{0} r_{o}\right)=\frac{m}{m+1} \beta_{0} r_{o} \tag{4.20}
\end{equation*}
$$

Moreover, adapting familiar expressions in the limit $R_{E} \rightarrow \infty$, we get

$$
\begin{equation*}
R_{o}=r_{e} / / r_{o} \cong r_{e} \tag{4.21}
\end{equation*}
$$

and

$$
\begin{equation*}
a_{o c}=\lim _{R_{k} \rightarrow \infty} \frac{v_{o}}{v_{i}}=\frac{1}{1+\frac{r_{\pi}}{\left(\beta_{0}+1\right) r_{o}}}=\frac{1}{1+r_{e} / r_{o}} \cong \frac{1}{1+1 /\left(g_{m} r_{o}\right)} \tag{4.22}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-052.jpg?height=436&width=468&top_left_y=1595&top_left_x=452)

$$
\begin{aligned}
& R_{i} \cong \frac{m}{m+1} \beta_{o} r_{o} \\
& \hline a_{o c} \cong \frac{1}{1+1 /\left(g_{m} r_{o}\right)} \\
& R_{o} \cong r_{e}
\end{aligned}
$$

FIGURE 4.14 Voltage follower with ideal current sink bias, and its small-signal characteristics.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-053.jpg?height=412&width=823&top_left_y=221&top_left_x=206)

FIGURE 4.15 Ac equivalent of the voltage follower of Fig. 4.14.
where $a_{o c}$ is the unloaded or open-circuit voltage gain. This gain, slightly less than unity, is the maximum gain achievable with the CC configuration, and it can also be expressed in the bias-independent form

$$
\begin{equation*}
a_{o c} \cong \frac{1}{1+V_{T} / V_{A}} \tag{4.23}
\end{equation*}
$$

In actual application the circuit is likely to drive some finite load, and the $I_{B I A S}$ current sink is likely to exhibit some finite parallel resistance. Lumping these resistances together and denoting the result as $R_{E}$, we observe that $R_{E}$ appears in parallel with $r_{o}$ in Fig. 4.15, so we recycle Eq. (4.22) but with $r_{o} / / R_{E}$ in place of $r_{o}$ to get the loaded gain

$$
\begin{equation*}
\frac{v_{o}}{v_{i}} \cong \frac{1}{1+1 /\left[g_{m}\left(r_{o} / / R_{E}\right)\right]} \tag{4.24}
\end{equation*}
$$

You can readily verify that the above expression can also be manipulated into a voltage-divider form as

$$
\begin{equation*}
v_{o} \cong \frac{\left(r_{o} / / R_{E}\right)}{\left(1 / g_{m}\right)+\left(r_{o} / / R_{E}\right)} v_{i} \tag{4.25}
\end{equation*}
$$

The reason for doing this is that we can visualize the voltage buffer according to Fig. 4.16. This insightful form will be used extensively as we move along.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-053.jpg?height=417&width=908&top_left_y=1609&top_left_x=206)

FIGURE 4.16 A BJT voltage follower acts as a unity-gain buffer with output resistance $1 / g_{m}$, in turn forming a voltage divider with the rest of the resistances associated with the emitter $\left(r_{0} / / R_{E}\right.$ in the present case).
(Truth be told, the output resistance of the unity-gain stage should be $r_{e}$ instead of $1 / g_{m}$; but, since $r_{e}=\alpha_{0} / g_{m}$, where $\alpha_{0}=\beta_{0} /\left(\beta_{0}+1\right) \cong 1$, we let $1 / g_{m}$ stand, if nothing else because of the similarity with FETs to be investigated in the next section.)

EXAMPLE 4.5 Let the voltage follower of Fig. 4.14 have $g_{m}=1 /(10 \Omega), r_{\pi}=2.0 \mathrm{k} \Omega, r_{o}=25 \mathrm{k} \Omega$, and $m=5$.
(a) Find $R_{i}$ and $v_{o} / v_{i}$ if net resistance external to the emitter is $R_{E}=\infty$.
(b) Repeat, if the circuit drives a $3.0-\mathrm{k} \Omega$ load and the biasing sink has a $50-\mathrm{k} \Omega$ parallel resistance.
(c) Repeat part (b) if the $v_{i}$ source has a series resistance $R_{B}=30 \mathrm{k} \Omega$.

### Solution

(a) The BJT has $\beta_{0}=g_{m} r_{\pi}=(1 / 10) 2000=200$. For $R_{E}=\infty$ we have, by Eqs. (4.20) and (4.22),

$$
\begin{aligned}
& R_{i} \cong \frac{5}{5+1} 200 \times 25 \cong 4.2 \mathrm{M} \Omega \\
& a_{o c}=\frac{1}{1+1 /(25 / 0.01)}=\frac{1}{1+1 / 2500}=0.9996 \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

(b) We now have $R_{E}=50 / / 3=2.83 \mathrm{k} \Omega$ and $r_{o} / / R_{E}=25 / / 2.83=2.54 \mathrm{k} \Omega$. By inspection,

$$
\begin{aligned}
R_{i} & =r_{\mu} / /\left[r_{\pi}+\left(\beta_{0}+1\right)\left(r_{o} / / R_{E}\right)\right]=(5 \times 200 \times 25) / /(2+201 \times 2.54) \\
& =(25,000 / / 512)=502 \mathrm{k} \Omega
\end{aligned}
$$

indicating that $r_{\mu}$ now has a negligible effect and we could have ignored it. Finally, Eq. (4.24) gives

$$
\frac{v_{o}}{v_{i}}=\frac{1}{1+1 /(2.54 / 0.010)}=\frac{1}{1+1 / 254} \cong 0.996 \mathrm{~V} / \mathrm{V}
$$

(c) Here is an example where the viewpoint of Fig. 4.16 comes in handy. We can still apply the voltage-divider formula, but after reflecting $R_{B}$ to the emitter, where it will appear in series with the $1 / g_{m}$ resistance. The reflected value is $R_{B} /\left(\beta_{0}+1\right)=30 / 201=149 \Omega$, so Eq. (4.25) gives

$$
\frac{v_{o}}{v_{i}}=\frac{2.54}{0.149+0.010+2.54}=0.941 \mathrm{~V} / \mathrm{V}
$$

### The CB Configuration with an Idealized Active Load

Thanks to its high output resistance, the CB configuration finds application not only as a current buffer, but also as a voltage amplifier with high unloaded gain. Consider the monolithic rendition of Fig. 4.17, which uses the source $I_{L O A D}$ as an active load, and the source $V_{B I A S}$ to bias the BJT (as usual, we assume that $V_{B I A S}$ has been adjusted so as to bias the collector well within the linear region of operation). We wish to find the unloaded or open-circuit voltage gain $a_{o c}$ as well as $R_{i}$ and $R_{o}$. To this end, refer
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-055.jpg?height=602&width=727&top_left_y=218&top_left_x=205)

FIGURE 4.17 The CB configuration as a high-gain voltage amplifier, and its ac characteristics for $r_{\mu}=\infty$.
to the ac equivalent of Fig. 4.18 in the limit $R_{C} \rightarrow \infty$ (for the time being assume also $r_{\mu}=\infty$ ). Noting that $v_{\pi}=-v_{i}$, we relabel and reorient the dependent source to effect the circuit transformation shown. It is apparent that the $g_{m} v_{\pi}$ current circulates entirely in $r_{o}$, so we apply KVL and Ohm's law to write $v_{o}=v_{i}+r_{o} g_{m} v_{i}=\left(1+g_{m} r_{o}\right) v_{i}$. Taking the ratio $v_{o} / v_{i}$ we get

$$
\begin{equation*}
a_{o c}=\lim _{R_{c} \rightarrow \infty} \frac{v_{o}}{v_{i}}=1+g_{m} r_{o} \tag{4.26}
\end{equation*}
$$

It is interesting to observe that the product $g_{m} r_{o}$ appears in the expressions for $a_{o c}$ for each of the three basic BJT configurations, as per Eqs. (4.17), (4.22), and (4.26). As we know, $g_{m} r_{o}\left(=V_{A} / V_{T}\right)$ is a fairly large number that depends only on physical properties of the BJT, regardless of the biasing conditions. We can easily say that this number represents a figure of merit of a BJT in monolithic design.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-055.jpg?height=505&width=1505&top_left_y=1626&top_left_x=130)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-056.jpg?height=498&width=807&top_left_y=169&top_left_x=376)

FIGURE 4.19 Illustrating the resistance-transformation properties of the CB configuration.
With the collector acting as an open ac circuit, the resistance seen by the input source is simply

$$
\begin{equation*}
R_{i}=r_{\pi} \tag{4.27}
\end{equation*}
$$

Comparing to the case $R_{C} \rightarrow 0$, for which the familiar expression $R_{i}=r_{e} / / r_{o} \cong r_{e}$ holds, one may find Eq. (4.27) surprising. Again, because of the ac open-circuited collector, the current supplied by the $v_{i}$ source flows entirely in $r_{\pi}$. This is another significant difference between monolithic (high $R_{C}$ ) and discrete (low $R_{C}$ ) design! Finally, to find the output resistance, we let $v_{i} \rightarrow 0$ and write, by inspection

$$
\begin{equation*}
R_{o}=r_{o} \tag{4.28}
\end{equation*}
$$

In actual application the amplifier is likely to drive some finite load resistance, and the $I_{L O A D}$ source is likely to exhibit some finite parallel resistance. Moreover, $r_{\mu} \neq \infty$. Lumping all these resistances together and denoting the result as $R_{C}$, we find the loaded gain via the voltage divider formula,

$$
\begin{equation*}
\frac{v_{o}}{v_{i}} \cong a_{o c} \times \frac{R_{C}}{r_{o}+R_{C}} \tag{4.29}
\end{equation*}
$$

The CB configuration is widely used in monolithic design both because of its potentially high unloaded voltage gain and because of its resistance-transformation abilities. (We will soon see an example in the cascode configuration.) Adapting Eqs. (4.10) and (4.13) with $R_{B}=0$, we readily find the expressions tabulated in Fig. 4.19, which you are urged to keep in mind as we shall refer to them often.

EXAMPLE 4.6 Let the BJT of Fig. 4.17 have $g_{m}=1 /(50 \Omega), \beta_{0}=150$, and $r_{o}=120 \mathrm{k} \Omega$.
(a) Assuming $r_{\mu}=\infty$, find $R_{i}, R_{o}$, and $v_{o} / v_{i}$ in the limit $R_{C} \rightarrow \infty$.
(b) Repeat, if the circuit drives an external load of $1 \mathrm{M} \Omega$.
(c) Investigate the effect of taking into account $r_{\mu}=m \beta_{0} r_{o}, m=5$.

### Solution

(a) By Eqs. (4.26) through (4.28) we have

$$
R_{i}=150 \times 50=7.5 \mathrm{k} \Omega \quad R_{o}=120 \mathrm{k} \Omega \quad a_{o c}=1+\frac{120}{0.05}=2401 \mathrm{~V} / \mathrm{V}
$$

(b) $R_{o}$ remains the same. However, the input resistance and gain drop. Using the expression for $R_{i}$ tabulated in Fig. 4.19, along with Eq. (4.29), we find

$$
R_{i} \cong 50 \frac{0.12+1}{0.12+1 / 151} \cong 442 \Omega \quad \frac{v_{o}}{v_{i}}=2401 \frac{1}{0.12+1} \cong 2144 \mathrm{~V} / \mathrm{V}
$$

(c) We have $r_{\mu}=5 \times 150 \times 120=90 \mathrm{M} \Omega$, so the parameters of part (a) change to

$$
R_{i} \cong 50 \frac{0.12+90}{0.12+90 / 151} \cong 6.29 \mathrm{k} \Omega \quad \frac{v_{o}}{v_{i}}=2401 \frac{90}{0.12+90} \cong 2398 \mathrm{~V} / \mathrm{V}
$$

Similarly, we recalculate the parameters of part (b), but using (90//1) $\mathrm{M} \Omega$ instead of $1 \mathrm{M} \Omega$. The difference is on the order of $1 \%$, indicating that $r_{\mu}$ plays a negligible role in this example.

### Exercise 4.3

The voltage gain $a=v_{c} / v_{e}$ of the CB configuration may lie anywhere over the range $g_{m} R_{C} \leq a \leq 1+g_{m} r_{o}$, depending on how $R_{C}$ compares with $r_{o}$. The lower extreme is reached in the limit $R_{C} \ll r_{o}$, typical of discrete designs, whereas the upper extreme is reached in the limit $R_{C} \gg r_{o}$, typical of monolithic designs. Let us arbitrarily define the discrete design range as the range $R_{C} \leq R_{C(\max )}$ over which $a$ departs from its lower extreme by no more than $10 \%$, and the monolithic design range as the range $R_{C} \geq R_{C(\min )}$ over which a departs from its upper extreme by no more than $10 \%$.
a. Estimate $R_{C(\max )}$ and $R_{C(\min )}$ for a BJT with $\beta_{0}=100$ and $V_{A}=100 \mathrm{~V}$ at $I_{C}=1 \mathrm{~mA}$.
b. What are the values of $R_{e}$ at the lower and upper extremes?
c. What are the values of $R_{e}$ at $R_{C}=R_{C(\max )}$ and at $R_{C}=R_{C(\min )}$ ?

Ans: (a) $R_{C(\max )} \cong 11 \mathrm{k} \Omega, R_{C(\min )} \cong 900 \mathrm{k} \Omega$. (b) $26 \Omega, 2.6 \mathrm{k} \Omega$. (c) $28.8 \Omega, 239 \Omega$

## 4.3 MOSFET CHARACTERISTICS AND MODELS REVISITED

The MOSFET models and analytical methodologies of Chapter 3 were deliberately kept as simple as possible so we could focus on the very basics. As we embark upon the study of monolithic circuits, we need to suitably refine models and techniques to include higher-order effects that tend to play a more prominent role in monolithic design.

### The Role of $\boldsymbol{\lambda}$ in Dc Calculations

Recall from Chapter 3 that the dc current of a saturated $n$ MOSFET is

$$
\begin{equation*}
I_{D}=\frac{1}{2} k^{\prime} \frac{W}{L} V_{O V}^{2}\left(1+\lambda V_{D S}\right) \tag{4.30}
\end{equation*}
$$

where $\lambda$ is the channel-length modulation parameter, a device parameter typically on the order of 0.01 to $0.1 \mathrm{~V}^{-1}$. As we know, this type of modulation stems from the portion of the drain-body SCL extending into the channel. Its width $\left(x_{p}\right.$ for the $n$ MOSFET, $x_{n}$ for the $p$ MOSFET) depends on doping levels as well as on junction bias, as per Eqs. (1.40) and (1.45). As we know, the shorter the channel the more pronounced the effect of channel-length modulation in Eq. (4.30). IC designers relate $\lambda$ to $L$ as

$$
\begin{equation*}
\lambda=\frac{\lambda^{\prime}}{L} \tag{4.31}
\end{equation*}
$$

where $\lambda^{\prime}$ (in $\mu \mathrm{m} / \mathrm{V}$ ) is a process parameter, and $L$ (in $\mu \mathrm{m}$ ) is the channel length. Typically, $\lambda^{\prime}$ ranges from 0.02 to $0.2 \mu \mathrm{~m} / \mathrm{V}$. An IC designer will specify $L$ to achieve a given $\lambda$, and $W$ to achieve a given $k, k=k^{\prime}(W / L)$. Note that this flexibility is not available in bipolar IC design!

As long as $\lambda V_{D S} \ll 1$ we ignore the term $\lambda V_{D S}$ in Eq. (4.30) to simplify dc calculations. However, in monolithic circuits this may no longer be acceptable. An example will give a better idea.

EXAMPLE 4.7 Let the diode-connected FET of Fig. 4.20 have $V_{t}=1.0 \mathrm{~V}, k^{\prime}=100 \mu \mathrm{~A} / \mathrm{V}^{2}$, and $\lambda^{\prime}=0.2 \mu \mathrm{~m} / \mathrm{V}$.
(a) Find $W$ and $L$ to achieve $\lambda=0.1 \mathrm{~V}^{-1}$ and $k=0.5 \mathrm{~mA} / \mathrm{V}^{2}$.
(b) If $I=1.0 \mathrm{~mA}$, find $V$ assuming $\lambda=0$ to simplify dc calculations.
(c) Refine your calculation of part (b), but with $\lambda=0.1 \mathrm{~V}^{-1}$.
(d) How would you adjust $I$ to retain the value of $V$ found in part (b)?
(e) How would you alter the $W / L$ ratio to retain the values of $I$ and $V$ of part (b) without changing $\lambda$ ?
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-058.jpg?height=205&width=285&top_left_y=1485&top_left_x=454)

FIGURE 4.20 Circuit of Example 4.7.

### Solution

(a) We need $L=\lambda^{\prime} / \lambda=0.2 / 0.1=2 \mu m$, and $W / L=k / k^{\prime}=0.5 / 0.1=5$. So, $W=5 L=10 \mu \mathrm{~m}$.
(b) We have $V_{O V}=\sqrt{2 I_{D} / k}=\sqrt{2 \times 1 / 0.5}=2 \mathrm{~V}$, and $V=V_{t}+V_{O V}=1.0+$ $2.0=3.0 \mathrm{~V}$.
(c) We now have

$$
1 \mathrm{~mA}=\frac{0.5 \mathrm{~mA}}{2}(V-1.0)^{2} \times(1+0.1 \times V)
$$

Taking the square root of both sides and solving for the linear term in $V$ we get

$$
V=1.0+\frac{2}{\sqrt{1+0.1 \times V}}
$$

Starting out with the estimate $V=3.0 \mathrm{~V}$ and iterating, we find $V=2.77 \mathrm{~V}$ ( $<3.0 \mathrm{~V}$ because of $\lambda$ ).
(d) $I=(1 \mathrm{~mA}) \times(1+0.1 \times 3.0)=1.3 \mathrm{~mA}(>1 \mathrm{~mA}$ because of $\lambda)$.
(e) To lower $I$ from 1.3 mA to 1.0 mA while retaining $V=3.0 \mathrm{~V}$ we need to reduce the $W / L$ ratio in proportion. So, $(W / L)_{\text {new }}=(W / L)_{\text {old }} \times(1.0 / 1.3)=$ $5 \times 0.77=3.85$. To retain the same $\lambda$, keep $L_{\text {new }}=L_{\text {old }} \cdot S$, we need $W_{\text {new }}=$ $W_{\text {old }} \times 0.77=7.7 \mu \mathrm{~m}$.

### The Body Transconductance

In Chapter 3 we assumed MOSFETs with the body and source terminals tied together. This freed us from having to worry about the body effect so we could focus on the very basics of MOSFET behavior. In monolithic circuits different FETs share the same tub or body. The body common to all $n$ MOSFETs is tied to the most negative voltage (MNV) in the circuit in order to avoid the inadvertent turn-on of the diode formed by the $p$-type body and the $n$-type source. Likewise, the body common to all $p$ MOSFETs is tied to the most positive voltage (MPV). In the case of a saturated $n$ MOSFET whose source is allowed to attain a different potential than the body, the drain current takes on the more general form

$$
\begin{equation*}
i_{D}=\frac{k}{2}\left[v_{G S}-v_{t}\left(v_{S B}\right)\right]^{2}\left(1+\lambda v_{D S}\right) \tag{4.32}
\end{equation*}
$$

showing explicitly that the threshold voltage $v_{t}$ is a function of the source-to-body voltage $v_{S B}(\geq 0)$. This dependence takes on the form of Eq. (3.8), repeated here for convenience

$$
\begin{equation*}
v_{t}\left(v_{S B}\right)=V_{t 0}+\gamma\left[\sqrt{v_{S B}+2\left|\phi_{p}\right|}-\sqrt{2\left|\phi_{p}\right|}\right] \tag{4.33}
\end{equation*}
$$

where

$$
\begin{equation*}
\gamma=\frac{\sqrt{2 q N_{A} \varepsilon_{s i}}}{C_{o x}} \tag{4.34}
\end{equation*}
$$

For a $p$ MOSFET Eq. (4.33) takes on the form $v_{t}\left(v_{B S}\right)=V_{t 0}-\gamma\left[\sqrt{v_{B S}+2 \phi_{n}}-\sqrt{2 \phi_{n}}\right]$, where $\gamma$ is still found via Eq. (4.34), but with $N_{A}$ replaced by $N_{D}$. It is apparent that FETs operating with $v_{B}=v_{S}$ will also have $v_{t}=V_{t 0}$. However, FETs with $v_{S} \neq v_{B}$ will have $v_{t} \neq V_{t 0}$, a phenomenon referred to as the body effect. Since $v_{S B}$ (or $v_{S B}$ for a $p$ MOSFET) affects $i_{D}$, the body acts as a second gate, though with a lesser impact upon $i_{D}$ than the gate proper because of the presence of the square root function in Eq. (4.33). For this reason the body is also referred to as the back gate.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-060.jpg?height=464&width=1525&top_left_y=214&top_left_x=111)

FIGURE 4.21 Small-signal MOSFET model with the source $g_{m b} v_{b s}$ stemming from the body effect.

Just like we use the dependent source $g_{m} \nu_{g s}$ to model the effect of a small-signal change in the gate voltage relative to that of the source, we use an additional dependent source $g_{m b} v_{b s}$ to model the effect of a small-signal change in the back-gate voltage relative to that of the source. This results in the small-signal model of Fig. 4.21, where $g_{m b}$, aptly called the body transconductance, is defined as

$$
\begin{equation*}
g_{m b}=\left.\frac{\partial i_{D}}{\partial v_{B S}}\right|_{V_{G S} V_{D S}} \tag{4.35}
\end{equation*}
$$

with $v_{G S}$ and $v_{D S}$ held constant. (Conversely, the ordinary transconductance is defined as $g_{m}=\partial i_{D} / \partial v_{G S}$ with $v_{B S}$ and $v_{D S}$ held constant.) Differentiation of Eq. (4.32) with respect to $v_{B S}\left(=-v_{S B}\right)$ gives

$$
\begin{aligned}
g_{m b} & =\frac{\partial i_{D}}{\partial\left(-v_{S B}\right)}=-\frac{\partial i_{D}}{\partial v_{S B}}=-k\left[v_{G S}-v_{t}\left(v_{S B}\right)\right]\left(1+\lambda v_{D S}\right)\left(-\frac{\partial v_{t}}{\partial v_{S B}}\right) \\
& =g_{m}\left(1+\lambda v_{D S}\right) \frac{\gamma}{2 \sqrt{v_{S B}+2\left|\phi_{p}\right|}}
\end{aligned}
$$

where we have used the fact that $k\left[v_{G S}-v_{t}\left(v_{S B}\right)\right]=g_{m}$. For $\lambda v_{D S} \ll 1$ we can write

$$
\begin{equation*}
g_{m b}=\chi g_{m} \tag{4.36}
\end{equation*}
$$

where

$$
\begin{equation*}
\chi=\frac{\gamma}{2 \sqrt{v_{S B}+2\left|\phi_{p}\right|}} \tag{4.37}
\end{equation*}
$$

The proportionality constant $\chi$ depends on process parameters as well as on $v_{S B}$ (or $v_{B S}$ for the $p$ MOSFET case), and is typically on the order of 0.1 to 0.3 . Note that since the MNV (or MPV for the $p$ MOSFET) is usually of the dc type, the body is shown at ac ground in Fig. 4.21.

Let the FET of Fig. 4.22 have $V_{t 0}=1.0 \mathrm{~V}, k=0.5 \mathrm{~mA} / \mathrm{V}^{2}, \lambda=1 /(40 \mathrm{~V}),\left|2 \phi_{p}\right|=$ 0.6 V , and $\gamma=0.445 \mathrm{~V}^{1 / 2}$. If $V_{D D}=9.0 \mathrm{~V}$, specify suitable resistances to bias the FET at $I_{D}=1 \mathrm{~mA}$ according to the $1 / 3-1 / 3-1 / 3$ Rule (to simplify dc calculations, assume $\lambda=0$ ). Hence, calculate the small-signal parameters.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-061.jpg?height=515&width=368&top_left_y=456&top_left_x=241)

FIGURE 4.22 Circuit of Example 4.8

### Solution

We have $V_{S}=(1 / 3) 9=3 \mathrm{~V}$, so $R_{D}=R_{S}=3 / 1=3 \mathrm{k} \Omega$. Clearly, $V_{S B}=3 \mathrm{~V}$, so Eqs. (4.33) and (4.37) give

$$
V_{t}=1.0+0.445[\sqrt{3+0.6}-\sqrt{0.6}]=1.5 \mathrm{~V} \quad \chi=\frac{0.445}{2 \sqrt{3+0.6}}=0.117
$$

Also, $V_{O V}=\left(2 I_{D} / k\right)^{1 / 2}=(2 \times 1 / 0.5)^{1 / 2}=2 \mathrm{~V}$, so $V_{G}=V_{S}+V_{t}+V_{O V}=3+1.5+$ $2=6.5 \mathrm{~V}$. We need a resistance pair such that $R_{1} / R_{2}=2.5 / 6.5=1 / 2.6$. Use $R_{1}=$ $1.0 \mathrm{M} \Omega$ and $R_{2}=2.6 \mathrm{M} \Omega$. Finally, the FET's small-signal parameters are

$$
\begin{aligned}
g_{m} & =(2 \times 0.5 \times 1)^{1 / 2}=1.0 \mathrm{~mA} / \mathrm{V} \\
g_{m b} & =0.117 \times 1=0.117 \mathrm{~mA} / \mathrm{V} \\
r_{o} & =40 / 1=40 \mathrm{k} \Omega
\end{aligned}
$$

### A Generalized Ac Circuit

We now wish to investigate how the presence of the $g_{m b} v_{b s}$ source affects the various parameters in the generalized ac circuit of Fig. 4.23. We anticipate that except for the CS configuration, for which $v_{b s}=0$, all other configurations will be sensitive to the body effect.

- The Transconductance $\boldsymbol{G}_{\boldsymbol{m}}=\boldsymbol{i}_{d} / \boldsymbol{v}_{g}$. With reference to the small-signal equivalent of Fig. $4.24 a$ we observe that $v_{b s}=-v_{s}$, so we can reverse the direction of the $g_{m b} v_{b s}$ source and relabel it as $g_{m b} v_{s}$. This is depicted in Fig. 4.24b. Applying KCL at the drain node we get

$$
i_{d}+g_{m b} v_{s}=g_{m}\left(v_{g}-v_{s}\right)+\frac{v_{d}-v_{s}}{r_{o}}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-062.jpg?height=769&width=1097&top_left_y=170&top_left_x=452)

FIGURE 4.23 Summary of small-signal gains and terminal resistances for a MOSFET.

Since $i_{d}$ enters the drain and exits the source, we have, by Ohm's law, $v_{s}=R_{S} i_{d}$ and $v_{d}=-R_{D} i_{d}$. Substituting in the above expression and collecting we get the circuit's transconductance

$$
\begin{equation*}
G_{m}=\frac{i_{d}}{v_{g}}=\frac{g_{m}}{1+\left(g_{m}+g_{m b}\right) R_{S}+\left(R_{D}+R_{S}\right) / r_{o}} \tag{4.38}
\end{equation*}
$$

This is similar to the expression tabulated in Fig. 3.50, except for the denominator term increase from $g_{m} R_{S}$ to $\left(g_{m}+g_{m b}\right) R_{S}$. By Eq. (4.36) this represents a percentage increase of $100 \chi$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-062.jpg?height=513&width=1539&top_left_y=1519&top_left_x=109)

FIGURE 4.24 (a) Small-signal equivalent of the generalized ac circuit of Fig. 4.22. (b) The circuit of (a) after suitable transformation.

- The Voltage Gains $\boldsymbol{v}_{s} / \boldsymbol{v}_{g}$ and $\boldsymbol{v}_{d} / \boldsymbol{v}_{g}$. We also have $v_{s}=R_{S} i_{d}=R_{s} G_{m} v_{g}$ and $v_{d}=$ $-R_{D} i_{d}=-R_{D} G_{m} v_{g}$, so the small-signal voltage gains from $v_{g}$ to $v_{s}$ and from $v_{g}$ to $v_{d}$ are, respectively

$$
\begin{align*}
& \frac{v_{d}}{v_{g}}=\frac{-g_{m} R_{D}}{1+\left(g_{m}+g_{m b}\right) R_{S}+\left(R_{D}+R_{S}\right) / r_{o}}  \tag{4.39a}\\
& \frac{v_{s}}{v_{g}}=\frac{g_{m} R_{S}}{1+\left(g_{m}+g_{m b}\right) R_{S}+\left(R_{D}+R_{S}\right) / r_{o}} \tag{4.39b}
\end{align*}
$$

Note again the denominator term increase from $g_{m} R_{S}$ to $\left(g_{m}+g_{m b}\right) R_{S}$.

- The Resistance $\boldsymbol{R}_{s}$ Seen Looking into the Source. To find this resistance we let $v_{g} \rightarrow 0$ and we subject the source terminal to a test voltage $v_{s}$. But, with $v_{g}=0$ we get $v_{g s}=v_{g}-v_{s}=0-v_{s}=-v_{s}$, so now we can reverse and relabel also the $g_{m} v_{g s}$ source, as in Fig. 4.25a. By KCL we have

$$
i_{s}=g_{m} v_{s}+g_{m b} v_{s}+\frac{v_{s}-v_{d}}{r_{o}}=\left(g_{m}+g_{m b}\right) v_{s}+\frac{v_{s}-R_{D} i_{s}}{r_{o}}
$$

Collecting and taking the ratio $R_{s}=v_{s} / i_{s}$ gives, after some algebra,

$$
\begin{equation*}
R_{s}=\left(\frac{1}{g_{m}+g_{m b}} / / r_{o}\right)+\frac{R_{D}}{1+\left(g_{m}+g_{m b}\right) r_{o}} \tag{4.40a}
\end{equation*}
$$

Typically $1 /\left(g_{m}+g_{m b}\right) \ll r_{o}$, so the above expression simplifies to

$$
\begin{equation*}
R_{s} \cong \frac{1}{g_{m}+g_{m b}}+\frac{R_{D}}{1+\left(g_{m}+g_{m b}\right) r_{o}} \tag{4.40b}
\end{equation*}
$$

The first term is similar to that of discrete designs, except for the change from $g_{m}$ to $g_{m}+g_{m b}$. The second term represents the effect of the external drain resistance $R_{D}$ reflected to the source. This term is usually ignored in discrete designs, but not necessarily in monolithic designs, where the drain may be terminated on a current source and therefore $R_{D}$ may be quite large.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-063.jpg?height=489&width=1530&top_left_y=1552&top_left_x=184)

FIGURE 4.25 Test circuits to find (a) the small-signal resistance $R_{s}$ seen looking into the source and (b) the small-signal resistance $R_{d}$ seen looking into the drain.

- The Resistance $\boldsymbol{R}_{d}$ Seen Looking into the Drain. To find this resistance we let $v_{g} \rightarrow 0$ and we subject the drain to a test voltage $v_{d}$. But, with $v_{g}=0$ we again get $v_{g s}=-v_{s}$, so we again reverse and relabel both dependent sources as in Fig. 4.25b. By KCL,

$$
i_{d}+g_{m} v_{s}+g_{m b} v_{s}=\frac{v_{d}-v_{s}}{r_{o}}
$$

Substituting $v_{s}=R_{S} i_{d}$, collecting, and taking the ratio $R_{d}=v_{d} / i_{d}$, we get

$$
\begin{equation*}
R_{d}=r_{o}+\left[1+\left(g_{m}+g_{m b}\right) r_{o}\right] R_{S} \tag{4.41}
\end{equation*}
$$

The first component is just the FET's internal resistance $r_{o}$, while the second component represents the effect of the external source resistance $R_{S}$ reflected to the drain. It is interesting to contrast the effects of the MOSFET upon its external resistances: while $R_{D}$ reflected to the source gets divided by the amount $1+\left(g_{m}+\right.$ $\left.g_{m b}\right) r_{o}, R_{S}$ reflected to the drain gets multiplied by the same amount. We shall have more to say about these symmetric actions when studying cascode configurations.

As mentioned, a monolithic MOSFET amplifier is likely to be biased or to be loaded by another FET operating as a current source or sink, so it is instructive to reexamine the basic FET configurations from the IC design viewpoint. We first investigate the limiting case of ideal current sources/sinks, then we adapt our results to the case of non-ideal sources/sinks, and in the presence of an output load.

### The CS Configuration with an Idealized Active Load

Recall that the common-source (CS) configuration (with or without source degeneration) is best suited to voltage amplification. The monolithic rendition of Fig. 4.26 uses the current source $I_{L O A D}$ as an active load, and the voltage source $V_{B A A S}$ to bias the FET. We assume that $V_{B A S}$ has been adjusted so as to ensure that the drain is biased at a voltage well within the linear region of operation. The amplifier's characteristics are readily obtained by adapting the expressions of Fig. 4.23 in the limit $R_{D} \rightarrow \infty$. The results are tabulated in Fig. 4.26 both for the CS-SD case $\left(R_{S} \neq 0\right)$, and the plain CS case $\left(R_{S}=0\right)$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-064.jpg?height=543&width=1185&top_left_y=1499&top_left_x=450)

FIGURE 4.26 Voltage amplifier with a current-source load and summary of its small-signal characteristics.

The voltage gain achieved in the limit $R_{D} \rightarrow \infty$ is $v_{o} / v_{i}=-g_{m} r_{o}$. Aptly called the unloaded or also the open-circuit voltage gain, this is the maximum voltage gain attainable with the CS configuration and for this reason it is also called the intrinsic gain $a_{\text {intrinsic }}$. It is interesting that this gain is unaffected by the presence of $R_{S}$. This is so because with an ideal current-source load the drain is an ac open circuit giving $i_{d}=0 . \mathrm{So}, i_{s}=0$ and $v_{s}=R_{S} i_{s}=0$, indicating that neither $R_{S}$ nor $g_{m b}$ intervene in the expression for the gain in this case. (However, they do intervene in the expression for $R_{o}$ in the CS-SD case.)

In actual application a CS amplifier is likely to drive some finite load resistance, and the $I_{L O A D}$ source is likely to exhibit some finite parallel resistance. Lumping these resistances together and denoting their combination as $R_{D}$, we adapt Eq. (4.39) to find the loaded gain as

$$
\begin{equation*}
\frac{v_{o}}{v_{i}}=\frac{-g_{m} R_{D}}{1+\left(g_{m}+g_{m b}\right) R_{S}+\left(R_{D}+R_{S}\right) / r_{o}} \tag{4.42}
\end{equation*}
$$

Suppose the FET of Fig. 4.26 has $g_{m}=1 \mathrm{~mA} / \mathrm{V}^{2}, r_{o}=50 \mathrm{k} \Omega$, and $\chi=0.15$. Find $R_{o}$ and $v_{o} / v_{i} \mathrm{if:}$
(a) $R_{S}=0$ and $R_{D}=\infty$.
(b) $R_{S}=0$ and $R_{D}=100 \mathrm{k} \Omega$.
(c) $R_{S}=2.0 \mathrm{k} \Omega$ and $R_{D}=\infty$.
(d) $R_{S}=2.0 \mathrm{k} \Omega$ and $R_{D}=100 \mathrm{k} \Omega$. Comment on your results at each step.

### Solution

(a) With $R_{S}=0$ and $R_{D}=\infty$ the FET amplifies by its intrinsic gain and we have

$$
R_{o}=r_{o}=50 \mathrm{k} \Omega \quad a_{\text {intrinsic }}=-g_{m} r_{o}=-1 \times 50=-50 \mathrm{~V} / \mathrm{V}
$$

(b) With $R_{S}=0$ we still have $R_{o}=50 \mathrm{k} \Omega$. With $R_{D}=100 \mathrm{k} \Omega$, the loaded gain is, by Eq. (4.42),

$$
\frac{v_{o}}{v_{i}}=\frac{-1 \times 100}{1+100 / 50}=-33.3 \mathrm{~V} / \mathrm{V}
$$

(c) With source degeneration we expect $R_{o}$ to increase. However, so long as $R_{D}=\infty$, gain is unaffected by $R_{S}$.

$$
\begin{aligned}
& R_{o}=r_{o}+\left[1+\left(g_{m}+g_{m b}\right) r_{o}\right] R_{S}=50+[1+(1+0.15 \times 1) 50] 2=167 \mathrm{k} \Omega \\
& \frac{v_{o}}{v_{i}}=-50 \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

(d) The resistance seen by $R_{D}$ is still $167 \mathrm{k} \Omega$. However, by Eq. (4.42), gain drops to

$$
\frac{v_{o}}{v_{i}}=\frac{-1 \times 100}{1+1 \times 1.15 \times 2+(100+2) / 50}=18.7 \mathrm{~V} / \mathrm{V}
$$

Combining familiar expressions for $g_{m}$ and $r_{o}$ we can put the intrinsic gain in the alternative form

$$
\begin{equation*}
a_{\text {intrinsic }}=-\frac{1}{\lambda} \sqrt{\frac{2 k}{I_{D}}} \tag{4.43}
\end{equation*}
$$

Unlike the BJT's intrinsic gain of Eq. (4.17), which is bias-independent, that of the FET is inversely proportional to $\sqrt{I_{D}}$, indicating that lowering $I_{D}$ increases $a_{\text {intrinsic }}$. This is certainly desirable in low-power IC design. However, two observations are in order. First, Eq. (4.43) is a result of the quadratic characteristic of the MOSFET. At sufficiently low operating currents the FET enters the sub-threshold region where its characteristic changes from quadratic to exponential. Consequently, at low currents the intrinsic gain of the MOSFET becomes bias-independent, just like in the case of the BJT. Second, low operating currents reduce a circuit's ability to drive capacitive loads, resulting in slower operation and thus reduced frequency bandwidth (more on this in Chapter 6).

### EXAMPLE 4.10

(a) If a MOSFET gives $a_{\text {intrinsic }}=-50 \mathrm{~V} / \mathrm{V}$ at $I_{D}=1 \mathrm{~mA}$, find $a_{\text {intrinsic }}$ at $I_{D}=$ $100 \mu \mathrm{~A}$. What value of $I_{D}$ is needed for $a_{\text {intrinsic }}=-100 \mathrm{~V} / \mathrm{V}$ ?
(b) If it is found that this FET enters the sub-threshold region in the vicinity of $I_{D}=10 \mu \mathrm{~A}$, estimate its maximum intrinsic gain.

### Solution

(a) Lowering $I_{D}$ by a factor of 10 will change $a_{\text {intrinsic }}$ from $-50 \mathrm{~V} / \mathrm{V}$ to $-50 \sqrt{10}=$ $-158 \mathrm{~V} / \mathrm{V}$. In order to double $a_{\text {intrinsic }}$ from $-50 \mathrm{~V} / \mathrm{V}$ to $-100 \mathrm{~V} / \mathrm{V}$ we must lower $I_{D}$ by a factor of four, so $I_{D}=1 / 4=250 \mu \mathrm{~A}$.
(b) For $I_{D} \leq 10 \mu \mathrm{~A}$ gain will settle at $a_{\text {intrinsic(max) }}=-50 \sqrt{1000 / 10}=-500 \mathrm{~V} / \mathrm{V}$.

Writing $g_{m} r_{o}=\left(2 I_{D} / V_{O V}\right) /\left(\lambda I_{D}\right)=2 /\left(\lambda V_{O V}\right)$ we get yet another insightful form for the intrinsic gain

$$
\begin{equation*}
a_{\text {intrinsic }}=-\frac{2 L}{\lambda^{\prime} V_{O V}} \tag{4.44}
\end{equation*}
$$

where $V_{O V}$ is the overdrive voltage, $L$ the channel length, and $\lambda^{\prime}$ is the process parameter characterizing channel-length modulation, as per Eq. (4.31). This form indicates that the longer the channel for a given $V_{O V}$, the higher the intrinsic gain. This flexibility is quite convenient for the MOS IC designer!

EXAMPLE 4.11 Assuming a process with $k^{\prime}=75 \mu \mathrm{~A} / \mathrm{V}^{2}$ and $\lambda^{\prime}=0.1 \mu \mathrm{~m} / \mathrm{V}$, specify $W$ and $L$ so that at $I_{D}=100 \mu \mathrm{~A}$ and $V_{D S}=2 \mathrm{~V}$ a MOSFET provides $a_{\text {intrinsic }}=-50 \mathrm{~V} / \mathrm{V}$ with $V_{O V}=0.5 \mathrm{~V}$.

### Solution

By Eqs. (4.44) and (4.31) we have

$$
\begin{aligned}
& L=-\lambda^{\prime} \times V_{O V} \times a_{\text {intrinsic }} / 2=-0.1 \times 0.5 \times(-50) / 2=2.5 \mu \mathrm{~m} \\
& 100=\frac{1}{2} 75 \frac{\mathrm{~W}}{2.5} 0.5^{2}\left(1+\frac{0.1}{2.5} \times 2\right) .
\end{aligned}
$$

Solving we get $W=24.7 \mu \mathrm{~m}$.

### The CD Configuration with an Idealized Active Load

Recall that the common-drain (CD) configuration is best suited to voltage buffering. In monolithic realizations a FET buffer is usually biased via a current sink, so let us investigate the voltage transfer curve (VTC) of such a realization. Figure 4.27 shows a PSpice circuit to serve this purpose, along with its voltage transfer curve (VTC). The latter is shown both for the already familiar case of body and source tied together $(\gamma=0)$, and the henceforth more common case of the body tied to the most negative voltage (MNV) in the circuit, so that $(\gamma \neq 0)$. We observe that both curves are shifted downward by $v_{G S}$, namely, $v_{O}=v_{I}-v_{G S}=v_{I}-\left(V_{t}+V_{O V}\right)$. In the case $\gamma=0$ we have $V_{t}=V_{t 0}=$ constant, but in the case $\gamma \neq 0$, the body effect makes $V_{t}$ itself a function of $v_{O}$ and, hence, of $v_{I}$. We also note that the $p n$ junction formed by the body and source clamps $v_{O}$ a diode drop below $V_{S S}$ (or at about -5.6 V in the present example). Also, $v_{O}$ saturates at $V_{D D}\left(=5 \mathrm{~V}\right.$ in the present example) for $v_{I}$ high enough to drive the FET into the ohmic region.

We now wish to find the unloaded voltage gain and output resistance, as depicted in Fig. 4.28. We do this by adapting the expressions tabulated in Fig. 4.23 in the
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-067.jpg?height=581&width=1200&top_left_y=1424&top_left_x=189)

FIGURE 4.27 (a) PSpice circuit of a monolithic MOS buffer, and (b) its VTC. The MOSFET parameters are $k^{\prime}=100 \mu \mathrm{~A} / \mathrm{V}^{2}, W=10 \mu \mathrm{~m}, L=1 \mu \mathrm{~m}, V_{t 0}=0.5 \mathrm{~V}$, $\gamma=0.7 \mathrm{~V}^{1 / 2},\left|2 \phi_{\rho}\right|=0.6 \mathrm{~V}$, and $\lambda=0.05 \mathrm{~V}^{-1}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-068.jpg?height=403&width=767&top_left_y=219&top_left_x=448)

FIGURE 4.28 Voltage buffer with current-sink bias, and summary of its small-signal characteristics.
limits $R_{D} \rightarrow 0$ and $R_{S} \rightarrow \infty$. With a bit of algebra, we can put these expressions in the insightful forms

$$
\begin{equation*}
a_{o c}=\lim _{R_{s} \rightarrow \infty} \frac{v_{o}}{v_{i}}=\frac{1}{1+\chi+1 /\left(g_{m} r_{o}\right)} \quad R_{o}=\left(\frac{1}{g_{m}+g_{m b}}\right) / / / r_{o} \tag{4.45}
\end{equation*}
$$

with $\chi$ as given in Eq. (4.37). In view of the fact that $\left(g_{m}+g_{m b}\right) r_{o}>g_{m} r_{o} \gg 1$, we can simplify as

$$
\begin{equation*}
a_{o c} \cong \frac{1}{1+\chi} \quad R_{o} \cong \frac{1}{g_{m}+g_{m b}} \tag{4.46}
\end{equation*}
$$

Clearly, the effect of $g_{m b}$ is to lower both $a_{o c}$ and $R_{o}$ by about $1+\chi$ compared to the case $\gamma=0$. For instance, a voltage buffer implemented with the FET of Example 4.9 would give $a_{o c} \cong 1 /(1+0.15)=0.87 \mathrm{~V} / \mathrm{V}$ and $R_{o} \cong 1 /(1+0.15)=0.87 \mathrm{k} \Omega$.

In actual application the buffer is likely to drive some finite load resistance, and the $I_{B A S}$ current sink is likely to exhibit some finite parallel resistance. Lumping these two resistances together as a net resistance $R_{S}$, we observe that $R_{S}$ appears in parallel with $r_{o}$, so we adapt Eq. (4.45) to find the loaded gain as

$$
\begin{equation*}
\frac{v_{o}}{v_{i}}=\frac{1}{1+\chi+1 /\left[g_{m}\left(R_{S} / / r_{o}\right)\right]} \tag{4.47}
\end{equation*}
$$

We can gain additional insight by manipulating this expression into the following voltage-divider form

$$
\begin{equation*}
v_{o}=\frac{\left(1 / g_{m b}\right) / / R_{S} / / r_{o}}{1 / g_{m}+\left[\left(1 / g_{m b}\right) / / R_{S} / / r_{o}\right]} v_{i} \tag{4.48}
\end{equation*}
$$

which allows us to visualize the voltage buffer more intuitively as in Fig. 4.29. Note the similarity to the bipolar counterpart of Fig. 4.16, aside from the $1 / g_{m b}$ resistance, which is absent in the bipolar version.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-069.jpg?height=412&width=1086&top_left_y=170&top_left_x=206)

FIGURE 4.29 A FET voltage buffer acts as a unity-gain buffer with output resistance $1 / g_{m}$, in turn forming a voltage divider with the rest of the resistances associated with the source terminal, or $\left(1 / g_{m b}\right) / / r_{o} / / R_{S}$.
(a) Let the FET of Fig. 4.28 have $V_{t 0}=0.5 \mathrm{~V}, k=2 \mathrm{~mA} / \mathrm{V}^{2}, \lambda=0.025 \mathrm{~V}^{-1}$, $\left|2 \phi_{p}\right|=0.6 \mathrm{~V}$, and $\gamma=0.4 \mathrm{~V}^{1 / 2}$. (a) If $V_{D D}=-V_{S S}=5.0 \mathrm{~V}$ and $I_{B A A S}=1 \mathrm{~mA}$, find the output voltage $V_{O}$ corresponding to the input voltage $V_{I}=0$.
(b) Estimate $a_{o c}$ and $R_{o}$.
(c) Find the gain if the circuit drives a $10-\mathrm{k} \Omega$ load.

### Solution

(a) To sustain $I_{D}=1 \mathrm{~mA}$ the FET needs $V_{O V}=\sqrt{2 \times 1 / 2}=1 \mathrm{~V}$. As a firstestimate, let $V_{O(0)}=-\left(V_{t 0}+V_{O V}\right)=-(0.5+1)=-1.5 \mathrm{~V}$, so $V_{S B(0)}=-1.5-(-5)=3.5 \mathrm{~V}$. Then, $V_{t(1)}=0.5+0.4(\sqrt{3.5+0.6}-\sqrt{0.6})=1.0 \mathrm{~V}$, by Eq. (4.33). So a better estimate is $V_{O(1)}=-\left(V_{t(1)}+V_{O V}\right)=-(1+1)=-2 \mathrm{~V}$. This corresponds to $V_{S B(1)}=3 \mathrm{~V}$, so we iterate to find $V_{t(2)}=0.95 \mathrm{~V}$ and get yet a better estimate as $V_{O(2)}=-1.95 \mathrm{~V}$. One more iteration with $V_{S B(2)}=3.05 \mathrm{~V}$ yields a negligible change, so we conclude that with $V_{I}=0$ the circuit gives

$$
V_{o} \cong-1.95 \mathrm{~V}
$$

(b) We have $g_{m}=\sqrt{2 \times 2 \times 1}=2 \mathrm{~mA} / \mathrm{V}$ and $r_{o}=1 /\left(\lambda I_{D}\right)=1 /(0.025 \times 1)=$ $40 \mathrm{k} \Omega$. Also, Eq. (4.37) gives $\chi=0.4 /(2 \sqrt{3.05}+0.6)=0.105$. Consequently, use Eq. (4.46) to get

$$
a_{o c} \cong \frac{1}{1+0.105}=0.905 \mathrm{~V} / \mathrm{V} \quad R_{o} \cong \frac{1}{2(1+0.105)}=0.452 \mathrm{k} \Omega
$$

(Using the exact expressions of Eq. (4.45) we find $a_{o c}=0.895 \mathrm{~V} / \mathrm{V}$ and $R_{o}=0.447 \mathrm{k} \Omega$, hardly worth the extra computational effort.)
(c) We have $1 / g_{m}=1 / 2=0.5 \mathrm{k} \Omega$ and $1 / g_{m b}=1 /(0.105 \times 2)=4.76 \mathrm{k} \Omega$. Using Eq. (4.48) we get

$$
\frac{v_{o}}{v_{i}}=\frac{4.76 / / 10 / / 40}{0.5+4.76 / / 10 / / 40}=0.835 \mathrm{~V} / \mathrm{V}
$$

### The Active-Loaded CG Configuration as a Voltage Amplifier

The inherently high output resistance of the common-gate (CG) configuration makes it suited not only to current buffering, as we already know, but also to high-gain voltage amplification. To investigate this alternative aspect, refer to the monolithic
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-070.jpg?height=801&width=790&top_left_y=210&top_left_x=432)

FIGURE 4.30 The CG configuration as a high-gain voltage amplifier, and summary of its ac characteristrics.
rendition of Fig. 4.30, where the $I_{B I A S}$ current sink provides source bias, and the $I_{L O A D}$ current source acts as an active load. Also shown are the net resistance $R_{D}$ external to the drain, combining the parallel resistance of the $I_{L O A D}$ source as well as that of a possible output load, and the net resistance $R_{S}$ external to the source, combining the parallel resistances of the $i_{s i g}$ source and the $I_{B A S S}$ sink.

We wish to find the unloaded voltage gain from $v_{i}$ to $v_{o}$, that is, the gain $v_{o} / v_{i}$ in the limit $R_{D} \rightarrow \infty$, for this reason also called the open-circuit voltage gain. To this end, refer to the ac equivalent of Fig. 4.31. Since $v_{b s}=v_{g s}=-v_{i}$, we invert the direction of the dependent sources, and since they are in parallel, we lump them together
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-070.jpg?height=417&width=1260&top_left_y=1649&top_left_x=380)

FIGURE 4.31 Ac equivalent to find the open-circuit voltage gain of the CG configuration.
as a single dependent source of value $\left(g_{m}+g_{m b}\right) v_{i}$, as shown. By KVL and Ohm's Law, $v_{o}=v_{i}+r_{o}\left(g_{m}+g_{m b}\right) v_{i}$, so

$$
\begin{equation*}
a_{o c}=\lim _{R_{D} \rightarrow \infty} \frac{v_{o}}{v_{i}}=1+\left(g_{m}+g_{m b}\right) r_{o} \tag{4.49}
\end{equation*}
$$

To find the resistance $R_{i}$ seen looking into the source and the resistance $R_{o}$ seen looking into the drain, we simply recycle the results tabulated in Fig. 4.23 and write

$$
\begin{equation*}
R_{i} \cong \frac{1}{g_{m}+g_{m b}}+\frac{R_{D}}{a_{o c}} \quad R_{o}=r_{o}+a_{o c} R_{S} \tag{4.50}
\end{equation*}
$$

As already seen, the drain resistance $R_{D}$ reflected to the source gets divided by $a_{o c}$, whereas the source resistance $R_{S}$ reflected to the drain gets multiplied by $a_{o c}$. These symmetric resistance-transformation properties are worth remembering, as they will appear frequently as we move along.

## 4.4 DARLINGTON, CASCODE, AND CASCADE CONFIGURATIONS

Up to now we have focused on single-transistor configurations, namely, the CE/CS voltage amplifier, the CC/CD voltage buffer, and the CB/CG current buffer. Each configuration implements its intended function but only as an approximation to the ideal. For instance, to avoid loading both at its input and output ports, a voltage amplifier/buffer should have $R_{i} \rightarrow \infty$ and $R_{o} \rightarrow 0$, while a current amplifier/buffer should have $R_{i} \rightarrow 0$ and $R_{o} \rightarrow \infty$. The CE amplifier, while capable of relatively high gain, has $R_{i}=r_{\pi}$, which is often not high enough. On the other hand, the CC configuration is renowned for its high input resistance, but at the price of a voltage gain a bit less than unity. It makes sense to combine the two configurations so that as a team they exploit the advantages of one to reduce the shortcomings of the other. The resulting CC-CE pair, along with its CC-CC sibling, belongs to a class of two-transistor circuits broadly referred to as the Darlington configuration and characterized by high input resistance.

On another subject, the design of high-gain amplifiers such as operational amplifiers and voltage comparators requires that high gains be achieved with as few amplifier stages as possible. The CE/CS configurations offer $a_{\text {instrinsic }}=-g_{m} r_{o}$, which may not be sufficiently high for this purpose, especially in the CS case. On the other hand, the $\mathrm{CB} / \mathrm{CG}$ current buffers are renowned for providing high output resistance, so if we combine a CE/CS amplifier with a current buffer we can raise the unloaded voltage gain way above the intrinsic gain of a single transistor. The resulting CE-CB and CS-CG pairs are known as the cascode configuration, a term coined in the days of vacuum tubes.

On yet another note, the advent of monolithic circuits with matched devices has ushered in other transistor pairings, such as the CC-CB and CD-CG configurations. Also known as emitter-coupled (EC) and source-coupled (SC) pairs, or collectively as differential pairs, they are used as the input stage of popular ICs such as the operational amplifier and the voltage comparator. These pairs play such an important role that they merit detailed attention separately. In the present section we focus on Darlington-type and cascode-type transistor pairs.

### The Darlington Configuration

Named after Sidney Darlington who patented it in1952, this configuration is based on the idea of feeding the emitter of one BJT to the base of another to achieve an overall current gain approaching the product of the individual current gains. Figure $4.32 a$ shows the npn realization of the Darlington concept, whereas Fig. $4.32 b$ shows its complementary version using pnp transistors. The function of the current source $I$ is to establish the operating point of $Q_{1}$ and also to help remove the base charge of $Q_{2}$ during turnoff (more on this in Chapter 6). This source is usually implemented with a plain resistor, or it may even be absent.

When it is absent, $Q_{1}$ is biased by $Q_{2}$ 's base current. This current may be too low for $Q_{1}$ to provide a reasonably high beta, hence the need to bias $Q_{1}$ more convincingly. We shall now demonstrate that a Darlington pair can be regarded as a single composite transistor. Though the discussion will focus on the npn pair, the results are readily adapted to the pnp pair, provided we reverse all voltage polarities and current directions.

In response to the applied current $I_{B}$, the configuration of Fig. $4.33 a$ develops the composite base-emitter voltage drop

$$
\begin{equation*}
V_{B E}=V_{B E 1}+V_{B E 2} \tag{4.51}
\end{equation*}
$$

where we are using subscripts 1 and 2 to denote parameters pertaining to $Q_{1}$ and $Q_{2}$, and no numerical subscripts for the composite transistor. To signify the need for two B-E voltage drops to turn it on, the composite device is sometimes drawn with two emitter arrows, as shown in Fig. 4.32. Assuming both transistors are operating in the forward-active region, the collector current of the composite device in Fig. 4.33a is

$$
\begin{aligned}
I_{C} & =I_{C 1}+I_{C 2}=\beta_{1} I_{B}+\beta_{2}\left(I_{E 1}-I\right)=\beta_{1} I_{B}+\beta_{2}\left[\left(\beta_{1}+1\right) I_{B}-I\right] \\
& =\left(\beta_{1}+\beta_{1} \beta_{2}+\beta_{2}\right) I_{B}-\beta_{2} I
\end{aligned}
$$

If we rewrite as

$$
I_{C}=\beta I_{B}-\beta_{2} I
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-072.jpg?height=555&width=1208&top_left_y=1526&top_left_x=439)

FIGURE 4.32 The Darlington configuration: (a) npn and (b) pnp.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-073.jpg?height=583&width=924&top_left_y=171&top_left_x=198)

FIGURE 4.33 Circuits to investigate the (a) dc and (b) ac characteristics of the npn Darlington configuration.
it is apparent that

$$
\begin{equation*}
\beta=\beta_{1}+\beta_{1} \beta_{2}+\beta_{2} \cong \beta_{1} \beta_{2} \tag{4.52}
\end{equation*}
$$

that is, the current gain of the composite device is approximately the product of the individual gains. We can look at the Darlington configuration from two alternative viewpoints (assume $I=0$ for simplicity). If we focus on $Q_{2}$, we can view $Q_{1}$ as providing a means to lower the required input current by a factor of $\beta_{1}$. For instance, to sustain $I_{C 2}=1 \mathrm{~mA}$ with $\beta_{1}=\beta_{2}=100$, we need $I_{B 2} \cong 10 \mu \mathrm{~A}$, but only $I_{B 1} \cong 0.1 \mu \mathrm{~A}$. Alternatively, if we focus on $Q_{1}$, we can view $Q_{2}$ as providing a means to boost the output current capability by a factor of $\beta_{2}$. For instance, with $I_{E 1}=10 \mathrm{~mA}$ and $\beta_{2}=50$, the Darlington configuration yields $I_{E 2} \cong 5 \mathrm{~A}$. In the former capacity, the Darlington configuration is often used in the design of low input bias current amplifiers. In the latter capacity, it is used in the design of the output stage of power amplifiers.

Turning next to the ac equivalent of Fig. $4.33 b$, we note that $Q_{1}$ acts as an emitter follower with $r_{\pi^{2}}$ as its emitter load, so the resistance seen looking into the base of the composite device is

$$
\begin{equation*}
R_{b}=r_{\pi 1}+\left(\beta_{1}+1\right) r_{\pi 2} \tag{4.53}
\end{equation*}
$$

We likewise observe that the base of $Q_{2}$ is terminated on the resistance $r_{e 1}$ seen looking into $Q_{1}$ 's emitter, so the resistance seen looking into the emitter of the composite device is, by inspection,

$$
\begin{equation*}
R_{e}=r_{e 2}+\frac{r_{e 1}}{\beta_{2}+1} \tag{4.54}
\end{equation*}
$$

Alternatively, this result could have been obtained as $R_{e}=R_{b} /(\beta+1)$, with $R_{b}$ and $\beta$ given by Eqs. (4.53) and (4.52). The transconductance of the composite device is found as $G_{m}=\alpha / R_{e} \cong 1 / R_{e}$. The result is

$$
\begin{equation*}
G_{m}=\frac{i_{c}}{v_{b e}}=\frac{g_{m 2}}{1+\frac{g_{m 2} / g_{m 1}}{\beta_{2}+1}} \tag{4.55}
\end{equation*}
$$

Finally, we seek an expression for the resistance $R_{c}$ seen looking into the composite collector. Due to the feedback path established by $r_{o 1}$ between the common collector node and $Q_{2}$ 's base node, we cannot use plain inspection. Rather, we need to replace the two transistors with their respective small-signal models, and then apply the test method to the common collector terminal. The result (see Problem 4.23) is

$$
\begin{equation*}
R_{c} \cong r_{o 2} / l\left(r_{o 1} \frac{1+\beta_{2} g_{m 1} / g_{m 2}}{1+\beta_{2}}\right) \tag{4.56}
\end{equation*}
$$

To get a better feel for the various parameters, it is instructive to consider the special case $I=0, \beta_{1}=\beta_{2}$, and $V_{A 1}=V_{A 2}$, for then the above expressions simplify as

$$
\begin{equation*}
\beta=\beta_{1}^{2} \quad R_{b}=2 r_{\pi 1} \quad G_{m}=\frac{g_{m 2}}{2} \quad R_{e}=2 r_{e 2} \quad R_{c}=\frac{2}{3} r_{o 2} \tag{4.57}
\end{equation*}
$$

EXAMPLE 4.13 Assuming a Darlington configuration with $\beta_{1}=\beta_{2}=100$ and $V_{A 1}=V_{A 2}=100 \mathrm{~V}$, find its small-signal parameters if $I_{C 2}=1 \mathrm{~mA}$ and $I=90 \mu \mathrm{~A}$.

### Solution

We have $I_{C 1} \cong I_{E 1}=I_{B 2}+I=I_{C 2} / \beta_{2}+I \cong 1000 / 100+90=100 \mu \mathrm{~A}$. Consequently, $g_{m 2}=1 /(26 \Omega), r_{\pi 2}=2.6 \mathrm{k} \Omega, r_{o 2}=100 \mathrm{k} \Omega, g_{m 1}=1 /(260 \Omega), r_{\pi 1}=$ $26 \mathrm{k} \Omega$, and $r_{o 1}=1 \mathrm{M} \Omega$. Using Eqs. (4.52) through (4.56),

$$
\begin{aligned}
& \beta \cong 100 \times 100=10,000 \quad G_{m}=\frac{1 / 26}{1+(260 / 26) / 101}=\frac{1}{28.6 \Omega} \\
& R_{b} \cong 26+101 \times 2.6 \cong 290 \mathrm{k} \Omega \quad R_{e} \cong 26+\frac{260}{100+1}=28.3 \Omega \\
& R_{c} \cong 100 / /\left(1000 \frac{1+100 \times 26 / 260}{101}\right)=100 / / 109=52 \mathrm{k} \Omega
\end{aligned}
$$

Recall that pnp BJTs fabricated in the standard planar process exhibit poorer characteristics than their npn counterparts, so pnp BJTs should be avoided whenever possible. Shown in Fig. 4.34a is a popular alternative to the complementary pair of Fig. 4.32b. Named for G. C. Sziklai who patented it in the 1950s, this configuration acts like a composite $p n p$ BJT, except that it uses an $n p n$ device for $Q_{2}$, which usually provides a much higher current gain than a pnp type. Also referred to as quasi-complementary Darlington configuration, it enjoys the additional advantage of requiring only a single junction
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-075.jpg?height=556&width=966&top_left_y=201&top_left_x=189)

FIGURE 4.34 Alternative Darlington realizations: (a) quasi-complementary and (b) BiMOS.
voltage drop between its composite emitter and base, or $V_{E B}=V_{E B 1}$. The small-signal characteristics of the Sziklai pair are investigated further in Problem 4.24.

BiCMOS technology exploits the advantages of both BJTs and MOSFETs to further improve circuit performance. The Darlington rendition of Fig. $4.34 b$ uses a MOSFET to provide $R_{i}=\infty$ and a BJT to provide a higher current-drive capability as well as a higher transconductance.

### The CC-CE and CC-CC Configurations

IC design often utilizes slight variants of the Darlington configuration to meet special needs. Two examples are shown in Fig. 4.35. The CC-CE version of Fig. 4.35a avoids the reduction in $r_{o}$ due to $r_{o 1}$ 's feedback action by separating the collectors, as shown. Even more important, $Q_{1}$ provides a low-impedance drive to $Q_{2}$ to alleviate the impact of the Miller effect and thus maximize the frequency bandwidth, a subject we'll address in great detail in Chapter 6 when studying frequency/transient responses.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-075.jpg?height=492&width=320&top_left_y=1576&top_left_x=204)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-075.jpg?height=487&width=311&top_left_y=1572&top_left_x=575)
(b)

FIGURE 4.35 The (a) CC-CE and (b) CC-CC configurations.

### The Bipolar Cascode Configuration

This configuration is based on the artifice of feeding a CE voltage amplifier to a CB current buffer to raise the output resistance and, in so doing, to significantly increase the unloaded or open-circuit voltage gain $a_{o c}$ compared to the intrinsic gain of the CE stage. Also referred to as CE-CB amplifier, the cascode configuration offers another advantage, namely, a much wider gain-bandwidth product than the conventional CE amplifier-a topic that will be investigated in Chapter 6 (in the present section we limit ourselves to the low-frequency gain and the input/output resistances).

The circuit of Fig. $4.36 a$ uses the current source $I_{\text {LOAD }}$ as an active load, and the voltage sources $V_{B E 1}$ and $V_{B 2}$ to bias the BJTs. We assume that $V_{B E 1}$ has been adjusted so as to ensure that $Q_{2}$ 's collector is biased well within the linear region of operation, and that $V_{B 2}$ is high enough to prevent $Q_{1}$ from saturating ( $V_{B 2} \cong 1 \mathrm{~V}$ will do in this example). We now wish to find the small-signal characteristics of this circuit. To this end, refer to its ac equivalent of Fig. $4.36 b$ where we have, by inspection,

$$
\begin{equation*}
R_{i}=r_{\pi 1} \tag{4.58}
\end{equation*}
$$

To find $R_{o}$ we observe that $Q_{2}$ is subject to a good deal of emitter degeneration, with $Q_{1}$ 's collector resistance $r_{o 1}$ acting as $Q_{2}$ 's degeneration resistance. We thus write

$$
\begin{equation*}
R_{o}=r_{o 2}\left[1+g_{m 2}\left(r_{\pi 2} / / r_{o 1}\right)\right] \tag{4.59a}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-076.jpg?height=736&width=448&top_left_y=1295&top_left_x=450)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-076.jpg?height=553&width=635&top_left_y=1478&top_left_x=960)
(b)

FIGURE 4.36 (a) The CE-CB, or bipolar cascode configuration, and (b) its ac equivalent.

For $r_{\pi 2} \ll r_{o 1}$ we can approximate $g_{m 2}\left(r_{\pi 2} / / r_{o 1}\right) \cong g_{m 2} r_{\pi 2}=\beta_{02}$, so the above expression simplifies as

$$
\begin{equation*}
R_{o} \cong\left(\beta_{02}+1\right) r_{o 2} \tag{4.59b}
\end{equation*}
$$

indicating that cascoding raises the output resistance by about $\beta_{02}+1$. To find the voltage gain, recall that in the absence of any external ac load the current $g_{m 2} \nu_{m 2}$ circulates entirely in the resistance $r_{o 2}$. Consequently, $Q_{1}$ acts as a CE amplifier with $r_{\pi 2}$ as its collector resistance, providing the voltage gain

$$
a_{1}=\frac{v_{c 1}}{v_{i}}=-g_{m 1}\left(r_{\pi 2} / / r_{o 1}\right)=-g_{m} \frac{r_{\pi} r_{o}}{r_{\pi}+r_{o}}=-\beta_{0} \frac{r_{o}}{r_{\pi}+r_{o}}
$$

where the numerical subscripts have been dropped to reflect the fact that matched and equally-biased BJTs exhibit identical small-signal parameters. We also know from Eq. (4.26) that the unloaded voltage gain of the CB stage $Q_{2}$ is

$$
a_{2}=\frac{v_{o}}{v_{c 1}}=1+g_{m 2} r_{o 2}
$$

Consequently, the overall unloaded voltage gain is $a_{o c}=v_{o} / v_{i}=\left(v_{o} / v_{c 1}\right) \times\left(v_{c 1} / v_{i}\right)=$ $a_{2} \times a_{1}=a_{1} \times a_{2}$, or

$$
\begin{equation*}
a_{o c}=-\beta_{0} \frac{r_{o}}{r_{\pi}+r_{o}}\left(1+g_{m} r_{o}\right) \tag{4.60a}
\end{equation*}
$$

where the numerical subscripts have again been omitted. For $r_{\pi} \ll r_{o}$ and $g_{m} r_{o} \gg 1$ we can approximate

$$
\begin{equation*}
a_{o c} \cong-\beta_{0} g_{m} r_{o} \tag{4.60b}
\end{equation*}
$$

Since $-g_{m} r_{o}$ represents a BJT's intrinsic gain, it is apparent that the artifice of cascoding raises this gain by almost $\beta_{0}$ ! This is not surprising once we realize that $Q_{1}$ 's collector current flows through $r_{\pi 2}$ to become $Q_{2}$ 's base current. Hence, the amplification factor $\beta_{0}$.

We observe that $R_{o}$ of Eq. (4.59b) is comparable to $r_{\mu}$, which has been deliberately omitted for the sake of simplicity. A more accurate expression is thus $R_{o} \cong\left(\beta_{02} r_{o 2}\right) / / r_{\mu}$. Using Eq. (4.8), we write

$$
\begin{equation*}
R_{o} \cong \frac{m}{m+1} \beta_{0} r_{o} \quad a_{o c} \cong-\beta_{0} g_{m} R_{o}=-\frac{m}{m+1} \beta_{0} g_{m} r_{o} \tag{4.61}
\end{equation*}
$$

Note that in order to fully realize the high-gain potential of the bipolar cascode we must avoid loading its output appreciably. We could buffer the cascode's output with a high input-resistance stage such as a Darlington-type voltage follower, or, in the case of BiMOS technology, with a MOSFET follower.

EXAMPLE 4.14 (a) Assuming a cascode configuration with $I_{L A D}=1 \mathrm{~mA}, \beta_{1}=\beta_{2}=100$, $V_{A 1}=V_{A 2}=100 \mathrm{~V}$, and $m=5$, find quick estimates for $R_{i}, R_{o}$, and $v_{o} / v_{i}$.
(b) Repeat if the circuit drives a 1-M $\Omega$ external load, and comment.

### Solution

(a) Applying Eqs. (4.58) and (4.61) we get

$$
\begin{aligned}
& R_{i}=2.6 \mathrm{k} \Omega \quad R_{o} \cong \frac{5}{5+1} 100 \times 10^{5}=8.33 \mathrm{M} \Omega \\
& a_{o c}=-g_{m} R_{o}=-\frac{8.33 \times 10^{6}}{26} \cong-320 \times 10^{3} \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

This is quite a gain!
(b) With an external load $R_{L}=1 \mathrm{M} \Omega$ the gain drops to

$$
\frac{v_{o}}{v_{i}}=a_{o c} \frac{R_{L}}{R_{o}+R_{L}} \cong-320 \times 10^{3} \frac{1}{8.33+1}=-34.3 \times 10^{3} \mathrm{~V} / \mathrm{V}
$$

Note almost an order of magnitude drop due to heavy output loading, even though a 1-M $\Omega$ load might seem large by common standards. Clearly, in order to fully realize the high-gain capabilities of the cascode, we must ensure that output loading is negligible.

EXAMPLE 4.15 To gain deeper insight it is instructive to follow the signal as it progresses from the input to the output node. In so doing, we will also get a chance to refine the quick estimate provided by Eq. (4.61).
(a) With reference to the cascode of Example 4.14a, find the individual gains $a_{1}$ and $a_{2}$ as well as the gain $a_{o c}$. Verify with PSpice and compare with Example 4.14a.
(b) Assuming a maximum output swing of $\left|v_{o(\max )}\right|=2.5 \mathrm{~V}$, find the corresponding input swing $\left|v_{i(\max )}\right|$. Do both BJTs meet the small-signal constraint $\left|v_{b e}\right| \leq 5 \mathrm{mV}$ ?

### Solution

(a) For the CE stage $Q_{1}$ we have $a_{1}=-g_{m 1} R_{C 1}$, where $R_{C 1}$ is the total collector resistance of $Q_{1}$. By inspection, $R_{C 1} \cong r_{\mu 1} / / r_{o 1} / / R_{e 2}$, where $R_{e 2}$ is the resistance seen looking into the emitter of $Q_{2}$. Adapting the expression tabulated in Fig. 4.19 we get

$$
R_{e 2} \cong r_{e 2} \frac{r_{o 2}+r_{\mu 2}}{r_{o 2}+r_{\mu 2} /\left(\beta_{02}+1\right)}=\frac{100}{101} 26 \frac{0.1+50}{0.1+50 / 101}=2.17 \mathrm{k} \Omega
$$

so

$$
a_{1}=-g_{m 1} R_{C 1}=-\frac{50,000 / / 100 / / 2.17}{0.026}=-81.7 \mathrm{~V} / \mathrm{V}
$$

in excellent agreement with PSpice's prediction $a_{1}=-81.6 \mathrm{~V} / \mathrm{V}$. A quick estimate would have given $a_{1} \cong-\beta_{01}=-100 \mathrm{~V} / \mathrm{V}$ and $R_{e 2}=r_{\pi 2}=2.6 \mathrm{k} \Omega$.

Both estimates are higher than the actual values because they ignore the presence of $r_{o 2}$ and $r_{\mu 2}$. The gain of the CB stage $Q_{2}$ is

$$
a_{2}=1+g_{m 2} r_{o 2}=1+\frac{100}{0.026}=3846 \mathrm{~V} / \mathrm{V}
$$

so $a_{o c}=-81.7 \times 3846=-314 \times 10^{3} \mathrm{~V} / \mathrm{V}$, in excellent agreement with PSpice's $a_{o c}=-313 \times 10^{3} \mathrm{~V} / \mathrm{V}$.
(b) We have $\left|v_{i(\max )}\right|=\left|v_{o(\max )}\right| /\left|a_{o c}\right|=2.5 /(314,000) \cong 8 \mu \mathrm{~V}$. Moreover, $\left|v_{b e 2}\right|=$ $\left|v_{o(\max )}\right| / a_{2}=2.5 / 3846=0.65 \mathrm{mV}$, indicating that both BJTs amply meet the small-signal constraint.

### The MOS Cascode Configuration

The cascode concept, originally developed for vacuum tubes and subsequently adapted to BJTs, is widely used in MOS technology as well. Here, we feed a CS amplifier to a CG current buffer to raise the output resistance and, in so doing, we raise also the unloaded voltage gain. This is especially desirable in the case of FETs, which are notorious for their lower $g_{m} \mathrm{~s}$ compared to BJTs. Also referred to as the CS-CG amplifier, the cascode configuration is also an inherently faster circuit than an ordinary CS amplifier (this subject will be investigated in Chapter 6; in this section we limit ourselves to the low-frequency gain and the input/output resistances).

The circuit of Fig. 4.37a uses the current source $I_{\text {LOAD }}$ as active load, and the voltage sources $V_{G S 1}$ and $V_{G 2}$ to bias the FETs. We assume that $V_{G S 1}$ has been adjusted so
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-079.jpg?height=727&width=1274&top_left_y=1313&top_left_x=112)

FIGURE 4.37 (a) The CS-CG, or MOSFET cascode configuration, and (b) its smallsignal equivalent circuit.
as to ensure that $M_{2}$ 's drain is biased well within the linear region of operation, and that $V_{G 2}$ is high enough to bias $M_{1}$ at or above its edge of saturation. We now wish to find the small-signal characteristics of the overall circuit. To this end, refer to the ac equivalent of Fig. 4.37b. By inspection, the input resistance is

$$
\begin{equation*}
R_{i}=\infty \tag{4.62}
\end{equation*}
$$

To find the output resistance, let $v_{i} \rightarrow 0$, thereby deactivating the $g_{m 1} v_{g s 1}$ source and leaving only $r_{o 1}$ in place. This resistance causes a great deal of source degeneration for $M_{2}$, so we adapt Eq. (4.41) to write

$$
\begin{equation*}
R_{o}=r_{o 2}+\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{o 2}\right] r_{o 1} \cong\left(g_{m 2}+g_{m b 2}\right) r_{o 1} r_{o 2} \tag{4.63}
\end{equation*}
$$

indicating that cascoding two FETs raises the output resistance dramatically. We expect the unloaded gain to increase accordingly. Referring again to Fig. 4.37b, we observe that in the absence of any external ac load, $M_{2}$ 's drain is an ac open circuit, so the entire ac equivalent of $M_{2}$ forms a self-contained subcircuit. The source $g_{m 1} v_{g s 1}$ sinks current out of $r_{o 1}$ to give, by Ohm's law, $v_{d 1}=-g_{m 1} v_{i} r_{o 1}$, so the gain of the CS stage $M_{1}$ is

$$
a_{1}=\frac{v_{d 1}}{v_{i}}=-g_{m 1} r_{o 1}
$$

As we know, this is $M_{1}$ 's intrinsic gain. By Eq. (4.49) the unloaded voltage gain of the CG stage $M_{2}$ is

$$
a_{2}=1+\left(g_{m 2}+g_{m b 2}\right) r_{o 2}
$$

Consequently, the overall voltage gain is $a_{o c}=v_{o} / v_{i}=\left(v_{o} / v_{d 1}\right) \times\left(v_{d 1} / v_{i}\right)=a_{2} \times a_{1}=$ $a_{1} \times a_{2}$, or

$$
\begin{equation*}
a_{o c}=-g_{m 1} r_{o 1}\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{o 2}\right] \cong-g_{m 1} r_{o 1}\left(g_{m 2}+g_{m b 2}\right) r_{o 2} \tag{4.64}
\end{equation*}
$$

It is apparent that the artifice of cascoding increases $M_{1}$ 's intrinsic gain $-g_{m 1} r_{o 1}$ by a factor of about $\left(g_{m 2}+g_{m b 2}\right) r_{o 2}$, which is the gain contribution by $M_{2}$. This feature is widely exploited to make up for the low $g_{m}$ s of FETs! For instance, cascoding FETs with $\left|a_{\text {intrinsic }}\right|$ as low as $10 \mathrm{~V} / \mathrm{V}$ will yield $\left|a_{o c}\right| \cong 10^{2} \mathrm{~V} / \mathrm{V}$.

In order to fully realize the high-gain potential of the FET cascode we must avoid loading its output appreciably. This constraint is easily met in MOS technology, as the output of the cascode is likely to drive the gate of another FET, which presents an infinite input resistance, at least at low frequencies. This is a definite advantage compared to BJT cascodes: somehow, the high input-resistance of a FET makes up for the FET's notoriously low $g_{m}$ !

### The Telescopic Cascode Configuration

We have just seen that cascoding raises both the output resistance and the unloaded gain of the CS stage by the intrinsic gain of the CG stage. If desired, we can raise $a_{o c}$ and $R_{o}$ further by adding another level of cascoding, in the manner exemplified in Fig. 4.38 for the case of double cascoding. The stacking of transistors is reminiscent
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-081.jpg?height=837&width=437&top_left_y=218&top_left_x=195)

FIGURE 4.38 The telescopic cascode
configuration (double cascode shown).
of a telescope extension, so this arrangement is aptly referred to as telescopic cascode. For instance, a three-transistor cascode using FETs with intrinsic gains as low as $10 \mathrm{~V} / \mathrm{V}$ each will yield $\left|a_{o c}\right| \cong 10^{3} \mathrm{~V} / \mathrm{V}$ ! This is a definite advantage of MOSFETs compared to BJTs, as a bipolar cascode, after one level of cascoding, already approaches its maximum possible gain of about $\beta_{0} a_{\text {instrinsic }}$.

The advantages of telescopic cascoding come at a price: a reduction in the output voltage swing (OVS). Assuming $M_{1}$ and $M_{2}$ are biased at the edge of saturation (EOS), the output must swing above

$$
\begin{equation*}
v_{O(\min )}=V_{O V 1}+V_{O V 2}+V_{O V 3} \tag{4.65}
\end{equation*}
$$

where $V_{O V 1}$ through $V_{O V 3}$ are the overdrive voltages of the stacked FETs. This limit may be unacceptably high in low power-supply systems. Fortunately, this drawback can be avoided by using the folded cascode technique discussed next.

### The Folded Cascode Configuration

A notorious drawback of the cascode configurations of Figs. 4.36 and 4.37 is limited voltage headroom at the output. With proper choice of the bias voltages $V_{B 2}$ and $V_{G 2}$, the best we can achieve is $v_{O(\text { min })}=2 V_{C E(\mathrm{EOS})}$ in the bipolar case, and $v_{O(\min )}=2 V_{D S(\mathrm{EOS})}=$ $2 V_{O V}$ in the MOS case. In both cases $v_{O(\min )}>0 \mathrm{~V}$. Yet, many applications call for $v_{o}$ 's ability to swing both above and below 0 V . We can meet this requirement by using a complementary transistor as the CB/CG stage, in the manner of Fig. 4.39. Aptly called folded cascode, this arrangement requires an additional current source $I_{B I A S}$ (typically $I_{B A S}=2 I_{L O A D}$ ) to bias the transistor pair, but this is a price well worth paying for expanded output headroom. In both cases $v_{O(\text { min })}$ is now established by the
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-082.jpg?height=675&width=1293&top_left_y=203&top_left_x=356)

FIGURE 4.39 Folded cascode: (a) bipolar, and (b) CMOS.
negative supply, along with the minimum permissible voltage drop $V\left(I_{L O A D}\right)_{\min }$ across the $I_{\text {LOAD }}$ current sink. We thus have for the BJT and CMOS circuits, respectively,

$$
\begin{equation*}
v_{O(\min )}=V_{E E}+V\left(I_{L O A D}\right)_{\min } \quad v_{O(\min )}=V_{S S}+V\left(I_{L O A D}\right)_{\min } \tag{4.66a}
\end{equation*}
$$

The upper bound on the output swing is established by the bias voltage $V_{B p}$ and $V_{G p}$, along with the minimum permissible voltage $V_{B I A S(\min )}$ across the $I_{B I A S}$ source. Selecting $V_{B p}$ and $V_{G p}$ so that this source is operated right at its minimum voltage drop, we have for the BJT and CMOS circuits, respectively,

$$
\begin{equation*}
v_{O(\max )}=V_{C C}-V\left(I_{B I A S}\right)_{\min }-V_{E C P(\mathrm{sat})} \quad v_{O(\max )}=V_{D D}-V\left(I_{B I A S}\right)_{\min }-V_{O V_{D}} \tag{4.66b}
\end{equation*}
$$

For instance, assuming $\pm 5-\mathrm{V}$ power supplies, along with $V\left(I_{B I A S}\right)_{\min }=V\left(I_{L O A D}\right)_{\min }=$ $V_{E C D(\text { sat })}=0.2 \mathrm{~V}$ in the BJT case, and $V\left(I_{B A A S}\right)_{\min }=V\left(I_{L O A D}\right)_{\text {min }}=V_{O V p}=0.5 \mathrm{~V}$ in the MOS case, the output voltage swings are

$$
-4.8 \mathrm{~V} \leq v_{O(\mathrm{BJT})} \leq 4.6 \mathrm{~V} \quad-4.5 \mathrm{~V} \leq v_{O(\mathrm{MOS})} \leq 4.0 \mathrm{~V}
$$

These compare quite favorably with the swings of the conventional cascodes of Figs. 4.36 and 4.37, which, for the same parameter values, are $0.4 \mathrm{~V} \leq v_{\text {(BJT) }} \leq 4.8 \mathrm{~V}$ and $1.0 \mathrm{~V} \leq v_{O(\mathrm{MOS})} \leq 4.5 \mathrm{~V}$.

### Cascoded Current Sources/Sinks

In Sections 4.2 and 4.3 we have made extensive use of current sources/sinks to provide dc bias $\left(I_{B A S}\right)$ as well as active loading $\left(I_{L O A D}\right)$. Current sources/sinks are themselves implemented with transistors. A good starting point is the collector or drain terminal, owing to the relative flatness of the active-region $i_{C^{-}} v_{C E}$ and $i_{D}-v_{D S}$ characteristics, whose slope is $1 / r_{o}$. There are many situations in which the curves are not
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-083.jpg?height=661&width=818&top_left_y=205&top_left_x=199)

FIGURE 4.40 Using the (a) bipolar cascode and (b) MOS cascode to achieve high output resistance.
flat enough, so we must devise ways to raise the effective value of $r_{o}$. Already familiar examples are emitter and source degeneration, where we use a suitable resistance $R_{E}$ or $R_{S}$ in series with the emitter or source to provide a biasing function as well as raise the effective resistance seen looking into the collector or drain. However, it has already been pointed out that physical resistances are undesirable in monolithic circuits. Another serious drawback is that if a high degree of degeneration is needed, the degeneration resistance would have to be large, and its voltage drop could drastically reduce the available voltage headroom at the output of the source/sink.

An ingenious artifice is to replace the emitter/source degeneration resistance with a second transistor $Q_{2} / M_{2}$, and to let its resistance $r_{o 2}$ play the role of the degeneration resistance for the transistor $Q_{1} / M_{1}$. The result is the two-transistor circuits of Fig. 4.40 $a$ and $b$. These are the already familiar cascode circuits, except that we are now taking an alternative viewpoint: while in Figs. 4.36 and 4.37 we focused on the bottom transistor and added the top transistor to raise the bottom transistor's intrinsic gain, in Fig. 4.40 we focus on the top transistor and add the bottom transistor to raise the top transistor's output resistance.

Regardless of the viewpoint, the formulas developed earlier still stand, so we adapt them to the present case to write

$$
\begin{equation*}
R_{o(\mathrm{BJT})}=r_{o 1}\left[1+g_{m 1}\left(r_{\pi 1} / / r_{o 2}\right)\right] \tag{4.67}
\end{equation*}
$$

and

$$
\begin{equation*}
R_{o(\mathrm{MOS})}=r_{o 1}+\left[1+\left(g_{m 1}+g_{m b 1}\right) r_{o 1}\right] r_{o 2} \tag{4.68}
\end{equation*}
$$

As we know, for $r_{o 2} \gg r_{\pi 1}$ Eq. (4.67) simplifies as $R_{o} \cong\left(1+\beta_{01}\right) r_{o 1}$. Similarly, for $\left(g_{m 1}+g_{m b 1}\right) r_{o 1} \gg 1$ Eq. (4.68) simplifies as $R_{o} \cong(1+\chi) g_{m 1} r_{o 1} r_{o 2}$.

EXAMPLE 4.16 (a) Let the FETs of Fig. $4.40 b$ have $V_{t 0}=0.5 \mathrm{~V}, k=1.25 \mathrm{~mA} / \mathrm{V}^{2}, \lambda=0.08 \mathrm{~V}^{-1}$, $\left|2 \phi_{p}\right|=0.6 \mathrm{~V}$, and $\gamma=0.45 \mathrm{~V}^{1 / 2}$. Find the values of $V_{G 1}$ and $V_{G S 2}$ that will bias $M_{2}$ at the edge of saturation with $I_{D}=100 \mu \mathrm{~A}$.
(b) Find $R_{o}$ as well as $v_{O(\min )}$ for which $M_{1}$ is still saturated. What is the percentage change in $I_{O}$ for each 1-V change in $v_{O}$ above $v_{O(\min )}$ ?

### Solution

(a) We have

$$
\begin{aligned}
& V_{O V 1}=V_{O V 2}=\sqrt{2 I_{D} / k}=\sqrt{2 \times 0.1 / 1.25}=0.4 \mathrm{~V} \\
& \text { so } V_{G S 2}=V_{t 0}+V_{O V 2}=0.5+0.4=0.9 \mathrm{~V} \text {. We also have } \\
& V_{t 1}=V_{t 0}+\gamma\left(\sqrt{V_{S B 1}+\left|2 \phi_{p}\right|}-\sqrt{\left|2 \phi_{p}\right|}\right) \\
& =0.5+0.45(\sqrt{0.4+0.6}-\sqrt{0.6})=0.6 \mathrm{~V} \\
& \text { so } V_{G 1}=V_{G S 1}+V_{D S 2}=V_{O V 1}+V_{t 1}+V_{O V 2}=0.4+0.6+0.4=1.4 \mathrm{~V} \text {. }
\end{aligned}
$$

(b) We have

$$
\begin{aligned}
g_{m 1} & =k_{1} V_{o V 1}=1.25 \times 0.4=0.5 \mathrm{~mA} / \mathrm{V} \\
r_{o 1} & =r_{o 2}=\frac{1}{\lambda I_{D}}=\frac{1}{0.08 \times 0.1}=125 \mathrm{k} \Omega \\
\chi & =\frac{\gamma}{2 \sqrt{V_{S B 1}+2\left|\phi_{p}\right|}}=\frac{0.45}{2 \sqrt{0.4+0.6}}=0.225 \\
R_{o} & =r_{o}+\left[1+(1+\chi) g_{m 1} r_{o}\right] r_{o}=125+[1+1.225 \times 0.5 \times 125] 125 \\
& =9.82 \mathrm{M} \Omega
\end{aligned}
$$

Also, $v_{O(\min )}=V_{O V 2}+V_{O V 1}=0.8 \mathrm{~V}$. For a 1-V change in $v_{O}$ within the linear region of operation we get $\Delta I_{O}=\Delta v_{o} / R_{o}=(1 \mathrm{~V}) /(9.82 \mathrm{M} \Omega)=102 \mathrm{nA}$, representing a change of only $\left(102 \times 10^{-9}\right) /\left(100 \times 10^{-6}\right) \cong 0.1 \%$.

### Cascaded Stages

When its gain specifications cannot be met with a single transistor, a circuit is implemented as a cascade of two or more individual stages. Already familiar examples are Darlington amplifiers, which use two stages to raise the input resistance as well as the current gain, and cascode amplifiers, which use CE-CB or CS-CG pairs to raise the output resistance as well as the unloaded voltage gain. (Incidentally, the word cascode, which denotes a particular example of a cascade, has not made it into mainstream dictionaries. So, chances are that a spell-checker will annoyingly change typed instances of cascode to cascade.)

When analyzing a cascade of two or more individual stages, an engineer often needs to come up with a quick estimate for the overall signal-to-load gain, with interstage loading automatically taken into account. To accomplish this, we label each
interstage node separately, and we find the loaded gain from one node to the next using the familiar rules of thumb:

The loaded gain of a CE/CS voltage amplifier stage is the (negative of the) ratio of the total resistance associated with the collector/drain to the total resistance associated with emitter/source.

A voltage follower acts as a unity-gain buffer with output resistance $1 / g_{m}$, in turn forming a voltage divider with the rest of the resistances associated with the emitter/source.

Then, we find the gain of the entire cascade as the product of the individual gains. Study the following example carefully, as we will have plenty of occasions to retrace this procedure as we move along.

Shown in Fig. 4.41 is the ac equivalent of a three-stage amplifier consisting of CE stage $Q_{1}$, followed by CE-ED stage $Q_{2}$, followed in turn by CC stage $Q_{3}$. Assuming for simplicity that all three BJTs have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=50 \mathrm{k} \Omega$, estimate the overall gain $v_{o} / v_{i}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-085.jpg?height=646&width=729&top_left_y=1039&top_left_x=246)

FIGURE 4.41 Circuit of Example 4.17.

### Solution

Even though the node voltages of interest to us are $v_{i}$ and $v_{o}$, we label also the intermediate nodes $v_{1}, v_{2}$, and $v_{3}$, as they will appear in our intermediate calculations. We make the following considerations:

- In progressing from node $v_{i}$ to node $v_{1}$ the signal encounters a voltage divider formed by $R_{s}$ and the resistance $R_{1}$ presented by node $v_{1}$. By inspection, $R_{1}=$ $r_{\pi 1}$, so

$$
\frac{v_{1}}{v_{i}}=\frac{R_{1}}{R_{s}+R_{1}}=\frac{r_{\pi 1}}{R_{s}+r_{\pi 1}}=\frac{5}{1+5}=0.833 \mathrm{~V} / \mathrm{V}
$$

- In progressing from node $v_{1}$ to node $v_{2}$ the signal undergoes amplification by the CE stage $Q_{1}$, whose total emitter resistance is $r_{e 1}\left(=\alpha_{01} / g_{m 1} \cong 1 / g_{m 1}\right)$, and whose total collector resistance $R_{2}$ consists of three components: $R_{C 1}, r_{o 1}$, and the ac resistance $R_{b 2}$ seen looking into $Q_{2}$ 's base. By inspection, $R_{b 2}=r_{\pi 2}+$ $\left(\beta_{2}+1\right) R_{E 2}=5+[(5 / 0.025)+1] \times 0.2=45.2 \mathrm{k} \Omega$, so we write

$$
\frac{v_{2}}{v_{1}}=-\frac{R_{C 1} / / r_{o l} / / R_{b 2}}{r_{e 1}} \cong-\frac{10 / / 50 / / 45.2}{0.025}=-281 \mathrm{~V} / \mathrm{V}
$$

- In progressing from $v_{2}$ to $v_{3}$ the signal undergoes amplification by the CE-ED stage $Q_{2}$. The total emitter resistance is $\alpha_{02} / g_{m 2}+R_{E 2} \cong 25+200=$ $225 \Omega$. The total collector resistance $R_{3}$ consists of three components: $R_{C 2}$, the ac resistance $R_{c 2}$ seen looking into $Q_{2}$ 's collector, and the ac resistance $R_{b 3}$ seen looking into $Q_{3}$ 's base. By inspection, $R_{c 2}=r_{o 2}\left[1+g_{m 2}\left(r_{\pi 2} / / R_{E 2}\right)\right]=$ $50[1+(5 / / 0.2) / 0.025]=435 \mathrm{k} \Omega$, and $R_{b 3}=r_{\pi 3}+\left(\beta_{3}+1\right) R_{E 3}=5+201 \times 10=$ $2.015 \mathrm{M} \Omega$. Consequently,

$$
\frac{v_{3}}{v_{2}}=-\frac{R_{C 2} / / R_{c 2} / / R_{b 3}}{r_{e 2}+R_{E 2}} \cong-\frac{10 / / 435 / / 2015}{0.025+0.200}=-43.2 \mathrm{~V} / \mathrm{V}
$$

- In progressing from $v_{3}$ to $v_{o}$ the signal is buffered by the CC stage $Q_{3}$, acting as a unity-gain amplifier with output resistance $1 / g_{m 3}=25 \Omega$. This resistance forms a voltage divider with the combination $R_{L} / / r_{o 3}=10 / / 50=8.33 \mathrm{k} \Omega$, so

$$
\frac{v_{o}}{v_{3}}=1 \times \frac{R_{L} / / r_{o 3}}{r_{e 3}+\left(R_{L} / / r_{o 3}\right)} \cong \frac{8.33}{0.025+8.33}=0.997 \mathrm{~V} / \mathrm{V}
$$

We finally have

$$
\begin{aligned}
\frac{v_{o}}{v_{i}} & =\frac{v_{1}}{v_{i}} \times \frac{v_{2}}{v_{1}} \times \frac{v_{3}}{v_{2}} \times \frac{v_{o}}{v_{3}}=0.833 \times(-281) \times(-43.2) \times 0.997 \\
& =10.1 \times 10^{3} \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

## 4.5 DIFFERENTIAL PAIRS

We now turn our attention to another important transistor pair, namely, the differential pair. Already introduced informally in Section 4.1, this is probably the most widely used subcircuit in analog ICs. Even though the concept was initially developed for vacuum tubes and subsequently adapted to discrete BJTs, it was the advent of monolithic circuits that made it possible to realize its full potential. This is because performance is critically dependent upon matching between the two transistors, and the monolithic process offers matched devices also capable of tracking each other with temperature and time. Compared to single-transistor amplifiers, differential amplifiers are much more immune to a type of interference noise known as commonmode noise, and lend themselves to dc coupling, thus avoiding the bulky capacitors of discrete designs. In fact, the differential amplifier functions over a frequency range
extending all the way down to dc. All this comes at the price of increased circuit complexity, but it is not a problem in monolithic circuits, where additional transistors are easily available at insignificant extra cost.

The monolithic differential pair was first realized in bipolar form, taking on the name of emitter-coupled (EC) pair. Once MOS technology became commercially viable, the concept was adapted to MOSFETs as the source-coupled (SC) pair. Let us investigate both implementations in proper detail.

### The Emitter-Coupled Pair

The simplest form of the emitter-coupled (EC) pair is shown in Fig. 4.42. Emitter bias for the pair is provided by a current source, here modeled by the Norton equivalent consisting of $I_{E E}$ and $R_{E E}$. (In a well-designed circuit, $R_{E E}$ is large and is often ignored, especially in the course of dc analysis.) Since one side is the exact mirror image of the other, the circuit is also said to be balanced, and this symmetry is exploited to facilitate circuit analysis, as we shall see. To develop a basic feel for the circuit, let us investigate its large-signal behavior (to keep things simple, in this section we assume $V_{A}=\infty$ ).

Applying KVL around the input loop gives

$$
v_{I 1}-v_{B E 1}+v_{B E 2}-v_{I 2}=0
$$

that is, $v_{B E 1}-v_{B E 2}=v_{I 1}-v_{I 2}$. Assuming forward-active operation for the BJTs, we use the familiar exponential relationships and write $i_{C 1}=I_{s 1} \exp \left(v_{B E 1} / V_{T}\right)$ and $i_{C 2}=I_{s 2} \exp \left(v_{B E 2} / V_{T}\right)$. Consequently,

$$
\frac{i_{C 1}}{i_{C 2}}=\frac{I_{s 1}}{I_{s 2}} \exp \left(\frac{v_{B E 1}-v_{B E 2}}{V_{T}}\right)=\frac{I_{s 1}}{I_{s 2}} \exp \left(\frac{v_{n 1}-v_{t 2}}{V_{T}}\right)
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-087.jpg?height=673&width=642&top_left_y=1394&top_left_x=205)

FIGURE 4.42 The emitter-coupled (EC) pair.

Matched transistors have $I_{s 1}=I_{s 2}$, so the above relation simplifies as

$$
\begin{equation*}
\frac{i_{C 1}}{i_{C 2}}=\exp \left(\frac{v_{I D}}{V_{T}}\right) \tag{4.69}
\end{equation*}
$$

where

$$
\begin{equation*}
v_{I D}=v_{I 1}-v_{I 2} \tag{4.70}
\end{equation*}
$$

is the difference between the input voltages. By KCL, the emitter currents are such that $i_{E 1}+i_{E 2}=I_{E E}$, where we are ignoring $R_{E E}$, which in a well-designed circuit is very large. This allows us to write

$$
\begin{equation*}
i_{C 1}+i_{C 2}=\alpha_{F} I_{E E} \tag{4.71}
\end{equation*}
$$

Combining Eqs. (4.69) and (4.71) we readily get

$$
\begin{equation*}
i_{C 1}=\frac{\alpha_{F} I_{E E}}{1+\exp \left(-v_{i D} / V_{T}\right)} \quad i_{C 2}=\frac{\alpha_{F} I_{E E}}{1+\exp \left(v_{i D} / V_{T}\right)} \tag{4.72}
\end{equation*}
$$

We also have, by KVL and Ohm's law,

$$
v_{O 1}=V_{C C}-R_{C} i_{C 1} \quad v_{O 2}=V_{C C}-R_{C} i_{C 2}
$$

Substituting the expressions of Eq. (4.72) and simplifying we obtain an expression for the voltage difference at the output,

$$
\begin{equation*}
v_{O D}=v_{O 1}-v_{O 2}=\alpha_{F} I_{E E} R_{C} \tanh \left(-\frac{v_{I D}}{2 V_{T}}\right) \tag{4.73}
\end{equation*}
$$

We can readily plot Eqs. (4.72) and (4.73) using PSpice. In the circuit of Fig. 4.43 we have set $v_{I 2}=0$, so $v_{I D}=v_{I 1}$ in this case. After directing PSpice to sweep
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-088.jpg?height=677&width=638&top_left_y=1390&top_left_x=449)

FIGURE 4.43 PSpice circuit to plot the transfer curves of an EC pair using BJTs with $\beta_{F}=100$ and $l_{s}=2 \mathrm{fA}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-089.jpg?height=600&width=1546&top_left_y=198&top_left_x=187)

FIGURE 4.44 Plots of (a) the collector currents $i_{C 1}$ and $i_{C 2}$, and (b) plot of the difference $v_{O D}$ between the collector voltages of the PSpice circuit of Fig. 4.43
$v_{I D}$ from $-4 V_{T}\left(\cong-100 \mathrm{mV}\right.$ ) to $4 V_{T}(\cong+100 \mathrm{mV}$ ), we obtain the traces of Fig. 4.44.
We make the following observations:

- For $v_{I D}=0, I_{E E}$ splits equally between $Q_{1}$ and $Q_{2}$, giving $i_{C 1}=i_{C 2}=\alpha_{F} I_{E E} / 2 \cong$ 0.5 mA . With equal currents, $R_{C 1}$ and $R_{C 2}$ drop equal voltages, giving $v_{O 1}=v_{O 2}=$ $12-10 \times 0.5=7 \mathrm{~V}$. Consequently, $v_{O D}=v_{O 1}-v_{O 2}=0$, and we say that with $v_{I D}=0$ the EC pair is in dc balance.
- Raising $v_{I D}$ above 0 V makes $Q_{1}$ more conductive at the expense of $Q_{2}$ becoming less conductive ( $i_{C 1}$ increases while $i_{C 2}$ decreases). This current imbalance causes $v_{O 1}$ to drop while $v_{O 2}$ rises, causing a two-fold decrease in $v_{O D}$.
- As $v_{I D}$ reaches about $4 V_{T}(\cong 100 \mu \mathrm{~V})$, we can say that virtually all of $I_{E E}$ comes from $Q_{1}$ while $Q_{2}$ is essentially off. Consequently, $v_{O 1} \cong 12-10 \times 1=2 \mathrm{~V}$, $v_{O 2} \cong 12 \mathrm{~V}$, and $v_{O D} \cong 2-12=-10 \mathrm{~V}$. Increasing $v_{I D}$ further will simply cause $v_{O D}$ to saturate at -10 V .
- Lowering $v_{I D}$ below 0 V makes $Q_{2}$ more conductive and $Q_{1}$ less conductive. The roles of $Q_{1}$ and $Q_{2}$ are now interchanged, and the curves are therefore symmetric with respect to the origin. Lowering $v_{I D}$ below about -100 mV causes $v_{O D}$ to saturate at +10 V .
We are particularly interested in the voltage transfer curve (VTC) of Fig. 4.44b. Since BJTs are nonlinear devices, it is not surprising that this curve is also nonlinear. However, if we restrict operation in the vicinity of the origin, the VTC can be approximated with its tangent there, so we can write

$$
\begin{equation*}
v_{o d}=a v_{i d} \tag{4.74}
\end{equation*}
$$

where $v_{o d}$ and $v_{i d}$ are small variations of $v_{O D}$ and $v_{I D}$ about 0 V , and $a$ is the slope of the VTC at the origin, as indicated in the figure. Differentiating Eq. (4.73) and calculating the derivative at the origin gives

$$
\begin{equation*}
a=-\frac{\alpha_{F} I_{E E} R_{C}}{2 V_{T}}=-g_{m} R_{C} \tag{4.75}
\end{equation*}
$$

where

$$
\begin{equation*}
g_{m}=\frac{\alpha_{F} I_{E E}}{2 V_{T}} \cong \frac{I_{E E}}{2 V_{T}} \tag{4.76}
\end{equation*}
$$

is the transconductance of the BJTs at dc balance, where $I_{C 1}=I_{C 2} \cong 0.5 I_{E E}$. The slope of the VTC represents the small-signal voltage gain $a$. With the component values of Fig. 4.43, $a \cong-(1 / 0.052) \times 10=-192$ V/V. Note that unlike the circuits of Chapter 2, the EC pair achieves this gain without requiring any capacitors, and it does so all the way down to arbitrarily low signal frequencies, including dc!

Since the EC pair responds to the difference between its input voltages, it is also called a differential amplifier. Though the pair of Fig. 4.42 is based on npn BJTs, a differential amplifier can also be implemented using pnp devices, provided voltage and current polarities are suitably reversed (see Problem 4.40). As we move along, we will work with both $n p n$ and $p n p$ pairs.

### The Source-Coupled Pair

Figure 4.45 shows the MOS counterpart of the bipolar differential amplifier of Fig. 4.42. Its analysis proceeds pretty much as in the BJT case, except that the exponential characteristics of BJTs are now replaced by the quadratic characteristics of MOSFETs. (To keep things simple, in this section we assume $\lambda=0$ and $\gamma=0$.) Applying KVL around the input loop gives

$$
v_{l 1}-v_{G S 1}+v_{G S 2}-v_{12}=0
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-090.jpg?height=673&width=628&top_left_y=1394&top_left_x=449)

FIGURE 4.45 The source-coupled (SC) pair.
that is, $v_{G S 1}-v_{G S 2}=v_{I 1}-v_{I 2}$. Assuming saturated FETs, we use the familiar quadratic relationships to write

$$
v_{G S 1}=V_{t 1}+\sqrt{2 i_{D 1} / k_{1}} \quad v_{G S 2}=V_{t 2}+\sqrt{2 i_{D 2} / k_{2}}
$$

Matched FETs have $V_{t 1}=V_{t 2}=V_{t}$ and $k_{1}=k_{2}=k$, so the above relationships yield

$$
\begin{equation*}
v_{I D}=v_{I 1}-v_{I 2}=v_{G S 1}-v_{G S 2}=\frac{\sqrt{i_{D 1}}-\sqrt{i_{D 2}}}{\sqrt{k / 2}} \tag{4.77}
\end{equation*}
$$

By KCL, the transistor currents satisfy the condition

$$
\begin{equation*}
i_{D 1}+i_{D 2}=I_{S S} \tag{4.78}
\end{equation*}
$$

where we are ignoring $R_{S S}$, which in a well-designed circuit is very large. We have two equations in the two unknowns $i_{D 1}$ and $i_{D 2}$. Letting $i_{D 2}=I_{S S}-i_{D 1}$ in Eq. (4.77), squaring both sides, and rearranging, we get

$$
\sqrt{i_{D 1}\left(I_{S S}-i_{D 1}\right)}=\frac{1}{2}\left(I_{S S}-\frac{k}{2} v_{I D}^{2}\right)
$$

Squaring once again and rearranging,

$$
i_{D 1}^{2}-I_{S S} i_{D 1}+\frac{1}{4}\left(I_{S S}-\frac{k}{2} v_{I D}^{2}\right)^{2}=0
$$

Solving this quadratic equation and retaining only the physically acceptable solution we get

$$
\begin{equation*}
i_{D 1}=\frac{I_{S S}}{2}\left[1+\frac{v_{I D}}{\sqrt{I_{S S} / k}} \sqrt{1-\frac{v_{I D}^{2}}{4 I_{S S} / k}}\right] \tag{4.79a}
\end{equation*}
$$

Using again $i_{D 2}=I_{S S}-i_{D 1}$, we likewise find

$$
\begin{equation*}
i_{D 2}=\frac{I_{S S}}{2}\left[1-\frac{v_{I D}}{\sqrt{I_{S S} / k}} \sqrt{1-\frac{v_{I D}^{2}}{4 I_{S S} / k}}\right] \tag{4.79b}
\end{equation*}
$$

We also have, by KVL and Ohm's law,

$$
v_{O 1}=V_{D D}-R_{D} i_{D 1} \quad v_{O 2}=V_{D D}-R_{D} i_{D 2}
$$

Using the expressions of Eq. (4.79) we get, after suitable simplifications, an expression for the voltage difference at the output,

$$
\begin{equation*}
v_{O D}=v_{O 1}-v_{O 2}=-R_{D} \sqrt{k I_{S S}} v_{I D} \sqrt{1-\frac{v_{I D}^{2}}{4 I_{S S} / k}} \tag{4.80}
\end{equation*}
$$

We can readily plot Eqs. (4.79) and (4.80) using PSpice. In the circuit of Fig. 4.46 we have set $v_{l 2}=0$, so $v_{I D}=v_{I 1}$ in this case. After directing PSpice to sweep $v_{I D}$ from
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-092.jpg?height=614&width=600&top_left_y=210&top_left_x=449)

FIGURE 4.46 PSpice circuit to plot the transfer curves of an SC pair using FETs with $k=1.0 \mathrm{~mA} / \mathrm{V}^{2}$ and $V_{t}=1.0 \mathrm{~V}$.
-2 V to +2 V , we obtain the traces of Fig. 4.47, in connection with which we make the following observations:

- For $v_{I D}=0, I_{S S}$ splits equally between $M_{1}$ and $M_{2}$, giving $i_{D 1}=i_{D 2}=I_{S S} / 2=$ 0.5 mA . With equal currents, $R_{D 1}$ and $R_{D 2}$ drop equal voltages, giving $v_{O 1}=$ $v_{O 2}=12-10 \times 0.5=7 \mathrm{~V}$. Consequently, we have $v_{O D}=v_{O 1}-v_{O 2}=0$, and we say that the SC pair is in dc balance. The overdrive voltage $V_{O V}$ required of each FET to sustain $I_{S S} / 2$ is such that $I_{S S} / 2=(k / 2) V_{O V}^{2}$, or

$$
\begin{equation*}
V_{O V}=\sqrt{\frac{I_{S S}}{k}} \tag{4.81}
\end{equation*}
$$

In our example, $V_{O V}=\sqrt{1 / 1}=1 \mathrm{~V}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-092.jpg?height=523&width=717&top_left_y=1523&top_left_x=111)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-092.jpg?height=512&width=713&top_left_y=1531&top_left_x=916)
(b)

FIGURE 4.47 Plots of (a) the drain currents $i_{D 1}$ and $i_{D 2}$, and (b) plot of the difference $v_{O D}$ in the drain voltages for the PSpice circuit of Fig. 4.46.

- Raising $v_{I D}$ above 0 V makes $M_{1}$ more conductive at the expense of $M_{2}$ becoming less conductive ( $i_{D 1}$ increases while $i_{D 2}$ decreases). This imbalance causes $v_{O 1}$ to drop while $v_{O 2}$ rises, causing a two-fold decrease in $v_{O D}$.
- As we raise $v_{I D}$ further, we reach a point at which all of $I_{S S}$ will come from $M_{1}$ and none from $M_{2}$. For this to occur, $M_{1}$ 's overdrive must be $\sqrt{2}$ times as large as in Eq. (4.81), owing to the quadratic dependence of current on overdrive. At this point we have $v_{G S 2}=V_{t}$ and $v_{G S 1}=V_{t}+\sqrt{2} V_{O V}$, that is, $v_{I D}=\sqrt{2} V_{O V}$, with $V_{O V}$ as given in Eq. (4.81). Beyond this point, the voltages saturate at $v_{O 1} \cong$ $12-10 \times 1=2 \mathrm{~V}, v_{O 2} \cong 12 \mathrm{~V}$, and $v_{O D} \cong 2-12=-10 \mathrm{~V}$.
- Lowering $v_{I D}$ below 0 V makes $M_{2}$ more conductive and $M_{1}$ less conductive. The roles of $M_{1}$ and $M_{2}$ are now interchanged, thereby yielding curves that are symmetric about the origin. Saturation now occurs for $v_{I D} \leq-\sqrt{2} V_{O V}$, where $v_{O D}=+10 \mathrm{~V}$.
We are especially interested in the voltage transfer curve (VTC) of Fig. 4.47b. Since FETs are nonlinear devices, it is not surprising that this curve is also nonlinear. However, if we restrict operation in the vicinity of the origin, the VTC can be approximated with its tangent there, so we can write

$$
\begin{equation*}
v_{o d}=a v_{i d} \tag{4.82}
\end{equation*}
$$

where $v_{o d}$ and $v_{i d}$ represent small variations of $v_{O D}$ and $v_{I D}$ about 0 V , and $a$ is the slope of the VTC at the origin, as indicated in the figure. Differentiating Eq. (4.80) and calculating it at the origin gives

$$
\begin{equation*}
a=-R_{D} \sqrt{k I_{S S}}=-g_{m} R_{D} \tag{4.83}
\end{equation*}
$$

where

$$
\begin{equation*}
g_{m}=\sqrt{k I_{S S}} \tag{4.84a}
\end{equation*}
$$

is the transconductance of the FETs at dc balance, where $I_{D 1}=I_{D 2}=0.5 I_{S S}$. The slope of the VTC represents the small-signal voltage gain $a$. With the component values of Fig. 4.46 we have $a \cong-10 \times \sqrt{1 / 1}=-10 \mathrm{~V} / \mathrm{V}$. Unlike the circuits of Chapter 3, the SC pair achieves this gain without requiring any capacitors and it functions all the way down to arbitrarily low signal frequencies, including dc!

Since the SC pair responds to the difference between its input voltages, it is also called a differential amplifier. Though the pair of Fig. 4.45 is based on $n$-channel FETs, a differential amplifier can also be implemented using $p$-channel devices, provided voltage and current polarities are suitably reversed (see Problem 4.48). As we move along, we will work with both types of pairs.

Rewriting Eq. (4.84a) as

$$
\begin{equation*}
g_{m}=\frac{I_{S S}}{V_{O V}} \tag{4.84b}
\end{equation*}
$$

allows for the direct comparison with the BJT expression of Eq. (4.76): if an SC pair and an EC pair are biased equally, the ratio of the transconductances is $g_{m(\mathrm{SC})} / g_{m(\mathrm{EC})}=2 V_{T} / V_{O V}$. Typically, $g_{m(\mathrm{SC})} / g_{m(\mathrm{EC})} \ll 1$ because usually $V_{O V} \gg 2 V_{T}$.

### Intuitive Ac Analysis of Differential Pairs

Even though VTC analysis has already provided us with expressions for the smallsignal gains, in daily practice one needs to come up with quick ac parameter estimates by performing ac analysis directly on the circuit itself. The ability to investigate a circuit from different perspectives is highly desirable because it reinforces our understanding, not to mention that we can use one method to find results and another to check them.

Let us turn first to the EC pair of Fig. 4.48a, representing the ac equivalent of the circuit of Fig. 4.42. In small-signal operation the BJTs of Fig. 4.42 draw identical dc currents,

$$
\begin{equation*}
I_{C 1}=I_{C 2}=I_{C}=\frac{\alpha_{F} I_{E E}}{2} \cong \frac{I_{E E}}{2} \tag{4.85}
\end{equation*}
$$

so their transconductances are also identical,

$$
\begin{equation*}
g_{m 1}=g_{m 2}=g_{m}=\frac{I_{C}}{V_{T}} \cong \frac{I_{E E}}{2 V_{T}} \tag{4.86}
\end{equation*}
$$

Focusing on the lower part of the circuit, we can regard $Q_{1}$ as a unity-gain emitter follower with output resistance $R_{e 1}$ in turn loaded by the resistance $R_{e 2}$ provided by $Q_{2}$. Since $R_{e 1}=R_{e 2}$ at dc balance, the voltage divider rule indicates that the ac voltage at the shared emitter terminal is $v_{i} / 2$, as shown. The ac current into $Q_{1}$ 's collector is thus $i_{c}=g_{m 1} v_{b e 1}=$ $g_{m 1}\left(v_{b 1}-v_{e 1}\right)=g_{m 1}\left(v_{i}-v_{i} / 2\right)=g_{m} v_{i} / 2$. This current emerges out of $Q_{1}$ 's emitter as $i_{e}\left(=i_{c} / \alpha_{0}\right)$, it flows into $Q_{2}$ 's emitter, and emerges once again out of $Q_{2}$ 's collector as $\alpha_{0} i_{e}$, that is, it emerges again as $i_{c}$ (the fact that $v_{b e 1}=v_{i} / 2$ and $v_{b e 2}=-v_{i} / 2$ confirms equal magnitudes but opposite polarities for the two $i_{c}$ currents). By KVL and Ohm's Law we have $v_{o}=v_{o 1}-v_{o 2}=-R_{C} i_{c}-\left(R_{C} i_{c}\right)=-2 R_{C} i_{c}=-2 R_{C} g_{m} v_{i} / 2=-g_{m} R_{C} v_{i}$, so

$$
\begin{equation*}
a=\frac{v_{o}}{v_{i}}=-g_{m} R_{C} \tag{4.87}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-094.jpg?height=659&width=1097&top_left_y=1429&top_left_x=438)

FIGURE 4.48 Small-signal equivalents of (a) the EC pair, and (b) the SC pair.
where $a$ is the already familiar differential gain of the EC pair. Expressing it in the alternative form

$$
\begin{equation*}
a=-\frac{R_{C} I_{E E} / 2}{V_{T}} \tag{4.88}
\end{equation*}
$$

allows us to estimate the gain of the EC pair by taking the ratio of the voltage $R_{C} \times$ $\left(I_{E E} / 2\right)$ dropped at dc balance by the collector resistors to the thermal voltage $V_{T}$. Recall from Chapter 2 that the small-signal approximation holds so long as $\left|v_{b e}\right| \ll 2 V_{T}$. Considering that presently we have $v_{b e 1}=-v_{b e 2}=v_{i} / 2$, the small-signal condition is now

$$
\begin{equation*}
\left|v_{i}\right| \ll 4 V_{T} \tag{4.89}
\end{equation*}
$$

Thus, for the small-signal approximation to hold with an error of no more than about $10 \%$, we approximately need $\left|v_{i}\right| \leq 10 \mathrm{mV}$.

Turning next to the SC pair of Fig. 4.48b, representing the ac equivalent of the circuit of Fig. 4.45, we note its formal similarity to its bipolar counterpart of Fig. 4.48a, and conclude that we can recycle a good deal of previous derivations. Thus, at dc balance the FETs draw identical dc currents,

$$
\begin{equation*}
I_{D 1}=I_{D 2}=I_{D}=\frac{I_{S S}}{2} \tag{4.90}
\end{equation*}
$$

so their transconductances are also identical,

$$
\begin{equation*}
g_{m 1}=g_{m 2}=g_{m}=\sqrt{k I_{S S}} \tag{4.91}
\end{equation*}
$$

We can view $M_{1}$ as a unity-gain source follower with output resistance $R_{s 1}$, in turn loaded by the resistance $R_{s 2}$ provided by $M_{2}$ 's source. Since $R_{s 1}=R_{s 2}$ at dc balance, the voltage divider rule indicates that the ac voltage at the shared source terminal is $v_{i} / 2$, as shown. The ac current into $M_{1}$ 's drain is thus $i_{d}=g_{m 1} v_{g s 1}=g_{m 1}\left(v_{g 1}-v_{s 1}\right)=$ $g_{m} v_{i} / 2$. This current exits $M_{1}$ 's source, enters $M_{2}$ 's source, and finally exits $M_{2}$ 's drain (this is confirmed by the fact that with $v_{g s 1}=v_{i} / 2$ and $v_{s s 2}=-v_{i} / 2$ the two $i_{d}$ currents have equal magnitudes but opposite polarities). Finally, $v_{o}=v_{o 1}-v_{o 2}=-R_{D} i_{d}-$ $\left(R_{D} i_{d}\right)=-2 R_{D} g_{m} v_{i} / 2=R_{D} g_{m} v_{i}$, so

$$
\begin{equation*}
a=\frac{v_{o}}{v_{i}}=-g_{m} R_{D} \tag{4.92}
\end{equation*}
$$

This is the already familiar differential gain of the SC pair. Expressing it in the alternative form

$$
\begin{equation*}
a=-\frac{R_{D} I_{S S} / 2}{0.5 V_{o V}} \tag{4.93}
\end{equation*}
$$

allows us to estimate the gain achievable with this circuit as the ratio of the voltage $R_{D} \times\left(I_{S S} / 2\right)$ dropped by the drain resistors at dc balance to half the overdrive voltage. Recall from Chapter 3 that the small-signal approximation holds provided we keep
$\left|v_{g s}\right| \ll 2 V_{O V}$. Considering that presently we have $v_{g s 1}=-v_{g s 2}=v_{i} / 2$, the small-signal condition is now

$$
\begin{equation*}
\left|v_{i}\right| \ll 4 V_{O V} \tag{4.94}
\end{equation*}
$$

Looking at Fig. 4.47b, where $V_{O V}=1 \mathrm{~V}$, we see that a reasonable choice is to restrict the input within the range $\left|v_{i}\right| \leq 0.5 V_{O V}$ (or 0.5 V in our example).

## 4.6 COMMON-MODE REJECTION RATIO IN DIFFERENTIAL PAIRS

As implied by its name, a differential amplifier responds only to the difference $v_{i d}=v_{i 1}-v_{i 2}$, regardless of the individual values of $v_{i 1}$ and $v_{i 2}$. For instance, when subjected to any one of the following input pairs

$$
\left(v_{i 1}, v_{i 2}\right)=(0.005 \mathrm{~V}, 0.000 \mathrm{~V}),(1.005 \mathrm{~V}, 1.000 \mathrm{~V}),(-2.000 \mathrm{~V},-2.005 \mathrm{~V})
$$

a differential amplifier with a gain of, say, $-100 \mathrm{~V} / \mathrm{V}$ will respond only to their difference ( $v_{i d}=5 \mathrm{mV}$ in each of the three cases) to give $v_{o}=-100 \times 5=-500 \mathrm{mV}$, even though the individual inputs are in the vicinity of 0 V in the first case, 1 V in the second case, and -2 V in the third case. For a more systematic analysis, it is convenient to define the differential-mode input as

$$
\begin{equation*}
v_{i d}=v_{i 1}-v_{i 2} \tag{4.95a}
\end{equation*}
$$

and the average, or common-mode input as

$$
\begin{equation*}
v_{i c}=\frac{v_{i 1}+v_{i 2}}{2} \tag{4.95b}
\end{equation*}
$$

Turning these equations around allows us to express the original signals in the insightful forms

$$
\begin{equation*}
v_{i 1}=v_{i c}+\frac{v_{i d}}{2} \quad v_{i 2}=v_{i c}-\frac{v_{i d}}{2} \tag{4.96}
\end{equation*}
$$

The process is illustrated pictorially in Fig. 4.49. Based in this decomposition, we can now state succinctly that a true differential amplifier responds only to $v_{i d}$, regardless of $v_{i c}$.

In practice, because of unavoidable imbalances in the two circuit halves that are processing $v_{i 1}$ and $v_{i 2}$, a real-life amplifier will be somewhat sensitive also to $v_{i c}$. The small-signal output takes on the more general form

$$
\begin{equation*}
v_{o}=a_{d m} v_{i d}+a_{c m} v_{i c} \tag{4.97}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-097.jpg?height=373&width=1115&top_left_y=215&top_left_x=199)

FIGURE 4.49 Expressing (a) the input signals $v_{i 1}$ and $v_{i 2}$ of a differential amplifier in terms of (b) their common-mode and differential-mode components $v_{i c}$ and $v_{i d}$.
where $a_{d m}$ and $a_{c m}$ are the differential-mode and common-mode gains. Ideally, $a_{c m}$ should be zero, but in practice it will differ from zero, though presumably by very little. To tell how close a practical differential amplifier is to ideal, we use a figure of merit known as the common-mode rejection ratio (CMRR),

$$
\begin{equation*}
\mathrm{CMRR}=\left|\frac{a_{d m}}{a_{c m}}\right| \tag{4.98}
\end{equation*}
$$

In a high-quality differential amplifier this ratio can be rather high, such as $10^{5}$, so CMRR is usually expressed in decibels ( $20 \log 10^{5}=100 \mathrm{~dB}$ ).

Being referenced to ground, both $v_{i 1}$ and $v_{i 2}$ in Fig. 4.49 are said to be single-ended signals. As a signal propagates down a wire or a printed-circuit trace, it tends to pick up all sorts of interference noise from nearby circuits via capacitive and inductive coupling, as well as via the imperfect common ground wire or trace. Consequently, by the time it reaches its destination, the signal may have experienced significant corruption, making recovery of the useful information a formidable task. A clever trick is to work with double-ended signals, where the useful signal is now the voltage difference $v_{i d}$ between a pair of dedicated wires, rather than between a single wire and ground. If these dedicated wires are run in parallel and close to each other, interference with respect to ground will affect them equally, thus appearing as a common-mode component $v_{i c}$. Then, processing a double-ended signal with a high-CMRR difference amplifier will magnify $v_{i d}$ while rejecting $v_{i c}$, thus assuring a high degree of signal integrity.

### CMRR and Input Resistances of the EC Pair

We wish to find the CMRR of the EC pair of Fig. 4.42. With reference to Fig. 4.49b and Eq. (4.97), we proceed in two steps. First, we let $v_{i c}=0$ and find $a_{d m}=v_{o} / v_{i d}$. Then, we let $v_{i d}=0$ and find $a_{c m}=v_{o} / v_{i c}$. Finally, we plug our results into Eq. (4.98).

With $v_{i c}=0$, the circuit of Fig. 4.42 reduces to the ac equivalent of Fig. 4.50a. Looking at the lower portion of the circuit, we can regard $Q_{1}$ and $Q_{2}$ as emitter followers with $Q_{1}$ trying to pull the common emitter voltage $v_{e}$ up, and $Q_{2}$ trying to pull $v_{e}$ down by the same amount. Consequently, $v_{e}$ will remain at ac ground. Also, $v_{o d}$ splits symmetrically between the two halves of the circuit, with $v_{o d} / 2$ appearing
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-098.jpg?height=673&width=1100&top_left_y=166&top_left_x=453)

FIGURE 4.50 (a) Ac circuit to find the differential-mode parameters of the EC pair, and (b) differential-mode half circuit.
at $Q_{1}$ 's collector, and $-v_{o d} / 2$ at $Q_{2}$ 's collector. We can thus focus on just one of the two halves, say, the left half, as shown in Fig. 4.50b. (Note that because the common emitter node is at ac ground, $R_{E E}$ plays no role in this case). This is the familiar CE configuration, for which $v_{o d} / 2=-g_{m}\left(R_{C} / r_{o}\right)\left(v_{i d} / 2\right)$, so

$$
\begin{equation*}
a_{d m}=\frac{v_{o d}}{v_{i d}}=-g_{m}\left(R_{C} / / r_{o}\right) \tag{4.99}
\end{equation*}
$$

This is an already familiar result, but the ability to confirm it via the half-circuit analysis technique offers further insight into balanced operation.

Next, we let $v_{i d}=0$, reducing the circuit of Fig. 4.42 to that of Fig. 4.51a, where the reason for splitting $R_{E E}$ into a pair of $2 R_{E E} \mathrm{~s}$ in parallel will be obvious in a moment. Since the two identical halves are driven by the same voltage $v_{i c}$, the collector voltages will be identical, so we label them with the same symbol $v_{o c}$. Moreover, no current will flow through the wire connecting the two emitters, so we can remove this wire altogether without altering circuit operation, and focus on just one half of the circuit, say, the left half, as shown in Fig. 4.51b. This is the familiar CE-ED configuration for which we readily find

$$
\begin{equation*}
a_{c m}=\frac{v_{o c}}{v_{i c}}=-\frac{g_{m} R_{C}}{1+2 g_{m} R_{E E}} \tag{4.100}
\end{equation*}
$$

(In this case $r_{o}$ has been ignored altogether as emitter degeneration raises its effective value dramatically.)

Depending on the intended use of the differential pair outputs, we have two possibilities:

- The output is taken single-endedly from either one of the two collectors. In this case the CMRR is the ratio of one-half the gain of Eq. (4.99) to that of Eq. (4.100). If we ignore $r_{o}$, this ratio simplifies as
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-099.jpg?height=694&width=1074&top_left_y=165&top_left_x=205)

FIGURE 4.51 (a) Ac circuit to find the common-mode parameters of the EC pair, and (b) common-mode half circuit.

$$
\begin{equation*}
\mathrm{CMRR} \cong \frac{1}{2}+g_{m} R_{E E} \cong g_{m} R_{E E} \tag{4.101}
\end{equation*}
$$

- The output is taken differentially, that is, between the two collectors. Since their voltage difference is zero regardless of $v_{i c}$, then $a_{c m}=\left(v_{o 1}-v_{o 2}\right) / v_{i c}=0$ in this case, so Eq. (4.98) gives

$$
\begin{equation*}
\mathrm{CMRR}=\infty \tag{4.102}
\end{equation*}
$$

This last result predicates two perfectly balanced circuit halves. In practice, unavoidable mismatches between the two halves will result in a non-infinite CMRR, as we shall see shortly.

An EC pair is fully characterized once we know also its differential-mode and common-mode input resistances $R_{i d}$ and $R_{i c}$. With reference to Fig. $4.50 b$, we have, by inspection, $R_{i d} / 2=r_{\pi}$, so the overall resistance between the inputs of the EC pair is the sum of the two halves, or

$$
\begin{equation*}
R_{i d}=2 r_{\pi} \tag{4.103}
\end{equation*}
$$

On the other hand, the resistance between either input and ground is, from Fig. 4.51b,

$$
\begin{equation*}
R_{i c}=r_{\pi}+2\left(\beta_{0}+1\right) R_{E E} \tag{4.104}
\end{equation*}
$$

This may be truly large, in which case it may be advisable to take $r_{\mu}$ into account.
(a) In the bipolar pair of Fig. 4.42 let $V_{C C}=-V_{E E}=5 \mathrm{~V}, I_{E E}=0.2 \mathrm{~mA}$, $R_{C}=30 \mathrm{k} \Omega$, and $R_{E E}=500 \mathrm{k} \Omega$. If $\beta_{0}=200, V_{A}=75 \mathrm{~V}$, and $r_{\mu}=1000 r_{o}$, find $a_{d m}, a_{c m}$, CMRR (in dB), $R_{i d}$, and $R_{i c}$.
(b) Suppose the inputs are tied together and driven by a common-mode voltage $v_{I C}$. Assuming $V_{B E(\mathrm{on})}=0.6 \mathrm{~V}$ and $V_{C E(\mathrm{EOS})}=0.2 \mathrm{~V}$, find the maximum value of $v_{I C}$ for which the BJTs are still operating in the forward-active region.

### Solution

(a) We have $I_{C} \cong I_{E E} / 2=0.2 / 2=0.1 \mathrm{~mA}, g_{m}=0.1 / 26=1 /(260 \Omega), r_{\pi}=$ $200 \times 260=52 \mathrm{k} \Omega, r_{o}=75 / 0.1=750 \mathrm{k} \Omega$, and $r_{\mu}=750 \mathrm{M} \Omega$. Then, $a_{d m}=-(30 / / 750) / 0.260=-111 \mathrm{~V} / \mathrm{V}, a_{c m}=-(30 / 0.26) /(1+2 \times 500 / 0.26)=$ -0.03 V/V, single-ended CMRR $=500 / 0.260=1923=65.7 \mathrm{~dB}$, differential CMRR $=\infty, R_{i d}=2 \times 52=104 \mathrm{k} \Omega$, and $R_{i c} \cong(0.52+2 \times 201 \times$ $0.5) / / 750=201 / / 750=159 \mathrm{M} \Omega$ ( $r_{\mu}$ has negligible impact).
(b) At dc balance we have $V_{C}=5-30 \times 0.1=2 \mathrm{~V}$. To bring the BJTs to the edge of saturation we need to raise their common emitter voltage to $V_{E}=$ $V_{C}-V_{C E(\mathrm{EOS})}=2-0.2=1.8 \mathrm{~V}$. Consequently, $v_{I C(\max )}=V_{E}+V_{B E(\mathrm{on})}=$ $1.8+0.6 \mathrm{~V}=2.4 \mathrm{~V}$.

### CMRR of the SC Pair

The half-circuit analysis technique applied to bipolar pairs holds for MOS pairs just as well. These circuits are shown in Fig. 4.52, and their similarity to their bipolar counterparts indicates that we can reuse a good deal of already familiar insight and equations. Thus, the half circuit of Fig. $4.52 a$ gives

$$
\begin{equation*}
a_{d m}=\frac{v_{o d}}{v_{i d}}=-g_{m}\left(R_{D} / / r_{o}\right) \tag{4.105}
\end{equation*}
$$

Likewise, the half circuit of Fig. $4.52 b$ gives, by Eq. (4.39a),

$$
\begin{equation*}
a_{c m}=\frac{v_{o c}}{v_{i c}}=-\frac{g_{m} R_{D}}{1+2\left(g_{m}+g_{m b}\right) R_{S S}+\left(R_{D}+2 R_{S S}\right) / r_{o}} \tag{4.106}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-100.jpg?height=438&width=299&top_left_y=1608&top_left_x=449)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_b3aa03c3ba90cdf1bf1cg-100.jpg?height=480&width=356&top_left_y=1594&top_left_x=827)

FIGURE 4.52 Half circuits to find the (a) differentialmode gain and (b) common-mode gain of an SC pair.

where $g_{m b}$ is the body transconductance. For single-ended utilization, the CMRR is the ratio of one-half the gain of Eq. (4.105) to that of Eq. (4.106). If $r_{o}$ is sufficiently large, we can approximate

$$
\begin{equation*}
\mathrm{CMRR} \cong \frac{1}{2}+\left(g_{m}+g_{m b}\right) R_{S S} \cong\left(g_{m}+g_{m b}\right) R_{S S} \tag{4.107}
\end{equation*}
$$

For differential output utilization we have

$$
\begin{equation*}
\mathrm{CMRR}=\infty \tag{4.108}
\end{equation*}
$$

An advantage of FETs compared to BJTs is that

$$
\begin{equation*}
R_{i d}=R_{i c}=\infty, \tag{4.109}
\end{equation*}
$$

(a) In the MOS pair of Fig. 4.45 let $V_{D D}=-V_{E E}=2.5 \mathrm{~V}, I_{S S}=0.2 \mathrm{~mA}$, $R_{D}=10 \mathrm{k} \Omega$, and $R_{S S}=1 \mathrm{M} \Omega$. If the FETs have $k=1.25 \mathrm{~mA} / \mathrm{V}^{2}, V_{t}=0.4 \mathrm{~V}$, $\chi=0.2$, and $\lambda=1 /(10 \mathrm{~V})$, find $a_{d m}, a_{c m}$, and CMRR.
(b) If the inputs are tied together and driven by a common-mode voltage $v_{I C}$, what is the maximum value of $v_{I C}$ for which the FETs will still operate in saturation?

### Solution

(a) We have $I_{D} \cong I_{S S} / 2=0.2 / 2=0.1 \mathrm{~mA}, g_{m}=\left(2 k I_{D}\right)^{1 / 2}=(2 \times 1.25 \times 0.1)^{1 / 2}=$ $0.5 \mathrm{~mA} / \mathrm{V}, r_{o}=1 /\left(\lambda I_{D}\right)=10 / 0.1=100 \mathrm{k} \Omega ; a_{d m}=-0.5 \times(10 / / 100)=-4.55 \mathrm{~V} / \mathrm{V}$, $a_{c m}=-0.5 \times 10 /[1+2(1.2 \times 0.5 \times 1000)+(10+2000) / 100]=$ $-4.1 \times 10^{-3} \mathrm{~V} / \mathrm{V}$; single-ended CMRR $=0.5 \times 1.2 \times 1000=600=55.6 \mathrm{~dB}$, differential CMRR $=\infty$.
(b) At dc balance we have $V_{D}=2.5-10 \times 0.1=1.5 \mathrm{~V}$. To bring the FETs to the edge of saturation we need to raise $v_{I C}$ till $V_{D S}=V_{O V}$, or $V_{S}=V_{D}-V_{O V}$. The corresponding input, denoted as $v_{I C(\max )}$, is such that $v_{I C(\max )}=V_{S}+$ $\left(V_{t}+V_{O V}\right)=V_{D}-V_{O V}+V_{t}+V_{O V}=V_{D}+V_{t}=1.5 \mathrm{~V}+0.4=1.9 \mathrm{~V}$.

### Effect of Mismatches on the CMRR

With perfectly matched halves, the collector resistors drop identical voltages in Fig. 4.53a, so the collector signals cancel each other out exactly to give $a_{c m}=$ $\left(v_{o 1}-v_{o 2}\right) / v_{i c}=0 / v_{i c}=0$, and therefore CMRR $=\infty$, by Eq. (4.98). (Similar considerations hold in the MOS circuit of Fig. $4.53 b$, so the following analysis applies both to the EC and SC pairs.) In practice, the two halves of a differential pair are likely to be mismatched, even if only slightly, so it is of interest to investigate the impact on the CMRR. The two main factors to be considered are (a) mismatched
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-002.jpg?height=631&width=1067&top_left_y=166&top_left_x=446)

FIGURE 4.53 Ac circuits to investigate the effect of $R$ and $g_{m}$ mismatches upon the CMRR.
collector resistances $R_{C 1}$ and $R_{C 2}$, and (b) mismatched BJT transconductances $g_{m 1}$ and $g_{m 2}$. We assume that these mismatches are small enough that we can still approximate

$$
\begin{equation*}
a_{d m}=\frac{v_{o d}}{v_{i d}} \cong-g_{m} R_{C} \tag{4.110}
\end{equation*}
$$

with $g_{m}$ and $R_{C}$ representing the average values of the transconductances and resistances,

$$
g_{m}=\frac{g_{m 1}+g_{m 2}}{2} \quad R_{C}=\frac{R_{C 1}+R_{C 2}}{2}
$$

Moreover, with sufficiently small mismatches in Fig. 4.53a, we can still approximate

$$
\begin{equation*}
a_{c m}=\frac{v_{o 1}-v_{o 2}}{v_{i c}} \cong-\frac{g_{m 1} R_{C 1}-g_{m 2} R_{C 2}}{1+2 g_{m} R_{E E}} \tag{4.111}
\end{equation*}
$$

If we introduce the differences

$$
\Delta g_{m}=g_{m 1}-g_{m 2} \quad \Delta R_{C}=R_{C 1}-R_{C 2}
$$

then it is readily seen that the individual transconductances and resistances can be expressed as

$$
\begin{array}{rlr}
g_{m 1} & =g_{m}+\frac{\Delta g_{m}}{2} & g_{m 2}=g_{m}-\frac{\Delta g_{m}}{2} \\
R_{C 1} & =R_{C}+\frac{\Delta R_{C}}{2} & R_{C 2}=R_{C}-\frac{\Delta R_{C}}{2}
\end{array}
$$

Substituting into Eq. (4.111) gives

$$
a_{c m} \cong-\frac{\left(g_{m}+\frac{\Delta g_{m}}{2}\right)\left(R_{C}+\frac{\Delta R_{C}}{2}\right)-\left(g_{m}-\frac{\Delta g_{m}}{2}\right)\left(R_{C}-\frac{\Delta R_{C}}{2}\right)}{1+2 g_{m} R_{E E}}
$$

Expanding and ignoring higher-order terms ( $\Delta$-term products or squares), we get, after simplifying,

$$
\begin{equation*}
a_{c m} \cong-\frac{g_{m} \Delta R_{C}+\Delta g_{m} R_{C}}{1+2 g_{m} R_{E E}} \tag{4.112}
\end{equation*}
$$

Finally, substituting Eqs. (4.112) and (4.110) into Eq. (4.98) gives

$$
\begin{equation*}
\mathrm{CMRR} \cong \frac{1+2 g_{m} R_{E E}}{\Delta R_{C} / R_{C}+\Delta g_{m} / g_{m}} \tag{4.113}
\end{equation*}
$$

The above equations refer to the worst-case scenario in which the mismatches conspire to reinforce each other. However, the two causes of mismatch are usually uncorrelated, so a more realistic estimate for the CMRR of the EC pair is found as ${ }^{1}$

$$
\begin{equation*}
\mathrm{CMRR}_{(\mathrm{BJT})} \cong \frac{1+2 g_{m} R_{E E}}{\sqrt{\left(\Delta R_{C} / R_{C}\right)^{2}+\left(\Delta g_{m} / g_{m}\right)^{2}}} \tag{4.114a}
\end{equation*}
$$

We can readily adapt this expression to the SC pair of Fig. $4.53 b$ by writing

$$
\begin{equation*}
\mathrm{CMRR}_{(\mathrm{MOS})} \cong \frac{1+2\left(g_{m}+g_{m b}\right) R_{S S}}{\sqrt{\left(\Delta R_{D} / R_{D}\right)^{2}+\left(\Delta g_{m} / g_{m}\right)^{2}}} \tag{4.114b}
\end{equation*}
$$

It is apparent that for given amounts of mismatch, the CMRR is approximately proportional to the equivalent resistance $R_{E E}$ or $R_{S S}$ presented by the biasing current sink. To ensure high CMRR values, this source is typically a high output-resistance source, such as a cascode source or other source types to be investigated in Section 4.8.
(a) Suppose the $g_{m}$ 's in an SC pair are in the range of $100 \pm 10 \mu \mathrm{~A} / \mathrm{V}$, and the drain resistances have tolerances of $\pm 5 \%$. If $\chi=0.15$ and $R_{S S}=500 \mathrm{k} \Omega$, estimate the worst-case scenario CMRR. What if the tolerances are uncorrelated?
(b) Find the value of $R_{S S}$ needed to ensure CMRR $\geq 60 \mathrm{~dB}$.

### Solution

(a) By inspection, $\Delta R_{D} / R_{D}=0.1$. We also have $g_{m}+g_{m b}=(1+\chi) g_{m}=$ $115 \mu \mathrm{~A} / \mathrm{V}, \Delta g_{m}=20 \mu \mathrm{~A} / \mathrm{V}$, and $\Delta g_{m} / g_{m}=20 / 100=0.2$. In the worst-case scenario,

$$
\mathrm{CMRR} \cong \frac{1+2(115) 10^{-6} \times 500 \times 10^{3}}{0.1+0.2}=\frac{116}{0.3}=387=51.7 \mathrm{~dB}
$$

If the mismatches are uncorrelated, then use Eq. (4.114b) and write

$$
\mathrm{CMRR} \cong \frac{116}{\sqrt{0.1^{2}+0.2^{2}}}=\frac{116}{0.224}=519=54.3 \mathrm{~dB}
$$

(b) To raise CMRR to 60 dB , or 1,000 , we need to increase $R_{S S}$ in proportion, that is, $R_{S S}=(500 \mathrm{k} \Omega) \times(1000 / 519)=964 \mathrm{k} \Omega$.

## 4.7 INPUT OFFSET VOLTAGE/CURRENT IN DIFFERENTIAL PAIRS

If we ground both inputs of a differential pair, as depicted in Fig. 4.54 for a bipolar pair, we expect $V_{O}=0$. However, because of fabrication process variations, the two halves of the circuit are likely to be somewhat mismatched, resulting in an output error $E_{O} \neq 0$. We can visualize the effect of mismatches as a shift in the VTC of Fig. $4.44 b$ either to the right or to the left, depending on the direction of the mismatch. If we want to drive the output to zero we need to apply a corrective input voltage that will offset the VTC in the opposite direction until it goes through the origin. This corrective voltage is the input offset voltage $V_{o S}$ depicted in Fig. 4.54b. By inspection, we find $V_{O S}$ by reflecting the negative of $E_{O}$ to the input, or

$$
\begin{equation*}
V_{o S}=\frac{E_{O}}{-a_{d m}} \tag{4.115}
\end{equation*}
$$

where $a_{d m}$ is the differential-mode gain of the pair under consideration.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-004.jpg?height=689&width=1057&top_left_y=1318&top_left_x=432)

FIGURE 4.54 (a) A practical EC pair with grounded inputs generally gives an output error $E_{O} \neq 0$. (b) $V_{O S}$ is defined as the input voltage required to null $E_{0}$.

### Input Offset Voltage of the EC Pair

Two main factors contribute to the $V_{O S}$ of an EC pair: (a) mismatched collector resistances $R_{C 1}$ and $R_{C 2}$, and (b) mismatched saturation currents $I_{s 1}$ and $I_{s 2}$ of the BJTs. By Eq. (2.11), mismatches between $I_{s 1}$ and $I_{s 2}$ stem, in turn, from mismatches between the emitter areas $A_{E 1}$ and $A_{E 2}$ and between the base widths $W_{B 1}$ and $W_{B 2}$, as well as differences in the base-region doping densities and in the individual temperatures of the two devices. Moreover, because of the Early effect, $W_{B 1}$ and $W_{B 2}$ depend on the voltages $V_{C E 1}$ and $V_{C E 2}$, so even two BJTs fabricated perfectly identical will exhibit saturation-current mismatches if operated at different $V_{C E}$ values.

- To investigate the effect of mismatched $R_{C 1}$ and $R_{C 2}$, assume the BJTs are perfectly matched so that in the circuit of Fig. $4.54 a$ we have $I_{C 1}=I_{C 2} \cong I_{E E} / 2$. The contribution to $E_{O}$ is

$$
E_{O 1}=V_{C C}-R_{C 1} I_{C 1}-\left(V_{C C}-R_{C 2} I_{C 2}\right)=-\Delta R_{C} \frac{I_{E E}}{2}
$$

where $\Delta R_{C}=R_{C 1}-R_{C 2}$. Dividing by $-a_{d m} \cong g_{m} R_{C}$, with $R_{C}$ representing the mean value of the two resistances, or $R_{C}=\left(R_{C 1}+R_{C 2}\right) / 2$, and $g_{m}=\left(I_{E E} / 2\right) / V_{T}$, we get

$$
\begin{equation*}
V_{O S 1} \cong-V_{T} \frac{\Delta R_{C}}{R_{C}} \tag{4.116}
\end{equation*}
$$

- To investigate the effect of mismatched $I_{s 1}$ and $I_{s 2}$, assume the resistances are now perfectly matched. Since the BJTs of Fig. $4.54 a$ experience the same drive $V_{B E}$, the current $I_{E E}$ must split between $Q_{1}$ and $Q_{2}$ in proportion to $I_{s 1}$ and $I_{s 2}$,

$$
I_{C 1} \cong \frac{I_{E E}}{2}\left(1+\frac{\Delta I_{s}}{2 I_{s}}\right) \quad I_{C 2} \cong \frac{I_{E E}}{2}\left(1-\frac{\Delta I_{s}}{2 I_{s}}\right)
$$

where $\Delta I_{s}=I_{s 1}-I_{s 2}$ and $I_{s}=\left(I_{s 1}+I_{s 2}\right) / 2$, as usual. The contribution to $E_{O}$ is now

$$
E_{O 2}=V_{C C}-R_{C} I_{C 1}-\left(V_{C C}-R_{C} I_{C 2}\right)=-R_{C} \frac{I_{E E}}{2} \frac{\Delta I_{s}}{I_{s}}
$$

Again dividing by $-a_{d m}$ we get

$$
\begin{equation*}
V_{O S 2} \cong-V_{T} \frac{\Delta I_{s}}{I_{s}} \tag{4.117}
\end{equation*}
$$

Note that the negative signs in Eqs. (4.116) and (4.117) are not relevant because a mismatch can occur in either direction, depending on the random variation of the fabrication process. It is thus customary to drop the sign and to express $V_{O S}$ always as a positive number. In general the two causes of offset voltage are uncorrelated, so the total offset voltage is usually estimated as ${ }^{1}$

$$
\begin{equation*}
V_{o s} \cong V_{T} \sqrt{\left(\frac{\Delta R_{C}}{R_{C}}\right)^{2}+\left(\frac{\Delta I_{s}}{I_{s}}\right)^{2}} \tag{4.118}
\end{equation*}
$$

Suppose the EC pair of Example 4.18 is implemented with resistances afflicted by $\pm 5 \%$ tolerances and with BJTs whose saturation currents are afflicted by $\pm 10 \%$ tolerances. Estimate $V_{O S}$ and $E_{O}$.

### Solution

We have $\Delta R_{C} / R_{C}=0.1$ and $\Delta I_{s} / I_{s}=0.2$. Applying Eq. (4.118) gives

$$
V_{O S} \cong(26 \mathrm{mV}) \sqrt{(0.1)^{2}+(0.2)^{2}}=5.8 \mathrm{mV}
$$

Note that $V_{O S}$ may be positive or negative, depending on the direction of the mismatch. $E_{O}=\left|a_{d m}\right| V_{O S}=111 \times 5.8=644 \mathrm{mV}$.

### Input Bias Current and Offset Current of the EC Pair

When an EC pair is driven by sources having nonzero series resistances it is of interest to know the currents into the bases of the BJTs because these currents flow through the source resistances, causing voltage drops that may upset the dc balance of the pair appreciably. With perfectly matched devices, the base currents are $I_{B 1}=I_{B 2}=I_{B}$, where

$$
\begin{equation*}
I_{B}=\frac{I_{E E}}{2\left(\beta_{F}+1\right)} \tag{4.119}
\end{equation*}
$$

However, any mismatches in the $\beta_{F} \mathrm{~s}$ of the two BJTs will cause mismatches in the base currents. If we define the input bias current $I_{B}$ and the input offset current $I_{O S}$ of an EC pair as

$$
\begin{equation*}
I_{B}=\frac{I_{B 1}+I_{B 2}}{2} \quad I_{O S}=I_{B 1}-I_{B 2} \tag{4.120}
\end{equation*}
$$

then a beta mismatch $\Delta \beta_{F}$ will result in $I_{O S} \neq 0$. The two are related as

$$
\begin{equation*}
I_{O S} \cong-I_{B} \frac{\Delta \beta_{F}}{\beta_{F}} \tag{4.121}
\end{equation*}
$$

where $\beta_{F}=\left(\beta_{F 1}+\beta_{F 2}\right) / 2$, as usual. For instance, with a $10 \%$ beta mismatch, $I_{O S}$ is $10 \%$ of $I_{B}$.

### Input Offset Voltage of the SC Pair

Three main factors contribute to $V_{O S}$ in the case of an SC pair: (a) mismatched drain resistances $R_{D 1}$ and $R_{D 2},(b)$ mismatched device transconductance parameters $k_{1}$ and $k_{2}$, and (c) mismatched threshold voltages $V_{t 1}$ and $V_{t 2}$. By Eqs. (3.13) and (3.14), mismatches between $k_{1}$ and $k_{2}$ stem, in turn, from mismatches between the ratios $W_{1} / L_{1}$ and $W_{2} / L_{2}$ as well as variations in the oxide thickness $t_{o x}$ and temperature gradients from one device to the other. By Eqs. (3.7) through (3.9), mismatches between $V_{t 1}$ and $V_{t 2}$ are the result of differences in the implant densities, oxide thickness, and temperature of the two devices. Finally, because of the channel-length modulation effect, $L_{1}$ and $L_{2}$ depend on
the voltages $V_{D S 1}$ and $V_{D S 2}$, so even two FETs fabricated perfectly identical will exhibit transconductance-parameter mismatches if operated at different $V_{D S}$ values.

- To investigate the effect of mismatched $R_{D 1}$ and $R_{D 2}$, proceed as in the bipolar case and write

$$
E_{O 1} \cong-\Delta R_{D} \frac{I_{S S}}{2}
$$

where $\Delta R_{D}=R_{D 1}-R_{D 2}$. Dividing by $-a_{d m} \cong g_{m} R_{D}$, with $R_{D}$ representing the mean value of the two resistances, or $R_{D}=\left(R_{D 1}+R_{D 2}\right) / 2$, and with $g_{m}=$ $2\left(I_{S S} / 2\right) / V_{O V}=I_{S S} / V_{O V}$, we get

$$
\begin{equation*}
V_{O S 1} \cong-\frac{V_{O V}}{2} \frac{\Delta R_{D}}{R_{D}} \tag{4.122}
\end{equation*}
$$

where $V_{O V}$ is the dc-balance overdrive voltage of Eq. (4.81).

- To investigate the effect of mismatched $k_{1}$ and $k_{2}$ assume the resistances as now perfectly matched and the FETs have identical threshold voltages. Since the FETs of Fig. 4.55a are subject to the same overdrive voltage $V_{O V}$, the current $I_{S S}$ must split between $M_{1}$ and $M_{2}$ in proportion to $k_{1}$ and $k_{2}$,

$$
I_{D 1}=\frac{I_{S S}}{2}\left(1+\frac{\Delta k}{2 k}\right) \quad I_{D 2}=\frac{I_{S S}}{2}\left(1-\frac{\Delta k}{2 k}\right)
$$

where $\Delta k=k_{1}-k_{2}$ and $k=\left(k_{1}+k_{2}\right) / 2$. Consequently,

$$
E_{O 2}=V_{D D}-R_{D} I_{D 1}-\left(V_{D D}-R_{D} I_{D 2}\right)=-R_{D} \frac{I_{S S}}{2} \frac{\Delta k}{k}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-007.jpg?height=675&width=1041&top_left_y=1410&top_left_x=179)

FIGURE 4.55 (a) A practical SC pair with grounded inputs generally gives an output error $E_{O} \neq 0$. (b) $V_{\text {os }}$ is defined as the input voltage required to null $E_{0}$.

Again dividing by $-a_{d m} \cong g_{m} R_{D}$, we get

$$
\begin{equation*}
V_{O S 2} \cong-\frac{V_{O V}}{2} \frac{\Delta k}{k} \tag{4.123}
\end{equation*}
$$

- To investigate the effect of mismatched $V_{t 1}$ and $V_{t 2}$, assume all other parameters are matched. Then, to achieve the dc balance of Fig. $4.55 b$, we must ensure that the FETs experience identical overdrive voltages. This occurs for

$$
\begin{equation*}
V_{O S 3}=\Delta V_{t}=V_{t 1}-V_{t 2} \tag{4.124}
\end{equation*}
$$

Note the similarity of the MOS Eqs. (4.122) and (4.123) to the BJT Eqs. (4.116) and (4.117), except that we now have $V_{O V} / 2$ in place of $V_{T}$. Since $V_{T}=26 \mathrm{mV}$ whereas $V_{O V} / 2$ is typically at least an order of magnitude higher, it is apparent that SC pairs tend to exhibit larger offsets than BJT pairs.

As in the bipolar case, the signs of the various offset components are not relevant. Moreover, the three causes of offset voltage are not correlated, so the total offset voltage is usually estimated as ${ }^{1}$

$$
\begin{equation*}
V_{O S} \cong \frac{V_{O V}}{2} \sqrt{\left(\frac{\Delta R_{D}}{R_{D}}\right)^{2}+\left(\frac{\Delta k}{k}\right)^{2}+\left(\frac{\Delta V_{t}}{0.5 V_{O V}}\right)^{2}} \tag{4.125}
\end{equation*}
$$

Finally, since the gate current of a MOSFET is zero at dc, the input bias current and input offset current are non-issues in SC pairs. When the input terminals are made externally accessible, they are equipped with internal diode clamps to prevent electric discharge that might damage the dielectric of the FETs. In normal operation these diodes are reverse biased, so the gate-terminal currents are those of reverse-biased pn junctions. At room temperature these currents are very small (in the nA or even pA range), but as we know, they double for about every $10^{\circ} \mathrm{C}$ of temperature increase.

EXAMPLE 4.22 Suppose an SC pair is afflicted by an $R_{D}$ mismatch of $\pm 1 \%$, a $k$ mismatch of $\pm 3 \%$, and a $V_{t}$ mismatch of $\pm 5 \mathrm{mV}$. If $V_{O V}=0.5 \mathrm{~V}$, estimate the worst-case value as well as the likely value of $V_{O S}$. Which is the major contributor to $V_{O S}$ ?

### Solution

Summing the various terms directly gives the worst-case scenario estimate,

$$
V_{O S} \cong \frac{500 \mathrm{mV}}{2}\left(\frac{2}{100}+\frac{6}{100}+\frac{10}{250}\right)=5+15+10=30 \mathrm{mV}
$$

Using Eq. (4.125), we find the likely estimate

$$
V_{O S} \cong \sqrt{5^{2}+15^{2}+10^{2}}=18.7 \mathrm{mV}
$$

In this example the main culprit is the $k$ mismatch.

### Input Offset Voltage Drift

Like virtually all device and circuit parameters, $V_{O S}$ drifts with temperature, and in low-level signal processing, such as in instrumentation and measurement, it is necessary to know both $V_{O S}$ and its thermal drift.

In the case of EC pairs, Eq. (4.118) indicates that $V_{O S}$ is proportional to the thermal voltage $V_{T}$, which in turn is proportional to temperature $T$. Consequently,

$$
\begin{equation*}
\frac{d V_{O S}}{d T}=\frac{V_{O S}}{T} \tag{4.126}
\end{equation*}
$$

At room temperature ( $T=300 \mathrm{~K}$ ), $V_{o S}$ drifts by $1 \times 10^{-3} / 300=3.3 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$ for every mV of offset. So, for an EC pair with $V_{O S}=1.5 \mathrm{mV}, V_{O S}$ drifts by $5 \mu \mathrm{~V} /{ }^{\circ} \mathrm{C}$.

The offset drift of SC pairs is more complex ${ }^{1,3}$ than in the bipolar case. Suffice it to say here that CMOS IC designers continuously strive to reduce both $V_{O S}$ and its drift using clever compensation techniques such as autozero techniques and floatinggate programming.

## 4.8 CURRENT MIRRORS

Along with differential pairs, current mirrors are the workhorses of analog ICs. A common current mirror application is the generation of stable and predictable dc currents to bias other circuits. When used in this capacity, a current mirror is also referred to as a current reference. Mirrors are also used to steer current signals. As such they find application as active loads in a variety of analog signal processing ICs such as operational amplifiers (op amps), current-feedback amplifiers (CFAs), and operational transconductance amplifiers (OTAs). Current mirroring is made possible by the high degree of matching and thermal tracking of transistors fabricated in close proximity of each other on the same chip.

The function of a current mirror is to accept a current $i_{I}$ at a low (ideally zero) input-resistance terminal, and deliver a current $i_{O}\left(=i_{I}\right)$ at a high (ideally infinite) output-resistance terminal. The current mirror is similar to the current buffer, except that both currents flow into (or out of) the circuit. For this reason, a current mirror is also said to provide current reversal. We have already been exposed to current mirrors in the introductory chapters on BJTs and MOSFETs, as well as in Section 4.1. We now wish to examine them in systematic detail.

### Basic Bipolar Current Mirrors

Shown in Fig. 4.56a is the basic bipolar current mirror. As the input source $i_{I}$ is turned on, the diode-connected transistor $Q_{1}$ develops a voltage drop $v_{B E}$ related to $i_{I}$ by the well-known logarithmic law. But $Q_{2}$ is subjected to the same drive $v_{B E}$ as $Q_{1}$, so $Q_{2}$ will just mirror the current of $Q_{1}$. We wish to find a precise relationship between $i_{o}$ and $i_{l}$, as well as the small-signal input and output resistances $R_{i}$ and $R_{o}$. We also wish to display the $i-v$ characteristic of the output port.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-010.jpg?height=553&width=433&top_left_y=221&top_left_x=448)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-010.jpg?height=360&width=639&top_left_y=412&top_left_x=958)
(b)

FIGURE 4.56 (a) Basic BJT current mirror, and (b) output-port i-v characteristic.
For a detailed analysis refer to Fig. $4.57 a$ and assume $V_{A}=\infty$ for simplicity. Since the BJTs are matched and experience the same $v_{B E}$ drop, they must draw identical currents, here denoted as $i_{C}$. Also, together they draw a total base current of $2 i_{C} / \beta_{F}$. Consequently, KCL gives $i_{I}=i_{C}+2 i_{C} / \beta_{F}=i_{C}\left(1+2 / \beta_{F}\right)$. Substituting $i_{C}=i_{o}$ and solving for $i_{o}$ gives

$$
\begin{equation*}
i_{O}=\frac{i_{I}}{1+2 / \beta_{F}} \cong i_{I}\left(1-\frac{2}{\beta_{F}}\right) \tag{4.127}
\end{equation*}
$$

Because of the finite current gain $\beta_{F}, i_{O}$ does not mirror $i_{I}$ exactly, but is afflicted by a small systematic error $\varepsilon=-2 / \beta_{F}$. For instance, with $\beta_{F}=100$, we have $\varepsilon=-2 \%$.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-010.jpg?height=679&width=1056&top_left_y=1363&top_left_x=444)

FIGURE 4.57 (a) Currents in (a) the basic BJT current mirror, and (b) basic mirror with beta helper.

Note that Eq. (4.127) holds in dc as well as in ac form, so we have made no smallsignal approximations.

The above equation holds only as long as $v_{C E 2}=v_{C E 1}$, a condition that we shall refer to as $d c$ balance for the two BJTs. In the present case, this occurs for $v_{O}=v_{I}=v_{B E}$. If $v_{O}$ is raised above this value, $i_{O}$ will increase due to the Early effect. To account for this, we need to modify Eq. (4.127) as

$$
\begin{equation*}
i_{O} \cong i_{I}\left(1-\frac{2}{\beta_{F}}\right) \times\left(1+\frac{v_{O}-v_{B E}}{V_{A}}\right) \tag{4.128}
\end{equation*}
$$

The $i_{O^{-}} v_{O}$ characteristic is shown in Fig. $4.56 b$, along with the value of $i_{O}$ at dc balance and the corresponding value of $v_{0}$. Note that Eq. (4.128) holds so long as $v_{O} \geq v_{O(\min )}$, where

$$
\begin{equation*}
v_{O(\min )}=V_{C E(\mathrm{EOS})}(\cong 0.2 \mathrm{~V}) \tag{4.129}
\end{equation*}
$$

If $v_{O}$ drops below this limit, $Q_{2}$ will enter the saturation region, where we witness a rapid decrease in $i_{o}$. By inspection we also have $R_{i}=r_{o 1} / / r_{e l} / / r_{\pi 2} \cong r_{e 1} \cong 1 / g_{m 1}$, and $R_{o}=r_{o 2}$. Dropping subscripts 1 and 2 as the BJTs are assumed matched and are also biased identically, we thus have

$$
\begin{equation*}
R_{i} \cong \frac{1}{g_{m}} \quad R_{o}=r_{o} \tag{4.130}
\end{equation*}
$$

As we know, the $i_{O^{-}} v_{O}$ curve has a slope of $1 / r_{o}$, and its extrapolation intercepts the horizontal axis at $v_{O}=-V_{A}$, where $V_{A}$ is the Early voltage.

The above analysis stipulates perfect matching between $Q_{1}$ and $Q_{2}$. At times the transistors are deliberately fabricated with unequal emitter areas in order to provide current amplification or attenuation, depending on the case. For instance, if $Q_{2}$ 's emitter area is made twice as large as $Q_{1}$ 's, then $Q_{2}$ will draw twice as much current as $Q_{1}$, giving $i_{O} \cong 2 i_{r}$. Denoting the saturation currents of the two BJTs as $I_{s 1}$ and $I_{s 2}$, respectively, we can readily generalize Eq. (4.128) as

$$
\begin{equation*}
i_{O} \cong i_{l}\left(\frac{I_{s 2}}{I_{s 1}}\right) \times\left(1-\frac{1+I_{s 2} / I_{s 1}}{\beta_{F}}\right) \times\left(1+\frac{v_{O}-v_{B E}}{V_{A}}\right) \tag{4.131}
\end{equation*}
$$

In order to reduce the error stemming from the fact that $\beta_{F}$ is not infinite, a third transistor $Q_{3}$ is often added as in Fig. 4.57b. Aptly referred to as beta helper, $Q_{3}$ reduces the current component being subtracted from $i_{I}$ by a factor of $\beta_{F}+1$, in effect changing the dc balance value of Eq. (4.127) to

$$
\begin{equation*}
i_{O} \cong i_{l}\left(1-\frac{2}{\beta_{F}^{2}}\right) \tag{4.132}
\end{equation*}
$$

Note that with this modification $v_{I}$ is raised to $2 v_{B E}$, so the dc balance condition is now $v_{O}=2 v_{B E}$. The ac resistance seen by the input source also doubles to $R_{i} \cong 2 / g_{m}$ (see Problem 4.71). Beta helpers find application especially in multiple-output current mirrors.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-012.jpg?height=581&width=438&top_left_y=212&top_left_x=448)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-012.jpg?height=363&width=612&top_left_y=427&top_left_x=948)
(b)

FIGURE 4.58 (a) Basic MOSFET current mirror, and (b) output-port $i$ - $v$ characteristic.

The above discussion has focused on current mirrors using npn-type BJTs, whose collectors sink current. If the application calls for the current mirror to source current, then the circuit is implemented with pnp-type BJTs, as already discussed in Chapter 2. Since IC pnp BJTs exhibit notoriously low betas, pnp mirrors often use beta helpers to reduce their inherently higher systematic error.

### Basic MOSFET Current Mirror

The MOS counterpart of the BJT mirror is shown in Fig. 4.58a. Thanks to the fact that gate currents are zero, a MOSFET current mirror does not suffer from the systematic error due to $\beta_{F}$. As the input source $i_{I}$ is turned on, the diode-connected transistor $M_{1}$ responds with the voltage drop $v_{G S}=V_{t}+v_{O V}$, where $v_{O V}$ is the overdrive voltage necessary to sustain $i_{r}$. The incoming current and $v_{G S}$ are related as

$$
i_{I}=\frac{k_{1}}{2}\left(v_{G S}-V_{t}\right)^{2}\left(1+\lambda v_{G S}\right)
$$

But, $M_{2}$ is subjected to the same drive $v_{G S}$ as $M_{1}$, so $M_{2}$ will draw the current

$$
i_{O}=\frac{k_{2}}{2}\left(v_{G S}-V_{t}\right)^{2}\left(1+\lambda v_{O}\right)
$$

As we know, the device trasconductance parameter of a MOSFET is $k=k^{\prime}(W / L)$, where $W$ and $L$ are the channel width and length of the particular FET, and $k^{\prime}$ is the process transconductance parameter, common to all same-type FETs on the chip. Taking the ratio $i_{o} / i_{I}$ and simplifying, we get, under the assumption $\lambda v_{G S} \ll 1$,

$$
\begin{equation*}
i_{O} \cong i_{I} \frac{W_{2} / L_{2}}{W_{1} / L_{1}} \times\left[1+\lambda\left(v_{O}-v_{G S}\right)\right] \tag{4.133}
\end{equation*}
$$

The $i_{O_{0}} v_{O}$ characteristic is shown in Fig. $4.58 b$, along with the value of $i_{O}$ at dc balance, a condition now expressed as $v_{O}=v_{I}=v_{G S}$. Note that Eq. (4.133) holds so long as $v_{O} \geq v_{O(\min )}$, where

$$
\begin{equation*}
v_{O(\min )}=v_{O V} \tag{4.134}
\end{equation*}
$$

If $v_{O}$ drops below this limit, $M_{2}$ will enter the triode region where $i_{O}$ eventually drops to zero. By inspection we also have $R_{i}=r_{o 1} / /\left(1 / g_{m 1}\right) \cong 1 / g_{m 1}$ and $R_{o}=r_{o 2}=1 /\left(\lambda i_{o}\right)$. Dropping subscripts 1 and 2 as the FETs are assumed matched and are also biased identically, we thus have

$$
\begin{equation*}
R_{i} \cong \frac{1}{g_{m}} \quad R_{o}=r_{o} \tag{4.135}
\end{equation*}
$$

As we know, the slope of the $i-v$ curve in Fig. $4.58 b$ is $1 / r_{o}$. Moreover, its extrapolation intercepts the horizontal axis at $v_{O}=-1 / \lambda$. If the $W / L$ ratios of the two FETs are equal, then $i_{O}=i_{I}$ at dc balance.

### Cascode Current Mirrors

According to Eqs. (4.130) and (4.135), the output resistance of basic current mirrors is $r_{o}$. There are many situations requiring a much higher output resistance, and the cascoding techniques of Section 4.4 provide a popular way to raise output resistance significantly.

Figure 4.59 a shows a bipolar cascode mirror. The matched BJT pair $Q_{3}{ }^{-} Q_{4}$ provides the mirror action proper, whereas the CB BJT $Q_{2}$ raises the output resistance way above $r_{o}$. The function of diode-connected $Q_{1}$ is to bias $Q_{2}$ 's base a $v_{B E}$ drop above $Q_{4}$ 's
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-013.jpg?height=820&width=1021&top_left_y=1257&top_left_x=194)

FIGURE 4.59 Cascode current mirrors: (a) bipolar and (b) MOS.
base to give $v_{C E 4}=v_{C E 3}=v_{B E}$. Compared to the basic mirror, the input parameters are doubled to $v_{I}=2 v_{B E}$ and $R_{i} \cong 2 / g_{m}$. Also, the lower limit of the linear range of operation is now raised by one $v_{B E}$ drop to $v_{O(\min )}=v_{C E 4}+V_{C E 2(\mathrm{EOS})}=v_{B E}+V_{C E 2(\mathrm{EOS})}$. It is left as an exercise for the student (see Problem 4.72) to prove that $R_{i} \cong 2 / g_{m}, R_{o} \cong\left(\beta_{0} / 2\right) r_{o}$ and

$$
\begin{equation*}
i_{O} \cong i_{l}\left(1-\frac{4}{\beta_{F}}\right) \times\left(1+\frac{v_{O}-2 v_{B E}}{\left(\beta_{0} / 2\right) V_{A}}\right) \tag{4.136}
\end{equation*}
$$

We can visualize the effect of cascoding as shifting the extrapolated intercept of the $i_{O}-v_{O}$ curve with the horizontal axis from $-V_{A}$ to about $-\left(\beta_{0} / 2\right) V_{A}$, thus making the $i_{o}-v_{O}$ curve much flatter.

When the output resistance of a collector terminal is raised significantly above $r_{o}$ as in the present case, the base-collector resistance $r_{\mu}$ may no longer be negligible. As we know, $r_{\mu}$ models the effect of base-width modulation by $v_{C E}$ upon the recombination current in the base, and is expressed as $r_{\mu}=m \beta_{0} r_{o}$, where $1 / m(m \geq 1)$ represents the fraction of the total base current due to recombination. A more accurate expression for the output resistance is thus

$$
\begin{equation*}
R_{o(\mathrm{BJT})} \cong\left(\frac{\beta_{0}}{2} r_{o}\right) / / r_{\mu}=\frac{m}{1+2 m} \beta_{0} r_{o} \tag{4.137}
\end{equation*}
$$

In the worst-case scenario of the base current being predominantly of the recombination type $(m \rightarrow 1)$, we get $R_{o} \rightarrow\left(\beta_{0} / 3\right) r_{o}$. In a practical cascode mirror $R_{o}$ will lie somewhere between $1 / 3$ and $1 / 2$ of $\beta_{0} r_{o}$.

Turning next to the MOS cascode mirror of Fig. $4.59 b$ we observe that it utilizes the matched pair $M_{3}-M_{4}$ to provide the mirror action proper, the CG FET $M_{2}$ to raise the output resistance, and the diode-connected FET $M_{1}$ to bias $M_{2}$ 's gate a diode drop above $M_{4}$ 's gate to give $v_{D S 4}=v_{D S 3}=V_{t}+v_{O V}$. Adapting Eq. (4.63) we now have $R_{o}=r_{o 2}\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{o 4}\right]+r_{o 4}$ or, dropping the subscripts,

$$
\begin{equation*}
R_{o(\mathrm{MOS})}=r_{o}\left[2+\left(g_{m}+g_{m b}\right) r_{o}\right] \tag{4.138}
\end{equation*}
$$

As expected, the artifice of cascoding raises the output resistance by a factor of $\left[2+\left(g_{m}+g_{m b}\right) r_{o}\right]$ or, equivalently, it shifts the $v_{o}$-axis intercept of the $i_{o^{-}} v_{O}$ curve from $-1 / \lambda$ to $(-1 / \lambda) \times\left[2+\left(g_{m}+g_{m b}\right) r_{o}\right]$.

For the circuit to function properly, both $M_{2}$ and $M_{4}$ must operate with $v_{D S} \geq v_{O V}$. Since $v_{D S 4}=V_{t}+v_{O V}$, it turns out that $M_{4}$ actually exceeds the minimum required by an amount equal to $V_{t}$. Imposing $v_{D S 2} \geq v_{O V}$ we find that the linear output range is now $v_{O} \geq v_{O(\min )}$, where $v_{O(\min )}=v_{D S 4}+v_{O V}$, or

$$
\begin{equation*}
v_{O(\min )}=V_{t}+2 v_{O V} \tag{4.139}
\end{equation*}
$$

Compared to Eq. (4.134) for the basic mirror of Fig. 4.58a, the limit of Eq. (4.139) may prove too high in low-voltage applications where even fractions of a volt matter.

While we can make the $2 v_{O V}$ term as small as needed by fabricating the FETs with suitably large $W / L$ ratios, the $V_{t}$ term poses the ultimate limit on $v_{O(\min )}$.

### Wide-Swing MOS Cascode Mirrors

Wide-swing cascode mirrors eliminate the $V_{t}$ term from Eq. (4.139) by downshifting $M_{2}$ 's bias from $v_{G 2}=2 V_{t}+2 v_{O V}$ of Fig. $4.59 b$ to $v_{G 2}=1 V_{t}+2 v_{O V}$ in order to bring $M_{4}$ right to the edge of saturation, where $v_{D S 4}=v_{O V}$. This results in

$$
\begin{equation*}
v_{O(\min )}=2 v_{O V} \tag{4.140}
\end{equation*}
$$

In the modified cascode mirror of Fig. 4.60 a this downshift is provided by the source follower $M_{5}$. ( $M_{5}$ is biased by $M_{6}$, in turn mirroring $M_{3}$.) To yield $v_{S 5}=V_{t}+2 v_{O V}$, $M_{5}$ requires $v_{G 5}=v_{S 5}+v_{G S 5}=\left(V_{t}+2 v_{O V}\right)+\left(V_{t}+v_{O V}\right)=2 V_{t}+3 v_{O V}$. Compared to Fig. $4.59 b$, where $v_{I}=2 V_{t}+2 v_{O V}$, we now need $v_{I}=2 V_{t}+3 v_{O V}$, or $1 v_{O V}$ higher. We achieve this by fabricating $M_{1}$ with a $W / L$ ratio that is $1 / 4$ that of all other FETs so that, by virtue of the relation $v_{O V}=\sqrt{(2 / k) i_{D}}, M_{1}$ will require an overdrive voltage of $2 v_{O V}$ to sustain the same current $i_{D}$ that all other FETs are sustaining with only $1 v_{O V}$.

A drawback of the circuit of Fig. 4.60a is that it requires an additional branch $\left(M_{5}-M_{6}\right)$ to provide level shifting. The two branches are cleverly combined into one in the circuit of Fig. 4.60b, called the Sooch cascode current mirror for its
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-015.jpg?height=875&width=1194&top_left_y=1124&top_left_x=197)

FIGURE 4.60 Wide-swing cascode mirrors. (a) Using source follower $M_{5}$ to downshift $M_{2}$ 's bias by $V_{t}$ (note that the $W / L$ ratio of $M_{1}$ is $1 / 4$ that of all other FETs). (b) The Sooch cascode current mirror.
inventor N. S. Sooch. Though the details of its analysis are left as an exercise for the student (see Problem 4.73), suffice it to list here its principal features, which are:

- The $M_{6}-M_{3}$ pair synthesizes the voltage $v_{G 4}=V_{t}+v_{O V}$ needed to bias $M_{4}$.
- The $M_{1}-M_{5}$ pair synthesizes the voltage drop $v_{D S 5}=v_{O V}$ needed to bias $M_{2}$ at $v_{G 2}=V_{t}+2 v_{O V}$, that is, $1 v_{O V}$ higher than $v_{G 4}$. As discussed in Problem 4.73, we achieve this by fabricating $M_{5}$ with a $W / L$ ratio that is $1 / 3$ that of the other FETs.
- $M_{6}$ is designed to drop $v_{D S 6}=V_{t}$ and thus force $M_{3}$ to operate at $v_{D S 3}=v_{O V}=v_{D S 4}$. This eliminates any channel-length modulation differences between $M_{3}$ and $M_{4}$ and thus results in perfectly matched currents (so long as the $W / L$ ratios of $M_{3}$ and $M_{4}$ are matched).
In the above analyses we have neglected the body effect for simplicity. In practice, all FETs with source voltages different from the body voltage will exhibit slightly higher values of $V_{t}$. The IC designer can compensate for threshold shifts by suitably adjusting the $W / L$ ratios when needed.

### Wilson Current Mirror

The Wilson current mirror, shown in Fig. 4.61a, was developed to improve the characteristics of the basic bipolar current mirror. As the input source is turned on, $i_{I}$ will initially flow into $Q_{3}$ 's base, turning on $Q_{3}$ as well as the diode-connected transistor $Q_{2}$. The current through $Q_{2}$ is then mirrored by $Q_{1}$ back to the input node, thus closing a negative-feedback loop. While in the basic mirror of Fig. $4.56 a$ both base currents are subtracted from the input side of the circuit, in the Wilson configuration $i_{B 3}$ is subtracted from the input side and $i_{B 1}$ is subtracted from the output side. As we shall see shortly,
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-016.jpg?height=788&width=977&top_left_y=1292&top_left_x=439)

FIGURE 4.61 (a) Wilson current mirror, and (b) its various current components.
this form of cancellation reduces the output current error to a level comparable to that of the beta helper, provided the BJTs have matched betas. Moreover, the presence of negative feedback raises the output resistance dramatically.

To find a relationship between $i_{O}$ and $i_{J}$, refer to Fig. 4.61b. Assuming $V_{A}=\infty$ for simplicity and starting out at the bottom, we observe that $Q_{1}$ and $Q_{2}$ are subject to the same drive $v_{B E}$, so they draw identical currents, here denoted as $i_{C}$. Moving upward, we repeatedly apply KCL as well as the forward-region current relationships of BJTs to end up with the relationships

$$
i_{I}=i_{C}\left[1+\left(1+\frac{2}{\beta_{F}}\right) \frac{1}{\beta_{F}+1}\right] \quad i_{O}=\beta_{F} i_{C}\left(1+\frac{2}{\beta_{F}}\right) \frac{1}{\beta_{F}+1}
$$

Eliminating $i_{C}$ we find, after minor algebra,

$$
\begin{equation*}
i_{O}=i_{I} \frac{1}{1+\frac{2}{\beta_{F}\left(\beta_{F}+2\right)}} \cong i_{I} \frac{1}{1+\frac{2}{\beta_{F}^{2}}} \cong i_{l}\left(1-\frac{2}{\beta_{F}^{2}}\right) \tag{4.141}
\end{equation*}
$$

For instance, with $\beta_{F}=100$ the error is $\varepsilon=-0.02 \%$, which is truly negligible. We observe that the voltage at the input node is now $2 v_{B E}$ and that the circuit will work properly so long as $v_{O} \geq v_{O(\min )}$, where

$$
\begin{equation*}
v_{O(\text { min })}=v_{B E}+V_{C E 3(\mathrm{EOS})}(\cong 0.9 \mathrm{~V}) \tag{4.142}
\end{equation*}
$$

To find the output resistance $R_{o}$ we replace the circuit with its small-signal equivalent and use the test-voltage method of Fig. 4.62a. Here, $r_{\pi 1}$ and $r_{o 2}$ have been lumped together with $r_{e 2}$, the dynamic resistance of diode-connected transistor $Q_{2}$. Moreover, since $Q_{1}$ mirrors the current of $Q_{2}$, we model it with a unity-gain controlled source $1 i_{2}$. Since $r_{o 2} \gg r_{\pi 1} \gg r_{e 2}$, we approximate $r_{\pi 1} / / r_{e 2} / / r_{o 2} \cong r_{e 2}=\alpha_{02} / g_{m 2} \cong$ $1 / g_{m}$, as shown in Fig. 4.62b. In fact, it turns out that we can also ignore $r_{o 1}$ in the course of our calculations. To see why, we apply KCL at the upper-left node, along with KVL and Ohm's law and get

$$
i_{b 3}+1 i_{2}+\frac{r_{e 2} i_{2}+r_{\pi 3} i_{b 3}}{r_{o 1}}=0 \Rightarrow i_{b 3}\left(1+\frac{r_{\pi 3}}{r_{o 1}}\right)+i_{2}\left(1+\frac{r_{e 2}}{r_{o 1}}\right)=0
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-017.jpg?height=489&width=1396&top_left_y=1592&top_left_x=152)

FIGURE 4.62 (a) Small-signal model of the Wilson current mirror, and (b) its simplified version.

Given that $r_{e 2} \ll r_{\pi 3} \ll r_{o 1}$, we can ignore $r_{o 1}$ and write $i_{b 3}+i_{2} \cong 0$, or $i_{b 3}=-i_{2}$. This means that the ac current $i_{b 3}$ is actually flowing out of $Q_{3}$ 's base, and that $i_{b 3}$ coincides with the current $1 i_{2}$ drawn by the dependent source modeling $Q_{1}$. The ac equivalent of Fig. $4.62 a$ simplifies as in Fig. $4.62 b$, where we have exploited the fact that $i=1 i_{2}+i_{2}$, or $i_{2}=i / 2$. Applying Kirchoff's laws and Ohm's law gives

$$
i+\beta_{0} \frac{i}{2}=\frac{v-\left(1 / g_{m}\right) i / 2}{r_{o}} \Rightarrow i\left(1+\frac{\beta_{0}}{2}+\frac{1}{2 g_{m} r_{o}}\right)=\frac{v}{r_{o}}
$$

But, $1 /\left(2 g_{m} r_{o}\right) \ll 1$, so we finally get

$$
\begin{equation*}
R_{o}=\frac{v}{i} \cong\left(1+\frac{\beta_{0}}{2}\right) r_{o} \cong \frac{\beta_{0}}{2} r_{o} \tag{4.143a}
\end{equation*}
$$

It is left as an exercise for the student (see Problem 4.71) to prove that $R_{i} \cong 2 / g_{m}$ in Fig. 4.61 $a$. Compared to the basic-mirror characteristic of Fig. 4.56b, the Wilson mirror yields a much flatter curve, but only down to $v_{O}=v_{B E}+V_{C E 3(E O S)}$. Alternatively, we can say that the intercept of the Wilson's $i-v$ curve with the horizontal axis is shifted from $-V_{A}$ to $-\left(\beta_{0} / 2\right) V_{A}$. This great improvement is the result of the negative-feedback action provided by $Q_{1}$, a subject we shall return to in Chapter 7. As in the cascode realization, the output resistance is raised significantly above $r_{o}$, so $r_{\mu}$ may no longer be negligible. As in the cascode case, a better estimate for $R_{o}$ is then

$$
\begin{equation*}
R_{o} \cong\left(\frac{\beta_{0}}{2} r_{o}\right) / / r_{\mu}=\frac{m}{1+2 m} \beta_{0} r_{o} \tag{4.143b}
\end{equation*}
$$

Finally, it must be said that the calculation of the various currents in Fig. $4.62 b$ postulates identical currents for $Q_{1}$ and $Q_{2}$, when in fact the two BJTs are operating at different values of $v_{C E}$, namely, $v_{C E 2}=v_{B E}$ and $v_{C E 1}=2 v_{B E}$. Consequently, $i_{C 1} \cong$ $i_{C 2}\left(1+v_{B E} / V_{A}\right)$. This difference results in a systematic error for $i_{O}$. To account for this error, typically around $1 \%$, we need to refine the initial value of Eq. (4.141) as

$$
\begin{equation*}
i_{O} \cong i_{l}\left(1-\frac{2}{\beta_{F}^{2}}\right) \times\left(1-\frac{v_{B E}}{V_{A}}\right) \cong i_{l}\left(1-\frac{2}{\beta_{F}^{2}}-\frac{v_{B E}}{V_{A}}\right) \tag{4.144}
\end{equation*}
$$

where the higher-order term has been ignored in the calculation of the product. When undesirable, this additional systematic error can be eliminated by fabricating a diode-connected BJT $Q_{4}$ in series with the collector terminal of $Q_{1}$. Then, the $v_{B E}$ drop across this dummy diode will equalize the $v_{C E} \mathrm{~s}$ of $Q_{1}$ and $Q_{2}$ and therefore ensure $i_{C 1}=i_{C 2}$.

EXAMPLE 4.23 (a) If $i_{I}=1.0 \mathrm{~mA}$ in the basic current mirror of Fig. $4.56 a$, what is the initial value of $i_{O}$ ? By how much does $i_{O}$ change if $v_{O}$ is raised by 10 V ? Assume matched BJTs with $\beta_{0}=100$ and $V_{A}=80 \mathrm{~V}$.
(b) Repeat, but for the Wilson mirror of Fig. 4.61 $a$. Compare and comment.

### Solution

(a) By Eq. (4.127), $i_{o}=1.0(1-2 / 100)=0.98 \mathrm{~mA}$. Also, $R_{o}=r_{o}=80 / 0.98=$ $81.6 \mathrm{k} \Omega$. Consequently, $\Delta i_{o}=\Delta v_{o} / R_{o}=10 / 81.6=0.1225 \mathrm{~mA}$, indicating that $i_{0}$ will increase to $0.98+0.1225=1.1025 \mathrm{~mA}$.
(b) By Eq. (4.144), $i_{o}=1.0\left(1-2 / 100^{2}-0.7 / 80\right)=0.9910 \mathrm{~mA}$. Moreover, $R_{o}=\left(\beta_{0} / 2\right) r_{o}=(100 / 2) 80.7=4.04 \mathrm{M} \Omega$, so $\Delta i_{o}=\Delta v_{o} / R_{o}=10 / 4.04=$ $2.5 \mu \mathrm{~A}$, indicating that $i_{o}$ will increase to $0.9910+0.0025=0.9935 \mathrm{~mA}$. The Wilson source is superior both in terms of the initial error and the current variation with voltage.

### Widlar Current Source/Sink

In low-current dc biasing the need often arises for a current mirror capable of giving $I_{O} \ll I_{I}$. Though this can, in principle, be achieved by fabricating $Q_{2}$ in the basic mirror of Fig. $4.56 a$ with a much smaller emitter area than $Q_{1}$, a more viable alternative is to place a resistance $R$ in series with $Q_{2}$ 's emitter terminal to suitably reduce its $V_{B E}$ drop and hence lower the output current $I_{O}$. The result is the modified circuit of Fig. 4.63a, known as the Widlar current source for its inventor B. Widlar. (More properly, the circuit shown ought to be called Widlar current sink as it utilizes npn BJTs, with the designation Widlar current source reserved for its pnp version.) A side benefit of this circuit is that $R$ introduces emitter degeneration and therefore raises the output resistance to $R_{o} \cong r_{o 2}\left[1+g_{m 2}\left(r_{\pi 2} / / R\right)\right]$.

To investigate circuit behavior, neglect base currents and apply Ohm's law and KVL to write $R I_{O}=V_{B E 1}-V_{B E 2}=V_{T} \ln \left(I_{I} / I_{s}\right)-V_{T} \ln \left(I_{O} / I_{s}\right)$, or

$$
\begin{equation*}
R I_{O}=V_{T} \ln \frac{I_{I}}{I_{O}} \tag{4.145}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-019.jpg?height=628&width=814&top_left_y=1447&top_left_x=199)

FIGURE 4.63 (a) Widlar current sink. (b) An alternative implementation of the same concept.
where $V_{T}$ is the familiar thermal voltage ( $V_{T}=26 \mathrm{mV}$ at room temperature). Two issues arise in connection with the Widlar circuit: find $R$ to achieve a specified $I_{O} / I_{I}$ ratio; or, given $R$, find $I_{O} / I_{I}$.

EXAMPLE 4.24 (a) Find $R$ so that the Widlar circuit of Fig. $4.63 a$ gives $I_{O}=30 \mu \mathrm{~A}$ for $I_{I}=$ 0.5 mA . Assuming $\beta_{0}=100$ and $V_{A}=60 \mathrm{~V}$, find the source's output resistance as seen by the load.
(b) Find $I_{O}$ if $I_{I}=1.0 \mathrm{~mA}$ and $R=5 \mathrm{k} \Omega$.

### Solution

(a) By Eq. (4.145),

$$
R=\frac{V_{T}}{I_{O}} \ln \frac{I_{I}}{I_{O}}=\frac{26 \times 10^{-3}}{30 \times 10^{-6}} \ln \frac{0.5 \times 10^{-3}}{30 \times 10^{-6}}=2.44 \mathrm{k} \Omega
$$

We have $g_{m}=1 /(0.87 \mathrm{k} \Omega), r_{\pi}=87 \mathrm{k} \Omega$, and $r_{o}=2 \mathrm{M} \Omega$. Due to the degeneration introduced by $R$, we get

$$
R_{o}=r_{o 2}\left[1+g_{m 2}\left(r_{\pi 2} / / R\right)\right]=2[1+(87 / / 2.44) / 0.87]=7.5 \mathrm{M} \Omega
$$

(b) Using again Eq. (4.145) we get

$$
I_{O}=\frac{V_{T}}{R} \ln \frac{I_{I}}{I_{O}}=\frac{26 \times 10^{-3}}{5 \times 10^{3}} \ln \frac{10^{-3}}{I_{O}}=5.2 \times 10^{-6} \ln \frac{10^{-3}}{I_{O}}
$$

This transcendental equation is solved via iterations. We expect $I_{O} \ll I_{l}$, so start out with an educated guess, say, $I_{O(0)}=10 \mu \mathrm{~A}$, and plug it in the right-hand side to obtain the new estimate $I_{O(1)}=24 \mu \mathrm{~A}$. Iterate by plugging this new estimate in the right-hand side and get $I_{O(2)}=19.4 \mu \mathrm{~A}$. After a few more iterations the result settles at $I_{O}=20.3 \mu \mathrm{~A}$.

Shown in Fig. 4.63b is an alternative circuit realization of the same concept, except that it achieves the same result using a much smaller value of $R$ since the current through $R$ is now $I_{I}\left(I_{O}\right)$. (As we know, smaller resistors are preferable as they take up less chip area.) We still have $V_{R}=V_{B E 1}-V_{B E 2}$. However, we now have $V_{R}=R I_{I}$, so Eq. (4.145) becomes

$$
\begin{equation*}
R I_{I}=V_{T} \ln \frac{I_{I}}{I_{O}} \tag{4.146}
\end{equation*}
$$

This expression can be used either to find $R$ for a given set of values of $I_{I}$ and $I_{O}$, or to find $I_{O}$ for a given set of values of $I_{I}$ and $R$ (see Problem 4.77). Rewriting Eq. (4.146) as

$$
I_{O}=I_{I} e^{-R I_{l} / V_{T}}
$$

we observe that for small values of $I_{I}$ the exponential term tends to unity, indicating that $I_{O}$ increases approximately in proportion to $I_{I}$. On the other hand, for large values of $I_{l}$, the exponential term dominates, causing $I_{O}$ to decrease with $I_{I}$. It is apparent that $I_{O}$ must peak at some intermediate value of $I_{I}$ (see Problem 4.78), this being the reason why the circuit of Fig. 4.63 b is also called a peaking current source (strictly speaking, the designation peaking current sink would be more appropriate for the present case of npn BJTs, and peaking current source for the case of pnp BJTs).

## 4.9 DIFFERENTIAL PAIRS WITH ACTIVE LOADS

The most common application of the differential pair is as input stage to operational amplifiers and voltage comparators, where the two most critical requirements are (a) a high differential gain $a_{d m}$ and (b) a high common-mode rejection ratio (CMRR). The circuits of Fig. 4.64 maximize both parameters by taking advantage of current mirrors.

Let us address the common-mode rejection ratio (CMRR) first. Previous analysis has shown that to ensure a high CMRR, the biasing circuitry must present a high resistance to the differential pair (high $R_{E E}$ for EC pairs, high $R_{S S}$ for SC pairs). In both circuits of Fig. 4.64 this constraint is met by using a current mirror that accepts
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-021.jpg?height=893&width=1403&top_left_y=1188&top_left_x=191)

FIGURE 4.64 Differential pairs with active loads and current-source biasing: (a) BJT, and (b) CMOS.
the reference current established by $R$ and mirrors it to the differential pair at a high output resistance (in this case the resistance $r_{o 6}$ of the mirror transistor). If desired, we can raise this resistance further by using a Wilson current mirror or a cascode current mirror. When used to provide a biasing function as in the present case, a current mirror is called a current reference.

Next, let us address the differential-mode gain $a_{d m}$. Equations (4.88) and (4.93) provide estimates for the gains achievable with resistive-loaded differential pairs, namely,

$$
a_{d m(\mathrm{BJT})} \cong-\frac{R_{C}\left(I_{E E} / 2\right)}{V_{T}} \quad a_{d m(\mathrm{FET})} \cong-\frac{R_{D}\left(I_{S S} / 2\right)}{0.5 V_{O V}}
$$

In both cases gain is proportional to the dc voltage dropped across the load resistance $R_{C} / R_{D}$. If a higher gain is desired for given biasing conditions, $R_{C} / R_{D}$ will have to be increased. This, however, risks driving the transistors in saturation. We resolve this impasse by replacing resistive loads with active loads, as already mentioned in Section 4.1. In Fig. 4.64, $Q_{4} / M_{4}$ acts as the load to $Q_{2} / M_{2}$, so the role of $R_{C} / R_{D}$ in the above gain expressions is now played by the usually much larger output resistance $r_{o 4}$ of $Q_{4} / M_{4}$.

For proper operation, the load $Q_{4} / M_{4}$ must be biased at the same current as $Q_{2} / M_{2}$. The circuit of Fig. $4.64 a$ uses $Q_{1}$ to mimic the dc current $\alpha_{F} I_{E E} / 2\left(\cong I_{E E} / 2\right.$ drawn by its matched companion $Q_{2}$. This current is then fed to $Q_{3}$, which in turn forces its matched companion $Q_{4}$ to mirror it back to $Q_{2}$. So, at dc balance, all four BJTs draw identical currents, namely, $I_{E E} / 2$ ! Similar considerations hold for the CMOS counterpart of Fig. 4.64b, where at dc balance all four FETs draw identical currents of $I_{S S} / 2$.

An additional advantage of active loads is signal conversion from doubleended form $\left(v_{I 1}-v_{12}\right)$ to single-ended form $\left(v_{o}\right)$. This is an indispensable feature in popular ICs such as operational amplifiers and voltage comparators. Finally, it must be pointed out that the signal-processing circuit portions of Fig. 4.64 use no resistors, a definite advantage as integrated resistors tend to take up precious chip area.

### Voltage Transfer Curves

The voltage transfer curve (VTC) of an active-loaded differential pair can readily be plotted via PSpice. Let us first investigate the BJT circuit of Fig. 4.65a, where we observe the following:

- With $v_{I D}=0, I_{E E}$ divides equally between the matched BJTs $Q_{1}-Q_{2}$, so $I_{C 1}=I_{C 2}=$ $\alpha_{F} I_{E E} / 2 \cong I_{E E} / 2$. By KCL, $I_{C 3}=I_{C 1}$, and by mirror action, $I_{C 4}=I_{C 3}$, so all BJTs are biased at $I_{E E} / 2$. Taking the Early effect into consideration, we observe that for the BJTs to carry identical currents, the $d c$ balance conditions $V_{C E 2}=V_{C E 1}$ and $V_{E C 4}=V_{E C 3}$ must hold. These conditions are met simultaneously when

$$
\begin{equation*}
V_{O}=V_{C C}-V_{E B p} \tag{4.147}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-023.jpg?height=774&width=1353&top_left_y=205&top_left_x=197)

FIGURE 4.65 (a) PSpice circuit of an active-loaded EC pair with $I_{s n}=2 I_{s p}=2 \mathrm{fA}, \beta_{F n}=4 \beta_{F p}=200$, $V_{A n}=2 V_{A p}=100 \mathrm{~V}$, and (b) its VTC.
where $V_{E B p}$ is the emitter-base voltage drop of the pnp BJTs. In the example given, $V_{O} \cong 10-0.7=9.3 \mathrm{~V}$. However, a closer examination of the VTC of Fig. 4.65b reveals that the actual value of $V_{O}$ is lower than the above estimate. This is due to the beta error of the current-mirror load, which gives $I_{C 4}<I_{E E} / 2$ at the value of $V_{O}$ of Eq. (4.147). Consequently, $Q_{2}$ will pull down $V_{O}$ until $I_{C 4}=I_{C 2}$ exactly. From the plot, this occurs at $V_{o} \cong 8.0 \mathrm{~V}$ (more on this in Example 4.27).

- Raising $v_{I D}$ above 0 V makes $Q_{1}$ more conductive at the expense of $Q_{2}$ becoming less conductive. By mirror action, $Q_{4}$ also becomes more conductive, so the pull-up action by $Q_{4}$ will prevail over the pull-down action by $Q_{2}$. We thus witness a rise in $v_{O}$ until $Q_{4}$ reaches the edge of saturation (EOS). Beyond this point $Q_{4}$ saturates, in turn causing the VTC to saturate at $v_{O}=V_{C C}-V_{E C 4(\text { sat })} \cong$ $10-0.1=9.9 \mathrm{~V}$.
- Lowering $v_{I D}$ below 0 V makes $Q_{1}$ less conductive and $Q_{2}$ more conductive, causing the pull-down action by $Q_{2}$ to prevail over the pull-up action by $Q_{4}$. We now witness a drop in $v_{o}$, until $Q_{2}$ reaches the EOS. Below this point, the VTC saturates at $v_{O}=V_{E 2}+V_{C E 2(\mathrm{sat})} \cong-0.7+0.1=-0.6 \mathrm{~V}$.

Next, let us turn to the CMOS circuit of Fig. $4.66 a$, where we observe the following:

- With $v_{I D}=0, I_{S S}$ divides equally between the matched FETs $M_{1}-M_{2}$, giving $I_{D 1}=$ $I_{D 2}=I_{S S} / 2$. By KCL, $I_{D 3}=I_{D 1}$, and by mirror action, $I_{D 4}=I_{D 3}$, so all FETs are biased at $I_{S S} / 2$. Taking channel modulation into consideration, we observe that
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-024.jpg?height=666&width=1374&top_left_y=200&top_left_x=271)

FIGURE 4.66 (a) PSpice circuit of an active-loaded S pair with $k_{n}=k_{p}=100 \mu \mathrm{~A} / \mathrm{V}^{2}$, $V_{\text {ton }}=-V_{\text {top }}=1.0 \mathrm{~V}, \lambda_{n}=\lambda_{p}=0.02 \mathrm{~V}^{-1}$, and (b) its VTC.
for the FETs to carry identical currents, the dc balance conditions $V_{D S 2}=V_{D S 1}$ and $V_{S D 4}=V_{S D 3}$ must hold. These conditions are met simultaneously for

$$
\begin{equation*}
V_{O}=V_{D D}-V_{S G_{p}} \tag{4.148}
\end{equation*}
$$

where $V_{S G p}$ is the source-gate voltage drop of the $p$ MOSFETs. In the example given, $V_{O V}=1.0 \mathrm{~V}$, so $V_{S G_{p}}=\left|V_{t p}\right|+V_{O V}=1+1=2 \mathrm{~V}$ and $V_{O}=10-2=8 \mathrm{~V}$, in agreement with Fig. 4.66b.

- Raising $v_{I D}$ above 0 V makes $M_{1}$ more conductive at the expense of $M_{2}$ becoming less conductive. By mirror action, $M_{4}$ also becomes more conductive, indicating that the pull-up action by $M_{4}$ will prevail over the pull-down action by $M_{2}$. We thus witness a rise in $v_{O}$ until $M_{4}$ leaves the saturation region to enter the triode region. Beyond this point $M_{4}$ ceases to provide the mirror function and the VTC saturates, as shown.
- Lowering $v_{I D}$ below 0 V makes $M_{1}$ less conductive and $M_{2}$ more conductive, causing the pull-down action by $M_{2}$ to prevail over the pull-up action by $M_{4}$. We now witness a drop in $v_{O}$ until $M_{2}$ leaves the saturation region to enter the triode region. Below this point the VTC saturates, as shown.

### The Differential-Mode Gain

An instructive method for finding the differential-mode gain of an active-loaded differential pair is via its Norton equivalent, consisting of a dependent source $i_{o(\mathrm{sc})}$ and a parallel resistance $R_{o}$.

To find the short-circuit output current $i_{o(\mathrm{sc})}$, refer to the ac equivalents of Fig. 4.67, whose similarity indicates that their analysis can be carried out in parallel. We observe that since the collectors of $Q_{1}$ and $Q_{2}$ are terminated differently, the shared emitter terminal is not, strictly speaking, at ac ground, as shown. The EC pair
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-025.jpg?height=626&width=1454&top_left_y=178&top_left_x=198)

FIGURE 4.67 Half-circuits to find the short-circuit output current $i_{0}$ : (a) BJT, and (b) CMOS.
will be slightly imbalanced because of the Early effect and so will be the SC pair due to the channel-length modulation effect. Yet, to expedite our estimations, let us continue to assume ac grounds, as shown. For both pairs we can thus approximate

$$
i_{2}=i_{1} \cong g_{m n} \frac{v_{i d}}{2}
$$

where $g_{m n}$ is the transconductance of the transistors in the differential pair. By KCL we have $i_{3}=i_{1}$, and by current-mirror action we have $i_{4}=i_{3}$. Consequently, we also have $i_{4}=i_{1}$, so $i_{o(\mathrm{sc})}=i_{4}+i_{2}=2 i_{1}$, that is,

$$
\begin{equation*}
i_{o}(\mathrm{sc}) \cong g_{m n} v_{i d} \tag{4.149}
\end{equation*}
$$

In the bipolar case all four BJTs have identical $g_{m} \mathrm{~s}$, so we can drop the subscript $n$ and write in this case $i_{o(\mathrm{sc})}=g_{m} v_{i d}, g_{m}=0.5 I_{E E} / V_{T}$.However, in the MOS case we need to keep the distinction as $g_{m n}\left(=\sqrt{k_{n} I_{S S}}\right)$ and $g_{m p}\left(=\sqrt{k_{p} I_{S S}}\right)$ may differ because $k_{n}$ and $k_{p}$ are not necessarily identical.

Next, let us turn to the task of finding the small-signal output resistance $R_{o}$. To this end, set the input sources to zero, apply a test voltage $v$, find the current $i$ out of the test source, and let $R_{o}=v_{o} / i_{o}$. With reference to Fig. 4.68 we observe that in both circuits the test current $i$ consists of three components:

- The component $i_{4}$ into $Q_{4}$ 's collector or into $M_{4}$ 's drain. By Ohm's law this component is simply

$$
i_{4}=\frac{V}{r_{o 4}}
$$

- The component $i_{2}$ into $Q_{2}$ 's collector or into $M_{2}$ 's drain. Due to the presence of the degeneration resistance $R_{e 1}=r_{e 1}=\alpha_{01} / g_{m 1} \cong 1 / g_{m 1}$, the resistance seen looking into $Q_{2}$ 's collector is $r_{o 2}\left(1+g_{m 2} R_{e 1}\right)=r_{o 2}\left(1+g_{m 2} / g_{m 1}\right)=2 r_{o 2}$. Likewise, because
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-026.jpg?height=684&width=1314&top_left_y=151&top_left_x=334)

FIGURE 4.68 Test circuits to find the output resistance $R_{0}$ of the (a) BJT and (b) CMOS differential amplifier.
of the degeneration resistance $R_{s 1} \cong 1 /\left(g_{m 1}+g_{m b 1}\right)$, the resistance seen looking into $M_{2}$ 's drain is approximately $r_{o 2}\left[1+\left(g_{m 2}+g_{m b 2}\right) /\left(g_{m 1}+g_{m b 1}\right)\right]=2 r_{o 2}$. Thus

$$
i_{2}=\frac{v}{2 r_{o 2}}
$$

- By KCL, the component $i_{2}$ must leave $Q_{2}$ 's emitter or $M_{2}$ 's source, flow through $Q_{1}$ or $M_{1}$ and into $Q_{3}$ or $M_{3}$, from where it is finally mirrored by $Q_{4}$ or $M_{4}$, as shown.

We now apply KCL to write

$$
i_{o}=i_{4}+i_{2}+i_{2}=\frac{V}{r_{o 4}}+\frac{v}{2 r_{o 2}}+\frac{v}{2 r_{o 2}}=\frac{V}{r_{o 4}}+\frac{V}{r_{o 2}}=\frac{v}{r_{o 4} / / r_{o 2}}
$$

Letting $R_{o}=v_{o} / i_{o}$ we finally get

$$
\begin{equation*}
R_{o}=r_{o p} / / r_{o n} \tag{4.150}
\end{equation*}
$$

where, as usual, we use subscripts $n$ and $p$ to denote the collector/drain resistances of the transistors in the differential pair and in the current mirror, respectively.

As we know, the differential input resistance of the bipolar circuit is $R_{i d}=2 r_{\pi}$, whereas that of its CMOS counterpart is $R_{i d}=\infty$. We visualize our findings via the Norton equivalents depicted in Fig. 4.69. Finally, we use Ohm's law to obtain $v_{o d}=$ $R_{o} i_{o(\mathrm{sc})}$, or $v_{o d}=R_{o} g_{m} v_{i d}$ in the bipolar case, and $v_{o d}=R_{o} g_{m n} v_{i d}$ in the CMNOS case. The unloaded voltage gain is $a_{d m}=v_{o d} / v_{i d}$, so

$$
\begin{equation*}
a_{d m(\mathrm{BJT})}=g_{m}\left(r_{o p} / / r_{o n}\right) \quad a_{d m(\mathrm{MOS})}=g_{m n}\left(r_{o p} / / r_{o n}\right) \tag{4.151}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-027.jpg?height=309&width=1302&top_left_y=207&top_left_x=201)

FIGURE 4.69 Norton equivalents of the active-loaded differential amplifier: (a) BJT, and (b) CMOS.

In Problem 4.84 it is shown that $a_{d m(\text { MOS })}$ can be put in the insightful form

$$
\begin{equation*}
a_{d m(\mathrm{MOS})}=-\frac{2}{V_{O V_{n}}\left(\lambda_{n}+\lambda_{p}\right)} \tag{4.152a}
\end{equation*}
$$

where $V_{O V n}$ is the overdrive voltage of the FETs of the differential pair, and $\lambda_{n}$ and $\lambda_{p}$ are the channel-length modulation parameters of the $n$ FETs and the $p$ FETs, respectively. If all FETs are fabricated with the same channel length $L$, then Eq. (4.31) provides yet another insightful form for the differential gain

$$
\begin{equation*}
a_{d m(\mathrm{MOS})}=-\frac{2 L}{V_{O V_{n}}\left(\lambda_{n}^{\prime}+\lambda_{p}^{\prime}\right)} \tag{4.152b}
\end{equation*}
$$

where $\lambda_{n}^{\prime}$ and $\lambda_{p}^{\prime}$ are the process parameters characterizing channel-length modulation in the two FET types. It is apparent that the longer the channel for a given $V_{O V n}$, the higher the gain.
(a) Estimate the element values of the Norton equivalent of the bipolar circuit of Fig. 4.65a, as well as its voltage gain $a_{d m}$.
(b) Repeat, but for the CMOS circuit of Fig. 4.66a. Compare with part (a) and comment.

### Solution

(a) We have $g_{m}=0.5 I_{E E} / V_{T}=0.5 / 26=1 /(52 \Omega), r_{o p}=50 / 0.5=100 \mathrm{k} \Omega$, $r_{o n}=100 / 0.5=200 \mathrm{k} \Omega, r_{o p} / / r_{o n}=100 / / 200=67 \mathrm{k} \Omega, 2 r_{\pi}=2 \times 200 \times 52=$ $20.8 \mathrm{k} \Omega$, and $a_{d m}=67 / 0.052=1282 \mathrm{~V} / \mathrm{V}$.
(b) We have $g_{m n}=\sqrt{k I_{S S}}=\sqrt{100 \times 100}=100 \mu \mathrm{~A} / \mathrm{V}, r_{o p}=r_{o n}=1 /(0.02 \times$ $\left.50 \times 10^{-6}\right)=1 \mathrm{M} \Omega, r_{o p} / / r_{o n}=0.5 \mathrm{M} \Omega$, and $a_{d m}=100 \times 0.5=50 \mathrm{~V} / \mathrm{V}$, a much lower gain than in the bipolar case due to lower $g_{m n}$.

### The Common-Mode Rejection Ratio (CMRR)

As we know, a differential amplifier should ideally respond only to the differentialmode component $v_{i d}=v_{i 1}-v_{i 2}$, regardless of the common-mode component $v_{i c}=$ $\left(v_{i 1}+v_{i 2}\right) / 2$. But a real-life active-loaded amplifier is somewhat sensistive also to $v_{i c}$, so its overall output $v_{o}$ takes on the more general form

$$
v_{o}=v_{o d}+v_{o c}=a_{d m} v_{i d}+a_{c m} v_{i c}
$$

where $v_{o d}$ and $v_{o c}$ are the differential-mode and common-mode output components, and $a_{d m}$ and $a_{c m}$ are the corresponding gains. As we know, a figure of merit is the common-mode rejection ratio (CMRR),

$$
\begin{equation*}
\mathrm{CMRR}=\left|\frac{a_{d m}}{a_{c m}}\right| \tag{4.153}
\end{equation*}
$$

which should be as large as possible (ideally, $a_{c m}$ should be zero, so CMRR $=\infty$ ). We already know $a_{d m}$ from Eq. (4.151), so we only need to find $a_{c m}$, a task that we shall carry out with the help of the equivalent circuits of Fig. 4.70. In accordance with Section 4.6, the differential pairs $Q_{1}-Q_{2}$ and $M_{1}-M_{2}$ have been split into two common-mode halves. Moreover, the diode-connected transistors $Q_{3}$ and $M_{3}$ have been replaced by an equivalent resistance $r_{3}$, and the mirror transistors $Q_{4}$ and $M_{4}$ have been replaced by their small-signal equivalents (note that $r_{\pi 4}$ has been included in $r_{3}$ ). The obvious similarity between the two circuits suggests that we can analyze them simultaneously. (As usual, the following analysis assumes matched differential pairs as well as matched active-load pairs.)

In Fig. 4.70 $a$ we have, by inspection,

$$
\begin{equation*}
i_{1(\mathrm{BJT})}=i_{2(\mathrm{BJT})}=\frac{g_{m}}{1+g_{m} 2 R_{E E}} v_{i c} \tag{4.154a}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-028.jpg?height=660&width=1321&top_left_y=1417&top_left_x=319)

FIGURE 4.70 (a) BJT and (b) CMOS ac equivalents to find the common-mode gain $a_{c m}=v_{o c} / v_{i c}$.

Likewise, in Fig. $4.70 b$ we have

$$
\begin{equation*}
i_{1(\mathrm{MOS})}=i_{2(\mathrm{MOS})}=\frac{g_{m n}}{1+\left(g_{m n}+g_{m b n}\right) 2 R_{S S}} v_{i c} \tag{4.154b}
\end{equation*}
$$

Also in Fig. 4.70a we have, by inspection,

$$
\begin{equation*}
r_{3(\mathrm{BJT})}=\frac{1}{g_{m 3}} / / r_{o 3} / / r_{\pi 3} / / r_{\pi 4} \tag{4.155a}
\end{equation*}
$$

and in Fig. $4.70 b$ we have

$$
\begin{equation*}
r_{3(\mathrm{MOS})}=\frac{1}{g_{m 3}} / / r_{o 3} \tag{4.155b}
\end{equation*}
$$

The voltage drop $v_{3}=r_{3} i_{1}$ causes $Q_{4}$ and $M_{4}$ to source the current $g_{m 4} \nu_{3}$ to the output node, where KCL gives, for both circuits,

$$
g_{m 4} v_{3}=\frac{v_{o c}}{r_{o 4}}+i_{2}
$$

that is, $v_{o c}=g_{m 4} r_{o 4} r_{3} i_{1}-r_{o 4} i_{2}$. Exploiting the fact that $i_{2}=i_{1}$ and $g_{m 4}=g_{m 3}$ we get, for both circuits,

$$
\begin{equation*}
v_{o c}=\left(g_{m 3} r_{3}-1\right) r_{o 4} i_{1} \tag{4.156}
\end{equation*}
$$

Note that $r_{3}$ is slightly less than $1 / g_{m 3}$, so the product $g_{m 3} r_{3}$ will be slightly less than unity. Clearly, there is a slight imbalance between the current sourced by $Q_{4} / M_{4}$ and that sunk by $Q_{2} / M_{2}$, giving $v_{o c} \neq 0$. It is precisely this inherent imbalance that makes $a_{c m} \neq 0$ and therefore CMRR $<\infty$. Indeed, substituting Eq. (4.154) into Eq. (4.156) and letting $a_{c m}=v_{o c} / v_{i c}$ gives (see Problem 4.85)

$$
\begin{gather*}
a_{c m(\mathrm{BJT})}=\frac{-g_{m} r_{o p}}{\left(1+0.5 \beta_{0 p}\right)\left(1+2 g_{m} R_{E E}\right)}  \tag{4.157a}\\
a_{c m(\mathrm{MOS})}=\frac{-g_{m n} r_{o p}}{\left(1+g_{m p} r_{o p}\right)\left[1+2\left(g_{m n}+g_{m b n}\right) R_{S S}\right]}
\end{gather*}
$$

where, as usual, the numerical subscripts have been replaced by subscripts $p$ and $n$ when needed. So long as the various $g_{m} \times r$ products are much greater than unity, the above expressions simplify as

$$
\begin{equation*}
a_{c m(\mathrm{BJT})} \cong \frac{-r_{o p}}{\beta_{0 p} R_{E E}} \quad a_{c m(\mathrm{MOS})}=\frac{-1}{2\left(1+\chi_{n}\right) g_{m p} R_{S S}} \tag{4.157c}
\end{equation*}
$$

EXAMPLE 4.26
(a) Assuming $R_{E E}=100 \mathrm{k} \Omega$, find $a_{c m}$ and CMRR for the active-loaded EC pair of Fig. 4.65a.
(b) Repeat, but for the CMOS circuit of Fig. 4.66a. Assume $R_{S S}=0.5 \mathrm{M} \Omega$ and $g_{m b n}=0.1 g_{m n}$.

### Solution

(a) By Eq. (4.157a) we have

$$
a_{c m(\mathrm{BJT})}=\frac{-100 / 0.052}{(1+0.5 \times 50)(1+2 \times 100 / 0.052)}=-19.2 \mathrm{mV} / \mathrm{V}
$$

Example 4.25a gave $a_{d m}=1282 \mathrm{~V} / \mathrm{V}$, so $\mathrm{CMRR}_{\text {BJT }}=1282 /\left(19.2 \times 10^{-3}\right)=$ 66,681 (=96.5 dB).
(b) In this particular example we have $g_{m n}=g_{m p}(=0.1 \mathrm{~mA} / \mathrm{V})$. Using Eq. (4.157b),

$$
a_{c m(\mathrm{MOS})}=\frac{-0.1 \times 1000}{(1+0.1 \times 1000)[1+2 \times 0.1(1+0.1) 500]}=-8.92 \mathrm{mV} / \mathrm{V}
$$

Example $4.25 b$ gave $a_{d m}=50 \mathrm{~V} / \mathrm{V}$, so $\mathrm{CMRR}_{\text {MOS }}=50 /\left(8.92 \times 10^{-3}\right)=$ 5,605 (=75 dB).

It is instructive to develop direct expressions for the CMRRs. Substituting Eqs. (4.151) and (4.157) into Eq. (4.153) we get (see Problem 4.85) the BJT expression

$$
\begin{equation*}
\mathrm{CMRR}_{\mathrm{BJT}}=\frac{1+0.5 \beta_{0 p}}{1+r_{o p} / r_{o n}}\left(1+2 g_{m} R_{E E}\right) \rightarrow \frac{\beta_{0 p} g_{m} R_{E E}}{1+r_{o p} / r_{o n}} \tag{4.158a}
\end{equation*}
$$

which shows an active-load improvement on the order of $\left(1+0.5 \beta_{0 p}\right) /\left(1+r_{o p} / r_{o n}\right)$ compared to the passive-load case. Likewise, for the MOSFET case we get

$$
\begin{equation*}
\mathrm{CMRR}_{\mathrm{MOS}} \cong \frac{1+g_{m p} r_{o p}}{1+r_{o p} / r_{o n}}\left[1+2\left(g_{m n}+g_{m b n}\right) R_{S S}\right] \rightarrow 2 g_{m p}\left(r_{o n} / / r_{o p}\right) g_{m n}\left(1+\chi_{n}\right) R_{S S} \tag{4.158b}
\end{equation*}
$$

indicating an improvement on the order of $\left(1+g_{m p} r_{o p}\right) /\left(1+r_{o p} / r_{o n}\right)$ compared to the passive-load case.

### Input Offset Voltage of Active-Loaded Differential Pairs

In an active-loaded differential pair the input offset voltage $V_{O S}$ is the result of mismatches in the transistors of the differential pair as well as in those of the current mirror. Turning first to the BJT circuit of Fig. 4.64a, we adapt Eq. (4.118) and write

$$
\begin{equation*}
V_{O S(\mathrm{BJT})} \cong V_{T} \sqrt{\left(\frac{\Delta I_{s n}}{I_{s n}}\right)^{2}+\left(\frac{\Delta I_{s p}}{I_{s p}}\right)^{2}} \tag{4.159}
\end{equation*}
$$

If the two mismatches are of equal magnitude, the effect of the active-load mismatch is to make the offset typically $\sqrt{2}$ times as large as that due to the EC pair alone. In the bipolar case we have an additional offset term due to the beta error of the pnp mirror. As we know, this error is

$$
\Delta I_{C 4}=-\frac{2}{\beta_{F p}} I_{C 4} \cong-\frac{2}{\beta_{F p}} I_{C}
$$

where $\beta_{F_{p}}$ is the average beta of the pnp BJTs. Dividing this term by $-g_{m}\left(=-I_{C} / V_{T}\right)$ gives

$$
\begin{equation*}
V_{O S(\text { systematic) }} \cong \frac{\Delta I_{C 4}}{-g_{m}}=V_{T} \frac{2}{\beta_{F p}} \tag{4.160}
\end{equation*}
$$

This is the corrective voltage that we need to apply at the input in order to compensate for the beta error of the mirror, even if the npn and pnp pairs are perfectly matched. Unlike the offset terms resulting from random transistor mismatches, the term of Eq. (4.160) occurs always in the same direction and is therefore referred to as a systematic offset term. If necessary, it can be reduced by implementing the active load with a mirror equipped with a beta helper, or with a cascode-type or a Wilson-type mirror.

Using the data of Example 4.25a, discuss the effect of $\beta_{F p}$ in the bipolar circuit of Fig. 4.65a.

### Solution

With $v_{I D}=0$ we have $I_{C} \cong 500 \mu \mathrm{~A}$ and $V_{E B p} \cong 0.7 \mathrm{~V}$. If the pnp BJTs had infinite betas, the circuit would yield $V_{O} \cong 10-0.7=9.3 \mathrm{~V}$. However, because of noninfinite pnp betas, the mirror exhibits an error $\Delta I_{C 4} \cong-(2 / 50) 500=-20 \mu \mathrm{~A}$. To achieve $I_{C 4}=I_{C 2}$, the output will change automatically by $\Delta V_{O}=R_{o} \Delta I_{C 4}=67 \times$ $10^{3} \times\left(-20 \times 10^{-6}\right) \cong-1.3 \mathrm{~V}$ and settle at $V_{o} \cong 9.3-1.3=8.0 \mathrm{~V}$, in agreement with the VTC of Fig. 4.65b. If we wish to ensure ideal dc balance we must drive $V_{O}$ back to 9.3 V . This is achieved by applying a corrective input voltage $V_{I D}=$ $-\Delta V_{o} / a_{d m}=1.3 / 1282 \cong 1 \mathrm{mV}$. Sure enough, this is the offset term predicted by Eq. (4.160), that is, $V_{O S \text { (systematic) }}=26(2 / 50)=1 \mathrm{mV}$ !

Turning next to the CMOS circuit of Fig. $4.64 b$, we note the absence of any systematic offset because the gate currents are zero. The offset now stems from $k$ and $V_{t}$ mismatches in each transistor pair. It is left as an exercise for the student (see Problem 4.96) to show that

$$
\begin{equation*}
V_{O S(\mathrm{MOS})} \cong \frac{V_{O V n}}{2} \sqrt{\left(\frac{\Delta k_{n}}{k_{n}}\right)^{2}+\left(\frac{\Delta k_{p}}{k_{p}}\right)^{2}+\left(\frac{\Delta V_{t n}}{0.5 V_{O V n}}\right)^{2}+\left(\frac{\Delta V_{t p}}{0.5 V_{O V n}}\right)^{2}} \tag{4.161}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-032.jpg?height=802&width=1546&top_left_y=200&top_left_x=103)

FIGURE 4.71 (a) Bipolar and (b) CMOS folded-cascoded differential pairs.
If the active-load mismatches have equal magnitudes as those of the differential pair, the effect of the active load is to make the offset typically $\sqrt{2}$ times as large as that due to the differential pair alone.

### Folded-Cascoded Differential Pairs

A notorious drawback in both circuits of Fig. 4.64 is limited voltage headroom at the output. The upper limit of the output voltage swing (OVS) is reached when $Q_{4} / M_{4}$ is driven to the edge of saturation (EOS), so the bipolar circuit has $v_{O(\max )}=V_{C C}-$ $V_{E C 4(\mathrm{EOS})}$ and the MOS version has $v_{O(\max )}=V_{D D}-V_{O V 4}$. The lower limit of the OVS is reached when $Q_{2} / M_{2}$ is driven to the EOS, so the bipolar circuit has $v_{O(\text { min })}=v_{12}-$ $V_{B E 2}+V_{C E 2(\mathrm{EOS})}$ and the MOS circuit has $v_{O(\min )}=v_{12}-V_{G S 2}+V_{O V 2}=v_{12}-\left(V_{t 2}+\right.$ $\left.V_{O V 2}\right)+V_{O V 2}=v_{12}-V_{t 2}$.

It is the lower limit that poses problems because it depends on $v_{12}$. In fact, the higher $v_{12}$, the less voltage headroom is available at the output.

The above drawback is ingeniously avoided via the folded-cascode arrangements of Fig. 4.71, where it is apparent that the lower limit is now reached when $Q_{6} / M_{6}$ is driven to the edge of saturation. In fact, the bipolar circuit has now $v_{O(\min )}=V_{E E}+$ $V_{C E(\mathrm{EOS})}$ and the MOS version has $v_{O(\text { min })}=V_{S S}+V_{O V 6}$. In both cases $v_{O(\text { min })}$ is independent of $v_{12}$ and is fairly close to the negative supply (more in Problems 4.97 and 4.98).

## 4.10 BIPOLAR OUTPUT STAGES

The primary function of the output stage of a voltage-output circuit is to provide low output resistance in order to reduce output loading. In general-purpose ICs such as op amps, the output stage must be capable of supplying enough current (and thus
power) to meet the needs of a variety of loads, and it should do so while consuming a minimum of standby power. Finally, these functions should be provided over a suitably wide frequency bandwidth, with a minimum of distortion, and with a wide output voltage swing-ideally, from rail to rail. Among the various outputstage configurations available in bipolar technology, the ones that have gained most prominence are the so-called push-pull output stages.

### The Class B Push-Pull Output Stage

A good candidate for the role of output stage is the common-collector (CC) configuration because it accepts a small base current to deliver an emitter current $\beta+1$ times as large. Moreover, the driving source's resistance, reflected to the emitter, is $\beta+1$ times as small. The npn BJT only sources emitter current and the pnp BJT only sinks emitter current, so we need both device types in order to accommodate both polarities. The npn BJT will handle positive voltage alternations, when current is to be pushed into the load; the pnp BJT will handle negative voltage alternations, when current is to be pulled out of the load. Aptly called push-pull stage, the circuit is shown in its basic form in Fig. 4.72a. With reference to its voltage transfer curve (VTC) of Fig. $4.72 b$ we observe the following:

- As long as $v_{I}$ falls within the range $-V_{E B 2(\text { on })}<v_{I}<V_{B E 1(\text { on })}$, both BJTs are off, giving $v_{O}=0$.
- As we raise $v_{I}$ above $V_{B E 1(\text { on })}, Q_{1}$ goes on while $Q_{2}$ continues to remain off. In forward-active operation, $Q_{1}$ acts as an emitter follower with a voltage gain of slightly less than $1 \mathrm{~V} / \mathrm{V}$.
- Raising $v_{I}$ above the positive supply voltage will eventually bring $Q_{1}$ to the edge of saturation (EOS), thus estasblishing the upper limit of the output voltage swing (OVS) as $v_{O(\max )}=V_{C C}-V_{C E 1(\mathrm{EOS})}$.
- As we lower $v_{I}$ below $-V_{E B 2(0 n)}$, the roles of $Q_{1}$ and $Q_{2}$ are interchanged, yielding a symmetric VTC with respect to the origin, and such that $v_{O(\min )}=V_{E E}+V_{E C \text { (EOS) }}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-033.jpg?height=593&width=1346&top_left_y=1526&top_left_x=191)

FIGURE 4.72 (a) Class B push-pull circuit and (b) its VTC.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-034.jpg?height=574&width=1316&top_left_y=204&top_left_x=328)

FIGURE 4.73 (a) PSpice Class B push-pull circuit and (b) its input and output waveforms.

We can gain additional insight by simulating the circuit via PSpice. As shown in Fig. 4.73, the circuit introduces considerable distortion due to the presence of the dead band $-V_{E B 2(\text { on })}<v_{I}<V_{B E 1(\text { on })}$, over which neither BJT conducts. Called crossover distortion, it is generally intolerable, so the present circuit is relegated primarily to handling square-wave signals, where crossover distortion is not an issue.

This circuit is said to be of the Class B type because each BJT conducts only during half a cycle (actually, because of the nonzero base-emitter voltage drops, the conduction angle is less than $180^{\circ}$ for each BJT).

### The Class AB Push-Pull Output Stage

If we could arrange for both BJTs to be already conductive for $v_{O}=0$, as opposed to having to wait for $v_{I}$ to raise above $V_{B E 1(\mathrm{on})}$ or to drop below $-V_{E B 2(\text { on })}$, then crossover distortion would be eliminated altogether. This requires establishing between the two bases a voltage drop $V_{B B}=V_{B E 1(\text { on })}+V_{E B 2(\text { on })} \cong 2 \times 0.7=1.4 \mathrm{~V}$. To ensure predictable biasing for the BJTs, $V_{B B}$ must closely track the sum of their base-emitter voltage drops, so we need some form of mirror-like operation. In the classic arrangement of Fig. $4.74 a$ the base bias $V_{B B}$ is provided by the pair of diode-connected BJTs $Q_{3}$ and $Q_{4}$ and the associated current generators $I_{1}$ and $I_{2}$. Referred to as a Class AB stage, the circuit yields the much-improved VTC of Fig. 4.74b. By inspection, we find its small-signal output resistance as

$$
\begin{equation*}
R_{o}=\left(\frac{r_{d 3}}{\beta_{01}+1}+r_{e 1}\right) / /\left(\frac{r_{d 4}}{\beta_{02}+1}+r_{e 2}\right) \tag{4.162}
\end{equation*}
$$

where $r_{d 3}$ and $r_{d 4}$ are the dynamic resistances of the diode-connected BJTs, and $r_{e 1}$ and $r_{e 2}$ are the dynamic resistances seen looking into the emitters of the push-pull BJTs. Usually $R_{o}$ is fairly small.

Circuit behavior is best understood via the PSpice example of Fig. 4.75, which uses the $Q_{5}-Q_{6}$ and $Q_{7}-Q_{8}$ current mirrors, along with the reference source $I_{R E F}$, to bias
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-035.jpg?height=675&width=1147&top_left_y=207&top_left_x=199)

FIGURE 4.74 (a) Class AB push-pull circuit and (b) its VTC.
the diode-connected $Q_{3}{ }^{-} Q_{4}$ pair at $I_{C 3}=I_{C 4}=I_{R E F}=0.1 \mathrm{~mA}$. Referring also to the waveforms of Fig. 4.76, we make the following considerations:

- For $v_{O}=0$ the current through $R_{L}$ is zero, so $Q_{1}$ and $Q_{2}$ must carry identical currents, or $i_{C 1}=i_{C 2}$. Assuming the $Q_{1}-Q_{3}$ and $Q_{2}-Q_{4}$ pairs are matched, $Q_{1}$ will mirror $Q_{3}$ and $Q_{2}$ will mirror $Q_{4}$ to give $i_{C 1}=i_{C 2}=0.1 \mathrm{~mA}$. This is called
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-035.jpg?height=804&width=1417&top_left_y=1268&top_left_x=203)

FIGURE 4.75 (a) PSpice circuit of a Class AB bipolar push-pull stage, and (b) its VTC.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-036.jpg?height=569&width=1469&top_left_y=192&top_left_x=181)

FIGURE 4.76 (a) Voltage and (b) current waveforms for the PSpice circuit of Fig. 4.75.
the quiescent current $I_{Q}$ of the $Q_{1}-Q_{2}$ pair. For the sake of efficiency, in a welldesigned circuit $I_{Q}$ is kept at the minimum necessary to avoid distortion. It is apparent that $v_{O}=0$ for $v_{I}=0$. When $i_{L}=0$, the circuit is said to be in standby.

- As we increase $v_{l}, v_{O}$ will also increase due to the emitter-follower action by $Q_{1}$. So, the load current $i_{L}=v_{O} / R_{L}$ will also increase, in turn raising $i_{C 1}$. For instance, as $i_{C 1}$ doubles, $v_{B E 1}$ will increase by 18 mV , by the well-known rule of thumb. But, since $v_{B E 1}+v_{E B 2}=V_{B B} \cong$ constant, the $18-\mathrm{mV}$ increase in $v_{B E 1}$ will cause an $18-\mathrm{mV}$ decrease in $v_{E B 2}$, indicating that $i_{C 2}$ will halve. It is apparent from Fig. $4.76 b$ that as $v_{I}$ is raised further, we eventually get $i_{C 2} \rightarrow 0$ and $i_{C 1} \rightarrow i_{L}$.
- For $v_{I}$ sufficiently large, diode $Q_{3}$ will go off, causing $Q_{5}$ to saturate. Consequently, the VTC itself will saturate. The upper limit of the OVS is reached when $Q_{5}$ is brought to the EOS, so we now have

$$
\begin{equation*}
v_{O(\max )}=V_{C C}-V_{E C S(\mathrm{EOS})}-V_{B E 1(\mathrm{on})} \tag{4.163a}
\end{equation*}
$$

For the circuit under consideration, $v_{O(\max )} \cong 5-0.2-0.7=4.1 \mathrm{~V}$.

- As we lower $v_{I}$ below 0 V , the roles of $Q_{1}$ and $Q_{2}$ are interchanged, thus yielding a symmetric VTC. The lower limits of the OVS is

$$
\begin{equation*}
v_{O(\min )}=V_{E E}+V_{C E 7(\mathrm{EOS})}+V_{E B 2(\mathrm{on})} \tag{4.163b}
\end{equation*}
$$

Presently, $v_{O(\text { min })} \cong-4.1 \mathrm{~V}$.
For a better understanding of the interplay among the various currents, we apply KVL to write $v_{B E 1}+v_{E B 2}=V_{B E 3}+V_{E B 4}$. Using the well-known BJT equation we rewrite as

$$
V_{T} \ln \frac{i_{C 1}}{I_{s 1}}+V_{T} \ln \frac{i_{C 2}}{I_{s 2}}=V_{T} \ln \frac{I_{C 3}}{I_{s 3}}+V_{T} \ln \frac{I_{C 4}}{I_{s 4}}
$$

or

$$
V_{T} \ln \left(\frac{i_{C 1}}{I_{s 1}} \frac{i_{c 2}}{I_{s 2}}\right)=V_{T} \ln \left(\frac{I_{C 3}}{I_{s 3}} \frac{I_{C 4}}{I_{s 4}}\right)
$$

For this equality to hold, the arguments of the logarithms must be identical, so we get

$$
\begin{equation*}
i_{C 1} i_{C 2}=\left(\frac{I_{s 1} I_{s 2}}{I_{s 3} I_{s 4}}\right) I_{C 3} I_{C 4} \tag{4.164}
\end{equation*}
$$

indicating that the product $i_{C 1} i_{C 2}$ remains constant. In the example of Fig. 4.75 we have $i_{C 1} i_{C 2}=I_{C 3} I_{C 4}=(0.1 \mathrm{~mA})^{2}=10^{-8} \mathrm{~A}^{2}$. This means that if one of the two currents increases because of $i_{L}$ by a given number of octaves or decades, the other current must decrease by the same number of octaves or decades. As we know, for $i_{L}=0$ the circuit is in standby with $i_{C 1}=i_{C 2}$ and it draws the quiescent current

$$
\begin{equation*}
I_{Q}=\sqrt{\frac{I_{s 1} I_{s 2}}{I_{s 3} I_{s 4}} I_{C 3} I_{C 4}} \tag{4.165}
\end{equation*}
$$

Since all its BJTs are assumed identical, the present circuit has $I_{Q}=0.1 \mathrm{~mA}$.
(a) For the circuit of Fig. $4.75 a$, find $v_{I}$ for $i_{C 1}=0.4 \mathrm{~mA}$. What is the corresponding value of $v_{o}$ ?
(b) Find $v_{I}$ for $v_{O}=-0.25 \mathrm{~V}$. What are the values of $i_{C 1}$ and $i_{C 2}$ ?
(c) Estimate $v_{O}$ if $v_{I}=1.0 \mathrm{~V}$.

### Solution

(a) Increasing $i_{C 1}$ from 0.1 mA to 0.4 mA (two octaves) will lower $i_{C 2}$ from 0.1 mA to $0.1 /(2 \times 2)=0.025 \mathrm{~mA}$. By KCL, $i_{L}=i_{C 1}-i_{C 2}=0.4-0.025=$ 0.375 mA . By Ohm's law, $v_{O}=R_{L} i_{L}=1 \times 0.375=0.375 \mathrm{~V}$. By the rule of thumb, a two-octave increase in $i_{C 1}$ requires an increase in $v_{B E 1}$ of $2 \times 18=$ 36 mV . Thus, to raise $v_{O}$ from 0 V to 0.375 V , we must raise $v_{I}$ from 0 V to $0.375+0.036=0.411 \mathrm{~V}$.
(b) We now have $i_{L}=v_{O} / R_{L}=-0.25 / 1=-0.25 \mathrm{~mA}$, that is, a $0.25-\mathrm{mA}$ load current flowing into $Q_{2}$ 's emitter. KCL now gives $i_{C 2}=i_{L}+i_{C 1}=0.25 \times$ $10^{-3}+10^{-8} / i_{C 2}$, which we solve to get $i_{C 2}=0.285 \mathrm{~mA}$. Moreover, $i_{C 1}=$ $10^{-8} /\left(0.285 \times 10^{-3}\right)=0.035 \mathrm{~mA}$. Raising $i_{C 2}$ from 0.1 mA to 0.285 mA requires that $v_{E B 2}$ be increased by $(26 \mathrm{mV}) \ln (0.285 / 0.1) \cong 27 \mathrm{mV}$. Consequently, $v_{I}=-0.25-0.027=-0.277 \mathrm{~V}$.
(c) We anticipate $v_{O}$ to be slightly less than 1.0 V . Start out with the initial estimate $v_{O(0)} \cong 1 \mathrm{~V}$ and then iterate. We have $i_{L(0)} \cong 1 / 1=1 \mathrm{~mA}$ and $i_{C 2} \ll i_{C 1}$, so $i_{C 1(0)} \cong i_{L(0)} \cong 1 \mathrm{~mA}$. To increase $i_{C 1}$ from 0.1 mA to 1 mA (one decade), we must increase $v_{B E 1}$ by 60 mV , by the well-known rule of thumb. So, a better estimate is $v_{O(1)}=1.0-0.06=0.94 \mathrm{~V}$. Then, $i_{L(1)}=0.94 / 1=0.94 \mathrm{~mA}$ and $i_{C 2(1)}=10^{-8} /\left(0.94 \times 10^{-3}\right)=0.016 \mathrm{~mA}$. The reader can do one more iteration to verify that the last results are adequate enough.

### Overload Protection

Bipolar push-pull stages are notoriously vulnerable to overload conditions such as the inadvertent shorting of the output terminal to ground. When an overload condition arises, the stage upstream will step up the base drive of the overloaded BJT, causing the latter to draw sufficient current to overheat and possibly destroy itself. We need watchdog circuitry to sense the current in each of the push-pull BJTs, and should this current try to exceed a prescribed safety limit, intervene in such a way as to prevent any further current increase. The output stage will no longer perform its intended function, but at least it will be saved from possible destruction.

Shown in Fig. 4.77 is the overload protection circuitry for $Q_{1}$, but a similar concept can be used to protect $Q_{2}$. This circuitry consists of a small series resistance $R_{S C}$ to sense the emitter current of $Q_{1}$, and a watchdog BJT $Q_{5}$ designed to be off under normal operation, but to go on as soon as the load attempts to draw excessive current from $Q_{1}$. Once on, $Q_{5}$ will divert to the load any excess current from the $I_{1}$ source, letting into $Q_{1}$ 's base only the amount necessary to sustain $Q_{1}$ 's conduction at the safety limit. The current sensing resistance is chosen as

$$
\begin{equation*}
R_{\mathrm{SC}}=\frac{V_{B E 5(\mathrm{on})}}{I_{S C}} \tag{4.166}
\end{equation*}
$$

where $V_{B E 5(\text { on })}$ is the voltage needed to turn on $Q_{5}$ and $I_{S C}$ is the maximum allowed current for $Q_{1}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-038.jpg?height=720&width=595&top_left_y=1347&top_left_x=449)

FIGURE 4.77 Overload protection for $Q_{1}$.

In the circuit of Fig. 4.77 let $\beta_{F 1}=\beta_{F 5}=250, V_{B E 5(\text { on })}=0.7 \mathrm{~V}, I_{1}=I_{2}=300 \mu \mathrm{~A}$,
EXAMPLE 4.29 and $V_{C C}=15 \mathrm{~V}$. Suppose the circuit is part of a negative-feedback system designed to regulate the output at $V_{o}=10 \mathrm{~V}$.
(a) Specify $R_{S C}$ for $I_{S C}=20 \mathrm{~mA}$.
(b) Show all relevant voltages and currents if a student tries the circuit in the lab with $R_{L}=2.0 \mathrm{k} \Omega$.
(c) Repeat if the student, because of a resistance color-code misreading, loads the circuit with $R_{L}=20 \Omega$ instead of $R_{L}=2.0 \mathrm{k} \Omega$.
(d) What is likely to happen if $Q_{1}$ does not have short-circuit protection? Comment on your findings.

### Solution

(a) $R_{S C}=0.7 / 0.020=35 \Omega$.
(b) With $R_{L}=2.0 \mathrm{k} \Omega$ we have $I_{L}=V_{o} / R_{L}=10 / 2.0=5 \mathrm{~mA}$. As it flows through $R_{\mathrm{SC}}$, this current creates the voltage drop $V_{B E 5}=R_{S C} I_{L}=0.035 \times 5=0.175 \mathrm{~V}$. This is insufficient to turn on $Q_{5}$, so the latter will remain in a dormant state, like a good watchdog should do. To supply $5 \mathrm{~mA}, Q_{1}$ draws the base current $I_{B 1}=$ $I_{E 1} /\left(\beta_{F 1}+1\right)=5 / 251 \cong 20 \mu \mathrm{~A}$. This current comes from the $I_{1}$ source, so the remaining $280 \mu \mathrm{~A}$ go to the diode $Q_{3}$. The situation is illustrated in Fig. 4.78a.
(c) Installing a voracious load such as $R_{L}=20 \Omega$ will pull $V_{O}$ down toward ground. Sensing this drop in $V_{O}$ via the feedback network, the circuitry upstream will try adjusting $v_{I}$ in such a way as to boost the base drive of $Q_{1}$ in order to raise $V_{o}$. In fact, all of $I_{1}$ will now be diverted toward $Q_{1}$, thereby awakening $Q_{5}$ and leading to the overload situation of Fig. 4.78b. Here, $Q_{1}$ 's current is limited
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-039.jpg?height=809&width=1479&top_left_y=1272&top_left_x=240)

FIGURE 4.78 Circuit of Example 4.29 operating under (a) normal and (b) overload conditions.
to about $I_{S C}=20 \mathrm{~mA}$. To sustain this current, $Q_{1}$ draws the base current $I_{B 1}=I_{S C} /\left(\beta_{F}+1\right)=20 / 251 \cong 80 \mu \mathrm{~A}$. The remaining current of $300-80=$ $220 \mu \mathrm{~A}$ is passed on by $Q_{5}$ directly to the load. Allowing for about $1 \mu \mathrm{~A}$ of base current for $Q_{5}$, we have $I_{E 5}=220+1=221 \mu \mathrm{~A}, I_{L}=20+0.221=$ 20.221 mA , and $V_{O}=20 \times 20.221 \times 10^{-3} \cong 0.4 \mathrm{~V}$. This is a far cry from the intended value $V_{O}=10 \mathrm{~V}$, but at least $Q_{1}$ is spared destruction.
(d) Without protection, $Q_{1}$ would try to draw $I_{E 1}=\left(\beta_{F}+1\right) I_{1}=251 \times 0.3 \cong$ 75 mA , raising the output only to $V_{O}=0.020 \times 75=1.5 \mathrm{~V}$. The power dissipated by $Q_{1}$ would be $P_{1} \cong V_{C E 1} \times I_{C 1}=(15-1.5) 75>1 \mathrm{~W}$, high enough to cause the monolithic BJT $Q_{1}$ most likely to blow out.

## 4.11 CMOS OUTPUT STAGES

As in the bipolar case, a CMOS output stage should provide low output impedance over a wide frequency bandwidth and with a wide OVS‚Äîideally from rail to railwhile consuming a minimum of standby power. As we are about to see, the design of CMOS output stages presents some marked differences compared to the bipolar case.

### The CD Push-Pull Output Stage

In principle, the bipolar Class AB configuration of Fig. 4.75 could be replicated in MOS form as shown in Fig. 4.79. Here, the common-drain (CD) $M_{1}-M_{2}$ pair forms the push-pull stage proper; the diode-connected $M_{3}-M_{4}$ pair biases the $M_{1}-M_{2}$ pair
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-040.jpg?height=710&width=745&top_left_y=1275&top_left_x=116)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-040.jpg?height=531&width=760&top_left_y=1423&top_left_x=888)
(b)

FIGURE 4.79 (a) PSpice circuit of the CD push-pull output stage, and (b) its VTC. (All FETs have $V_{t}=0.75 \mathrm{~V}$ and $\lambda=0.02 \mathrm{~V}^{-1}$; moreover, $k_{1}=k_{2}=4 \mathrm{~mA} / \mathrm{V}^{2}$, and $k_{3}=k_{4}=k_{5}=k_{6}=k_{7}=k_{8}=1.6 \mathrm{~mA} / \mathrm{V}^{2}$.)
for Class AB operation, and the current mirrors $M_{5}-M_{6}$ and $M_{7}-M_{8}$, along with the reference current $I_{R E F}$, provide the necessary current to bias the diode pair. By inspection, the output resistance is

$$
\begin{equation*}
R_{o}=\frac{1}{\left(g_{m 1}+g_{m 2}\right)} / / r_{o 1} / / r_{o 2} \tag{4.167}
\end{equation*}
$$

which is usually low. Using KVL we readily find the limits of the output voltage swing (OVS) as

$$
\begin{align*}
& v_{O(\max )}=V_{D D}-V_{O V 5}-V_{t 1}-v_{O V 1}  \tag{4.168a}\\
& v_{O(\min )}=V_{S S}+V_{O V 7}+\left|V_{t 2}\right|+v_{O V 2} \tag{4.168b}
\end{align*}
$$

We immediately note a glaring difference compared to the bipolar case. While the voltage drops $V_{E C 5(\mathrm{EOS})}+V_{B E 1(\mathrm{on})}$ and $V_{C E 7(\mathrm{EOS})}+V_{E B 2(\mathrm{on})}$ of Eq. (4.163) are relatively constant $(\sim 0.9 \mathrm{~V})$, their counterpart drops $V_{O V 5}+V_{t 1}+v_{O V 1}$ and $V_{O V 7}+\left|V_{t 2}\right|+v_{O V 2}$ of Eq. (4.168) depend on $i_{L}$ via $v_{O V 1}$ and $v_{O V 2}$. Moreover, $V_{t 1}$ and $V_{t 2}$ are subject to the body effect, further reducing the OVS, at whose extremes $V_{t 1}$ and $V_{t 2}$ get maximized. In the CMOS example of Fig. 4.79 the edges of the OVS are within a couple of volts of either supply rail, whereas in the bipolar example of Fig. 4.75 they are approximately fixed and within less than a volt. The limited OVS of the Class AB CD stage can be a serious drawback in low-voltage power supply systems, where better design alternatives are necessary.

### The CMOS Inverter as Output Stage

The OVS can be improved considerably if the FETs of the push-pull pair are operated in the common-source (CS) mode instead of the CD mode. This is the case of the already familiar CMOS inverter, shown again in Fig. 4.80. The ensuing VTC, obtained using the same transistor parameters and load resistance as in Fig. 4.79,
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-041.jpg?height=583&width=1278&top_left_y=1458&top_left_x=192)

FIGURE 4.80 (a) PSpice circuit of the CMOS inverter, and (b) its VTC. (Both FETs have $k=4 \mathrm{~mA} / \mathrm{V}^{2}, V_{t}=0.75 \mathrm{~V}$, and $\lambda=0.02 \mathrm{~V}^{-1}$.)
clearly shows the circuit's ability to swing its output fairly close to the power-supply rails. However, as an output stage, the inverter suffers from a number of drawbacks: its VTC is highly nonlinear, its output resistance $R_{o}=r_{o 1} / / r_{o 2}$ is usually too high, and and its quiescent current can be intolerably large. (The circuit provides also polarity inversion, but this is not a serious issue as we can deliberately invert signal polarity somewhere else in the system.) For these reasons, the CMOS inverter is relegated to logic-type output circuits such as voltage comparators, where $v_{O}$ sits mostly at either logic level, undergoing only rapid transitions between one logic level and the other.

### The CS Push-Pull Output Stage with Feedback Amplifiers

The shortcomings of the CMOS-inverter output stage are cleverly avoided by separately predistorting the gate drives in such a way as to ensure a fairly linear VTC with a comparatively wide OVS. This task is accomplished by means of negative feedback, according to the principle depicted in Fig. 4.81 $a$. We make the following considerations:

- The circuit is made up of two complementary subcircuits, each consisting of a low-gain op amp and a CS FET connected for negative-feedback operation (note that since the CS configuration provides signal inversion, the ouput is fed back to the op amp's noninverting input, rather than to the more usual inverting input). In this mode of operation each op amp will provide the corresponding FET with whatever gate drive it takes to force $v_{O}$ to track $v_{I}$. Consequently, as long as at least one of the op amps can exercise its negative-feedback control, we expect a fairly linear VTC.
- The op amps, themselves made up of MOSFETs, are deliberately unbalanced for the purpose of setting the quiescent current of the push-pull pair at a specified
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-042.jpg?height=623&width=1436&top_left_y=1452&top_left_x=205)

FIGURE 4.81 (a) CS push-pull output stage, and (b) ac equivalent to find its output resistance $R_{0}$.
value, as we shall see in Example 4.30. This imbalance, created by fabricating the two halves of each amplifier with differing $W / L$ ratios, is modeled via the offset voltages $V_{O S 1}$ and $V_{O S 2}$.

- Negative feedback, besides linearizing the VTC, reduces the output resistance $R_{o}$ dramatically. To substantiate, set all independent sources to zero and apply a test source $v_{o}$ as in Fig. 4.81b. By KCL,

$$
i_{o}=\frac{v_{o}}{r_{o 1}}+\frac{v_{o}}{r_{o 2}}+g_{m 1} a v_{o}+g_{m 2} a v_{o}
$$

Collecting, we get

$$
\begin{equation*}
R_{o}=\frac{v_{o}}{i_{o}}=\frac{1}{a\left(g_{m 1}+g_{m 2}\right)} / / r_{o 1} / / r_{o 2} \tag{4.169}
\end{equation*}
$$

which shows a two-fold beneficial effect of negative feedback upon the output resistance: $(a)$ it brings the $g_{m} \mathrm{~s}$ into the picture $\left(1 / g_{m} \ll r_{o}\right)$, and $(b)$ it multiplies them by the gain $a$ to further lower $R_{o}$.

Let the MOSFETs of Fig. $4.81 a$ be matched devices with $k=4 \mathrm{~mA} / \mathrm{V}^{2}, V_{t}=0.75 \mathrm{~V}$, and $\lambda=0.02 \mathrm{~V}^{-1}$. Moreover, let $V_{D D}=-V_{S S}=5.0 \mathrm{~V}$ and $a=10 \mathrm{~V} / \mathrm{V}$.
(a) Specify $V_{O S 1}$ and $V_{O S 2}$ for a standby current $I_{Q}=125 \mu \mathrm{~A}$.
(b) Find the value of $R_{o}$ in standby.
(c) Find $v_{O}$ if $v_{I}=4.0 \mathrm{~V}$ and $R_{L}=1 \mathrm{k} \Omega$.
(d) Use PSpice to display $v_{O}, i_{L}, i_{D 1}, i_{D 2}, v_{G 1}$ and $v_{G 2}$ versus $v_{I}$ for $-5 \mathrm{~V}<v_{I}<+5 \mathrm{~V}$. Hence, comment on your findings.

### Solution

(a) In standby $\left(v_{O}=v_{I}=0\right)$ both FETs are saturated, so we impose

$$
125 \mu \mathrm{~A}=\frac{1}{2}\left(4 \mathrm{~mA} / \mathrm{V}^{2}\right) V_{O V(S B Y)}^{2}
$$

to obtain $V_{O V(\mathrm{SBY})}=0.25 \mathrm{~V}$. The required gate voltage for $M_{1}$ in standby is $V_{G 1(\mathrm{SBY})}=V_{D D}-V_{t}-V_{O V(S B Y)}=5-0.75-0.25=4 \mathrm{~V}$. But, $V_{G 1(\mathrm{SBY})}$ is generated by the upper op amp as $V_{G 1(\mathrm{SBY})}=a\left(v_{P}-v_{N}\right)$, so imposing $4=$ $10\left[0-\left(-V_{O S 1}\right)\right]$ gives $V_{O S 1}=0.4 \mathrm{~V}$. With matched FETs we have, by symmetry, $V_{O S 2}=V_{O S 1}=0.4 \mathrm{~V}$.
(b) In standby we have $g_{m 1}=g_{m 2}=2 I_{Q} / V_{O V(\text { SBY })}=2 \times 125 \times 10^{-6} / 0.25=$ $1 /(1 \mathrm{k} \Omega)$ and $r_{o 1}=r_{o 2}=1 /\left(\lambda I_{D}\right)=1 /\left(0.02 \times 125 \times 10^{-6}\right)=400 \mathrm{k} \Omega$, so

$$
R_{o}=\frac{1}{10\left(10^{-3}+10^{-3}\right)} / /\left(400 \times 10^{3}\right) / /\left(400 \times 10^{3}\right) \cong 50 \Omega
$$

which is quite low.
(c) For $v_{I}=4.0 \mathrm{~V}$ we expect $v_{O}$ to approach 4 V , indicating that with a relatively small $v_{S D 1}, M_{1}$ is likely to be in the triode region, where

$$
i_{D 1}=k\left[v_{O V 1} v_{S D 1}-\frac{1}{2} v_{S D 1}^{2}\right]=4\left[\left(5-0.75-v_{G 1}\right)\left(5-v_{O}\right)-\frac{1}{2}\left(5-v_{O}\right)^{2}\right]
$$

We also have, by inspection,
$v_{G 1}=a\left(v_{P}-v_{N}\right)=a\left[v_{O}-\left(v_{I}-V_{O S 1}\right)\right]=10\left(v_{O}-(4-0.4)\right]=10\left(v_{O}-3.6\right)$
Moreover, we expect $M_{2}$ to be in cutoff, so we can write

$$
i_{D 1}=i_{L}=\frac{v_{O}}{R_{L}}=\frac{v_{O}}{1}
$$

Eliminating $v_{G 1}$ and $i_{D 1}$ and solving gives the physically acceptable solution $v_{O}=3.88 \mathrm{~V}$ (fairly close to 4 V , as expected). Back substituting gives $v_{G 1}=2.82 \mathrm{~V}$. Since $v_{S D 1}<v_{O V 1}(1.12 \mathrm{~V}<1.43 \mathrm{~V})$, the FET is indeed in the triode region.
(d) Using the PSpice circuit of Fig. 4.82a we obtain the VTC of Fig. 4.82b, which is fairly linear over a wide OVS. The plots of Fig. 4.83a confirm that for $v_{I}=0$ the op amps provide $v_{G 1}=4 \mathrm{~V}$ and $v_{G 2}=-4 \mathrm{~V}$ in order to ensure the voltage overdrives of 0.25 V needed to bias both FETs at $I_{Q}=125 \mu \mathrm{~A}$. As $v_{I}$ moves away from 0 V , one of the FETs goes off while the other takes on the task of feeding the load. Even more revealing are the plots of Fig. 4.83b, showing how the op amps predistort the gate drives $v_{G 1}$ and $v_{G 2}$ in order to ensure a fairly linear voltage transfer characteristic, especially toward the extremes of the OVS. The predistorting action by negative feedback will be investigated more systematically in Chapter 7.
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-044.jpg?height=672&width=1481&top_left_y=1317&top_left_x=119)

FIGURE 4.82 (a) PSpice circuit of the CS push-pull stage of Example 4.30, and (b) its VTC. (Both FETs have $k=4 \mathrm{~mA} / \mathrm{V}^{2}, V_{t}=0.75 \mathrm{~V}$, and $\lambda=0.02 \mathrm{~V}^{-1}$; both op amps have $a=10 \mathrm{~V} / \mathrm{V}$ and $V_{\text {oS }}=0.4 \mathrm{~V}$.)
![](https://cdn.mathpix.com/cropped/2024_11_07_5164bfa4592205a41db8g-045.jpg?height=586&width=1508&top_left_y=200&top_left_x=190)

FIGURE 4.83 (a) Current and (b) voltage transfer curves for the PSpice circuit of Fig. 4.82a.

## APPENDIX 4A

Editing SPICE Netlists

The MOSFET models available in the Eval library of Version 9.2 of PSpice refer to devices with body and source tied together. However, if we want to investigate the body effect, we can readily untie the two terminals and connect the body to the MNV in the case of $n$ MOSFETs or to the MPV in the case of $p$ MOSFETs by suitably editing the circuit's netlist. (A netlist is an internal code to which PSpice automatically converts the circuit entered via the Schematic Capture facility, before performing the actual simulation.)

To illustrate, refer to the PSpice example of Fig. 4.27. Once we have created the circuit schematic via the Place $\rightarrow$ Part and Place $\rightarrow$ Wire commands, we first use PSpice $\rightarrow$ Create Netlist to direct PSpice to generate the netlist, and then we use PSpice $\rightarrow$ View Netlist to visualize it. The result is the following lines of code:

| * source | CKT_of_Fig_4.27 |
| :--- | :--- |
| M_M1 | VDD I O O Mn |
| V_V1 | VDD 0 5Vdc |
| V_V2 | 0 VSS 5Vdc |
| V_VS | I O OVdc |
| I_ID | O VSS DC 250uA |

We are interested in the second line, which refers to the MOSFET $M_{1}$ of Fig. 4.27, renamed by PSpice as M_M1. The remaining entries in this line refer to the circuit's nodes to which the Drain, Gate, Source, and Body (in that order) are connected. These are, respectively, the power supply (VDD), the input node (I), the output node $(\mathrm{O})$, and again the output node (O). The last entry (Mn) refers to the PSpice model for
$M_{1}$, which has been created in accordance with Appendix 3A to reflect the characteristics listed in the caption of Fig. 4.27. This model is

```
.model Mn NMOS(Kp=100u Vto=0.5V Lambda=0.05 Gamma=0.75
+ Phi=0.6)
```

We now edit (overwrite) the netlist by modifying the second line as follows:

```
* source CKT_of_Fig_4.27
M_M1 VDD I O VSS Mn W=10u L=1u
V_V1 VDD 0 5Vdc
V_V2 0 VSS 5Vdc
V_vS I 0 OVdc
I_ID O VSS DC 250uA
```

The body, formely connected to the source ( 0 ), is now connected to the negative power supply (VSS). Moreover, the model name (Mn) is followed by the specifications of the channel width and length ( $\mathrm{W}=10 \mathrm{u} \quad \mathrm{L}=1 \mathrm{u}$ ). This is particularly convenient in multi-transistor circuits, where all FETs share the same process parameters as specified in a common model ( Mn in this case), but each device is assigned its individual W and L values in the netlist line where the device appears.

Once the netlist has been edited, we must save it via the File $\rightarrow$ Save commands. We finally launch the simulation of the circuit pertaining to the modified netlist via the PSpice $\rightarrow$ Run commands, as usual.
