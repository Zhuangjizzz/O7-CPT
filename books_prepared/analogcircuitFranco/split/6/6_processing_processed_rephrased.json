[

{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its primary role is to compare two analog input voltages, $v_{P}$ and $v_{N}$, and produce a binary output, as shown below:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<v_{N} \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, $V_{O L}$ and $V_{O H}$ represent predefined logic levels, such as the standard TTL/CMOS-compatible voltages $V_{O L}=0 \\mathrm{~V}$ and $V_{O H}=5 \\mathrm{~V}$. Often referred to as a decision circuit, the comparator can also function as a 1-bit analog-to-digital converter. Figure 5.20a illustrates the comparator's circuit symbol, while Fig. 5.20b depicts the voltage transfer curve (VTC) derived from Eq. (5.43). As known, the slope of a VTC indicates gain, so the VTC in Fig. $5.20 b$ suggests an amplifier with infinite gain that saturates at $V_{O L}$ and $V_{O H}$.\n\nSince infinite gain is not physically feasible, the VTC of an actual comparator is more accurately represented by Fig. 5.20c, where the voltage gain is approximated by\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H}-V_{O L}}{V_{I H}-V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith $V_{I L}$ and $V_{I H}$ denoting the input voltage values $v_{I}$ at which the gain $a=1 \\mathrm{~V} / \\mathrm{V}$. Consequently, Eq. (5.43) modifies to\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<\\left(v_{N}+V_{I L}\\right) \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>\\left(v_{N}+V_{I H}\\right) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have\n\n$$\n\\begin{equation*}\nv_{O}=a\\left(v_{P}-v_{N}\\right) \\quad \\text { for }\\left(v_{N}+V_{I L}\\right)<v_{P}<\\left(v_{N}+V_{I H}\\right) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo:Diagram (a) depicts a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are illustrated in diagrams (b) and (c), showing the ideal and practical behavior of the comparator, respectively. The practical VTC features a transition region between VIL and VIH, highlighting the comparator's gain and non-ideal characteristics.\nimage_name:(b)\ndescription:The graph labeled (b) represents an ideal Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph depicts the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Graph Type and Function:**\n- It is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\), typically in volts (V).\n- The vertical axis displays the output voltage \\( v_O \\), also in volts (V).\n\n3. **General Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low level \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- The transition between these states is instantaneous, with no gradual change.\n\n4. **Key Features and Technical Details:**\n- The graph includes two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition occurs precisely at \\( v_P - v_N = 0 \\), where the output shifts from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The levels \\( V_{OL} \\) and \\( V_{OH} \\) are marked on the vertical axis, but no specific numerical values are provided.\n- The graph lacks additional annotations or reference lines.\nimage_name:(c)\ndescription:The graph labeled (c) illustrates a real-life Voltage Transfer Characteristic (VTC) for a voltage comparator. This graph plots the voltage difference \\( v_P - v_N \\) on the horizontal axis and the output voltage \\( v_O \\) on the vertical axis, both likely in volts.\n\n1. **Graph Type and Function:**\n- This VTC graph shows the output voltage behavior of a voltage comparator as a function of the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **General Behavior and Trends:**\n- The graph features a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a gain region.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, representing the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The points \\( V_{IL} \\) and \\( V_{IH} \\) are annotated, marking the start and end of the linear gain region.\n- These points indicate the threshold voltages for the output transition between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-life VTC.\n\nIt is evident that the real-life VTC in Fig. 5.20c is an approximation of the ideal VTC in Fig. 5.20b. However, the closer $V_{I L}$ and $V_{I H}$ are to each other, the higher the gain and the closer the VTC to the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the operational amplifier (indeed, they use the same circuit symbol). However, they differ in two key aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an op amp includes a frequency-compensation network, which, in its simplest form, is just a capacitor like $C_{c}$ in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that $C_{c}$ significantly slows down the op amp's dynamics. Comparators, however, do not require frequency compensation since voltage comparison does not involve negative feedback (indeed, a compensation capacitor would only unnecessarily slow down the comparator). Without compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 op amp powered by $\\pm 15-\\mathrm{V}$ supplies saturates at around $\\pm 13 \\mathrm{~V}$, which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed for this type of compatibility.\n\nIf speed and logic compatibility are not critical, an operational amplifier can be used as a voltage comparator. However, most comparator applications necessitate specialized circuits optimized for this specific function. To understand this better, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its primary role is to compare two analog input voltages, \\( v_{P} \\) and \\( v_{N} \\), and produce a binary output, as follows:\n\n$$\n\\begin{array}{ll}\nv_{O} = V_{O L} & \\text{for } v_{P} < v_{N} \\\\\nv_{O} = V_{O H} & \\text{for } v_{P} > v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, \\( V_{O L} \\) and \\( V_{O H} \\) represent predefined logic levels, such as the standard TTL/CMOS-compatible voltages \\( V_{O L} = 0 \\mathrm{~V} \\) and \\( V_{O H} = 5 \\mathrm{~V} \\). Known as a decision circuit, the comparator can also be seen as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC indicates gain, so the VTC in Fig. 5.20b suggests an amplifier with infinite gain that saturates at \\( V_{O L} \\) and \\( V_{O H} \\).\n\nIn reality, infinite gain is unattainable, so the VTC of an actual comparator is more akin to that shown in Fig. 5.20c, where the voltage gain is approximated by\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H} - V_{O L}}{V_{I H} - V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith \\( V_{I L} \\) and \\( V_{I H} \\) denoting the input voltage \\( v_{I} \\) values at which \\( a = 1 \\mathrm{~V} / \\mathrm{V} \\). Consequently, Eq. (5.43) is modified to\n\n$$\n\\begin{array}{ll}\nv_{O} = V_{O L} & \\text{for } v_{P} < (v_{N} + V_{I L}) \\\\\nv_{O} = V_{O H} & \\text{for } v_{P} > (v_{N} + V_{I H}) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have\n\n$$\n\\begin{equation*}\nv_{O} = a(v_{P} - v_{N}) \\quad \\text{for } (v_{N} + V_{I L}) < v_{P} < (v_{N} + V_{I H}) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo: The circuit diagram (a) illustrates a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are depicted in diagrams (b) and (c), showcasing the ideal and practical behavior of the comparator, respectively. The practical VTC exhibits a transition region between VIL and VIH, highlighting the comparator's gain and non-ideal characteristics.\nimage_name:(b)\ndescription: The graph labeled (b) represents an ideal Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph illustrates the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Graph Type and Function:**\n- It is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\), typically in volts (V).\n- The vertical axis displays the output voltage \\( v_O \\), also typically in volts (V).\n\n3. **General Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low level \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- The transition between these states is instantaneous in this ideal graph, with no gradual change.\n\n4. **Key Features and Technical Details:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition occurs precisely at \\( v_P - v_N = 0 \\), where the output shifts from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph clearly marks the levels \\( V_{OL} \\) and \\( V_{OH} \\) on the vertical axis, but specific numerical values are not provided.\n- No additional annotations or reference lines are present on this idealized graph.\nimage_name:(c)\ndescription: The graph labeled (c) is a Voltage Transfer Characteristic (VTC) curve for a real-world voltage comparator. This graph plots the horizontal axis as the voltage difference \\( v_P - v_N \\), and the vertical axis as the output voltage \\( v_O \\), both likely in volts.\n\n1. **Graph Type and Function:**\n- This VTC graph represents the output voltage behavior of a voltage comparator based on the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **General Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a region of linear gain.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, reflecting the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph annotates the points \\( V_{IL} \\) and \\( V_{IH} \\), marking the start and end of the linear gain region.\n- These points indicate the threshold voltages where the output transitions between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-life VTC.\n\nIt is evident that the real-life VTC in Fig. 5.20c is only an approximation of the ideal VTC in Fig. 5.20b. However, the closer \\( V_{I L} \\) and \\( V_{I H} \\) are to each other, the higher the gain and the closer the VTC approaches the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the operational amplifier (indeed, they use the same circuit symbol). However, they differ in two key aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an op amp includes a frequency-compensation network, which, in its simplest form, consists of a capacitor like \\( C_{c} \\) in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that \\( C_{c} \\) significantly slows down the op amp's dynamics. Comparators, however, do not require frequency compensation because voltage comparison does not involve negative feedback (in fact, a compensation capacitor would only unnecessarily slow down the comparator). Without compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 op amp powered by \\( \\pm 15 \\mathrm{~V} \\) supplies saturates at around \\( \\pm 13 \\mathrm{~V} \\), far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed for this type of compatibility.\n\nIf speed and logic compatibility are not critical, an operational amplifier can be used as a voltage comparator. However, most comparator applications necessitate specialized circuits optimized for this specific function. To gain an understanding, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its primary role is to compare two analog input voltages, \\( v_{P} \\) and \\( v_{N} \\), and produce a binary output, as follows:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<v_{N} \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, \\( V_{O L} \\) and \\( V_{O H} \\) are predefined logic levels, such as the standard TTL/CMOS-compatible voltages \\( V_{O L}=0 \\mathrm{~V} \\) and \\( V_{O H}=5 \\mathrm{~V} \\). Often termed a decision circuit, the comparator can also be seen as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC signifies gain, so the VTC in Fig. 5.20b suggests an amplifier with infinite gain that saturates at \\( V_{O L} \\) and \\( V_{O H} \\).\n\nIn reality, infinite gain is unattainable, making the VTC of an actual comparator more akin to that in Fig. 5.20c, where the voltage gain is approximated by\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H}-V_{O L}}{V_{I H}-V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith \\( V_{I L} \\) and \\( V_{I H} \\) denoting the input voltage \\( v_{I} \\) values at which \\( a=1 \\mathrm{~V} / \\mathrm{V} \\). Consequently, Eq. (5.43) modifies to\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<\\left(v_{N}+V_{I L}\\right) \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>\\left(v_{N}+V_{I H}\\right) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have\n\n$$\n\\begin{equation*}\nv_{O}=a\\left(v_{P}-v_{N}\\right) \\quad \\text { for }\\left(v_{N}+V_{I L}\\right)<v_{P}<\\left(v_{N}+V_{I H}\\right) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo:The circuit diagram (a) illustrates a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are depicted in diagrams (b) and (c), showcasing the ideal and practical behaviors of the comparator, respectively. The practical VTC exhibits a transition region between VIL and VIH, highlighting the comparator's gain and non-ideal characteristics.\nimage_name:(b)\ndescription:The graph labeled (b) represents an ideal Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph depicts the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Graph Type and Function:**\n- The graph is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\), typically in volts (V).\n- The vertical axis represents the output voltage \\( v_O \\), also typically in volts (V).\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low level \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) shifts to a high level \\( V_{OH} \\).\n- The transition between these states is instantaneous in the ideal graph, with no intermediate slope or gradual change.\n\n4. **Key Features and Technical Details:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition point occurs precisely at \\( v_P - v_N = 0 \\), where the output switches from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph clearly marks the \\( V_{OL} \\) and \\( V_{OH} \\) levels on the vertical axis, though specific numerical values are not provided.\n- No additional annotations or reference lines are present on this idealized graph.\nimage_name:(c)\ndescription:The graph labeled (c) portrays a Voltage Transfer Characteristic (VTC) curve for a real-world voltage comparator. This graph plots the voltage difference \\( v_P - v_N \\) on the horizontal axis and the output voltage \\( v_O \\) on the vertical axis, both likely in volts.\n\n1. **Graph Type and Function:**\n- This VTC graph illustrates the output voltage behavior of a voltage comparator as a function of the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a region of linear gain.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, representing the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph annotates the points \\( V_{IL} \\) and \\( V_{IH} \\), marking the start and end of the linear gain region.\n- These points indicate the threshold voltages where the output transitions between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-life VTC.\n\nIt is evident that the real-life VTC in Fig. 5.20c is merely an approximation of the ideal VTC in Fig. 5.20b. However, the closer \\( V_{I L} \\) and \\( V_{I H} \\) are to each other, the higher the gain and the closer the VTC to the ideal.\n\nAs a high-gain amplifier, the voltage comparator closely resembles the operational amplifier (indeed, they share the same circuit symbol). However, they differ in two key aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an op amp includes a frequency-compensation network, which, in its simplest form, consists of a single capacitor, such as \\( C_{c} \\) in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that \\( C_{c} \\) significantly slows down the op amp's dynamics. Comparators, conversely, do not require frequency compensation since voltage comparison does not involve negative feedback (in fact, a compensation capacitor would only unnecessarily slow down the comparator). Free from compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 op amp powered by \\( \\pm 15 \\mathrm{~V} \\) supplies saturates at around \\( \\pm 13 \\mathrm{~V} \\), which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed to be compatible with such logic levels.\n\nIf speed and logic compatibility are not critical, an operational amplifier can serve as a voltage comparator. However, most comparator applications necessitate specialized circuits optimized for this specific function. To gain insight, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its role is to compare two analog input voltages, \\( v_{P} \\) and \\( v_{N} \\), and produce a binary output, as follows:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<v_{N} \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, \\( V_{O L} \\) and \\( V_{O H} \\) are predefined logic levels, such as the standard TTL/CMOS-compatible voltages \\( V_{O L}=0 \\mathrm{~V} \\) and \\( V_{O H}=5 \\mathrm{~V} \\). Often termed a decision circuit, the comparator can also be seen as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC signifies gain, so the VTC in Fig. 5.20b suggests an amplifier with infinite gain that saturates at \\( V_{O L} \\) and \\( V_{O H} \\).\n\nSince infinite gain is not physically feasible, the VTC of an actual comparator is more accurately represented by Fig. 5.20c, where the voltage gain is estimated by\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H}-V_{O L}}{V_{I H}-V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith \\( V_{I L} \\) and \\( V_{I H} \\) denoting the values of \\( v_{I} \\) at which \\( a=1 \\mathrm{~V} / \\mathrm{V} \\). Consequently, Eq. (5.43) modifies to\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<\\left(v_{N}+V_{I L}\\right) \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>\\left(v_{N}+V_{I H}\\right) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have\n\n$$\n\\begin{equation*}\nv_{O}=a\\left(v_{P}-v_{N}\\right) \\quad \\text { for }\\left(v_{N}+V_{I L}\\right)<v_{P}<\\left(v_{N}+V_{I H}\\right) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo:The circuit diagram (a) illustrates a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are depicted in diagrams (b) and (c), showing the ideal and real-world behavior of the comparator, respectively. The real-world VTC exhibits a transition region between VIL and VIH, highlighting the gain and non-ideal aspects of the comparator.\nimage_name:(b)\ndescription:The graph labeled (b) represents an ideal Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph shows the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Type of Graph and Function:**\n- The graph is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis represents the input voltage difference \\( v_P - v_N \\), typically in volts (V).\n- The vertical axis represents the output voltage \\( v_O \\), also typically in volts (V).\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low level \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) shifts to a high level \\( V_{OH} \\).\n- The transition between these states is instantaneous in the ideal graph, with no intermediate slope.\n\n4. **Key Features and Technical Details:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition occurs precisely at \\( v_P - v_N = 0 \\), where the output switches from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph marks the levels \\( V_{OL} \\) and \\( V_{OH} \\) on the vertical axis, but specific numerical values are not provided.\n- No additional annotations or reference lines are present on this idealized graph.\nimage_name:(c)\ndescription:The graph labeled (c) presents a Voltage Transfer Characteristic (VTC) curve for a real-world voltage comparator. This graph plots the voltage difference \\( v_P - v_N \\) on the horizontal axis and the output voltage \\( v_O \\) on the vertical axis, both likely in volts.\n\n1. **Type of Graph and Function:**\n- This VTC graph shows the output voltage behavior of a voltage comparator as a function of the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a region of linear gain.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, reflecting the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph annotates \\( V_{IL} \\) and \\( V_{IH} \\), marking the start and end of the linear gain region.\n- These points indicate the threshold voltages where the output transitions between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-world VTC.\n\nIt is evident that the real-world VTC in Fig. 5.20c is an approximation of the ideal VTC in Fig. 5.20b. However, the closer \\( V_{I L} \\) and \\( V_{I H} \\) are to each other, the higher the gain and the closer the VTC approaches the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the operational amplifier (indeed, they use the same circuit symbol). However, they differ in two key aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an operational amplifier includes a frequency-compensation network, which, in its simplest form, is just a capacitor, such as \\( C_{c} \\) in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that \\( C_{c} \\) significantly slows down the operational amplifier's dynamics. Comparators, however, do not require frequency compensation because voltage comparison does not involve negative feedback (indeed, a compensation capacitor would only unnecessarily slow down the comparator). Free from compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 operational amplifier powered by \\( \\pm 15 \\mathrm{~V} \\) supplies saturates at around \\( \\pm 13 \\mathrm{~V} \\), which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed for this type of compatibility.\n\nIf speed and logic compatibility are not critical, an operational amplifier can be used as a voltage comparator. However, most comparator applications require specialized circuits optimized for this specific function. To gain an understanding, let's examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its primary role is to compare two analog input voltages, $v_{P}$ and $v_{N}$, and produce a binary output, as shown below:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<v_{N} \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, $V_{O L}$ and $V_{O H}$ represent predefined logic levels, such as the standard TTL/CMOS-compatible voltages $V_{O L}=0 \\mathrm{~V}$ and $V_{O H}=5 \\mathrm{~V}$. Often referred to as a decision circuit, the comparator can also be seen as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC indicates gain, so the VTC in Fig. $5.20 b$ suggests an amplifier with infinite gain that saturates at $V_{O L}$ and $V_{O H}$.\n\nIn reality, infinite gain is unattainable, so the VTC of an actual comparator more closely resembles Fig. 5.20c, where the voltage gain is estimated by:\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H}-V_{O L}}{V_{I H}-V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith $V_{I L}$ and $V_{I H}$ denoting the input voltage values $v_{I}$ at which the gain $a=1 \\mathrm{~V} / \\mathrm{V}$. Consequently, Eq. (5.43) modifies to:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<\\left(v_{N}+V_{I L}\\right) \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>\\left(v_{N}+V_{I H}\\right) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have:\n\n$$\n\\begin{equation*}\nv_{O}=a\\left(v_{P}-v_{N}\\right) \\quad \\text { for }\\left(v_{N}+V_{I L}\\right)<v_{P}<\\left(v_{N}+V_{I H}\\right) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo:The circuit diagram (a) depicts a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are illustrated in diagrams (b) and (c), showing the ideal and real-world behavior of the comparator, respectively. The real-world VTC displays a transition region between VIL and VIH, highlighting the gain and non-ideal characteristics of the comparator.\nimage_name:(b)\ndescription:The graph labeled (b) represents an idealized Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph depicts the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Type of Graph and Function:**\n- The graph is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\). While specific units are not provided, it is typically in volts (V).\n- The vertical axis represents the output voltage \\( v_O \\), also generally in volts (V).\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) remains at a low value \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) rises to a high value \\( V_{OH} \\).\n- The transition between these states is instantaneous in the idealized graph, with no intermediate slope or gradual change.\n\n4. **Key Features and Technical Details:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition occurs precisely at \\( v_P - v_N = 0 \\), where the output shifts from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph clearly marks the levels \\( V_{OL} \\) and \\( V_{OH} \\) on the vertical axis, though specific numerical values are not provided.\n- There are no additional annotations or reference lines on this idealized graph.\nimage_name:(c)\ndescription:The graph labeled (c) presents a Voltage Transfer Characteristic (VTC) curve for a real-world voltage comparator. This graph plots the horizontal axis as the voltage difference \\( v_P - v_N \\), and the vertical axis as the output voltage \\( v_O \\). Both axes are likely measured in volts, though units are not explicitly stated.\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, illustrating the output voltage behavior of a voltage comparator based on the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a region of linear gain.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, representing the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph annotates the points \\( V_{IL} \\) and \\( V_{IH} \\), marking the start and end of the linear gain region.\n- These points indicate the threshold voltages where the output transitions between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-world VTC.\n\nIt is evident that the real-world VTC in Fig. 5.20c is merely an approximation of the ideal VTC in Fig. 5.20b. However, the closer $V_{I L}$ and $V_{I H}$ are to each other, the higher the gain and the closer the VTC approaches the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the operational amplifier (indeed, they use the same circuit symbol). However, they differ in two key aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an operational amplifier includes a frequency-compensation network, which, in its simplest form, consists of a single capacitor, such as $C_{c}$ in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that $C_{c}$ significantly slows down the operational amplifier's dynamics. Comparators, on the other hand, do not require frequency compensation because voltage comparison does not involve negative feedback (indeed, a compensation capacitor would only unnecessarily slow down the comparator). Free from compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 op amp powered by $\\pm 15-\\mathrm{V}$ supplies saturates at around $\\pm 13 \\mathrm{~V}$, which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed to be compatible with such logic levels.\n\nIf speed and logic compatibility are not critical, an operational amplifier can be used as a voltage comparator. However, most comparator applications require specialized circuits optimized for this specific function. To gain insight, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its primary role is to compare two analog input voltages, \\( v_{P} \\) and \\( v_{N} \\), and produce a binary output, such as:\n\n$$\n\\begin{array}{ll}\nv_{O} = V_{O L} & \\text{for } v_{P} < v_{N} \\\\\nv_{O} = V_{O H} & \\text{for } v_{P} > v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, \\( V_{O L} \\) and \\( V_{O H} \\) are predefined logic levels, like the common TTL/CMOS-compatible voltages \\( V_{O L} = 0 \\mathrm{~V} \\) and \\( V_{O H} = 5 \\mathrm{~V} \\). Often termed a decision circuit, the comparator can also be seen as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC indicates gain, so the VTC in Fig. 5.20b suggests an amplifier with infinite gain that saturates at \\( V_{O L} \\) and \\( V_{O H} \\).\n\nIn reality, infinite gain is unattainable, so the VTC of an actual comparator is more akin to that in Fig. 5.20c, where the voltage gain is approximated by:\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H} - V_{O L}}{V_{I H} - V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith \\( V_{I L} \\) and \\( V_{I H} \\) denoting the input voltage \\( v_{I} \\) values at which \\( a = 1 \\mathrm{~V} / \\mathrm{V} \\). Consequently, Eq. (5.43) modifies to:\n\n$$\n\\begin{array}{ll}\nv_{O} = V_{O L} & \\text{for } v_{P} < (v_{N} + V_{I L}) \\\\\nv_{O} = V_{O H} & \\text{for } v_{P} > (v_{N} + V_{I H}) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have:\n\n$$\n\\begin{equation*}\nv_{O} = a(v_{P} - v_{N}) \\quad \\text{for } (v_{N} + V_{I L}) < v_{P} < (v_{N} + V_{I H}) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo: The circuit diagram (a) depicts a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are illustrated in diagrams (b) and (c), showing the ideal and real-world behavior of the comparator, respectively. The real-world VTC displays a transition region between VIL and VIH, highlighting the comparator's gain and non-ideal characteristics.\nimage_name:(b)\ndescription: The graph labeled (b) represents an idealized Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph depicts the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Graph Type and Function:**\n- The graph is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\), typically in volts (V).\n- The vertical axis represents the output voltage \\( v_O \\), also typically in volts (V).\n\n3. **General Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low level \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) shifts to a high level \\( V_{OH} \\).\n- The transition between these states is instantaneous in the ideal graph, showing no gradual change.\n\n4. **Key Features and Technical Details:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition point is precisely at \\( v_P - v_N = 0 \\), where the output switches from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph clearly marks the levels \\( V_{OL} \\) and \\( V_{OH} \\) on the vertical axis, though no specific numerical values are provided.\n- There are no additional annotations or reference lines on this idealized graph.\nimage_name:(c)\ndescription: The graph labeled (c) is a Voltage Transfer Characteristic (VTC) curve for a real-world voltage comparator. This graph plots the horizontal axis as the voltage difference \\( v_P - v_N \\) and the vertical axis as the output voltage \\( v_O \\). Both axes are likely in volts, though units are not explicitly stated.\n\n1. **Graph Type and Function:**\n- This VTC graph represents the output voltage behavior of a voltage comparator based on the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **General Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a linear gain region.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, reflecting the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph marks the points \\( V_{IL} \\) and \\( V_{IH} \\), indicating the start and end of the linear gain region.\n- These points show the threshold voltages where the output transitions between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-world VTC.\n\nIt is evident that the real-world VTC in Fig. 5.20c is merely an approximation of the ideal VTC in Fig. 5.20b. However, the closer \\( V_{I L} \\) and \\( V_{I H} \\) are to each other, the greater the gain and the closer the VTC to the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the operational amplifier (indeed, they use the same circuit symbol). However, they differ in two key aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an operational amplifier includes a frequency-compensation network, which, in its simplest form, is just a capacitance, such as \\( C_{c} \\) in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that \\( C_{c} \\) significantly slows down the operational amplifier's dynamics. Comparators, conversely, do not require frequency compensation because voltage comparison does not involve negative feedback (in fact, a compensation capacitance would only unnecessarily slow down the comparator). Free from compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 operational amplifier powered by \\( \\pm 15 \\mathrm{~V} \\) supplies saturates at around \\( \\pm 13 \\mathrm{~V} \\), which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed for this type of compatibility.\n\nIf speed and logic compatibility are not critical, an operational amplifier can be used as a voltage comparator. However, most comparator applications demand specialized circuits optimized for this specific function. To gain insight, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its primary role is to compare two analog input voltages, \\( v_{P} \\) and \\( v_{N} \\), and produce a binary output, as follows:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<v_{N} \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, \\( V_{O L} \\) and \\( V_{O H} \\) represent predefined logic levels, such as the standard TTL/CMOS-compatible voltages \\( V_{O L}=0 \\mathrm{~V} \\) and \\( V_{O H}=5 \\mathrm{~V} \\). Often termed a decision circuit, the comparator can also be seen as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC indicates gain, so the VTC in Fig. 5.20b suggests an amplifier with infinite gain that saturates at \\( V_{O L} \\) and \\( V_{O H} \\).\n\nIn reality, infinite gain is unattainable, so the VTC of an actual comparator more closely resembles Fig. 5.20c, where the voltage gain is approximated by\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H}-V_{O L}}{V_{I H}-V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nwith \\( V_{I L} \\) and \\( V_{I H} \\) denoting the input voltage \\( v_{I} \\) values at which \\( a=1 \\mathrm{~V} / \\mathrm{V} \\). Consequently, Eq. (5.43) modifies to\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<\\left(v_{N}+V_{I L}\\right) \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>\\left(v_{N}+V_{I H}\\right) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have\n\n$$\n\\begin{equation*}\nv_{O}=a\\left(v_{P}-v_{N}\\right) \\quad \\text { for }\\left(v_{N}+V_{I L}\\right)<v_{P}<\\left(v_{N}+V_{I H}\\right) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo:The circuit diagram (a) illustrates a voltage comparator utilizing an OpAmp. The voltage transfer characteristics (VTC) are depicted in diagrams (b) and (c), showing the ideal and real-world behavior of the comparator, respectively. The real-world VTC exhibits a transition region between VIL and VIH, highlighting the comparator's gain and non-ideal characteristics.\nimage_name:(b)\ndescription:The graph labeled (b) represents an ideal Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph depicts the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Graph Type and Function:**\n- The graph is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\). No specific units are indicated, but they are typically in volts (V).\n- The vertical axis represents the output voltage \\( v_O \\), also typically in volts (V).\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a step-like transition. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low value \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) rises to a high value \\( V_{OH} \\).\n- The transition between these states is instantaneous in this idealized representation, with no intermediate slope or gradual change.\n\n4. **Key Features and Technical Details:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition point is precisely at \\( v_P - v_N = 0 \\), where the output shifts from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph clearly marks the levels \\( V_{OL} \\) and \\( V_{OH} \\) on the vertical axis, though specific numerical values are not provided.\n- There are no additional annotations or reference lines on this idealized graph.\nimage_name:(c)\ndescription:The graph labeled (c) presents a Voltage Transfer Characteristic (VTC) curve for a real-world voltage comparator. This graph plots the horizontal axis as the voltage difference \\( v_P - v_N \\), and the vertical axis as the output voltage \\( v_O \\). Both axes are assumed to be in volts, though units are not explicitly stated.\n\n1. **Graph Type and Function:**\n- This is a VTC graph, depicting the output voltage behavior of a voltage comparator based on the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), presumably in volts.\n- **Vertical Axis:** \\( v_O \\), presumably in volts.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a region of linear gain.\n\n4. **Key Features and Technical Details:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, reflecting the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph marks the points \\( V_{IL} \\) and \\( V_{IH} \\), indicating the start and end of the linear gain region.\n- These points show the threshold voltages where the output transitions between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-world VTC.\n\nIt is evident that the real-world VTC in Fig. 5.20c is only an approximation of the ideal VTC in Fig. 5.20b. However, the closer \\( V_{I L} \\) and \\( V_{I H} \\) are to each other, the higher the gain and the closer the VTC to the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the operational amplifier (indeed, they use the same circuit symbol). However, they differ in two significant aspects:\n\n- Operational amplifiers are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will see that to prevent potential oscillation, an operational amplifier includes a frequency-compensation network, which, in its simplest form, consists of a single capacitor, such as \\( C_{c} \\) in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will learn that \\( C_{c} \\) significantly slows down the operational amplifier's dynamics. Comparators, conversely, do not require frequency compensation since voltage comparison does not involve negative feedback (in fact, a compensation capacitor would only unnecessarily slow down the comparator). Unencumbered by compensation requirements, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of operational amplifiers are not compatible with digital logic levels (for example, a 741 operational amplifier powered by \\( \\pm 15 \\mathrm{~V} \\) supplies saturates at around \\( \\pm 13 \\mathrm{~V} \\), which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed for this type of compatibility.\n\nIf speed and logic compatibility are not critical, an operational amplifier can be used as a voltage comparator. However, most comparator applications necessitate specialized circuits optimized for this specific function. To gain an understanding, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "Following the operational amplifier, the voltage comparator is arguably the most widely used high-gain amplifier. Its role is to compare two analog input voltages, $v_{P}$ and $v_{N}$, and produce a binary output, such as:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<v_{N} \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>v_{N} \\tag{5.43b}\n\\end{array}\n$$\n\nHere, $V_{O L}$ and $V_{O H}$ are predefined logic levels, such as the standard TTL/CMOS-compatible voltages $V_{O L}=0 \\mathrm{~V}$ and $V_{O H}=5 \\mathrm{~V}$. Often referred to as a decision circuit, the comparator can also function as a 1-bit analog-to-digital converter. Figure 5.20a depicts the comparator's circuit symbol, while Fig. 5.20b illustrates the voltage transfer curve (VTC) derived from Eq. (5.43). As is known, the slope of a VTC indicates gain, so the VTC in Fig. $5.20 b$ suggests an amplifier with infinite gain that saturates at $V_{O L}$ and $V_{O H}$.\n\nSince infinite gain is not physically feasible, the VTC of an actual comparator is more accurately represented by Fig. 5.20c, where the voltage gain is approximated as:\n\n$$\n\\begin{equation*}\na \\cong \\frac{V_{O H}-V_{O L}}{V_{I H}-V_{I L}} \\tag{5.44}\n\\end{equation*}\n$$\n\nIn this context, $V_{I L}$ and $V_{I H}$ denote the input voltage $v_{I}$ values at which the gain $a=1 \\mathrm{~V} / \\mathrm{V}$. Consequently, Eq. (5.43) is modified to:\n\n$$\n\\begin{array}{ll}\nv_{O}=V_{O L} & \\text { for } v_{P}<\\left(v_{N}+V_{I L}\\right) \\\\\nv_{O}=V_{O H} & \\text { for } v_{P}>\\left(v_{N}+V_{I H}\\right) \\tag{5.45b}\n\\end{array}\n$$\n\nAdditionally, we have:\n\n$$\n\\begin{equation*}\nv_{O}=a\\left(v_{P}-v_{N}\\right) \\quad \\text { for }\\left(v_{N}+V_{I L}\\right)<v_{P}<\\left(v_{N}+V_{I H}\\right) \\tag{5.45c}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: OpAmp, type: OpAmp, ports: {InP: vP, InN: vN, OutP: vO}\n]\nextrainfo:Diagram (a) illustrates a voltage comparator using an OpAmp. The voltage transfer characteristics (VTC) are depicted in diagrams (b) and (c), showing the ideal and practical behavior of the comparator, respectively. The practical VTC includes a transition region between VIL and VIH, highlighting the gain and non-ideal aspects of the comparator.\nimage_name:(b)\ndescription:The graph labeled (b) represents an ideal Voltage Transfer Characteristic (VTC) for a voltage comparator. This piecewise linear graph plots the output voltage \\( v_O \\) as a function of the difference between the positive and negative input voltages \\( v_P - v_N \\).\n\n1. **Graph Type and Function:**\n- It is a Voltage Transfer Characteristic (VTC) plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis shows the difference in input voltages \\( v_P - v_N \\), typically in volts (V).\n- The vertical axis represents the output voltage \\( v_O \\), also in volts (V).\n\n3. **General Behavior and Trends:**\n- The graph exhibits a step function. When \\( v_P - v_N < 0 \\), the output voltage \\( v_O \\) is at a low level \\( V_{OL} \\).\n- When \\( v_P - v_N > 0 \\), the output voltage \\( v_O \\) rises to a high level \\( V_{OH} \\).\n- The transition between these states is instantaneous, with no intermediate slope or gradual change.\n\n4. **Key Features and Technical Aspects:**\n- The graph features two distinct horizontal lines indicating the output levels: \\( V_{OL} \\) (low output voltage) and \\( V_{OH} \\) (high output voltage).\n- The transition occurs precisely at \\( v_P - v_N = 0 \\), where the output shifts from \\( V_{OL} \\) to \\( V_{OH} \\).\n\n5. **Annotations and Specific Data Points:**\n- The graph marks the levels \\( V_{OL} \\) and \\( V_{OH} \\) on the vertical axis, but no specific numerical values are provided.\n- There are no additional annotations or reference lines on this idealized graph.\nimage_name:(c)\ndescription:The graph labeled (c) shows a Voltage Transfer Characteristic (VTC) for a real-world voltage comparator. This graph plots the horizontal axis as the voltage difference \\( v_P - v_N \\), and the vertical axis as the output voltage \\( v_O \\), both likely in volts.\n\n1. **Graph Type and Function:**\n- This is a VTC graph, depicting the output voltage behavior of a voltage comparator based on the input voltage difference.\n\n2. **Axes Labels and Units:**\n- **Horizontal Axis:** \\( v_P - v_N \\), likely in volts.\n- **Vertical Axis:** \\( v_O \\), likely in volts.\n\n3. **General Behavior and Trends:**\n- The graph displays a transition region between two constant voltage levels.\n- For \\( v_P - v_N < V_{IL} \\), the output voltage \\( v_O \\) remains at a low level \\( V_{OL} \\).\n- For \\( v_P - v_N > V_{IH} \\), the output voltage \\( v_O \\) reaches a high level \\( V_{OH} \\).\n- Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage increases linearly, indicating a gain region.\n\n4. **Key Features and Technical Aspects:**\n- **Low Output Voltage Level (\\( V_{OL} \\))**: The output voltage is constant at this level for \\( v_P - v_N < V_{IL} \\).\n- **High Output Voltage Level (\\( V_{OH} \\))**: The output voltage is constant at this level for \\( v_P - v_N > V_{IH} \\).\n- **Linear Region**: Between \\( V_{IL} \\) and \\( V_{IH} \\), the output voltage \\( v_O \\) increases linearly, representing the comparator's gain.\n\n5. **Annotations and Specific Data Points:**\n- The graph annotates the points \\( V_{IL} \\) and \\( V_{IH} \\), marking the start and end of the linear gain region.\n- These points indicate the threshold voltages for the output transition between \\( V_{OL} \\) and \\( V_{OH} \\).\n\nFIGURE 5.20 (a) Circuit symbol for the voltage comparator. (b) Idealized VTC, and (c) real-life VTC.\n\nIt is evident that the real-life VTC in Fig. 5.20c is merely an approximation of the ideal VTC in Fig. 5.20b. However, the closer $V_{I L}$ and $V_{I H}$ are to each other, the greater the gain and the closer the VTC approaches the ideal.\n\nAs a high-gain amplifier, the voltage comparator shares many similarities with the op amp (indeed, they use the same circuit symbol). However, they differ in two key aspects:\n\n- Op amps are designed to operate with negative feedback, whereas comparators are not. In Chapter 7, we will learn that to prevent potential oscillation, an op amp includes a frequency-compensation network, which, in its simplest form, is just a capacitance, such as $C_{c}$ in Figs. 5.1, 5.13, and 5.16. In Chapter 6, we will see that $C_{c}$ significantly slows down the op amp's dynamics. Comparators, conversely, do not require frequency compensation since voltage comparison does not involve negative feedback (in fact, a compensation capacitance would only unnecessarily slow down the comparator). Free from compensation constraints, comparators operate at maximum speed (the dynamics of voltage comparators are explored in Chapter 6).\n- The output saturation voltages of op amps are not compatible with digital logic levels (for example, a 741 op amp powered by $\\pm 15-\\mathrm{V}$ supplies saturates at around $\\pm 13 \\mathrm{~V}$, which is far from TTL/CMOS logic levels). In contrast, voltage-comparator output stages are designed to be compatible with such logic levels.\n\nIf speed and logic compatibility are not critical, an op amp can be used as a voltage comparator. However, most comparator applications require specialized circuits optimized for this specific function. To understand this better, let us examine some typical bipolar and CMOS voltage-comparator implementations."
},
{
    "text": "This widely-used bipolar comparator, available in a quad configuration from most analog IC manufacturers, is illustrated in its simplified form in Fig. 5.21. We identify the following components:\n\n- The initial or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$ to achieve very low input bias currents (25 nA as per the data sheets). Additionally, due to the extra $V_{E B}$ drop introduced by each buffer, the IVR extends down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The diodes serve to protect against excessive reverse bias and facilitate faster turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, we easily determine the (loaded) gain of this stage as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator. It features multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its role is to provide additional voltage gain, which we estimate as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage comprises the so-called open collector CE transistor $Q_{8}$. The reason for leaving the collector uncommitted is to allow the user to configure it externally for the desired output logic levels. The simplest configuration involves using a pull-up resistor $R_{P U}$, in which case the circuit yields $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit provides TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, which is shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair, and by $Q_{11}$ to actively load $Q_{7}$. Additionally, $Q_{12}$ forms a Widlar current source that generates a $7-\\mu \\mathrm{A}$ current, which then divides between the two collectors to supply the $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram represents the DC biasing circuitry of the 339 voltage comparator. It includes a stabilized current reference IREF of 100 A. Transistor Q12 forms a Widlar current source that provides 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we have $I_{C 8}=(5-2.6) / 2.4=1 \\text{ mA}$. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) / \\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=$ $(5-0.2) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong(5-0.25) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also observe that the simulated VTC is shifted to the right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due primarily to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{\\text {os }}$. You can easily find LM339 data sheets online, which list the following typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ strongly depends on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It illustrates the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, showing the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- Both axes use a linear scale.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a sharp transition in the output voltage as the input voltage difference crosses a specific threshold.\n- For input voltage differences below approximately 20 V, the output voltage remains low, near 0 V.\n- As the input voltage difference increases beyond approximately 20 V, the output voltage quickly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, typical of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature.\n- The graph effectively demonstrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator."
},
{
    "text": "This widely-used bipolar comparator, available in a quad configuration from most analog IC manufacturers, is illustrated in a simplified form in Fig. 5.21. We identify the following components:\n\n- The first or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$, achieving very low input bias currents (25 nA as per the data sheets). Additionally, the extra $V_{E B}$ drop introduced by each buffer extends the IVR down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The diodes protect against excessive reverse bias and facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, the (loaded) gain of this stage is determined as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator, featuring multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage includes the CE amplifier $Q_{7}$. Its role is to provide additional voltage gain, estimated as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage consists of the open collector CE transistor $Q_{8}$. The collector is left uncommitted to allow external configuration for desired output logic levels. The simplest setup involves a pull-up resistor $R_{P U}$, resulting in $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit produces TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair, and by $Q_{11}$ to actively load $Q_{7}$. Additionally, $Q_{12}$ forms a Widlar current source, generating a $7-\\mu \\mathrm{A}$ current that divides between the two collectors to provide the $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram shows the DC biasing circuitry of the 339 voltage comparator, featuring a stabilized current reference IREF of 100 A. Transistor Q12 creates a Widlar current source that supplies 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we have $I_{C 8}=(5-2.6) / 2.4=1$ mA. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) /$ $\\left.\\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=$ $(5-0.2) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong(5-0.25) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also note that the simulated VTC shifts right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due to mismatches in the input stage halves, an actual 339 may exhibit a higher $V_{\\text {os }}$. The LM339 data sheets, available online, list typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ depends on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit uses an LM339 op-amp with a pull-up resistor RPU to VCC, comparing input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It shows the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, illustrating the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- Both axes use a linear scale.\n\n3. **Overall Behavior and Trends:**\n- The graph shows a sharp transition in the output voltage as the input voltage difference crosses a certain threshold.\n- For input voltage differences below approximately 20 V, the output voltage remains low, near 0 V.\n- As the input voltage difference exceeds approximately 20 V, the output voltage rapidly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, typical of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature.\n- The graph effectively illustrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator."
},
{
    "text": "This widely-used bipolar comparator, available in a quad configuration from most analog IC manufacturers, is illustrated in its simplified form in Fig. 5.21. We can identify the following sections:\n\n- The initial or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$ to achieve very low input bias currents (25 nA as per the data sheets). Additionally, due to the extra $V_{E B}$ drop introduced by each buffer, the IVR extends down to ground potential. (In fact, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The role of the diodes is to protect against excessive reverse bias and to facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, we easily determine the (loaded) gain of this stage as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator. It features multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its purpose is to provide additional voltage gain, which we estimate as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage comprises the so-called open collector CE transistor $Q_{8}$. The reason for leaving the collector uncommitted is to allow the user to configure it externally for the desired output logic levels. The simplest configuration involves using a pull-up resistor $R_{P U}$, in which case the circuit yields $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit provides TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, which is shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair, and by $Q_{11}$ to actively load $Q_{7}$. Furthermore, $Q_{12}$ forms a Widlar current source that generates a $7-\\mu \\mathrm{A}$ current, which then divides between the two collectors to provide the $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram represents the DC biasing circuitry of the 339 voltage comparator. It includes a stabilized current reference IREF of 100 A. Transistor Q12 forms a Widlar current source that provides 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we have $I_{C 8}=(5-2.6) / 2.4=1 \\text{ mA}$. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=\\left[3.5 \\mu \\mathrm{~A}+\\left(50 \\mu \\mathrm{~A}\\right) /\\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=\\left(5-0.2\\right) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong\\left(5-0.25\\right) /\\left[(52-23) \\times 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also observe that the simulated VTC is shifted to the right by about $37 \\mu \\mathrm{~V}$. This represents the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Primarily due to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{O S}$. You can easily find the LM339 data sheets online, which list the following typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ strongly depends on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It shows the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, illustrating the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- The graph uses a linear scale for both axes.\n\n3. **Overall Behavior and Trends:**\n- The graph shows a sharp transition in the output voltage as the input voltage difference crosses a certain threshold.\n- For input voltage differences less than approximately 20 V, the output voltage remains low, close to 0 V.\n- As the input voltage difference increases beyond approximately 20 V, the output voltage rapidly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, characteristic of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature of this graph.\n- The graph effectively illustrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator."
},
{
    "text": "This widely-used bipolar comparator, available in a quad configuration from most analog IC manufacturers, is illustrated in its simplified form in Fig. 5.21. The following components are identified:\n\n- The initial or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by voltage followers $Q_{1}$ and $Q_{4}$, resulting in very low input bias currents (25 nA as per the data sheets). Additionally, the extra $V_{E B}$ drop introduced by each buffer extends the IVR down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The diodes serve to protect against excessive reverse bias and facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, the (loaded) gain of this stage is determined as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator, featuring multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its role is to provide additional voltage gain, estimated as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage features the open collector CE transistor $Q_{8}$. The collector is left uncommitted to allow external configuration for desired output logic levels. The simplest configuration involves a pull-up resistor $R_{P U}$, resulting in $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit produces TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, which is shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair, and by $Q_{11}$ to actively load $Q_{7}$. Additionally, $Q_{12}$ forms a Widlar current source, generating a $7-\\mu \\mathrm{A}$ current that splits between the two collectors to provide $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram shows the DC biasing circuitry of the 339 voltage comparator, featuring a stabilized current reference IREF of 100 A. Transistor Q12 creates a Widlar current source that supplies 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Given $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the gain of the 339 comparator for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on the results.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we find $I_{C 8}=(5-2.6) / 2.4=1 \\text{ mA}$. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) /$ $\\left.\\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=$ $(5-0.2) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong(5-0.25) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also note that the simulated VTC is shifted right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due mainly to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{\\text {os }}$. You can easily find the LM339 data sheets online, which list the following typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ depends strongly on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It illustrates the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, showing the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- Both axes use a linear scale.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a sharp transition in the output voltage as the input voltage difference crosses a specific threshold.\n- For input voltage differences below approximately 20 V, the output voltage remains low, near 0 V.\n- As the input voltage difference exceeds approximately 20 V, the output voltage quickly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, typical of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature.\n- The graph effectively demonstrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator."
},
{
    "text": "This widely-used bipolar comparator, offered in a quad configuration by numerous analog IC manufacturers, is illustrated in its simplified form in Fig. 5.21. The following components are identified:\n\n- The initial or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$, resulting in very low input bias currents (25 nA as per the data sheets). Additionally, the extra $V_{E B}$ drop introduced by each buffer extends the IVR down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunctioning.) The diodes' role is to protect against excessive reverse bias and facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Utilizing half-circuit analysis, the (loaded) gain of this stage is determined as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator, featuring multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its purpose is to provide additional voltage gain, estimated as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage features the open collector CE transistor $Q_{8}$. The collector is left uncommitted to allow external configuration for desired output logic levels. The simplest configuration involves a pull-up resistor $R_{P U}$, resulting in $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit produces TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, which is shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair and by $Q_{11}$ to actively load $Q_{7}$. Additionally, $Q_{12}$ forms a Widlar current source, generating a $7-\\mu \\mathrm{A}$ current that splits between the two collectors to provide $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram represents the DC biasing circuitry of the 339 voltage comparator, including a stabilized current reference IREF of 100 A. Transistor Q12 forms a Widlar current source that provides 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we have $I_{C 8}=(5-2.6) / 2.4=$ 1 mA. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) /$ $\\left.\\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=$ $(5-0.2) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong(5-0.25) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also observe that the simulated VTC is shifted to the right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{\\text {os }}$. The LM339 data sheets, available online, list typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ depends significantly on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It illustrates the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This VTC graph shows the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- Both axes use a linear scale.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a sharp transition in the output voltage as the input voltage difference crosses a specific threshold.\n- For input voltage differences below approximately 20 V, the output voltage remains low, near 0 V.\n- As the input voltage difference exceeds approximately 20 V, the output voltage rapidly increases to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, typical of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature.\n- The graph effectively demonstrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator."
},
{
    "text": "This widely-used bipolar comparator, available in a quad configuration from most analog IC manufacturers, is illustrated in a simplified form in Fig. 5.21. The identified blocks are as follows:\n\n- The first or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-}$ $Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$ to achieve very low input bias currents (25 nA as per the data sheets). Additionally, due to the extra $V_{E B}$ drop introduced by each buffer, the IVR extends down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The diodes' role is to protect against excessive reverse bias and facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, the (loaded) gain of this stage is found as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator, featuring multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its purpose is to provide additional voltage gain, estimated as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage comprises the open collector CE transistor $Q_{8}$. The collector is left uncommitted to allow external configuration for desired output logic levels. The simplest configuration involves a pull-up resistor $R_{P U}$, resulting in $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit produces TTL/CMOS logic levels of approximately 0 V and 5 V. The stage's gain is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$ and the stabilized current reference $I_{R E F}$, shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair and by $Q_{11}$ to actively load $Q_{7}$. Additionally, $Q_{12}$ forms a Widlar current source, generating a $7-\\mu \\mathrm{A}$ current that splits between two collectors to provide $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram represents the DC biasing circuitry of the 339 voltage comparator, featuring a stabilized current reference IREF of 100 A. Transistor Q12 forms a Widlar current source that supplies 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we get $I_{C 8}=(5-2.6) / 2.4=$ 1 mA. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) /$ $\\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=$ $(5-0.2) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong(5-0.25) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also note that the simulated VTC is shifted right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due mainly to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{\\text {os }}$. You can easily find LM339 data sheets online, which list typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ depends strongly on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It shows the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, illustrating the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- The graph uses a linear scale for both axes.\n\n3. **Overall Behavior and Trends:**\n- The graph shows a sharp transition in the output voltage as the input voltage difference crosses a certain threshold.\n- For input voltage differences less than approximately 20 V, the output voltage remains low, close to 0 V.\n- As the input voltage difference increases beyond approximately 20 V, the output voltage rapidly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, characteristic of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature of this graph.\n- The graph effectively illustrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator."
},
{
    "text": "This widely-used bipolar comparator, offered in a quad configuration by most analog IC manufacturers, is illustrated in its simplified form in Fig. 5.21. The following components are identified:\n\n- The initial or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$, resulting in very low input bias currents (25 nA as per the data sheets). Additionally, the extra $V_{E B}$ drop introduced by each buffer extends the IVR down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The diodes serve to protect against excessive reverse bias and facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, the (loaded) gain of this stage is determined as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator, featuring multiple stages with transistors and diodes for amplification and protection, along with current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its role is to provide additional voltage gain, estimated as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage includes the open collector CE transistor $Q_{8}$. The collector is left uncommitted to allow external configuration for desired output logic levels. The simplest setup involves a pull-up resistor $R_{P U}$, resulting in $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit achieves TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, comprises the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, which is shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair, and by $Q_{11}$ to actively load $Q_{7}$. Furthermore, $Q_{12}$ forms a Widlar current source, generating a $7-\\mu \\mathrm{A}$ current that divides between the two collectors to provide the $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram represents the DC biasing circuitry of the 339 voltage comparator, including a stabilized current reference IREF of 100 A. Transistor Q12 forms a Widlar current source that provides 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we have $I_{C 8}=(5-2.6) / 2.4=1$ mA. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) /$ $\\left.\\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=$ $(5-0.2) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong(5-0.25) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also observe that the simulated VTC is shifted to the right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{\\text {os }}$. You can easily find LM339 data sheets online, which list typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ depends strongly on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It illustrates the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, showing the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- Both axes use a linear scale.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a sharp transition in the output voltage as the input voltage difference crosses a specific threshold.\n- For input voltage differences below approximately 20 V, the output voltage remains low, near 0 V.\n- As the input voltage difference exceeds approximately 20 V, the output voltage quickly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, typical of a comparator's switching behavior.\n- The threshold point, where the output starts to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature.\n- The graph effectively demonstrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator.\n```"
},
{
    "text": "This widely-used bipolar comparator, offered in a quad configuration by most analog IC manufacturers, is illustrated in its simplified form in Fig. 5.21. We can identify the following sections:\n\n- The initial or input stage comprises the EC pair $Q_{2}{ }^{-} Q_{3}$ and the active load $Q_{5}{ }^{-} Q_{6}$. $Q_{2}$ and $Q_{3}$ are buffered by the voltage followers $Q_{1}$ and $Q_{4}$ to achieve very low input bias currents (25 nA as per the data sheets). Additionally, due to the extra $V_{E B}$ drop introduced by each buffer, the IVR extends down to ground potential. (Indeed, $v_{P}$ and $v_{N}$ can be driven a few tenths of a volt below ground without malfunction.) The diodes' role is to protect against excessive reverse bias and to facilitate quicker turn-off for $Q_{2}$ and $Q_{3}$. Using half-circuit analysis, we easily determine the (loaded) gain of this stage as\n\n$$\n\\begin{equation*}\na_{1}=\\frac{v_{b 7}}{v_{p}-v_{n}}=\\frac{r_{\\pi 2}}{r_{e 1}+r_{\\pi 2}} g_{m 3}\\left(r_{o 3} / / r_{o 6} / / r_{\\pi 7}\\right) \\cong g_{m 3} r_{\\pi 7} \\tag{5.46}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\ndescription:The circuit is a simplified schematic of the LM339 voltage comparator. It includes multiple stages with transistors and diodes for amplification and protection, and current sources for biasing.\n\nFIGURE 5.21 Simplified circuit schematic of the LM339 voltage comparator.\n\n- The second or intermediate stage consists of the CE amplifier $Q_{7}$. Its purpose is to provide additional voltage gain, which we estimate as\n\n$$\n\\begin{equation*}\na_{2}=-\\frac{v_{b 8}}{v_{b 7}} \\cong-g_{m 7} r_{\\pi 8} \\tag{5.47}\n\\end{equation*}\n$$\n\n- The third or output stage comprises the so-called open collector CE transistor $Q_{8}$. The reason for leaving the collector uncommitted is to allow external configuration for the desired output logic levels. The simplest approach is to use a pull-up resistor $R_{P U}$, in which case the circuit yields $V_{O L}=V_{C E 8(\\text { sat) }} \\cong 0.2 \\mathrm{~V}$ when $Q_{8}$ is in saturation, and $V_{O H}=V_{C C}$ when $Q_{8}$ is in cutoff. With $V_{C C}=5 \\mathrm{~V}$, the circuit provides TTL/CMOS logic levels of approximately 0 V and 5 V. The gain of this stage is estimated as\n\n$$\n\\begin{equation*}\na_{3}=-\\frac{v_{o}}{v_{b 8}} \\cong-g_{m 8} R_{P U} \\tag{5.48}\n\\end{equation*}\n$$\n\n- The dc biasing circuit, depicted in Fig. 5.22, includes the multiple-output current mirror $Q_{9}$ through $Q_{12}$, along with the stabilized current reference $I_{R E F}$, which is shared among all four comparators on the chip. The current $I_{R E F}$ is replicated by $Q_{10}$ to bias the $Q_{2}-Q_{3}$ pair, and by $Q_{11}$ to actively load $Q_{7}$. Additionally, $Q_{12}$ forms a Widlar current source that generates a $7-\\mu \\mathrm{A}$ current, which then divides between the two collectors to supply the $3.5-\\mu \\mathrm{A}$ bias currents for the $Q_{1}$ and $Q_{4}$ buffers.\nimage_name:FIGURE 5.22\ndescription:\n[\nname: Q9, type: PNP, ports: {C: X1, B: X1, E: VCC}\nname: Q10, type: PNP, ports: {C: LOAD1, B: X1, E: X1}\nname: Q11, type: PNP, ports: {C: LOAD2, B: X1, E: VCC}\nname: Q12, type: PNP, ports: {C: LOAD3, B: X1, E: X2}\nname: IREF, type: CurrentSource, value: 100 A, ports: {Np: X1, Nn: GND}\nname: R, type: Resistor, value: 9.9 k, ports: {N1: VCC, N2: X2}\n]\nextrainfo:The circuit diagram represents the DC biasing circuitry of the 339 voltage comparator. It includes a stabilized current reference IREF of 100 A. Transistor Q12 forms a Widlar current source that provides 3.5 A bias currents for the Q1 and Q4 buffers.\n\nFIGURE 5.22 The dc biasing circuitry of the 339 voltage comparator.\n\nEXAMPLE 5.5 (a) Assuming $\\beta_{p}=150, \\beta_{n}=200, V_{C C}=5 \\mathrm{~V}$, and $R_{P U}=2.4 \\mathrm{k} \\Omega$, estimate the 339 comparator's gain for $v_{O}$ halfway between $V_{O H}$ and $V_{O L}$.\n(b) Estimate the input bias current and the difference $V_{I H}-V_{I L}$.\n(c) Verify with PSpice and comment on your findings.\n\n#### Solution\n\n(a) For $v_{O}=1 / 2\\left(V_{O H}+V_{O L}\\right)=1 / 2(5+0.2)=2.6 \\mathrm{~V}$, we have $I_{C 8}=(5-2.6) / 2.4=1 \\text{ mA}$. Using Eqs. (5.46) through (5.48),\n\n$$\n\\begin{aligned}\n& a_{1} \\cong \\frac{0.05}{26} \\beta_{7} \\frac{26}{0.1}=\\frac{\\beta_{7}}{2}=100 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{2} \\cong-\\frac{0.1}{26} \\beta_{8} \\frac{26}{1}=-\\frac{\\beta_{8}}{10}=-20 \\mathrm{~V} / \\mathrm{V} \\\\\n& a_{3} \\cong-\\frac{R_{P U}}{26 \\Omega}=-92.3 \\mathrm{~V} / \\mathrm{V}\n\\end{aligned}\n$$\n\nThe overall gain is $a=a_{1} \\times a_{2} \\times a_{3}=100 \\times 20 \\times 92.3 \\cong 185 \\mathrm{~V} / \\mathrm{mV}$.\n(b) $I_{B}=I_{B 1}=I_{E 1} /\\left(\\beta_{1}+1\\right)=\\left(3.5 \\mu \\mathrm{~A}+I_{B 2}\\right) /\\left(\\beta_{1}+1\\right)=[3.5 \\mu \\mathrm{~A}+(50 \\mu \\mathrm{~A}) / \\left(\\beta_{2}+1\\right)\\right] /\\left(\\beta_{1}+1\\right)=25.4 \\mathrm{nA}$. By Eq. (5.44), $V_{I H}-V_{I L}=\\left(V_{O H}-V_{O L}\\right) / a=\\left(5-0.2\\right) /\\left(185 \\times 10^{3}\\right) \\cong 26 \\mu \\mathrm{~V}$.\n(c) The circuit in Fig. 5.23a uses a 339 macro-model to display the VTC (see Appendix 5A).\nFrom Fig. $5.23 b$ we find $V_{I L} \\cong 23 \\mu \\mathrm{~V}, V_{I H} \\cong 52 \\mu \\mathrm{~V}, V_{O L} \\cong 0.25 \\mathrm{~V}$, and $V_{O H}=5 \\mathrm{~V}$. By Eq. (5.44), the gain is $a \\cong\\left(5-0.25\\right) /\\left[(52-23) 10^{-6}\\right] \\cong 183 \\mathrm{~V} / \\mathrm{mV}$. We also note that the simulated VTC is shifted right by about $37 \\mu \\mathrm{~V}$, representing the input offset voltage $V_{O S}$ of the 339 macro-model for the given $R_{P U}$. Due mainly to mismatches between the two halves of its input stage, an actual 339 is likely to exhibit a higher $V_{\\text {os }}$. You can easily find the LM339 data sheets online, which list the following typical values at room temperature: $a=200 \\mathrm{~V} / \\mathrm{mV}, V_{O S}=2 \\mathrm{mV}, I_{B}=25 \\mathrm{nA}$, and $I_{O S}=5 \\mathrm{nA}$. The calculations indicate that $I_{B}$ strongly depends on $\\beta_{p}$, $a_{1}$ on $\\beta_{n}$, and $a_{2}$ on $R_{P U}$.\nimage_name:(a)\ndescription:\n[\nname: Vi, type: VoltageSource, value: Vi, ports: {Np: Vi, Nn: GND}\nname: RPU, type: Resistor, value: 2.4k, ports: {N1: VCC, N2: Vo}\nname: LM339, type: OpAmp, value: LM339, ports: {InP: Vi, InN: GND, OutP: Vo}\n]\nextrainfo:The circuit is a voltage comparator using an LM339 op-amp with a pull-up resistor RPU to VCC, comparing the input voltage Vi to ground.\n\n(a)\nimage_name:(b)\ndescription:The graph is a Voltage Transfer Characteristic (VTC) curve for a voltage comparator using an LM339 op-amp. It shows the relationship between the input voltage difference \\( v_P - v_N \\) and the output voltage \\( v_O \\).\n\n1. **Type of Graph and Function:**\n- This is a VTC graph, illustrating the output response of a voltage comparator.\n\n2. **Axes Labels and Units:**\n- The x-axis represents the input voltage difference \\( v_P - v_N \\) in microvolts (V), ranging from -60 V to 60 V.\n- The y-axis represents the output voltage \\( v_O \\) in volts (V), ranging from 0 V to 5 V.\n- The graph uses a linear scale for both axes.\n\n3. **Overall Behavior and Trends:**\n- The graph shows a sharp transition in the output voltage as the input voltage difference crosses a certain threshold.\n- For input voltage differences less than approximately 20 V, the output voltage remains low, close to 0 V.\n- As the input voltage difference increases beyond approximately 20 V, the output voltage rapidly rises to 5 V, indicating a switch from low to high output.\n\n4. **Key Features and Technical Details:**\n- The transition region is very steep, characteristic of a comparator's switching behavior.\n- The threshold point, where the output begins to switch from low to high, is around 20 V.\n- The output voltage reaches its maximum value of 5 V, indicating a rail-to-rail output swing.\n\n5. **Annotations and Specific Data Points:**\n- Significant markers or reference lines are not explicitly shown, but the steep transition is a critical feature of this graph.\n- The graph effectively illustrates the comparator's function of switching output states based on input voltage levels.\n\nFIGURE 5.23 (a) PSpice circuit to display (b) the VTC of the 339 voltage comparator.\n```"
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, but it omits the compensation network $R_{c}-C_{c}$, which is not required for voltage comparison. Additionally, the circuit includes an output inverter to enhance the gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If needed, the channel widths $W_{9}$ and $W_{10}$ can be appropriately increased to enhance the output current-drive capabilities.\n\nimage_name: FIGURE 5.24 CMOS voltage comparator\ndescription:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nextrainfo: This CMOS voltage comparator circuit features an output inverter to amplify gain and deliver rail-to-rail output swing. It employs a complementary setup with both PMOS and NMOS transistors. The design prioritizes high gain and speed, but excludes a compensation network since it is superfluous for voltage comparison.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, but it omits the compensation network $R_{c}-C_{c}$, which is not required for voltage comparison. Additionally, the circuit includes an output inverter to enhance the gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If needed, the channel widths $W_{9}$ and $W_{10}$ can be increased appropriately to improve the output current-drive capabilities.\n\nImage Description:\n[\nName: M1, Type: NMOS, Ports: {S: P1, D: X1, G: vP}\nName: M2, Type: NMOS, Ports: {S: P1, D: X2, G: vN}\nName: M3, Type: PMOS, Ports: {S: VDD, D: X1, G: X1}\nName: M4, Type: PMOS, Ports: {S: VDD, D: X2, G: X1}\nName: M5, Type: PMOS, Ports: {S: VDD, D: X3, G: X2}\nName: M6, Type: NMOS, Ports: {S: VSS, D: X3, G: X4}\nName: M7, Type: NMOS, Ports: {S: VSS, D: X4, G: X4}\nName: M8, Type: NMOS, Ports: {S: X4, D: X4, G: IREF}\nName: M9, Type: PMOS, Ports: {S: VDD, D: VO, G: X3}\nName: M10, Type: NMOS, Ports: {S: VSS, D: VO, G: X3}\nName: IREF, Type: CurrentSource, Ports: {Np: VDD, Nn: X4}\n]\n\nExtra Info: This CMOS voltage comparator circuit features an output inverter to amplify gain and achieve rail-to-rail output swing. It employs a complementary configuration of PMOS and NMOS transistors. The design prioritizes high gain and speed, excluding a compensation network as it is superfluous for voltage comparison purposes.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, but it omits the compensation network $R_{c}-C_{c}$, which is not required for voltage comparison. Additionally, the circuit includes an output inverter to enhance the gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If needed, the channel widths $W_{9}$ and $W_{10}$ can be increased to improve the output current-drive capabilities.\n\nImage Description:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nAdditional Information: This CMOS voltage comparator circuit features an output inverter to enhance gain and achieve rail-to-rail output swing. It employs a complementary configuration with both PMOS and NMOS transistors. The design prioritizes high gain and speed, but excludes a compensation network as it is superfluous for voltage comparison purposes.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, but it omits the compensation network $R_{c}-C_{c}$, which is superfluous for voltage comparison purposes. Additionally, the circuit includes an output inverter to enhance the gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If required, the channel widths $W_{9}$ and $W_{10}$ can be appropriately increased to enhance the output current-driving capabilities.\n\nimage_name: FIGURE 5.24 CMOS voltage comparator\ndescription:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nextrainfo: This CMOS voltage comparator circuit incorporates an output inverter to amplify gain and achieve rail-to-rail output swing. It utilizes a complementary arrangement of PMOS and NMOS transistors. The design prioritizes high gain and speed, but excludes a compensation network as it is not needed for voltage comparison.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 serves as the complementary counterpart to the CMOS amplifier shown in Fig. 5.13, albeit without the $R_{c}-C_{c}$ compensation network, which is superfluous in voltage comparison scenarios. Additionally, the circuit incorporates an output inverter to enhance gain and facilitate a rail-to-rail output swing, meaning $V_{O L}$ equals $V_{S S}$ and $V_{O H}$ equals $V_{D D}$. Should it be required, the channel widths $W_{9}$ and $W_{10}$ can be adjusted to larger sizes to augment the output current-drive capabilities.\n\nimage_name: FIGURE 5.24 CMOS voltage comparator\ndescription:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nextrainfo: This CMOS voltage comparator circuit includes an output inverter to enhance gain and achieve rail-to-rail output swing. It employs a complementary configuration of PMOS and NMOS transistors. The design prioritizes high gain and speed, omitting a compensation network as it is not needed for voltage comparison.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, but it omits the compensation network $R_{c}-C_{c}$, which is not required for voltage comparison. Additionally, the circuit includes an output inverter to enhance the gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If needed, the channel widths $W_{9}$ and $W_{10}$ can be appropriately increased to enhance the output current-drive capabilities.\n\nimage_name: FIGURE 5.24 CMOS voltage comparator\ndescription:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nextrainfo: This CMOS voltage comparator circuit features an output inverter to increase gain and achieve rail-to-rail output swing. It employs a complementary arrangement of PMOS and NMOS transistors. The design prioritizes high gain and speed, excluding a compensation network as it is superfluous for voltage comparison.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, but it omits the compensation network $R_{c}-C_{c}$, which is not required for voltage comparison. Additionally, the circuit includes an output inverter to enhance the gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If needed, the channel widths $W_{9}$ and $W_{10}$ can be appropriately increased to enhance the output current-drive capabilities.\n\nimage_name: FIGURE 5.24 CMOS voltage comparator\ndescription:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nextrainfo: This CMOS voltage comparator circuit incorporates an output inverter to amplify gain and achieve rail-to-rail output swing. It employs a complementary arrangement of PMOS and NMOS transistors. The design prioritizes high gain and speed, but excludes a compensation network as it is superfluous for voltage comparison.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "The circuit depicted in Fig. 5.24 is the complementary counterpart of the CMOS amplifier shown in Fig. 5.13, albeit without the $R_{c}-C_{c}$ compensation network, which is superfluous for voltage comparison purposes. Additionally, the circuit incorporates an output inverter to enhance gain and ensure a rail-to-rail output swing, meaning $V_{O L}=V_{S S}$ and $V_{O H}=V_{D D}$. If required, the channel widths $W_{9}$ and $W_{10}$ can be appropriately increased to augment the output current-drive capacity.\n\nimage_name: FIGURE 5.24 CMOS voltage comparator\ndescription:\n[\nname: M1, type: NMOS, ports: {S: P1, D: X1, G: vP}\nname: M2, type: NMOS, ports: {S: P1, D: X2, G: vN}\nname: M3, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X1}\nname: M5, type: PMOS, ports: {S: VDD, D: X3, G: X2}\nname: M6, type: NMOS, ports: {S: VSS, D: X3, G: X4}\nname: M7, type: NMOS, ports: {S: VSS, D: X4, G: X4}\nname: M8, type: NMOS, ports: {S: X4, D: X4, G: IREF}\nname: M9, type: PMOS, ports: {S: VDD, D: VO, G: X3}\nname: M10, type: NMOS, ports: {S: VSS, D: VO, G: X3}\nname: IREF, type: CurrentSource, ports: {Np: VDD, Nn: X4}\n]\nextrainfo: This CMOS voltage comparator circuit features an output inverter to enhance gain and achieve rail-to-rail output swing. It employs a complementary configuration of PMOS and NMOS transistors. The design prioritizes high gain and speed, omitting a compensation network as it is not needed for voltage comparison.\n\nFIGURE 5.24 CMOS voltage comparator."
},
{
    "text": "In voltage comparator circuits, while high gain and speed are typically sought-after, they can lead to issues when dealing with noisy inputs. For instance, in the circuit depicted in Fig. 5.25a, a comparator is used to count the zero crossings of a slowly-varying signal \\( v_I \\) that is corrupted by noise. This noise can cause the comparator to fluctuate erratically around 0 V, resulting in inaccurate counts. Although the noise level may seem exaggerated in the figure, it's important to note that with high gain, even a small noise of a few tens of micro-volts can cause significant fluctuations.\n\nThis undesirable fluctuation, known as chatter, can be mitigated by incorporating hysteresis as shown in Fig. 5.25b. The comparator in this case has two different voltage threshold curves (VTCs) depending on the output state. When \\( v_O = V_{OL} \\), the comparator switches when \\( v_I \\) reaches \\( V_{TH} \\), and when \\( v_O = V_{OH} \\), it switches when \\( v_I \\) drops to \\( V_{TL} \\). If the hysteresis width \\( V_{TH} - V_{TL} \\) is greater than the maximum peak-to-peak amplitude of the noise, chatter is effectively eliminated, as demonstrated in Fig. 5.25b. Hysteresis can be introduced through positive feedback, either externally by the user or internally by the IC designer, with the latter being our focus here.\n\nFigure 5.26 presents a common CMOS implementation of a comparator with hysteresis. Disregarding \\( M_5 \\) and \\( M_6 \\) momentarily, we can see that the \\( M_4-M_7 \\) mirror directs \\( i_{D2} \\) towards the output node \\( v_0 \\), while the \\( M_3-M_8 \\) and \\( M_9-M_10 \\) mirrors guide \\( i_{D1} \\) away from \\( v_0 \\). As a result, the circuit acts as a differential amplifier with a small-signal gain of \\( a = v_0 / (v_p - v_n) = g_{m1} (r_{o7} // r_{o10}) \\) and a VTC similar to that in Fig. 5.20c (also see Fig. 4.66).\n\nThe presence of \\( M_5 \\) and \\( M_6 \\) introduces a flip-flop action that unbalances the loads seen by \\( M_1 \\) and \\( M_2 \\), creating hysteresis. This effect is due to the cross-coupled PMOS transistors \\( M_5 \\) and \\( M_6 \\), which provide the hysteresis mechanism. The circuit operates between power supplies VDD and VSS, with input nodes \\( v_N \\) and \\( v_P \\), and an output node \\( v_O \\).\n\nWhen considering the effect of \\( M_5 \\) and \\( M_6 \\), they act as two cross-coupled inverters that maintain the circuit in an unbalanced state. This is precisely what causes hysteresis. To understand this, refer to the simplified representations in Fig. 5.27, where the cross-coupled FETs \\( M_5 \\) and \\( M_6 \\) are assumed to have \\( W/L \\) ratios that are \\( m \\) (where \\( m > 1 \\)) times larger than those of the diode-connected FETs \\( M_3 \\) and \\( M_4 \\). The following observations can be made:\n\n- For \\( v_I \\) sufficiently negative, as in Fig. 5.27a, \\( M_1 \\) is off, so \\( M_3 \\) and \\( M_5 \\) are also off. All of \\( I_{SS} \\) flows through \\( M_2 \\), causing \\( v_{O2} \\) to be low. This, in turn, pulls \\( v_{O1} \\) to \\( V_{DD} \\). With \\( v_{SG6} = 0 \\), \\( M_6 \\) is also off, resulting in \\( i_{D4} = i_{D2} = I_{SS} \\).\n- Raising \\( v_I \\) will gradually turn on \\( M_1 \\) while \\( M_2 \\) becomes less conductive. Since \\( M_1 \\) sees the (small) ohmic resistance of \\( M_5 \\) as a load, \\( v_{O1} \\) will drop some.\n- For \\( v_I = 0 \\), \\( I_{SS} \\) splits equally between \\( M_1 \\) and \\( M_2 \\). However, since \\( k_5 = m k_4 \\) and \\( m > 1 \\), it follows that \\( v_{O1} \\) is higher than \\( v_{O2} \\). In other words, the circuit is unbalanced because \\( M_5 \\) is still in the triode region whereas \\( M_4 \\) is saturated.\n- To make the circuit trip, we need to raise \\( v_I \\) to the value \\( V_{IH} \\) (where \\( V_{IH} > 0 \\)) that will pull \\( M_5 \\) out of the triode region and into saturation. This value is found via KVL and the familiar FET formula as:\n\n\\[\nV_{IH} = V_{GS1} - V_{GS2} = V_{OV1} - V_{OV2} \\cong \\sqrt{2 I_{D1} / k_1} - \\sqrt{2 I_{D2} / k_2} = \\sqrt{2 / k_1} (\\sqrt{I_{D1}} - \\sqrt{I_{D2}})\n\\]\n\n(For simplicity, all FETs are assumed to have \\( \\lambda = 0 \\)). Substituting \\( I_{D1} = I_{D5} = m I_{D4} = m I_{D2} \\), along with \\( I_{D1} + I_{D2} = I_{SS} \\), we finally get, after suitable manipulation:\n\n\\[\nV_{IH} \\cong \\sqrt{\\frac{2 I_{SS}}{(m+1) k_1}} (\\sqrt{m} - 1) \\tag{5.49}\n\\]\n\n- For \\( v_I \\) sufficiently positive, as in Fig. 5.27b, the roles of the various FET pairs are interchanged, so we exploit the symmetry of the circuit to state that in order to make it trip in the opposite direction, we now need to lower \\( v_I \\) to the value \\( V_{IL} \\) (where \\( V_{IL} < 0 \\)) such that:\n\n\\[\nV_{IL} = -V_{IH} \\tag{5.50}\n\\]\n\nThe above text has been rephrased while maintaining the original meaning and length."
},
{
    "text": "While high gain and speed are typically sought after in voltage comparators, they can actually work against us when dealing with noisy inputs. Take, for instance, the circuit in Fig. $5.25 a$, which employs a comparator to count the zero crossings of a noisy, slowly-varying signal $v_{I}$. The noise can cause the comparator to toggle its output multiple times when $v_{I}$ is near 0 V, resulting in inaccurate counts. Although the depicted noise level might seem exaggerated, it's important to note that even minor noise, when amplified significantly, can cause such issues.\n\nThis phenomenon, known as chatter, can be mitigated by introducing hysteresis, as shown in Fig. $5.25b$. Here, the comparator demonstrates two distinct VTCs, depending on its output state. When $v_{O}$ equals $V_{O L}$, the comparator switches when $v_{I}$ reaches $V_{T H}$, and conversely, when $v_{O}$ equals $V_{O H}$, it switches at $V_{T L}$. If the hysteresis width, which is the difference between $V_{T H}$ and $V_{T L}$, is greater than the peak-to-peak amplitude of the input noise, chatter is effectively prevented, as demonstrated in Fig. $5.25b$. Hysteresis can be implemented through positive feedback, either externally by the user or internally by the IC designer, with our focus being on the latter.\n\nFigure $5.26$ presents a commonly used CMOS implementation of a comparator with hysteresis. Disregarding $M_{5}$ and $M_{6}$ for a moment, we see that the $M_{4}-M_{7}$ mirror directs $i_{D 2}$ towards the output node $v_{0}$, while the $M_{3}-M_{8}$ and $M_{9}-M_{10}$ mirrors divert $i_{D 1}$ away from $v_{0}$. This configuration results in a differential amplifier with a small-signal gain of $a=v_{o} /\\left(v_{p}-v_{n}\\right)=g_{m 1}\\left(r_{o 7} / / r_{o 10}\\right)$ and a VTC similar to that of Fig. $5.20c$ (refer also to Fig. $4.66$).\n\nIn the context of the provided images, Fig. $5.25 a$ illustrates a comparator without hysteresis, prone to chatter due to noise in the input signal. The circuit consists of a voltage source $V1$ providing $v_I$ and an inverter $U1$ that outputs $v_O$. The diagram highlights how the output switches rapidly as the input crosses the threshold, a behavior known as chatter.\n\nFigures $5.25 b$ and $5.26$ show the implementation of hysteresis in a CMOS comparator. The time-domain waveform graph in Fig. $5.25 b$ demonstrates how the output voltage $v_O$ responds to the noisy input voltage $v_I$ over time, with clear hysteresis behavior. The vertical axis represents voltage levels $V_{OH}$ and $V_{OL}$, and the horizontal axis represents time, typically in seconds or milliseconds.\n\nIn Fig. $5.26$, the CMOS comparator circuit incorporates hysteresis through the cross-coupled PMOS transistors $M_{5}$ and $M_{6}$, creating a flip-flop action that stabilizes the output against noise. The circuit operates between power supplies $VDD$ and $VSS$, with input nodes $vN$ and $vP$, and an output node $vO$.\n\nFurther analysis of the circuit behavior with $M_{5}$ and $M_{6}$ present reveals the role of these transistors in introducing hysteresis. The circuit's behavior is unbalanced due to the differing characteristics of $M_{5}$ and $M_{4}$, leading to the hysteresis effect. The exact voltage levels $V_{I H}$ and $V_{I L}$ at which the comparator trips are determined by the circuit's parameters and the FET formulae.\n\nThe PSpice simulations in Fig. $5.28$ and the resulting plots in Fig. $5.29$ confirm the theoretical calculations and provide a detailed view of the hysteresis and snapping action in the comparator circuit.\n\nThe circuits in Fig. $5.30$ demonstrate power-supply-based current references, using both bipolar and MOS transistors. These circuits are designed to provide a stable reference current that is less dependent on the supply voltage.\n\nThe small-signal model in Fig. $5.33$ is used to analyze the power-supply dependence of a reference current, taking into account the transistor characteristics and the circuit's parameters.\n\nIn summary, the introduction of hysteresis in comparator circuits is crucial for reducing the impact of noise and ensuring stable output switching. The theoretical analysis, circuit implementations, and simulations all contribute to a comprehensive understanding of how hysteresis works and how it can be effectively utilized in comparator design."
},
{
    "text": "Voltage comparators typically aim for high gain and speed, but these traits can backfire when dealing with noisy inputs. For example, Fig. 5.25a demonstrates a comparator circuit designed to count the zero crossings of a slowly-varying signal, \\( v_I \\), corrupted by noise. The noise can trigger multiple transitions in the comparator output as \\( v_I \\) hovers around 0 V, leading to inaccurate counts. Although the depicted\nCertainly! Here's the rephrased text:\n\n---\n\nVoltage comparators typically aim for high gain and speed, but these traits can backfire when dealing with noisy inputs. For example, Fig. 5.25a demonstrates a comparator circuit designed to count the zero crossings of a slowly-varying signal, \\( v_I \\), corrupted by noise. The noise can trigger multiple transitions in the comparator output as \\( v_I \\) hovers around 0 V, leading to erroneous counts. Although the amount of noise in the figure may seem exaggerated, it's important to note that with very high gain, even a few tens of micro-volts of noise can span the range from \\( V_{IL} \\) to \\( V_{IH} \\) and vice versa. The figure's exaggeration helps visualize this effect.\n\nThis phenomenon, known as chatter, can be eliminated by incorporating hysteresis, as shown in Fig. 5.25b. The comparator in this figure has two voltage threshold curves (VTCs), depending on the output state: when \\( v_O = V_{OL} \\), the comparator trips when \\( v_I \\) rises to \\( V_{TH} \\), and when \\( v_O = V_{OH} \\), it trips when \\( v_I \\) falls to \\( V_{TL} \\). If the hysteresis width, defined as \\( V_{TH} - V_{TL} \\), exceeds the maximum peak-to-peak amplitude of the input noise, chatter is eliminated. Hysteresis can be introduced through positive feedback, either externally by the user or internally by the IC designer. In this case, we focus on the latter.\n\nFig. 5.26 depicts a popular CMOS implementation of the comparator-with-hysteresis concept. Ignoring \\( M_5 \\) and \\( M_6 \\) for now, we see that the \\( M_4-M_7 \\) mirror directs \\( i_{D2} \\) towards the output node \\( v_0 \\), while the \\( M_3-M_8 \\) and \\( M_9-M_10 \\) mirrors direct \\( i_{D1} \\) away from node \\( v_0 \\). As a result, the circuit acts as a differential amplifier with a small-signal gain of \\( a = v_o / (v_p - v_n) = g_{m1} (r_{o7} || r_{o10}) \\) and a VTC similar to that in Fig. 5.20c (also see Fig. 4.66).\n\n---\n\nThe rephrased text maintains the original meaning and length while adjusting the wording, sentence structure, and phrasing for clarity and flow."
},
{
    "text": "The presence of noise in voltage comparator circuits can undermine the effectiveness of high gain and speed, often leading to false counts due to the comparator's sensitivity around zero voltage. For instance, Figure 5.25a displays a comparator circuit that counts the zero crossings of a slowly-varying signal \\( v_I \\) corrupted by noise. The noise triggers multiple comparator transitions near 0 V, resulting in erroneous counts. Although the depicted noise level may appear exaggerated, it serves to highlight that even minor noise, amplified by high gain, can cause significant comparator output fluctuations.\n\nThis phenomenon, known as chatter, can be mitigated by introducing hysteresis, as shown in Figure 5.25b. Hysteresis involves the comparator having two different voltage threshold crossings (VTCs) depending on its output state. When the output is low (\\( v_O = V_{OL} \\)), the comparator switches to high when \\( v_I \\) rises to \\( V_{TH} \\). Conversely, when the output is high (\\( v_O = V_{OH} \\)), the comparator switches to low when \\( v_I \\) falls to \\( V_{TL} \\). If the hysteresis width (\\( V_{TH} - V_{TL} \\)) exceeds the peak-to-peak noise amplitude, chatter is effectively prevented.\n\nHysteresis can be implemented through positive feedback, either externally by the user or internally by the integrated circuit (IC) designer. The focus here is on the internal implementation by the IC designer.\n\nFigure 5.26 presents a widely-used CMOS implementation of a comparator with hysteresis. By ignoring transistors \\( M_5 \\) and \\( M_6 \\) momentarily, it can be seen that the \\( M_4 \\)-\\( M_7 \\) mirror directs current \\( i_{D2} \\) towards the output node \\( v_0 \\), while the \\( M_3 \\)-\\( M_8 \\) and \\( M_9 \\)-\\( M_{10} \\) mirrors guide \\( i_{D1} \\) away from \\( v_0 \\). As a result, the circuit functions as a differential amplifier with a small-signal gain \\( a = v_o / (v_p - v_n) = g_{m1}(r_{o7} // r_{o10}) \\) and exhibits a VTC similar to that of Figure 5.20c (also see Figure 4.66).\n\nWhen considering the impact of \\( M_5 \\) and \\( M_6 \\), these transistors introduce a flip-flop action through positive feedback, leading to an imbalance in the loads seen by \\( M_1 \\) and \\( M_2 \\). This imbalance is the source of hysteresis. To understand this, one can refer to the simplified diagrams in Figure 5.27, where \\( M_5 \\) and \\( M_6 \\) have \\( W/L \\) ratios that are \\( m \\) times larger than those of \\( M_3 \\) and \\( M_4 \\) (with \\( m > 1 \\)).\n\nFor a sufficiently negative \\( v_I \\) as in Figure 5.27a, \\( M_1 \\) is off, which also turns off \\( M_3 \\) and \\( M_5 \\). All of the current \\( I_{SS} \\) flows through \\( M_2 \\), pulling \\( v_{O2} \\) low. This, in turn, forces \\( M_5 \\) into the ohmic region, pulling \\( v_{O1} \\) towards \\( V_{DD} \\). With \\( v_{SG6} = 0 \\), \\( M_6 \\) is also off, resulting in \\( i_{D4} = i_{D2} = I_{SS} \\).\n\nAs \\( v_I \\) increases, \\( M_1 \\) gradually turns on while \\( M_2 \\) becomes less conductive. Since \\( M_1 \\) sees the small ohmic resistance of \\( M_5 \\) as its load, \\( v_{O1} \\) will decrease slightly. At \\( v_I = 0 \\), \\( I_{SS} \\) is split equally between \\( M_1 \\) and \\( M_2 \\). However, due to the \\( W/L \\) ratio of \\( M_5 \\) being \\( m \\) times that of \\( M_4 \\), \\( v_{O1} \\) is higher than \\( v_{O2} \\). This circuit asymmetry is because \\( M_5 \\) remains in the triode region while \\( M_4 \\) is saturated.\n\nTo trip the circuit, \\( v_I \\) must increase to \\( V_{IH} \\) (where \\( V_{IH} > 0 \\)), which pulls \\( M_5 \\) out of the triode region and into saturation. This trip voltage is determined through Kirchhoff's Voltage Law (KVL) and the familiar FET formula.\n\nThe circuit's behavior is symmetric, meaning that to trip in the opposite direction, \\( v_I \\) must decrease to \\( V_{IL} \\) (where \\( V_{IL} < 0 \\)), and the roles of the FET pairs are reversed.\n\nThe provided examples and exercises further illustrate the calculations and design considerations involved in implementing hysteresis in comparator circuits, aiming to reduce the dependence of the reference current \\( I_{REF} \\) on the power supply voltage."
},
{
    "text": "In voltage comparators, a high gain and rapid operation are often sought after. However, these characteristics can be detrimental when dealing with noisy inputs. To exemplify this, let's examine the circuit depicted in Fig. $5.25a$, which employs a comparator to detect the zero crossings of a slowly changing signal $v_{I}$ that is subject to noise. This noise can induce the comparator to register multiple transitions when $v_{I}$ is near 0 V, resulting in erroneous counts. It's worth noting that under very high gain conditions, it may only require a tiny amount of noise, on the order of tens of micro-volts, to traverse the range between $V_{I L}$ and $V_{I H}$, and vice versa. Therefore, the representation in the figure has been exaggerated to enhance clarity.\n\nThe unwanted output changes, also known as chatter, can be mitigated by introducing hysteresis, as demonstrated in Fig. 5.25b. Here, the comparator demonstrates two voltage transfer characteristics (VTCs) based on its output state: when $v_{O}=V_{O L}$, the comparator triggers when $v_{I}$ rises to $V_{T H}$, and when $v_{O}=V_{O H}$, it triggers when $v_{I}$ falls to $V_{T L}$. If the voltage difference $V_{T H}-V_{T L}$, referred to as the hysteresis width, is greater than the maximum peak-to-peak noise amplitude of the input, chatter can be effectively eliminated, as illustrated in Fig. 5.25b. Hysteresis is typically introduced through positive feedback, either by the user or by the integrated circuit (IC) designer, with the latter being of interest here.\n\nFigure 5.26 presents a widely used CMOS implementation of the comparator-with-hysteresis concept. Disregarding $M_{5}$ and $M_{6}$ for the moment, it can be observed that the $M_{4}-M_{7}$ mirror ensures $i_{D 2}$ is directed towards the output node $v_{0}$, while the $M_{3}-M_{8}$ and $M_{9}-M_{10}$ mirrors steer $i_{D 1}$ away from node $v_{O}$. As a result, the circuit behaves as a differential amplifier with a small-signal gain of $a=v_{o} /\\left(v_{p}-v_{n}\\right)=g_{m 1}\\left(r_{o 7} / / r_{o 10}\\right)$ and a VTC similar to that shown in Fig. 5.20c (refer also to Fig. 4.66)."
},
{
    "text": "Voltage comparators typically benefit from high gain and speed, but these traits can be detrimental when dealing with noisy inputs. As an example, examine the circuit in Fig. $5.25 a$, which employs a comparator to count the zero crossings of a noisy, slowly-varying signal $v_{I}$. This noise can trigger the comparator to switch multiple times when $v_{I}$ is around 0 V, resulting in incorrect counts. Although the depicted noise level may seem exaggerated, it's important to remember that with high gain, even a small noise voltage of a few tens of micro-volts can cause the comparator to fluctuate between $V_{I L}$ and $V_{I H}$, hence the exaggerated visualization.\n\nThis issue, known as chatter, can be resolved by incorporating hysteresis, as shown in Fig. $5.25b$. In this setup, the comparator has two different VTCs depending on its output state: when $v_{O}=V_{O L}$, it triggers when $v_{I}$ reaches $V_{T H}$, and when $v_{O}=V_{O H}$, it triggers at $v_{I}$ dropping to $V_{T L}$. By ensuring that the hysteresis width, defined as $V_{T H}-V_{T L}$, is greater than the maximum peak-to-peak amplitude of the input noise, chatter is effectively prevented, as demonstrated in Fig. $5.25b$. Hysteresis can be implemented through positive feedback, either externally by the user or internally by the IC designer, with the latter being our focus here.\n\nFig. $5.26$ presents a commonly used CMOS implementation of a comparator with hysteresis. Disregarding $M_{5}$ and $M_{6}$ for the moment, we see that the $M_{4}-M_{7}$ mirror directs $i_{D 2}$ towards the output node $v_{0}$, while the $M_{3}-M_{8}$ and $M_{9}-M_{10}$ mirrors divert $i_{D 1}$ away from node $v_{O}$. As a result, the circuit functions as a differential amplifier with a small-signal gain $a=v_{o} /\\left(v_{p}-v_{n}\\right)=g_{m 1}\\left(r_{o 7} / / r_{o 10}\\right)$ and a VTC similar to that in Fig. $5.20c$ (also see Fig. $4.66$)."
},
{
    "text": "The text provided describes the behavior and characteristics of voltage comparators, particularly in the context of noise and hysteresis. High gain and speed are generally desired traits in voltage comparators, but they can lead to issues with noisy inputs, causing false counts due to multiple transitions when the input voltage is near 0 V. Hysteresis is introduced to eliminate this unwanted chatter by causing the comparator to trip at different voltage levels depending on the output state, thereby preventing rapid switching due to small fluctuations around a single threshold level.\n\nThe text also delves into the CMOS realization of a comparator with hysteresis, discussing the role of cross-coupled PMOS transistors (M5 and M6) in creating the hysteresis effect. The behavior of the comparator circuit is analyzed with respect to the input voltage, and the conditions for the comparator to trip are determined through calculations involving the transconductance (g_m) and resistance (r_o) of the transistors.\n\nFurthermore, the text explores the power-supply dependence of reference currents in both bipolar and MOS circuits. It presents equations and calculations to estimate the change in reference current with variations in supply voltage, highlighting the importance of reducing this dependence for stable circuit operation.\n\nLastly, the text provides a small-signal model to analyze the power-supply dependence of a mismatch-based reference current, along with exercises to derive equations and estimate percentage changes in reference current with voltage variations."
},
{
    "text": "Voltage comparators typically benefit from high gain and speed, but in the presence of noise, these characteristics can be detrimental. Take, for example, the circuit in Fig. 5.25a, where a comparator is tasked with counting the zero crossings of a noisy, slowly-varying signal \\( v_{I} \\). The noise induces multiple transitions in the comparator's output as \\( v_{I} \\) approaches 0 V, resulting in inaccurate counts. Although the noise level in the illustration may seem exaggerated, it's important to note that even a small amount of noisemere tens of micro-voltscan cause the comparator to switch states due to its high gain, hence the exaggerated representation for clarity.\n\nThis phenomenon, known as chatter, can be mitigated by introducing hysteresis, as shown in Fig. 5.25b. In this configuration, the comparator has two distinct voltage threshold curves (VTCs) based on its output state. When \\( v_{O} \\) is low, the comparator switches to high when \\( v_{I} \\) reaches \\( V_{T H} \\), and conversely, when \\( v_{O} \\) is high, it switches to low at \\( V_{T L} \\). By ensuring that the hysteresis width, \\( V_{T H} - V_{T L} \\), exceeds the peak-to-peak amplitude of the input noise, chatter can be effectively eliminated. Hysteresis can be implemented through positive feedback, either by the user or designed into the integrated circuit.\n\nFig. 5.26 presents a common CMOS implementation of a comparator with hysteresis. Focusing on \\( M_{4}-M_{7} \\) and \\( M_{3}-M_{8} \\) mirroring, we see that \\( i_{D 2} \\) is directed towards the output node \\( v_{0} \\), while \\( i_{D 1} \\) is directed away from it. This arrangement results in a differential amplifier with a small-signal gain \\( a = v_{o} / (v_{p} - v_{n}) = g_{m 1} (r_{o 7} || r_{o 10}) \\) and a VTC similar to that in Fig. 5.20c (also see Fig. 4.66).\n\nIncorporating \\( M_{5} \\) and \\( M_{6} \\) into the circuit introduces a flip-flop action that unbalances the loads seen by \\( M_{1} \\) and \\( M_{2} \\), thus creating hysteresis. The behavior of the circuit under different \\( v_{I} \\) conditions is explored in Fig. 5.27, revealing the conditions under which the comparator switches states.\n\nThe effect of hysteresis on the comparator's behavior is further illustrated in Fig. 5.29, which shows the transfer characteristics of the circuit in Fig. 5.28. The hysteresis loop in Fig. 5.29a demonstrates the circuit's ability to resist chatter, while the detailed view in Fig. 5.29b highlights the snapping action as \\( v_{I} \\) crosses the threshold voltage \\( V_{I H} \\).\n\nThe dependence of the reference current \\( I_{R E F} \\) on the power supply voltage is a critical consideration in the design of circuits like those in Fig. 5.30. The examples provided illustrate the impact of supply voltage variations on \\( I_{R E F} \\) and suggest methods to reduce this dependence, such as cascoding transistors to improve the circuit's stability.\n\nFinally, the small-signal model in Fig. 5.33 is used to analyze the power-supply dependence of a mismatch-based reference current. By applying nodal analysis and KVL, an expression for the current's dependence on the supply voltage is derived, demonstrating that increasing the output resistance \\( R_{o 2} \\) can lead to a less supply-dependent current.\n\nThe examples and exercises throughout the text provide practical calculations and simulations to reinforce the concepts discussed, demonstrating the significance of hysteresis in comparator circuits and the importance of supply-independent reference currents in circuit design."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped because each mirror biases and is concurrently biased by the other. Specifically, if one mirror fails to activate, the other will also remain inactive, causing the circuit to persist in this undesirable state indefinitely. Consequently, a mechanism is required that, upon power application to the circuit, will initiate at least one of the mirrors, compelling the circuit to transition to the desired state and stabilize there. This mechanism, aptly named the startup circuit, in its simplest form comprises a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for the bipolar scenario. (It is imperative that this current be significantly smaller than $I_{R E F}$ to prevent the introduction of an unacceptable error.)\n\nA more refined approach involves a startup circuit that activates only when the reference is in an unwanted state, subsequently becoming inactive once the reference attains the desired state. In the CMOS example shown in Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ create a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is designed to be sufficiently high to turn on $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ fully activates, $V_{G S 9}$ is designed to decrease below $V_{t 9}$, turning off $M_{9}$ and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is fulfilled by $Q_{5} / M_{5}$ when the stabilized current is to be sourced to an external load, and by $Q_{6} / M_{6}$ when it is to be sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It employs transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may result in instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It utilizes positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial caveat must be noted: the circuits in Fig. 5.34 incorporate positive feedback, a condition that can lead to instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we observe that the current $i$ is initially amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, it is essential that $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}$, $R_{1}=\\Delta V_{B E} / I_{E 2} \\cong 54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. By Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=1.27 \\mathrm{V}$. Finally, applying Eq. (5.62) to impose $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$, we find $R_{3} / R_{4}=2.94$. Using $R_{4}=10 \\mathrm{k} \\Omega$ results in $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This is a line graph showing the change in bandgap reference voltage with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as the temperature moves away from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at the temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature deviates from \\( T_0 \\) in both negative and positive directions on the temperature scale.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, indicating the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as indicated in the context.\n\nThis graph demonstrates the dependency of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final observation is necessary. Equation (5.60) provides the value of $K$ required to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically the ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature typical of this reference class. (Students are encouraged to explore the literature for sophisticated curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}$, $R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=658.5 \\mathrm{mV}$. The calculation of $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nThis results in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped, as each mirror biases the other and vice versa. Specifically, if one mirror fails to activate, the other will also remain off, causing the circuit to linger in this undesirable state indefinitely. Consequently, a mechanism is required that, upon power application, will activate at least one mirror, propelling the circuit towards the desired state and maintaining it there. This mechanism, aptly named the startup circuit, in its simplest form comprises a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for the bipolar scenario. (It is imperative that this current is significantly smaller than $I_{R E F}$ to prevent introducing unacceptable errors.)\n\nA more refined approach involves a startup circuit that only intervenes when the reference is in an unwanted state, becoming inactive once the reference reaches the desired state. In the CMOS example shown in Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ create a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is set high enough to turn on $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ fully activates, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning off $M_{9}$ and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is performed by $Q_{5} / M_{5}$ when the stabilized current is to be sourced to an external load, and by $Q_{6} / M_{6}$ when it is to be sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It employs transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It utilizes positive feedback, which may result in instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial note is warranted: the circuits in Fig. 5.34 incorporate positive feedback, which can lead to instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we observe that the current $i$ is first amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}, R_{1}=\\Delta V_{B E} / I_{E 2} \\cong$ $54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\right.$ $\\left.\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. By Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=$ 1.27 V . Finally, applying Eq. (5.62) to impose $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$ results in $R_{3} / R_{4}=$ 2.94. Using $R_{4}=10 \\mathrm{k} \\Omega$ and $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This is a line graph showing the change in bandgap reference voltage with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values between approximately 1.265 V and 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature deviates from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) in both negative and positive directions.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), indicating that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph demonstrates the dependence of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final point merits attention. Equation (5.60) determines the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature typical of this reference class. (Students are encouraged to explore the literature for sophisticated curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}, R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=$ $\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=$ 658.5 mV . Calculating $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nThis results in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped, as each mirror biases and is simultaneously biased by the other. Specifically, if one mirror fails to activate, the other will also remain inactive, causing the circuit to linger in this undesirable state indefinitely. Consequently, a mechanism is required that, upon circuit power-up, will initiate at least one mirror, compelling the circuit to transition to the desired state and maintain it. This mechanism, aptly named the startup circuit, in its simplest form, comprises a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors. This is illustrated in Fig. 5.34a for the bipolar scenario. (It is implicit that this current must be substantially smaller than $I_{R E F}$ to prevent introducing an unacceptable error.)\n\nA more refined approach involves a startup circuit that activates only when the reference is in an unwanted state, but becomes inactive once the reference attains the desired state. In the CMOS example shown in Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ create a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is designed to be sufficiently high to activate $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ fully turns on, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning $M_{9}$ off and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is fulfilled by $Q_{5} / M_{5}$ when the stabilized current is to be sourced to an external load, and by $Q_{6} / M_{6}$ when it is to be sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It uses transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It uses positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial caution is necessary: the circuits in Fig. 5.34 incorporate positive feedback, which can result in instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we observe that the current $i$ is initially amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}$, $R_{1}=\\Delta V_{B E} / I_{E 2} \\cong 54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. From Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=1.27 V$. Finally, applying Eq. (5.62) to enforce $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$, we find $R_{3} / R_{4}=2.94$. With $R_{4}=10 \\mathrm{k} \\Omega$, $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 is a plot depicting the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This is a line graph showing how the bandgap reference voltage changes with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph shows a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature moves away from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at the temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) both in the negative and positive direction on the temperature scale.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, which is the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph illustrates the dependence of the bandgap reference voltage on temperature, highlighting the stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final note is warranted. Equation (5.60) provides the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature typical of this reference class. (Students are encouraged to explore the literature for advanced curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}$, $R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=658.5 \\mathrm{mV}$. Calculating $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nresulting in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped due to the mutual biasing between each mirror. Specifically, if one mirror fails to activate, the other will similarly remain inactive, causing the circuit to persist in an undesirable state indefinitely. Consequently, a mechanism is required that, upon power application, ensures at least one mirror is activated, driving the circuit towards the intended state and maintaining it there. This mechanism, known as a startup circuit, typically involves a large resistor $R_{\\text{startup}}$ to introduce a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for a bipolar configuration. (It is imperative that this current is significantly smaller than $I_{R E F}$ to prevent intolerable errors.)\n\nA more refined approach involves a startup circuit that only engages when the reference is in an unwanted state, subsequently becoming inactive once the reference attains the desired state. In the CMOS example shown in Fig. 5.34b, the diode-connected transistors $M_{7}$ and $M_{8}$ form a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is set sufficiently high to activate $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ is fully on, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning $M_{9}$ off and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is fulfilled by $Q_{5} / M_{5}$ when the stabilized current is to be sourced to an external load, and by $Q_{6} / M_{6}$ when it is to be sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It utilizes transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It employs positive feedback, which may result in instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial caveat to note is that the circuits in Fig. 5.34 incorporate positive feedback, which can lead to instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we observe that the current $i$ is first amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure that $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}$, $R_{1}=\\Delta V_{B E} / I_{E 2} \\cong 54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. By Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=1.27 \\mathrm{V}$. Finally, using Eq. (5.62) to impose $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$, we get $R_{3} / R_{4}=2.94$. With $R_{4}=10 \\mathrm{k} \\Omega$, $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This line graph shows how the bandgap reference voltage changes with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph displays a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature moves away from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at the temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) in both negative and positive directions on the temperature scale.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, indicating the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph demonstrates the dependence of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final point to consider is that Equation (5.60) provides the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature typical of this type of reference. (Students are encouraged to explore the literature for advanced curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}$, $R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=658.5 \\mathrm{mV}$. The calculation of $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nThis results in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped due to their mutual biasing mechanism, where each mirror biases the other. Specifically, if one mirror fails to activate, the other will also remain off, causing the circuit to persist in an undesirable state. Consequently, a mechanism is required that, upon power application, initiates at least one mirror, propelling the circuit towards the desired state and maintaining it there. This mechanism, known as the startup circuit, typically involves a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for a bipolar configuration. (It is imperative that this current be significantly smaller than $I_{R E F}$ to prevent intolerable errors.)\n\nA more refined approach involves a startup circuit that activates only when the reference is in an unwanted state, subsequently becoming inactive once the reference stabilizes in the desired state. In the CMOS example shown in Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ create a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is set sufficiently high to activate $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ fully turns on, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning $M_{9}$ off and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is fulfilled by $Q_{5} / M_{5}$ when the stabilized current needs to be sourced to an external load, and by $Q_{6} / M_{6}$ when it needs to be sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It utilizes transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit employs positive feedback, which can lead to instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It uses positive feedback, which may result in instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial caveat to note is that the circuits in Fig. 5.34 incorporate positive feedback, which can lead to instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we observe that the current $i$ is initially amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. The overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure that $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}, R_{1}=\\Delta V_{B E} / I_{E 2} \\cong$ $54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\right.$ $\\left.\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. From Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=$ 1.27 V . Finally, applying Eq. (5.62) to enforce $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$ results in $R_{3} / R_{4}=$ 2.94. With $R_{4}=10 \\mathrm{k} \\Omega$, we get $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This is a line graph showing how the bandgap reference voltage varies with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature deviates from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at the temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) in both negative and positive directions on the temperature scale.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, indicating the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph demonstrates the dependence of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final point to consider is that Equation (5.60) provides the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature typical of this reference class. (Students are encouraged to explore the literature for advanced curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}, R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=$ $\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=$ 658.5 mV . The calculation of $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nThis results in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits in Fig. 5.32 are termed self-biased or bootstrapped as each mirror biases and is concurrently biased by the other. Specifically, if one mirror fails to activate, the other will also remain inactive, causing the circuit to persist in this undesirable state indefinitely. Consequently, a mechanism is required that, upon power application, ensures at least one mirror activates, driving the circuit towards the intended state and maintaining it there. This mechanism, known as the startup circuit, in its simplest form, comprises a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for the bipolar scenario. (It is implicit that this current must be significantly smaller than $I_{R E F}$ to prevent introducing unacceptable errors.)\n\nA more refined approach involves a startup circuit that intervenes exclusively when the reference is in an unwanted state, becoming inactive once the reference reaches the desired state. In the CMOS example of Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ create a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is set sufficiently high to activate $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ fully activates, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning $M_{9}$ off and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is fulfilled by $Q_{5} / M_{5}$ when the stabilized current is sourced to an external load, and by $Q_{6} / M_{6}$ when it is sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It uses transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It uses positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial caveat is necessary: the circuits in Fig. 5.34 employ positive feedback, which can result in instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we note that the current $i$ is initially amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}, R_{1}=\\Delta V_{B E} / I_{E 2} \\cong$ $54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. We also have $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\right.$ $\\left.\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. By Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=$ 1.27 V . Finally, using Eq. (5.62) to impose $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$, we get $R_{3} / R_{4}=$ 2.94. With $R_{4}=10 \\mathrm{k} \\Omega$, $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This is a line graph showing how the bandgap reference voltage changes with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature moves away from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at the temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) in both negative and positive directions on the temperature scale.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, indicating the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph demonstrates the dependence of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final observation is pertinent. Equation (5.60) provides the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As depicted in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature ${ }^{1}$ typical of this class of references. (The student is encouraged to explore the literature ${ }^{1-3}$ for innovative curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}, R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=$ $\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=$ 658.5 mV . The calculation of $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nThis results in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped due to the mutual biasing of each mirror by the other. Specifically, if one mirror fails to activate, the other will also remain inactive, causing the circuit to linger in this undesirable state indefinitely. Consequently, a mechanism is required that, upon power application, initiates at least one mirror, propelling the circuit towards the intended state and maintaining it there. This mechanism, known as a startup circuit, in its simplest form comprises a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for the bipolar scenario. (It is imperative that this current is substantially less than $I_{R E F}$ to prevent significant error.)\n\nA more refined approach involves a startup circuit that activates only when the reference is in an unwanted state and deactivates once the reference reaches the desired state. In the CMOS example of Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ create a voltage divider to provide appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is set high enough to activate $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ fully activates, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning $M_{9}$ off and leaving the rest of the circuit undisturbed.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is fulfilled by $Q_{5} / M_{5}$ when the stabilized current is to be sourced to an external load, and by $Q_{6} / M_{6}$ when it is to be sunk from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It uses transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It uses positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial caveat is that the circuits in Fig. 5.34 employ positive feedback, which can result in instability if the loop gain surpasses unity (further discussed in Chapter 7). Referring to Fig. 5.33, we observe that the current $i$ is initially amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, termed the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}$, $R_{1}=\\Delta V_{B E} / I_{E 2} \\cong 54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60), we impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nyielding $R_{2}=3.14 \\mathrm{k} \\Omega$. By Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=1.27 \\mathrm{V}$. Finally, using Eq. (5.62) to impose $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$, we get $R_{3} / R_{4}=2.94$. With $R_{4}=10 \\mathrm{k} \\Omega$, $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This is a line graph showing how the bandgap reference voltage changes with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature deviates from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at the temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) in both negative and positive directions on the temperature scale.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, indicating the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph demonstrates the dependence of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final point merits attention. Equation (5.60) determines the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature ${ }^{1}$ characteristic of this type of reference. (Students are encouraged to consult the literature ${ }^{1-3}$ for advanced curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}$, $R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=658.5 \\mathrm{mV}$. The calculation of $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nresulting in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The circuits depicted in Fig. 5.32 are termed self-biased or bootstrapped due to their mutual biasing mechanism, where each mirror biases the other. Specifically, if one mirror fails to activate, the other will also remain off, causing the circuit to linger in this undesirable state indefinitely. Consequently, a mechanism is essential to ensure that at least one mirror is activated upon power-up, propelling the circuit towards the intended state and maintaining it there. This mechanism, known as the startup circuit, typically includes a large resistor $R_{\\text {startup }}$ to inject a minimal startup current into one of the mirrors, as illustrated in Fig. 5.34a for the bipolar configuration. (Naturally, this current must be significantly smaller than $I_{R E F}$ to prevent intolerable errors.)\n\nA more refined approach involves a startup circuit that only activates when the reference is in an unwanted state and deactivates once the reference reaches the desired state. In the CMOS example shown in Fig. $5.34 b$, the diode-connected transistors $M_{7}$ and $M_{8}$ form a voltage divider to provide an appropriate gate bias for $M_{9}$. If $M_{1}$ is off, $V_{G S 9}$ is set high enough to turn on $M_{9}$, thereby forcing both mirrors out of the cutoff state. Once $M_{1}$ is fully on, $V_{G S 9}$ is designed to drop below $V_{t 9}$, turning $M_{9}$ off and leaving the rest of the circuit unaffected.\n\nSince the current $I_{R E F}$ is utilized internally, provisions must be made for its external replication. In Fig. 5.34, this function is performed by $Q_{5} / M_{5}$ when sourcing the stabilized current to an external load and by $Q_{6} / M_{6}$ when sinking it from an external load.\n\nimage_name:(a)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q2, type: NPN, ports: {C: X2, B: X2, E: GND}\nname: Q3, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q4, type: PNP, ports: {C: X1, B: X2, E: VCC}\nname: Q5, type: PNP, ports: {C: I5, B: X1, E: VCC}\nname: Q6, type: NPN, ports: {C: I6, B: X2, E: GND}\nname: Rstartup, type: Resistor, value: Rstartup, ports: {N1: X2, N2: X1}\nname: R, type: Resistor, value: R, ports: {N1: X3, N2: GND}\n]\nextrainfo:The circuit diagram (a) is a bipolar mismatch-based current reference with a start-up circuit. It employs transistors Q1 to Q6 and resistors Rstartup and R to establish a reference current IREF. The circuit incorporates positive feedback, which may result in instability if the loop gain exceeds unity.\n\nimage_name:(b)\ndescription:\n[\nname: M1, type: NMOS, ports: {S: GND, D: X3, G: X1}\nname: M2, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: M3, type: PMOS, ports: {S: VDD, D: X2, G: X3}\nname: M4, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M5, type: PMOS, ports: {S: VDD, D: X2, G: X2}\nname: M6, type: NMOS, ports: {S: X3, D: GND, G: X2}\nname: M7, type: PMOS, ports: {S: VDD, D: X1, G: X1}\nname: M8, type: NMOS, ports: {S: GND, D: X1, G: X1}\nname: M9, type: NMOS, ports: {S: X3, D: X2, G: X1}\nname: R, type: Resistor, value: R, ports: {N1: X2, N2: GND}\n]\nextrainfo:The circuit is a CMOS mismatch-based current reference with a start-up circuit. It utilizes positive feedback, which may lead to instability if the loop gain exceeds unity.\n\nFIGURE 5.34 Mismatch-based current references with start-up circuit examples: (a) bipolar and (b) CMOS.\n\nA crucial note is necessary: the circuits in Fig. 5.34 incorporate positive feedback, which can cause instability if the loop gain exceeds unity (further discussed in Chapter 7). Referring to Fig. 5.33, we see that the current $i$ is first amplified to $m_{p} i$ by $Q_{3}$, then converted to $v_{1} \\cong r_{1} m_{p} i \\cong m_{p} i / g_{m 1}$ by $Q_{1}$, and finally returned by $Q_{2}$ as $G_{m 2} v_{1} \\cong\\left(m_{p} G_{m 2} / g_{m 1}\\right) i$. Thus, the overall amplification experienced by $i$ around the loop, known as the loop gain $T$, is $T=m_{p} G_{m 2} / g_{m 1}$. To prevent instability, we must ensure that $T<1$ (indeed, Example $5.11 a$ has $T=0.257 \\mathrm{~A} / \\mathrm{A}$, and Example $5.11 b$ has $T=0.571 \\mathrm{~A} / \\mathrm{A}$).\n\n#### Solution\n\nWe have $\\Delta V_{B E}=V_{T} \\ln \\left(m_{p} \\times m_{n}\\right)=26 \\ln (1 \\times 8)=54 \\mathrm{mV}, R_{1}=\\Delta V_{B E} / I_{E 2} \\cong$ $54 / 0.1=0.54 \\mathrm{k} \\Omega$, and $R=1 / 0.1=10 \\mathrm{k} \\Omega$. Additionally, $V_{B E 1}=V_{T} \\ln \\left[\\left(0.1 \\times 10^{-3}\\right) /\\right.$ $\\left.\\left(2 \\times 10^{-15}\\right)\\right]=640.5 \\mathrm{mV}$. Using Eq. (5.60) to impose\n\n$$\n(1+1) \\frac{R_{2}}{0.54} \\ln (1 \\times 8)=\\frac{1,205-640.5}{26}+4-1.5\n$$\n\nwe obtain $R_{2}=3.14 \\mathrm{k} \\Omega$. By Eq. (5.61), $V_{B G}=1.205+(4-1.5) 0.026=$ 1.27 V . Finally, applying Eq. (5.62) to enforce $5.0=\\left(1+R_{3} / R_{4}\\right) 1.27$ results in $R_{3} / R_{4}=$ 2.94. With $R_{4}=10 \\mathrm{k} \\Omega$, we get $R_{3}=29.4 \\mathrm{k} \\Omega$.\n\nimage_name:FIGURE 5.36 Thermal variation of a bandgap reference.\ndescription:The graph in Figure 5.36 illustrates the thermal variation of a bandgap reference voltage, denoted as \\( V_{BG} \\), as a function of temperature \\( T \\).\n\n1. **Type of Graph and Function:**\n- This line graph shows how the bandgap reference voltage changes with temperature.\n\n2. **Axes Labels and Units:**\n- The x-axis represents temperature \\( T \\) in degrees Celsius (C), ranging from -50C to 100C.\n- The y-axis represents the bandgap reference voltage \\( V_{BG} \\) in volts (V), with values ranging from approximately 1.265 V to 1.270 V.\n\n3. **Overall Behavior and Trends:**\n- The graph exhibits a slight parabolic shape, indicating that \\( V_{BG} \\) increases to a peak and then decreases as temperature deviates from a central point.\n- The peak occurs at a specific temperature \\( T_0 \\), which is marked on the graph.\n\n4. **Key Features and Technical Details:**\n- The peak voltage \\( V_{BG} \\) is around 1.270 V, occurring at temperature \\( T_0 \\).\n- The voltage decreases slightly as the temperature moves away from \\( T_0 \\) in both negative and positive directions.\n\n5. **Annotations and Specific Data Points:**\n- The graph is annotated with \\( T_0 \\) at the peak, indicating the temperature where \\( V_{BG} \\) reaches its maximum value.\n- The curve is symmetric around \\( T_0 \\), showing that the temperature coefficient \\( \\text{TC}(V_{BG}) \\) is zero at this point, as suggested in the context.\n\nThis graph demonstrates the dependence of the bandgap reference voltage on temperature, highlighting its stability around the temperature \\( T_0 \\).\n\nFIGURE 5.36 Thermal variation of a bandgap reference.\n\nOne final point merits attention. Equation (5.60) provides the value of $K$ necessary to achieve $\\mathrm{TC}\\left(V_{B G}\\right)=0$ at a specific temperature $T_{0}$, typically ambient temperature. Since $K$ depends on $V_{B E 1}$ and $V_{T}$, which are themselves temperature-dependent, $\\operatorname{TC}\\left(V_{B G}\\right)$ will deviate from zero at temperatures other than $T_{0}$. As shown in Fig. 5.36, the plot of $V_{B G}$ versus $T$ exhibits a curvature typical of this type of reference. (Students are encouraged to explore the literature for sophisticated curvature-correction techniques designed to mitigate this higher-order effect.)\n\n#### Solution\n\nWe have $\\Delta V_{E B}=26 \\ln (10 \\times 1)=59.9 \\mathrm{mV}, R_{1}=\\Delta V_{E B} / I_{E 2}=\\Delta V_{E B} /\\left(I_{E 1} / 10\\right)=$ $\\left(59.9 \\times 10^{-3}\\right) /\\left(10 \\times 10^{-6}\\right)=5.99 \\mathrm{k} \\Omega$, and $V_{E B 1}=V_{T} \\times \\ln \\left[\\left(100 \\times 10^{-6}\\right) / 10^{-15}\\right]=$ 658.5 mV . Calculating $K$ yields\n\n$$\n(10+1) \\frac{R_{2}}{5.99} \\ln (10 \\times 1)=\\frac{1,205-658.5}{26}+4-1.5\n$$\n\nThis results in $R_{2}=5.56 \\mathrm{k} \\Omega$ and $m_{p} R_{2}=55.6 \\mathrm{k} \\Omega$."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically interchangeable due to the existence of complementary laws for voltages and currents (well-known examples of this interchangeability, termed duality, include Kirchhoff's voltage/current laws, the node/loop analysis methods, and the Thvenin/Norton theorems). Nevertheless, transistors, which are fundamental components of modern electronics, are nonlinear devices that handle voltage and current in distinct ways. Specifically, the exponential behavior of BJTs and the quadratic behavior of FETs inherently provide broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) variation in the overdrive voltage of a FET leads to a 100-to-1 (40 dB) variation in the channel current. Additionally, it is found that manipulating currents in a physical circuit is inherently quicker than manipulating voltages. This is because stray inductances, which resist rapid changes in mesh currents, are significantly less problematic than stray capacitances, which hinder rapid changes in node voltages (these factors will be explored extensively in Chapter 6). These benefits in both range and speed strongly advocate for the use of current-mode circuits, which prioritize current manipulation over voltage manipulation. (Interestingly, the engineering field has traditionally leaned towards the voltage perspective, as evidenced by the earlier commercial success and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hampered by technological challenges, like the capability to produce monolithic pnp BJTs that match the quality of their npn counterparts.) In this section, we delve into current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically equivalent due to the existence of counterpart laws for both voltages and currents (well-known examples of this equivalence, termed duality, include Kirchhoff's voltage/current laws, the node/loop methods, and the Thvenin/Norton theorems). However, transistors, which are fundamental to modern electronics, are nonlinear devices that handle voltage and current differently. Specifically, the exponential behavior of BJTs and the quadratic behavior of FETs inherently provide broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) change in the overdrive voltage of a FET leads to a 100-to-1 (40 dB) change in the channel current. Additionally, manipulating currents in a physical circuit is inherently faster than manipulating voltages. This is because stray inductances, which resist rapid changes in mesh currents, are less significant than stray capacitances, which hinder rapid changes in node voltages (these factors will be examined in detail in Chapter 6). These benefits in both range and speed strongly advocate for current-mode circuits, which prioritize current manipulation over voltage manipulation. Interestingly, the engineering field has traditionally favored the voltage perspective, evidenced by the earlier commercial maturity and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been delayed due to technological challenges, like the capability to produce monolithic pnp BJTs that match the quality of their npn counterparts. In this section, we explore current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically interchangeable due to the existence of complementary laws for voltages and currents (well-known examples of this duality include Kirchhoff's voltage/current laws, the node/loop methods, and the Thvenin/Norton theorems). Nevertheless, transistors, which are fundamental to modern electronics, are nonlinear devices that handle voltage and current in distinct ways. Specifically, the exponential behavior of BJTs and the quadratic behavior of FETs inherently provide broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) variation in the overdrive voltage of a FET leads to a $100$-to-1 $(40 \\mathrm{~dB})$ variation in the channel current. Additionally, manipulating currents in a physical circuit is inherently quicker than manipulating voltages. This is because stray inductances, which hinder rapid changes in mesh currents, are significantly less impactful than stray capacitances, which impede rapid changes in node voltages (these factors will be explored extensively in Chapter 6). These benefits in both range and speed strongly advocate for current-mode circuits, which prioritize current manipulation over voltage manipulation. (Curiously, the engineering field has historically preferred the voltage perspective, as evidenced by the earlier commercial maturation and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hindered by technological challenges, like the capability to produce monolithic pnp BJTs that match the quality of their $n p n$ equivalents.) In this section, we delve into current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically equivalent due to the existence of counterpart laws governing each (well-known examples of this equivalence, termed duality, include Kirchhoff's voltage/current laws, the node/loop methods, and the Thvenin/Norton theorems). Nevertheless, transistors, which are fundamental to modern electronics, are nonlinear devices that handle voltage and current distinctively. Specifically, the exponential nature of BJTs and the quadratic nature of FETs imply inherently broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) variation in the overdrive voltage of a FET leads to a $100$-to-1 (40 dB) variation in the channel current. Additionally, it is found that manipulating currents in a physical circuit is inherently quicker than manipulating voltages: this is because stray inductances, which hinder rapid changes in mesh currents, are significantly less impactful than stray capacitances, which impede rapid changes in node voltages (these factors will be explored extensively in Chapter 6). These benefits in both range and speed strongly advocate for current-mode circuits, which prioritize current manipulation over voltage manipulation. (Notably, the engineering field has historically leaned towards the voltage perspective, as evidenced by the earlier commercial maturity and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hindered by technological challenges, like the capability to produce monolithic pnp BJTs that match the quality of their npn counterparts.) In this section, we examine current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically interchangeable due to the existence of corresponding laws for voltages and currents, and vice versa (common examples of this interchangeability, termed duality, include Kirchhoff's voltage/current laws, node/loop methods, and Thvenin/Norton theorems). However, transistors, the fundamental components of modern electronics, are nonlinear devices that handle voltage and current differently. Notably, the exponential nature of BJTs and the quadratic nature of FETs imply inherently broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) change in the overdrive voltage of a FET leads to a 100-to-1 (40 dB) change in the channel current. Additionally, manipulating currents in a physical circuit is inherently faster than manipulating voltages: this is because stray inductances, which hinder rapid changes in mesh currents, are much less significant than stray capacitances, which hinder rapid changes in node voltages (these factors will be examined extensively in Chapter 6). These benefits in both range and speed strongly advocate for current-mode circuits, which prioritize the manipulation of currents over voltages. (Curiously, the engineering field has historically preferred the voltage perspective, evidenced by the earlier commercial maturity and popularity of voltage-mode circuits compared to current-mode circuits, a prime example being the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hindered by technological challenges, such as the capability to produce monolithic pnp BJTs that match the quality of their npn counterparts.) In this section, we explore current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically equivalent due to the existence of counterpart laws governing each (well-known examples of this equivalence, termed duality, include Kirchhoff's voltage/current laws, the node/loop methods, and the Thvenin/Norton theorems). However, transistors, which are fundamental to modern electronics, are nonlinear devices that handle voltage and current differently. Specifically, the exponential nature of BJTs and the quadratic nature of FETs inherently provide broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) change in a FET's overdrive voltage results in a $100$-to-1 $(40 \\mathrm{~dB})$ change in the channel current. Additionally, manipulating currents in a physical circuit is inherently faster than manipulating voltages. This is because stray inductances, which resist rapid changes in mesh currents, are less significant than stray capacitances, which hinder rapid changes in node voltages (these factors will be explored extensively in Chapter 6). These benefits in both range and speed strongly justify the use of current-mode circuits, which prioritize current manipulation over voltage manipulation. (Notably, the engineering field has traditionally preferred the voltage perspective, as evidenced by the earlier commercial maturity and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hindered by technological challenges, like the capability to produce monolithic pnp BJTs that match the quality of their $n p n$ equivalents.) In this section, we delve into current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically equivalent due to the complementary nature of the laws governing them (examples of this duality include Kirchhoff's voltage/current laws, node/loop methods, and Thvenin/Norton theorems). However, transistors, which are fundamental to modern electronics, are nonlinear devices that handle voltage and current differently. Specifically, the exponential behavior of BJTs and the quadratic behavior of FETs result in broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) change in a FET's overdrive voltage leads to a 100-to-1 (40 dB) change in the channel current. Additionally, manipulating currents in a physical circuit is inherently faster than manipulating voltages. This is because stray inductances, which hinder rapid changes in mesh currents, are less significant than stray capacitances, which impede rapid changes in node voltages (these factors will be explored extensively in Chapter 6). These benefits in range and speed strongly advocate for current-mode circuits, which prioritize current manipulation over voltage manipulation. Interestingly, the engineering field has historically preferred the voltage perspective, as evidenced by the earlier commercial success and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hindered by technological challenges, like the difficulty in producing monolithic pnp BJTs that match the quality of their npn counterparts. In this section, we examine current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "The voltages and currents in a linear circuit are mathematically equivalent due to the existence of counterpart laws for voltages and currents (well-known examples of this equivalence, termed duality, include Kirchhoff's voltage/current laws, the node/loop methods, and the Thvenin/Norton theorems). However, transistors, which are fundamental to modern electronics, are nonlinear devices that handle voltage and current differently. Specifically, the exponential nature of BJTs and the quadratic nature of FETs result in inherently broader dynamic ranges for currents compared to voltages: for example, a 10-to-1 (20 dB) change in the overdrive voltage of a FET leads to a 100-to-1 (40 dB) change in the channel current. Additionally, manipulating currents in a physical circuit is inherently faster than manipulating voltages. This is because stray inductances, which hinder rapid changes in mesh currents, are much less significant than stray capacitances, which impede rapid changes in node voltages (these issues will be thoroughly examined in Chapter 6). These advantages in both range and speed strongly justify the use of current-mode circuits, which prioritize current manipulation over voltage manipulation. Interestingly, the engineering field has historically favored the voltage perspective, as evidenced by the earlier commercial maturity and popularity of voltage-mode circuits, such as the op amp, a voltage-in/voltage-out component. The advancement of current-mode analog ICs has also been hindered by technological factors, like the challenge of producing monolithic pnp BJTs that match the quality of their npn counterparts. In this section, we explore current-mode circuits, including transconductors, current conveyors (CCs), operational transconductance amplifiers (OTAs), current feedback amplifiers (CFAs), and Gilbert Cells."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should ideally have very high (preferably infinite) resistance at both its input and output terminals. The simplest form of a transconductor is a transistor. However, transistors only operate within a single quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point within the active region and then achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure the circuit operates linearly, forming the basis of small-signal models.\n\nGreater versatility and flexibility can be achieved if we (a) set the operating point at the origin of the $i-v$ characteristic and (b) remove the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily derived by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To manage emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (this is akin to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ produce the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is evident that $Q_{1}$ through $Q_{4}$ form a voltage buffer with near-unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to yield the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transconductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transconductor, simplified circuit representation, and circuit symbol used sometimes.\n\nBy applying KCL at the voltage-buffer supernode and assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is clear that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington configuration at the input and Wilson configuration at the output), and (c) complete four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should have very high (ideally infinite) resistance at both the input and output terminals. The simplest form of a transconductor is a transistor. However, transistors operate only within a single quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point in the active region and achieve four-quadrant operation by allowing small positive and negative variations around this point. These variations must be kept small to ensure the circuit operates linearly, forming the basis of small-signal models.\n\nGreater versatility and flexibility can be achieved by (a) setting the operating point at the origin of the $i-v$ characteristic and (b) removing the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily created by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To handle emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (similar to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ create the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is evident that $Q_{1}$ through $Q_{4}$ form a voltage buffer with nearly unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to produce the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transconductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor employing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transconductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. By eliminating the difference $i_{1}-i_{2}$, we obtain\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is clear that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington input and Wilson output configurations), and (c) complete four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input into current output. To avoid loading effects, it should have very high (ideally infinite) resistance at both the input and output terminals. The most basic transconductor is a transistor. However, transistors only operate within one quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point in the active region and achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure approximately linear circuit behavior, which is the foundation of small-signal models.\n\nGreater versatility and flexibility can be achieved by (a) setting the operating point at the origin of the $i-v$ characteristic and (b) removing the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily created by substituting each BJT with a corresponding MOSFET). The following observations are made:\n\n- To manage emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (similar to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ produce the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is clear that $Q_{1}$ through $Q_{4}$ form a voltage buffer with nearly unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to yield the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transcoductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transcoductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is evident that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington configuration at the input and the Wilson configuration at the output), and (c) full four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into the transconductor for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input into current output. To avoid loading effects, it should have very high (ideally infinite) resistances at both the input and output terminals. The simplest form of a transconductor is a transistor. However, transistors only operate within one quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point in the active region and achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure approximately linear circuit behavior, which is the basis for small-signal models.\n\nGreater versatility and flexibility can be achieved if we (a) set the operating point at the origin of the $i-v$ characteristic and (b) eliminate the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily created by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To handle emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (this is akin to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ produce the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is clear that $Q_{1}$ through $Q_{4}$ form a voltage buffer with nearly unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to yield the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transcoductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transcoductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. By eliminating the difference $i_{1}-i_{2}$, we obtain\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is evident that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a conventional transistor (thanks to the Darlington configuration at the input and Wilson configuration at the output), and (c) complete four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into the transconductor for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should ideally have very high (preferably infinite) resistances at both its input and output terminals. The most basic form of a transconductor is a transistor. However, transistors operate within only one quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point within the active region and then achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure the circuit operates linearly, which is the foundation of small-signal models.\n\nGreater versatility and flexibility can be achieved if we (a) set the operating point at the origin of the $i-v$ characteristic and (b) remove the small-signal constraint entirely. A circuit that satisfies both conditions is depicted in Fig. 5.38 (while the shown version is bipolar, a CMOS version can be easily created by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To manage emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (this is akin to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ produce the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is clear that $Q_{1}$ through $Q_{4}$ form a voltage buffer with near-unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to yield the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transconductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor that uses Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor that employs Wilson current mirrors to replicate and subtract collector currents. The output current i_C equals the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor that uses Wilson current mirrors to replicate and subtract collector currents. It utilizes NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transconductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. By eliminating the difference $i_{1}-i_{2}$, we obtain\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is evident that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington circuitry at the input and Wilson circuitry at the output), and (c) complete four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should ideally have very high (preferably infinite) resistance at both its input and output terminals. The most basic form of a transconductor is a transistor. However, transistors only operate within a single quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point within the active region and then achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure the circuit operates linearly, forming the basis of small-signal models.\n\nGreater versatility and flexibility can be achieved if we can (a) set the operating point exactly at the origin of the $i-v$ characteristic and (b) eliminate the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily derived by substituting each BJT with a corresponding MOSFET). The following observations are made:\n\n- To accommodate emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (this is analogous to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ create the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and decrease the input bias current at node $B$. It is evident that $Q_{1}$ through $Q_{4}$ form a voltage buffer with near-unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to produce the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transconductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transconductor, simplified circuit representation, and circuit symbol used sometimes.\n\nBy applying KCL at the voltage-buffer supernode and assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using the usual subscripts $n$ and $p$, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is clear that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington configuration at the input and the Wilson configuration at the output), and (c) full four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should have very high (ideally infinite) resistance at both its input and output terminals. The most basic transconductor is a transistor. However, transistors only operate in one quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific point in the active region and achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure approximately linear operation, which is the basis for small-signal models.\n\nGreater versatility and flexibility can be achieved if we (a) set the operating point at the origin of the $i-v$ characteristic and (b) remove the small-signal constraint entirely. A circuit that satisfies both conditions is shown in Fig. 5.38 (though the depicted version is bipolar, a CMOS version can be easily obtained by replacing each BJT with a corresponding MOSFET). The following observations are made:\n\n- To handle emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is used, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (similar to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ create the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is clear that $Q_{1}$ through $Q_{4}$ form a voltage buffer with nearly unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to produce the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transcoductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transcoductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is evident that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a standard transistor (thanks to the Darlington input and Wilson output configurations), and (c) full four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should ideally have very high (preferably infinite) resistance at both its input and output terminals. The most basic form of a transconductor is a transistor. However, transistors only operate within a single quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point within the active region and then achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure the circuit operates linearly, forming the basis of small-signal models.\n\nGreater versatility and flexibility can be achieved if we (a) set the operating point at the origin of the $i-v$ characteristic and (b) remove the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily derived by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To accommodate emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (similar to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ create the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is evident that $Q_{1}$ through $Q_{4}$ form a voltage buffer with near-unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to produce the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transcoductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transcoductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is clear that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington configuration at the input and Wilson configuration at the output), and (c) complete four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as a macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should have very high (ideally infinite) resistance at both the input and output terminals. The simplest form of a transconductor is a transistor. However, transistors only operate in one quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point in the active region and achieve four-quadrant operation by allowing small variations, both positive and negative, around this point. These variations must be kept minimal to ensure approximately linear circuit behavior, which is the foundation of small-signal models.\n\nGreater versatility and flexibility can be achieved if we can (a) set the operating point at the origin of the $i-v$ characteristic and (b) eliminate the small-signal constraint entirely. A circuit that meets these criteria is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily derived by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To handle emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (this is akin to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ create the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is clear that $Q_{1}$ through $Q_{4}$ form a voltage buffer with near-unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to produce the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transcoductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transcoductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is evident that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington input and Wilson output configurations), and (c) complete four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as a macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "A transconductor is a circuit that converts voltage input to current output. To avoid loading effects, it should have very high (ideally infinite) resistance at both its input and output terminals. The simplest form of a transconductor is a transistor. However, transistors operate only within one quadrant of their $i_{C}-v_{B E}$ or $i_{D}-v_{G S}$ characteristics. To address this limitation, we bias the transistor at a specific operating point in the active region and achieve four-quadrant operation by allowing both positive and negative variations around this point. These variations must be kept small to ensure approximately linear circuit behavior, which is the foundation of small-signal models.\n\nGreater versatility and flexibility can be achieved if we (a) set the operating point at the origin of the $i-v$ characteristic and (b) eliminate the small-signal constraint entirely. A circuit that fulfills both requirements is depicted in Fig. 5.38 (though the shown version is bipolar, a CMOS version can be easily created by substituting each BJT with a corresponding MOSFET). The following observations can be made:\n\n- To manage emitter currents of either polarity, the class AB pair $Q_{1}-Q_{2}$ is employed, with $Q_{1}$ sourcing current to and $Q_{2}$ sinking current from the external circuitry at node $E$ (similar to the push-pull output stages discussed in Chapter 4).\n- The emitter followers $Q_{3}-Q_{4}$ produce the necessary junction voltage drops to bias the $Q_{1}-Q_{2}$ pair for class AB operation. They also provide a Darlington function to increase the input resistance and reduce the input bias current at node $B$. It is clear that $Q_{1}$ through $Q_{4}$ form a voltage buffer with nearly unity gain, as illustrated in the simplified equivalent circuit on the right. Assuming matched voltage drops $V_{E B 3}=V_{B E 1}$ and $V_{B E 4}=V_{E B 2}$, we have\n\n$$\n\\begin{equation*}\nv_{E}=v_{B} \\tag{5.63}\n\\end{equation*}\n$$\n\n- The Wilson current mirrors $Q_{5}-Q_{6}-Q_{7}$ and $Q_{10}-Q_{9}-Q_{8}$ replicate the collector currents of $Q_{1}$ and $Q_{2}$, respectively, and direct them to the output node $C$, where they are subtracted to yield the output current $i_{C}=i_{7}-i_{8}=i_{1}-i_{2}$.\nimage_name:Bipolar transconductor\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: V_EE}\nname: Q3, type: NPN, ports: {C: E, B: B, E: B}\nname: Q4, type: NPN, ports: {C: B, B: B, E: V_EE}\nname: Q5, type: PNP, ports: {C: V_CC, B: E, E: B}\nname: Q6, type: PNP, ports: {C: V_CC, B: B, E: C}\nname: Q7, type: PNP, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: V_EE, B: E, E: C}\nname: Q9, type: PNP, ports: {C: V_EE, B: C, E: B}\nname: Q10, type: PNP, ports: {C: V_EE, B: B, E: E}\nname: I3, type: CurrentSource, value: I3, ports: {Np: V_CC, Nn: E}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: V_EE}\n]\nextrainfo:The circuit is a bipolar transconductor utilizing Wilson current mirrors for current replication. The output current is the difference between the collector currents of Q1 and Q2, i.e., iC = i1 - i2. The output resistance at node C is influenced by the Wilson mirror resistances.\nimage_name:simplified circuit representation\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: E, E: GND}\nname: Q2, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q3, type: NPN, ports: {C: E, B: B, E: GND}\nname: Q4, type: NPN, ports: {C: B, B: B, E: GND}\nname: Q5, type: PNP, ports: {C: C, B: VCC, E: E}\nname: Q6, type: PNP, ports: {C: VCC, B: VCC, E: C}\nname: Q7, type: PNP, ports: {C: C, B: VCC, E: GND}\nname: Q8, type: PNP, ports: {C: GND, B: VEE, E: C}\nname: Q9, type: PNP, ports: {C: VEE, B: VEE, E: GND}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: GND}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. The output current i_C is equal to the emitter current i_E. The output node C has an output resistance determined by the parallel combination of Wilson mirror resistances.\nimage_name:circuit symbol\ndescription:\n[\nname: Q1, type: NPN, ports: {C: C, B: B, E: E}\nname: Q2, type: NPN, ports: {C: E, B: B, E: VEE}\nname: Q3, type: PNP, ports: {C: B, B: E, E: VCC}\nname: Q4, type: PNP, ports: {C: VCC, B: B, E: B}\nname: Q5, type: NPN, ports: {C: VCC, B: B, E: C}\nname: Q6, type: NPN, ports: {C: VCC, B: C, E: C}\nname: Q7, type: NPN, ports: {C: C, B: C, E: E}\nname: Q8, type: PNP, ports: {C: E, B: C, E: VEE}\nname: Q9, type: PNP, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: B, B: VEE, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: B}\nname: I4, type: CurrentSource, value: I4, ports: {Np: B, Nn: VEE}\n]\nextrainfo:The circuit is a bipolar transconductor using Wilson current mirrors to replicate and subtract collector currents. It uses NPN and PNP transistors to manage current flow from VCC to VEE, with outputs at node C.\n\nFIGURE 5.38 Bipolar transconductor, simplified circuit representation, and circuit symbol used sometimes.\n\nApplying KCL at the voltage-buffer supernode, assuming negligible base currents, we get $i_{1}=i_{2}+i_{E}$, or $i_{1}-i_{2}=i_{E}$. Eliminating the difference $i_{1}-i_{2}$ results in\n\n$$\n\\begin{equation*}\ni_{C}=i_{E} \\tag{5.64}\n\\end{equation*}\n$$\n\nFinally, the output resistance at node $C$ is the parallel combination of the Wilson mirror resistances $R_{c 7} \\cong\\left(\\beta_{o 7} / 2\\right) r_{o 7}$ and $R_{c 8} \\cong\\left(\\beta_{o 8} / 2\\right) r_{o 8}$. Using subscripts $n$ and $p$ as usual, we express this as\n\n$$\n\\begin{equation*}\nR_{c} \\cong\\left(\\frac{\\beta_{o n}}{2} r_{o n}\\right) / /\\left(\\frac{\\beta_{o p}}{2} r_{o p}\\right) \\tag{5.65}\n\\end{equation*}\n$$\n\nIt is evident that the transconductor can be viewed as an idealized transistor with (a) zero B-E voltage drop, (b) significantly higher input and output resistances than a typical transistor (thanks to the Darlington input and Wilson output configurations), and (c) full four-quadrant operation (for example, if node $E$ is connected to a resistive load to ground, $i_{E}$ and $i_{C}$ will flow out of the transconductor for $v_{B}>0$, but into it for $v_{B}<0$). Also known as a macro transistor, diamond transistor, and Current Conveyor II +, this transconductor can be used independently in CC, CB, and CE configurations, or as a building block for other current-mode ICs."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer, as depicted in Fig. 5.39, transforms it into a voltage-output circuit. This configuration is known as a current-feedback amplifier (CFA) and is used in place of a conventional op amp in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which clearly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances observed at the collectors and bases, respectively. Additionally, by inspection, we derive\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nNext, considering the typical feedback configuration in Fig. 5.40b, we sum the currents entering node $v_{N}$ to obtain\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we derive the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5}$ to $10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinctive benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from this discussion but arising from current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration is known as a current-feedback amplifier (CFA) and is used in place of a conventional op amp in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which explicitly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances observed at the collectors and bases, respectively. Additionally, by inspection, we derive\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nMoving on to the typical feedback configuration in Fig. 5.40b, we sum the currents entering node $v_{N}$ to obtain\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we obtain the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5}$ to $10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinctive benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from this discussion but resulting from current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration, known as a current-feedback amplifier (CFA), substitutes the traditional op amp in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which explicitly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances viewed from the collectors and bases, respectively. Additionally, by inspection, we obtain\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nNext, considering the typical feedback configuration in Fig. 5.40b, we sum the currents into node $v_{N}$ to derive\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we derive the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5}$ to $10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinct benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from the current discussion but arising from current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration is known as a current-feedback amplifier (CFA) and is used in place of conventional op amps in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which clearly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances observed at the collectors and bases, respectively. Additionally, by inspection, we obtain\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nMoving to the typical feedback configuration in Fig. 5.40b, we sum the currents entering node $v_{N}$ to derive\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we derive the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5}$ to $10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinct benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from the current discussion but rooted in current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration is known as a current-feedback amplifier (CFA) and is used in place of traditional op amps in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which clearly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances viewed from the collectors and bases, respectively. Additionally, by inspection, we obtain\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nNext, considering the typical feedback connection in Fig. 5.40b, we sum the currents into node $v_{N}$ to derive\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we derive the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5}$ to $10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinct benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from this discussion but rooted in current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration is known as a current-feedback amplifier (CFA) and is used in place of a conventional op amp in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which explicitly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances viewed from the collectors and bases, respectively. Additionally, by inspection, we obtain\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nNext, considering the typical feedback configuration in Fig. 5.40b, we sum the currents into node $v_{N}$ to derive\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we derive the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5} \\sim 10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinctive benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) include faster dynamics. These advantages, not immediately evident from this discussion but resulting from current-mode operation, will be further explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration, known as a current-feedback amplifier (CFA), substitutes the conventional op amp in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which clearly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances viewed from the collectors and bases, respectively. Additionally, by inspection, we derive\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nNext, considering the typical feedback configuration in Fig. 5.40b, we sum the currents entering node $v_{N}$ to obtain\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we obtain the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5}$ to $10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinct benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from this discussion but rooted in current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Connecting node $C$ of the transconductor in Fig. 5.38 to an additional voltage buffer as depicted in Fig. 5.39 transforms it into a voltage-output circuit. This configuration is known as a current-feedback amplifier (CFA) and is used in place of the traditional op amp in specific high-speed applications. To analyze this circuit, refer to the simplified equivalent shown in Fig. 5.40a, which clearly illustrates the net equivalent resistance $R_{e q}$ of node $C$ to ground. By examining Fig. 5.39, we determine this resistance through inspection as\n\n$$\n\\begin{equation*}\nR_{e q}=R_{c 7} / / R_{c 8} / / / R_{b 13} / / R_{b 14} \\tag{5.66}\n\\end{equation*}\n$$\n\nwhere $R_{c}$ and $R_{b}$ represent the resistances viewed from the collectors and bases, respectively. Additionally, by inspection, we obtain\n\n$$\n\\begin{equation*}\nv_{O}=R_{e q} i_{N} \\tag{5.67}\n\\end{equation*}\n$$\n\nNext, considering the typical feedback configuration in Fig. 5.40b, we sum the currents entering node $v_{N}$ to derive\n\n$$\ni_{N}+\\frac{0-v_{N}}{R_{1}}+\\frac{v_{O}-v_{N}}{R_{2}}=0\n$$\n\nimage_name:FIGURE 5.39 Current-feedback amplifier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VN, B: VP, E: C}\nname: Q2, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q3, type: PNP, ports: {C: VN, B: VP, E: VEE}\nname: Q4, type: PNP, ports: {C: VP, B: VCC, E: VEE}\nname: Q5, type: PNP, ports: {C: VCC, B: VP, E: VN}\nname: Q6, type: PNP, ports: {C: VCC, B: VN, E: C}\nname: Q7, type: NPN, ports: {C: VCC, B: C, E: VEE}\nname: Q8, type: NPN, ports: {C: C, B: VN, E: VEE}\nname: Q9, type: NPN, ports: {C: VEE, B: C, E: VEE}\nname: Q10, type: PNP, ports: {C: VEE, B: VN, E: C}\nname: Q11, type: NPN, ports: {C: VCC, B: C, E: VO}\nname: Q12, type: NPN, ports: {C: VO, B: C, E: VEE}\nname: Q13, type: PNP, ports: {C: VO, B: C, E: VEE}\nname: Q14, type: PNP, ports: {C: C, B: VO, E: VEE}\nname: I3, type: CurrentSource, value: I3, ports: {Np: VCC, Nn: VP}\nname: I4, type: CurrentSource, value: I4, ports: {Np: VP, Nn: VEE}\nname: I13, type: CurrentSource, value: I13, ports: {Np: VCC, Nn: VO}\nname: I14, type: CurrentSource, value: I14, ports: {Np: VO, Nn: VEE}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\nFIGURE 5.39 Current-feedback amplifier.\nimage_name:FIGURE 5.39 Current-feedback amplifier. (a)\ndescription:\n[\nname: Q5, type: PNP, ports: {C: VCC, B: X1, E: X1}\nname: Q7, type: PNP, ports: {C: VCC, B: X1, E: C}\nname: Q10, type: NPN, ports: {C: X2, B: X2, E: VEE}\nname: Q8, type: NPN, ports: {C: X2, B: C, E: VEE}\nname: C, type: Capacitor, value: C, ports: {Np: C, Nn: VO}\nname: Req, type: Resistor, value: Req, ports: {N1: C, N2: GND}\nname: X1, type: OpAmp, ports: {InP: VP, InN: VN, OutP: X1}\nname: X1, type: Buffer, ports: {In: C, Out: VO}\n]\nextrainfo:The circuit is a current-feedback amplifier with multiple NPN and PNP transistors forming a complex feedback loop. The circuit uses current sources I3, I4, I13, and I14 to control the biasing of the transistors. The amplifier operates between VCC and VEE, with the input at VP and the output at VO. The transistors are arranged to provide amplification and feedback, with Q1 to Q14 forming the core of the amplifier.\n\n(a)\nimage_name:(a)\ndescription:\n[\nname: V_I, type: VoltageSource, value: V_I, ports: {Np: V_I, Nn: GND}\nname: R_1, type: Resistor, value: R_1, ports: {N1: V_N, N2: GND}\nname: R_2, type: Resistor, value: R_2, ports: {N1: V_O, N2: V_N}\nname: OpAmp, type: OpAmp, ports: {InP: V_P, InN: V_N, OutP: V_O}\nname: Req, type: CurrentControlledVoltageSource, value: Req, ports: {N1: GND, N2: V_O}\n]\nextrainfo:The circuit is a current-feedback amplifier with a voltage gain given by the equation A = (1 + R2/R1) / (1 + R2/Req). It operates between VCC and VEE, with the input at V_I and the output at V_O. The amplifier utilizes a feedback loop for amplification and control.\n\n(b)\n\nFIGURE 5.40 (a) Simplified circuit equivalent of the CFA. (b) CFA symbol and interconnection for operation as a noninverting amplifier.\n\nBy setting $v_{N}=v_{P}=v_{I}$, solving for $i_{N}$, and substituting into Eq. (5.67), we derive the closed-loop voltage gain\n\n$$\n\\begin{equation*}\nA=\\frac{v_{O}}{v_{I}}=\\left(1+\\frac{R_{2}}{R_{1}}\\right) \\frac{1}{1+R_{2} / R_{e q}} \\tag{5.68}\n\\end{equation*}\n$$\n\nIn a well-designed circuit, $R_{2}$ is typically around $10^{3} \\Omega$ while $R_{e q}$ ranges from $10^{5} \\sim 10^{6} \\Omega$, making $R_{2} \\ll R_{e q}$. Under these conditions, $A$ approximates the familiar expression from op amps,\n\n$$\n\\begin{equation*}\nA \\cong 1+\\frac{R_{2}}{R_{1}} \\tag{5.69}\n\\end{equation*}\n$$\n\nThe distinctive benefits of CFAs over conventional op amps (also known as voltage-feedback amplifiers or VFAs) lie in their rapid dynamics. These advantages, not immediately evident from this discussion but arising from current-mode operation, will be explored in Chapter 6."
},
{
    "text": "Another significant use of the transconductor shown in Fig. 5.38 is as a foundational component for high-speed voltage-feedback amplifiers (VFAs). The VFA depicted in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-resistance input, and by adding a resistor $R$ between the outputs of the first buffer and this new buffer to create the control current previously identified as $i_{N}$. This current, assumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It incorporates multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is expressed as a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is delivered to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is then buffered to the output node, resulting in $v_{o}$, so the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nOnce again, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "Another crucial application of the transconductor in Fig. 5.38 is its use as a foundational element for high-speed voltage-feedback amplifiers (VFAs). The VFA depicted in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-resistance input. Additionally, a resistor $R$ is placed between the outputs of the first buffer and this new buffer to generate the control current previously identified as $i_{N}$. This current, which is assumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It includes multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is given by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is directed to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is then buffered to the output node, resulting in $v_{o}$. Consequently, the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nOnce again, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "Another crucial application of the transconductor in Fig. 5.38 is serving as a foundational component for high-speed voltage-feedback amplifiers (VFAs). The VFA depicted in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-resistance input, and by adding a resistor $R$ between the outputs of the initial buffer and this new buffer to create the control current previously identified as $i_{N}$. This current, presumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It includes multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is given by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is directed to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is subsequently buffered to the output node, resulting in $v_{o}$, thus the open-loop voltage gain of the resultant op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nAs before, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "Another crucial application of the transconductor shown in Fig. 5.38 is its use as a foundational component for high-speed voltage-feedback amplifiers (VFAs). The VFA depicted in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-resistance input. Additionally, a resistor $R$ is placed between the outputs of the first buffer and this new buffer to generate the control current previously labeled as $i_{N}$. This current, presumed to flow from left to right, is now\nimage_name: Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo: The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It includes multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is given by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is delivered to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is then buffered to the output node, resulting in $v_{o}$. Thus, the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nOnce again, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "A significant application of the transconductor shown in Fig. 5.38 is its use as a foundational component for high-speed voltage-feedback amplifiers (VFAs). The VFA depicted in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-impedance input. Additionally, a resistor $R$ is placed between the outputs of the first buffer and this new buffer to produce the control current previously identified as $i_{N}$. This current, assumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It includes multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is given by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is delivered to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is then buffered to the output node, resulting in $v_{o}$. Thus, the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nAs always, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "A significant use of the transconductor depicted in Fig. 5.38 is its role as a foundational component for high-speed voltage-feedback amplifiers (VFAs). The VFA illustrated in Fig. 5.41 is derived from the CFA shown in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-resistance input. Additionally, a resistor $R$ is placed between the outputs of the first buffer and this new buffer to produce the control current previously identified as $i_{N}$. This current, presumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It includes multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is given by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is transmitted to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is then buffered to the output node, resulting in $v_{o}$, so the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nAs before, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "A significant application of the transconductor in Fig. 5.38 is its role as a foundational element for high-speed voltage-feedback amplifiers (VFAs). The VFA depicted in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-impedance input, and by adding a resistor $R$ between the outputs of the initial buffer and this new buffer to produce the control current previously labeled as $i_{N}$. This current, assumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It includes multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is given by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is delivered to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is subsequently buffered to the output node, resulting in $v_{o}$, thus the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nAs usual, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "Another crucial application of the transconductor depicted in Fig. 5.38 is its use as a foundational component for high-speed voltage-feedback amplifiers (VFAs). The VFA shown in Fig. 5.41 is derived from the CFA in Fig. 5.39 by incorporating a third voltage buffer $\\left(Q_{15}{ }^{-} Q_{16^{-}} Q_{17}{ }^{-} Q_{18}\\right)$ to transform node $v_{N}$ into a high-resistance input. Additionally, a resistor $R$ is placed between the outputs of the first buffer and this new buffer to create the control current previously identified as $i_{N}$. This current, presumed to flow from left to right, is now\nimage_name:Figure 5.41 CFA-derived VFA\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: Q3-Q4, E: Q2-Q16}\nname: Q2, type: NPN, ports: {C: Q1-Q15, B: Q3-Q4, E: Q10}\nname: Q3, type: NPN, ports: {C: Q1-Q15, B: VP, E: Q2-Q16}\nname: Q4, type: NPN, ports: {C: VP, B: VCC, E: Q3-Q4}\nname: Q5, type: NPN, ports: {C: VCC, B: Q1-Q15, E: Q3-Q4}\nname: Q6, type: NPN, ports: {C: VCC, B: Q7-Q14, E: Q13}\nname: Q7, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q8, type: NPN, ports: {C: Q7-Q14, B: Q9, E: Q12}\nname: Q9, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VEE}\nname: Q10, type: NPN, ports: {C: Q2-Q16, B: Q3-Q4, E: VEE}\nname: Q11, type: NPN, ports: {C: VCC, B: Q7-Q14, E: VO}\nname: Q12, type: NPN, ports: {C: Q8, B: Q7-Q14, E: VO}\nname: Q13, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: VO}\nname: Q14, type: NPN, ports: {C: Q6-Q11, B: Q7-Q14, E: Q8}\nname: Q15, type: NPN, ports: {C: Q1-Q15, B: Q16, E: R}\nname: Q16, type: NPN, ports: {C: Q2-Q16, B: Q15, E: R}\nname: Q17, type: NPN, ports: {C: Q18, B: Q15, E: VCC}\nname: Q18, type: NPN, ports: {C: Q17, B: C, E: VN}\nname: I3, type: CurrentSource, ports: {Np: VCC, Nn: Q5}\nname: I4, type: CurrentSource, ports: {Np: VP, Nn: Q10}\nname: I13, type: CurrentSource, ports: {Np: VCC, Nn: Q11}\nname: I14, type: CurrentSource, ports: {Np: Q8, Nn: Q9}\nname: I17, type: CurrentSource, ports: {Np: VCC, Nn: Q17}\nname: I18, type: CurrentSource, ports: {Np: VCC, Nn: Q8}\nname: R, type: Resistor, value: R, ports: {N1: Q15, N2: Q16}\n]\nextrainfo:The circuit is a CFA-derived VFA amplifier designed for high-speed voltage feedback applications. It incorporates multiple NPN transistors and current sources to achieve high open-loop voltage gain. The voltage gain is defined by a = Req/R, where Req is the equivalent resistance at node C.\n\nFIGURE 5.41 CFA-derived VFA.\n$\\left(v_{P}-v_{N}\\right) / R$, and is directed to node $C$, where it generates the voltage $R_{e q}\\left(v_{P}-v_{N}\\right) / R$. This voltage is then buffered to the output node, resulting in $v_{o}$. Consequently, the open-loop voltage gain of the resulting op amp is\n\n$$\n\\begin{equation*}\na=\\frac{v_{O}}{v_{P}-v_{N}}=\\frac{R_{e q}}{R} \\tag{5.70}\n\\end{equation*}\n$$\n\nAs always, a well-designed circuit ensures $a \\gg 1$. Due to its inherently rapid current-mode operation, this type of op amp is particularly well-suited for high-speed applications."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), the pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It utilizes multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ represents the current provided by the user to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ against the difference $v_{P}-v_{N}$ produces the familiar $s$-shaped curve seen in Fig. 4.44. This curve is nonlinear, but if the input voltage is confined within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term of the series expansion $\\tanh x=x-x^{3}/3+\\cdots$ and write\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nWe make several important observations:\n\n- In small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in wide-dynamic range applications like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit is a differential pair with a current source bias. It employs NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2. The output is taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are used for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a $\\pm 10-\\mathrm{V}$ triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a $\\pm 10-\\mathrm{V}$ triangular signal to an input difference $v_{B 1}-v_{B 2}$ of about $\\pm 44-\\mathrm{mV}$. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays a time-domain waveform comparison of two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the diode-connected BJT pair's function, which modifies the input peaks to produce the desired undistorted current waveform.\n\nOverall, the graph illustrates the effect of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis denotes time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features of the waveform include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as seen by comparing the solid trace to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto modify the input peaks from about $\\pm 44 \\mathrm{mV}$ to about $\\pm 60 \\mathrm{mV}$, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential-type inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), this pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It utilizes multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ represents the current provided by the user to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ against the difference $v_{P}-v_{N}$ forms the familiar $s$-shaped curve seen in Fig. 4.44. This curve is nonlinear, but if the input voltage is confined within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term in the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, enabling us to write\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- In small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in wide-dynamic range applications like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit features a differential pair with a current source bias. It employs NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2, and the output is taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are used for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a 10-V triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a 10-V triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around 44 mV. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 show both the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the function of the diode-connected BJT pair, which modifies the input peaks to produce the desired undistorted current waveform.\n\nOverall, the graph illustrates the effect of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis denotes time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA), with a range from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features of the waveform include:\n- Periodicity with a period of 1 ms.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as evidenced by the solid trace compared to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about 44 mV to about 60 mV, which are the values needed for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential-type inputs. In the commonly used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), the pair is biased using the high output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the current provided by the user to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ versus the difference $v_{P}-v_{N}$ forms the familiar $s$-shaped curve seen in Fig. 4.44. This curve is nonlinear, but if we limit the input voltage to the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term of the series expansion $\\tanh x=x-x^{3}/3+\\cdots$ and express\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- In small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in wide-dynamic range applications like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit is a differential pair with a current source bias. It utilizes NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2. The output is taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are employed for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a $\\pm 10-\\mathrm{V}$ triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a $\\pm 10-\\mathrm{V}$ triangular signal to an input difference $v_{B 1}-v_{B 2}$ of about $\\pm 44-\\mathrm{mV}$. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 compares two voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph features two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace shows the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms are triangular, indicating periodic linear increases and decreases in voltage. Peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around 50 mV.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the function of the diode-connected BJT pair, which modifies the input peaks to produce the desired undistorted current waveform.\n\nOverall, the graph demonstrates the effect of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" depicts the current difference ($i_{C1} - i_{C2}$) over time. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, with linear segments and sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, indicating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as seen by comparing the solid trace to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about $\\pm 44 \\mathrm{mV}$ to about $\\pm 60 \\mathrm{mV}$, the values necessary for an undistorted current waveform."
},
{
    "text": "The adaptability of the transconductor can be significantly improved by configuring it to respond to differential inputs. In the well-known configuration shown in Fig. 5.42, referred to as the operational transconductance amplifier (OTA), this functionality is realized through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), this pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding diodes $D_{1}$ and $D_{2}$, we modify Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ represents the current provided by the user to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{o}$ against the difference $v_{P}-v_{N}$ yields the familiar $s$-shaped curve seen in Fig. 4.44. This curve is nonlinear, but if we confine the input voltage within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term in the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, enabling us to write\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- Under small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. Indeed, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits such as programmable amplifiers, programmable oscillators, and programmable filters, especially in wide-dynamic range applications like audio and electronic music.\n\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit is a differential pair with a current source bias. It utilizes NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2. The output is taken from the emitter node P.\n\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are employed for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a $\\pm 10-\\mathrm{V}$ triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may pose a limitation in certain scenarios. The impact of surpassing this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which employs input voltage dividers to scale a $\\pm 10-\\mathrm{V}$ triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around $\\pm 44-\\mathrm{mV}$. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\n\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the function of the diode-connected BJT pair, which modifies the input peaks to achieve the desired undistorted current waveform.\n\nOverall, the graph illustrates the impact of predistortion on the voltage waveform to compensate for distortions in the output current, as intended by the circuit design in Figure 5.43b.\n\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis shows time in milliseconds (ms) ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as seen by comparing the solid trace to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about $\\pm 44 \\mathrm{mV}$ to about $\\pm 60 \\mathrm{mV}$, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly enhanced by configuring it to respond to differential-type inputs. In the widely used configuration depicted in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), the pair is biased using the high output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, with the output taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the current provided by the user to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ versus the difference $v_{P}-v_{N}$ forms the familiar $s$-shaped curve seen in Fig. 4.44. This curve is nonlinear, but if the input voltage is confined within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term of the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, resulting in\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- In small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. Indeed, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in applications requiring wide dynamic ranges like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit features a differential pair with a current source bias. It utilizes NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2, with the output taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are employed for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a 10-V triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a 10-V triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around 44 mV. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, while the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace appears slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the function of the diode-connected BJT pair, which modifies the input peaks to produce the desired undistorted current waveform.\n\nOverall, the graph illustrates the impact of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis denotes time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively showcases the improvement in waveform linearity through predistortion, as evidenced by the solid trace compared to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto modify the input peaks from about 44 mV to about 60 mV, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential-type inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), this pair is biased using the high output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the current provided by the user to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ versus the difference $v_{P}-v_{N}$ forms the familiar $s$-shaped curve seen in Fig. 4.44. This curve is nonlinear, but if we limit the input voltage to the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term in the series expansion $\\tanh x=x-x^{3}/3+\\cdots$ and write\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- In small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. Indeed, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs highly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, particularly in wide-dynamic range applications like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit is a differential pair with a current source bias. It uses NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2. The output is taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are used for predistortion to improve linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a 10-V triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a 10-V triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around 44 mV. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 show both the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the diode-connected BJT pair's function, which modifies the input peaks to achieve the desired undistorted current waveform.\n\nOverall, the graph illustrates the impact of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot showing the difference in current ($i_{C1} - i_{C2}$) over time. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis depicts the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively shows the improvement in waveform linearity through predistortion, as evidenced by the solid trace compared to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto modify the input peaks from about 44 mV to about 60 mV, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly enhanced by configuring it to respond to differential inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), the pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, with the output taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the user-supplied bias current for the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ versus the difference $v_{P}-v_{N}$ yields the familiar $s$-shaped curve of Fig. 4.44. This curve is nonlinear, but if the input voltage is confined within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term of the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, leading to\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- Under small-signal conditions, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for various programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in wide-dynamic range applications like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit is a differential pair with a current source bias. It utilizes NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2, with the output taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are employed for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a 10-V triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a 10-V triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around 44 mV. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. Peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the diode-connected BJT pair's function, which modifies the input peaks to produce the desired undistorted current waveform.\n\nOverall, the graph illustrates the effect of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" in Figure 5.44 shows time-domain waveforms of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis denotes the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as seen by comparing the solid trace to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about 44 mV to about 60 mV, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential inputs. In the widely used configuration depicted in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is realized through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), the pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we modify Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, with the output taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the user-supplied current used to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ against the difference $v_{P}-v_{N}$ yields the familiar $s$-shaped curve of Fig. 4.44. This curve is nonlinear, but if we confine the input voltage within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term in the series expansion $\\tanh x=x-x^{3}/3+\\cdots$ and write\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- In small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in applications requiring wide dynamic ranges like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit features a differential pair with a current source bias. It utilizes NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2, with the output taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are used for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a 10-V triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in some applications. The impact of exceeding this constraint is demonstrated using the PSpice circuit in Fig. 5.43a, which employs input voltage dividers to scale a 10-V triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around 44 mV. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, illustrated in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 compares two voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace shows the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms display a triangular shape, indicating periodic linear increases and decreases in voltage. Peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the diode-connected BJT pair's function to modify the input peaks for an undistorted current waveform.\n\nOverall, the graph demonstrates the effect of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" in Figure 5.44 shows the current difference ($i_{C1} - i_{C2}$) over time. The x-axis represents time in milliseconds (ms) ranging from 0 to 2 ms, while the y-axis displays the current difference in milliamperes (mA) from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, featuring linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, indicating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA.\n- Valleys at approximately 0 mA.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as seen by comparing the solid trace to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about 44 mV to about 60 mV, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this functionality is achieved through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), this pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we modify Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It utilizes multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the user-supplied current biasing the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ versus the difference $v_{P}-v_{N}$ yields the familiar $s$-shaped curve of Fig. 4.44. This curve is nonlinear, but if the input voltage is confined within the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately 100 mV), the small-signal approximation allows us to retain only the first term of the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, leading to\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- Under small-signal conditions, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for various programmable circuits such as programmable amplifiers, oscillators, and filters, especially in wide-dynamic-range applications like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit features a differential pair biased by a current source. It employs NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2, and the output is taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are used for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a 10-V triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may pose a limitation in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a 10-V triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around 44 mV. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately 100 mV), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. Peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the diode-connected BJT pair's function, which modifies the input peaks to achieve the desired undistorted current waveform.\n\nOverall, the graph illustrates the impact of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis denotes time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, indicating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively demonstrates the improvement in waveform linearity through predistortion, as seen by comparing the solid trace to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto modify the input peaks from about 44 mV to about 60 mV, the values necessary for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly enhanced by configuring it to respond to differential-type inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this feature is realized through the differential pair $Q_{1}-Q_{2}$. To ensure a high common-mode rejection ratio (CMRR), the pair is biased using the high output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current from $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current conveyed by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the user-supplied current used to bias the $Q_{1}-Q_{2}$ pair. The plot of $i_{o}$ versus the difference $v_{P}-v_{N}$ results in the familiar $s$-shaped curve seen in Fig. 4.44. This curve is inherently nonlinear, but by limiting the input voltage to the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately $100 \\mathrm{mV}$), the small-signal approximation allows us to retain only the first term in the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, enabling us to write\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral important observations can be made:\n\n- Under small-signal operation, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. In fact, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs particularly suitable for a variety of programmable circuits, such as programmable amplifiers, oscillators, and filters, especially in applications requiring wide dynamic ranges like audio and electronic music.\n\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit is a differential pair with a current source bias. It uses NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2. The output is taken from the emitter node P.\n\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are used for predistortion to improve linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a $\\pm 10-\\mathrm{V}$ triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be a limitation in certain applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a $\\pm 10-\\mathrm{V}$ triangular signal to an input difference $v_{B 1}-v_{B 2}$ of approximately $\\pm 44-\\mathrm{mV}$. Since 44 mV is not significantly smaller than $4 V_{T}$ (about $100 \\mathrm{mV}$), the resulting current difference $i_{C 1}-i_{C 2}$ is visibly distorted. (The shaded waveforms in Fig. 5.44 show both the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is achieved using the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\n\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 is a time-domain waveform comparison of two different voltage waveforms over a period of 2 milliseconds. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis represents the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph displays two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, while the solid trace represents the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks of the waveforms occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with the voltage reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly noticeable at the peaks, where the voltage values extend to about 60 mV. This stretching aligns with the described function of the diode-connected BJT pair, which modifies the input peaks to achieve the desired undistorted current waveform.\n\nOverall, the graph illustrates the effect of predistortion on the voltage waveform to compensate for distortions in the output current, as intended by the circuit design in Figure 5.43b.\n\nimage_name:(b)\ndescription:The graph labeled \"(b)\" is a time-domain waveform plot depicting the difference in current ($i_{C1} - i_{C2}$) over time. The x-axis represents time in milliseconds (ms) ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA) with a range from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks occurring approximately at 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nThere are two traces on the graph: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, indicating the effectiveness of the predistortion in achieving a more linear current waveform.\n\nKey features of the waveform include:\n- Periodicity with a period of 1 ms.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through the predistortion technique, as seen by the solid trace compared to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about $\\pm 44 \\mathrm{mV}$ to about $\\pm 60 \\mathrm{mV}$, which are the values needed for an undistorted current waveform."
},
{
    "text": "The versatility of the transconductor can be significantly improved by configuring it to respond to differential inputs. In the widely used configuration shown in Fig. 5.42, known as the operational transconductance amplifier (OTA), this capability is realized through the differential pair $Q_{1}-Q_{2}$. To achieve a high common-mode rejection ratio (CMRR), this pair is biased using the high-output-resistance Wilson mirror $Q_{3}-Q_{4}-Q_{5}$. The current of $Q_{2}$ is replicated and directed to the output node by the Wilson mirror $Q_{9}-Q_{10}-Q_{11}$, while $Q_{1}$'s current is first mirrored by $Q_{6}-Q_{7}-Q_{8}$ and then conveyed to the output node by the mirror $Q_{12}-Q_{13}-Q_{14}$, where it is subtracted from the current delivered by $Q_{9}-Q_{10}-Q_{11}$. Temporarily disregarding the diodes $D_{1}$ and $D_{2}$, we adapt Eq. (4.73) to express\n\n$$\n\\begin{equation*}\ni_{o}=i_{C 11}-i_{C 12}=i_{C 2}-i_{C 1}=I \\times \\tanh \\left(\\frac{v_{P}-v_{N}}{2 V_{T}}\\right) \\tag{5.71}\n\\end{equation*}\n$$\n\nimage_name:FIGURE 5.42 Operational transconductance amplifier (OTA)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: Q3_B, B: vN, E: Q3_C}\nname: Q2, type: NPN, ports: {C: Q3_B, B: vP, E: Q3_C}\nname: Q3, type: PNP, ports: {C: Q4_C, B: Q1_C, E: Q5_C}\nname: Q4, type: NPN, ports: {C: Q3_C, B: Q5_C, E: VEE}\nname: Q5, type: NPN, ports: {C: Q3_E, B: Q4_C, E: VEE}\nname: Q6, type: PNP, ports: {C: VCC, B: Q8_B, E: Q7_C}\nname: Q7, type: PNP, ports: {C: Q6_E, B: Q8_B, E: Q8_C}\nname: Q8, type: NPN, ports: {C: Q7_E, B: Q6_B, E: Q3_B}\nname: Q9, type: PNP, ports: {C: VCC, B: Q11_B, E: Q10_C}\nname: Q10, type: PNP, ports: {C: Q9_E, B: Q11_B, E: Q11_C}\nname: Q11, type: NPN, ports: {C: Q10_E, B: Q9_B, E: io}\nname: Q12, type: PNP, ports: {C: VCC, B: Q14_B, E: Q13_C}\nname: Q13, type: NPN, ports: {C: Q12_E, B: Q14_B, E: VEE}\nname: Q14, type: NPN, ports: {C: Q13_E, B: Q12_B, E: io}\nname: D1, type: Diode, ports: {Na: vN, Nc: VA}\nname: D2, type: Diode, ports: {Na: VA, Nc: vP}\n]\nextrainfo:This circuit is an Operational Transconductance Amplifier (OTA). It employs multiple NPN and PNP transistors to form a differential amplifier with current mirrors. The input differential pair consists of Q1 and Q2, and the output is taken at node io. Diodes D1 and D2 are connected between the input nodes vN and vP, and VA. The circuit is powered by VCC and VEE.\n\nFIGURE 5.42 Operational transconductance amplifier (OTA).\nwhere $I$ is the user-supplied current biasing the $Q_{1}-Q_{2}$ pair. The plot of $i_{0}$ versus the difference $v_{P}-v_{N}$ forms the familiar $s$-shaped curve seen in Fig. 4.44. This curve is inherently nonlinear, but by limiting the input voltage to the range $\\left|v_{P}-v_{N}\\right| \\ll 4 V_{T}$ (approximately $100 \\mathrm{mV}$), the small-signal approximation allows us to retain only the first term of the series expansion $\\tanh x=x-x^{3}/3+\\cdots$, leading to\n\n$$\n\\begin{equation*}\ni_{o}=\\frac{I}{2 V_{T}}\\left(v_{p}-v_{n}\\right) \\tag{5.72}\n\\end{equation*}\n$$\n\nSeveral key observations can be made:\n\n- Under small-signal conditions, the transconductance gain\n\n$$\n\\begin{equation*}\nG_{m}=\\frac{i_{o}}{v_{p}-v_{n}}=\\frac{I}{2 V_{T}} \\tag{5.73}\n\\end{equation*}\n$$\n\nis directly proportional to the bias current $I$, allowing it to be externally programmed by the user. Indeed, bipolar junction transistors (BJTs) can easily accommodate current ranges spanning more than five decades (>100 dB), making OTAs highly suitable for various programmable circuits such as programmable amplifiers, oscillators, and filters, particularly in applications requiring wide dynamic ranges like audio and electronic music.\nimage_name:(a)\ndescription:\n[\nname: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: GND}\nname: R1, type: Resistor, value: 10k, ports: {N1: V1, N2: vB1}\nname: R2, type: Resistor, value: 44, ports: {N1: vB1, N2: GND}\nname: Q1, type: NPN, ports: {C: VCC, B: vB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: vB2, E: P}\nname: R3, type: Resistor, value: 10k, ports: {N1: vB2, N2: GND}\nname: R4, type: Resistor, value: 44, ports: {N1: vB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: GND}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: GND, Nn: VEE}\n]\nextrainfo:The circuit features a differential pair biased by a current source. It utilizes NPN transistors Q1 and Q2, with resistors R1 and R2 setting the base voltage for Q1, and R3 and R4 setting the base voltage for Q2. The circuit is powered by VCC and VEE, providing a total voltage swing of 30V. The input is a differential signal applied across vB1 and vB2, and the output is taken from the emitter node P.\nimage_name:(b)\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: VB1, E: P}\nname: Q2, type: NPN, ports: {C: VCC, B: VB2, E: P}\nname: R1, type: Resistor, value: 10k, ports: {N1: VI, N2: VB1}\nname: R2, type: Resistor, value: 0.5k, ports: {N1: VB1, N2: GND}\nname: R3, type: Resistor, value: 10k, ports: {N1: VB2, N2: GND}\nname: R4, type: Resistor, value: 0.5k, ports: {N1: VB2, N2: GND}\nname: I, type: CurrentSource, value: 1mA, ports: {Np: P, Nn: VEE}\nname: VCC, type: VoltageSource, value: 15V, ports: {Np: VCC, Nn: GND}\nname: VEE, type: VoltageSource, value: -15V, ports: {Np: VEE, Nn: GND}\nname: D1, type: NPN, ports: {C: A, B: VB1, E: P}\nname: D2, type: NPN, ports: {C: A, B: VB2, E: P}\nname: RA, type: Resistor, value: 13k, ports: {N1: VCC, N2: A}\n]\nextrainfo:The circuit in diagram (b) is a differential amplifier with a predistorting input diode network. It is designed to handle a 10V triangular input signal. The diodes D1 and D2 are employed for predistortion to enhance linearity.\n\nFIGURE 5.43 PSpice circuits to investigate distortion in a differential pair configured for a $\\pm 10-\\mathrm{V}$ triangular input: (a) without and (b) with the predistorting input diode network.\n\n- The small-signal constraint may be limiting in some applications. The impact of exceeding this constraint is illustrated by the PSpice circuit in Fig. 5.43a, which uses input voltage dividers to scale a $\\pm 10-\\mathrm{V}$ triangular signal to an input difference $v_{B 1}-v_{B 2}$ of around $\\pm 44-\\mathrm{mV}$. Since 44 mV is not significantly smaller than $4 V_{T}$ (approximately $100 \\mathrm{mV}$), the resulting current difference $i_{C 1}-i_{C 2}$ exhibits noticeable distortion. (The shaded waveforms in Fig. 5.44 depict the undistorted input voltage and the distorted output current.)\n- To achieve an undistorted current waveform, the input voltage must be predistorted according to the inverse of the hyperbolic tangent function. An approximation of this function is realized through the diode-connected BJT pair $D_{1}-D_{2}$ in Fig. 5.43b. Its effect, shown in Fig. 5.44 by the solid traces, is\nimage_name:(a)\ndescription:The graph labeled \"(a)\" in Figure 5.44 displays time-domain waveforms comparing two different voltage waveforms over a 2-millisecond period. The x-axis represents time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis shows the voltage difference $v_{B1} - v_{B2}$ in millivolts (mV), ranging from -50 mV to 50 mV.\n\nThe graph includes two waveforms: a shaded trace and a solid trace. The shaded trace represents the undistorted input voltage, whereas the solid trace depicts the predistorted voltage after processing by a diode-connected BJT pair to achieve an undistorted current waveform.\n\nBoth waveforms exhibit a triangular shape, indicating periodic linear increases and decreases in voltage. The peaks occur at approximately 0.5 ms, 1.0 ms, and 1.5 ms, with voltages reaching around +50 mV and -50 mV at these points.\n\nThe solid trace is slightly stretched compared to the shaded trace, particularly at the peaks, where the voltage extends to about 60 mV. This stretching aligns with the function of the diode-connected BJT pair, which modifies the input peaks to produce the desired undistorted current waveform.\n\nOverall, the graph illustrates the effect of predistortion on the voltage waveform to compensate for output current distortions, as intended by the circuit design in Figure 5.43b.\nimage_name:(b)\ndescription:The graph labeled \"(b)\" presents a time-domain waveform plot of the current difference ($i_{C1} - i_{C2}$) over time. The x-axis denotes time in milliseconds (ms), ranging from 0 to 2 ms, while the y-axis represents the current difference in milliamperes (mA), ranging from -1 to 1 mA.\n\nThe waveform is a distorted triangular shape, characterized by linear segments with sharp peaks and valleys. The general trend shows periodic oscillations, with peaks at approximately 0.5 ms and 1.5 ms and valleys at 1.0 ms and 2.0 ms, indicating a repeating cycle every 1 ms.\n\nTwo traces are present: a shaded trace and a solid trace. The shaded trace represents the distorted output current waveform from the circuit in Fig. 5.43a, while the solid trace shows the waveform after predistortion applied by the diode-connected BJT pair in Fig. 5.43b. The solid trace is less distorted, demonstrating the effectiveness of predistortion in achieving a more linear current waveform.\n\nKey features of the waveform include:\n- Periodicity with a 1-ms period.\n- Peaks at approximately 1 mA, occurring at 0.5 ms and 1.5 ms.\n- Valleys at approximately 0 mA, occurring at 1.0 ms and 2.0 ms.\n\nThe graph effectively illustrates the improvement in waveform linearity through predistortion, as evidenced by the solid trace compared to the shaded trace.\n\nFIGURE 5.44 Waveforms for the PSpice circuits of Fig. 5.43 (the shaded traces pertain to the circuit of Fig. 5.43a, the solid traces to that of Fig. 5.43b.)\nto stretch the input peaks in an approximately inverse hyperbolic-tangent manner from about $\\pm 44 \\mathrm{mV}$ to about $\\pm 60 \\mathrm{mV}$, which are the values required for an undistorted current waveform."
},
{
    "text": "The OTA depicted in Fig. 5.42 is termed an analog multiplier because, according to Eq. (5.72), $i_{o}$ is proportional to the product $I \\times (v_{p} - v_{n})$. While the difference $v_{p} - v_{n}$ can adopt either polarity, the current $I$ must always exit the differential pair (I  0), thus categorizing the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is achieved using the current-mode circuit shown in Fig. 5.45. This circuit, popularly known as the Gilbert Cell after its inventor, Barrie Gilbert, is an elegant current-mode design comprising (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in opposing phases, causing their output currents to subtract pairwise, and (b) a third EC pair, $Q_{5}-Q_{6}$, designed to direct the bias current $I$ to the two differential pairs in proportions controlled by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate the other, enabling the output current difference $i_{O1} - i_{O2}$ to attain either polarity, thus facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and input voltages, we apply KCL to express:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\n[Image Description: Figure 5.45 illustrates the Gilbert Cell, featuring NPN transistors Q1-Q6. Q1 has ports C: VCC, B: X1, E: VX-; Q2 has ports C: X1, B: VX-, E: VY+; Q3 has ports C: VK-, B: X2, E: VY+; Q4 has ports C: VCC, B: VK+, E: X2; Q5 and Q6 both have ports C: VY+, B: VY-, E: P. A current source I with value I has ports Np: P, Nn: VEE. This circuit is a four-quadrant multiplier utilizing differential pairs of NPN transistors to multiply input signals, with the output current difference controlled by voltages VX and VY.]\n\nFIGURE 5.45 The Gilbert Cell.\n\nAssuming negligible base currents, we adapt Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nThus,\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three categories of applications for this cell:\n\n- Both inputs are small-signal types, i.e., $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\approx x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\approx I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell functions as a true four-quadrant multiplier.\n\n- One input ($v_{x}$) is a small-signal continuous wave, such as a sine wave, while the other input ($v_{Y}$) is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, Q6 is off, and Q5 directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, Q5 is off, and Q6 directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is used in communications as a modulator/detector.\n\n- Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ have the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas when $v_{X}$ and $v_{Y}$ have opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This function resembles the exclusive-or function in digital circuits and is used as a phase detector in phase-locked loop systems.\n\nAs with OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating provisions to handle larger input magnitudes while ensuring accurate multiplication. Figure 5.46 presents a popular Gilbert Cell application that meets these requirements. Observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range by the desired amount. Ignoring base currents, we apply KCL, Ohm's law, and KVL to write:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} &= \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n&= \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nRegrouping and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we get:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\n[Image Description: Figure 5.46 depicts a four-quadrant analog multiplier. It includes NPN transistors Q1-Q10, resistors R and RX, RY, and current sources IX and IY. Q1 has ports C: vO1, B: vX-, E: X1; Q2 has ports C: vO1, B: vX-, E: X1; Q3 has ports C: vO2, B: vX+, E: X2; Q4 has ports C: vO2, B: vX+, E: X2; Q5 has ports C: vX+, B: vY1, E: P3; Q6 has ports C: vX+, B: vY2, E: P4; Q7 has ports C: vX-, B: vX1, E: P1; Q8 has ports C: vX-, B: vX2, E: P2; Q9 has ports C: VA, B: vX-, E: VK-; Q10 has ports C: VA, B: vX+, E: VK-. Resistors R are connected between VCC and vO1, vO2; RX is between P1 and P2; RY is between P3 and P4. Current sources IX and IY have ports Np: P1, Nn: VEE and Np: P3, Nn: VEE, respectively. This circuit uses NPN transistor pairs for voltage-to-current conversions, with emitter degeneration resistors RY and RX for Q5-Q6 and Q7-Q8 pairs, respectively.]\n\nFIGURE 5.46 Four-quadrant analog multiplier.\n\nIn a well-designed circuit, the last numerator term is negligible (see Problem 5.39), so we approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, giving $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / \\left(0.5 R_{X}\\right)$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} &= v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n&= V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}{1 - \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}\n$$\n\nUsing the identity $\\ln \\left[(1 + x) / (1 - x)\\right] = 2 \\tan^{-1} x$, valid for $|x| < 1$, we have:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) yields:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)\\right]}{2 V_{T}}\n$$\n\nthus,\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / \\left(2 R_{X}\\right)$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in $\\tanh^{-1}$ fashion to generate a predistorted signal $v_{x}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in tanh fashion to produce an overall undistorted output. This output is, in turn, modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In the configuration of Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistances $R$, resulting in the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is desired, the I-V conversion can be implemented via an op amp configured as a differential amplifier. Alternatively, if a single-ended current output is needed, three Wilson current mirrors can be used, as in the OTA of Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is termed an analog multiplier because Eq. (5.72) indicates that $i_{o}$ is proportional to the product $I \\times (v_{p} - v_{n})$. While $v_{p} - v_{n}$ can adopt either polarity, the current $I$ must always exit the differential pair (with $I \\geq 0$), thus classifying the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is achieved using the current-mode circuit shown in Fig. 5.45. This circuit, popularly known as the Gilbert Cell after its inventor, Barrie Gilbert, is an elegant current-mode design comprising: (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in phase opposition, causing their output currents to subtract pairwise, and (b) a third EC pair, $Q_{5}-Q_{6}$, designed to steer the bias current $I$ to the two differential pairs in proportions dictated by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate the other, enabling the output current difference $i_{O1} - i_{O2}$ to attain either polarity, thus facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and input voltages, we apply KCL to express:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\n[Image Description: Figure 5.45 illustrates the Gilbert Cell. It includes NPN transistors Q1, Q2, Q3, Q4, Q5, and Q6, with specified port connections. The circuit is a four-quadrant multiplier using differential pairs of NPN transistors to multiply input signals, with the output current difference controlled by voltages $v_{X}$ and $v_{Y}$.]\n\nAssuming negligible base currents, we adapt Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nThus,\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three application categories for the cell:\n\n1. Both inputs are small-signal types, where $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\cong x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\cong I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell functions as a true four-quadrant multiplier.\n\n2. One input ($v_{x}$) is a small-signal continuous wave, such as a sine wave, while the other input ($v_{Y}$) is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off, and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off, and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is used in communications as a modulator/detector.\n\n3. Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ share the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas with opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This function resembles the exclusive-or operation in digital circuits and is utilized as a phase detector in phase-locked loop systems.\n\nAs with OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating provisions to handle larger input magnitudes while ensuring accurate multiplication. Figure 5.46 presents a popular Gilbert Cell application addressing these requirements. Key observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range. Ignoring base currents and applying KCL, Ohm's law, and KVL, we derive:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} &= \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n&= \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nRegrouping and using $v_{BE} = V_{T} \\ln (i_{C} / I_{s})$, we obtain:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln (i_{C5} / i_{C6})}{0.5 R_{Y}}\n$$\n\n[Image Description: Figure 5.46 shows a four-quadrant analog multiplier. It includes NPN transistors Q1, Q2, Q3, Q4, Q5, Q6, Q7, Q8, Q9, and Q10, with specified port connections and resistors R, RX, and RY, along with current sources IX and IY. The circuit uses NPN transistor pairs for voltage-to-current conversions, with emitter degeneration resistors RX and RY. The output currents iO1 and iO2 are derived from voltage differences across these pairs.]\n\nIn a well-designed circuit, the last numerator term is negligible (as detailed in Problem 5.39), allowing us to approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, yielding $i_{C7} - i_{C8} = (v_{X1} - v_{X2}) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln (i_{C} / I_{s})$, we have:\n\n$$\n\\begin{aligned}\nv_{X} &= v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n&= V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + (v_{X1} - v_{X2}) / R_{X}$ and $i_{C8} = I_{X} - (v_{X1} - v_{X2}) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + (v_{X1} - v_{X2}) / R_{X}}{I_{X} - (v_{X1} - v_{X2}) / R_{X}} = V_{T} \\ln \\frac{1 + (v_{X1} - v_{X2}) / (R_{X} I_{X})}{1 - (v_{X1} - v_{X2}) / (R_{X} I_{X})}\n$$\n\nUsing the identity $\\ln [(1 + x) / (1 - x)] = 2 \\tan^{-1} x$, valid for $|x| < 1$, we get:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) results in:\n\n$$\ni_{O1} - i_{O2} = (i_{C5} - i_{C6}) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} [(v_{X1} - v_{X2}) / (R_{X} I_{X})]}{2 V_{T}}\n$$\n\nThus,\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $(v_{X1} - v_{X2}) / (2 R_{X})$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in a $\\tanh^{-1}$ manner to generate a predistorted signal $v_{x}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in a tanh manner to produce an overall undistorted output. This output is subsequently modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistors $R$, yielding the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R (i_{O1} - i_{O2}) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times (v_{X1} - v_{X2}) \\times (v_{Y1} - v_{Y2}) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is desired, the I-V conversion can be implemented using an op amp configured as a differential amplifier. Alternatively, for a single-ended current output, three Wilson current mirrors can be employed, as in the OTA of Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is termed an analog multiplier because Eq. (5.72) indicates that $i_{o}$ is proportional to the product $I \\times (v_{p} - v_{n})$. Although the difference $v_{p} - v_{n}$ can adopt either polarity, the current $I$ must always exit the differential pair (with $I \\geq 0$), classifying the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is realized using the current-mode circuit shown in Fig. 5.45. This circuit, famously known as the Gilbert Cell after its inventor Barrie Gilbert, is an elegant current-mode design comprising: (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in phase opposition, causing their output currents to subtract pairwise, and (b) a third EC pair $(Q_{5}-Q_{6})$ that directs the bias current $I$ to the two differential pairs in proportions governed by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, one pair's output will dominate, enabling the output current difference $i_{O1} - i_{O2}$ to attain either polarity, thus facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and input voltages, we apply KCL to express:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\nimage_name: Figure 5.45 The Gilbert Cell\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: X1, E: VX-}\nname: Q2, type: NPN, ports: {C: X1, B: VX-, E: VY+}\nname: Q3, type: NPN, ports: {C: VK-, B: X2, E: VY+}\nname: Q4, type: NPN, ports: {C: VCC, B: VK+, E: X2}\nname: Q5, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: Q6, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\n]\nextrainfo: The circuit is a Gilbert Cell, a type of four-quadrant multiplier. It utilizes differential pairs of NPN transistors to achieve multiplication of input signals. The output current difference is controlled by the voltage inputs VX and VY.\n\nFIGURE 5.45 The Gilbert Cell.\n\nAssuming negligible base currents, we modify Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three categories of applications for this cell:\n\n- Both inputs are small-signal types, where $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\approx x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\approx I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell functions as a true four-quadrant multiplier.\n\n- One input $(v_{x})$ is a small-signal continuous wave, such as a sine wave, while the other input $(v_{Y})$ is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off, and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off, and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is used in communications as a modulator/detector.\n\n- Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ have the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas with opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This function resembles the exclusive-or operation in digital circuits and is utilized as a phase detector in phase-locked loop systems.\n\nSimilar to OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating provisions for larger input magnitudes while ensuring accurate multiplication. Fig. 5.46 illustrates a popular Gilbert Cell application addressing these requirements. Observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range. Ignoring base currents, we apply KCL, Ohm's law, and KVL to derive:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} & = \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n& = \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nRegrouping and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we obtain:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\nimage_name: Figure 5.46 Four-quadrant analog multiplier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q2, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q3, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q4, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q5, type: NPN, ports: {C: vX+, B: vY1, E: P3}\nname: Q6, type: NPN, ports: {C: vX+, B: vY2, E: P4}\nname: Q7, type: NPN, ports: {C: vX-, B: vX1, E: P1}\nname: Q8, type: NPN, ports: {C: vX-, B: vX2, E: P2}\nname: Q9, type: NPN, ports: {C: VA, B: vX-, E: VK-}\nname: Q10, type: NPN, ports: {C: VA, B: vX+, E: VK-}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO1}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO2}\nname: RX, type: Resistor, value: RX, ports: {N1: P1, N2: P2}\nname: RY, type: Resistor, value: RY, ports: {N1: P3, N2: P4}\nname: IX, type: CurrentSource, value: IX, ports: {Np: P1, Nn: VEE}\nname: IY, type: CurrentSource, value: IY, ports: {Np: P3, Nn: VEE}\n]\nextrainfo: The circuit is a four-quadrant analog multiplier. It uses pairs of NPN transistors to perform voltage-to-current conversions. The Q5-Q6 pair and Q7-Q8 pair are used for this purpose with emitter degeneration resistors RY and RX, respectively. The output currents iO1 and iO2 are derived from the voltage differences across these pairs.\n\nFIGURE 5.46 Four-quadrant analog multiplier.\n\nIn a well-designed circuit, the last numerator term is negligible (as per Problem 5.39), allowing us to approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, giving $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} & = v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n& = V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}{1 - \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}\n$$\n\nUsing the identity $\\ln [(1+x) / (1-x)] = 2 \\tan^{-1} x$, valid for $|x| < 1$, we get:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) yields:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)\\right]}{2 V_{T}}\n$$\n\nsimplifying to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / \\left(2 R_{X}\\right)$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in $\\tanh^{-1}$ fashion to generate a predistorted signal $v_{x}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in tanh fashion to produce an overall undistorted output. This output is subsequently modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistors $R$, resulting in the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is desired, the I-V conversion can be implemented using an op amp configured as a differential amplifier. Alternatively, for a single-ended current output, three Wilson current mirrors can be used, as in the OTA of Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is classified as an analog multiplier because, as per Eq. (5.72), $i_{o}$ is directly proportional to the product $I \\times (v_{p} - v_{n})$. While the difference $v_{p} - v_{n}$ can adopt either polarity, the current $I$ must consistently flow out of the differential pair (with $I \\geq 0$), thereby designating the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is achieved through the current-mode circuit illustrated in Fig. 5.45. This circuit, famously known as the Gilbert Cell after its inventor, Barrie Gilbert, ${ }^{8}$, is an exquisite current-mode configuration comprising: (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in opposing phases, causing their output currents to subtract pairwise, and (b) a third EC pair, $Q_{5}-Q_{6}$, designed to direct the bias current $I$ to the two differential pairs in proportions governed by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate over the other, enabling the output current difference $i_{O1} - i_{O2}$ to attain either polarity, thus facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and the input voltages, we apply KCL to express:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\nimage_name: Figure 5.45 The Gilbert Cell\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: X1, E: VX-}\nname: Q2, type: NPN, ports: {C: X1, B: VX-, E: VY+}\nname: Q3, type: NPN, ports: {C: VK-, B: X2, E: VY+}\nname: Q4, type: NPN, ports: {C: VCC, B: VK+, E: X2}\nname: Q5, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: Q6, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\n]\nextrainfo: The circuit is a Gilbert Cell, a type of four-quadrant multiplier. It utilizes differential pairs of NPN transistors to achieve multiplication of input signals. The output current difference is controlled by the voltage inputs VX and VY.\n\nFIGURE 5.45 The Gilbert Cell.\n\nAssuming negligible base currents, we adapt Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three primary application categories for the cell:\n\n- Both inputs are small-signal types, where $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\approx x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\approx I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell functions as a true four-quadrant multiplier.\n\n- One input ($v_{x}$) is a small-signal continuous wave, such as a sine wave, while the other input ($v_{Y}$) is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is utilized in communications as a modulator/detector.\n\n- Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ share the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas when $v_{X}$ and $v_{Y}$ have opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This function resembles the exclusive-or function in digital circuits. In this capacity, the cell serves as a phase detector in phase-locked loop systems.\n\nSimilar to OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating provisions to accommodate larger input magnitudes while ensuring accurate multiplication. Fig. 5.46 presents a popular Gilbert Cell application that meets these requirements. Key observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range by the desired amount. Ignoring base currents, we apply KCL, Ohm's law, and KVL to derive:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} & = \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n& = \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nRegrouping and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we obtain:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\nimage_name: Figure 5.46 Four-quadrant analog multiplier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q2, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q3, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q4, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q5, type: NPN, ports: {C: vX+, B: vY1, E: P3}\nname: Q6, type: NPN, ports: {C: vX+, B: vY2, E: P4}\nname: Q7, type: NPN, ports: {C: vX-, B: vX1, E: P1}\nname: Q8, type: NPN, ports: {C: vX-, B: vX2, E: P2}\nname: Q9, type: NPN, ports: {C: VA, B: vX-, E: VK-}\nname: Q10, type: NPN, ports: {C: VA, B: vX+, E: VK-}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO1}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO2}\nname: RX, type: Resistor, value: RX, ports: {N1: P1, N2: P2}\nname: RY, type: Resistor, value: RY, ports: {N1: P3, N2: P4}\nname: IX, type: CurrentSource, value: IX, ports: {Np: P1, Nn: VEE}\nname: IY, type: CurrentSource, value: IY, ports: {Np: P3, Nn: VEE}\n]\nextrainfo: The circuit is a four-quadrant analog multiplier. It uses pairs of NPN transistors to perform voltage-to-current conversions. The Q5-Q6 pair and Q7-Q8 pair are used for this purpose with emitter degeneration resistors RY and RX, respectively. The output currents iO1 and iO2 are derived from the voltage differences across these pairs.\n\nFIGURE 5.46 Four-quadrant analog multiplier.\n\nIn a well-designed circuit, the last numerator term is negligible (see Problem 5.39), allowing us to approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, giving $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} & = v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n& = V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}{1 - \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}\n$$\n\nUsing the identity $\\ln \\left[(1 + x) / (1 - x)\\right] = 2 \\tan^{-1} x$, which holds for $|x| < 1$, we get:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) yields:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)\\right]}{2 V_{T}}\n$$\n\nsimplifying to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / \\left(2 R_{X}\\right)$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in $\\tanh^{-1}$ fashion to generate a predistorted signal $v_{X}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in tanh fashion to produce an overall undistorted output. This output is, in turn, modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In the configuration of Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistances $R$, resulting in the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is desired, the I-V conversion can be implemented via an op amp configured as a differential amplifier. ${ }^{7}$ Alternatively, if a single-ended current output is needed, three Wilson current mirrors can be used in the manner of the OTA of Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is termed an analog multiplier because, as per Eq. (5.72), $i_{o}$ is directly proportional to the product $I \\times (v_{p} - v_{n})$. While the voltage difference $v_{p} - v_{n}$ can exhibit either polarity, the current $I$ must consistently flow out of the differential pair (with $I \\geq 0$), thus classifying the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is facilitated by the current-mode circuit shown in Fig. 5.45. This circuit, popularly known as the Gilbert Cell after its inventor, Barrie Gilbert, ${ }^{8}$, is an elegant current-mode design comprising: (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in opposing phases, causing their output currents to subtract pairwise, and (b) a third EC pair, $Q_{5}-Q_{6}$, designed to direct the bias current $I$ to the two differential pairs in proportions governed by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate the other, enabling the output current difference $i_{O1} - i_{O2}$ to adopt either polarity, thereby achieving four-quadrant operation.\n\nTo derive a relationship between the output currents and the input voltages, we apply KCL to formulate:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\nimage_name: Figure 5.45 The Gilbert Cell\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: X1, E: VX-}\nname: Q2, type: NPN, ports: {C: X1, B: VX-, E: VY+}\nname: Q3, type: NPN, ports: {C: VK-, B: X2, E: VY+}\nname: Q4, type: NPN, ports: {C: VCC, B: VK+, E: X2}\nname: Q5, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: Q6, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\n]\nextrainfo: The circuit is a Gilbert Cell, a type of four-quadrant multiplier. It utilizes differential pairs of NPN transistors for input signal multiplication. The output current difference is regulated by the voltage inputs VX and VY.\n\nFIGURE 5.45 The Gilbert Cell.\n\nAssuming negligible base currents, we modify Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe categorize three primary applications for this cell:\n\n- Both inputs are small-signal types, i.e., $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\approx x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\approx I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell functions as a true four-quadrant multiplier.\n\n- One input ($v_{x}$) is a small-signal continuous wave, such as a sine wave, while the other input ($v_{Y}$) is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off, and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off, and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is used in communications as a modulator/detector.\n\n- Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ share the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas when $v_{X}$ and $v_{Y}$ have opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This functionality mirrors the exclusive-or function in digital circuits. In this capacity, the cell serves as a phase detector in phase-locked loop systems.\n\nAs with OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating accommodations for larger input magnitudes while ensuring accurate multiplication. Fig. 5.46 illustrates a widely-used Gilbert Cell application addressing these requirements. Key observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to broaden its input signal range by the desired amount. Ignoring base currents, we apply KCL, Ohm's law, and KVL to derive:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} & = \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n& = \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nReorganizing and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we obtain:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\nimage_name: Figure 5.46 Four-quadrant analog multiplier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q2, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q3, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q4, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q5, type: NPN, ports: {C: vX+, B: vY1, E: P3}\nname: Q6, type: NPN, ports: {C: vX+, B: vY2, E: P4}\nname: Q7, type: NPN, ports: {C: vX-, B: vX1, E: P1}\nname: Q8, type: NPN, ports: {C: vX-, B: vX2, E: P2}\nname: Q9, type: NPN, ports: {C: VA, B: vX-, E: VK-}\nname: Q10, type: NPN, ports: {C: VA, B: vX+, E: VK-}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO1}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO2}\nname: RX, type: Resistor, value: RX, ports: {N1: P1, N2: P2}\nname: RY, type: Resistor, value: RY, ports: {N1: P3, N2: P4}\nname: IX, type: CurrentSource, value: IX, ports: {Np: P1, Nn: VEE}\nname: IY, type: CurrentSource, value: IY, ports: {Np: P3, Nn: VEE}\n]\nextrainfo: The circuit is a four-quadrant analog multiplier. It employs pairs of NPN transistors for voltage-to-current conversions. The Q5-Q6 pair and Q7-Q8 pair serve this purpose with emitter degeneration resistors RY and RX, respectively. The output currents iO1 and iO2 are derived from the voltage differences across these pairs.\n\nFIGURE 5.46 Four-quadrant analog multiplier.\n\nIn a well-designed circuit, the last numerator term is negligible (see Problem 5.39), allowing us to approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, yielding $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} & = v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n& = V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}{1 - \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}\n$$\n\nUsing the identity $\\ln \\left[(1 + x) / (1 - x)\\right] = 2 \\tan^{-1} x$, valid for $|x| < 1$, we get:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) results in:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)\\right]}{2 V_{T}}\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / \\left(2 R_{X}\\right)$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in $\\tanh^{-1}$ fashion to generate a predistorted signal $v_{x}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in tanh fashion to produce an overall undistorted output. This output is subsequently modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In the configuration of Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistances $R$, resulting in the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is desired, the I-V conversion can be implemented via an op amp configured as a differential amplifier. ${ }^{7}$ Alternatively, if a single-ended current output is needed, three Wilson current mirrors can be used in the manner of the OTA of Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is classified as an analog multiplier because, as per Eq. (5.72), $i_{o}$ is directly proportional to the product $I \\times (v_{p} - v_{n})$. Although the difference $v_{p} - v_{n}$ can adopt either polarity, the current $I$ must consistently flow out of the differential pair (with $I \\geq 0$), thus designating the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is achieved using the current-mode circuit shown in Fig. 5.45. This circuit, popularly known as the Gilbert Cell after its inventor, Barrie Gilbert, ${}^{8}$, is an elegant current-mode configuration comprising (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in opposing phases, causing their output currents to subtract pairwise, and (b) a third EC pair, $Q_{5}-Q_{6}$, designed to steer the bias current $I$ to the two differential pairs in proportions dictated by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate the other, enabling the output current difference $i_{O1} - i_{O2}$ to adopt either polarity, thereby facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and the input voltages, we apply KCL to formulate:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\nimage_name: Figure 5.45 The Gilbert Cell\ndescription:\n[\nname: Q1, type: NPN, ports: {C: VCC, B: X1, E: VX-}\nname: Q2, type: NPN, ports: {C: X1, B: VX-, E: VY+}\nname: Q3, type: NPN, ports: {C: VK-, B: X2, E: VY+}\nname: Q4, type: NPN, ports: {C: VCC, B: VK+, E: X2}\nname: Q5, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: Q6, type: NPN, ports: {C: VY+, B: VY-, E: P}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\n]\nextrainfo: The circuit is a Gilbert Cell, a type of four-quadrant multiplier. It utilizes differential pairs of NPN transistors to achieve multiplication of input signals. The output current difference is controlled by the voltage inputs VX and VY.\n\nFIGURE 5.45 The Gilbert Cell.\n\nAssuming negligible base currents, we adapt Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three primary application categories for the cell:\n\n- Both inputs are small-signal types, where $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\approx x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\approx I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell functions as a true four-quadrant multiplier.\n\n- One input ($v_{x}$) is a small-signal continuous wave, such as a sine wave, while the other input ($v_{Y}$) is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off, and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off, and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, resulting in $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is applicable in communications as a modulator/detector.\n\n- Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ have the same polarity, the cell yields $i_{O1} - i_{O2} = I - 0 = I$, whereas when $v_{X}$ and $v_{Y}$ have opposite polarities, it yields $i_{O1} - i_{O2} = 0 - I = -I$. This function resembles the exclusive-or function in digital circuits. In this capacity, the cell is used as a phase detector in phase-locked loop systems.\n\nAs with OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating provisions to accommodate larger input magnitudes while ensuring accurate multiplication. Fig. 5.46 illustrates a widely-used Gilbert Cell application that meets these requirements. We make the following observations:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range by the desired amount. Ignoring base currents, we apply KCL, Ohm's law, and KVL to write:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} & = \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n& = \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nRegrouping and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we get:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\nimage_name: Figure 5.46 Four-quadrant analog multiplier\ndescription:\n[\nname: Q1, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q2, type: NPN, ports: {C: vO1, B: vX-, E: X1}\nname: Q3, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q4, type: NPN, ports: {C: vO2, B: vX+, E: X2}\nname: Q5, type: NPN, ports: {C: vX+, B: vY1, E: P3}\nname: Q6, type: NPN, ports: {C: vX+, B: vY2, E: P4}\nname: Q7, type: NPN, ports: {C: vX-, B: vX1, E: P1}\nname: Q8, type: NPN, ports: {C: vX-, B: vX2, E: P2}\nname: Q9, type: NPN, ports: {C: VA, B: vX-, E: VK-}\nname: Q10, type: NPN, ports: {C: VA, B: vX+, E: VK-}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO1}\nname: R, type: Resistor, value: R, ports: {N1: VCC, N2: vO2}\nname: RX, type: Resistor, value: RX, ports: {N1: P1, N2: P2}\nname: RY, type: Resistor, value: RY, ports: {N1: P3, N2: P4}\nname: IX, type: CurrentSource, value: IX, ports: {Np: P1, Nn: VEE}\nname: IY, type: CurrentSource, value: IY, ports: {Np: P3, Nn: VEE}\n]\nextrainfo: The circuit is a four-quadrant analog multiplier. It uses pairs of NPN transistors to perform voltage-to-current conversions. The Q5-Q6 pair and Q7-Q8 pair are used for this purpose with emitter degeneration resistors RY and RX, respectively. The output currents iO1 and iO2 are derived from the voltage differences across these pairs.\n\nFIGURE 5.46 Four-quadrant analog multiplier.\n\nIn a well-designed circuit, the last numerator term is negligible (see Problem 5.39), allowing us to approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, giving $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} & = v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n& = V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}{1 - \\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)}\n$$\n\nUsing the identity $\\ln \\left[(1 + x) / (1 - x)\\right] = 2 \\tan^{-1} x$, which holds for $|x| < 1$, we have:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) yields:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / \\left(R_{X} I_{X}\\right)\\right]}{2 V_{T}}\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / \\left(2 R_{X}\\right)$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in $\\tanh^{-1}$ fashion to generate a predistorted signal $v_{X}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in tanh fashion to produce an overall undistorted output. This output is subsequently modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In the configuration of Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistors $R$ to yield the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is desired, the I-V conversion can be implemented via an op amp configured as a differential amplifier. ${}^{7}$ Alternatively, if a single-ended current output is needed, three Wilson current mirrors can be used in the manner of the OTA of Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is classified as an analog multiplier because, according to Eq. (5.72), the output current $i_{o}$ is directly proportional to the product $I \\times (v_{p} - v_{n})$. While the voltage difference $v_{p} - v_{n}$ can exhibit either polarity, the current $I$ must consistently flow out of the differential pair (with $I \\geq 0$), thereby designating the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is achieved using the current-mode circuit illustrated in Fig. 5.45. This circuit, popularly known as the Gilbert Cell after its inventor Barrie Gilbert, is an exquisite current-mode configuration comprising: (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in phase opposition, causing their output currents to subtract pairwise, and (b) a third EC pair $(Q_{5}-Q_{6})$ designed to direct the bias current $I$ to the two differential pairs in proportions dictated by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate the other, enabling the output current difference $i_{O1} - i_{O2}$ to adopt either polarity, thus facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and the input voltages, we apply KCL to formulate:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\n[Image Description: Figure 5.45 illustrates the Gilbert Cell. It includes NPN transistors Q1, Q2, Q3, Q4, Q5, and Q6, with specified port connections. The circuit functions as a four-quadrant multiplier, utilizing differential pairs of NPN transistors to achieve signal multiplication. The output current difference is regulated by voltage inputs VX and VY.]\n\nFIGURE 5.45 The Gilbert Cell.\n\nAssuming negligible base currents, we adapt Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three primary application categories for this cell:\n\n- Both inputs are small-signal types, where $\\left|v_{x}\\right| \\ll 4 V_{T}$ and $\\left|v_{y}\\right| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\cong x$ and thus write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\cong I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nClearly, in this mode, the cell operates as a genuine four-quadrant multiplier.\n\n- One input $(v_{x})$ is a small-signal continuous wave, such as a sine wave, while the other input $(v_{Y})$ is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off, and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off, and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is utilized in communications as a modulator/detector.\n\n- Both inputs are large-signal types. When $v_{X}$ and $v_{Y}$ have the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas when $v_{X}$ and $v_{Y}$ have opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This function mirrors the exclusive-or operation in digital circuits and finds application as a phase detector in phase-locked loop systems.\n\nAs with OTAs, the small-signal constraint can be a significant limitation in certain multiplier applications, necessitating provisions to accommodate larger input magnitudes while ensuring accurate multiplication. Figure 5.46 presents a widely used Gilbert Cell application that meets these requirements. Key observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range by the desired amount. Ignoring base currents, we apply KCL, Ohm's law, and KVL to derive:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} &= \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n&= \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nReorganizing and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we obtain:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\n[Image Description: Figure 5.46 depicts a four-quadrant analog multiplier. It includes NPN transistors Q1, Q2, Q3, Q4, Q5, Q6, Q7, Q8, Q9, and Q10, along with resistors R, RX, and RY, and current sources IX and IY. The circuit performs voltage-to-current conversions using pairs of NPN transistors, with emitter degeneration resistors RY and RX. The output currents iO1 and iO2 are derived from the voltage differences across these pairs.]\n\nFIGURE 5.46 Four-quadrant analog multiplier.\n\nIn a well-designed circuit, the last numerator term is negligible (refer to Problem 5.39), allowing us to approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair functions as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair acts as a V-I converter, yielding $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} &= v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n&= V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nHowever, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / (R_{X} I_{X})}{1 - \\left(v_{X1} - v_{X2}\\right) / (R_{X} I_{X})}\n$$\n\nUsing the identity $\\ln \\left[(1 + x) / (1 - x)\\right] = 2 \\tan^{-1} x$, valid for $|x| < 1$, we get:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) results in:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / (R_{X} I_{X})\\right]}{2 V_{T}}\n$$\n\nwhich simplifies to:\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / (2 R_{X})$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in a $\\tanh^{-1}$ manner to generate a predistorted signal $v_{x}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in a tanh manner to produce an overall undistorted output. This output is subsequently modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In the configuration shown in Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistors $R$, resulting in the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is required, the I-V conversion can be implemented using an op amp configured as a differential amplifier. Alternatively, if a single-ended current output is needed, three Wilson current mirrors can be employed in the manner of the OTA in Fig. 5.42."
},
{
    "text": "The OTA depicted in Fig. 5.42 is termed an analog multiplier because, as per Eq. (5.72), $i_{o}$ is directly proportional to the product $I \\times (v_{p} - v_{n})$. Although the voltage difference $v_{p} - v_{n}$ can adopt either polarity, the current $I$ must always exit the differential pair (with $I \\geq 0$), thus classifying the OTA as a two-quadrant multiplier. Applications like communications necessitate full four-quadrant analog multiplication, which is achieved using the current-mode circuit shown in Fig. 5.45. This circuit, popularly known as the Gilbert Cell after its inventor Barrie Gilbert, is an elegant current-mode design comprising (a) two emitter-coupled (EC) differential pairs, $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$, driven by the same voltage $v_{X}$ but in opposing phases, causing their output currents to subtract pairwise, and (b) a third EC pair, $Q_{5}-Q_{6}$, designed to direct the bias current $I$ to the two differential pairs in proportions governed by the voltage $v_{Y}$. Depending on the polarity of $v_{Y}$, the output of one pair will dominate the other, enabling the output current difference $i_{O1} - i_{O2}$ to achieve either polarity, thereby facilitating four-quadrant operation.\n\nTo derive a relationship between the output currents and the input voltages, we apply KCL to write:\n\n$$\ni_{O1} - i_{O2} = (i_{C1} + i_{C3}) - (i_{C2} + i_{C4}) = (i_{C1} - i_{C2}) - (i_{C4} - i_{C3})\n$$\n\nImage Description:\n- Figure 5.45 illustrates the Gilbert Cell.\n- Components include:\n  - Q1: NPN transistor with ports C: VCC, B: X1, E: VX-\n  - Q2: NPN transistor with ports C: X1, B: VX-, E: VY+\n  - Q3: NPN transistor with ports C: VK-, B: X2, E: VY+\n  - Q4: NPN transistor with ports C: VCC, B: VK+, E: X2\n  - Q5: NPN transistor with ports C: VY+, B: VY-, E: P\n  - Q6: NPN transistor with ports C: VY+, B: VY-, E: P\n  - I: Current source with value I, ports Np: P, Nn: VEE\n- The circuit functions as a four-quadrant multiplier using differential pairs of NPN transistors. The output current difference is controlled by voltage inputs VX and VY.\n\nAssuming negligible base currents, we modify Eq. (5.71) to write:\n\n$$\ni_{O1} - i_{O2} = i_{C5} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) - i_{C6} \\tanh \\left(\\frac{v_{X}}{2 V_{T}}\\right) = (i_{C5} - i_{C6}) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right)\n$$\n\nThus,\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = I \\tanh \\left(\\frac{V_{Y}}{2 V_{T}}\\right) \\tanh \\left(\\frac{V_{X}}{2 V_{T}}\\right) \\tag{5.74}\n\\end{equation*}\n$$\n\nWe identify three primary application categories for this cell:\n\n1. Both inputs are small-signal, i.e., $|v_{x}| \\ll 4 V_{T}$ and $|v_{y}| \\ll 4 V_{T}$, allowing us to approximate $\\tanh x \\approx x$ and write:\n\n$$\n\\begin{equation*}\ni_{o1} - i_{o2} \\approx I \\times \\frac{v_{x}}{2 V_{T}} \\times \\frac{v_{y}}{2 V_{T}} \\tag{5.75}\n\\end{equation*}\n$$\n\nIn this mode, the cell functions as a true four-quadrant multiplier.\n\n2. One input ($v_{x}$) is a small-signal continuous wave, such as a sine wave, while the other input ($v_{Y}$) is a square wave of sufficient amplitude to overdrive the $Q_{5}-Q_{6}$ pair, turning one of its BJTs off. For $v_{Y} > 0$, $Q_{6}$ is off and $Q_{5}$ directs all of $I$ to the $Q_{1}-Q_{2}$ pair, resulting in $i_{o1} - i_{o2} = +I v_{x} / (2 V_{T}) = +g_{m} v_{x}$. Conversely, for $v_{Y} < 0$, $Q_{5}$ is off and $Q_{6}$ directs all of $I$ to the $Q_{3}-Q_{4}$ pair, yielding $i_{o1} - i_{o2} = -I v_{x} / (2 V_{T}) = -g_{m} v_{x}$, with the negative sign arising from the anti-phase input connection. In this role, the cell is used in communications as a modulator/detector.\n\n3. Both inputs are large-signal. When $v_{X}$ and $v_{Y}$ have the same polarity, the cell outputs $i_{O1} - i_{O2} = I - 0 = I$, whereas with opposite polarities, it outputs $i_{O1} - i_{O2} = 0 - I = -I$. This function resembles the exclusive-or operation in digital circuits and is utilized as a phase detector in phase-locked loop systems.\n\nAs with OTAs, the small-signal constraint can limit certain multiplier applications, necessitating accommodations for larger input magnitudes while ensuring accurate multiplication. Figure 5.46 presents a popular Gilbert Cell application addressing these requirements. Key observations include:\n\n- The $Q_{5}-Q_{6}$ pair employs emitter degeneration via $R_{Y}$ to expand its input signal range. Ignoring base currents and applying KCL, Ohm's law, and KVL, we write:\n\n$$\n\\begin{aligned}\ni_{C5} - i_{C6} &= \\left(I_{Y} + \\frac{v_{E5} - v_{E6}}{R_{Y}}\\right) - \\left(I_{Y} + \\frac{v_{E6} - v_{E5}}{R_{Y}}\\right) = 2 \\frac{v_{E5} - v_{E6}}{R_{Y}} \\\\\n&= \\frac{\\left(v_{Y1} - v_{BE5}\\right) - \\left(v_{Y2} - v_{BE6}\\right)}{0.5 R_{Y}}\n\\end{aligned}\n$$\n\nReorganizing and using $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we obtain:\n\n$$\ni_{C5} - i_{C6} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - \\left(v_{BE5} - v_{BE6}\\right)}{0.5 R_{Y}} = \\frac{\\left(v_{Y1} - v_{Y2}\\right) - V_{T} \\ln \\left(i_{C5} / i_{C6}\\right)}{0.5 R_{Y}}\n$$\n\nImage Description:\n- Figure 5.46 depicts a four-quadrant analog multiplier.\n- Components include:\n  - Q1: NPN transistor with ports C: vO1, B: vX-, E: X1\n  - Q2: NPN transistor with ports C: vO1, B: vX-, E: X1\n  - Q3: NPN transistor with ports C: vO2, B: vX+, E: X2\n  - Q4: NPN transistor with ports C: vO2, B: vX+, E: X2\n  - Q5: NPN transistor with ports C: vX+, B: vY1, E: P3\n  - Q6: NPN transistor with ports C: vX+, B: vY2, E: P4\n  - Q7: NPN transistor with ports C: vX-, B: vX1, E: P1\n  - Q8: NPN transistor with ports C: vX-, B: vX2, E: P2\n  - Q9: NPN transistor with ports C: VA, B: vX-, E: VK-\n  - Q10: NPN transistor with ports C: VA, B: vX+, E: VK-\n  - R: Resistor with value R, ports N1: VCC, N2: vO1\n  - R: Resistor with value R, ports N1: VCC, N2: vO2\n  - RX: Resistor with value RX, ports N1: P1, N2: P2\n  - RY: Resistor with value RY, ports N1: P3, N2: P4\n  - IX: Current source with value IX, ports Np: P1, Nn: VEE\n  - IY: Current source with value IY, ports Np: P3, Nn: VEE\n- The circuit performs voltage-to-current conversions using pairs of NPN transistors. The Q5-Q6 pair and Q7-Q8 pair, along with emitter degeneration resistors RY and RX, respectively, control the output currents iO1 and iO2.\n\nIn a well-designed circuit, the last numerator term is negligible (see Problem 5.39), so we approximate:\n\n$$\n\\begin{equation*}\ni_{C5} - i_{C6} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tag{5.76}\n\\end{equation*}\n$$\n\nindicating that the emitter-degenerated $Q_{5}-Q_{6}$ pair acts as a linear voltage-to-current (V-I) converter.\n\n- Similarly, the $Q_{7}-Q_{8}$ pair functions as a V-I converter, giving $i_{C7} - i_{C8} = \\left(v_{X1} - v_{X2}\\right) / (0.5 R_{X})$ and driving the diode-connected pair $Q_{9}-Q_{10}$. Using KVL and $v_{BE} = V_{T} \\ln \\left(i_{C} / I_{s}\\right)$, we have:\n\n$$\n\\begin{aligned}\nv_{X} &= v_{E10} - v_{E9} = \\left(V_{A} - v_{BE10}\\right) - \\left(V_{A} - v_{BE9}\\right) = v_{BE9} - v_{BE10} \\\\\n&= V_{T} \\ln \\frac{i_{C9}}{i_{C10}} = V_{T} \\ln \\frac{i_{C7}}{i_{C8}}\n\\end{aligned}\n$$\n\nBut, KCL gives $i_{C7} = I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}$ and $i_{C8} = I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}$, so:\n\n$$\nv_{X} = V_{T} \\ln \\frac{I_{X} + \\left(v_{X1} - v_{X2}\\right) / R_{X}}{I_{X} - \\left(v_{X1} - v_{X2}\\right) / R_{X}} = V_{T} \\ln \\frac{1 + \\left(v_{X1} - v_{X2}\\right) / (R_{X} I_{X})}{1 - \\left(v_{X1} - v_{X2}\\right) / (R_{X} I_{X})}\n$$\n\nUsing the identity $\\ln \\left[(1 + x) / (1 - x)\\right] = 2 \\tan^{-1} x$, valid for $|x| < 1$, we get:\n\n$$\n\\begin{equation*}\nv_{X} = 2 V_{T} \\tan^{-1} \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.77}\n\\end{equation*}\n$$\n\n- Substituting Eqs. (5.76) and (5.77) into Eq. (5.74) yields:\n\n$$\ni_{O1} - i_{O2} = \\left(i_{C5} - i_{C6}\\right) \\tanh \\frac{v_{X}}{2 V_{T}} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\tanh \\frac{2 V_{T} \\tan^{-1} \\left[\\left(v_{X1} - v_{X2}\\right) / (R_{X} I_{X})\\right]}{2 V_{T}}\n$$\n\nThus,\n\n$$\n\\begin{equation*}\ni_{O1} - i_{O2} = \\frac{v_{Y1} - v_{Y2}}{0.5 R_{Y}} \\times \\frac{v_{X1} - v_{X2}}{R_{X} I_{X}} \\tag{5.78}\n\\end{equation*}\n$$\n\nIt is evident that the tanh function and its inverse $\\tanh^{-1}$ cancel each other out, leaving only the argument $\\left(v_{X1} - v_{X2}\\right) / (2 R_{X})$. In essence, the $X$-input is first processed by the $Q_{9}-Q_{10}$ diodes in a $\\tanh^{-1}$ manner to generate a predistorted signal $v_{x}$; the $Q_{1}-Q_{2}$ and $Q_{3}-Q_{4}$ pairs then process $v_{X}$ in a tanh manner to produce an overall undistorted output. This output is subsequently modulated by the $Y$-input.\n\n- In practical applications, the output current difference $i_{O1} - i_{O2}$ is converted to a voltage. In the configuration of Fig. 5.46, this I-V conversion is achieved by terminating the cell's outputs on a pair of matched resistors $R$, resulting in the double-ended output voltage:\n\n$$\n\\begin{equation*}\nv_{O} = v_{O2} - v_{O1} = R \\left(i_{O1} - i_{O2}\\right) = \\frac{R}{0.5 R_{X} R_{Y} I_{X}} \\times \\left(v_{X1} - v_{X2}\\right) \\times \\left(v_{Y1} - v_{Y2}\\right) \\tag{5.79}\n\\end{equation*}\n$$\n\nIf a single-ended voltage output is required, the I-V conversion can be implemented using an op amp configured as a differential amplifier. Alternatively, if a single-ended current output is desired, three Wilson current mirrors can be employed, as in the OTA of Fig. 5.42."
},
{
    "text": "A prevalent method for electronically encoding analog information involves single-ended voltages, such as ground-referenced potentials. A typical instance is the inverting amplifier depicted in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often integrated into a larger system, where it may be susceptible to various forms of interference noise that can obscure useful signals. Initially, the ground interconnection, rather than being an ideal conductor, displays distributed resistance, inductance, and capacitance, and is shared with other system subcircuits. As currents from other circuits flow through the ground line, as shown in the lumped model of Fig. 5.47b, they generate unwanted voltage drops across the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide extra pathways for surrounding circuits to introduce interference noise into the line. We represent the collective impact of all noise sources with a single ground noise source $v_{1}$, as illustrated in Fig. 5.48a. Interference noise from adjacent circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to the noise drops along the ground line, the notion of a reference node becomes unclear. For discussion purposes, let's arbitrarily select node $v_{P}$ as our ground reference, as shown in Fig. 5.48a. Applying KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be comparable to the noise level. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to suppress it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on each line, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for electronically encoding analog information is through single-ended voltages, such as ground-referenced potentials. A typical example is the inverting amplifier depicted in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For a large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, where it may encounter various forms of interference noise that can obscure useful signals. Initially, the ground interconnection, which is not a perfect conductor, displays distributed resistance, inductance, and capacitance, and is shared with other subcircuits. As currents from other circuits flow through the ground line, as shown in the lumped model of Fig. 5.47b, they create unwanted voltage drops along the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide extra paths for neighboring circuits to inject interference noise. We represent the combined effect of all noise sources with a single ground noise source $v_{1}$, as illustrated in Fig. 5.48a. Interference noise from adjacent circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to the noise drops along the ground line, the concept of a reference node becomes unclear. For discussion purposes, let's arbitrarily choose node $v_{P}$ as our ground reference, as shown in Fig. 5.48a. Using KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be comparable to the noise. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to reject it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on both lines, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for electronically encoding analog information is through single-ended voltages, such as ground-referenced potentials. A typical example is the inverting amplifier depicted in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For a large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, where it may be subjected to various forms of interference noise that can obscure useful signals. Initially, the ground interconnection, far from being an ideal conductor, exhibits distributed resistance, inductance, and capacitance, and is shared with other subcircuits. As currents from other circuits flow through the ground line, as shown in the lumped model of Fig. 5.47b, they create unwanted voltage drops along the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide pathways for surrounding circuits to introduce interference noise into the line. We represent the collective impact of all noise sources with a single ground noise source $v_{1}$, as illustrated in Fig. 5.48a. Interference noise from adjacent circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to noise drops along the ground line, the concept of a reference node becomes ambiguous. For discussion purposes, let's arbitrarily choose node $v_{P}$ as our ground reference, as shown in Fig. 5.48a. Using KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be on par with noise levels. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to reject it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on each line, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for electronically encoding analog information is through single-ended voltages, such as those referenced to ground. A typical example is the inverting amplifier shown in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For a large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, where it may be subjected to various forms of interference noise that can obscure useful signals. \n\nInitially, the ground interconnection, far from being an ideal conductor, displays distributed resistance, inductance, and capacitance, and is shared with other subcircuits. As currents from other circuits flow through the ground line, as depicted in the lumped model of Fig. 5.47b, they create unwanted voltage drops across the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide extra pathways for surrounding circuits to introduce interference noise into the line. We represent the collective impact of all noise sources with a single ground noise source $v_{1}$, as illustrated in Fig. 5.48a. Interference noise from adjacent circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to noise drops along the ground line, the concept of a reference node becomes unclear. For discussion purposes, let's arbitrarily choose node $v_{P}$ as our ground reference, as shown in Fig. 5.48a. Applying KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be comparable to noise levels. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to reject it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on both lines, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for electronically encoding analog information is through single-ended voltages, such as ground-referenced potentials. A typical example is the inverting amplifier shown in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For a large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, where it may be susceptible to various forms of interference noise that can obscure useful signals. Initially, the ground interconnection, rather than being a perfect conductor, displays distributed resistance, inductance, and capacitance, and is shared with other system subcircuits. As currents from other circuits flow through the ground line, as depicted in the lumped model of Fig. 5.47b, they create unwanted voltage drops along the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide extra pathways for surrounding circuits to introduce interference noise into the line. We represent the combined effect of all noise sources with a single ground noise source $v_{1}$, as shown in Fig. 5.48a. Interference noise from adjacent circuits also impacts the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to noise drops along the ground line, the notion of a reference node becomes unclear. For discussion purposes, let's arbitrarily select node $v_{P}$ as our ground reference, as illustrated in Fig. 5.48a. Applying KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be comparable to noise levels. The most effective approach to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to suppress it. As shown in Fig. 5.48b, this involves detaching node $v_{P}$ from ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely routed to form balanced lines, the noise pickup will be identical on both, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for electronically encoding analog information involves single-ended voltages, such as ground-referenced potentials. A typical example is the inverting amplifier shown in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For a large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, where it may be subjected to various forms of interference noise that can obscure useful signals. Initially, the ground interconnection, far from being an ideal conductor, displays distributed resistance, inductance, and capacitance, and is shared with other subcircuits in the system. As currents from other circuits flow through the ground line, as depicted in the lumped model of Fig. 5.47b, they create unwanted voltage drops along the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide extra paths for surrounding circuits to introduce interference noise into the line. We represent the combined effect of all noise sources with a single ground noise source $v_{1}$, as shown in Fig. 5.48a. Interference noise from neighboring circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to the noise drops along the ground line, the concept of a reference node becomes ambiguous. For discussion purposes, let's arbitrarily choose node $v_{P}$ as our ground reference, as illustrated in Fig. 5.48a. Using KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be comparable to the noise. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to reject it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on both lines, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for electronically encoding analog information is through single-ended voltages, such as ground-referenced potentials. A typical example is the inverting amplifier depicted in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground. For a large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, potentially subject to various forms of interference noise that can obscure useful signals.\n\nThe ground interconnection, far from being an ideal conductor, exhibits distributed resistance, inductance, and capacitance, and is shared with other subcircuits. As currents from other circuits flow through the ground line, illustrated by the lumped model in Fig. 5.47b, they create unwanted voltage drops along the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide pathways for surrounding circuits to introduce interference noise. We represent the combined effect of all noise sources with a single ground noise source $v_{1}$, as shown in Fig. 5.48a. Interference noise from neighboring circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to noise drops along the ground line, the concept of a reference node becomes unclear. For discussion purposes, let's arbitrarily choose node $v_{P}$ as our ground reference, as illustrated in Fig. 5.48a. Using KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications where the input signal strength may be comparable to noise levels. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and use a differential amplifier with a high common-mode rejection ratio (CMRR) to reject it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on both, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "A prevalent method for encoding analog information electronically involves using single-ended voltages, such as ground-referenced potentials. A typical example is the inverting amplifier depicted in Fig. 5.47a, where both the input $v_{I}$ and output $v_{O}$ are referenced to ground potential. For large $a$, their relationship is given by $v_{O}=\\left(-R_{2} / R_{1}\\right) v_{I}$. In practical applications, this circuit is often part of a larger system, where it may be subjected to various forms of interference noise that can obscure useful signals. Initially, the ground interconnection, far from being an ideal conductor, exhibits distributed resistance, inductance, and capacitance, and is shared with other subcircuits in the system. As currents from other circuits flow through the ground line, as shown in the lumped model of Fig. 5.47b, they create unwanted voltage drops along the distributed line impedance. Additionally, stray mutual inductances and internode capacitances provide extra pathways for surrounding circuits to introduce interference noise into the line. We represent the combined effect of all noise sources with a single ground noise source $v_{1}$, as illustrated in Fig. 5.48a. Interference noise from neighboring circuits also affects the signal line connecting the source to the amplifier, modeled by the line noise source $v_{2}$.\n\nDue to the noise drops along the ground line, the concept of a reference node becomes unclear. For discussion purposes, let's arbitrarily choose node $v_{P}$ as our ground reference, as shown in Fig. 5.48a. Using KVL, we derive $v_{O}=\\left(-R_{2} / R_{1}\\right) \\times\\left(v_{1}+v_{I}+v_{2}\\right)$, indicating that both noise sources are amplified to the same extent as the useful signal $v_{I}$. This is particularly problematic in high-gain applications, where the input signal strength may be comparable to the noise level. The most effective way to eliminate ground noise is to treat $v_{1}$ as a common-mode signal and employ a differential amplifier with a high common-mode rejection ratio (CMRR) to reject it. As shown in Fig. 5.48b, this involves lifting node $v_{P}$ off ground and driving it via an additional dedicated line and an extra $R_{1}-R_{2}$ pair. This second line will also pick up noise, but if both lines are identical and closely laid out to form balanced lines, the noise pickup will be the same on each line, resulting in $^{7} v_{O}=\\left(R_{2} / R_{1}\\right)\\left[\\left(v_{1}+v_{2}\\right)-\\left(v_{1}+v_{I}+v_{2}\\right)\\right]=\\left(-R_{2} / R_{1}\\right) v_{I}$. In summary, $v_{1}$ is rejected due to the amplifier's CMRR, and the $v_{2}$ sources cancel each other out due to line balance."
},
{
    "text": "The traditional differential amplifier depicted in Fig. $5.48 b$ processes input signals differentially yet produces a single-ended output. In contemporary mixed-mode ICs, where analog circuits are integrated alongside inherently noisy digital circuits and operate at low supply voltages, the combination of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The cornerstone of this circuit category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input similarly to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a conventional op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=-v_{O P}$. Additionally, it includes a control input allowing the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as will be discussed shortly.\n\n Besides the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) reduced second-harmonic distortion. To understand this, consider the outputs in more general terms, accounting for inherent circuit nonlinearities: $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. Simplifying, the differential output becomes $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs and the cancellation of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as illustrated in Fig. 5.49b for the resistive case. (Both networks are of the negative-feedback type, each connecting from one of the outputs to the input of the opposite polarity.) For clarity, the external inputs $v_{I P}$ and $v_{I N}$ are decomposed into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It utilizes two identical negative-feedback networks. The input differential voltage is divided into VIN and VIP, and the output differential voltage is represented by VOP and VON. Resistors R1 and R2 determine the amplifier's gain. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration used for balanced amplifier operation. It employs negative feedback through R1 and R2 resistors to control gain, and uses voltage sources to set common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the differential-mode components are related by\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals are out of phase, the differential output swing $v_{O D}$ is twice as wide.) Additionally, while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains undefined and must be set externally by the user."
},
{
    "text": "The traditional differential amplifier depicted in Fig. $5.48 b$ processes inputs differentially yet produces a single-ended output. In contemporary mixed-mode ICs, where analog circuits are integrated alongside inherently noisy digital circuits and operate at low supply voltages, the presence of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The cornerstone of this circuit category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input akin to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike the conventional op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=$ $-v_{O P}$. Additionally, it includes a control input for the user to define the common-mode output voltage $V_{O C(\\mathrm{set})}$, as will be discussed shortly.\n\nApart from the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) diminished second-harmonic distortion. To understand this, express the outputs in more generalized forms that account for inherent circuit nonlinearities, specifically, $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. Consequently, the differential output simplifies to $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs, along with the elimination of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as illustrated in Fig. 5.49b for the resistive scenario. (Both networks are of the negative-feedback type, as each connects one of the outputs to the input of the opposite polarity.) For clarity, the external inputs $v_{I P}$ and $v_{I N}$ are broken down into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It employs two identical negative-feedback networks. The input differential voltage is divided into VIN and VIP, and the output differential voltage is represented by VOP and VON. Resistors R1 and R2 determine the amplifier's gain. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration used for balanced amplifier operation. It utilizes negative feedback through R1 and R2 resistors to control gain, and employs voltage sources to set common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the differential-mode components are related by\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals are out of phase, the differential output swing $v_{O D}$ is twice as wide.) Additionally, while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains undefined and thus must be set externally by the user."
},
{
    "text": "The traditional differential amplifier shown in Fig. $5.48 b$ processes input signals differentially but produces a single-ended output. In modern mixed-mode ICs, where analog circuits coexist with inherently noisy digital circuits and operate at low supply voltages, the presence of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The key circuit in this category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input similar to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a conventional op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=-v_{O P}$. Additionally, it includes a control input for the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as will be discussed shortly.\n\nBesides the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) reduced second-harmonic distortion. To understand this, consider the outputs in more general terms, accounting for inherent circuit nonlinearities: $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. Simplifying, the differential output becomes $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs and the elimination of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as illustrated in Fig. 5.49b for the resistive case. (Both networks are of the negative-feedback type, each connecting from one of the outputs to the input of the opposite polarity.) For clarity, the external inputs $v_{I P}$ and $v_{I N}$ are broken down into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It uses two identical negative-feedback networks. The input differential voltage is split into two components, VIN and VIP, and the output differential voltage is represented by VOP and VON. The resistors R1 and R2 set the gain of the amplifier. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration used for balanced amplifier operation. It employs negative feedback through R1 and R2 resistors to control gain, and uses voltage sources to set common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the relationship between the differential-mode components is\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals are out of phase, the differential output swing $v_{O D}$ is twice as wide.) Additionally, while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains undefined and must be set externally by the user."
},
{
    "text": "The conventional differential amplifier depicted in Fig. $5.48 b$ processes input signals differentially yet produces a single-ended output. In contemporary mixed-mode ICs, where analog circuits are integrated alongside inherently noisy digital circuits and operate at low supply voltages, the presence of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The cornerstone of this circuit category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input similarly to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a typical op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=$ $-v_{O P}$. Additionally, it includes a control input allowing the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as will be discussed shortly.\n\nBeyond the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) diminished second-harmonic distortion. To understand this, consider the outputs expressed in more general forms to account for inherent circuit nonlinearities: $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. Simplifying, the differential output becomes $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs and the elimination of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as illustrated in Fig. 5.49b for the resistive case. (Both networks are of the negative-feedback type, each connecting from one output to the input of the opposite polarity.) For clarity, the external inputs $v_{I P}$ and $v_{I N}$ are decomposed into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It uses two identical negative-feedback networks. The input differential voltage is split into two components, VIN and VIP, and the output differential voltage is represented by VOP and VON. The resistors R1 and R2 set the gain of the amplifier. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration used for balanced amplifier operation. It employs negative feedback through R1 and R2 resistors to control gain, and uses voltage sources to set common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are defined as\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the relationship between the differential-mode components is given by\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that due to the opposite phases of the single-ended output signals, the differential output swing $v_{O D}$ is twice as wide.) Additionally, while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains undefined and must be set externally by the user."
},
{
    "text": "The traditional differential amplifier depicted in Fig. $5.48 b$ processes input signals differentially but produces a single-ended output. In contemporary mixed-mode ICs, where analog circuits are integrated alongside inherently noisy digital circuits and operate at low supply voltages, the combination of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The cornerstone of this circuit category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input akin to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a conventional op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=-v_{O P}$. Additionally, it includes a control input allowing the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as will be discussed shortly.\n\nBesides the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an expanded output signal swing and (b) diminished second-harmonic distortion. To understand this, consider the outputs in more generalized forms that account for inherent circuit nonlinearities: $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. The differential output simplifies to $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs and the elimination of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as illustrated in Fig. 5.49b for the resistive case. (Both networks are of the negative-feedback type, each connecting from one of the outputs to the input of the opposite polarity.) For clarity, the external inputs $v_{I P}$ and $v_{I N}$ are decomposed into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It utilizes two identical negative-feedback networks. The input differential voltage is divided into VIN and VIP, and the output differential voltage is represented by VOP and VON. Resistors R1 and R2 determine the amplifier's gain. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration designed for balanced amplifier operation. It employs negative feedback via R1 and R2 resistors to control gain and uses voltage sources to establish common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the differential-mode components are related as\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals are out of phase, the differential output swing $v_{O D}$ is twice as wide.) Additionally, while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains undefined and must be set externally by the user."
},
{
    "text": "The conventional differential amplifier depicted in Fig. $5.48 b$ processes inputs differentially yet produces a single-ended output. In contemporary mixed-mode ICs, where analog circuits coexist with inherently noisy digital circuits and operate at low supply voltages, the combination of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The key circuit in this category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input similarly to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a typical op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=-v_{O P}$. Additionally, it includes a control input allowing the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as we will soon discuss.\n\n Besides the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) diminished second-harmonic distortion. To understand this, express the outputs in more generalized forms that account for inherent circuit nonlinearities, specifically, $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. Consequently, the differential output simplifies to $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs and the elimination of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as illustrated in Fig. 5.49b for the resistive case. (Both networks are of the negative-feedback type, as each connects from one of the outputs to the input of the opposite polarity.) For clarity, the external inputs $v_{I P}$ and $v_{I N}$ are decomposed into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It utilizes two identical negative-feedback networks. The input differential voltage is divided into VIN and VIP, and the output differential voltage is represented by VOP and VON. Resistors R1 and R2 determine the amplifier's gain. The circuit also incorporates common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration used for balanced amplifier operation. It employs negative feedback through R1 and R2 resistors to control gain, and uses voltage sources to set common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the differential-mode components are related as\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals have opposite phases, the differential output swing $v_{O D}$ is twice as wide.) We also note that while $v_{I C}$ is established by the input sources, $v_{O C}$ remains undefined and thus must be set externally by the user."
},
{
    "text": "The traditional differential amplifier depicted in Fig. $5.48 b$ processes input signals differentially yet produces a single-ended output. In modern mixed-mode ICs, where analog circuits coexist with inherently noisy digital circuits and operate at low supply voltages, the combination of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The cornerstone of this circuit category is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input similarly to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a conventional op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=-v_{O P}$. Additionally, it includes a control input allowing the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as we will soon discuss.\n\nApart from the noise immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) diminished second-harmonic distortion. To understand this, express the outputs in more general terms to account for inherent circuit nonlinearities, specifically, $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. The differential output then simplifies to $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs, and a cancellation of the second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as shown in Fig. 5.49b for the resistive case. (Both networks are of the negative-feedback type, as each connects one output to the input of the opposite polarity.) For illustrative purposes, the external inputs $v_{I P}$ and $v_{I N}$ are decomposed into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It uses two identical negative-feedback networks. The input differential voltage is split into two components, VIN and VIP, and the output differential voltage is represented by VOP and VON. The resistors R1 and R2 set the gain of the amplifier. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration used for balanced amplifier operation. It employs negative feedback through R1 and R2 resistors to control gain, and uses voltage sources to set common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are defined as\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the differential-mode components are related by\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals are out of phase, the differential output swing $v_{O D}$ is twice as wide.) We also note that while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains unspecified and thus must be set externally by the user."
},
{
    "text": "The conventional differential amplifier in Fig. $5.48 b$ processes inputs differentially yet produces a single-ended output. In modern mixed-mode ICs, where analog circuits coexist with inherently noisy digital circuits and operate at low supply voltages, the combination of low signal amplitudes and high interference noise necessitates double-ended signal transmission at both input and output ports. The cornerstone of these circuits is the fully differential op amp, symbolically represented in Fig. 5.49a. Also known as a fully balanced op amp, it responds to a differential input similarly to a standard op amp, yielding $v_{O P}=a\\left(v_{P}-v_{N}\\right)$. However, unlike a common op amp, it also provides a second, balanced output, $v_{O N}=a\\left(v_{N}-v_{P}\\right)=$ $-v_{O P}$. Additionally, it includes a control input for the user to set the common-mode output voltage $V_{O C(\\mathrm{set})}$, as we will soon discuss.\n\nBesides the noise-immunity benefits of balanced transmission, the fully differential op amp also offers (a) an extended output signal swing and (b) reduced second-harmonic distortion. To understand this, consider the outputs in more general terms accounting for inherent circuit nonlinearities: $v_{O P}=a\\left(v_{P}-v_{N}\\right)+b\\left(v_{P}-v_{N}\\right)^{2}+c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$ and $v_{O N}=a\\left(v_{N}-v_{P}\\right)+b\\left(v_{N}-v_{P}\\right)^{2}+c\\left(v_{N}-v_{P}\\right)^{3} \\ldots$. Simplifying, the differential output becomes $v_{O P}-v_{O N}=2 a\\left(v_{P}-v_{N}\\right)+2 c\\left(v_{P}-v_{N}\\right)^{3} \\ldots$, indicating a differential output signal swing twice that of the individual single-ended outputs and the elimination of second-harmonic components.\n\nThe fully differential op amp is set up for negative-feedback operation using two identical networks, as shown in the resistive case of Fig. 5.49b. (Both networks are of the negative-feedback type, each connecting from one of the outputs to the input of the opposite polarity.) For illustrative purposes, the external inputs $v_{I P}$ and $v_{I N}$ are decomposed into their differential-mode and common-mode components:\n\n$$\n\\begin{equation*}\nv_{I D}=v_{I P}-v_{I N} \\quad v_{I C}=\\frac{v_{I P}+v_{I N}}{2} \\tag{5.80a}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VON}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VOP}\nname: OpAmp1, type: OpAmp, value: a, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: OpAmp2, type: OpAmp, value: a, ports: {InP: VN, InN: VP, OutP: VON, OutN: VOP}\n]\nextrainfo:The circuit is a fully differential operational amplifier configuration. It utilizes two identical negative-feedback networks. The input differential voltage is divided into VIN and VIP, and the output differential voltage is represented by VOP and VON. Resistors R1 and R2 determine the amplifier's gain. The circuit also includes common-mode voltage sources VIC and VOC(set) for biasing.\nimage_name:(b)\ndescription:\n[\nname: VIC, type: VoltageSource, value: VIC, ports: {Np: VIC, Nn: GND}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIN, Nn: VIC}\nname: VID/2, type: VoltageSource, value: VID/2, ports: {Np: VIP, Nn: VIC}\nname: R1, type: Resistor, value: R1, ports: {N1: VIN, N2: VN}\nname: R1, type: Resistor, value: R1, ports: {N1: VIP, N2: VP}\nname: R2, type: Resistor, value: R2, ports: {N1: VN, N2: VOP}\nname: R2, type: Resistor, value: R2, ports: {N1: VP, N2: VON}\nname: OpAmp, type: OpAmp, ports: {InP: VP, InN: VN, OutP: VOP, OutN: VON}\nname: VOC(set), type: VoltageSource, value: VOC(set), ports: {Np: VOC, Nn: GND}\n]\nextrainfo:The circuit is a fully differential op-amp configuration designed for balanced amplifier operation. It employs negative feedback through R1 and R2 resistors to manage gain and uses voltage sources to establish common-mode and differential-mode components.\n\nFIGURE 5.49 Fully differential op amp: (a) symbol and labels, and (b) interconnection for operation as a fully balanced amplifier.\n\nSimilarly, the differential-mode and common-mode components at the output are defined as\n\n$$\n\\begin{equation*}\nv_{O D}=v_{O P}-v_{O N} \\quad v_{O C}=\\frac{v_{O P}+v_{O N}}{2} \\tag{5.80b}\n\\end{equation*}\n$$\n\nIf the open-loop gain $a$ is sufficiently high, the differential-mode components are related by\n\n$$\n\\begin{equation*}\nv_{O D}=\\frac{R_{2}}{R_{1}} v_{I D} \\tag{5.81}\n\\end{equation*}\n$$\n\n(Note that since the single-ended output signals are out of phase, the differential output swing $v_{O D}$ is twice as wide.) Additionally, while $v_{I C}$ is determined by the input sources, $v_{O C}$ remains undefined and must be set externally by the user."
},
{
    "text": "Figure 5.50 illustrates how the folded-cascode bipolar structure from Fig. $4.71 a$ can be transformed into a fully differential operational amplifier. The initial key modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. \n\nimage_name: Figure 5.50\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nextrainfo: This circuit is a fully differential bipolar operational amplifier with a folded-cascode configuration. It incorporates current mirrors and differential pairs to achieve high gain and common-mode rejection. The circuit uses PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\nThis adjustment results in a perfectly symmetric structure. (To prevent clutter, the specifics of the biasing network have been excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. Additionally, in practical implementations, $Q_{5}$ and $Q_{6}$ are often cascoded to increase gain, but here we focus on the fundamental aspects.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another significant feature is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). Its role is to accurately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), typically at the midpoint to maximize the output voltage swing. Specifically, the resistor pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA then compares with the externally provided voltage $V_{O C(s e t)}$, and adjusts its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, consider that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$, respectively. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is referred to as a servo loop."
},
{
    "text": "Figure 5.50 illustrates how the folded-cascode bipolar configuration from Fig. $4.71a$ can be transformed into a fully differential operational amplifier. The primary modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. \n\nThis image_name:Figure 5.50\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nextrainfo:This circuit is a fully differential bipolar operational amplifier featuring a folded-cascode structure. It incorporates current mirrors and differential pairs to achieve high gain and common-mode rejection. The design uses PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\ncreates a perfectly symmetric structure. (To prevent clutter, the biasing network details are excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. In practice, $Q_{5}$ and $Q_{6}$ are often cascoded to increase gain, but here we focus on the fundamentals.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another key feature is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). This network's role is to accurately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), typically at the midpoint to maximize output voltage swing. Specifically, the resistor pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which EA compares to the external voltage $V_{O C(s e t)}$, adjusting its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, note that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop comprising the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is considered a servo loop."
},
{
    "text": "Figure 5.50 illustrates the transformation of the folded-cascode bipolar structure from Fig. $4.71 a$ into a fully differential operational amplifier. The key initial modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. \n\nImage Description:\n- Q1: NPN transistor with ports C: X1, B: vP, E: P\n- Q2: NPN transistor with ports C: X2, B: vN, E: P\n- Q3: PMOS transistor with ports S: VCC, D: X1, G: VB34\n- Q4: PMOS transistor with ports S: VCC, D: X2, G: VB34\n- Q5: NPN transistor with ports C: X4, B: vEA, E: VEE\n- Q6: NPN transistor with ports C: X3, B: vEA, E: VEE\n- Q7: PMOS transistor with ports S: VCC, D: X3, G: VB78\n- Q8: PMOS transistor with ports S: VCC, D: X4, G: VB78\n- I: Current source with value I, ports Np: P, Nn: VEE\n- R: Resistor with value R, ports N1: vOP, N2: vON\n- 1: Buffer with ports In: X1, Out: vOP\n- 1: Buffer with ports In: X2, Out: vON\n- EA: Operational amplifier with ports InP: vOP, InN: vON, Out: VOC(set)\n\nAdditional Information:\nThis circuit is a fully differential bipolar operational amplifier featuring a folded-cascode configuration. It incorporates current mirrors and differential pairs to achieve high gain and common-mode rejection. The design uses PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\nThis adjustment results in a perfectly symmetrical structure. (To prevent clutter, the specifics of the biasing network have been excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. In practical implementations, $Q_{5}$ and $Q_{6}$ are often cascoded to increase gain, but here the focus is on the fundamental aspects.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another significant feature is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). This network's role is to appropriately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), typically at the midpoint to maximize the output voltage swing. Specifically, the resistor pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA compares with the externally provided voltage $V_{O C(s e t)}$, and adjusts its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, consider that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is referred to as a servo loop."
},
{
    "text": "Figure 5.50 illustrates how the folded-cascode bipolar configuration from Fig. $4.71 a$ can be transformed into a fully differential operational amplifier. The initial key modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. \n\nimage_name:Figure 5.50\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nextrainfo:This circuit is a fully differential bipolar operational amplifier with a folded-cascode structure. It incorporates current mirrors and differential pairs to achieve high gain and common-mode rejection. The design uses PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\nThis adjustment results in a perfectly symmetrical structure. (To prevent clutter, the specifics of the biasing network have been excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. In practical implementations, $Q_{5}$ and $Q_{6}$ are typically cascoded to increase gain, but here the focus is on the fundamental aspects.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another significant feature is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). This network's role is to accurately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), usually halfway to maximize the output voltage swing. Specifically, the resistor pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA compares with the externally provided voltage $V_{O C(s e t)}$, and adjusts its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, note that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$, respectively. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is considered to form a servo loop."
},
{
    "text": "Figure 5.50 illustrates the transformation of the folded-cascode bipolar structure from Fig. $4.71 a$ into a fully differential operational amplifier. The key initial modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. This\nimage_name:Figure 5.50\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nextrainfo:This circuit is a fully differential bipolar operational amplifier with a folded-cascode configuration. It incorporates current mirrors and differential pairs to achieve high gain and common-mode rejection. The circuit uses PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\ncreates a perfectly symmetrical structure. (To prevent clutter, the specifics of the biasing network have been excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. Additionally, in practical implementations, $Q_{5}$ and $Q_{6}$ are often cascoded to enhance gain, but here the focus is on the fundamental aspects.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another crucial element is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). This network's role is to accurately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), typically at the midpoint to maximize the output voltage swing. Specifically, the resistance pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA then compares to the externally provided voltage $V_{O C(s e t)}$, adjusting its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, consider that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terminology, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is known as a servo loop."
},
{
    "text": "Figure 5.50 illustrates how the folded-cascode bipolar structure from Fig. $4.71 a$ can be transformed into a fully differential operational amplifier. The primary modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. \n\nimage_name: Figure 5.50\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nextrainfo: This circuit is a fully differential bipolar operational amplifier featuring a folded-cascode configuration. It incorporates current mirrors and differential pairs to enhance gain and common-mode rejection. The design employs PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\nThis results in a perfectly symmetrical structure. (To prevent clutter, the biasing network details are omitted, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. In practical implementations, $Q_{5}$ and $Q_{6}$ are often cascoded to increase gain, but here we focus on the fundamentals.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another key feature is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). This network's role is to accurately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), typically halfway to maximize the output voltage swing. Specifically, the resistance pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA compares with the externally provided voltage $V_{O C(s e t)}$, adjusting its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, consider that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is referred to as a servo loop."
},
{
    "text": "Figure 5.50 illustrates how the folded-cascode bipolar configuration of Fig. $4.71 a$ can be transformed into a fully differential operational amplifier. The initial significant modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. This\nimage_name:Figure 5.50\ndescription:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nextrainfo:This circuit is a fully differential bipolar operational amplifier with a folded-cascode structure. It incorporates current mirrors and differential pairs to achieve high gain and common-mode rejection. The circuit employs PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\ncreates a perfectly symmetrical structure. (To prevent clutter, the specifics of the biasing network have been excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$. Additionally, in practical implementations, $Q_{5}$ and $Q_{6}$ are typically cascoded to enhance gain, but here we focus solely on the fundamentals.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another crucial aspect is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). Its role is to appropriately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), usually at the midpoint to maximize the output voltage swing. Specifically, the resistor pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA then compares to the externally provided voltage $V_{O C(s e t)}$, and adjusts its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, consider that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$, respectively. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is known as a servo loop."
},
{
    "text": "Figure 5.50 illustrates how the folded-cascode bipolar configuration depicted in Fig. $4.71 a$ can be transformed into a fully differential operational amplifier. A key modification involves $Q_{5}$, which was previously diode-connected but is now functioning as a current-sink active load, similar to $Q_{6}$. \n\nImage Description:\n[\nname: Q1, type: NPN, ports: {C: X1, B: vP, E: P}\nname: Q2, type: NPN, ports: {C: X2, B: vN, E: P}\nname: Q3, type: PMOS, ports: {S: VCC, D: X1, G: VB34}\nname: Q4, type: PMOS, ports: {S: VCC, D: X2, G: VB34}\nname: Q5, type: NPN, ports: {C: X4, B: vEA, E: VEE}\nname: Q6, type: NPN, ports: {C: X3, B: vEA, E: VEE}\nname: Q7, type: PMOS, ports: {S: VCC, D: X3, G: VB78}\nname: Q8, type: PMOS, ports: {S: VCC, D: X4, G: VB78}\nname: I, type: CurrentSource, value: I, ports: {Np: P, Nn: VEE}\nname: R, type: Resistor, value: R, ports: {N1: vOP, N2: vON}\nname: 1, type: Buffer, ports: {In: X1, Out: vOP}\nname: 1, type: Buffer, ports: {In: X2, Out: vON}\nname: EA, type: OpAmp, ports: {InP: vOP, InN: vON, Out: VOC(set)}\n]\nAdditional Information: This circuit is a fully differential bipolar operational amplifier with a folded-cascode structure, incorporating current mirrors and differential pairs for high gain and common-mode rejection. It uses PMOS and NPN transistors for amplification and buffering, with biasing provided by VB78 and VB34.\n\nFIGURE 5.50 Simplified fully differential bipolar op amp.\nThis adjustment results in a perfectly symmetrical structure. (To prevent clutter, the biasing network details have been excluded, showing only the base-bias voltages $V_{B 78}$ and $V_{B 34}$; also, in practical implementations, $Q_{5}$ and $Q_{6}$ are often cascoded to increase gain, but here we focus on the fundamentals.) The high-resistance collector nodes of the $Q_{3}-Q_{5}$ and $Q_{4}-Q_{6}$ pairs are buffered through unity-gain push-pull stages to produce $v_{O P}$ and $v_{O N}$. Another crucial aspect is the matched $R-R$ pair and the error amplifier EA, which together form the common-mode feedback network (CMFN). Its role is to accurately center $v_{O P}$ and $v_{O N}$ within the allowable output voltage range (OVR), typically halfway to maximize the output voltage swing. Specifically, the resistor pair generates the voltage $\\left(v_{O P}+v_{O N}\\right) / 2$, which the EA compares with the externally provided voltage $V_{O C(s e t)}$, and adjusts its output $v_{E A}$ to drive $\\left(v_{O P}+v_{O N}\\right) / 2$ towards $V_{O C(\\text { set })}$. To understand this, note that $v_{O P}$ and $v_{O N}$ are the voltages where the pull-up actions of $Q_{3}$ and $Q_{4}$ balance the pull-down actions of $Q_{5}$ and $Q_{6}$, respectively. Thus, increasing or decreasing $v_{E A}$ strengthens or weakens the pull-down action relative to the pull-up, shifting $v_{O P}$ and $v_{O N}$ up or down the OVR. In control theory terms, the negative-feedback loop consisting of the $R-R$ pair, the $E A$, the $Q_{5}-Q_{6}$ pair, and the buffers is considered a servo loop."
},
{
    "text": "Figure 5.51 illustrates the transformation of the folded-cascode CMOS operational amplifier from Figure 5.17 into a fully differential configuration. The biasing network details are excluded, displaying only the gate bias voltages $V_{G 78}$ and $V_{G 56}$. For balanced output, $M_{5}$ and $M_{7}$, previously connected as diodes, now function as current sources. This circuit is depicted as a fully differential CMOS operational amplifier of the folded-cascode variety, with the CMFN network composed of transistors M12 through M16, ensuring balanced outputs. The biasing network specifics are omitted, and only gate bias voltages VG78 and VG56 are shown. Transistors M5 and M7 function as current sources rather than being diode-connected, contributing to balanced output.\n\nThe CMFN is an all-transistor network consisting of $M_{12}$ through $M_{16}$. To understand its operation, consider the following:\n\n- Initially assume $v_{P}=v_{N}$, so $v_{O P}=v_{O N}$. Also, assume $v_{O P}=v_{O N}=V_{O C(\\mathrm{set})}$, causing the two $I$ sources to split equally between the SC pairs, resulting in $I_{D 12}=I_{D 13}=0.5 I$ and $I_{D 14}=I_{D 15}=0.5 I$. The diode-connected FET $M_{16}$ draws $I_{D 16}=I_{D 13}+I_{D 14}=I$, which $M_{9}$ and $M_{10}$ then mirror to provide the bias currents for $M_{3}$ and $M_{4}$ (refer also to Fig. 5.16). As we know, $v_{O P}$ and $v_{O N}$ represent the voltages at which the pull-up actions by $M_{5}$ and $M_{6}$ balance, respectively, the pull-down actions by $M_{3}$ and $M_{4}$.\n- Suppose now that for some reason $v_{O P}$ and $v_{O N}$ attempt to rise above $V_{O C(\\text { set })}$. Then, $M_{12}$ and $M_{15}$ will become less conductive, while $M_{13}$ and $M_{14}$ will conduct more, raising $I_{D 16}$. By mirror action, this will raise $I_{D 9}$ and $I_{D 10}$, enhancing the pulldown action by $M_{3}$ and $M_{4}$, forcing $v_{O P}$ and $v_{O N}$ to drop back to $V_{O C(\\mathrm{set})}$. By symmetric reasoning, if $v_{O P}$ and $v_{O N}$ attempt to drop below $V_{O C(\\mathrm{set})}, M_{13}$ and $M_{14}$ will conduct less, decreasing $I_{D 16}$ and thus reducing the pull-down action by $M_{3}$ and $M_{4}$. The pull-up action by $M_{5}$ and $M_{6}$ will now prevail, forcing $v_{O P}$ and $v_{O N}$ to rise back to $V_{O C(\\text { set })}$.\n- Now, applying an ac signal across the inputs generates symmetric swings $v_{O P}=V_{O C(\\mathrm{set})}+v_{O D} / 2$ and $v_{O N}=V_{O C(\\mathrm{set})}-v_{O D} / 2$. These swings will imbalance the differential pairs, resulting in $i_{D 15}=0.5 I-i$ and $i_{D 14}=0.5 I+i$, and $i_{D 12}=0.5 I+i$ and $i_{D 13}=0.5 I-i$, for some current change $i$. However, $M_{16}$ still draws\n\n$$\ni_{D 16}=i_{D 13}+i_{D 14}=0.5 I-i+0.5 I+i=I\n$$\n\nindicating that the servo loop provided by the CMFN maintains the value of $\\left(v_{O P}+v_{O N}\\right) / 2$ near $V_{O C(\\mathrm{set})}$ regardless of the ac signals present. This holds true as long as none of the transistors is forced out of its active region.\n\nDetermine the small-signal gain $v_{o d} / v_{i d}$ of the op amp of Fig. 5.51, assuming the parameters of Example 5.4. Compare with the example and comment.\n\n#### Solution\n\nThe circuit of Fig. 5.51 is symmetric about the vertical axis extending from node $V_{G 78}$, so we use the half-circuit ac equivalent of Fig. 5.52. By inspection, $R_{o}=R_{d 5} / / R_{d 3}$, where $R_{d 5}$ and $R_{d 3}$ are the ac resistances observed looking into the drains of $M_{5}$ and $M_{3}$. Using inspection again, we write\n\n$$\nR_{o}=\\left[r_{o 5}+r_{o 7}+\\left(g_{m 5}+g_{m b 5}\\right) r_{o 5} r_{o 7}\\right] / /\\left[r_{o 3}+\\left(r_{o 9} / / r_{o 1}\\right)+\\left(g_{m 3}+g_{m b 3}\\right) r_{o 3}\\left(r_{o 9} / / r_{o 1}\\right)\\right]\n$$\n\nThis is formally identical to Eq. (5.39), so we reuse Example 5.4 to write $R_{o} \\cong$ $5.22 \\mathrm{M} \\Omega$. We also have $i_{1}=g_{m 1}\\left(v_{i d} / 2\\right)=(0.4 \\mathrm{~mA} / \\mathrm{V}) \\times\\left(v_{i d} / 2\\right)$. Following the line of reasoning of Example 5.4, we can state that most of $i_{1}$ flows out of $M_{3}$, so\n\n$$\n-\\frac{v_{o d}}{2} \\cong-R_{o} i_{1}=-g_{m 1} R \\frac{v_{o d}}{2}\n$$\n\nConsequently, $v_{o d} / v_{i d}=g_{m 1} R_{o} \\cong 0.4 \\times 5,220=2,088 \\mathrm{~V} / \\mathrm{V}$. The single-ended signal $v_{o}$ of Example 5.4 now splits between the two opposite halves $v_{o p}$ and $v_{o n}$, so the gain remains unchanged.\n\nFigure 5.53 shows how the two-stage CMOS op amp of Fig. 5.13 can be transformed into a fully differential type (again, the biasing details are omitted for simplicity). In this version, the CMFN is the complement of that in Fig. 5.51, as it is designed to adjust the current of a $p$ MOSFET, specifically, the tail current supplied by $M_{9}$ (clearly, there are various ways to design a CMFN).\nThis is a fully differential two-stage CMOS operational amplifier. It incorporates a common-mode feedback network for differential operation. The circuit is designed to expand the input voltage range by biasing specific transistors at the edge of saturation.\n\n#### Expanding the Input Voltage Range\n\nIf we specify $V_{G 34}$ in the folded-cascode op amp of Fig. 5.51 to bias the $M_{9}-M_{10}$ pair precisely at the edge of saturation $\\left(V_{D S 9}=V_{O V 9}\\right.$ and $\\left.V_{D S 10}=V_{O V 10}\\right)$, then, the input voltage range (IVR) is defined by Eq. (5.41). For instance, suppose we have a single-supply system with $V_{S S}=0$ and $V_{D D}=3 \\mathrm{~V}$, and let $\\left|V_{t 1}\\right|=0.75 \\mathrm{~V}$ and $V_{O V}=0.25 \\mathrm{~V}$ throughout. Then, the common-mode input voltage $v_{I C}=1 / 2\\left(v_{P}+v_{N}\\right)$ is such that\n\n$$\n\\begin{aligned}\n& v_{I C(\\min )}=V_{S S}+V_{O V 9}-\\left|V_{t \\mid}\\right|=0+0.25-0.75=-0.5 \\mathrm{~V} \\\\\n& v_{I C(\\max )}=V_{D D}-V_{O V 11}-V_{O V 1}-\\left|V_{t 1}\\right|=3-0.25-0.25-0.75=1.75 \\mathrm{~V}\n\\end{aligned}\n$$\n\nWhile the lower limit is quite desirable because it allows us to lower the inputs all the way down to the ground rail, and even $0.5-\\mathrm{V}$ below, without causing any malfunction, the upper limit is generally too restrictive, especially in a low-supply situation such as the $3-\\mathrm{V}$ case considered here. Ideally, we want the IVR to extend from rail to rail and possibly beyond by, say, a $0.5-\\mathrm{V}$ margin (from -0.5 V to 3.5 V in our example). If we were to use the dual op amp realization by interchanging $p$ MOSFETs and $n$ MOSFETs as well as interchanging the power supplies (see Fig. P5.21), then the $n$-type input pair would exhibit the dual constraints $v_{I C(\\min )}=1.25 \\mathrm{~V}$ and $v_{I C(\\max )}=$ 3.5 V. In other words, while a $p$-type input stage works well near $V_{S S}$ but degrades near $V_{D D}$, an $n$-type works well near $V_{D D}$ but degrades near $V_{S S}$, just the opposite.\n\nThe above considerations provide the basis for the ingenious solution of Fig. 5.54, which uses both input-stage types to achieve the best of both. (The CMFN, not shown to avoid cluttering the schematic, can be made to adjust either $V_{G 78}$ or $V_{G 910}$, or both.) Assuming again $V_{t n}=-V_{t p}=0.75 \\mathrm{~V}$ and $V_{O V}=0.25 \\mathrm{~V}$ throughout, we note the following:\n\n- For $v_{I C}<V_{S S}+V_{O V 11 n}+V_{t n}\\left(=1 \\mathrm{~V}\\right.$ for $\\left.V_{S S}=0\\right)$ the $M_{1 n}-M_{2 n}$ pair is off, whereas the $M_{1 p}-M_{2 p}$ pair is fully operational, so we rewrite Eq. (5.38) as $G_{m}=g_{m 1 p}$.\n- Raising $v_{I C}$ above 1 V will gradually turn on the $M_{1 n}-M_{2 n}$ pair until both pairs are fully operational once we pass the $1.25-\\mathrm{V}$ mark. For $1.25 \\mathrm{~V} \\leq v_{I C} \\leq 1.75 \\mathrm{~V}$ the two pairs work in tandem, giving $G_{m}=g_{m 1 p}+g_{m 1 n}$.\n- Raising $v_{I C}$ above 1.75 V will gradually turn off the $M_{1 p}-M_{2 p}$ pair while the $M_{1 n}-M_{2 n}$ pair continues to be fully operational.\n- For $v_{I C}>V_{D D}-V_{O V 11 p}-\\left|V_{t p}\\right|\\left(=2 \\mathrm{~V}\\right.$ for $\\left.V_{D D}=3 \\mathrm{~V}\\right)$ the $M_{1 p}-M_{2 p}$ pair is totally off, so the circuit gives $G_{m}=g_{m 1 n}$.\n- So long as the $M_{7}-M_{8}$ and the $M_{9}-M_{19}$ pairs are biased at the edge of saturation, the output voltage swing (OVS) will extend to within two $V_{O V}$ of either supply rail. If a true rail-to-rail OVS is desired, then an ad-hoc output stage is required, such as the CS push-pull output stage of Section 4.11.\n\nFigure 5.55 shows the bipolar version of Fig. 5.54. To maximize the IVR, $V_{B 34}$ is set to bias the $Q_{9}-Q_{10}$ pair slightly above the edge of saturation, say at $V_{C E 9}=V_{C E 10} \\cong$ 0.25 V. Similarly, $V_{B 56}$ is set so that $V_{E C 7}=V_{E C 8} \\cong 0.25 \\mathrm{~V}$. Then, assuming B-E voltage drops of 0.65 V, we have $v_{I C(\\min )}=V_{E E}+2 \\times 0.25-0.65=V_{E E}-0.15 \\mathrm{~V}$\nand $v_{I C(\\max )}=V_{D D}+0.15 \\mathrm{~V}$. In some embodiments, the $Q_{7}-Q_{8}$ and $Q_{9}-Q_{10}$ pairs are replaced by resistor pairs ${ }^{1}$ to develop the voltage drops of about 0.25 V required to prevent the input pairs from saturating in the vicinity of the supply rails.\n\nA significant issue with the op amps of Figs. 5.54 and 5.55 is that near the lower end of the IVR, the input offset voltage of the $p$-type pair dominates, whereas near the upper end, that of the $n$-type pair dominates. So, as $v_{I C}$ changes from one end to the other of the IVR, the net input offset voltage will generally change in magnitude and possibly in polarity, depending on the magnitudes and directions of the individual mismatches. In the bipolar case, the input bias current may also pose problems: at the lower end, it coincides with the base current of the $p$-type pair, flowing out of the op amp, but at the higher end, it coincides with that of the $n$-type pair, flowing into the op amp. At intermediate IVR values, both pairs are on, and the base currents of the $p$-type pair tend to cancel those of the $n$-type pair. Consequently, input bias-current magnitude and direction are strong functions of $v_{I C}$."
},
{
    "text": "Figure 5.51 illustrates the transformation of the folded-cascode CMOS operational amplifier depicted in Fig. 5.17 into a fully differential configuration. As with the previous figure, the specifics of the biasing network are not detailed, with only the gate-bias voltages, $V_{G78\nI apologize for the confusion, but it seems there was a misunderstanding. The text provided appears to be a mix of descriptive\nCertainly! It seems you would like the text to be rephrased while maintaining its original meaning and length. Below is the rephrased version of the provided text:\n\n---\n\nFigure 5.51 demonstrates\nCertainly\nCertainly! Here's the rephrased version of the provided text:\n\n---\n\nFigure 5.51 depicts the conversion of the folded-cascode CMOS operational amplifier from Figure 5.17 into a fully differential variant. Similar to the previous illustration, the intricacies of the biasing network are not elaborated upon, and only the gate-bias voltages $V_{G 78}$ and $V_{G 56}$ are depicted. For the purpose of achieving balanced outputs, transistors $M_{5}$ and $M_{7}$, which were previously connected as diodes, are now functioning as current sources.\n\nThe image description outlines\nI apologize for the oversight earlier. Here is the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 illustrates the adaptation of the folded-cascode CMOS operational amplifier from Figure 5.17 into a fully differential configuration. As in the previous figure, the specifics\nCertainly! Here's the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 presents the adaptation\nCertainly\nCertainly! Here's the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 illustrates the adaptation\nI apologize for the confusion. Here is the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 displays\nCertainly\nI apologize for the confusion. Here is the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 portrays the conversion of the folded-cascode CMOS operational amplifier from Figure 5.17 into a fully differential version. As with the previous figure, the specifics of the biasing network are not detailed, with only the gate-bias voltages $V_{G 78}$ and $V_{G 56}$ being shown. To ensure balanced outputs, transistors $M_{5}$ and $M_{7}$, which were previously connected as diodes, are now operated as current sources.\n\nThe circuit depicted is a fully differential CMOS operational amplifier of the folded-cascode type. The CMFN network, consisting of transistors M12 through M16, is responsible for maintaining balanced outputs. The details of the biasing network are omitted, with only the gate-bias voltages VG78 and VG56 being shown. Transistors M5 and M7, instead of being diode-connected, now function as current sources to contribute to balanced output.\n\n---\n\n, the CMFN is an all-transistor network consisting of $M_{12}$ through $M_{16}$. To understand its operation, consider the following:\n\n- Begin, assume $v_{P}=v_{N}$, leading to $v_{O P}=v_{O N}$. Also, assume $v_{O P}=v_{O N}=V_{O C(\\mathrm{set})}$, causing the two $I$ sources to split equally between the SC pairs, resulting in $I_{D 12}=I_{D 13}=0.5 I$ and $I_{D 14}=I_{D 15}=0.5 I$. The diode-connected FET $M_{16}$ draws $I_{D 16}=I_{D 13}+I_{D 14}=I$, which $M_{9}$ and $M_{10}$ then mirror to provide the bias currents for $M_{3}$ and $M_{4}$ (refer also to Fig. 5.16). As we know, $v_{O P}$ and $v_{O N}$ represent the voltages at which the pull-up actions by $M_{5}$ and $M_{6}$ balance, respectively, the pull-down actions by $M_{3}$ and $M_{4}$.\n- Now, suppose $v_{O P}$ and $v_{O N}$ attempt to rise above $V_{O C(\\text { set })}$. Consequently\nCertainly! Here's the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 displays the adaptation\nI apologize for the confusion. Here is the rephrased text for the first part of the provided context:\n\n---\n\nFigure 5.51 illustrates the transformation of the folded-cascode CMOS operational amplifier from Figure 5.17 into a fully differential configuration. As with the previous figure, the specifics of the biasing network are not detailed, with only the gate-bias voltages $V_{G 78}$ and $V_{G 56}$ being shown. To ensure balanced outputs, transistors $M_{5}$ and $M_{7}$, which were previously connected as diodes, are now operated as current sources.\n\nThe circuit depicted is a fully differential CMOS operational amplifier of the folded-cascode type. The CMFN network, composed of transistors M12 through M16, is responsible for maintaining balanced outputs. The details of the biasing network are omitted, with only the gate-bias voltages VG78 and VG56 being shown. Transistors M5 and M7, instead of being diode-connected, now function as current sources to contribute to balanced output.\n\nMoreover, the CMFN is an all-transistor network consisting of $M_{12}$ through $M_{16}$. To understand its operation, consider the following:\n\n- Initially, assume $v_{P}=v_{N}$, leading to $v_{O P}=v_{O N}$. Also, assume $v_{O P}=v_{O N}=V_{O C(\\mathrm{set})}$, causing the two $I$ sources to split equally between the SC pairs, resulting in $I_{D 12}=I_{D 13}=0.5 I$ and $I_{D 14}=I_{D 15}=0.5 I$. The diode-connected FET $M_{16}$ draws $I_{D 16}=I_{D 13}+I_{D 14}=I$, which $M_{9}$ and $M_{10}$ then mirror to provide the bias currents for $M_{3}$ and $M_{4}$ (refer also to Fig. 5.16). As we know, $v_{O P}$ and $v_{O N}$ represent the voltages at which the pull-up actions by $M_{5}$ and $M_{6}$ balance, respectively, the pull-down actions by $M_{3}$ and $M_{4}$.\n- Now, suppose $v_{O P}$ and $v_{O N}$ attempt to rise above $V_{O C(\\text { set })}$."
},
{
    "text": "Figure 5.51 illustrates the conversion of the folded-cascode CMOS operational amplifier depicted in Figure 5.17 into a fully differential version. As in the previous diagrams, the specifics of the biasing network are not shown; only the gate bias voltages $V_{G78}$ and $V_{G56}$ are depicted. For balanced output, transistors $M_5$ and $M_7$, which were previously connected as diodes, are now functioning as current sources.\n\nThe depicted circuit is a fully differential CMOS operational amplifier based on the folded-cascode topology. The CMFN network, composed of transistors M12 through M16, is responsible for maintaining balanced outputs. The biasing network details are omitted, with only the gate bias voltages VG78 and VG56 shown. Transistors M5 and M7, which now operate as current sources instead of being diode-connected, contribute to the balanced output.\n\nFigure 5.51 represents a fully differential CMOS operational amplifier of the folded-cascode type.\n\nFurthermore, the CMFN is an all-transistor network consisting of $M_{12}$ through $M_{16}$. To understand its operation, consider the following:\n\n- Initially, assume $v_{P}=v_{N}$, resulting in $v_{OP}=v_{ON}$. Also, assume $v_{OP}=v_{ON}=V_{OC(set)}$, causing the two I sources to split equally between the SC pairs, yielding $I_{D12}=I_{D13}=0.5 I$ and $I_{D14}=I_{D15}=0.5 I$. The diode-connected FET $M_{16}$ draws $I_{D16}=I_{D13}+I_{D14}=I$, which $M_{9}$ and $M_{10}$ then mirror to provide the bias currents for $M_{3}$ and $M_{4}$ (refer also to Fig. 5.16). As we know, $v_{OP}$ and $v_{ON}$ represent the voltages at which the pull-up actions by $M_{5}$ and $M_{6}$ balance, respectively, the pull-down actions by $M_{3}$ and $M_{4}$.\n- Now, suppose $v_{OP}$ and $v_{ON}$ attempt to rise above $V_{OC(set)}$. Then, $M_{12}$ and $M_{15}$ will become less conductive, while $M_{13}$ and $M_{14}$ will conduct more, thereby increasing $I_{D16}$. By mirror action, this will increase $I_{D9}$ and $I_{D10}$, boosting the pull-down action by $M_{3}$ and $M_{4}$ and forcing $v_{OP}$ and $v_{ON}$ back to $V_{OC(set)}$. By symmetric reasoning, if $v_{OP}$ and $v_{ON}$ attempt to drop below $V_{OC(set)}$, $M_{13}$ and $M_{14}$ will conduct less, decreasing $I_{D16}$ and thus reducing the pull-down action by $M_{3}$ and $M_{4}$. The pull-up action by $M_{5}$ and $M_{6}$ will now prevail, forcing $v_{OP}$ and $v_{ON}$ back to $V_{OC(set)}$.\n- Applying an ac signal across the inputs generates symmetric swings $v_{OP}=V_{OC(set)}+v_{OD}/2$ and $v_{ON}=V_{OC(set)}-v_{OD}/2$. These swings will imbalance the differential pairs, resulting in $i_{D15}=0.5 I-i$ and $i_{D14}=0.5 I+i$, and $i_{D12}=0.5 I+i$ and $i_{D13}=0.5 I-i$, for some current change $i$. However, $M_{16}$ still draws\n\n$$\ni_{D16}=i_{D13}+i_{D14}=0.5 I-i+0.5 I+i=I\n$$\n\nindicating that the servo loop provided by the CMFN keeps the value of $(v_{OP}+v_{ON})/2$ near $V_{OC(set)}$ regardless of the ac signals present. This holds true as long as none of the transistors is forced out of its active region.\n\nFind the small-signal gain $v_{oD}/v_{iD}$ of the op amp of Figure 5.51, assuming the parameters of Example 5.4. Compare with the example and comment.\n\n#### Solution\n\nThe circuit of Figure 5.51 is perfectly symmetric about the vertical axis running down from node $V_{G78}$, so we work with the half-circuit ac equivalent of Figure 5.52. By inspection, $R_{o}=R_{d5} || R_{d3}$, where $R_{d5}$ and $R_{d3}$ are the ac resistances seen looking into the drains of $M_{5}$ and $M_{3}$. Using again inspection we write\n\n$$\nR_{o}=\\left[r_{o5}+r_{o7}+\\left(g_{m5}+g_{mb5}\\right) r_{o5} r_{o7}\\right] || \\left[r_{o3}+\\left(r_{o9} || r_{o1}\\right)+\\left(g_{m3}+g_{mb3}\\right) r_{o3}\\left(r_{o9} || r_{o1}\\right)\\right]\n$$\n\nThis is formally identical to Eq. (5.39), so we recycle Example 5.4 to write $R_{o} \\cong$ $5.22 \\mathrm{M}\\Omega$. We also have $i_{1}=g_{m1}(v_{iD}/2)=(0.4 \\mathrm{~mA}/\\mathrm{V}) \\times (v_{iD}/2)$. Following the line of reasoning of Example 5.4, we can state that most of $i_{1}$ flows out of $M_{3}$, so\n\n$$\n-\\frac{v_{oD}}{2} \\cong -R_{o} i_{1}=-g_{m1} R \\frac{v_{oD}}{2}\n$$\n\nFigure 5.52 represents a half-circuit equivalent of the op amp of Figure 5.51.\n\nConsequently, $v_{oD}/v_{iD}=g_{m1} R_{o} \\cong 0.4 \\times 5,220=2,088 \\mathrm{~V}/\\mathrm{V}$. The single-ended signal $v_{o}$ of Example 5.4 now splits between the two opposite halves $v_{oP}$ and $v_{oN}$, so the gain is unchanged.\n\nFigure 5.53 shows how the two-stage CMOS op amp of Figure 5.13 can be transformed into a fully differential type (once again, the biasing details are omitted for simplicity). In this version, the CMFN is complementary to that of Figure 5.51 because it is designed to adjust the current of a $p$ MOSFET, specifically the tail current supplied by $M_{9}$ (indicating that there are various ways to design a CMFN).\n\nFigure 5.53 represents a fully differential two-stage CMOS operational amplifier.\n\n#### Expanding the Input Voltage Range\n\nIf we specify $V_{G34}$ in the folded-cascode op amp of Figure 5.51 to bias the $M_{9}-M_{10}$ pair right at the edge of saturation $(V_{DS9}=V_{OV9}$ and $V_{DS10}=V_{OV10})$, then the input voltage range (IVR) is defined by Eq. (5.41). For instance, suppose we have a single-supply system with $V_{SS}=0$ and $V_{DD}=3 \\mathrm{~V}$, and let $|V_{t1}|=0.75 \\mathrm{~V}$ and $V_{OV}=0.25 \\mathrm{~V}$ throughout. Then, the common-mode input voltage $v_{IC}=1/2(v_{P}+v_{N})$ is such that\n\n$$\n\\begin{aligned}\n& v_{IC(min)}=V_{SS}+V_{OV9}-|V_{t1}|=0+0.25-0.75=-0.5 \\mathrm{~V} \\\\\n& v_{IC(max)}=V_{DD}-V_{OV11}-V_{OV1}-|V_{t1}|=3-0.25-0.25-0.75=1.75 \\mathrm{~V}\n\\end{aligned}\n$$\n\nWhile the lower limit is quite desirable because it allows us to lower the inputs all the way down to the ground rail, and even $0.5-\\mathrm{V}$ below, without causing any malfunction, the upper limit is generally too restrictive, especially in a low-supply situation such as the $3-\\mathrm{V}$ case considered here. Ideally, we want the IVR to extend from rail to rail and possibly beyond by, say, a $0.5-\\mathrm{V}$ margin (from -0.5 V to 3.5 V in our example). If we were to use the dual op amp realization by interchanging $p$ MOSFETs and $n$ MOSFETs as well as interchanging the power supplies (see Fig. P5.21), then the $n$-type input pair would exhibit the dual constraints $v_{IC(min)}=1.25 \\mathrm{~V}$ and $v_{IC(max)}=$ 3.5 V. In other words, while a $p$-type input stage works well near $V_{SS}$ but goes off near $V_{DD}$, an $n$-type works well near $V_{DD}$ but goes off near $V_{SS}$, just the opposite.\n\nThe above considerations provide the basis for the ingenious solution of Figure 5.54, which uses both input-stage types to get the best of both. (The CMFN, not shown to avoid cluttering the schematic, can be made to adjust either $V_{G78}$ or $V_{G910}$, or both.) Assuming again $V_{tn}=-V_{tp}=0.75 \\mathrm{~V}$ and $V_{OV}=0.25 \\mathrm{~V}$ throughout, we note the following:\n\n- For $v_{IC}<V_{SS}+V_{OV11n}+V_{tn}$(=1 \\mathrm{~V} for $V_{SS}=0)$, the $M_{1n}-M_{2n}$ pair is off, whereas the $M_{1p}-M_{2p}$ pair is fully operational, so we rewrite Eq. (5.38) as $G_{m}=g_{m1p}$.\n- Raising $v_{IC}$ above 1 V will gradually turn on the $M_{1n}-M_{2n}$ pair until both pairs are fully operational once we pass the $1.25-\\mathrm{V}$ mark. For $1.25 \\mathrm{~V} \\leq v_{IC} \\leq 1.75 \\mathrm{~V}$, the two pairs work in tandem, giving $G_{m}=g_{m1p}+g_{m1n}$.\n- Raising $v_{IC}$ above 1.75 V will gradually turn off the $M_{1p}-M_{2p}$ pair while the $M_{1n}-M_{2n}$ pair continues to be fully operational.\n- For $v_{IC}>V_{DD}-V_{OV11p}-|V_{tp}|$(=2 \\mathrm{~V} for $V_{DD}=3 \\mathrm{~V}$), the $M_{1p}-M_{2p}$ pair is totally off, so the circuit gives $G_{m}=g_{m1n}$.\n- So long as the $M_{7}-M_{8}$ and the $M_{9}-M_{19}$ pairs are biased at the edge of saturation, the output voltage swing (OVS) will extend to within two $V_{OV}$ of either supply rail. If a true rail-to-rail OVS is desired, then an ad-hoc output stage is required, such as the CS push-pull output stage of Section 4.11.\n\nFigure 5.55 is the bipolar version of Figure 5.54. To maximize the IVR, $V_{B34}$ is set to bias the $Q_{9}-Q_{10}$ pair slightly above the edge of saturation, say at $V_{CE9}=V_{CE10} \\cong$ 0.25 V. Likewise, $V_{B56}$ is set so that $V_{EC7}=V_{EC8} \\cong 0.25 \\mathrm{~V}$. Then, assuming B-E voltage drops of 0.65 V, we have $v_{IC(min)}=V_{EE}+2 \\times 0.25-0.65=V_{EE}-0.15 \\mathrm{~V}$\nand $v_{IC(max)}=V_{DD}+0.15 \\mathrm{~V}$. In some embodiments, the $Q_{7}-Q_{8}$ and $Q_{9}-Q_{10}$ pairs are replaced by resistor pairs ${ }^{1}$ to develop the voltage drops of about 0.25 V that are required to prevent the input pairs from saturating in the vicinity of the supply rails.\n\nA notorious issue with the op amps of Figures 5.54 and 5.55 is that near the lower end of the IVR, the input offset voltage of the $p$-type pair dominates, whereas near the upper end, that of the $n$-type pair dominates. So, as $v_{IC}$ changes from one end to the other of the IVR, the net input offset voltage will generally change in magnitude and possibly in polarity, depending on the magnitudes and directions of the individual mismatches. In the bipolar case, the input bias current may also pose problems: at the lower end, it coincides with the base current of the $p$-type pair, flowing out of the op amp, but at the higher end, it coincides with that of the $n$-type pair, flowing into the op amp. At intermediate IVR values, both pairs are on, and the base currents of the $p$-type pair tend to cancel those of the $n$-type pair. Consequently, input bias-current magnitude and direction are strong functions of $v_{IC}$."
}
]