# Effect of Negative Feedback on the Frequency Bandwidth

Negative feedback has a profound effect also on the frequency response. In fact, if used carelessly, it may lead to unwanted oscillation, in which case suitable measures need to be taken to stabilize the system. Though the subject of stability will be treated in detail later in this chapter, here we examine the effect of feedback upon two op amp representatives, the voltage-feedback amplifier (VFA) and the current-feedback amplifier (CFA).

Let us start out with the noninverting VFA configuration of Fig. 7.2, repeated in Fig. 7.10a for convenience. As seen in Chapter 6, the open-loop gain of the VFA is of the type

$$
\begin{equation*}
a(j f) \cong \frac{a_{0}}{1+j f / f_{b}} \tag{7.19}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-001.jpg?height=355&width=429&top_left_y=1673&top_left_x=206)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-001.jpg?height=462&width=637&top_left_y=1570&top_left_x=736)
(b)

FIGURE 7.10 (a) Noninverting VFA configuration. (b) Visualizing the open-Ioop response $|a|$ and the closed-loop response $|A|$, both in dB.
where $f$ is the input-signal frequency, $a_{0}$ is the $d c$ gain, and $f_{b}$ is the open-loop bandwidth. As depicted in Fig. 7.10b, the gain $a$ is high $\left(\cong a_{0}\right)$ from dc up to $f_{b}$, after which it rolls off with $f$ at the rate of $-20 \mathrm{~dB} /$ decade. As we know, an important figure of merit of such an amplifier is its gain-bandwidth product

$$
\begin{equation*}
\mathrm{GBP}=a_{0} \times f_{b}=f_{t} \tag{7.20}
\end{equation*}
$$

For instance, the popular 741 op amp has $a_{0}=200,000 \mathrm{~V} / \mathrm{V}$ and $f_{b}=5 \mathrm{~Hz}$, so GBP $=200,000 \times 5=1 \mathrm{MHz}$. The closed-loop gain is, by Eqs. (7.6) and (7.7),

$$
A(j f)=\frac{V_{o}}{V_{i}}=\frac{1}{b} \frac{1}{1+\frac{1+j f / f_{b}}{b a_{0}}}=\frac{1}{b} \times \frac{1}{1+1 /\left(b a_{0}\right)} \times \frac{1}{1+\frac{j f}{\left(1+b a_{0}\right) f_{b}}}
$$

where $b=1 /\left(1+R_{2} / R_{1}\right)$, by Eq. (7.13). This is put in the more insightful form

$$
\begin{equation*}
A(j f)=\frac{A_{0}}{1+j f / f_{B}} \tag{7.21}
\end{equation*}
$$

where

$$
\begin{equation*}
A_{0}=\left(1+\frac{R_{2}}{R_{1}}\right) \times \frac{1}{1+1 /\left(b a_{0}\right)} \cong 1+\frac{R_{2}}{R_{1}} \tag{7.22}
\end{equation*}
$$

is the already familiar closed-loop dc gain, and

$$
\begin{equation*}
f_{B}=\left(1+b a_{0}\right) f_{b} \cong \frac{a_{0}}{A_{0}} f_{b}=\frac{f_{t}}{A_{0}} \tag{7.23}
\end{equation*}
$$

is the closed-loop bandwidth. (Again, note the use of lower-case letters to designate open-loop parameters, and upper-case letters to designate their closed-loop counterparts.) With reference to Fig. $7.10 b$ we observe that negative feedback, while reducing the dc gain from $a_{0}$ to $A_{0} \cong 1+R_{2} / R_{1}$, also expands the bandwidth from $f_{b}$ to $f_{B} \cong\left(a_{0} / A_{0}\right) f_{b}$, so the closed-loop GBP $\left(=A_{0} \times f_{B}=f_{t}\right)$ remains constant. Gainbandwidth tradeoff is exploited on purpose by the circuit designer to control amplifier dynamics.

EXAMPLE 7.6 (a) Let the non-inverting op amp of Fig. 7.2 be implemented with the popular 741 op amp , for which $a_{0}=200,000 \mathrm{~V} / \mathrm{V}$ and $f_{b}=5 \mathrm{~Hz}$. Estimate $A_{0}$ and $f_{B}$ if $R_{1}=1.0 \mathrm{k} \Omega$ and $R_{2}=999 \mathrm{k} \Omega$.
(b) Repeat if $R_{2}$ is lowered to $9.0 \mathrm{k} \Omega$.
(c) What is the closed-loop gain that results in the widest closed-loop bandwidth?

### Solution

(a) We have $A_{0} \cong 1 / b=1+R_{2} / R_{1}=1+999 / 1=1000 \mathrm{~V} / \mathrm{V}, a_{0} b=200,000 /$ $1000=200$, and $f_{B}=\left(1+a_{0} b\right) f_{b}=(1+200) 5 \cong 1.0 \mathrm{kHz}$.
(b) We now have $A_{0} \cong 10 \mathrm{~V} / \mathrm{V}, a_{0} b=20,000$, and $f_{B} \cong 100 \mathrm{kHz}$. Compared to part (a), $A_{0}$ has been reduced by two decades while $f_{B}$ has been increased by two decades.
(c) The widest bandwidth is achieved with $b=1$, that is, when we configure the op amp as a unity-gain voltage follower by replacing $R_{2}$ with a wire and removing $R_{1}$ altogether. Then, $A_{0} \cong 1 \mathrm{~V} / \mathrm{V}, a_{0} b=a_{0} \times 1=a_{0}$, and $f_{B}=$ $\left(1+a_{0}\right) f_{b} \cong a_{0} f_{b}=f_{t}=1 \mathrm{MHz}$.

Next, let us turn to the CFA amplifier of Fig. 7.11a. Recall from Eq. (6.114) that the CFA's open loop transimpedance gain is of the type

$$
\begin{equation*}
z(j f) \cong \frac{R_{e q}}{1+j f / f_{b}} \tag{7.24}
\end{equation*}
$$

where $f$ is the input-signal frequency, $R_{e q}$ is the dc gain, and $f_{b}$ is the open-loop bandwidth (the magnitude plot of $z$ is repeated in Fig. 7.11b for convenience). To find the closed-loop gain $A(j f)$, we adapt the expression for $A$ derived in Section 5.6, but with $R_{e q}$ replaced by $z(j f)$. The result is

$$
\begin{aligned}
A(j f) & =\frac{V_{o}}{V_{i}}=\left(1+\frac{R_{2}}{R_{1}}\right) \times \frac{1}{1+\frac{R_{2}\left(1+j f / f_{b}\right)}{R_{e q}}} \\
& =\left(1+\frac{R_{2}}{R_{1}}\right) \times \frac{1}{1+R_{2} / R_{e q}} \times \frac{1}{1+\frac{j f}{\left(1+R_{e q} / R_{2}\right) f_{b}}}
\end{aligned}
$$

We put this in the more insightful form

$$
\begin{equation*}
A(j f)=\frac{A_{0}}{1+j f / f_{B}} \tag{7.25}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-003.jpg?height=358&width=429&top_left_y=1634&top_left_x=206)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-003.jpg?height=473&width=666&top_left_y=1518&top_left_x=754)
(b)

FIGURE 7.11 (a) Noninverting CFA configuration. (b) Visualizing the open-loop response $|z|$ and the closed-loop bandwidth $f_{B}$.
where

$$
\begin{equation*}
A_{0}=\left(1+\frac{R_{2}}{R_{1}}\right) \times \frac{1}{1+R_{2} / R_{e q}} \cong 1+\frac{R_{2}}{R_{1}} \tag{7.26}
\end{equation*}
$$

is the already familiar closed-loop dc gain, and

$$
\begin{equation*}
f_{B}=\left(1+\frac{R_{e q}}{R_{2}}\right) f_{b} \cong \frac{R_{e q}}{R_{2}} \times \frac{1}{2 \pi R_{e q} C_{e q}}=\frac{1}{2 \pi R_{2} C_{e q}} \tag{7.27}
\end{equation*}
$$

is the closed-loop bandwidth (both approximations exploit the fact that in a welldesigned circuit we have $R_{2} \ll R_{e q}$ ). Using simple geometry we visualize $f_{B}$ as the frequency at which $|z|$ drops to $R_{2}$, as illustrated in Fig. 7.11b. This frequency is established by the user via $R_{2}$ regardless of the closed-loop gain $A_{0}$, which is set separately via $R_{1}$. Consequently, CFA circuits are not subject to the gain-bandwidth tradeoff of their VFA counterparts. Along with the absence of slew-rate limiting, this is a fundamental advantage of CFAs compared to VFAs. (See also Problem 7.10 for higher-order effects.)

EXAMPLE 7.7 Suppose the CFA of Fig. 7.11 has $R_{e q}=750 \mathrm{k} \Omega$ and $C_{e q}=2.21 \mathrm{pF}$. If the data sheets recommend using $R_{2}=1.2 \mathrm{k} \Omega$, specify $R_{1}$ for a closed-loop dc gain of $10 \mathrm{~V} / \mathrm{V}$. What is the closed-loop bandwidth?

### Solution

Imposing $1+1,200 / R_{1}=10$ gives $R_{1}=133.3 \Omega$. Moreover,

$$
f_{B} \cong \frac{1}{2 \pi R_{2} C_{e q}}=\frac{1}{2 \pi \times 1200 \times 2.21 \times 10^{-12}}=60 \mathrm{MHz}
$$

## 7.3 FEEDBACK TOPOLOGIES AND CLOSED-LOOP I/O RESISTANCES

The most basic parameters characterizing an amplifier are its unloaded gain, and its input and output resistances, also called the terminal resistances. These resistances come into play in actual application, when the amplifier is driven by a non-ideal input source and drives an output load. The input resistance forms a divider with the source's resistance, and the output resistance forms a divider with the load, thereby reducing the overall gain from source to load twice. This reduction is known as the loading effect. We will see next that besides stabilizing gain, negative feedback alters the terminal resistances in ways that tend to reduce the loading effect.

As mentioned, the input and output signals can be either currents or voltages, so we have four possible amplifier types: (a) the voltage amplifier, giving $v_{o}=A v_{i}$, $A$ in $\mathrm{V} / \mathrm{V} ;(b)$ the current amplifier, giving $i_{o}=A i_{i}, A$ in $\mathrm{A} / \mathrm{A} ;(c)$ the transresistance
amplifier, giving $v_{o}=A i_{i}, A$ in V/A; and (d) the transconductance amplifier, giving $i_{o}=A v_{i}, A$ in $\mathrm{A} / \mathrm{V}$. When negative feedback is applied around an amplifier, four different topologies arise. We wish to investigate how negative feedback affects gain as well as the terminal resistances of each configuration.

### The Series-Shunt Configuration

We start out by investigating the application of negative feedback around a voltage amplifier, the first of the aforementioned amplifier types. As shown in Fig. 7.12a, the amplifier's output port is modeled with a Th√©venin equivalent consisting of the dependent source $a v_{\varepsilon}$ and the series output resistance $r_{o}$. The input port, assumed to play a purely passive role, is modeled with the input resistance $r_{i}$. The quantities $a$, $r_{i}$, and $r_{o}$ are referred to as open-loop parameters, and are thus denoted with lowercase letters. The role of the feedback network is to sense the output voltage $v_{o}$ and produce a scaled version of it, or $v_{f}=b v_{o}$, such that $-v_{f}$ is then summed to the input $v_{i}$ to generate the error signal $v_{\varepsilon}=v_{i}-v_{f}$ Note that the operation of voltage sensing at the output is performed in parallel, or shunt, just as in ordinary voltmeter measurements (in the lab we always measure voltage in parallel, never in series!). However, the operation of voltage summing at the input is performed in series, which is how we connect together different voltage sources when we want to add or subtract their voltages-never connect different voltage sources in parallel!

To be able to focus on the effect of negative feedback upon $a, r_{i}$, and $r_{o}$ alone, irrespective of the surrounding circuitry's details, we deliberately assume the absence of any loading from both ports of the amplifier (the presence of loading encountered in practical circuits will be taken up in the next section). Thus, to prevent loading at the amplifier's input port, assume the $v_{i}$ and $b v_{o}$ sources have zero series resistances so we can write $v_{\varepsilon}=v_{i}-v_{f}$ (had these resistances been different from zero, we would have had voltage division there). Likewise, to prevent loading at the amplifier's output port, assume this port is left open circuited, and the feedback-network's presents infinite resistance to said port so we can write $v_{o}=a v_{\varepsilon}$ (had this not been the case,
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-005.jpg?height=447&width=656&top_left_y=1542&top_left_x=203)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-005.jpg?height=231&width=527&top_left_y=1763&top_left_x=1070)
(b)

FIGURE 7.12 The series-shunt configuration or voltage amplifier: (a) error amplifier (top) and idealized feedback network (bottom); (b) equivalent circuit.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-006.jpg?height=518&width=1543&top_left_y=199&top_left_x=102)

FIGURE 7.13 (a) Test circuit to find the closed-loop parameters $A=v_{0} / v_{i}$ and $R_{i}$ for the series-shunt configuration. (b) Test circuit to find $R_{o}$.
we would have had voltage division at the output port as well). With reference to Fig. 7.13a, we have, by inspection, $v_{o}=a v_{\varepsilon}=a\left(v_{i}-v_{f}\right)=a\left(v_{i}-b v_{o}\right)$. Collecting yields the familiar result

$$
\begin{equation*}
A_{o c}=\frac{v_{o}}{v_{i}}=\frac{1}{b} \frac{1}{1+1 / L} \tag{7.28}
\end{equation*}
$$

where $L=a b$. As we know, negative feedback stabilizes gain by making $A_{o c} \rightarrow 1 / b$ in the limit $L \rightarrow \infty$.

To find the effect upon $r_{i}$, apply a test voltage $v_{i}$ as in Fig. 7.13a, find the ensuing current $i_{i}$, and obtain the closed-loop input resistance as the ratio $R_{i}=v_{i} / i_{i}$. Thus, Ohm's law gives $i_{i}=v_{\varepsilon} / r_{i}$. But Eq. (7.10) predicts $v_{\varepsilon}=v_{i} /(1+L)$, so

$$
\begin{equation*}
R_{i}=\frac{v_{i}}{i_{i}}=r_{i}(1+L) \tag{7.29}
\end{equation*}
$$

indicating that negative feedback takes the input resistance $r_{i}$, which in a welldesigned voltage amplifier is high to begin with, and multiplies it by $(1+L)$ to make it even higher. This is quite desirable in voltage-input amplifiers as it helps reduce input loading dramatically. Physically, we justify as follows. In the absence of any feedback we would have $v_{f}=0$, so the entire test voltage $v_{i}$ would appear across $r_{i}$ to give $i_{i}=v_{i} / r_{i}$.However, with feedback in place, the voltage across $r_{i}$ is reduced to $v_{\varepsilon}$, which is $(1+L)$ times as small as $v_{i}$, by Eq. (7.10). This lowers $i_{i}$ by a factor of $(1+L)$, effectively raising $r_{i}$ by $(1+L)$. In the ideal limit $L \rightarrow \infty$ we get $i_{i} \rightarrow 0$ and thus $R_{i} \rightarrow \infty$, indicating that the input port of an amplifier of the series-input type, with sufficient loop gain, tends to act as an open circuit.

Next, set $v_{i}=0$ and subject the output port to a test current $i_{o}$, as in Fig. 7.13b. Then, find the ensuing voltage $v_{o}$ and obtain the closed-loop output resistance as $R_{o}=v_{o} / i_{o}$. By KVL and Ohm's law,

$$
v_{o}=a v_{\varepsilon}+r_{o} i_{o}=a\left(-v_{f}\right)+r_{o} i_{o}=-a b v_{o}+r_{o} i_{o}
$$

Collecting and simplifying gives

$$
\begin{equation*}
R_{o}=\frac{v_{o}}{i_{o}}=\frac{r_{o}}{1+L} \tag{7.30}
\end{equation*}
$$

indicating that negative feedback takes the output resistance $r_{o}$, which in a welldesigned voltage amplifier is low to begin with, and divides it by $(1+L)$ to make it even lower. This is highly desirable in voltage-output amplifiers as it helps reduce output loading dramatically. Physically, we justify as follows. In the absence of feedback $(b=0)$ the circuit of Fig. $7.13 b$ would give $a v_{\varepsilon}=0$ and thus $v_{o}=r_{o} i_{o}$. However, with feedback in place, the amplifier, in its attempt to drive $v_{\varepsilon}$ close to zero, adjusts its dependent source so that $v_{o}\left(=v_{f} / b=-v_{\varepsilon} / b\right)$ becomes $(1+L)$ times as small, effectively lowering $r_{o}$ by $(1+L)$. In the ideal limit $L \rightarrow \infty$ we get $v_{o} \rightarrow 0$ and thus $R_{o} \rightarrow 0$, indicating that in the absence of any input signal, the output port of an amplifier of the output-shunt type, with sufficient loop gain, tends to act as a short circuit.

In light of the above results, it is apparent that the series-shunt configuration of Fig. 7.12 $a$ admits the voltage-amplifier equivalent of Fig. 7.12b, with the closed-loop parameters $A, R_{i}$, and $R_{o}$ as given in Eqs. (7.28) through (7.30). Note the use of upper-case letters to distinguish these parameters from their open-loop counterparts $a, r_{i v}$ and $r_{o}$.

An op amp with $a=10^{5} \mathrm{~V} / \mathrm{V}, r_{i}=1 \mathrm{M} \Omega$, and $r_{o}=100 \Omega$ is operated in the seriesshunt mode with $b=0.01 \mathrm{~V} / \mathrm{V}$. Estimate $A_{o c}, R_{i j}$, and $R_{o}$, and comment.

### Solution

We have $L=10^{5} \times 0.01=10^{3}$. Thus, $A_{o c} \cong 100\left(1-1 / 10^{3}\right)=99.9 \mathrm{~V} / \mathrm{V}$, $R_{i}=10^{6}\left(1+10^{3}\right) \cong 10^{9} \Omega=1 \mathrm{G} \Omega$, and $R_{o}=100 /\left(1+10^{3}\right) \cong 0.1 \Omega$. Compared with the resistances surrounding an op amp, which are typically in the $\mathrm{k} \Omega$-range, $R_{i}$ effectively appears as an open circuit and $R_{o}$ as a short circuit.

### The Shunt-Series Configuration

We now turn our attention to the application of negative feedback around a current amplifier, the dual of the voltage amplifier. As shown in Fig. 7.14a, the amplifier's output port is modeled with a Norton equivalent consisting of the dependent source $a i_{\varepsilon}$ and the parallel output resistance $r_{o}$. The input port, assumed to play a purely passive role, is modeled with the input resistance $r_{i}$. The role of the feedback network is to sense the output current $i_{o}$ and produce a scaled version of it, or $i_{f}=b i_{o}$, such that $i_{f}$ is then summed to the input $i_{i}$ to generate the error signal $i_{\varepsilon}=i_{i}-i_{f}$ The operation of current sensing at the output port is performed in series, just as in laboratory current measurements, where we break the circuit to insert the ammeter in series (recall that currents are always measured in series, voltages always in parallel!). However, the operation of current summing at the input is performed in parallel, or shunt, as this is how we connect together different current sources when we want to add or subtract their currents-never connect different current sources in series!
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-008.jpg?height=449&width=759&top_left_y=210&top_left_x=149)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-008.jpg?height=210&width=604&top_left_y=447&top_left_x=1032)
(b)

FIGURE 7.14 The shunt-series configuration or current amplifier: (a) error amplifier (top) and idealized feedback network (bottom). (b) Equivalent circuit.

To be able to focus on the effect of negative feedback upon the open-loop parameters $a, r_{i}$, and $r_{o}$ alone, irrespective of the surrounding circuitry's details, we again deliberately assume the absence of any loading from both ports of the amplifier (the presence of loading encountered in practical circuits will be taken up in the next section). Thus, to prevent loading at the amplifier's input port, assume the $i_{i}$ and $b i_{o}$ sources have infinite parallel resistance so we can write $i_{\varepsilon}=i_{i}-i_{f}$ (had these sources had non-infinite resistances, we would have had current division at the input port). Likewise, to prevent loading at the amplifier's output port, assume this port is short circuited, and the feedback-network's presents zero resistance to said port so we can simply write $i_{o}=a i_{\varepsilon}$ (had this not been the case, we would have had current division at the amplifier's output port as well). With reference to Fig. 7.14a, we have, by inspection, $i_{o}=a i_{\varepsilon}=a\left(i_{i}-i_{f}\right)=a\left(i_{i}-b i_{o}\right)$. Collecting yields the familiar result

$$
\begin{equation*}
A_{s c}=\frac{i_{o}}{i_{i}}=\frac{1}{b} \frac{1}{1+1 / L} \tag{7.31}
\end{equation*}
$$

where $L=a b$. As we know, negative feedback stabilizes gain by making $A_{s c} \rightarrow 1 / b$ in the limit $L \rightarrow \infty$.

To find the effect upon $r_{i}$, apply a test current $i_{i}$ as in Fig. 7.15a, find the ensuing voltage $v_{i}$, and obtain the closed-loop input resistance as $R_{i}=v_{i} / i_{i}$. Thus, Ohm's law gives $v_{i}=r_{i} i_{\varepsilon}$. But Eq. (7.10) predicts $i_{\varepsilon}=i_{i} /(1+L)$, so

$$
\begin{equation*}
R_{i}=\frac{v_{i}}{i_{i}}=\frac{r_{i}}{1+L} \tag{7.32}
\end{equation*}
$$

indicating that negative feedback takes the input resistance $r_{i}$, which in a welldesigned current amplifier is usually low to begin with, and divides it by $(1+L)$ to make it even lower. This is highly desirable in current-input amplifiers, as it helps reduce input loading dramatically. Physically, we justify as follows. In the absence of any feedback, the entire test current $i_{i}$ would flow through $r_{i}$, giving $v_{i}=r_{i} i_{i}$. However, with feedback in place, the current through $r_{i}$ reduces to the error current
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-009.jpg?height=523&width=1547&top_left_y=192&top_left_x=192)

FIGURE 7.15 (a) Test circuit to find the closed-loop parameters $A=v_{o} / v_{i}$ and $R_{i}$ for the shunt-series configuration. (b) Test circuit to find $R_{0}$.
$i_{\varepsilon}$, which is $(1+L)$ times as small as $i_{i}$, by Eq. (7.10). This reduces $v_{i}$ by a factor of $(1+L)$, effectively dividing $r_{i}$ by $(1+L)$. In the ideal limit $L \rightarrow \infty$ we get $v_{i} \rightarrow 0$ and $R_{i} \rightarrow 0$, indicating that the input port of an amplifier of the input-shunt type, with sufficient loop gain, tends to act as a short circuit.

Next, set $i_{i}=0$ and subject the output port to a test voltage $v_{o}$ as shown in Fig. 7.15b. Then, find the ensuing current $i_{o}$ and obtain the closed-loop output resistance as $R_{o}=v_{o} / i_{o}$. By KCL and Ohm's law,

$$
i_{o}=a i_{\varepsilon}+v_{o} / r_{o}=a\left(-i_{f}\right)+v_{o} / r_{o}=-a b i_{o}+v_{o} / r_{o}
$$

Collecting and simplifying gives

$$
\begin{equation*}
R_{o}=\frac{v_{o}}{i_{o}}=r_{o}(1+L) \tag{7.33}
\end{equation*}
$$

indicating that negative feedback takes the output resistance $r_{o}$, which in a welldesigned current amplifier is usually high to begin with, and multiplies it by $(1+L)$ to make it even higher. This is quite desirable in current-output amplifiers as it helps reduce output loading dramatically. Physically, we justify as follows. In the absence of any feedback we would have $i_{o}=v_{o} / r_{o}$. However, with feedback in place, the amplifier, in its attempt to drive $i_{\varepsilon}$ close to zero, adjusts its dependent source so that $i_{o}\left(=i_{f} / b=-i_{\varepsilon} / b\right)$ becomes $(1+L)$ times as small, effectively raising $r_{o}$ by $(1+L)$. In the ideal limit $L \rightarrow \infty$ we get $i_{o} \rightarrow 0$ and thus $R_{o} \rightarrow \infty$, indicating that in the absence of any input, the output port of an amplifier of the output-series type, with sufficient loop gain, tends to act as an open circuit.

In light of the above results, it is apparent that the shunt-series configuration of Fig. 7.14 $a$ admits the current-amplifier equivalent of Fig. 7.14b, with the closed-loop parameters $A_{s c}, R_{i}$, and $R_{o}$ as given in Eqs. (7.31) through (7.33). Note that what is good for a current amplifier ( $R_{i} \rightarrow 0$ and $R_{o} \rightarrow \infty$ ) is just the opposite of what is good for a voltage amplifier ( $R_{i} \rightarrow \infty$ and $R_{o} \rightarrow 0$ ). This is yet another manifestation of the duality principle.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-010.jpg?height=501&width=1443&top_left_y=205&top_left_x=208)

FIGURE 7.16 The shunt-shunt configuration or transresistance amplifier: (a) error amplifier (top) and idealized feedback network (bottom). (b) Equivalent circuit.

### The Shunt-Shunt Configuration

Figure $7.16 a$ shows the application of negative feedback around a transresistance amplifier. The input signal is a current, so input current summing is done in shunt fashion, as in the case of the current amplifier of Fig. 7.14a. On the other hand, the output signal is a voltage, so the amplifier's output port is modeled with the Th√©venin source $a i_{\varepsilon}$, and output voltage sensing is done in shunt fashion, as in the case of the voltage amplifier of Fig. 7.12a. The transresistance amplifier is thus of the shunt-shunt type.

To find the closed-loop gain $A_{o c}$ we write $v_{o}=a i_{\varepsilon}=a\left(i_{i}-i_{f}\right)=a\left(i_{i}-b v_{o}\right)$. Collecting yields the familiar result

$$
\begin{equation*}
A_{o c}=\frac{v_{o}}{i_{i}}=\frac{1}{b} \frac{1}{1+1 / L} \tag{7.34}
\end{equation*}
$$

where $L=a b$. To find the closed-loop resistances $R_{i}$ and $R_{o}$, we use the test-signal techniques already utilized above. Actually, since the input port is similar to that of the shunt-series configuration, and the output port is similar to that of the series-shunt configuration, we recycle the results developed in connection with Figs. 7.15a and 7.13b, and write

$$
\begin{equation*}
R_{i}=\frac{r_{i}}{1+L} \quad R_{o}=\frac{r_{o}}{1+L} \tag{7.35}
\end{equation*}
$$

In the limit $L \rightarrow \infty$ the shunt-shunt configuration gives $A_{o c} \rightarrow 1 / b, R_{i} \rightarrow 0$, and $R_{o} \rightarrow 0$.

### The Series-Series Configuration

Figure $7.17 a$ shows the application of negative feedback around a transconductance amplifier. The input signal is a voltage, so input voltage summing is done in series fashion, as in the case of the voltage amplifier of Fig. 7.12a. Conversely, the output signal is a current, so the amplifier's output port is modeled with the Norton source
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-011.jpg?height=505&width=1515&top_left_y=203&top_left_x=196)

FIGURE 7.17 The series-series configuration or transconductance amplifier: (a) error amplifier (top) and idealized feedback network (bottom). (b) Equivalent circuit.
$a v_{\varepsilon}$, and output current sensing is done in series fashion, as in the case of the current amplifier of Fig. 7.14a. The transconductance amplifier is thus of the series-series type, the dual type of the shunt-shunt amplifier.

To find the closed-loop parameters we proceed in the usual fashion, obtaining

$$
\begin{gather*}
A_{s c}=\frac{i_{o}}{v_{i}}=\frac{1}{b} \frac{1}{1+1 / L}  \tag{7.36}\\
R_{i}=r_{i}(1+L) \quad R_{o}=r_{o}(1+L)
\end{gather*}
$$

where $L=a b$. In the limit $L \rightarrow \infty$, the series-series configuration gives $A_{s c} \rightarrow 1 / b$, $R_{i} \rightarrow \infty$, and $R_{o} \rightarrow \infty$.

### Summary

In light of the above results, we can state that the closed-loop gain $A$ of each of the four negative-feedback configurations can be expressed in the form

$$
\begin{equation*}
A=A_{\text {ideal }} \frac{1}{1+1 / L} \tag{7.38}
\end{equation*}
$$

where $A_{\text {ideal }}=1 / b$ is the closed-loop gain in the limit $L \rightarrow \infty, L=a b$ is the loop gain, $a$ is the open-loop gain, and $b$ is the feedback factor. Moreover, the closed-loop terminal resistances $R_{i / o}$ can be expressed in terms of the open-loop resistances $r_{i / o}$ as

$$
\begin{equation*}
R_{i / o}=r_{i / o}(1+L)^{ \pm 1} \tag{7.39}
\end{equation*}
$$

with +1 for the series cases, and -1 for shunt cases. Table 7.1 summarizes the four negative-feedback topologies, along with the terminal resistances in the idealized limit $L \rightarrow \infty$.

TABLE 7.1 The four feedback topologies, and their idealized closed-loop terminal resistances.

| $\boldsymbol{s}_{\boldsymbol{i}}$ | $\boldsymbol{s}_{\boldsymbol{o}}$ | Name | $\boldsymbol{a}$ | $\boldsymbol{b}$ | Topology | $\boldsymbol{R}_{\boldsymbol{i} \text { (ideal) }}$ | $\boldsymbol{R}_{\boldsymbol{o} \text { (ideal) }}$ |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| $v_{i}$ | $v_{o}$ | Voltage amp | V/V | V/V | Series-shunt | $\infty$ | 0 |
| $i_{i}$ | $i_{o}$ | Current amp | A/A | A/A | Shunt-series | 0 | $\infty$ |
| $i_{i}$ | $v_{o}$ | Transresistance amp | V/A | A/V | Shunt-shunt | 0 | 0 |
| $v_{i}$ | $i_{o}$ | Transconductance amp | A/V | V/A | Series-series | $\infty$ | $\infty$ |

### The Four Feedback Configurations Using Op Amps

Sometimes the operations of input summing and output sensing are not that obvious. So, to develop a quick feel, let us examine actual circuit examples using the op amp, the most popular building block designed for negative-feedback operation. Even though the op amp is, strictly speaking, a voltage-type amplifier (to stress this, we use the symbol $a_{v}$ to denote its voltage gain), it can be used in any of the four feedback topologies discussed above, giving further credence to the designation operational.

- Series-Shunt Configuration (Fig. 7.18a): we have already examined this configuration in connec-tion with Fig. 7.2. With sufficiently high loop gain, as is generally the case with op amp circuits, the input error voltage $v_{\varepsilon}$ will be
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-012.jpg?height=393&width=468&top_left_y=1090&top_left_x=447)
(a) Series-shunt: $b=\frac{v_{f}}{v_{o}}=\frac{R_{1}}{R_{1}+R_{2}}$
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-012.jpg?height=384&width=490&top_left_y=1630&top_left_x=469)
(c) Series-series: $b=\frac{v_{f}}{i_{o}}=R$
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-012.jpg?height=363&width=473&top_left_y=1143&top_left_x=1050)
(b) Shunt-shunt: $b=\frac{i_{f}}{v_{o}}=-\frac{1}{R}$
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-012.jpg?height=447&width=496&top_left_y=1573&top_left_x=1048)
(d) Shunt-series: $b=\frac{i_{f}}{i_{o}}=-\frac{R_{1}}{R_{1}+R_{2}}$

FIGURE 7.18 Illustrating the four basic negative-feedback topologies using op amps.
vanishingly small, indicating a vanishingly small current through the op amp's internal resistance $r_{i}$. Consequently, for all practical purposes the op amp's input port appears as an open circuit to the feedback network. This allows us to apply the voltage divider rule and write

$$
\begin{equation*}
b=\frac{v_{f}}{v_{i}}=\frac{R_{1}}{R_{1}+R_{2}}=\frac{1}{1+R_{2} / R_{1}} \tag{7.40}
\end{equation*}
$$

In the ideal op-amp limit $a_{v} \rightarrow \infty$ this circuit gives $A_{o c}=v_{o} / v_{i} \rightarrow 1 / b=1+R_{2} / R_{1}$, $R_{i} \rightarrow \infty$, and $R_{o} \rightarrow 0$.

- Shunt-Shunt Configuration (Fig. 7.18b): the student will recall from basic op amp theory that in the ideal limit $a_{v} \rightarrow \infty$ the inverting-input node, also called a current-summing junction, acts as a virtual ground. The natural input signal is in this case a current, so the error signal is $i_{\varepsilon}=i_{i}-i_{\rho}$, as shown. Moreover, with the inverting-input node at 0 V , we have, by Ohm's law, $i_{f}=\left(0-v_{o}\right) / R$, so

$$
\begin{equation*}
b=\frac{i_{f}}{v_{o}}=-\frac{1}{R} \tag{7.41}
\end{equation*}
$$

In the ideal op-amp limit $a_{v} \rightarrow \infty$, this circuit gives $A_{o c}=v_{o} / i_{i} \rightarrow 1 / b=-R$. Moreover, the resistance seen by the input source is $R_{i} \rightarrow 0$, and that seen by the output load is $R_{o} \rightarrow 0$.

The shunt-shunt configuration forms the basis of the popular inverting voltage amplifier of Fig. 7.19a. Even though this is a voltage-in, voltage-out amplifier, from a feedback viewpoint it is a shunt-shunt configuration. This becomes more apparent if we perform a source transformation to convert from the voltage $v_{i}$ to the current $i_{i}=v_{i} / R_{1}$. Then, the closed-loop voltage gain is

$$
\begin{equation*}
A_{v}=\frac{v_{o}}{v_{i}}=\frac{v_{o}}{i_{i}} \times \frac{i_{i}}{v_{i}}=\left(-R_{2}\right) \times \frac{1}{R_{1}}=-\frac{R_{2}}{R_{1}} \tag{7.42}
\end{equation*}
$$

- Series-Series Configuration (Fig. 7.18c): the natural signals for this circuit are a voltage at the input and a current at the output. The task of the feedback network is to sense the output current $i_{o}$ in series, and convert it to the feedback voltage $v_{f}$ to be summed to the input $v_{i}$ in series. Amazingly, both operations are performed by means of a single resistance, $R$. As discussed earlier, the op amp's input port appears for all practical purposes as an open circuit to the feedback network. We can thus use Ohm's law and write $v_{f}=R i_{o}$, so

$$
\begin{equation*}
b=\frac{v_{f}}{i_{o}}=R \tag{7.43}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-013.jpg?height=304&width=1102&top_left_y=1797&top_left_x=196)

FIGURE 7.19 The popular inverting voltage amplifier is actually a shunt-shunt amplifier, as demonstrated by the source transformation.

In the ideal op-amp limit $a_{v} \rightarrow \infty$, this circuit gives $A_{s c}=i_{o} / v_{i} \rightarrow 1 / b=1 / R$. Moreover, the resistance seen by the input source is $R_{i} \rightarrow \infty$, and that seen by the output load is $R_{o} \rightarrow \infty$.

- Shunt-Series Configuration (Fig. 7.18d): the natural signals for this circuit are a current at the input and a current at the output. Given that the inverting-input node is at 0 V , we can apply the current-divider rule and write

$$
-i_{f}=\frac{R_{1}}{R_{1}+R_{2}} i_{o}
$$

so

$$
\begin{equation*}
b=\frac{i_{f}}{i_{o}}=\frac{-R_{1}}{R_{1}+R_{2}}=\frac{-1}{1+R_{2} / R_{1}} \tag{7.44}
\end{equation*}
$$

In the ideal op-amp limit $a_{v} \rightarrow \infty$, this circuit gives $A_{s c}=i_{o} / i_{i} \rightarrow-\left(1+R_{2} / R_{1}\right)$. Moreover, the resistance seen by the input source is $R_{i} \rightarrow 0$, and that seen by the output load is $R_{o} \rightarrow \infty$.

## 7.4 PRACTICAL CONFIGURATIONS AND THE EFFECT OF LOADING

The feedback networks of Section 7.3 were deliberately assumed idealized so we could focus on the effects of negative feedback upon the amplifier's parameters $a$, $r_{i}$, and $r_{o}$ alone. In a practical circuit the feedback network introduces loading both at the amplifier's input and output. Moreover, the amplifier and the feedback network are sometimes interwoven with each other, making the separation between the two not always obvious. A negative-feedback circuit can always be analyzed in its entirety via standard techniques such as nodal or loop analysis. However, as circuit complexity increases, this approach soon becomes prohibitive.

Mercifully, suitable approximations can be made that allow us to separate the circuit into a basic amplifier incorporating the effects of loading, and a distinct feedback network. With this separation in hand, we can then apply Eqs. (7.38) and (7.39) to find the closed-loop parameters $A, R_{i}$, and $R_{o}$. These approximations exploit a priori the fact that with a sufficiently high loop gain $T$, a terminal resistance $R_{i / o}$ satisfies

$$
\begin{array}{ll}
\lim _{L \rightarrow \infty} R_{i / o}=\infty & \text { for the series case } \\
\lim _{L \rightarrow \infty} R_{i / o}=0 & \text { for the shunt case } \tag{7.45b}
\end{array}
$$

In words, the feedback network sees in effect an open circuit (OC) when looking into an amplifier's port where summing or sensing is done in series, and a short circuit (SC) when summing or sensing is done in shunt. These claims, and their usefulness, will become clearer as we proceed.

### Series-Shunt Circuits

In Fig. $7.18 a$ we have investigated the non-inverting op amp configuration as a classic example of a series-shunt circuit. We now re-examine it with an eye on the interaction between the error amplifier's internal resistances $r_{i}$ and $r_{o}$ and the external resistances $R_{1}$ and $R_{2}$ making up the feedback network. This interaction results in loading both at the amplifier's input and output. To be able to focus on loading by the feedback network alone, we continue to assume a driving source $v_{i}$ with zero series resistance, and an unloaded (open-circuited) output port, as shown in Fig. 7.20.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-015.jpg?height=468&width=583&top_left_y=597&top_left_x=204)

FIGURE 7.20 The non-inverting op amp with its internal resistances $r_{i}$ and $r_{o}$ explicitly shown.

To investigate loading at the input port, note that the external resistance seen by this port would appear to be $R_{1} / /\left(R_{2}+r_{o}\right)$. But we know a priori that in feedback operation the system will present a very low resistance $\left(R_{o} \rightarrow 0\right)$ at the output node due to shunt-type sensing there. This swamps out the effect of $r_{o}$, causing the external resistance seen by the amplifier's input port to be in effect $R_{1} / / R_{2}$. This is depicted in the amplifier's equivalent of Fig. 7.21a, where $R_{2}$ is shown short-circuited (SC) to ground.

To investigate loading at the output port, note that the external resistance seen by this port would appear to be $R_{2}+\left(R_{1} / / r_{i}\right)$. But we know a priori that in feedback
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-015.jpg?height=492&width=1019&top_left_y=1539&top_left_x=203)

FIGURE 7.21 Decomposing the circuit of Fig. 7.20 into (a) the error amplifier and (b) the feedback network.
operation the system will present a very high resistance $\left(R_{i} \rightarrow \infty\right)$ at the input node due to series-type summing there. This stems from the fact that $v_{\varepsilon} \rightarrow 0$, making the current through $r_{i}$ truly negligible and thus swamping out the effect of $r_{i}$. For practical purposes, the amplifier's input port appears as an open circuit to the feedback network. This too is depicted in Fig. 7.21a, where the node common to $R_{1}$ and $R_{2}$ is shown as open-circuited (OC), indicating that the external resistance seen by the amplifier's output port is in effect $R_{2}+R_{1}$.

With the feedback path interrupted both at the output (via short circuiting) and at the input (via open circuiting), the circuit of Fig. $7.21 a$ represents the error amplifier in open-loop operation, but with loading by the external feedback network specifically taken into account at both ports. Next, we wish to find its openloop parameters, now denoted as $a\left(=v_{o} / v_{\varepsilon}\right), r_{i a}$ and $r_{o a}$. By the voltage divider rule we have

$$
v_{o}=\frac{R_{1}+R_{2}}{r_{o}+R_{1}+R_{2}} a_{v} v_{d}=\frac{R_{1}+R_{2}}{r_{o}+R_{1}+R_{2}} a_{v} \frac{r_{i}}{r_{i}+\left(R_{1} / / R_{2}\right)} v_{\varepsilon}
$$

so that

$$
\begin{equation*}
a=\frac{v_{o}}{v_{\varepsilon}}=\frac{r_{i}}{r_{i}+\left(R_{1} / / R_{2}\right)} a_{v} \frac{R_{1}+R_{2}}{r_{o}+R_{1}+R_{2}} \tag{7.46}
\end{equation*}
$$

Note that $a<a_{v}$ because of input and output loading. We also have, by inspection

$$
\begin{equation*}
r_{i a}=r_{i}+\left(R_{1} / / R_{2}\right) \quad r_{o a}=r_{o} / /\left(R_{2}+R_{1}\right) \tag{7.47}
\end{equation*}
$$

Next, we seek a representation for the feedback network that is separate from the basic amplifier. Referring back to Fig. 7.20 we observe that at the sensing side this network is driven by a voltage source $v_{o}$ expected to exhibit extremely low series resistance $R_{o}$, and that at the summing side it drives the amplifier's input port which, for practical purposes, appears as an open circuit (OC). The circuit for the calculation of $b$ is thus as in Fig. 7.21b, from which we readily find

$$
\begin{equation*}
b=\frac{v_{f}}{v_{o}}=\frac{R_{1}}{R_{1}+R_{2}}=\frac{1}{1+R_{2} / R_{1}} \tag{7.48}
\end{equation*}
$$

Finally, we apply Eq. (7.28) to find the unloaded gain $A_{o c}$, and Eqs. (7.29) and (7.30), but with $r_{i}$ and $r_{o}$ replaced by $r_{i a}$ and $r_{o a}$, to find the closed-loop terminal resistances $R_{i}$, and $R_{o}$. Once these three parameters are known, we can use them in the general case in which the feedback amplifier is driven by a signal source $v_{s i g}$ with nonzero series resistance $R_{s i g}$, and drives a noninfinite output load $R_{L}$. With reference to the circuit model of Fig. 7.22, the source-to-load gain $v_{o} / v_{\text {sig }}$, also called the loaded gain, is readily found as

$$
\begin{equation*}
\frac{v_{o}}{v_{s i g}}=\frac{R_{i}}{R_{s i g}+R_{i}} A_{o c} \frac{R_{L}}{R_{o}+R_{L}} \tag{7.49}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-017.jpg?height=214&width=717&top_left_y=217&top_left_x=205)

FIGURE 7.22 Modeling a closed-loop voltage amplifier driven by a source $v_{s i g}$ and driving an external load $R_{L}$.
(a) In the circuit of Fig. 7.20 let the op amp be a mediocre type with $a_{v}=$

### EXAMPLE 7.9

$1000 \mathrm{~V} / \mathrm{V}, r_{i}=10 \mathrm{k} \Omega$, and $r_{o}=1.0 \mathrm{k} \Omega$. If $R_{1}=1.0 \mathrm{k} \Omega$ and $R_{2}=9.0 \mathrm{k} \Omega$, find $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$.
(b) Find the source-to-load gain $A=v_{o} / v_{\text {sig }}$ if the feedback amplifier is driven by a signal source $v_{s i g}$ having a series resistance $R_{s i g}=20 \mathrm{k} \Omega$, and drives a load $R_{L}=2.0 \mathrm{k} \Omega$.

### Solution

(a) Using Eqs. (7.46) through (7.48) we have

$$
\begin{aligned}
a & =\frac{10}{10+(1.0 / / 9.0)} 1000 \frac{1.0+9.0}{1.0+1.0+9.0}=0.917 \times 1000 \times 0.909 \\
& =833.3 \mathrm{~V} / \mathrm{V}(<1000 \mathrm{~V} / \mathrm{V}) \\
r_{i a} & =10+(1.0 / / 9.0)=10.9 \mathrm{k} \Omega \quad r_{o a}=1.0 / /(9.0+1.0)=0.909 \mathrm{k} \Omega \\
b & =\frac{1.0}{1.0+9.0}=\frac{1}{10} \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

Thus, $L=a b=833.3 / 10=83.33$, so

$$
\begin{aligned}
& A_{o c}=\frac{10}{1+1 / 83.33}=9.881 \mathrm{~V} / \mathrm{V} \\
& R_{i}=10.9(1+83.33) \cong 920 \mathrm{k} \Omega \\
& R_{o}=\frac{909}{1+83.33} \cong 10.8 \Omega
\end{aligned}
$$

(b) By Eq. (7.49), the source-to-load gain is

$$
\begin{aligned}
\frac{v_{o}}{v_{s i g}} & =\frac{920}{20+920} 9.88 \frac{2000}{10.8+2000}=0.979 \times 9.881 \times 0.995 \\
& =9.618 \mathrm{~V} / \mathrm{V}\left(<A_{o c}\right)
\end{aligned}
$$

The line of reasoning developed for the above example can be generalized to the following Series-Shunt Procedure:

- To calculate loading at the input of the basic amplifier, short-circuit (SC) the sensing-side port of the feedback network.
- To calculate loading at the output of the basic amplifier, open-circuit (OC) the summing-side port of the feedback network.
- To find $b$, apply a voltage $v_{o}$ to the sensing-side port of the feedback network, find the open-circuit (OC) voltage $v_{f}$ at the summing-side port of the feedback network, and let $b=v_{f} / v_{o}$.
We shall illustrate the procedure with additional examples.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-018.jpg?height=578&width=645&top_left_y=392&top_left_x=450)

FIGURE 7.23 Series-shunt feedback triple.
In the feedback circuit of Fig. 7.23, $Q_{1}$ responds to the difference $v_{\varepsilon}=v_{i}-v_{f}$, so we have series-type summing. $Q_{2}$ is a CE stage designed to provide additional voltage gain and thus boost the system's loop gain $L . Q_{3}$ is an emitter follower designed to provide current gain at low output resistance. Finally, we note that $v_{o}$ is shunted to the feedback network consisting of $R_{1}$ and $R_{2}$, indicating shunt-type sensing. Functionally, this circuit is similar to the non-inverting op amp of Fig. 7.20. Applying the aforementioned SeriesShunt Procedure, we end up with the error amplifier and feedback network of Fig. 7.24.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-018.jpg?height=590&width=1186&top_left_y=1295&top_left_x=452)

FIGURE 7.24 Decomposing the circuit of Fig. 7.23 into (a) the error amplifier and (b) the feedback network.

EXAMPLE 7.10 (a) In the circuit of Fig. 7.23 let $R_{1}=1.0 \mathrm{k} \Omega, R_{2}=3.0 \mathrm{k} \Omega$, and $R_{3}=R_{4}=R_{5}=$ $10 \mathrm{k} \Omega$. Moreover, let all BJTs have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=\infty$. Find $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$.
(b) Verify your results via PSpice.

### Solution

(a) For the BJTs we have $\beta_{0}=g_{m} r_{\pi}=5000 / 25=200$. Using Fig. 7.24a, we find, by inspection,

$$
\begin{aligned}
& r_{i a}=r_{\pi 1}+\left(\beta_{01}+1\right)\left(R_{1} / / R_{2}\right)=5+201(1 / / 3) \cong 156 \mathrm{k} \Omega \\
& r_{o a}=\frac{R_{5}+r_{\pi 3}}{\beta_{03}+1} / / R_{3} / /\left(R_{1}+R_{2}\right)=\frac{10+5}{201} / / 10 / /(1.0+3.0) \cong 73 \Omega
\end{aligned}
$$

To find the overall voltage gain $a$, examine one stage at a time. We note that $Q_{1}$ is a CE-ED stage, so we use the popular rule of thumb stating that the gain is the negative of the ratio of the total collector-node resistance to the total emitter-node resistance, or

$$
\frac{v_{c 1}}{v_{\varepsilon}}=-\frac{R_{4} / / r_{\pi 2}}{r_{e 1}+\left(R_{1} / / R_{2}\right)}=-\frac{10 / / 5}{0.025+(1.0 / / 3.0)}=-4.3 \mathrm{~V} / \mathrm{V}
$$

One can readily verify that the resistance $R_{b 3}$ seen looking into $Q_{3}$ 's base is such that $R_{b 3} \gg R_{5}$, so the gain provided by $Q_{2}$ is

$$
\frac{v_{c 2}}{v_{c 1}}=-g_{m 2}\left(R_{5} / / R_{b 3}\right) \cong-g_{m 2} R_{5}=-10 / 0.025=-400 \mathrm{~V} / \mathrm{V}
$$

We expect the gain of the voltage follower $Q_{3}$ to be very close to unity,

$$
\frac{v_{o}}{v_{c 2}} \cong 1 \mathrm{~V} / \mathrm{V}
$$

Combining the above results, we finally obtain

$$
a=\frac{v_{o}}{v_{\varepsilon}}=\frac{v_{c 1}}{v_{\varepsilon}} \times \frac{v_{c 2}}{v_{c 1}} \times \frac{v_{o}}{v_{c 2}} \cong(-4.3)(-400)(1)=1720 \mathrm{~V} / \mathrm{V}
$$

We also have, from Fig. 7.24b,

$$
b=\frac{v_{f}}{v_{o}}=\frac{R_{1}}{R_{1}+R_{2}}=\frac{1.0}{1.0+3.0}=\frac{1}{4} \mathrm{~V} / \mathrm{V}
$$

so the loop gain is $L=a b=1720 / 4=430$. Finally,

$$
\begin{aligned}
& A_{o c}=\frac{v_{o}}{v_{i}}=\frac{4}{1+1 / 430}=3.991 \mathrm{~V} / \mathrm{V} \\
& R_{i}=156 \times 10^{3}(1+430)=67 \mathrm{M} \Omega \quad R_{o}=\frac{73}{1+430}=0.17 \Omega
\end{aligned}
$$

Remark: Note that if $Q_{1}$ weren't part of the negative-feedback loop, the resistance seen looking into its emitter would be $r_{e 1}$, or $25 \Omega$ in our example, a rather low value. However, in feedback operation the situation changes dramatically. To get a feel, consider the case $v_{i}=1.0 \mathrm{~V}$. Then, the base current is $i_{b 1}=v_{i} / R_{i}=1 /(67 \mathrm{M} \Omega) \cong$ 15 nA , and the emitter current is $i_{e 1}=\left(\beta_{01}+1\right) i_{b 1}=201(15 \mathrm{nA}) \cong 3 \mu \mathrm{~A}$. On the other hand, the current through $R_{1}$ is $i_{1}=v_{f} / R_{1} \cong v_{i} / R_{1}=(1 \mathrm{~V}) /(1 \mathrm{k} \Omega)=1 \mathrm{~mA}$. Given that $3 \mu \mathrm{~A} \ll 1 \mathrm{~mA}$, there is no question that for all practical purposes $Q_{1}$ 's emitter appears as an open circuit (OC) to $R_{1}$ and $R_{2}$ !
(b) The PSpice circuit of Fig. 7.25 uses three VCCSs to model the BJTs in smallsignal operation, and it includes the $0-\mathrm{V}$ dummy source $V_{0}$ to sense the current out of $Q_{1}$ 's emitter. After directing PSpice to perform the dc analysis as well as the transfer function (. TF ) analysis, we get $A_{o c}=3.99 \mathrm{~V} / \mathrm{V}, R_{i}=65.13 \mathrm{M} \Omega$, and $R_{o}=0.1739 \Omega$. Moreover, the current through the test source $V_{0}$ for $v_{i}=$ 1.0 V is $3.086 \mu \mathrm{~A}$. All data are amazingly close to those calculated by hand!
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-020.jpg?height=581&width=926&top_left_y=484&top_left_x=446)

FIGURE 7.25 PSpice circuit to verify the series-shunt triple of Example 7.10.

EXAMPLE 7.11 Assuming $g_{m}=1 \mathrm{~mA} / \mathrm{V}$ and $r_{o}=50 \mathrm{k} \Omega$ for all FETs in the circuit of Fig. 7.26, along with $\chi_{5}=0.25$, find the unloaded gain $A_{o c}$ and the output resistance $R_{o}\left(R_{i}=\infty\right.$ because the input source is looking right into $M_{1}$ 's gate).
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-020.jpg?height=637&width=729&top_left_y=1426&top_left_x=450)

FIGURE 7.26 Series-shunt circuit of Example 7.11.

### Solution

This is a unity-gain non-inverting amplifier whose decomposition appears as in Fig. 7.27. The voltage gain of the first stage is $g_{m}\left(r_{o p} / / r_{o n}\right)=g_{m} r_{o} / 2$ and that of the $M_{5}$ source follower is $1 /\left(1+\chi_{5}\right)$, so we write

$$
a=\frac{v_{o}}{v_{\varepsilon}}=\frac{g_{m} r_{o} / 2}{1+\chi_{5}}=\frac{1 \times 50 / 2}{1+0.25}=20 \mathrm{~V} / \mathrm{V} \quad b=1.0 \mathrm{~V} / \mathrm{V} \quad L=20
$$

We also have $r_{o a}=1 /\left[g_{m 5}\left(1+\chi_{5}\right)\right]=1 / 1.25=800 \Omega$. Consequently,
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-021.jpg?height=623&width=1093&top_left_y=576&top_left_x=247)

FIGURE 7.27 Decomposing the circuit of Fig. 7.26 into (a) the error amplifier and (b) the feedback network.

As our last example, let us investigate the emitter follower of Fig. 7.28a. On a variety of occasions it has been said that a resistance in series with the emitter of a BJT or with the source of a FET introduces degeneration, and that, among other things, it stabilizes the dc bias point. We now wish to reexamine this issue from the viewpoint of negative feedback. The BJT responds to the signal $v_{\varepsilon}=v_{i}-v_{o}$, indicating
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-021.jpg?height=461&width=1161&top_left_y=1582&top_left_x=199)

FIGURE 7.28 The emitter follower as a negative-feedback system: (a) ac equivalent and (b) small-signal representation.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-022.jpg?height=410&width=1177&top_left_y=194&top_left_x=440)

FIGURE 7.29 Decomposing the feedback circuit of Fig. 7.28 into (a) the error amplifier and (b) the feedback network.
a series-shunt configuration with $b=1 \mathrm{~V} / \mathrm{V}$. To decompose the circuit into the error amplifier and the feedback network, refer to the small-signal equivalent of Fig. 7.28b.

Following the aforementioned Series-Shunt Procedure, we first ground node $v_{o}$ to find loading at the amplifier's input. This yields the left portion of the circuit of Fig. 7.29a. Next, we open-circuit node $v_{f}$ to find loading at the amplifier's output. This yields the right portion of the circuit of Fig. 7.29a. (It is certainly intriguing that the same node, namely, the emitter node, acts as a short or as an open circuit, depending on the viewpoint!) Finally, the feedback network appears as in Fig. 7.29b, giving $b=1 \mathrm{~V} / \mathrm{V}$.

EXAMPLE 7.12 In the emitter follower of Fig. 7.28a let $R_{E}=10 \mathrm{k} \Omega$. Moreover, let the BJT have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=100 \mathrm{k} \Omega$. Find $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$. Comment on your findings.

### Solution

With reference to Fig. 7.29a we have, by inspection,

$$
\begin{aligned}
& r_{i a}=r_{\pi}=5 \mathrm{k} \Omega \quad r_{o a}=R_{E} / / r_{o}=10 / / 100=9.09 \mathrm{k} \Omega \\
& a=\frac{v_{o}}{v_{\varepsilon}}=g_{m}\left(R_{E} / / r_{o}\right)=9.09 / 0.025 \cong 364 \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

With reference to Fig. $7.29 b$ we have $b=v_{f} / v_{o}=1 \mathrm{~V} / \mathrm{V}$, so

$$
L=a \times 1=g_{m}\left(R_{E} / / r_{o}\right)=364
$$

Finally,

$$
\begin{aligned}
& A_{o c}=\frac{1}{1+1 /\left[g_{m}\left(R_{E} / / r_{o}\right)\right]}=\frac{1}{1+1 / 364}=0.997 \mathrm{~V} / \mathrm{V} \\
& R_{i}=r_{\pi}\left[1+g_{m}\left(R_{E} / / r_{o}\right)\right]=5(1+364)=1.83 \mathrm{M} \Omega \\
& R_{o}=\frac{R_{E} / / r_{o}}{1+g_{m}\left(R_{E} / / r_{o}\right)}=\frac{1}{g_{m}} / / R_{E} / / r_{o} \cong \frac{1}{g_{m}} \cong r_{e}=25 \Omega
\end{aligned}
$$

The interested student can, after suitable manipulations, compare the above expressions with their exact counterparts of Section 2.9. The minor differences (such as $\beta_{0}$ instead of $\beta_{0}+1$ ) stem from the fact that the method used here is based on Eqs. $7.45 a$ and $b$, and as such it is an approximation-though a fairly good one in this case, as confirmed by the numerical results.

Remark: It is interesting to note that a feedback circuit can in turn be part of another more complex feedback circuit: an example is the emitter follower subcircuit $\left(Q_{3}\right)$ of the series-shunt triple of Fig. 7.23.

### Shunt-Shunt Circuits

In Fig. 7.30 we re-examine the shunt-shunt op amp configuration of Fig. 7.18b, but with an eye on the interaction between the amplifier's internal resistances $r_{i}$ and $r_{o}$ and the external feedback network, in this case consisting of $R$. To be able to focus on loading by the feedback network alone, we continue to assume a driving source $i_{i}$ with infinite parallel resistance, and an unloaded (open-circuited) output port.

As we know, because of the high gain $a_{v}$, the differential input voltage $v_{d}$ is going to be vanishingly small, indicating that the inverting-input node will be kept at virtual-ground potential. Thus, to calculate loading at the amplifier's output port, we regard $R$ as if its left terminal were short-circuited (SC) to ground. To find loading at the input, we note that sensing at the output is of the shunt type, just as in the case of the series-shunt circuit of Fig. 7.20. Consequently, to calculate loading at the amplifier's input port, we regard $R$ as if its right terminal were short-circuited (SC) to ground. Both situations are depicted in Fig. 7.31a, which shows the error amplifier in open-loop operation, but with loading by the external feedback network specifically taken into account at both ports. Next, we wish to find its open-loop parameters, now denoted as $a\left(=v_{o} / i_{\varepsilon}\right), r_{i a}$ and $r_{o a}$. By the voltage divider rule and Ohm's law,

$$
v_{o}=\frac{R}{r_{o}+R} a_{v} v_{d}=\frac{R}{r_{o}+R} a_{v}\left(r_{i} / / R\right)\left(-i_{\varepsilon}\right)
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-023.jpg?height=374&width=692&top_left_y=1668&top_left_x=201)

FIGURE 7.30 The transresistance op amp with its internal resistances $r_{i}$ and $r_{0}$ explicitly shown.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-024.jpg?height=409&width=1135&top_left_y=204&top_left_x=447)

FIGURE 7.31 Decomposing the circuit of Fig. 7.30 into (a) basic amplifier and (b) feedback network.
so that

$$
\begin{equation*}
a=\frac{v_{o}}{i_{\varepsilon}}=-\left(r_{i} / / R\right) a_{v} \frac{R}{r_{o}+R} \tag{7.50}
\end{equation*}
$$

Note that $a$ now has the dimensions of V/A, and is negative. Moreover, by inspection, we have

$$
\begin{equation*}
r_{i a}=r_{i} / / R \quad r_{o a}=r_{o} / / R \tag{7.51}
\end{equation*}
$$

Next, we seek a representation for the feedback network that is separate from the basic amplifier. Referring back to Fig. 7.30, we observe that at the sensing side this network is driven by a voltage source $v_{o}$ expected to exhibit extremely small series resistance $R_{o}$, and that at the summing side it drives the amplifier's input port which, for practical purposes, appears as a short circuit (SC). The circuit for the calculation of $b$ is thus as in Fig. $7.31 b$, from which we readily find $i_{f}=\left(0-v_{o}\right) / R$, so

$$
\begin{equation*}
b=\frac{i_{f}}{v_{o}}=-\frac{1}{R} \tag{7.52}
\end{equation*}
$$

The dimensions of $b$ are $\mathrm{A} / \mathrm{V}$, the reciprocal of those of $a$. Moreover, $b$ is negative, just like $a$. Both properties are consistent with the fact that $L=a b$ must be dimensionless and positive. We can now apply Eq. (7.34) to find the unloaded gain $A_{o c}$, and Eq. (7.35), but with $r_{i}$ and $r_{o}$ replaced by $r_{i a}$ and $r_{o a}$, to find the closed-loop terminal resistances $R_{i}$, and $R_{o}$.

EXAMPLE 7.13 In the circuit of Fig. 7.30 let the op amp have $a_{v}=10^{5} \mathrm{~V} / \mathrm{V}, r_{i}=2 \mathrm{M} \Omega$, and $r_{o}=$ $100 \Omega$. If $R=1.0 \mathrm{M} \Omega$, find $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$.

### Solution

Using Eqs. (7.50) through (7.52) we have

$$
\begin{aligned}
& r_{i a}=(2 / / 1) \times 10^{6}=667 \mathrm{k} \Omega \quad r_{o a}=100 / / 10^{6}=100 \Omega \\
& a=-(2 / / 1) 10^{6} \times 10^{5} \frac{10^{6}}{100+10^{6}}=-6.66 \times 10^{10} \mathrm{~V} / \mathrm{A} \quad b=-10^{-6} \mathrm{~A} / \mathrm{V}
\end{aligned}
$$

$$
\begin{aligned}
L & =\left(-6.667 \times 10^{10}\right)\left(-10^{-6}\right)=66,667 \\
A_{o c} & =\frac{-10^{6}}{1+1 / 66,667} \cong-1.0 \mathrm{~V} / \mu \mathrm{A} \\
R_{i} & =\frac{667 \mathrm{k} \Omega}{66,667}=10 \Omega \\
R_{o} & =\frac{100 \Omega}{66,667}=1.5 \mathrm{~m} \Omega
\end{aligned}
$$

The line of reasoning developed for the above example can be generalized to the following Shunt-Shunt Procedure:

- To calculate loading at the input of the basic amplifier, short-circuit (SC) the sensing-side port of the feedback network.
- To calculate loading at the output of the basic amplifier, short-circuit (SC) the summing-side port of the feedback network.
- To find $b$, apply a voltage $v_{o}$ to the sensing-side port of the feedback network, find the short-circuit current $i_{f}$ flowing into the summing-side port of the feedback network, and let $b=i_{f} / v_{o}$.
We shall illustrate the procedure with additional examples.
The feedback circuit of Fig. 7.32 is similar to that of Fig. 7.23, except that the input source is now a current that has been moved to $Q_{1}$ 's emitter, while the base has been grounded. Thus, $Q_{1}$ is now operating in the CB mode. As we know, the resistance seen looking into its emitter is low to begin with, and we anticipate that feedback will make it even lower. Applying the aforementioned Shunt-Shunt Procedure, we end up with the basic amplifier and feedback network of Fig. 7.33.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-025.jpg?height=710&width=656&top_left_y=1378&top_left_x=207)

FIGURE 7.32 Shunt-shunt feedback triple.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-026.jpg?height=666&width=1070&top_left_y=179&top_left_x=446)

FIGURE 7.33 Decomposing the circuit of Fig. 7.32 into (a) the error amplifier and (b) the feedback network.

EXAMPLE 7.14 (a) Let the circuit of Fig. 7.32 have the same parameters of Example 7.10, namely, $R_{1}=1.0 \mathrm{k} \Omega, R_{2}=3.0 \mathrm{k} \Omega$, and $R_{3}=R_{4}=R_{5}=10 \mathrm{k} \Omega$. Moreover, let all BJTs have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=\infty$. Find $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$.
(b) Compare with Example 7.10, and justify similarities as well as differences.

### Solution

(a) Retracing similar steps as in Example 7.10 using the circuit of Fig. 7.33 we find

$$
\begin{aligned}
& r_{i a}=r_{e 1} / / R_{1} / / R_{2}=24.2 \Omega \quad r_{o a}=\frac{R_{5}+r_{\pi 3}}{\beta_{03}+1} / / R_{2} / / R_{3} \cong 72.3 \Omega \\
& \frac{v_{e 1}}{i_{\varepsilon}}=r_{i a}=24.2 \mathrm{~V} / \mathrm{A} \quad \frac{v_{c 1}}{v_{e 1}}=g_{m 1}\left(R_{4} / / r_{\pi 2}\right)=133 \mathrm{~V} / \mathrm{V} \\
& \frac{v_{c 2}}{v_{c 1}}=-g_{m 2}\left(R_{5} / / R_{b 3}\right)=-400 \mathrm{~V} / \mathrm{V} \quad \frac{v_{o}}{v_{c 2}} \cong 1 \mathrm{~V} / \mathrm{V} \\
& a=\frac{v_{o}}{i_{\varepsilon}}=\frac{v_{e 1}}{i_{\varepsilon}} \times \frac{v_{c 1}}{v_{e 1}} \times \frac{v_{c 2}}{v_{c 1}} \times \frac{v_{o}}{v_{c 2}} \cong(24.2)(133)(-400)(1)=-1.29 \times 10^{6} \mathrm{~V} / \mathrm{A} \\
& b=\frac{i_{f}}{v_{o}}=-\frac{1}{R_{2}}=-\frac{1}{3 \times 10^{3}} \mathrm{~A} / \mathrm{V} \quad L=a b=\frac{-1.29 \times 10^{6}}{-3 \times 10^{3}}=430 \\
& A_{o c}=\frac{v_{o}}{i_{i}}=\frac{-3 \times 10^{3}}{1+1 / 430}=-2.993 \mathrm{~V} / \mathrm{mA} \\
& R_{i}=\frac{24.2}{1+430}=0.056 \Omega \quad R_{o}=\frac{72.3}{1+430} \cong 0.168 \Omega
\end{aligned}
$$

(b) We immediately observe that even though $a$ and $b$ are quite different in the two examples, both in values and dimensions, their product $L=a b$ is the same (430). However, some of the closed-loop parameters have changed drastically because of the different feedback topology. In both cases, output sensing is of the shunt type, so $R_{o}$ is virtually unchanged. By contrast, $R_{i}$ changes from $67 \mathrm{M} \Omega$ in the input-series circuit of Example 7.10, to $0.056 \Omega$ in the inputshunt circuit of the present example-quite a change! Also, the closed-loop gain has changed in value, dimensions, and even polarity, as it should be.

As our last example, we turn to the ac circuit of Fig. $7.34 a$, representing the familiar feedback-bias scheme. As we know, this scheme offers a good dc biasing alternative for a transistor. By inspection we find that this circuit is a shunt-shunt type. We thus apply the aforementioned Shunt-Shunt Procedure to end up with the decompositions of Fig. 7.34b and $c$.
(a) In the shunt-shunt circuit of Fig. $7.34 a$ let $R_{B}=100 \mathrm{k} \Omega$ and $R_{C}=10 \mathrm{k} \Omega$.

EXAMPLE 7.15 Moreover, let the BJT have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=100 \mathrm{k} \Omega$. Find $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$.
(b) Repeat if $R_{B}$ is lowered to $5.0 \mathrm{k} \Omega$. Comment.

### Solution

(a) With reference to Figs. $7.34 b$ and $c$ we have, by inspection,

$$
r_{i a}=R_{B} / / r_{\pi}=100 / / 5=4.76 \mathrm{k} \Omega \quad r_{o a}=R_{C} / / R_{B} / / r_{o}=10 / / 100 / / 100=8.33 \mathrm{k} \Omega
$$

$$
\begin{aligned}
& \frac{v_{b}}{i_{\varepsilon}}=r_{i a}=4.76 \mathrm{~V} / \mathrm{mA} \quad \frac{v_{o}}{v_{b}}=-g_{m} r_{o a}=-\frac{8.333}{0.025}=-333 \mathrm{~V} / \mathrm{V} \\
& a=\frac{v_{o}}{i_{\varepsilon}}=\frac{v_{b}}{i_{\varepsilon}} \times \frac{v_{o}}{v_{b}}=-g_{m} r_{i a} r_{o a}=\left(4.76 \times 10^{3}\right)(-333)=-1.59 \times 10^{6} \mathrm{~V} / \mathrm{A}
\end{aligned}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-027.jpg?height=505&width=411&top_left_y=1518&top_left_x=243)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-027.jpg?height=484&width=914&top_left_y=1538&top_left_x=716)

FIGURE 7.34 (a) The feedback-bias BJT configuration as a shunt-shunt circuit. (b) Error amplifier and (c) feedback network.

$$
\begin{aligned}
& b=\frac{i_{f}}{v_{o}}=-\frac{1}{R_{B}}=-\frac{1}{10^{5}} \mathrm{~A} / \mathrm{V} \quad L=a b=\frac{-1.59 \times 10^{6}}{-10^{5}}=15.9 \\
& A_{o c}=\frac{v_{o}}{i_{i}}=-\frac{10^{5}}{1+1 / 15.9}=-94 \mathrm{~V} / \mathrm{mA} \\
& R_{i}=\frac{4.76}{1+15.9} \cong 0.28 \mathrm{k} \Omega \quad R_{o}=\frac{8.33}{1+15.9} \cong 0.5 \mathrm{k} \Omega
\end{aligned}
$$

(b) With $R_{B}=5.0 \mathrm{k} \Omega$ we get $r_{i a}=2.5 \mathrm{k} \Omega, r_{o a}=3.23 \mathrm{k} \Omega, a=-3.23 \times 10^{5} \mathrm{~V} / \mathrm{A}$, and $b=-1 /\left(5 \times 10^{3}\right) \mathrm{A} / \mathrm{V}$. Consequently,

$$
L=65.5 \quad A_{o c}=-4.925 \mathrm{~V} / \mathrm{mA} \quad R_{i}=38.2 \Omega \quad R_{o}=49.2 \Omega
$$

Note the significant increase in the value of $L$, from 15.9 to 65.5 . Can you justify this intuitively?

### Series-Series Circuits

In Fig. 7.35 we re-examine the series-series op amp configuration of Fig. $7.18 c$, but with the usual eye on the interaction between the amplifier's internal resistances $r_{i}$ and $r_{o}$ and the external feedback network, in this case consisting of $R$. To be able to focus on loading by the feedback network alone, we continue to assume the absence of any external loading, meaning a driving source $v_{i}$ with zero series resistance, and a short-circuit output load (note that an unloaded output port is an open circuit for a voltage-output device, but a short circuit for a current-output type).

As already seen in connection with the circuit of Fig. 7.20, the op amp's input port appears as an open circuit to the feedback network, so to calculate loading at the amplifier's output we regard the wire to the left of $R$ as an open circuit (OC). To find loading at the input, we note that sensing at the output is of the series type, where we anticipate a high closed-loop resistance. Consequently, to calculate loading at the amplifier's input port, we regard $R$ as if its terminal facing the load was open-circuited (OC).
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-028.jpg?height=456&width=569&top_left_y=1587&top_left_x=448)

FIGURE 7.35 The transconductance op amp with its internal resistances $r_{i}$ and $r_{0}$ explicitly shown.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-029.jpg?height=501&width=909&top_left_y=207&top_left_x=203)

FIGURE 7.36 Decomposing the circuit of Fig. 7.35 into (a) the error amplifier, and (b) the feedback network.

The two situations are depicted in Fig. 7.36a, which represents the error amplifier in open-loop operation, but with loading by the external feedback network specifically taken into account at both ports. Next, we wish to find its open-loop parameters, now denoted as $a, r_{i a}$ and $r_{o a}$. By Ohm's law and the voltage divider rule,

$$
i_{o}=\frac{a_{v} v_{d}}{r_{o}+R}=\frac{1}{r_{o}+R} a_{v} \frac{r_{i}}{r_{i}+R} v_{\varepsilon}
$$

so

$$
\begin{equation*}
a=\frac{i_{o}}{v_{\varepsilon}}=\frac{r_{i}}{r_{i}+R} a_{v} \frac{1}{r_{o}+R} \tag{7.53}
\end{equation*}
$$

Note that $a$ now has the dimensions of $\mathrm{A} / \mathrm{V}$. Moreover, the resistances seen by the input source $v_{\varepsilon}$ and by the short-circuit load are, respectively,

$$
\begin{equation*}
r_{i a}=r_{i}+R \quad r_{o a}=r_{o}+R \tag{7.54}
\end{equation*}
$$

Next, we seek a representation for the feedback network that is separate from the basic amplifier. Referring back to Fig. 7.35, we observe that at the sensing side $R$ is driven by a current source $i_{o}$ expected to exhibit extremely high parallel resistance $R_{o}$, and that at the summing side it drives the amplifier's input port which, for practical purposes, appears as an open circuit (OC). The circuit to calculate $b$ is thus as in Fig. 7.36b, from which we readily find $v_{f}=R i_{o}$, so

$$
\begin{equation*}
b=\frac{v_{f}}{i_{o}}=R \tag{7.55}
\end{equation*}
$$

The dimensions of $b$ are V/A, the reciprocal of those of $a$, as it must be in order to make $L$ dimensionless. As usual, we now apply Eq. (7.36) to find the unloaded gain $A_{s c}$, and Eq. (7.37), but with $r_{i}$ and $r_{o}$ replaced by $r_{i a}$ and $r_{o a}$, to find the closed-loop terminal resistances $R_{i}$ and $R_{o}$.

EXAMPLE 7.16 (a) In the circuit of Fig. 7.35 let the op amp have $a_{v}=10^{3} \mathrm{~V} / \mathrm{V}, r_{i}=100 \mathrm{k} \Omega$, and $r_{o}=1.0 \mathrm{k} \Omega$. If $R=10 \mathrm{k} \Omega$, find $R_{i}, R_{o}$, and the unloaded gain $A_{s c}$.
(b) If $v_{i}=5.0 \mathrm{~V}$, what is the short-circuit output current? If the short-circuit is replaced by a load that develops a $4.0-\mathrm{V}$ voltage drop, by how much will the output current change? Comment.

### Solution

(a) Using Eqs. (7.53) through (7.55) we have

$$
\begin{aligned}
& a=\frac{100}{100+10} 10^{3} \frac{1}{(1+10) 10^{3}}=\frac{1}{12.1} \mathrm{~A} / \mathrm{V} \quad b=10^{4} \mathrm{~V} / \mathrm{A} \\
& L=\frac{10^{4}}{12.1}=826 \\
& r_{i a}=100+10=110 \mathrm{k} \Omega \quad r_{o a}=1+10=11 \mathrm{k} \Omega \\
& A_{s c}=\frac{1 / 10^{4}}{1+1 / 826}=99.88 \mu \mathrm{~A} / \mathrm{V} \quad R_{i}=110(1+826)=91 \mathrm{M} \Omega \\
& R_{o}=11(1+826)=9.1 \mathrm{M} \Omega
\end{aligned}
$$

(b) The short-circuit output current is $i_{o}=A_{s c} v_{i}=99.88 \times 5.0=499.4 \mu \mathrm{~A}$ (ideally, $500 \mu \mathrm{~A}$ ). Visualizing the output port via its Norton equivalent, we note that with a $4.0-\mathrm{V}$ load-voltage increase, the current will decrease by $(4.0 \mathrm{~V}) /(9.1 \mathrm{M} \Omega)=0.44 \mu \mathrm{~A}$, an insignificant amount. This, thanks to the high output resistance brought about by negative feedback!

The line of reasoning developed for the above example can be generalized to the following Series-Series Procedure:

- To calculate loading at the input of the basic amplifier, open-circuit (OC) the sensing-side port of the feedback network.
- To calculate loading at the output of the basic amplifier, open-circuit (OC) the summing-side port of the feedback network.
- To find $b$, apply a current $i_{o}$ to the sensing-side port of the feedback network, find the open-circuit voltage $v_{f}$ at the summing-side port of the feedback network, and let $b=v_{f} / i_{o}$.

Let us illustrate the procedure using the single BJT circuit of Fig. 7.37, here operated in the series-series mode to act as a voltage-to-current (V-I) converter. The circuit is similar to the CC of Fig. 7.28, except that the output is now the short-circuit collector current instead of the open-circuit emitter voltage. To decompose the feedback circuit into the basic error amplifier and the feedback network, refer to the small-signal equivalent of Fig. 7.37b, where we note that the current being sensed is not $i_{o}$ itself, but $i_{o} / \alpha_{0}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-031.jpg?height=473&width=1253&top_left_y=198&top_left_x=198)

FIGURE 7.37 The single-BJT voltage-to-current (V-I) converter as a series-series feedback system. (a) Ac equivalent and (b) small-signal representation.

Following the aforementioned Series-Series Procedure, we open-circuit at the right-hand side of $R_{E}$ to find loading at the input, thus obtaining the left portion of the circuit of Fig. 7.38a. Likewise, we open-circuit at the left-hand side of $R_{E}$ to find loading at the output, thus obtaining the right portion of the circuit of Fig. 7.38a. Finally, we drive the feedback network $R_{E}$ with the current $i_{o} / a_{0}$ to find $v_{f}$
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-031.jpg?height=419&width=1119&top_left_y=1082&top_left_x=199)

FIGURE 7.38 Decomposing the circuit of Fig. 7.37 into (a) the error amplifier and (b) the feedback network.

In the V-I converter of Fig. $7.37 a$ let $R_{E}=10 \mathrm{k} \Omega$. Moreover, let the BJT have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=100 \mathrm{k} \Omega$. Find $R_{i}, R_{o}$, and the unloaded gain $A_{s c}$. Comment on your findings.

### Solution

With reference to Fig. 7.38a we have, by inspection,

$$
\begin{aligned}
& r_{i a}=r_{\pi}+R_{E}=5+10=15 \mathrm{k} \Omega \quad r_{o a}=r_{o}+R_{E}=100+10=110 \mathrm{k} \Omega \\
& i_{o}=i_{R_{E}}=\frac{r_{o}}{R_{E}+r_{o}} g_{m} v_{\pi}=\frac{r_{o}}{R_{E}+r_{o}} g_{m} \frac{r_{\pi}}{r_{\pi}+R_{E}} v_{\varepsilon}
\end{aligned}
$$

so

$$
a=\frac{i_{o}}{v_{\varepsilon}}=\frac{r_{\pi}}{r_{\pi}+R_{E}} g_{m} \frac{r_{o}}{R_{E}+r_{o}}=\frac{5}{5+10} \times \frac{1}{25} \times \frac{100}{10+100}=\frac{1}{82.5} \mathrm{~A} / \mathrm{V}
$$

Moreover, with reference to Fig. $7.38 b$ we have $v_{f}=R_{E} i_{o} / \alpha_{0}$, so

$$
b=\frac{v_{f}}{i_{o}}=\frac{R_{E}}{\alpha_{0}}=\frac{10,000}{200 / 201}=10,050 \mathrm{~V} / \mathrm{A} \quad L=a b=\frac{10,050}{82.5}=122
$$

Finally,

$$
\begin{aligned}
& A_{s c}=\frac{i_{o}}{v_{i}}=\frac{1}{10,050} \frac{1}{1+1 / 122}=98.7 \mu \mathrm{~A} / \mathrm{V} \\
& R_{i}=15(1+122)=1.85 \mathrm{M} \Omega \quad R_{o}=110(1+122)=13.5 \mathrm{M} \Omega
\end{aligned}
$$

Remark: The student should compare the above (approximate) results with those provided by the exact expressions of Section 2.6, and verify that the differences are reasonably small. Even though the V-I converter of Fig. 7.37a is similar to the emitter follower of Fig. 7.28 and uses the same component values, the loop gains are quite different ( $L=364$ for the emitter follower, $L=122$ for the V-I converter). On the other hand, the series-shunt circuit of Example 7.10 and its shuntshunt counterpart of Example 7.14 have the same value of $L(430)$. It must be said that $L$ generally depends on the feedback topology being used, even if the sourceless circuits are the same. This issue will be taken up again in the next section.

### Shunt-Series Circuits

In Fig. 7.39 we re-examine the shunt-series op amp configuration of Fig. $7.18 d$, but using the full-blown op amp model. Again, we assume the absence of any external loading, meaning zero parallel resistance for the input current source, and a short circuit as the load. With shunt summing, the op amp's input port appears to the feedback network as a short circuit (SC), while with series sensing, the op amp's output port appears to the feedback network as an open circuit (OC). Consequently, we end up with the situation
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-032.jpg?height=468&width=640&top_left_y=1579&top_left_x=448)

FIGURE 7.39 The op amp as a current amplifier with its internal resistances $r_{i}$ and $r_{0}$ explicitly shown.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-033.jpg?height=524&width=1178&top_left_y=203&top_left_x=200)

FIGURE 7.40 Decomposing the circuit of Fig. 7.39 into (a) the error amplifier and (b) the feedback network.
of Fig. 7.40a, showing the error amplifier in open-loop operation, but with loading by the feedback network specifically taken into account at both ports. Next, we wish to find its open-loop parameters, now denoted as $a, r_{i a}$ and $r_{o a}$. By inspection

$$
\begin{equation*}
r_{i a}=r_{i} / /\left(R_{2}+R_{1}\right) \quad r_{o a}=r_{o}+\left(R_{2} / / R_{1}\right) \tag{7.56}
\end{equation*}
$$

Moreover,

$$
i_{o}=\frac{a_{v} v_{d}}{r_{o a}}=\frac{1}{r_{o a}} a_{v} r_{i a}\left(-i_{\varepsilon}\right)
$$

so that

$$
\begin{equation*}
a=\frac{i_{o}}{i_{\varepsilon}}=-\frac{r_{i a}}{r_{o a}} a_{v} \tag{7.57}
\end{equation*}
$$

Note that $a$ now has the dimensions of $\mathrm{A} / \mathrm{A}$, and it is negative.
Next, we seek a representation for the feedback network that is separate from the basic amplifier. Referring back to Fig. 7.39 we observe that at the sensing side the feedback network is driven by a current source $i_{o}$ expected to exhibit extremely high parallel resistance $R_{o}$, whereas at the summing side it drives the amplifier's input port which, for practical purposes, appears as a short circuit (SC). The circuit for the calculation of $b$ is thus as in Fig. 7.40b. Using the current divider rule, we have

$$
\begin{equation*}
b=\frac{i_{f}}{i_{o}}=-\frac{R_{1}}{R_{1}+R_{2}}=-\frac{1}{1+R_{2} / R_{1}} \tag{7.58}
\end{equation*}
$$

Note that $b$ is negative and is in A/A, just like $a$. As usual, we now apply Eq. (7.31) to find the unloaded gain $A_{s c}$, and Eqs. (7.32) and (7.33), but with $r_{i}$ and $r_{o}$ replaced by $r_{i a}$ and $r_{o a}$, to find the closed-loop terminal resistances $R_{i}$, and $R_{o}$. Moreover, the general case in which a feedback current amplifier is driven by a signal source $i_{s i g}$ with noninfinite
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-034.jpg?height=198&width=757&top_left_y=204&top_left_x=453)

FIGURE 7.41 Modeling a closed-loop current amplifier driving a load $R_{L}$ and driven by a source having output resistance $R_{\text {sig }}$.
parallel resistance $R_{s i g}$ and drives a nonzero output load $R_{L}$, is readily investigated with reference to the circuit model of Fig. 7.41. Its source-to-load current gain is

$$
\begin{equation*}
\frac{i_{o}}{i_{s i g}}=\frac{R_{s i g}}{R_{s i g}+R_{i}} A_{s c} \frac{R_{o}}{R_{o}+R_{L}} \tag{7.59}
\end{equation*}
$$

EXAMPLE 7.18 (a) In the circuit of Fig. 7.39 let the op amp have $a_{v}=10^{3} \mathrm{~V} / \mathrm{V}, r_{i}=100 \mathrm{k} \Omega$, and $r_{o}=100 \Omega$. If $R_{1}=1.0 \mathrm{k} \Omega$ and $R_{2}=9.0 \mathrm{k} \Omega$, find $R_{i}, R_{o}$, and the unloaded gain $A_{s c}$.
(b) Find the signal-to-load gain $i_{o} / i_{s i g}$ if the feedback amplifier is driven by a signal source $i_{\text {sig }}$ having a parallel resistance $R_{s i g}=1.0 \mathrm{k} \Omega$, and drives a load $R_{L}=1.0 \mathrm{k} \Omega$.

### Solution

(a) Using Eqs. (7.56) through (7.58) we have

$$
\begin{aligned}
& r_{i a}=100 / /(9.0+1.0)=9.09 \mathrm{k} \Omega \quad r_{o a}=0.1+(9.0 / / 1.0)=1.0 \mathrm{k} \Omega \\
& a=-\frac{9.09}{1.0} 10^{3}=-9,090 \mathrm{~A} / \mathrm{A} \\
& b=-\frac{1}{1+9 / 1}=-0.1 \mathrm{~A} / \mathrm{A} \\
& L=a b=909 \\
& A_{s c} \cong-10\left(1-\frac{1}{909}\right)=-9.989 \mathrm{~A} / \mathrm{A} \\
& R_{i}=\frac{9100}{1+909}=10 \Omega \\
& R_{o}=1(1+909)=910 \mathrm{k} \Omega
\end{aligned}
$$

(b) Refer to the equivalent representation of Fig. 7.41, where we note that we have current division both at the input and at the output. The signal-to-load gain is readily found as

$$
\frac{i_{o}}{i_{s i g}}=\frac{1.0}{1.0+0.010}(-9.989) \frac{910}{910+2.0}=-9.868 \mathrm{~A} / \mathrm{A}
$$

The line of reasoning developed for the above example can be generalized to the following Shunt-Series Procedure:

- To calculate loading at the input of the basic amplifier, open-circuit (OC) the sensing-side port of the feedback network.
- To calculate loading at the output of the basic amplifier, short-circuit (SC) the summing-side port of the feedback network.
- To find $b$, apply a current $i_{o}$ to the sensing-side port of the feedback network, find the short-circuit current $i_{f}$ through the summing-side port of the feedback network, and let $b=i_{f} / i_{o}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-035.jpg?height=585&width=578&top_left_y=628&top_left_x=204)

FIGURE 7.42 Shunt-series feedback pair.

Let us illustrate the procedure using the shunt-series pair of Fig. 7.42, also referred to as a current amplifier pair. Applying the aforementioned Shunt-Series Procedure, we end up with the basic amplifier and feedback network of Fig. 7.43.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-035.jpg?height=586&width=1215&top_left_y=1445&top_left_x=205)

FIGURE 7.43 Decomposing the circuit of Fig. 7.42 into (a) the error amplifier and (b) the feedback network.

EXAMPLE 7.19 (a) In the shunt-series pair of Fig. 7.42 let $R_{1}=1.0 \mathrm{k} \Omega, R_{2}=3.0 \mathrm{k} \Omega$, and $R_{3}=10 \mathrm{k} \Omega$. Moreover, let the BJTs have $g_{m}=1 /(25 \Omega), r_{\pi}=4.0 \mathrm{k} \Omega$, and $r_{o}=50 \mathrm{k} \Omega$. Find $R_{i}, R_{o}$, and the unloaded gain $A_{s c}$.
(b) Verify your results via PSpice.

### Solution

(a) We have $\beta_{0}=g_{m} r_{\pi}=4 / 0.025=160$. With reference to Fig. 7.43 we have, by inspection,

$$
\begin{aligned}
& r_{i a}=\left(R_{2}+R_{1}\right) / / r_{\pi 1}=(3.0+1.0) / / 4=2.0 \mathrm{k} \Omega \\
& r_{o a}=\frac{\left(r_{o 1} / / R_{3}\right)+r_{\pi 2}}{\beta_{02}+1}+\left(R_{2} / / R_{1}\right) \cong \frac{(50 / / 10)+4}{161}+(3.0 / / 1.0)=0.827 \mathrm{k} \Omega \\
& \frac{v_{b 1}}{i_{\varepsilon}}=r_{i a}=2.0 \mathrm{k} \Omega \\
& \frac{v_{c 1}}{v_{b 1}}=-g_{m 1}\left\{R_{3} / / r_{o 1} / /\left[r_{\pi 2}+\left(\beta_{02}+1\right)\left(R_{1} / / R_{2}\right)\right]\right\} \\
& =-\frac{10 / / 50 / /[4+161(1.0 / / 3.0)]}{0.025}=-312 \mathrm{~V} / \mathrm{V} \\
& \frac{v_{e 2}}{v_{c 1}}=\frac{1}{1+\frac{\left(R_{3} / / r_{o 2}\right)+r_{\pi 2}}{\left(\beta_{02}+1\right)\left(R_{1} / / R_{2}\right)}}=\frac{1}{1+\frac{10 / / 50+4}{161(1.0 / / 3.0)}}=0.907 \mathrm{~V} / \mathrm{V} \\
& \frac{i_{o}}{V_{e 2}}=\frac{1}{R_{1} / / R_{2}}=\frac{1}{1.0 / / 3.0}=\frac{1}{0.75 \mathrm{k} \Omega} \\
& a=\frac{i_{o}}{i_{\varepsilon}}=\frac{v_{b 1}}{i_{\varepsilon}} \times \frac{v_{c 1}}{v_{b 1}} \times \frac{v_{e 2}}{v_{c 1}} \times \frac{i_{o}}{v_{e 2}}=\frac{(2)(-312)(0.907)}{0.75}=-755 \mathrm{~A} / \mathrm{A} \\
& b=-\frac{1.0}{1.0+3.0}=-\frac{1}{4} \mathrm{~A} / \mathrm{A} \quad L=a b=(-755)(-0.25)=189
\end{aligned}
$$

Finally, the closed-loop parameters are

$$
\begin{aligned}
& A_{s c}=\frac{i_{o}}{i_{i}} \cong \frac{-4}{1+1 / 189}=-3.979 \mathrm{~A} / \mathrm{A} \\
& R_{i}=\frac{2000}{1+189} \cong 10.5 \Omega \\
& R_{o}=0.827(1+189)=157 \mathrm{k} \Omega
\end{aligned}
$$

(b) The PSpice circuit, shown in Fig. 7.44, includes the $0-\mathrm{V}$ dummy source $V_{L}$ to measure the short-circuit load current. After directing PSpice to perform the transfer function (.TF) analysis we get $A_{s c}=-3.980 \mathrm{~A} / \mathrm{A}, R_{i}=9.877 \Omega$ and $R_{o}=167.4 \mathrm{k} \Omega$, all in fair agreement with our calculations above.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-037.jpg?height=553&width=914&top_left_y=395&top_left_x=311)

FIGURE 7.44 PSpice circuit to verify Example 7.19.
GND

If an even higher output resistance is desired, the load can be moved to the collector side, which usually presents a much higher ac resistance than the emitter. This results in the alternative of Fig. 7.45a. Note that the load is now outside the feedback loop; however, the B-E port of $Q_{2}$ is still inside the loop, so the current being regulated is still $Q_{2}$ 's emitter current $i_{e 2}$. This current is related to the load current as $i_{e 2}=i_{o} / \alpha_{0}$. Moreover, as depicted in Fig. 7.45b, negative feedback in effect places in series with $Q_{2}$ 's emitter a resistance equal to that found in connection with Fig. 7.42, namely, $r_{o a}(1+L)$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-037.jpg?height=666&width=1020&top_left_y=1367&top_left_x=204)

FIGURE 7.45 (a) Shunt-series feedback pair with the load in series with $Q_{2}$ 's collector. (b) Equivalent circuit for finding $i_{0}$ and $R_{0}$.

EXAMPLE 7.20 Assuming the same parameters of Example 7.19, along with $r_{\mu}=\infty$, find the unloaded gain $i_{o} / i_{i}$ as well as $R_{o}$ for the circuit of Fig. 7.45a. Hence, verify via PSpice.

### Solution

We now have $i_{o}=\alpha_{0}(-3.979) i_{i}$, or

$$
\begin{aligned}
& \frac{i_{o}}{i_{i}}=\frac{160}{161}(-3.979)=-3.954 \mathrm{~A} / \mathrm{A} \\
& R_{o} \cong r_{o 2}\left[1+g_{m 2}\left\{r_{\pi 2} / /\left[r_{o a}(1+L)\right]\right\}\right]=50 \times 10^{3} \times[1+(4 / / 157) / 0.025] \cong 7.8 \mathrm{M} \Omega
\end{aligned}
$$

To verify with PSpice we still use the circuit of Fig. 7.44, but with the currentsensing source $V_{L}$ now in series with the collector. This gives $i_{o} / i_{i}=-3.955 \mathrm{~A} / \mathrm{A}$, $R_{i}=9.877 \Omega$, and $R_{o}=7.5 \mathrm{M} \Omega$, again in good agreement with the calculations.

### Finding the Source-to-Load Gain Directly

As illustrated in Figs. 7.22 and 7.41, once we know $R_{i}, R_{o}$, and the unloaded gain $A_{o c}$ or $A_{s c}$, we can find the signal-to-source gain for the case of a non-ideal driving source and an arbitrary output load. However, the need often arises to find the signal-to-load gain directly, without having to go through the intermediate calculations of $R_{i}$ and $R_{o}$. This is achieved by including also the signal source resistance $R_{\text {sig }}$ and the load resistance $R_{L}$ in the circuit of the basic amplifier when calculating its open-loop gain $a$. Then, the source-to-load gain is simply $A=a /(1+a b)$. We shall demonstrate for the cases of voltage and current amplifiers, but the technique is applicable also to the other two amplifier types.

### EXAMPLE 7.21

Use direct calculation to find the signal-to-load gain $A=v_{o} / v_{\text {sig }}$ of Example 7.9b, for which $a_{v}=1000 \mathrm{~V} / \mathrm{V}, r_{i}=10 \mathrm{k} \Omega, r_{o}=1.0 \mathrm{k} \Omega, R_{1}=1.0 \mathrm{k} \Omega, R_{2}=9.0 \mathrm{k} \Omega$, $R_{s i g}=20 \mathrm{k} \Omega$, and $R_{L}=2.0 \mathrm{k} \Omega$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-038.jpg?height=463&width=590&top_left_y=1431&top_left_x=452)

FIGURE $\mathbf{7 . 4 6}$ Modifying the basic voltage amplifier of
Fig. 7.21a to account for external loading due to $R_{\text {sig }}$ and $R_{L}$.

### Solution

Redraw the circuit of Fig. 7.21a, but with $R_{s i g}$ and $R_{L}$ also included. This results in the circuit of Fig. 7.46, where we note that $R_{s i g}$ appears in series and $R_{L}$ in shunt, in accordance with the present topology type. Thus, Eq. (7.46) changes to

$$
\begin{aligned}
& a=\frac{v_{o}}{v_{\varepsilon}}=\frac{r_{i}}{R_{s i g}+r_{i}+\left(R_{1} / / R_{2}\right)} a_{v} \frac{\left(R_{1}+R_{2}\right) / / R_{L}}{r_{o}+\left[\left(R_{1}+R_{2}\right) / / R_{L}\right]} \\
& \text { or } \\
& \begin{aligned}
a & =\frac{10}{20+10+(1.0 / / 9.0)} 1000 \frac{(1.0+9.0) / / 2.0}{1+[(1.0+9.0) / 2.0]} \\
& =0.324 \times 1000 \times 0.625=202 \mathrm{~V} / \mathrm{V}
\end{aligned}
\end{aligned}
$$

By Eq. (7.48) we still have $b=0.1 \mathrm{~V} / \mathrm{V}$, so $L=202 \times 0.1=20.2$ and

$$
\frac{v_{o}}{v_{s i g}}=\frac{1 / b}{1+1 / L}=\frac{10}{1+1 / 20.2}=9.528 \mathrm{~V} / \mathrm{V}
$$

in reasonable agreement with the result of Example 7.9b.

Use direct calculation to find the signal-to-load gain $A=i_{o} / i_{s i g}$ of the circuit of
EXAMPLE 7.22 Example 7.18b.

### Solution

Redraw the circuit of Fig. 7.40a, but with $R_{s i g}$ and $R_{L}$ also included. The result is shown in Fig. 7.47, where we note that $R_{s i g}$ appears in shunt and $R_{L}$ in series, in accordance with the present feedback topology. Thus, Eq. (7.57) changes to

$$
a=\frac{i_{o}}{i_{\varepsilon}}=-\frac{R_{s i g} / / r_{i} / /\left(R_{1}+R_{2}\right)}{r_{o}+R_{L}+\left(R_{1} / / R_{2}\right)} a_{v}=-\frac{1.0 / / 100 / /(1.0+9.0)}{1.0+2.0+(1.0 / / 9.0)} 10^{3}=-231 \mathrm{~A} / \mathrm{A}
$$

With $b$ still given as in Eq. (7.58), or $b=-0.1 \mathrm{~A} / \mathrm{A}$, we get

$$
\frac{i_{o}}{i_{s i g}}=\frac{a}{1+a b}=\frac{-231}{1+(-231)(-0.1)}=-9.585 \mathrm{~A} / \mathrm{A}
$$

in reasonable agreement with the result of Example 7.18b.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-039.jpg?height=501&width=642&top_left_y=1572&top_left_x=243)

FIGURE 7.47 Modifying the basic current amplifier of
Fig. 7.40a to account for external loading due to $R_{\text {sig }}$ and $R_{L}$.

### Identifying Feedback Type and Topology

The analytical tools developed so far can be applied to any feedback circuit provided feedback is itself negative. To assess feedback polarity, apply a stimulus $s_{i}$ at the input, follow its effect around the loop, and determine whether the returned signal $s_{f}$ opposes or reinforces $s_{i}$. Only if it opposes is feedback negative. The procedure is readily visualized via signal "bumps" as exemplified in Fig. 7.48.

In Fig. 7.48a we have frozen the ac input $v_{i}$ during a positive alternation, signified by a positive bump. This bump is amplified and inverted by $Q_{1}$ and then by $Q_{2}$, and is finally buffered by $Q_{4}$ back to the input port via the voltage divider $R_{2}-R_{1}$. With two inversions, the returned $v_{f}$ bump has the same polarity as the original $v_{i}$ bump. Since $Q_{1}$ responds to the difference $v_{i}-v_{f}$, it is apparent that $v_{f}$ tends to neutralize the effect of $v_{i}$, so feedback is negative. Had $R_{2}$ been returned to $Q_{1}$ 's base instead of the emitter, $v_{f}$ would have reinforced $v_{i}$, so feedback would have been positive.

In Fig. $7.48 b$ a positive current bump in $i_{i}$ is converted by $Q_{1}$ to a negative voltage bump at the collector, which is then buffered by $Q_{2}$ back to $Q_{1}$ 's base via $R_{2}$. With a negative bump at its right side, $R_{2}$ will sink current away from to $Q_{1}$ 's base. Since $Q_{1}$ responds to the difference $i_{i}-i_{f}$, it is apparent that $i_{f}$ tends to neutralize the effect of $i_{i}$, so feedback is negative. Had we inserted an additional inverting stage between $Q_{1}$ and $Q_{2}$ in the manner of Fig. 7.48a, the direction of $i_{f}$ would have been reversed, causing $i_{f}$ to reinforce $i_{i}$, so feedback would have been positive.

To identify the feedback topology we must determine the type of signal sensing at the output as well as the type of signal summing at the input. To identify the type of output sensing, proceed like this:

- To test for voltage sensing, set $v_{o} \rightarrow 0$ by short-circuiting the output port. Then, if the signal returned to the input port also drops to zero, sensing is of the shunt type.
- To test for current sensing, set $i_{o} \rightarrow 0$ by open-circuiting the output port. Then, if the signal returned to the input port also drops to zero, sensing is of the series type.

As an example, short-circuiting the output port in Fig. 7.48a yields $v_{f} \rightarrow 0$, confirming voltage feedback. Conversely, open-circuiting the output port in Fig. $7.48 b$ yields
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-040.jpg?height=605&width=1259&top_left_y=1473&top_left_x=380)

FIGURE 7.48 Using voltage "bumps" to investigate signal propagation around the feedback loop of (a) the series-shunt triple and (b) the shunt-series pair studied above.
$i_{f} \rightarrow 0$, confirming current feedback. In general one would apply both tests, one to identify and the other to corroborate.

To identify the type of input summing, proceed as follows:

- To test for voltage summing, look for an input mesh comprising the series combination of the input voltage, the voltage controlling the amplifier, and the voltage fed back from that across the output load. If such a mesh can be found, then summing is of the series type. If this test fails, then test for current summing.
- To test for current summing, look for an input node comprising the shunt combination of the input current, the current controlling the amplifier, and the current fed back from that through the output load. If such a node can be found, then summing is of the shunt type. If this test fails, then test for voltage summing.
In Fig. $7.48 a$ we identify a mesh comprising the series combination of $v_{i}, v_{\varepsilon}$, and $v_{f}$, indicating series summing. In Fig. $7.48 b$ we identify a node comprising $i_{i}, i_{s}$, and $i_{f}$, indicating shunt summing. No such node is present in Fig. 7.48a, just as no mesh counterpart is present in Fig. 7.48b.

It also helps exercising intuition to anticipate the expected resistance level: a high resistance implies series type, and a low resistance implies shunt type. The student is urged to apply the sensing and summing tests to all circuits investigated so far. With enough practice, you will soon be able to identify a topology by mere inspection!

## 7.5 RETURN-RATIO ANALYSIS

There is no doubt that the loop gain plays a central role in a negative-feedback system. Since it gives a measure of how close circuit behavior comes to ideal, the designer often needs to come up with a quick estimate for this gain to see whether the circuit under development meets the design specifications or needs improvement. Two-port techniques require that we find $a$ and $b$ separately via suitable circuit manipulations and approximations, and then estimate the loop gain as $L=a b$ (as seen in the previous section, both $a$ and $b$ vary with the feedback topology in use). Unlike two-port methods, direct methods are based on the idea of injecting a stimulus into the feedback loop and then observing the system's response to find the overall loop characteristics (as such, they are topology independent). As we inject a stimulus we must be careful ( $a$ ) not to upset the existing dc bias conditions and (b) not to alter the local loading conditions. Two techniques are available for the direct estimation of the feedback loop characteristics. The first method, discussed in the present section, is suited to hand calculations on circuit schematics involving dependent sources. The second method, discussed in the next section, is suited to test and measurement environments such as lab measurements or transistor-level computer simulations.

### The Return Ratio of a Dependent Source

Given a dependent source inside a single-loop feedback circuit, we find its return ratio as follows:

- Set the external driving source $s_{i}$ to zero, that is, replace $s_{i}$ with a short circuit if it is a voltage source, or with an open circuit if it is a current source.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-042.jpg?height=379&width=1180&top_left_y=205&top_left_x=448)

FIGURE 7.49 Finding the return ratio $T$ of a dependent source of the (a) voltage type and (b) current type.

- Break the feedback loop right downstream of the dependent source, and leave this source open-circuited if it is of the voltage type, or short-circuited it if it is of the current type.
- If the dependent source is of the voltage type, drive the circuit downstream with a test voltage $v_{t}$ having the same polarity as the dependent source (see Fig. 7.49a). Hence, find the open-circuit voltage $v_{r}$ returned by the dependent source, and obtain the source's return ratio, denoted as $T$, as

$$
\begin{equation*}
T=-\frac{v_{r}}{v_{t}} \tag{7.60a}
\end{equation*}
$$

- If the dependent source is of the current type, drive the circuit downstream with a test current $i_{t}$ having the same direction as the dependent source (see Fig. 7.49b). Hence, find the short-circuit current $i_{r}$ returned by the dependent source, and obtain the source's return ratio as

$$
\begin{equation*}
T=-\frac{i_{r}}{i_{t}} \tag{7.60b}
\end{equation*}
$$

### Comparing $T$ and $L$

Intuitively, it would seem that $T$ is the same as $L$ (in fact, it is common practice to refer also to $T$ as the loop gain, further adding to the confusion.) Though they may coincide in some some cases, $T$ and $L$ are generally different (when necessary to distinguish between the two, we shall refer to $T$ as the return-ratio loop gain, and to $L$ as the two-port loop gain). To understand the difference, recall that $L$ as defined in Eq. (7.6) is predicated on two premises, namely,

- Forward signal transmission occurs exclusively through the amplifier (in Fig. 7.1 we signify this by representing the amplifier with an arrowhead in the forward direction)
- Reverse signal transmission occurs exclusively through the feedback network (in Fig. 7.1 we signify this by representing the feedback network with an arrowhead in the reverse direction)

When this is the case, the amplifier and feedback network are said to be unilateral. However, most real-life feedback networks are bilateral. Add to this the fact that in the two-port approach we use short-circuit (SC) and open-circuit (OC) approximations to expedite the calculation of $a$ and $b$, and we have additional reasons for possible differences between $T$ and $L$. At this juncture it must be stressed that the calculation of $T$ does not predicate any premises and thus yields exact results.

We can better appreciate the similarities and differences between $T$ and $L$ by examining the manner in which each intervenes in the expression for the closed-loop gain $A$. Let the gain of the dependent source in question be denoted as $k$ (for instance, $k=a_{v}$ for an op amp, $k=\beta_{0}$ for a BJT, $k=g_{m}$ for a FET or a BJT, $k=z$ for a CFA). As we know, the closed-loop gain $A$ is related to the loop gain $L$ as

$$
\begin{equation*}
A=\frac{s_{o}}{s_{i}}=\frac{A_{\text {ideal }}}{1+1 / L} \tag{7.61}
\end{equation*}
$$

where

$$
\begin{equation*}
A_{\text {ideal }}=\lim _{k \rightarrow \infty} \frac{s_{o}}{s_{i}} \tag{7.62}
\end{equation*}
$$

is the value of $A$ in the idealized limit of the dependent source having infinite gain. We visualize Eq. (7.61) via the familiar block diagram of Fig. 7.50a, which has been derived from Fig. 7.1 by letting $b \rightarrow 1 / A_{\text {ideal }}$ and $a \rightarrow a b / b=L / b=L A_{\text {ideal }}$. As we know, a signal starting at the error amplifier's input and going around the loop clockwise undergoes an overall amplification of $\left(L A_{\text {ideal }}\right) \times\left(1 / A_{\text {ideal }}\right) \times(-1)$, or $-L$.

By contrast, the dependence of the closed-loop gain $A$ upon the return ratio $T$ takes on the form ${ }^{1,4}$

$$
\begin{equation*}
A=\frac{s_{o}}{s_{i}}=\frac{A_{\text {ideal }}}{1+1 / T}+\frac{a_{\mathrm{ft}}}{1+T} \tag{7.63}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-043.jpg?height=520&width=1196&top_left_y=1525&top_left_x=196)

FIGURE 7.50 Block diagrams illustrating the roles of (a) the loop gain $L$, and (b) the return ratio $T$.
where

$$
\begin{equation*}
a_{\mathrm{ft}}=\lim _{k \rightarrow 0} \frac{s_{o}}{s_{i}} \tag{7.64}
\end{equation*}
$$

is the feedthrough gain, that is, the gain with the dependent source set to zero. This gain stems from forward transmission around the dependent source. We visualize Eq. (7.63) via the block diagram of Fig. 7.50b, which is a generalization of that of Fig. $7.50 a$ because it includes also the feedthrough path shown at the top.

Compared to two-port analysis, return-ratio analysis is more insightful as it splits $A$ into two separate components, both stemming from forward transmission, but one through the error amplifier and the other through the feedback network. Two-port analysis, on the other hand, attempts at making the entire feedback system conform to the simpler diagram of Fig. 7.50a, this being the reason why it gives only approximate results compared to the exact results of the return-ratio method. ${ }^{1,4} \mathrm{It}$ is apparent from Eq. (7.63) that if the condition

$$
\begin{equation*}
\left|a_{\mathrm{ft}}\right| \ll\left|T A_{\text {ideal }}\right| \tag{7.65}
\end{equation*}
$$

is met, the feedthrough component of $A$ in Eq. (7.63) can be ignored, implying that Eq. (7.63) becomes formally identical to Eq. (7.61). Even so, $T$ and $L$ may still differ from each other due to the approximations at the basis of $L$. As such, $T$ and $L$ tend to provide different values for $A$, though this difference may be very small for large $T$ and $L$.

As an alternative viewpoint, we can regard the signal component $a_{\mathrm{ft}} s_{i}$ that manages to creep to the output as a form of output noise. Reflected to the input, this noise gets divided by the gain $T A_{\text {ideal }}$, thus resulting in the equivalent input noise component $s_{n i}=a_{\mathrm{ft}} s_{i} /\left(T A_{\text {ideal }}\right)$. It is clear that as long as Eq. (7.65) is met, then $\left|s_{n i}\right| \ll\left|s_{i}\right|$, so the fact that the feedback network is not unilateral is of little consequence in this case.

### Return-Ratio Calculation Examples

The above concepts are best illustrated via practical examples. Let us start with the familiar op amp circuit of Fig. 7.51, now shown in a more general setting that includes loading both at the input $\left(R_{s i g}\right)$ and at the output $\left(R_{L}\right)$. To find $T$, suppress $v_{s i g}$ by grounding it, break the loop right at the source $a_{v} v_{d}$ and leave the latter open-circuited, inject a test source $v_{t}$, positive at the top, into the circuit downstream, and calculate the return voltage $v_{r}$. With reference to Fig. $7.52 a$, we start out at the left and work our way toward the right via repeated application of the voltage divider rule to obtain

$$
v_{r}=a_{v} v_{d}=a_{v} \frac{-r_{i}}{R_{s i g}+r_{i}} \times \frac{\left(R_{s i g}+r_{i}\right) / / R_{1}}{\left[\left(R_{s i g}+r_{i}\right) / / R_{1}\right]+R_{2}} \times \frac{\left\{\left[\left(R_{s i g}+r_{i}\right) / / R_{1}\right]+R_{2}\right\} / / R_{L}}{\left(\left\{\left[\left(R_{s i g}+r_{i}\right) / / R_{1}\right]+R_{2}\right\} / / / R_{L}\right)+r_{o}} v_{t}
$$

After minor algebra we get

$$
\begin{equation*}
T=-\frac{v_{r}}{v_{t}}=a_{v} \times \frac{1}{1+\frac{R_{s i g}}{r_{i}}} \times \frac{1}{1+\frac{R_{2}}{\left(R_{s i g}+r_{i}\right) / / R_{1}}} \times \frac{1}{1+\frac{r_{o}}{\left\{\left[\left(R_{s i g}+r_{i}\right) / / R_{1}\right]+R_{2}\right\} / / R_{L}}} \tag{7.66}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-045.jpg?height=457&width=581&top_left_y=213&top_left_x=203)

FIGURE 7.51 Non-inverting op amp with input and output loading.

To find $a_{\mathrm{ft}}$, let $a_{v} \rightarrow 0$, so that the dependent-source side of $r_{o}$ goes to 0 V , or ground. This gives us the situation of Fig. 7.52b. Starting out at the right, and applying the voltage divider rule twice, we get

$$
v_{o}=\frac{r_{o} / / R_{L}}{R_{2}+\left(r_{o} / / R_{L}\right)} \times \frac{R_{1} / /\left[R_{2}+\left(r_{o} / / R_{L}\right)\right]}{R_{s i g}+r_{i}+\left\{R_{1} / /\left[R_{2}+\left(r_{o} / / R_{L}\right)\right]\right\}} v_{s i g}
$$

or

$$
\begin{equation*}
a_{\mathrm{ft}}=\lim _{a_{\imath} \rightarrow 0} \frac{v_{o}}{v_{s i g}}=\frac{1}{1+\frac{R_{2}}{r_{o} / / R_{L}}} \times \frac{1}{1+\frac{R_{s i g}+r_{i}}{R_{1} / /\left[R_{2}+\left(r_{o} / / R_{L}\right)\right]}} \tag{7.67}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-045.jpg?height=522&width=534&top_left_y=1498&top_left_x=196)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-045.jpg?height=260&width=608&top_left_y=1777&top_left_x=762)

FIGURE 7.52 Modifying the circuit of Fig. 7.51 to find (a) its return ratio $T$, and (b) the forward transmission $a_{\mathrm{ft}}$ around the dependent source.

Use return-ratio analysis to find the signal-to-load gain $A=v_{o} / v_{\text {sig }}$ of the (mediocre) op amp circuit of Example 7.21, for which $a_{v}=1000 \mathrm{~V} / \mathrm{V}, r_{i}=10 \mathrm{k} \Omega, r_{o}=$ $1.0 \mathrm{k} \Omega, R_{1}=1.0 \mathrm{k} \Omega, R_{2}=9.0 \mathrm{k} \Omega, R_{s i g}=20 \mathrm{k} \Omega$, and $R_{L}=2.0 \mathrm{k} \Omega$. Compare with Example 7.21 and comment.

### Solution

Using Eqs. (7.66) and (7.67), we get
and

$$
\begin{aligned}
T= & 10^{3} \times \frac{1}{1+\frac{20}{10}} \times \frac{1}{1+\frac{9.0}{(20+10) / / 1.0}} \\
& \times \frac{1}{1+\frac{1.0}{\{[(20+10) / / 1.0]+9.0\} / / 2.0}}=10^{3} \times \frac{1}{3} \times \frac{1}{10.3} \times \frac{1}{1.6}=20.2
\end{aligned}
$$

$$
\begin{aligned}
a_{\mathrm{ft}} & =\frac{1}{1+\frac{9.0}{1.0 / / 2.0}} \times \frac{1}{1+\frac{20+10}{1.0 / /[9.0+(1.0 / / 2.0)]}} \\
& =\frac{1}{14.5} \times \frac{1}{34.1}=2.02 \times 10^{-3} \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

Also, we know from basic op amp theory that in the limit $a_{v} \rightarrow \infty$ we have $A_{\text {ideal }}=$ $1+R_{2} / R_{2}=1+9.0 / 1.0=10 \mathrm{~V} / \mathrm{V}$, so Eq. (7.63) gives

$$
A=\frac{10}{1+1 / 20.2}+\frac{2.02 \times 10^{-3}}{1+20.2}=9.528+0.000095 \cong 9.528 \mathrm{~V} / \mathrm{V}
$$

The value of $T$ found here matches the value of $L$ of Example 7.21, so the effect of feedthrough is truly negligible in this example. Indeed, the numerical decomposition of $A$ reveals that the term due to $a_{\mathrm{ft}}$ accounts for only $0.001 \%$ of the overall gain $A$. Alternatively, the fact that $T A_{\text {ideal }}=20.2 \times 10=202 \mathrm{~V} / \mathrm{V}$ and $a_{\mathrm{ft}}=$ $2.02 \times 100^{-3}$ indicates that Eq. (7.65) is met abundantly.

Remark \#1: Looking at the circuit of Fig. $7.52 b$ we observe that if the op amp had $r_{o}=0$, then none of $v_{s i g}$ would be transmitted to $v_{o}$, so we would have $a_{\mathrm{ft}}=0$, as also confirmed by Eq. (7.67). The feedback network would be unilateral in this case.

Remark \#2: To gain additional insight, consider the limiting case $a_{v} \rightarrow 0$, which by Eq. (7.19) occurs for $f \rightarrow \infty$. With $a_{v} \rightarrow 0$ the loop is interrupted, giving $L=$ $T=0$. Then, Eq. (7.61) predicts $A=0$ and thus $v_{o}=A v_{s i g}=0$. On the other hand, Eq. (7.63) predicts $v_{o}=a_{\mathrm{ft}} v_{s i g}=\left(2.02 \times 10^{-3}\right) v_{s i g} \neq 0$. As we know, the latter is correct whereas the former is not.

Next, let us re-examine the feedback-bias BJT circuit of Fig. 7.53, but using return-ratio analysis.

To find $T$, refer to the ac equivalent of Fig. 7.54a, where the loop has been broken right at the upper terminal of the dependent source, which must be short-circuited in
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-047.jpg?height=455&width=355&top_left_y=181&top_left_x=203)

FIGURE 7.53 The feedback-
bias BJT configuration.
order to provide a path for its current to flow. Next, subject the rest of the circuit to a test source $i_{t}$ flowing downward like the dependent source. Using the voltage divider rule and Ohm's law we get

$$
i_{r}=g_{m} v_{\pi}=g_{m} \frac{r_{\pi}}{r_{\pi}+R_{B}} v_{o}=g_{m} \frac{r_{\pi}}{r_{\pi}+R_{B}}\left[\left(R_{B}+r_{\pi}\right) / / R_{C} / / r_{o}\right]\left(-i_{t}\right)
$$

Letting $g_{m} v_{\pi} \rightarrow \beta_{0}$ we obtain, after minor manipulation,

$$
\begin{equation*}
T=-\frac{i_{r}}{i_{t}}=\frac{\beta_{0}}{1+\frac{R_{B}+r_{\pi}}{R_{C} / / r_{o}}} \tag{7.68}
\end{equation*}
$$

(Note that $T<\beta_{0}$.) To find $a_{\mathrm{ff}}$, suppress the dependent source to obtain the situation of Fig. 7.54b. Using the voltage divider rule and Ohm's law, we get

$$
\begin{equation*}
a_{\mathrm{ft}}=\lim _{g_{m} \rightarrow 0} \frac{v_{o}}{i_{i}}=\frac{r_{o} / / R_{C}}{R_{B}+\left(r_{o} / / R_{C}\right)} \times\left\{r_{\pi} / /\left[R_{B}+\left(r_{o} / / R_{C}\right)\right]\right\} \tag{7.69}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-047.jpg?height=313&width=1523&top_left_y=1764&top_left_x=201)

FIGURE 7.54 Ac models of the circuit of Fig. 7.53 to find (a) $T$ and (b) $a_{\mathrm{ft}}$.

EXAMPLE 7.24 Find $T, a_{\mathrm{ft}}$, and $A$ for the feedback-bias BJT circuit of Example 7.15. Compare with the results found there, and comment.

### Solution

(a) Using the component values given in Example $7.15 a$ we get $A_{\text {ideal }}=-R_{B}=$ $-100 \mathrm{~V} / \mathrm{mA}$,

$$
\begin{aligned}
T & =\frac{200}{1+\frac{100+5}{10 / / 100}}=15.9 \\
a_{\mathrm{ft}} & =\frac{100 / / 10}{100+(100 / / 10)} \times\{5 / /[100+(100 / / 10)]\}=0.4 \mathrm{~V} / \mathrm{mA} \\
A & =\frac{-100}{1+1 / 15.9}+\frac{0.40}{1+15.9}=-94.08+0.024=-94.1 \mathrm{~V} / \mathrm{mA}
\end{aligned}
$$

In Example $7.15 a$ we found $L=15.9$ and $A=-94.0 \mathrm{~V} / \mathrm{mA}$. In this case $T$ and $L$ coincide, and feedthrough accounts for only $0.025 \%$ of $A$, a truly negligible amount.
(b) Lowering $R_{B}$ from $100 \mathrm{k} \Omega$ to $5.0 \mathrm{k} \Omega$ gives

$$
\begin{aligned}
& A_{\text {ideal }}=-5.0 \mathrm{~V} / \mathrm{mA} \quad T=95.2 \\
& a_{\mathrm{ft}}=2.4 \mathrm{~V} / \mathrm{mA} \quad A=-4.948+0.025=-4.923 \mathrm{~V} / \mathrm{mA}
\end{aligned}
$$

In Example $7.15 b$ we found $L=65.5$ and $A=-4.925 \mathrm{~V} / \mathrm{mA}$. Even though the values of $A$ are still very close, $T$ and $L$ differ appreciably, and feedthrough has increased from $0.025 \%$ to about $0.5 \%$ of $A$. Note that the value of $A$ obtained via $T$ is exact, whereas that obtained via $L$ is only approximate.

Next, consider the generalized BJT circuit of Fig. 7.55a, shown with the external driving source already suppressed. Depending on where we apply the input and where we obtain the output, different topologies can be realized with just this one circuit! Thus, applying a voltage to the base or a current to the emitter we have, respectively, series or shunt summing. Using as output the emitter voltage or the collector current we have, respectively, shunt or series sensing. Yet, $T$ is an intrinsic characteristic of the circuit that must be invariant irrespective of the topology in use. On the contrary, both $L$ and $a_{\mathrm{ft}}$ will generally vary with the topology. To find $T$, break the loop right downstream of the controlled source, short-circuit the latter, and then subject the circuit downstream to the test source $i_{t}$ as in Fig. 7.55b. Using the voltage divider rule and Ohm's law we get

$$
i_{r}=g_{m} v_{\pi}=g_{m} \frac{r_{\pi}}{R_{B}+r_{\pi}}\left(-v_{e}\right)=g_{m} \frac{r_{\pi}}{R_{B}+r_{\pi}}\left[\left(R_{B}+r_{\pi}\right) / / R_{E} / / r_{o}\right]\left(-i_{t}\right)
$$

Letting $g_{m} v_{\pi} \rightarrow \beta_{0}$, we obtain, after minor manipulation,

$$
\begin{equation*}
T=-\frac{i_{r}}{i_{t}}=\frac{\beta_{0}}{1+\frac{R_{B}+r_{\pi}}{R_{E} / r_{o}}} \tag{7.70}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-049.jpg?height=415&width=1173&top_left_y=208&top_left_x=181)

FIGURE 7.55 (a) A generalized BJT ac circuit, and (b) its small-signal model to find $T$.
(Note that $T<\beta_{0}$.) Interestingly enough, there is a formal similarity with Eq. (7.68), provided we let $R_{C} \rightarrow R_{E}$. Can you explain why?
(a) In the generalized ac circuit of Fig. 7.55a, let $R_{B}=0$ and $R_{E}=10 \mathrm{k} \Omega$. Moreover, let the BJT have $g_{m}=1 /(25 \Omega), r_{\pi}=5 \mathrm{k} \Omega$, and $r_{o}=100 \mathrm{k} \Omega$, as in previous examples. Find $T$.
(b) Repeat, but with $R_{B}=30 \mathrm{k} \Omega$.
(c) Under what conditions is $T$ maximized, and what is its value in this example?

### Solution

(a) Applying Eq. (7.70) we get

$$
T=\frac{200}{1+\frac{5}{10 / / 100}}=129
$$

(b) Changing $R_{B}$ from zero to $30 \mathrm{k} \Omega$ lowers the return ratio to $T=41$.
(c) Equation (7.70) indicates that $T$ is maximized when $R_{B}=0$ and $R_{E}=\infty$, implying the use of an ideal current sink to provide emitter bias for the CB transistor. Then, $T_{\max }=\beta_{0} /\left(1+r_{\pi} / r_{o}\right)=190.5$.
(a) Using the value of $T$ calculated in Example 7.25a, find the gain $A$ for the case in which the generalized BJT circuit of Fig. $7.55 a$ is operated in the seriesshunt mode as in Example 7.12, with the output being the emitter voltage. Compare and comment.
(b) Find the gain $A$ if the generalized BJT circuit of Fig. $7.55 a$ is operated in the series-series mode as in Example 7.17, with the output being now the collector current. Compare and comment.

### Solution

From Example $7.25 a$ we know that $T=129$ regardless of the feedback topology.
(a) For series-shunt operation, refer to Fig. 7.56. To find $A_{\text {ideal }}$, let $g_{m} \rightarrow \infty$ in Fig. 7.56a. In this limit the dependent source will require a vanishingly small control voltage $v_{\pi}$ to sustain a finite output $v_{0}$. So, both the voltage across and
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-050.jpg?height=419&width=1234&top_left_y=201&top_left_x=421)

FIGURE 7.56 (a) Ac model for the BJT of Fig. 7.55a in series-shunt operation.
(b) Circuit to find $a_{\mathrm{ft}}$.
the current through $r_{\pi}$ will approach zero, giving, for $R_{B}=0, v_{o}=v_{b}=v_{s i g}$, or $A_{\text {ideal }}=v_{o} / v_{s i g}=1 \mathrm{~V} / \mathrm{V}$. To find $a_{\mathrm{ft}}$, suppress the BJT's dependent source by replacing it with an open circuit. This results in the situation of Fig. 7.56b, where we have, by the voltage divider rule,

$$
a_{\mathrm{ft}}=\lim _{g_{m} \rightarrow 0} \frac{v_{o}}{v_{s i g}}=\frac{R_{E} / / r_{o}}{R_{B}+r_{\pi}+\left(R_{E} / / r_{o}\right)}=\frac{1}{1+\frac{R_{B}+r_{\pi}}{R_{E} / / r_{o}}}=\frac{1}{1+\frac{0+5}{10 / / 100}}=\frac{1}{1.55}
$$

Using Eq. (7.63) we finally get

$$
A=\frac{1}{1+1 / 129}+\frac{1 / 1.55}{1+129}=0.992+0.005=0.997 \mathrm{~V} / \mathrm{V}
$$

This result matches exactly that of Example 7.12. To test for the accuracy of both methods, recall from Section 2.9 that the exact gain for $R_{B}=0$ is

$$
A_{\text {exact }}=\frac{1}{1+\frac{r_{\pi}}{\left(\beta_{0}+1\right)\left(R_{E} / / r_{o}\right)}}=\frac{1}{1+\frac{5}{201(10 / / 100)}}=0.997 \mathrm{~V} / \mathrm{V}
$$

Viewing the above expression as $A_{\text {exact }}=1 /\left(1+1 / L_{\text {exact }}\right)$, we readily find

$$
L_{\text {exact }}=\frac{\left(\beta_{0}+1\right)\left(R_{E} / / r_{o}\right)}{r_{\pi}}=\frac{201(10 / / 100)}{5}=365.5
$$

which is in excellent agreement with $L=364$ of Example 7.12. Thus, whether we use Eq. (7.61) with $L=364$ (as we did in Example 7.12), or we use Eq. (7.63) with $T=129$ and $a_{\mathrm{ft}}=1 / 1.55$ (as we are doing presently), we obtain consistent results for $A$.
(b) For series-series operation refer to Fig. 7.57. As we know, negative feedback regulates the emitter current $i_{e}$. The output current $i_{o}$ is outside the feedback loop, but it is related to the former as $i_{o}=\alpha_{0} i_{e}$. Given that $i_{e}=v_{e} / R_{E}$, we can recycle the value of $v_{e} / v_{s i g}$ found in part (a) and write

$$
\frac{i_{o}}{v_{s i g}}=\frac{i_{o}}{i_{e}} \times \frac{i_{e}}{v_{e}} \times \frac{v_{e}}{v_{s i g}}=\alpha_{0} \times \frac{1}{R_{E}} \times A=\frac{200}{201} \times \frac{1}{10^{4}} \times 0.997=99.2 \mu \mathrm{~A} / \mathrm{V}
$$

Comparing the gain of $98.7 \mu \mathrm{~A} / \mathrm{V}$ of Example 7.17 against the exact gain of $99.2 \mu \mathrm{~A}$ found here we conclude that the discrepancy stems from the approximations at the basis of the circuits of Fig. 7.38.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-051.jpg?height=365&width=760&top_left_y=358&top_left_x=308)

FIGURE 7.57 Ac model for the BJT of Fig. 7.55a in series-series operation.

Remark: As mentioned, $L$ generally varies with the feedback topology, even though the sourceless circuit is the same. However, $T$ remains invariant.

We conclude our list of examples with the circuit of Fig. 7.58a, which uses a CMOS inverter to implement an inverting amplifier with ideal voltage gain $A_{v}=v_{o} / v_{i}=$ $-R_{2} / R_{1}$. As we know, this is a shunt-shunt configuration, so to prepare the circuit for two-port analysis we perform the input source transformation of Fig. 7.58b. To find $A_{v}$, we first find the transresistance gain $A=v_{o} / i_{i}$, then we let

$$
\begin{equation*}
A_{v}=\frac{v_{o}}{v_{i}}=\frac{v_{o}}{i_{i}} \times \frac{i_{i}}{v_{i}}=\frac{A}{R_{1}} \tag{7.71}
\end{equation*}
$$

As we know, the two FETs of a CMOS inverter reinforce each other in providing transconductance, acting like a single equivalent FET with equivalent parameters

$$
g_{m}=g_{m n}+g_{m p} \quad r_{o}=r_{o n} / / r_{o p}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-051.jpg?height=266&width=562&top_left_y=1727&top_left_x=203)
(a) $G N D$
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-051.jpg?height=493&width=586&top_left_y=1517&top_left_x=806)
(b)

FIGURE 7.58 (a) Using a CMOS inverter as an inverting amplifier. (b) Its shunt-shunt ac equivalent.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-052.jpg?height=365&width=1539&top_left_y=203&top_left_x=109)

FIGURE 7.59 (a) Small-signal equivalent of the circuit of Fig. 7.58. (b) Circuit to find $a$ and $b$.

This is shown in the small-signal equivalent of Fig. 7.59a. This circuit is simple enough that we can find its exact gain $A$ directly. We will also find $A$ via loop-gain analysis and via return-ratio analysis, so we can compare the three methods and get a better feel for similarities and differences.

### Exercise 7.2

Use node analysis to prove that the circuit of Fig. 7.59a gives

$$
\begin{equation*}
A=\frac{v_{o}}{i_{i}}=-R_{2} \frac{1}{1+\frac{\left(1+R_{2} / R_{1}\right)\left(1+R_{2} / r_{o}\right)}{g_{m} R_{2}-1}} \tag{7.72}
\end{equation*}
$$

so that, expressing as $A=\left(-R_{2}\right) /\left(1+1 / L_{\text {exact }}\right)$ we get, after minor manipulation,

$$
\begin{equation*}
L_{\text {exact }}=\frac{g_{m}\left(R_{2} / / r_{o}\right)-1 /\left(1+R_{2} / r_{o}\right)}{1+R_{2} / R_{1}} \tag{7.73}
\end{equation*}
$$

Next, estimate $L$ via two-port analysis. With reference to Fig. $7.59 b$ we readily find

$$
\begin{gather*}
a=\frac{v_{o}}{i_{\varepsilon}}=-g_{m}\left(R_{1} / / R_{2}\right) \times\left(R_{2} / / / r_{o}\right) \quad b=\lim _{i_{s} \rightarrow 0} \frac{i_{f}}{v_{o}}=-\frac{1}{R_{2}} \\
L=a b=\frac{g_{m}\left(R_{2} / / r_{o}\right)}{1+R_{2} / R_{1}} \tag{7.74}
\end{gather*}
$$

Note that the two-port approximation gives, for this circuit, $L>L_{\text {exact }}$. The difference between the two depends on the ratio $R_{2} / r_{o}$ : the higher this ratio, the smaller the difference.

Finally, we turn to Fig. 7.60 $a$ and $b$ to calculate $T$ and $a_{\mathrm{ft}}$, respectively. The results are easily found to be

$$
\begin{equation*}
T=-\frac{i_{r}}{i_{t}}=\frac{g_{m} r_{o}}{1+\left(R_{2}+r_{o}\right) / R_{1}} \quad a_{\mathrm{ft}}=\lim _{g_{m} \rightarrow 0} \frac{v_{o}}{i_{i}}=\frac{r_{o}}{1+\left(R_{2}+r_{o}\right) / R_{1}} \tag{7.75}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-053.jpg?height=311&width=1194&top_left_y=206&top_left_x=199)

FIGURE 7.60 Small-signal circuits to find (a) $T$ and (b) $a_{\mathrm{ft}}$ for the circuit of Fig. 7.58.
(a) In the circuit of Fig. $7.58 a$ let $g_{m}=2 \mathrm{~mA} / \mathrm{V}$ and $r_{o}=50 \mathrm{k} \Omega$. Assuming the circuit has been configured for unity voltage-gain operation using $R_{1}=R_{2}=$ $100 \mathrm{k} \Omega$, find $A_{v}=v_{o} / v_{i}$ via exact analysis, via two-port analysis, and via return-ratio analysis. Compare the three cases, and comment.
(b) Repeat, but for the case $R_{1}=R_{2}=10 \mathrm{k} \Omega$. Compare with part (a), and comment.

### Solution

(a) We have $A_{v(\text { (ideal })}=-100 / 100=-1 \mathrm{~V} / \mathrm{V}$. Applying Eqs. (7.71) through (7.73) we get

$$
\begin{aligned}
& L_{\mathrm{exact}}=\frac{2(100 / / 50)-1 /(1+100 / 50)}{1+100 / 100}=33.33-0.17=33.17 \\
& A_{v}=\frac{-100 / 100}{1+1 / 33.17}=-0.9707 \mathrm{~V} / \mathrm{V}
\end{aligned}
$$

Applying Eqs. (7.74) and (7.61) gives

$$
L=2 \frac{100 / / 50}{1+100 / 100}=33.33 \quad A_{v}=\frac{-100 / 100}{1+1 / 33.3}=-0.9709 \mathrm{~V} / \mathrm{V}
$$

Applying Eq. (7.75) we find

$$
T=\frac{2 \times 50}{1+(100+50) / 100}=40.0 \quad a_{\mathrm{ft}}=\frac{50}{1+(100+50) / 100}=20 \mathrm{~V} / \mathrm{A}
$$

so Eq. (7.63) gives

$$
A_{v}=\frac{1}{100}\left(\frac{-100}{1+1 / 40}+\frac{20}{1+40}\right)=\frac{1}{100}(-97.56+0.49)=-0.9707 \mathrm{~V} / \mathrm{V}
$$

As mentioned, two-port analysis for this circuit slightly overestimates the value of $L$ compared to the exact value, but in this case the effect upon $A_{v}$ is negligible. Note also that $T>L$ as $a_{\mathrm{ft}}$ and $A_{v(\text { ideal })}$ have opposite polarities. Forward transmission through the feedback network accounts for about $0.5 \%$ of $A_{v}$.
(b) Recalculating with $R_{1}=R_{2}=10 \mathrm{k} \Omega$ we have $A_{v(\text { (ideal })}=-10 / 10=-1 \mathrm{~V} / \mathrm{V}$ and

$$
\begin{array}{ll}
L_{\text {exact }}=7.917 & A_{v}=-0.8879 \mathrm{~V} / \mathrm{V} \\
L=8.333 & A_{v}=-0.8929 \mathrm{~V} / \mathrm{V} \\
T=14.29 & a_{\mathrm{ft}}=7.14 \mathrm{~V} / \mathrm{A} \quad A_{v}=-0.9346+0.047=-0.8879 \mathrm{~V} / \mathrm{V}
\end{array}
$$

Again, the gain via the return-ratio matches the exact gain. Lowering $R_{1}$ and $R_{2}$ simultaneously by an order of magnitude leaves $A_{v(\text { (ideal })}$ unchanged but alters the loading as well as the forward transmission conditions appreciably. Indeed, $T$ is now almost twice as large as $L$ and forward transmission through the feedback network now accounts for $5 \%$ of $A_{v}$.

### The Feedback Factor $\boldsymbol{\beta}$

By analogy with the two-port loop gain $L$, which takes on the form of a product $L=$ $a b$, it is convenient to express also the return-ratio loop gain $T$ as a product,

$$
\begin{equation*}
T=a \beta \tag{7.76}
\end{equation*}
$$

where $\beta$, the counterpart of $b$, shall be called the return-ratio feedback factor (this, to distinguish it from $b$, which shall be called the two-portfeedback factor). The derivation of $\beta$ is similar to that of $T$ of Eq. (7.60), except that the return signal is now the signal controlling the dependent source (alternatively, we can find $T$ and then let $\beta=$ $T / a$ ). Just as $T$ and $L$ are generally different, so are $\beta$ and $b$, though they may coincide in particular cases. Let us illustrate via the noninverting op amp of Fig. 7.20, repeated for convenience in Fig. 7.61a. With reference to Fig. 7.61b, we readily find $\beta$ using the voltage divider twice. So, we write

$$
\beta=-\frac{v_{d}}{v_{t}}=\frac{1}{1+\frac{R_{2}}{r_{i} / / R_{1}}} \times \frac{1}{1+\frac{r_{o}}{r_{i} / / R_{1}+R_{2}}} \quad a=a_{v}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-054.jpg?height=468&width=487&top_left_y=1541&top_left_x=452)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-054.jpg?height=239&width=446&top_left_y=1785&top_left_x=1012)

FIGURE 7.61 (a) Noninverting amplifier and (b) circuit to find $\beta$. $\left(a_{\mathrm{v}}=1000 \mathrm{~V} / \mathrm{V}, r_{i}=10 \mathrm{k} \Omega, r_{o}=1.0 \mathrm{k} \Omega, R_{1}=1.0 \mathrm{k} \Omega\right.$, and $R_{2}=9.0 \mathrm{k} \Omega$.)

On the other hand, according to Eqs. (7.48) and (7.46), we have, respectively,

$$
b=\frac{1}{1+R_{2} / R_{1}} \quad a=\frac{r_{i}}{r_{i}+\left(R_{1} / / R_{2}\right)} a_{v} \frac{R_{1}+R_{2}}{r_{o}+R_{1}+R_{2}}
$$

Plugging in the component values of Fig. 7.61 we get

$$
L=a b=833.3 \times \frac{1}{10}=83.33 \quad T=a \beta=1000 \times \frac{1}{12}=83.33
$$

We now make the following generalizations:

- Two-port analysis makes the feedback factor $b$ depend exclusively on the feedback network such that $b=1 / A_{\text {ideal }}(=1 / 10$ in the above example). Loading by the feedback network is absorbed by the amplifier, causing gain to drop from $a_{v}=1000$ to $a=833.3$ in the example.
- Return-ratio analysis leaves the amplifier gain unchanged at $a_{v}$ ( $=1000$ in the example). Loading by amplifier is absorbed by the feedback network, causing the feedback factor to drop from $b=1 / 10$ to $\beta=1 / 12$ in the example. Consequently, $A_{\text {ideal }} \neq 1 / \beta$ (to avoid confusion, always calculate $A_{\text {ideal }}$ in the limit $k \rightarrow \infty$, or $a_{v} \rightarrow \infty$ in the case of an op amp circuit).
- In this particular case we have $T=L$, though in general $T$ and $L$ differ. As mentioned, even when $T$ and $L$ are equal, they contribute differently to $A$ as per Eqs (7.61) and (7.63).
As we embark upon the study of stability, in Section 7.7, we shall use returnratio analysis because it shifts loading to $\beta$ and it makes easier to investigate stability graphically, starting with the Bode plot of the gain $a$.

## 7.6 BLACKMAN'S IMPEDANCE FORMULA AND INJECTION METHODS

The return ratio is a powerful tool also for the calculation of the closed-loop resistance $R$ between any pair of nodes of a negative-feedback circuit - not just the nodes of the input and output ports. Such a resistance is given by Blackman's impedance formula ${ }^{5}$

$$
\begin{equation*}
R=r_{0} \frac{1+T_{\mathrm{sc}}}{1+T_{\mathrm{oc}}} \tag{7.77}
\end{equation*}
$$

where

$$
\begin{equation*}
r_{0}=\lim _{k \rightarrow 0} R \tag{7.78}
\end{equation*}
$$

is the resistance between the given node pair with the dependent source set to zero, and $T_{\mathrm{sc}}$ and $T_{\mathrm{oc}}$ are the return ratios of the same source with the two nodes shortcircuited and open-circuited, respectively. Blackman's formula holds regardless of the feedback topology in use. Oftentimes either $T_{\mathrm{sc}}$ or $T_{\mathrm{oc}}$ is zero, indicating that negative feedback will either raise $r_{0}$ by $\left(1+T_{\mathrm{sc}}\right.$ ) (this is the case of a series topology), or lower $r_{0}$ by ( $1+T_{\mathrm{oc}}$ ) (shunt topology).

EXAMPLE 7.28 Consider the feedback-bias shunt-shunt circuit of Fig. 7.62, which has already been the focus of our attention in Examples 7.15 and 7.24. Assuming the parameter values of Example $7.15 b\left(R_{B}=5.0 \mathrm{k} \Omega, R_{C}=10 \mathrm{k} \Omega, g_{m}=1 /(25 \Omega), r_{\pi}=\right.$ $5 \mathrm{k} \Omega$, and $r_{o}=100 \mathrm{k} \Omega$ ), use Blackman's impedance formula to find (a) $R_{i}$ and (b) $R_{o}$. Compare with the example and comment.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-056.jpg?height=499&width=458&top_left_y=464&top_left_x=452)

FIGURE $\mathbf{7 . 6 2}$ Feedback-bias BJT circuit of Example 7.28.

### Solution

To find $r_{i 0}$ and $r_{o 0}$, we let $g_{m} \rightarrow 0$ while suppressing the input source $i_{i}$ and leaving the output port open-circuited. This yields the situation of Fig. 7.63a. To find the return ratios we use Fig. 7.63b.
(a) By inspection,

$$
r_{i 0}=r_{\pi} / /\left[R_{B}+\left(r_{o} / / R_{C}\right)\right]=5 / /[5+(100 / / 10)]=3.69 \mathrm{k} \Omega
$$

Short-circuiting the input port in Fig. 7.63b yields $v_{\pi}=0$, and thus $i_{r}=0$, so $T_{\mathrm{sc}}=0$. Leaving the input port open-circuited results in the same situation of Example 7.24b, so we recycle the result obtained there and write $T_{\text {oc }}=95.2$. Consequently,

$$
R_{i}=r_{i 0} \frac{1+T_{\mathrm{sc}}}{1+T_{\mathrm{oc}}}=3.69 \frac{1+0}{1+95.2}=38.4 \Omega
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-056.jpg?height=372&width=1452&top_left_y=1711&top_left_x=150)

FIGURE 7.63 Ac models of the circuit of Fig. 7.62 for finding (a) $r_{i 0}$ and $r_{00}$, and (b) the return ratios.
(b) Referring again to Fig. 7.63a, we have, by inspection,

$$
r_{o 0}=R_{C} / / r_{o} / /\left(R_{B}+r_{\pi}\right)=4.76 \mathrm{k} \Omega
$$

Short-circuiting the output port in Fig. 7.63b gives again $v_{\pi}=0$, and thus $T_{\mathrm{sc}}=0$. Likewise, leaving it open-circuited gives again $T_{\mathrm{oc}}=95.2$. Consequently,

$$
R_{o}=r_{o 0} \frac{1+T_{s c}}{1+T_{o c}}=4.76 \frac{1+0}{1+95.2}=49.5 \Omega
$$

The values of $38.2 \Omega$ and $49.2 \Omega$ found in Example $7.15 b$ are fairly close to the present (exact) ones.

The Wilson current mirror, shown in ac form in Fig. 7.64a, is a shunt-series feedback circuit based on $Q_{3}$. This is better understood via the small-signal equivalent of Fig. 7.64b, where we note that diode-connected $Q_{2}$ senses $Q_{3}$ 's emitter current, and current mirror $Q_{1}$ replicates this current with a feedback factor of unity and then sinks it from the input summing node. We wish to use Blackman's impedance formula in connection with the dependent source modeling $Q_{1}$ to find expressions for (a) $R_{i}$ and (b) $R_{o}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-057.jpg?height=473&width=1488&top_left_y=1121&top_left_x=240)

FIGURE 7.64 (a) The Wilson current mirror, and (b) its small-signal equivalent.

### Solution

To find $r_{i 0}$ and $r_{00}$, we suppress the input source $i_{i}$ and set the dependent source modeling $Q_{1}$ to zero. This yields the situation of Fig. 7.65a. By inspection,

$$
r_{i 0}=r_{\pi}+\left(\beta_{0}+1\right)\left(\frac{1}{g_{m}} / / r_{o}\right) \cong 2 \pi_{\pi} \quad r_{o 0}=r_{o}+\frac{1}{g_{m}} \cong r_{o}
$$

To find the return ratios, refer to Fig. 7.65b.
(a) With the input terminal open circuited as in Fig. 7.65b we have $i_{r}=1 i_{2} \cong\left(\beta_{0}\right.$ $+1) i_{1}=-\left(\beta_{0}+1\right) i_{t}$, where we have ignored $r_{o}$ because it is in parallel with $1 / g_{m}$, and $r_{o} \gg 1 / g_{m}$. Consequently, $T_{\mathrm{oc}}=-i_{r} / i_{t}=\left(\beta_{0}+1\right)$. Shorting the
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-058.jpg?height=449&width=1459&top_left_y=170&top_left_x=196)

FIGURE 7.65 Modifying the circuit of Fig. $7.64 b$ to find (a) $r_{i 0}$ and $r_{00}$, and (b) to find the return ratios.
input terminal to ground will cause $i_{t}$ to flow through this short, giving $i_{1}=$ $i_{2}=0$. So, $i_{r}=0$ and $T_{\mathrm{sc}}=0$. Then,

$$
R_{i}=r_{i 0} \frac{1+T_{\mathrm{sc}}}{1+T_{\mathrm{oc}}}=2 r_{\pi} \frac{1+0}{1+\beta_{0}+1} \cong \frac{2}{g_{m}}
$$

(b) With the output terminal shorted to ground as in Fig. $7.65 b$ we can recycle the result of ( $a$ ) and write $T_{\mathrm{sc}}=\left(\beta_{0}+1\right)$. Open-circuiting the output terminal will cause the current $\beta_{0} i_{1}$ to flow through $r_{o}$, yielding $i_{r}=1 i_{2}=i_{1}=-i_{t}$. So, $T_{\text {oc }}=-i_{r} / i_{t}=1$, and

$$
R_{o}=r_{o 0} \frac{1+T_{\mathrm{sc}}}{1+T_{\mathrm{oc}}} \cong r_{o} \frac{1+\beta_{0}+1}{1+1}=r_{o} \frac{\beta_{0}+2}{2} \cong \frac{\beta_{0}}{2} r_{o}
$$

Both results coincide with those derived in Section 4.8. It is interesting to note that in part (b) both $T_{\mathrm{oc}}$ and $T_{\mathrm{sc}}$ are different from zero. Moreover, $T_{\mathrm{sc}}$ in part (b) is the same as $T_{\mathrm{oc}}$ in part (a).

### Finding T via Successive Voltage and Current Injections

When dealing with a feedback circuit in physical form in the lab, or in transistorlevel schematic form in the course of computer simulation, we do not have access to any internal dependent sources, so we need alternative techniques for finding $T$. An elegant technique, devised by R. D. Middlebrook, is the successive voltage and current injection technique ${ }^{6}$ depicted in Fig. 7.66. Its steps are as follows.

- First, set all external signal sources to zero so as to put the circuit in its dormant state.
- Break the feedback loop and insert a series test source $v_{t}$ as shown in Fig. 7.66a. The perturbation introduced by $v_{t}$ will cause a signal $v_{f}$ to propagate in the forward direction, in turn causing the feedback system to respond with a return signal $v_{r}$. Measure the voltage ratio

$$
\begin{equation*}
T_{v}=-\frac{v_{r}}{v_{f}} \tag{7.79a}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-059.jpg?height=426&width=1274&top_left_y=205&top_left_x=194)

FIGURE 7.66 Illustrating the (a) voltage injection and (b) current injection method.

- Remove the test source $v_{t}$ and apply between the same set of wires a shunt test source $i_{t}$ as shown in Fig. 7.66b. The perturbation introduced by $i_{t}$ will cause a signal $i_{f}$ to propagate in the forward direction, in turn causing the feedback system to respond with a return signal $i_{r}$. Measure the current ratio

$$
\begin{equation*}
T_{i}=-\frac{i_{r}}{i_{f}} \tag{7.79b}
\end{equation*}
$$

- It has been proved ${ }^{6}$ that the loop's return ratio $T$ is such that

$$
\begin{equation*}
\frac{1}{1+T}=\frac{1}{1+T_{v}}+\frac{1}{1+T_{i}} \tag{7.80}
\end{equation*}
$$

Solving for $T$ we get

$$
\begin{equation*}
T=\frac{T_{v} T_{i}-1}{T_{v}+T_{i}+2} \tag{7.81}
\end{equation*}
$$

It should be noted that $T$ is independent of the particular point of the loop at which the two injections are made.
Depending on the point of signal injection, the ac signals $v_{t}$ and $i_{t}$ may need to be kept suitably small to prevent the circuit from behaving nonlinearly. Note that both test setups preserve the existing dc biasing conditions as well as the existing loading conditions. An actual example will better illustrate.

Shown in Fig. 7.67 is the feedback-bias BJT that we have already investigated in Examples 7.15 and 7.24. Lacking any input signal source, the circuit is already in its ac dormant state. Assuming the BJT has $I_{s}=2 \mathrm{fA}, \beta_{F}=200$, and $V_{A}=100 \mathrm{~V}$, use PSpice to find the return ratio of this circuit, compare with Example 7.24, and comment.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-060.jpg?height=517&width=377&top_left_y=216&top_left_x=450)

FIGURE 7.67 The feedback-bias BJT configuration.

### Solution

In this circuit rendition feedback signal flow is counterclockwise, and there are three points where we can apply our double injection, namely, $X, Y$, and $Z$. In the laboratory one would choose a point where signal levels are the highest and therefore easier to measure, especially in the presence of noise. In the PSpice circuits of Fig. 7.68 we have arbitrarily chosen point $Y$, but the procedure can readily be repeated for the other two. (Note that the current injection circuit requires the use of two $0-\mathrm{V}$ dummy sources $V_{1}$ and $V_{2}$ to sense the currents $i_{r}$ and $i_{f}$ ) The results of the simulation are as follows:

| At point $X:$ | $T_{v}=179.8$ | $T_{i}=201.1$ | $T=94.4$ |
| :--- | :--- | :--- | :--- |
| At point $Y:$ | $T_{v}=353.4$ | $T_{i}=129.4$ | $T=94.3$ |
| At point $Z:$ | $T_{v}=1983$ | $T_{i}=99.26$ | $T=94.4$ |

It is interesting that $T_{v}$ and $T_{i}$ change with the point of injection whereas $T$ is invariant (within roundoff errors). Also, $T$ agrees well with the value found in Example $7.24 b$ via hand calculations.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-060.jpg?height=571&width=1039&top_left_y=1471&top_left_x=446)

FIGURE 7.68 Applying (a) voltage and (b) current injection to the feedback-bias circuit of Fig. 7.67.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-061.jpg?height=293&width=539&top_left_y=208&top_left_x=205)

FIGURE 7.69 The impedances $Z_{f}$ and $Z_{r}$ seen
looking in the forward and the return directions.

### Single-Injection Approximations

According to Eq. (7.80), the terms $\left(1+T_{v}\right)$ and $\left(1+T_{i}\right)$ combine like resistances in parallel. If one happens to be much larger than the other, the smaller will prevail and we can estimate $T$ more quickly by limiting ourselves to just one signal injection, namely, the one that results in the much smaller return ratio. For instance, had we anticipated the condition $T_{v} \gg T_{i}$ at point $Z$ in the circuit of Fig. 7.67, we could have skipped the voltage injection to approximate $T \cong T_{i} \cong 99$, for an error of less than $5 \%$. The choice of where to break the feedback loop is facilitated by the fact that $T_{v}$ and $T_{i}$ are constrained as ${ }^{6}$

$$
\begin{equation*}
\frac{1+T_{v}}{1+T_{i}}=\frac{Z_{r}}{Z_{f}} \tag{7.82}
\end{equation*}
$$

where $Z_{f}$ and $Z_{r}$ are the impedances seen looking in the forward and in the return directions from the point of signal injection, as depicted in Fig. 7.69. For instance, if we select point $Z$ in Fig. 7.67, then $Z_{r}$ is the impedance seen looking into the collector, which is much higher than the impedance $Z_{f}$ seen looking toward the node common to $R_{C}$ and $R_{B}$. Consequently, Eq. (7.82) predicts $\left(1+T_{v}\right) \gg\left(1+T_{i}\right)$, as we already know from Example 7.30.

Using the 741 macro-model available in PSpice's library, find $T$ for the case in which the 741 is configured to function as an inverting amplifier with a gain of $-100 \mathrm{~V} / \mathrm{V}$ by means of two resistances $R_{1}=1.0 \mathrm{k} \Omega$ and $R_{2}=100 \mathrm{k} \Omega$. Pick a point where only one injection is sufficient.

### Solution

After setting the input source to zero to put the circuit in its dormant state, we end up with the situation of Fig. 7.70. The point of injection has been chosen right at the op amp's inverting input, where $Z_{f}\left(=r_{i}\right)$ is in the $\mathrm{M} \Omega$ range, while $Z_{r}\left[=R_{1} / /\right.$ $\left.\left(R_{2}+r_{o}\right)\right]$ is less than $1 \mathrm{k} \Omega$. With a disparity on the order of three orders of magnitude it is hardly worth performing the current-injection test, so we limit ourselves to a mere voltage test, as shown. The simulation yields

$$
T_{v}=1970
$$

The student can verify that a current-injection test at the same node would yield $T_{i}=1.983 \times 10^{6}\left(\gg T_{v}\right)$, thus validating the approximation $T \cong T_{v}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-062.jpg?height=522&width=590&top_left_y=312&top_left_x=414)

FIGURE 7.70 Circuit of Example 7.31, where only voltage injection suffices.

## 7.7 STABILITY IN NEGATIVE-FEEDBACK CIRCUITS

For all its benefits, negative feedback poses the potential risk of oscillation. Because of this, negative feedback was met with skepticism when first proposed by Harold Black, in 1928. However, once this risk became better understood and suitable cures were developed to tame unwanted oscillations, negative feedback established itself as the cornerstone of electronics and control we know today. To develop a basic feel for stability (or lack thereof), let us assume negligible feedthrough, so both the amplifier and the feedback network can be regarded as unilateral as in Fig. 7.71. Moreover, we take the viewpoint of the IC designer, whose concern is to ensure that the amplifier is stable when operated with purely resistive feedback networks. With this type of feedback, the feedback factor $\beta$ is frequency independent and its phase angle is thus zero. (If the feedback network contains reactive elements such as capacitors, then $\beta$ too will be frequency dependent and the responsibility for ensuring stability is now shifted to the user. ${ }^{7}$ )

Let us start out by expressing the closed-loop gain in the more insightful form

$$
\begin{equation*}
A(j f)=\frac{S_{o}}{S_{i}}=A_{\text {ideal }} \times D(j f) \tag{7.83}
\end{equation*}
$$

where $A_{\text {ideal }}=\lim _{a \rightarrow \infty} A$, and the quantity

$$
\begin{equation*}
D(j f)=\frac{1}{1+1 / T(j f)} \tag{7.84}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-063.jpg?height=250&width=548&top_left_y=211&top_left_x=203)

FIGURE 7.71 Negative-feedback system with unilateral amplifier and feedback network, and a frequency independent feedback factor $\beta$.
is called the discrepancy function because it gives a measure of the deviation of $A(j f)$ from $A_{\text {ideal }}$. Moreover, $T(j f)=\beta a(j f)$ is the familiar loop gain. As a signal $S_{\varepsilon}$ propagates around the loop and returns to the summer $\Sigma$ as $S_{f}$, it experiences a frequency-dependent phase shift, which we shall denote as ph $T(j f)$. If this shift reaches $-180^{\circ}$, then feedback turns from negative to positive. Denoting the frequency at which this happens as $f_{-180^{\circ}}$, it follows that $T\left(j f_{-180^{\circ}}\right)$ is a real, negative number such as $-0.5,-1,-2$, etc. We have three possibilities:

- $\left|T\left(j f_{-180^{\circ}}\right)\right|<1$. Even though feedback is positive at $f_{-180^{\circ}}, S_{\varepsilon}$ gets attenuated each time it goes around the loop, so if we set $S_{i} \rightarrow 0$, any signal present in the loop will eventually decay to zero, and the system is said to be stable.
- $T\left(j f_{-180^{\circ}}\right) \rightarrow-1$. By Eq. (7.84) we have $D\left(j f_{-180^{\circ}}\right) \rightarrow \infty$ and so $A\left(j f_{-180^{0}}\right) \rightarrow \infty$, indicating that the system can sustain an output signal $S_{o} \neq 0$ with a vanishingly small input $S_{i} \rightarrow 0$. Once a signal component $S_{\varepsilon}\left(j f_{-180^{\circ}}\right)$ is initiated in the circuit (for instance by electronic noise, which is always present in one form or another), this component will emerge from the feedback network as $S_{f}\left(j f_{-180^{0}}\right)=-S_{\varepsilon}\left(j f_{-180^{\circ}}\right)$, and then undergo one more inversion at the summer $\Sigma$ to reappear at the amplifier's input as the original signal $S_{\varepsilon}\left(j f_{-180^{\circ}}\right)$ itself! A circuit's ability to sustain a signal at $f_{-180^{\circ}}$ qualifies it as an oscillator, and such the circuit is regarded as unstable.
- $\left|T\left(j f_{-180}\right)\right|>1$. Suppose we change $T\left(j f_{-180^{\circ}}\right)$ from -1 to a more negative value, say, -1.1 . This implies a $10 \%$ increase in magnitude each time a signal goes around the loop, thus resulting in oscillations of growing magnitude. The oscillations will grow until some inherent circuit nonlinearity, such as op amp saturation, will limit $T$ to -1 exactly and thus sustain steady oscillation. Though this mechanism can be exploited on purpose to design oscillators, when it comes to amplifiers, buffers, V-I and I-V converters, voltage and current sources, and active filters, oscillations must be avoided by all means. As we shall see, unwanted oscillations are tamed via suitable techniques generally referred to as frequency compensation.

Suppose the circuit of Fig. 7.71 is unstable and such that its own internal noise
EXAMPLE 7.32 has initiated a growing oscillation at 1 MHz . If amplitude increases by $10 \%$ from one oscillation cycle to the next, find the number of cycles as well as the amount of time it takes for the oscillation to grow from 1 nV to 1 V .

### Solution

After going around the loop once, the amplitude will be $(1 \mathrm{nV}) \times 1.1$; after going around twice, it will be $(1 \mathrm{nV}) \times 1.1^{2}$, and so forth. Imposing $(1 \mathrm{nV}) \times 1.1^{n}=1 \mathrm{~V}$ and solving, we get $n \cong 217$. Since one period of oscillation is $1 / 10^{6}=1 \mu \mathrm{~s}$, the signal takes about $217 \times(1 \mu \mathrm{~s})=217 \mu \mathrm{~s}$ to grow from 1 nV to 1 V .

### Graphical Visualization of the Loop Gain $\boldsymbol{T}$

Given the impact of the loop gain $T$ upon the stability of a circuit, we seek a quick way to visualize the frequency plots of the magnitude $|T(j f)|$ and the phase angle ph $T(j f)$. By definition,

$$
|T|_{\mathrm{dB}}=20 \log |T|=20 \log |a \beta|=20 \log \left|\frac{a}{1 / \beta}\right|=20 \log |a|-20 \log \left|\frac{1}{\beta}\right|
$$

that is,

$$
\begin{equation*}
|T(j f)|_{\mathrm{dB}}=|a(j f)|_{\mathrm{dB}}-\left|\frac{1}{\beta}\right|_{\mathrm{dB}} \tag{7.85a}
\end{equation*}
$$

Similarly, $\operatorname{ph} T(j f)=\operatorname{ph} a(j f)-\operatorname{ph} \beta$. So long as $\beta$ is frequency independent we have $\operatorname{ph} \beta=0$, so

$$
\begin{equation*}
\operatorname{ph} T(j f)=\operatorname{ph} a(j f) \tag{7.85b}
\end{equation*}
$$

Based on these relationships, we proceed as follows:

- On the decibel plot of $|a(j f)|$, draw the decibel plot of the noise gain $1 / \beta$ as depicted in Fig. 7.72a, top. Since $\beta$ is assumed to be frequency independent and
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-064.jpg?height=717&width=1330&top_left_y=1360&top_left_x=295)

FIGURE 7.72 Visualizing the loop gain $|T(j f)|$, the crossover frequency $f_{x}$, and the phase margin $\phi_{m}$.
$0<\beta \leq 1$, the $1 / \beta$ curve will be a horizontal line positioned somewhere above the $0-\mathrm{dB}$ axis (or right on the $0-\mathrm{dB}$ axis if $\beta=1$ ).

- Visualize the plot of $|T(j f)|$ as the difference between the plot of $|a(j f)|$ and the $1 / \beta$ curve. Equivalently, visualize the plot of $|T(j f)|$ as the plot of $|a(j f)|$, but with the $1 / \beta$ curve as its new $0-\mathrm{dB}$ axis, as depicted in Fig. $7.72 b$, top.
- The plot of $|T(j f)|$ starts out at the typically high dc value $T_{0}=\beta a_{0}$, and then it rolls off with frequency with the same profile as $|a(j f)|$.
- The frequency at which the $1 / \beta$ curve intersects the $|a(j f)|$ curve is aptly called the crossover frequency $f_{x}$. At this frequency we have $\left|T\left(j f_{x}\right)\right|=0 \mathrm{~dB}$, or $\left|T\left(j f_{x}\right)\right|=1 \mathrm{~V} / \mathrm{V}$, so we can write $T\left(j f_{x}\right)=1 \exp \left(j \phi_{x}\right)$, where $\phi_{x}=\operatorname{ph} a\left(j f_{x}\right)$, as depicted in Fig. 7.72a (bottom).
- For $f>f_{x}$ the decibel value of $|T(j f)|$ becomes negative, indicating loop signal attenuation. For $|T(j f)| \ll 1$ we can approximate Eq. (7.84) as $|D(j f)| \cong$ $|1 /(1 / T)|=|T(j f)|$.

### The Phase Margin $\boldsymbol{\phi}_{\boldsymbol{m}}$

In light of the discussion at the beginning of this section, we want the crossover to occur well before the dreaded condition $T=1 e^{j\left(-180^{\circ}\right)}=-1$ occurs, which is the recipe for oscillation. The degree of stability of a circuit is quantified via the phase margin, defined as $\phi_{m}=\phi_{x}-\left(-180^{\circ}\right)$, that is,

$$
\begin{equation*}
\phi_{m}=180+\phi_{x} \tag{7.86}
\end{equation*}
$$

This margin is depicted in Fig. $7.72 b$ (bottom). As we move along, we shall be interested in the value of the discrepancy function at $f_{x}$. Letting $T\left(j f_{x}\right)=1 \exp \left(j \phi_{x}\right)=$ $1 \exp \left[j\left(\phi_{m}-180^{\circ}\right)\right]=-1 \exp \left(j \phi_{m}\right)$ in Eq. (7.84), we get

$$
\begin{aligned}
\left|D\left(j f_{x}\right)\right| & =\left|\frac{1}{1+1 /\left(-1 e^{j \phi_{m}}\right)}\right|=\left|\frac{1}{1-e^{-j \phi_{m}}}\right|=\left|\frac{1}{1-\left(\cos \phi_{m}-j \sin \phi_{m}\right)}\right| \\
& =\frac{1}{\sqrt{\left(1-\cos \phi_{m}\right)^{2}+\left(\sin \phi_{m}\right)^{2}}}
\end{aligned}
$$

where Euler's formula has been used. Expanding and using the identity $\cos ^{2} \phi_{m}+$ $\sin ^{2} \phi_{m}=1$ gives

$$
\begin{equation*}
\left|D\left(j f_{x}\right)\right|=\frac{1}{\sqrt{2\left(1-\cos \phi_{m}\right)}} \tag{7.87}
\end{equation*}
$$

### An Illustrative Example

Let us illustrate the above concepts using the feedback circuit of Fig. 7.73 as a vehicle. The circuit utilizes a three-stage amplifier consisting of a pair of transconductance stages with dc gains $a_{10}=G_{m 1} R_{1}=10^{3} \mathrm{~V} / \mathrm{V}$ and $a_{20}=G_{m 2} R_{2}=10^{3} \mathrm{~V} / \mathrm{V}$, followed by a unity-gain buffer, so $a_{0}=a_{10} a_{20}=10^{6} \mathrm{~V} / \mathrm{V}$. The pole frequencies of
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-066.jpg?height=508&width=1523&top_left_y=216&top_left_x=112)

FIGURE 7.73 PSpice circuit to investigate a three-pole op amp under different amounts of feedback.
the three stages are $f_{1}=1 /\left(2 \pi R_{1} C_{1}\right)=1 \mathrm{kHz}, f_{2}=1 /\left(2 \pi R_{2} C_{2}\right)=100 \mathrm{kHz}$, and $f_{3}=1 /\left(2 \pi R_{3} C_{3}\right)=10 \mathrm{MHz}$, so the open-loop gain is

$$
\begin{equation*}
a(j f)=\frac{10^{6}}{\left(1+j f / 10^{3}\right)\left(1+j f / 10^{5}\right)\left(1+j f / 10^{7}\right)} \tag{7.88}
\end{equation*}
$$

Magnitude and phase are calculated as

$$
\begin{gather*}
|a(j f)|=\frac{10^{6}}{\sqrt{\left[1+\left(f / 10^{3}\right)^{2}\right] \times\left[1+\left(f / 10^{5}\right)^{2}\right] \times\left[1+\left(f / 10^{7}\right)^{2}\right]}}  \tag{7.89a}\\
\text { ph } a(j f)=-\left[\tan ^{-1}\left(f / 10^{3}\right)+\tan ^{-1}\left(f / 10^{5}\right)+\tan ^{-1}\left(f / 10^{7}\right)\right] \tag{7.89b}
\end{gather*}
$$

and are plotted via PSpice, as depicted in Fig. 7.74a (magnitude is in dB , as marked at the left, and phase in degrees, as marked at the right).
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-066.jpg?height=567&width=1530&top_left_y=1473&top_left_x=106)

FIGURE $\mathbf{7 . 7 4}$ (a) Frequency plots of magnitude $|a|$ and phase $\Varangle a$ for the error amplifier of Fig. 7.73.
(b) Linearized magnitude plot associating phase with slope.

If the roots are widely spaced apart as in the present example, we can combine magnitude and phase in the more concise and visually intuitive form of Fig. 7.74b. Specifically, we draw a linearized magnitude plot using segments with progressively steeper slopes, and we mark significant phase values using the correspondence

$$
\begin{equation*}
\text { Phase }\left(\text { in }^{\circ}\right) \leftrightarrow 4.5 \times \text { Slope }(\text { in } \mathrm{dB} / \mathrm{dec}) \tag{7.90}
\end{equation*}
$$

Thus, from dc to $f_{1}$ we draw a segment with a slope of $0 \mathrm{~dB} / \mathrm{dec}$, for which Eq. (7.90) implies a phase of $0^{\circ}$. From $f_{1}$ to $f_{2}$ we draw a segment with a slope of $-20 \mathrm{~dB} / \mathrm{dec}$, implying a phase of $4.5 \times(-20)$, or $-90^{\circ}$. Right at $f_{1}$ the slope is $-10 \mathrm{~dB} / \mathrm{dec}$, so the corresponding phase is $4.5 \times(-10)$, or $-45^{\circ}$. Likewise, the segment from $f_{2}$ to $f_{3}$ has a slope of $-40 \mathrm{~dB} / \mathrm{dec}$, which implies a phase of $-180^{\circ}$. The phase at $f_{2}$ is $-135^{\circ}$. Past $f_{3}$ slope approaches $-60 \mathrm{~dB} / \mathrm{dec}$ and phase approaches $-270^{\circ}$.

We now wish to investigate the closed-loop response under increasing amounts of feedback, which we implement by varying the feedback factor $\beta$. We have the following significant cases:

- Starting out with $\beta=10^{-5}$, we observe that if we draw the $1 / \beta$ line $\left(1 / \beta=10^{5}=\right.$ 100 dB ) in Fig. $7.74 b$, it will intersect the gain curve at $f_{x} \cong 10 \mathrm{kHz}$, where $\phi_{x} \cong$ $-90^{\circ}$. Consequently, $\phi_{m} \cong 180^{\circ}-90^{\circ}=90^{\circ}$. Figure 7.75 shows that the closedloop gain starts out as $A_{0}=(1 / \beta) /\left(1+1 / T_{0}\right)=10^{5} /(1+1 / 10)=90,909 \mathrm{~V} / \mathrm{V}$ (about $10 \%$ lower than $A_{\text {ideal }}=100,000 \mathrm{~V} / \mathrm{V}$ because of low $T_{0}$ ), and it exhibits a dominant pole frequency of $f_{x}$. Shown in Fig. 7.76a is the response to an input step of $\beta \mathrm{V}(=10 \mu \mathrm{~V})$. This is an approximately exponential transient, so once the input is stepped back to zero, $v_{o}(t)$ will decay in approximately exponential fashion, indicating a stable circuit.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-067.jpg?height=609&width=952&top_left_y=1346&top_left_x=205)

FIGURE 7.75 Closed-loop responses of the circuit of Fig. 7.73 for different amounts of feedback. Raising $\beta$ lowers the $1 / \beta$ curve, shifting the crossover frequency towards regions of greater phase shift and thus lower phase margin. This, in turn, increases the amount of peaking as well as ringing (see Fig. 7.76).
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-068.jpg?height=1609&width=1194&top_left_y=201&top_left_x=441)

FIGURE 7.76 Step responses and pole locations of the circuit of Fig. 7.73 for increasing values of $\beta$.

- Raising $\beta$ to $10^{-4}$ lowers the $1 / \beta$ line to 80 dB in Fig. $7.74 b$, giving $f_{x} \cong 100 \mathrm{kHz}$ and $\phi_{x} \cong-135^{\circ}$, so $\phi_{m} \cong 180^{\circ}-135^{\circ}=45^{\circ}$. The closed-loop gain now exhibits a bit of peaking just before $f_{x}$, after which it rolls off with frequency as $|a(j f)|$. By Eq. (7.87) we have $\left|D\left(j f_{x}\right)\right|=1 / \sqrt{2\left(1-\cos 45^{\circ}\right)}=1.307$, so

Eq. (7.83) predicts $\left|A\left(j f_{x}\right)\right|=10^{4} \times 1.307=13,070 \mathrm{~V} / \mathrm{V}$, which is $30.7 \%$ higher than $A_{\text {ideal }}$. Recall from systems theory that peaking in the frequency domain is accompanied by ringing in the time domain. This is confirmed by Fig. 7.76b, showing the transient response to an input step of $\beta \mathrm{V}(=0.1 \mathrm{mV})$. Once we step the input back to zero, $v_{o}(t)$ will decay to zero, albeit with a bit of ringing. We conclude that a circuit with $\phi_{m}=45^{\circ}$ is still a stable circuit, though its (moderate) amount of peaking and ringing may be undesirable in certain applications.

- For $\beta=10^{-3}$ the $1 / \beta$ line is lowered further to 60 dB in Fig. $7.74 b$, so $f_{x}$ is now the geometric mean of 100 kHz and 1 MHz , or $f_{x} \cong \sqrt{10^{5} \times 10^{6}}=$ 316 kHz , and $\phi_{x}$ is the arithmetic mean of $-145^{\circ}$ and $-180^{\circ}$, or $\phi_{x} \cong$ $-162.5^{\circ}$, so $\phi_{m} \cong 180^{\circ}-162.5^{\circ}=17.5^{\circ}$. With a reduced phase margin, both peaking and ringing are more pronounced. In fact we now have $\left|D\left(j f_{x}\right)\right|=$ $1 / \sqrt{2\left(1-\cos 17.5^{\circ}\right)}=3.29$, so Eq. (7.83) predicts $\left|A\left(j f_{x}\right)\right| \cong 1,000 \times 3.29=$ $3,290 \mathrm{~V} / \mathrm{V}$, or almost $3.3 \times A_{\text {ideal }}!$ Figure $7.76 c$ shows the response to an input step of $\beta \mathrm{V}(=1 \mathrm{mV})$. Once we step the input back to zero, $v_{o}(t)$ will decay with quite a bit of ringing. We conclude that a circuit with $\phi_{m}=17.5^{\circ}$, though still stable, is likely to be unacceptable in most applications because of excessive peaking and/or ringing.
- Cursor measurements on the PSpice plots of Fig. 7.74a give $f_{-180^{\circ}}=1.006 \mathrm{MHz}$, where $\left|a\left(j f_{-180^{\circ}}\right)\right|=98.02 \mathrm{~V} / \mathrm{V}$, so if we let $\beta=1 / 98.02=1.02 \times 10^{-2}$, we get $f_{x}=1.006 \mathrm{MHz}$ and $\phi_{x}=-180^{\circ}$, or $\phi_{m}=0^{\circ}$. Consequently, $\left|D\left(j f_{x}\right)\right| \rightarrow \infty$, indicating oscillatory bevavior. This is confirmed by the response to a $10-\mathrm{mV}$ input step of Fig. 7.76d.
- Raising $\beta$ to $2 \times 10^{-2}$ lowers the $1 / \beta$ curve further, pushing $f_{x}$ into a region of additional phase shift and thus $\phi_{m}<0^{\circ}$. All it takes now is internal noise to trigger a growing oscillation. Using an input step of just 1 nV to simulate noise, we obtain the response of Fig. 7.76e.

It is instructive to visualize circuit behavior also in terms of its poles in the complex plane. Letting $j f \rightarrow s /(2 \pi)$ in Eq. (7.88), substituting into Eq. (7.84) and then into Eq. (7.83), gives

$$
A(s)=\frac{10^{6}}{\beta 10^{6}+\left(1+\frac{S}{2 \pi 10^{3}}\right)\left(1+\frac{S}{2 \pi 10^{5}}\right)\left(1+\frac{S}{2 \pi 10^{7}}\right)}
$$

The roots of the denominator are the poles of $A(s)$. Using a scientific calculator or similar, we find the poles tabulated in Table 7.2. These data are best visualized in the $s$-plane as shown (not to scale) on the right side of Fig. 7.76. Starting out with no feedback $(\beta=0)$ and gradually increasing $\beta$ brings the two lowest poles closer together, until they become coincident and then split apart to become complex conjugate and move toward the imaginary axis (see the shaded root locus). Once on the imaginary axis, they result in sustained oscillation, and once they spill into the right half of the complex plane, they result in a growing oscillation.

Looking at Fig. 7.75, we observe that if we can tolerate the amounts of peaking and ringing that come with, say, $\phi_{m}=45^{\circ}$, then we must restrict operation to

TABLE 7.2 Poles of the closed-loop gain of the circuit of Fig. 7.73.

| $\boldsymbol{\beta}$ | $\boldsymbol{p}_{\mathbf{1}}\left(\mathbf{s}^{-1}\right)$ | $\boldsymbol{p}_{\mathbf{2}}\left(\mathbf{s}^{-1}\right)$ | $\boldsymbol{p}_{\mathbf{3}}\left(\mathbf{s}^{-1}\right)$ |
| :---: | :---: | :---: | :---: |
| 0 | $2 \pi(-1.0 \mathrm{k})$ | $2 \pi(-100 \mathrm{k})$ | $2 \pi(-10 \mathrm{M})$ |
| $10^{-5}$ | $2 \pi(-12.4 \mathrm{k})$ | $2 \pi(-88.5 \mathrm{k})$ | $2 \pi(-10 \mathrm{M})$ |
| $10^{-4}$ | $2 \pi(-50 \mathrm{k}+j 87.2 \mathrm{k})$ | $2 \pi(-50 \mathrm{k}-j 87.2 \mathrm{k})$ | $2 \pi(-10 \mathrm{M})$ |
| $10^{-3}$ | $2 \pi(-45.4 \mathrm{k}+j 313 \mathrm{k})$ | $2 \pi(-45.4 \mathrm{k}-j 313 \mathrm{k})$ | $2 \pi(-10.01 \mathrm{M})$ |
| $1.02 \times 10^{-2}$ | $2 \pi(0+1.0 \mathrm{M})$ | $2 \pi(0-1.0 \mathrm{M})$ | $2 \pi(-10.1 \mathrm{M})$ |
| $2 \times 10^{-2}$ | $2 \pi(46.7 \mathrm{k}+1.34 \mathrm{M})$ | $2 \pi(46.7 \mathrm{k}-1.34 \mathrm{M})$ | $2 \pi(-10.19 \mathrm{M})$ |

$1 / \beta \geq 10^{4} \mathrm{~V} / \mathrm{V}$. What if we want to operate the amplifier with lower closed-loop gains, such as $1 / \beta=50 \mathrm{~V} / \mathrm{V}$, or $1 / \beta=2 \mathrm{~V} / \mathrm{V}$ ? As is, the circuit will simply oscillate for these values of $\beta$ ! Mercifully, some clever frequency-compensation techniques have been developed that allow us to stabilize an amplifier for virtually any closedloop gain we wish, including what by now we recognize as the most difficult configuration to stabilize, namely, the voltage follower, for which $\beta=1$.

EXAMPLE 7.33 (a) What is the minimum allowable noise gain $1 / \beta$ if we want to operate the amplifier of Fig. 7.73 with a phase margin of $60^{\circ}$ ?
(b) Find $\left|D\left(f f_{x}\right)\right|$ and comment.
(c) Verify with PSpice.

### Solution

(a) By Eq. (7.86) we have $\phi_{x}=\phi_{m}-180^{\circ}=60^{\circ}-180^{\circ}=-120^{\circ}$. Figure $7.74 a$ indicates that $f_{-120^{\circ}}$ occurs a bit below 100 kHz . Start out with the initial estimate $f_{-120^{\circ}}=50 \mathrm{kHz}$ and iterate using Eq. (7.89b) until you settle at $f_{-120^{\circ}}=$ 59.2 kHz . Next, use Eq. $(7.89 a)$ to find $\mid a\left(j f_{-120^{\circ}} \mid \cong 14,534 \mathrm{~V} / \mathrm{V}\right.$. This is the minimum value of $1 / \beta$ for $\phi_{m} \geq 60^{\circ}$ with this particular amplifier.
(b) Proceeding in the usual manner we get

$$
\left|D\left(j f_{x}\right)\right| \cong \frac{1}{\sqrt{2\left(1-\cos 60^{\circ}\right)}}=1
$$

Since $T_{0}=10^{6} / 14,534=68.8$, we also have $D_{0}=1 /(1+1 / 68.8)=0.986$, indicating a very small amount of peaking.
(c) Using the circuit of Fig. 7.73 with $\beta=1 / 14,534=68.8 \times 10^{-6} \mathrm{~V} / \mathrm{V}$ we get the plots of Fig. 7.77. It is fair to say that, aside for a slight amount of peaking and ringing, which is acceptable in many applications, the condition $\phi_{m}=60^{\circ}$ is almost as good as $\phi_{m}=90^{\circ}$ in terms of stability, yet it expands the range of possible closed-loop gains by decreasing the lower limit of acceptable values for $1 / \beta$ from $100,000 \mathrm{~V} / \mathrm{V}$ to $14,534 \mathrm{~V} / \mathrm{V}$, or by almost 17 dB .
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-071.jpg?height=490&width=1325&top_left_y=206&top_left_x=190)

FIGURE 7.77 (a) Frequency and (b) step responses for the special case $\phi_{m}=60^{\circ}$.

### Peaking and Ringing as Functions of the Phase Margin $\boldsymbol{\phi}_{\boldsymbol{m}}$

Figure 7.78 depicts peaking and ringing by the circuit of Fig. 7.73 as functions of the phase margin $\phi_{m}$. These characteristics are quantified in terms of the gain peaking $G P$ and the overshoot $O S$, defined as

$$
\begin{equation*}
G P=20 \log _{10}\left|A_{p}-A_{0}\right| \quad O S(\%)=100 \frac{V_{p}-V_{\infty}}{V_{\infty}} \tag{7.91}
\end{equation*}
$$

Peaking occurs for $\phi_{m}$ less than about $65^{\circ}$, and ringing for $\phi_{m}$ less than about $75^{\circ}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-071.jpg?height=825&width=1521&top_left_y=1255&top_left_x=193)

FIGURE 7.78 (a) Peaking and (b) ringing as functions of the phase margin $\phi_{m}$.

### Using PSpice to Plot $\boldsymbol{T}$ and to Measure $\boldsymbol{\phi}_{\boldsymbol{m}}$

The signal injection technique of Section 7.6 constitutes a powerful tool for the investigation of stability, especially when complex frequency responses need to be plotted and examined. The PSpice circuit of Fig. 7.79a uses the 741 macro-model, along with the voltage injection technique discussed in connection with Fig. 7.70, to generate the plots of $|T(j f)|$ and $\mathrm{ph} T(j f)$ for the case of a capacitively loaded 741 voltage buffer. The plots, shown in Fig. 7.79b, are obtained, respectively, as

$$
\begin{equation*}
|T(j f)|=\left|-\frac{V_{r}}{V_{f}}\right| \quad \text { ph } T(j f)=\operatorname{ph}\left(-\frac{V_{r}}{V_{f}}\right) \tag{7.92}
\end{equation*}
$$

Using the cursor facility of PSpice we find $f_{x}=864 \mathrm{kHz}$ and $\mathrm{ph} T\left(j f_{x}\right)=-124^{\circ}$, so $\phi_{m}=180-124=56^{\circ}$. Rerunning the simulation for the unloaded case ( $C_{L}=0$ and $\left.R_{L}=\infty\right)$ gives $f_{x}=888 \mathrm{kHz}$ and $\phi_{m}=62.8^{\circ}$, indicating that the present load erodes $\phi_{m}$ by $6.8^{\circ}$ (this is due to the high-frequency pole formed by $C_{L}$ with the output resistance $r_{o}$ of the op $\mathrm{amp}^{7}$ ).
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-072.jpg?height=414&width=598&top_left_y=993&top_left_x=133)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-072.jpg?height=489&width=806&top_left_y=918&top_left_x=823)
(b)

FIGURE 7.79 Using the voltage injection technique to find the phase margin of a capacitively loaded 741 voltage buffer.

## 7.8 DOMINANT-POLE COMPENSATION

If a negative-feedback system fails to meet the desired degree of stability, its loop gain $T(j f)$ must be altered in such a way as to raise the phase margin $\phi_{m}$ to an acceptable value. Altering $T(j f)$ to stabilize a circuit is referred to as frequency compensation. Since $T(j f)=a(j f) \beta(j f)$, we can alter $T(j f)$ by altering $a(j f)$, or $\beta(j f)$, or both. Here we take the viewpoint of the IC designer, who strives to ensure a given $\phi_{m}$ for the hardest-to-compensate configuration with frequency-independent feedback, namely, the voltage-follower, for which $\beta=1 \mathrm{~V} / \mathrm{V}$. In this particular case we have

$$
\begin{equation*}
T(j f)=a(j f) \beta=a(j f) \times 1=a(j f) \tag{7.93}
\end{equation*}
$$

that is, $T(j f)$ coincides with $a(j f)$. If the op amp utilizes frequency-dependent feedback, then it may be necessary for the user to take additional measures ${ }^{7}$ to stabilize it (see also the end-of-chapter problems).

A popular compensation technique involves lowering the first pole frequency $f_{1}$ to a new value $f_{D}$ such that the compensated response is dominated by this lone pole all the way up to the crossover frequency $f_{x}$, which, for $\beta=1 \mathrm{~V} / \mathrm{V}$, coincides with the already-familiar transition frequency $f_{t}$. The phase shift at $f_{x}$ is then $\phi_{x}=-90^{\circ}+$ $\phi_{x(\mathrm{HOR})}$, where $-90^{\circ}$ is the phase shift due to $f_{D}$, and $\phi_{x(\mathrm{HOR})}$ is the combined phase shift due to the higher-order roots (poles and possibly zeros) at $f_{x}$. (For instance, the loaded 741 op amp of Fig. 7.79 has $\phi_{x(\mathrm{HOR})}=90^{\circ}+\phi_{x}=90^{\circ}-124^{\circ}=-34^{\circ}$.) The phase margin after compensation is $\phi_{m}=180^{\circ}+\phi_{x}=180^{\circ}-90^{\circ}+\phi_{x(\mathrm{HOR})}$, that is,

$$
\begin{equation*}
\phi_{m}=90^{\circ}+\phi_{x(\mathrm{HOR})} \tag{7.94}
\end{equation*}
$$

By making $f_{D}$ sufficiently low, we can keep $\phi_{x(\mathrm{HOR})}$ as small as needed. For instance, for $\phi_{m} \geq 60^{\circ}$ we need to ensure $\phi_{x(\text { HOR })} \geq-30^{\circ}$. An obvious drawback of dominantpole compensation is a drastic gain reduction above $f_{D}$, but this is the price we must pay for the sake of stability. Though there are other, more sophisticated techniques ${ }^{7}$ that preserve gain over a wider portion of the frequency spectrum, here we limit ourselves to the dominant-pole types. Two popular techniques for shifting $f_{1}$ to $f_{D}\left(\ll f_{1}\right)$ are the shunt-capacitance technique and the Miller-compensation technique.

### Shunt-Capacitance Compensation

A simple technique for lowering a pole frequency $f_{1}$ is to deliberately increase the capacitance of the node responsible for $f_{1}$ itself. In the case of the 3-pole amplifier example of the previous section we simply add a shunt capacitance $C_{\text {shunt }}$ in parallel with $C_{1}$ to lower its pole frequency from $f_{1}=1 /\left(2 \pi R_{1} C_{1}\right)$ to

$$
\begin{equation*}
f_{D}=\frac{1}{2 \pi R_{1}\left(C_{1}+C_{\text {shunt }}\right)} \tag{7.95}
\end{equation*}
$$

To visualize the required location of $f_{D}$, refer to the linearized plot of Fig. 7.80 and proceed as follows:

- Identify the frequency $f_{x}$ at which the phase of $a(j f)$ is $\phi_{x}=\phi_{m}-180^{\circ}$, where $\phi_{m}$ is the desired phase margin (e.g. $45^{\circ}, 60^{\circ}$, etc.) This is going to be the transition frequency $f_{t}$ after compensation. (We can read out $\phi_{x}$ from the phase plot of $a(j f)$, if available, or from slope readings on the magnitude plot of $a(\mathrm{ff})$, in the manner illustrated in Fig. 7.74b.)
- Starting at $f_{x}$ on the $0-\mathrm{dB}$ axis of the decibel plot of $|a(j f)|$, draw a line with a slope of $-20 \mathrm{~dB} / \mathrm{dec}$ till it intersects the $a_{0}$ curve. The corresponding frequency is going to be $f_{D}$. Exploiting the constancy of the gain-bandwidth product, we write $a_{0} \times f_{D}=1 \times f_{x}$, which allows us to calculate the new pole location as

$$
\begin{equation*}
f_{D}=\frac{f_{x}}{a_{0}} \tag{7.96}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-074.jpg?height=444&width=607&top_left_y=210&top_left_x=450)

FIGURE 7.80 Graphical method for locating the dominant pole $f_{D}$ for the case of shuntcapacitance compensation (the shaded curve shows gain before compensation).

If the first two poles are widely spaced, and any higher-order root frequencies (such as $f_{3}$ in our example) are sufficiently high, a graphically and computationally convenient starting point is $\phi_{x}=-135^{\circ}$, for then $f_{x}=f_{2}$, giving $f_{D}=f_{2} / a_{0}$. The corresponding phase margin is only $45^{\circ}$, but we can always lower $f_{D}$ further to increase $\phi_{m}$, for instance to $60^{\circ}$, which Example 7.33 has demonstrated to be often adequate.

EXAMPLE 7.34 (a) Find the capacitance $C_{\text {shunt }}$ that will stabilize the amplifier of Fig. 7.72 for $\phi_{m}=45^{\circ}$ when used with $\beta=1$. Verify with PSpice.
(b) To what value must we increase $C_{\text {shunt }}$ if we want to achieve $\phi_{m}=60^{\circ}$ ?

### Solution

(a) Letting $f_{x}=f_{2}=100 \mathrm{kHz}$ and $a_{0}=10^{6} \mathrm{~V} / \mathrm{V}$ in Eq. (7.96) gives $f_{D}=10^{5} / 10^{6}=$ 0.1 Hz. By Eq. (7.95),

$$
C_{\text {shunt }}=\frac{1}{2 \pi R_{1} f_{D}}-C_{1}=\frac{1}{2 \pi 10^{7} \times 0.1}-15.9 \times 10^{-12}=159.1 \mathrm{nF}
$$

Using the PSpice circuit of Fig. 7.81 we get the curves of Fig. 7.82, which show unequivocally the large amount of gain that needs to be sacrificed for the sake of shunt-capacitance stabilization. But it is better to have a stable circuit with sacrificed gain than an unstable one!
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-074.jpg?height=302&width=1474&top_left_y=1763&top_left_x=127)

FIGURE 7.81 Three-pole amplifier with shunt-capacitance compensation.
(b) For $\phi_{m}=60^{\circ}$ the crossover must be placed at the frequency $f_{x}$ where $\phi_{x}=$ $\phi_{m}-180^{\circ}=60^{\circ}-180^{\circ}=-120^{\circ}$. Example 7.33 indicated that $f_{x}=$ 59.2 kHz , so Eq. (7.96) gives $f_{D}=0.0592 \mathrm{~Hz}$, and Eq. (7.95) gives $C_{\text {shunt }} \cong$ 269 nF . Re-running PSpice with $C_{\text {shunt }}=269 \mathrm{nF}$ and using the cursor facility, we measure $f_{x}=59.4 \mathrm{kHz}$ and $\phi_{x}=-118^{\circ}$, in fairly good agreement with the predicted values.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-075.jpg?height=839&width=764&top_left_y=487&top_left_x=308)

FIGURE 7.82 Magnitude and phase plots with shuntcapacitance compensation for $\phi_{m}=45^{\circ}$. The shaded curves show the response before compensation ( $C_{\text {shunt }}=0$ ).

### Miller Compensation

The low value required of $f_{D}$ for dominant-pole compensation results in a relatively large $C_{\text {shunt }}$. This may not necessarily be a problem if $C_{\text {shunt }}$ is a discrete capacitor external to the op amp. However, in integrated circuits it is desirable to fabricate the compensation circuitry directly on chip, and capacitors higher than a few tens of picofarads would take up too much chip area. A clever way around this limitation is to start out with a small enough capacitance $C_{f}$ that can be fabricated on chip, and then use the Miller effect to make it appear as large as needed for frequency compensation. We shall see that two additional benefits accrue from this scheme, namely, pole splitting as well as higher slew rates.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-076.jpg?height=255&width=1105&top_left_y=213&top_left_x=450)

FIGURE 7.83 Two-pole amplifier with Miller compensation.

In order to focus on the essentials of Miller compensation, let us first investigate the two-pole amplifier of Fig. 7.83, which, in the absence of $C_{f}$, exhibits the pole frequencies

$$
\begin{equation*}
f_{1}=\frac{1}{2 \pi R_{1} C_{1}} \quad f_{2}=\frac{1}{2 \pi R_{2} C_{2}} \tag{7.97}
\end{equation*}
$$

With $C_{f}$ present, the circuit resembles that of Fig. 6.21 (one is readily obtained from the other via a mere source transformation at the input). Adapting Eqs. (6.45) and (6.46) to the present circuit, we find that the presence of $C_{f}$ results in a new polefrequency pair

$$
\begin{gathered}
f_{1(\mathrm{new})}=\frac{1 / 2 \pi}{R_{1}\left[C_{1}+C_{f}\left(1+G_{m 2} R_{2}+R_{2} / R_{1}\right)\right]+R_{2} C_{2}} \\
f_{2(\mathrm{new})}=\frac{1 / 2 \pi}{R_{1} R_{2}\left(C_{1} C_{f}+C_{1} C_{2}+C_{f} C_{2}\right) 2 \pi f_{1(\mathrm{new})}}
\end{gathered}
$$

Anticipating $f_{1 \text { (new) }} \ll f_{1}$, we recognize that the denominator of $f_{1 \text { (new) }}$ must be dominated by the term $R_{1} C_{f} G_{m 2} R_{2}$, so we simplify as $f_{1 \text { (new) }} \cong 1 /\left(2 \pi R_{1} C_{f} G_{m 2} R_{2}\right)=$ $1 /\left(2 \pi R_{1} C_{1} G_{m 2} R_{2} C_{f} / C_{1}\right)$. Using Eq. (7.97), along with straightforward algebra, we express the new pole pair in the more insightful form

$$
\begin{equation*}
f_{1(\mathrm{new})} \cong \frac{f_{1}}{\left(G_{m 2} R_{2} C_{f}\right) / C_{1}} \quad f_{2(\text { (new })} \cong \frac{\left(G_{m 2} R_{2} C_{f}\right) f_{2}}{C_{1}+C_{f}\left(1+C_{1} / C_{2}\right)} \tag{7.98}
\end{equation*}
$$

Since $f_{1}$ is divided by $G_{m 2} R_{2} C_{f}$ whereas $f_{2}$ is multiplied by the same term, we conclude that increasing $C_{f}$ moves the first pole down in frequency and the second pole up in frequency, a phenomenon aptly called pole splitting. Depicted in Fig. 7.84, pole splitting is highly beneficial because it pushes the second pole and its phase lag up in frequency, making the placement of the dominant pole less stringent compared to shunt-capacitance compensation.

Recall from Eq. (6.43) that the presence of $C_{f}$ results also in the creation of a right-half-plane (RHP) zero at $s=G_{m 2} / C_{f}$. Noting that the dc gain in Fig. 7.83 is $a_{0}=\left(-G_{m 1} R_{1}\right) \times\left(-G_{m 2} R_{2}\right)$, we summarize by stating that with Miller compensation gain takes on the form

$$
\begin{equation*}
a(j f)=a_{0} \frac{1-j f / f_{0}}{\left(1+j f / f_{1 \text { (new) })}\right)\left(1+j f / f_{2(\text { new })}\right)} \tag{7.99}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-077.jpg?height=405&width=677&top_left_y=211&top_left_x=204)

FIGURE $\mathbf{7 . 8 4}$ Miller compensation and pole splitting for the two-pole amplifier of Fig. 7.83 (the shaded curve shows the gain before compensation).
where

$$
\begin{gather*}
a_{0}=G_{m 1} R_{1} G_{m 2} R_{2} \quad f_{0}=\frac{G_{m 2}}{2 \pi C_{f}}  \tag{7.100}\\
f_{1 \text { (new) }} \cong \frac{1 / 2 \pi}{R_{1}\left[C_{1}+C_{f}\left(1+G_{m 2} R_{2}+R_{2} / R_{1}\right)\right]+R_{2} C_{2}} \cong \frac{1}{2 \pi R_{1} G_{m 2} R_{2} C_{f}}  \tag{7.101}\\
f_{2(\text { new })} \cong \frac{G_{m 2} / 2 \pi}{C_{1}+C_{2}\left(1+C_{1} / C_{f}\right)}
\end{gather*}
$$

Also, the gain-bandwidth product after compensation is GBP $=a_{0} \times f_{1 \text { (new) }}$. Combining Eqs. (7.100) and (7.101), we readily find

$$
\begin{equation*}
\mathrm{GBP} \cong \frac{G_{m 1}}{2 \pi C_{f}} \tag{7.103}
\end{equation*}
$$

Magnitude and phase are readily found as

$$
\begin{gather*}
|a(j f)|=a_{0} \sqrt{\frac{1+\left(f / f_{0}\right)^{2}}{\left[1+\left(f / f_{1 \text { (new })}\right)^{2}\right]\left[1+\left(f / f_{2 \text { (new) }}\right)^{2}\right]}}  \tag{7.104a}\\
\operatorname{ph} a(j f)=-\tan ^{-1}\left(f / f_{0}\right)-\tan ^{-1}\left(f / f_{1 \text { (new })}\right)-\tan ^{-1}\left(f / f_{2 \text { (new) }}\right) \tag{7.104b}
\end{gather*}
$$

Remark: Note that a RHP zero contributes phase lag, just like a pole in the left half plane! (As we shall see, this can be an issue in two-stage CMOS op amps.)

Pole splitting is readily visualized via PSpice. The circuit of Fig 7.85 utilizes only the first two stages of our three-pole working example to show how
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-078.jpg?height=365&width=1041&top_left_y=214&top_left_x=447)

FIGURE 7.85 Using the first two stages of the amplifier of Fig. 7.81
to investigate pole splitting.
increasing $C_{f}$ causes the poles to split apart from their initial values $f_{1}=1 \mathrm{kHz}$ and $f_{2}=100 \mathrm{kHz}$ (see Fig. 7.86). The phase plot indicates that the maximum phase shift before compensation is $-180^{\circ}$ (with each pole contributing a maximum of $-90^{\circ}$ ), but after compensation it becomes $-270^{\circ}$ because of the additional $-90^{\circ}$ phase lag due to the RHP zero.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-078.jpg?height=724&width=907&top_left_y=986&top_left_x=446)

FIGURE 7.86 Pole splitting as a function of $C_{f}$ for the two-stage amplifier of Fig. 7.85. The values used are $C_{f}=0.143 \mathrm{pF}, 1.59 \mathrm{pF}$, and 15.9 pF , which lower $f_{1}$ from 1 kHz to $f_{1 \text { (new) }}=100 \mathrm{~Hz}, 10 \mathrm{~Hz}$, and 1 Hz , respectively. The gray curves show the response before compensation ( $C_{f}=0$ ).

EXAMPLE 7.35 (a) Estimate the pole and zero frequencies of the two-stage amplifier of Fig. 7.85 if $C_{f}=5 \mathrm{pF}$.
(b) Estimate $C_{f}$ for a phase margin of $60^{\circ}$.
(c) Verify part (b) with PSpice and comment.

### Solution

(a) By Eq. (7.100) we have $f_{0}=10^{-2} /\left(2 \pi \times 5 \times 10^{-12}\right)=318 \mathrm{MHz}$. Moreover, using $G_{m 2} R_{2}=10^{3}$, we calculate Eq. (7.98) as

$$
\begin{aligned}
f_{1(\text { new })} & \cong \frac{10^{3}}{10^{3} \times 5 / 15.92}=3.18 \mathrm{~Hz} \\
f_{2(\text { new })} & \cong \frac{10^{3} \times 5 \times 10^{5}}{16.92+5(1+15.92 / 15.92)}=18.6 \mathrm{MHz}
\end{aligned}
$$

It is apparent that the first pole has moved down from 1 kHz to 3.18 Hz , whereas the second pole has moved $u p$ from 100 kHz to 18.6 MHz . Moreover, $f_{0} \gg f_{2 \text { (new) }}$.
(b) By Eq. (7.94) the combined phase shift at $f_{x}$ due to $f_{2(\text { new) }}$ and $f_{0}$ must be $\phi_{x(\mathrm{HOR})}=\phi_{m}-90^{\circ}=60^{\circ}-90^{\circ}=-30^{\circ}$. Since in this particular example $f_{0}$ is so high, we can ignore its phase contribution at $f_{x}$ and impose $-30^{\circ}=$ $-\tan ^{-1}\left[f_{x} / f_{2 \text { (new) }}\right]$, which gives $f_{x}=\left(\tan 30^{\circ}\right) \times f_{2 \text { (new) }}=0.577 \times f_{2 \text { (new) }}$. Exploiting the constancy of the gain-bandwidth product we write

$$
a_{0} \times f_{1(\text { new })}=1 \times f_{x}=0.577 \times f_{2 \text { (new) }}
$$

Using Eqs. (7.102) and (7.103) we express this as

$$
\frac{G_{m 1}}{2 \pi C_{f}}=0.577 \times \frac{G_{m 2} / 2 \pi}{C_{1}+C_{2}\left(1+C_{1} / C_{f}\right)}
$$

Substituting the given values of $G_{m 1}, G_{m 2}, C_{1}$, and $C_{2}$, and solving for $C_{f}$ finally gives $C_{f}=2.388$ pF. Plugging into Eqs. (7.101) and (7.102) we get $f_{1 \text { (new) }}=$ 6.66 Hz and $f_{2 \text { (new) }}=11.54 \mathrm{MHz}$, so $f_{x}=0.577 \times 11.54=6.66 \mathrm{MHz}$.
(c) Running the PSpice circuit of Fig. 7.85 with $C_{f}=2.388 \mathrm{pF}$ gives $f_{x} \cong$ 5.9 MHz and $\phi_{m} \cong 62^{\circ}$. Considering all the approximations made, the calculated values are in reasonable agreement with PSpice.

Turning to the full-blown three-pole amplifier of Fig. 7.81 we observe that the phase lag due to $f_{3}$ will erode the phase margin calculated for the two-pole version of Fig. 7.85, so $C_{f}$ will have to be increased slightly if the same phase margin is to be retained. In particular, we use PSpice to find empirically that with $C_{f}=4.7 \mathrm{pF}$ the three-pole amplifier of Fig. 7.81 exhibits $f_{x} \cong 3.2 \mathrm{MHz}$ and $\phi_{m} \cong 62^{\circ}$.

### Shunt-Capacitance and Miller Compensation Comparison

We wish to compare the shunt-capacitance and the Miller compensation schemes for the case of the three-pole amplifier operated with $\beta=1$ and $\phi_{m} \cong 60^{\circ}$. Running the PSpice circuit of Fig. 7.87, first with $C_{\text {shunt }}=269 \mathrm{nF}$ (and $C_{f}=0$ ), and then with $C_{f}=4.7 \mathrm{pF}$ (and $C_{\text {shunt }}=0$ ), we obtain the closed-loop frequency and step responses of Fig. 7.88. It is apparent that the Miller scheme results in much faster dynamics, thanks to the pole splitting effect, which pushes the second pole toward higher frequencies, thus relaxing the constraints on the dominant pole location. Also, the
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-080.jpg?height=372&width=1525&top_left_y=223&top_left_x=111)

FIGURE 7.87 PSpice circuit to compare the shunt-capacitance and the Miller compensation schemes for the case $\beta=1$ and $\phi_{m} \cong 60^{\circ}$.

Miller-multiplication effect allows for $C_{f}$ to be much smaller than $C_{\text {shunt }}$ so it can be fabricated on chip. Finally, not immediately apparent from the amplifier model used above, is the fact that the slew rate SR is likely to be much higher with the Miller compensation scheme as the much smaller $C_{f}$ can get charged/discharged much more rapidly.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-080.jpg?height=490&width=1352&top_left_y=1103&top_left_x=294)

FIGURE 7.88 (a) Frequency and (b) step responses for the unity-gain amplifier of Fig. 7.87.

## 7.9 FREQUENCY COMPENSATION OF MONOLITHIC OP AMPS

We are now ready to apply the techniques of the previous section to the compensation of the monolithic op amp representatives of Chapter 5, namely, the 741 bipolar op amp and the CMOS op amps of the two-stage and the folded-cascode types. Historically, the 741 was the first op amp to incorporate frequency compensation on chip, in the mid 1960s, a feature that contributed to making the 741 one of the most popular ICs ever. MOS analog technology reached commercial maturity later,
and the first significant articles on CMOS op amp frequency compensation started to appear only in the early 1980s.

### Frequency Compensation of the $\mathbf{7 4 1} \mathbf{0 p}$ Amp

With two dozen transistors, an uncompensated 741 op amp exhibits a multitude of pole and zero frequencies, including complex-conjugate pole pairs, ${ }^{1}$ whose cumulative phase lag far exceeds $-180^{\circ}$. As depicted in the 741 schematic of Fig. 5.1, the 741 is Miller compensated via the capacitance $C_{c}=30 \mathrm{pF}$ across the intermediate stage consisting of the CC-CE pair $Q_{16} Q_{17}$. After compensation, the roots undergo a drastic rearrangement in the complex plane, ${ }^{1}$ such that their combined phase lag is pushed sufficiently above the transition frequency $f_{t}(\cong 1 \mathrm{MHz}$ ). To estimate the dominant pole frequency, refer to the ac equivalent of Fig. 5.11, repeated for convenience in Fig. 7.89 along with the Miller capacitance $C_{c}$. (In anticipation of the dominant role played by $C_{c}$, the much smaller stray capacitances of the nodes at either side of $C_{c}$ have been omitted for simplicity.) This circuit is similar to that of Fig. 7.83, provided we let $C_{f}=C_{c}=30 \mathrm{pF}, R_{1}=R_{o 1} / / R_{i 2}=6.12 / / 4.63=2.64 \mathrm{M} \Omega$, and $R_{2}=R_{o 2} / / R_{i 3}=81.3 / / 9330=80.6 \mathrm{k} \Omega$. Adapting Eq. (7.101) and retaining only the dominant denominator term, we estimate the $-3-\mathrm{dB}$ frequency $f_{b}$ as

$$
\begin{equation*}
f_{b} \cong \frac{1 / 2 \pi}{R_{1} C_{c}\left(1+G_{m 2} R_{2}\right)}=\frac{1 / 2 \pi}{2.64 \times 10^{6} \times 30 \times 10^{-12}(1+80.6 / 0.161)}=4 \mathrm{~Hz} \tag{7.105}
\end{equation*}
$$

Considering all the approximations made, this is close enough to data-sheet value of 5 Hz .
A simulation with the 741 macro-model available in PSpice's library gives, for the case of $\pm 10-\mathrm{V}$ power supplies, $a_{0}=199,220 \mathrm{~V} / \mathrm{V}, f_{b}=5.0 \mathrm{~Hz}, f_{t}=888 \mathrm{kHz}$, and $\operatorname{ph} a\left(f_{t}\right)=-117.2^{\circ}$, so $\phi_{m}=62.8^{\circ}$. As we know from Chapter $6, C_{c}$ also sets the slew rate at a nominal value of $0.5 \mathrm{~V} / \mu \mathrm{s}$. The Miller effect boosts the apparent value of $C_{c}$ by $1+80.6 / 0.161=501.6$, making it appear as an equivalent capacitance of $501.6 \times 30 \mathrm{pF}=150 \mathrm{nF}$ ! Were we to use shunt-capacitance compensation, such a large value could not be fabricated on chip and it would also result in a much lower slew rate.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-081.jpg?height=422&width=1604&top_left_y=1644&top_left_x=189)

FIGURE 7.89 Ac equivalent of the 741 op amp for the estimation of the dominant pole $f_{D}$.

### Frequency Compensation of the Two-Stage CMOS Op Amp

We wish to investigate the frequency compensation of the two-stage CMOS op amp of Fig. 7.90, assuming a $1-\mathrm{pF}$ load. We assume the process parameters of Section 6.12, which are based on $L_{\text {drawn }}=1 \mu \mathrm{~m}$ and are listed in the following PSpice models:

```
.model Mn NMOS(Level=1 Tox=20n Uo=600 Vto=0.7 Lambda=0.1
+ Ld=0.15u Gamma=0.6 phi=0.75 Cj=166u Mj=0.5 Cjsw=0.127n
+ Mjsw=0.33 Pb=0.909 Cgso=0.259n Cgdo=0.259n)
.model Mp PMOS(Level=1 Tox=20n Uo=250 Vto=-0.7 Lambda=0.05
+ Ld=0.2u Gamma=0.5 phi=0.7 Cj=396u Mj=0.5 Cjsw=0.366n
+ Mjsw=0.33 Pb=0.955 Cgso=0.345n Cgdo=0.345n)
```

Following the procedure of Section 6.12, we specify the individual transistor dimensions $A_{s}, P_{s}, A_{d}$, and $P_{d}$ so as to reflect the device geometries of Fig. 7.90. Here, the Ws have been calculated on the basis of $V_{O V}=0.25 \mathrm{~V}$ for all FETs as well as the effective channel lengths $L_{n}=L_{\text {drawn }}-2 L_{\text {ovn }}=1-2 \times 0.15=0.7 \mu \mathrm{~m}$ and $L_{p}=L_{\text {drawn }}-2 L_{\text {ovp }}=$ $1-2 \times 0.2=0.6 \mu \mathrm{~m}$. The outcome is the following PSpice netlist

```
* source CKT_of_Fig_7.90
V_VDD DD 0 2.5V
V_VSS 0 SS 2.5V
I_IREF GP SS DC 100uA
V_Vi IN O DC OVdc AC 1Vac
M_M1 GN O SP SP Mp L=1u W=22u As=66p Ps=28u Ad=66p
+ Pd=28u
M_M2 V1 IN SP SP Mp L=1u W=22u As=66p Ps=28u Ad=66p
+ Pd=28u
M_M3 GN GN SS SS Mn L=1u W=12u As=30p Ps=17u Ad=30p
+
Pd=17u
M_M4 V1 GN SS SS Mn L=1u W=12u As=30p Ps=17u Ad=30p
+ Pd=17u
M_M5 VO V1 SS SS Mn L=1u W=22U As=55p Ps=27u Ad=55p
+
M_M6 VO GP DD DD Mp L=1u W=44u As=132p Ps=50u Ad=132p
+ Pd=50u
M_M7 SP GP DD DD Mp L=1u W=44u As=132p Ps=50u Ad=132p
+ Pd=50u
M_M8 GP GP DD DD Mp L=1u W=44u As=132p Ps=50u Ad=132p
+ Pd=50u
C_CL VO O 5pF
C_Cc V1 VO {Ccvar}
.INC "CKT_of_Fig_7.90-SCHEMATIC1.par"
```

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-083.jpg?height=698&width=1022&top_left_y=212&top_left_x=205)

FIGURE 7.90 PSpice circuit to plot the frequency response a two-stage CMOS op amp using conventional Miller compensation.

The small-signal (.TF) analysis yields the following low-frequency parameter values:

$$
\begin{gathered}
a_{0}=4245 \mathrm{~V} / \mathrm{V} \quad g_{m 1}=0.425 \mathrm{~mA} / \mathrm{V} \quad r_{o 2} / / r_{o 4}=143.3 \mathrm{k} \Omega \\
g_{m 5}=0.9344 \mathrm{~mA} / \mathrm{V} \quad r_{o 5} / / r_{o 6}=74.59 \mathrm{k} \Omega
\end{gathered}
$$

The ac analysis gives the open-loop responses of Fig. 7.91. Using the cursor facility of PSpice on the uncompensated curves ( $C_{c}=0$ ), we find that gain crosses the $0-\mathrm{dB}$ axis at $f_{x} \cong 366 \mathrm{MHz}$, where $\phi_{x} \cong-184^{\circ}$, indicating an amplifier in dire need of frequency compensation.

The logical candidate for dominant-pole compensation is the CS stage $M_{5}$, where we can take advantage of the Miller effect to multiply a small compensation capacitance $C_{c}$ placed between its gate and drain terminals for the purpose of establishing a dominant pole at a suitably low frequency. To investigate further, refer to the ac equivalent of Fig. 7.92, where

$$
\begin{equation*}
R_{1}=r_{o 2} / / r_{o 4} \quad R_{2}=r_{o 5} / / / r_{o 6} \tag{7.106}
\end{equation*}
$$

and $C_{1}$ and $C_{2}$ are the net capacitances associated with the gate and drain terminals of $M_{5}$,

$$
\begin{equation*}
C_{1}=C_{g d 2}+C_{d b 2}+C_{g d 4}+C_{d b 4}+C_{g 55} \quad C_{2}=C_{d b 5}+C_{d b 6}+C_{g d 6}+C_{L} \tag{7.107}
\end{equation*}
$$

(Usually the load capacitance $C_{L}$ dominates all the output-node parasitic capacitances, so we approximate $C_{2} \cong C_{L}$ and ignore $C_{1}$ compared to $C_{2}$.) Moreover, the feedback capacitance is

$$
\begin{equation*}
C_{f}=C_{c}+C_{g d 5} \tag{7.108}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-084.jpg?height=870&width=915&top_left_y=201&top_left_x=444)

FIGURE 7.91 Magnitude and phase plots for the op amp of Fig. 7.90. The dark curves show the uncompensated ( $C_{c}=0$ ) response. The shaded curves indicate that conventional Miller compensation fails to convincingly bend the phase curves toward $-90^{\circ}$ in the vicinity of crossover.
(Usually $C_{c} \gg C_{g d 5}$, so we approximate $C_{f} \cong C_{c}$.) Ignoring the stray capacitance $C_{i}$, we observe that this circuit is similar to that of Fig. 7.83, so we adapt the formulas developed there (after dropping the subscripts "new" to simplify the notation), and state that in the presence of $C_{c}$, gain takes on the form

$$
\begin{equation*}
a(j f)=a_{0} \frac{1-j f / f_{0}}{\left(1+j f / f_{1}\right)\left(1+j f / f_{2}\right)} \tag{7.109}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-084.jpg?height=358&width=1192&top_left_y=1765&top_left_x=444)

FIGURE 7.92 Approximate ac equivalent of the two-stage CMOS amplifier of Fig. 7.90.
where

$$
\begin{gather*}
a_{0}=g_{m 1} R_{1} g_{m 5} R_{2}  \tag{7.110}\\
f_{1} \cong \frac{1 / 2 \pi}{R_{1}\left[C_{1}+C_{f}\left(1+g_{m 5} R_{2}+R_{2} / R_{1}\right)\right]+R_{2} C_{2}} \cong \frac{1}{2 \pi R_{1} g_{m 5} R_{2} C_{f}} \cong \frac{1}{2 \pi R_{1} g_{m 5} R_{2} C_{c}}  \tag{7.111}\\
f_{2} \cong \frac{g_{m 5} / 2 \pi}{C_{1}+C_{2}\left(1+C_{1} / C_{f}\right)} \cong \frac{g_{m 5}}{2 \pi C_{2}} \cong \frac{g_{m 5}}{2 \pi C_{L}}  \tag{7.112}\\
f_{0}=\frac{g_{m 5}}{2 \pi C_{f}} \cong \frac{g_{m 5}}{2 \pi C_{c}} \tag{7.113}
\end{gather*}
$$

Moreover, the gain-bandwidth product over the frequency region dominated by $f_{1}$ is GBP $=a_{0} \times f_{1}$, or

$$
\begin{equation*}
\mathrm{GBP}=\frac{g_{m 1}}{2 \pi C_{f}} \cong \frac{g_{m 1}}{2 \pi C_{c}} \tag{7.114}
\end{equation*}
$$

(Beside confirming the pole pair and RHP zero, the plots of Fig. 7.91 reveal the existence of an additional RHP zero in the $10-\mathrm{GHz}$ range, stemming from forward transmission from $V_{i}$ to $V_{1}$ via the parasitics of the input stage. However, given its high frequency, its impact on the phase margin will be negligible and it shall be ignored. Moreover, the first stage introduces an additional pole-zero pair spaced an octave apart, as per Fig. 6.29b. This too will be ignored for the sake of simplicity.)

Equations (7.111) through (7.113) indicate that increasing $C_{c}$ will downshift both $f_{1}$ and $f_{0}$ by about the same amount, while leaving $f_{2}$ approximately unchanged. In fact, for $C_{c}=C_{L}(=1 \mathrm{pF}), f_{0}$ overlaps $f_{2}$, and for $C_{c}=10 C_{L}(=10 \mathrm{pF}), f_{0}$ is a decade below $f_{2}$ (this is confirmed also by the magnitude plots of Fig. 7.91). We make the important observation that regardless of the value of $C_{c}, f_{1}$ and $f_{0}$ are generally not separated widely enough to prevent the phase lag of the RHP zero from eroding the phase margin. This inherent limitation of MOSFETs stems from their notoriously low $g_{m} \mathrm{~s}\left(g_{m 5}\right.$ in the present case, as evidenced by the fact that the separation $f_{0} / f_{1}$ is proportional to $g_{m 5}^{2}$ ). Were it possible to raise $g_{m 5}$ by, say, a decade without altering the capacitances, the GBP would remain unchanged, while both $f_{0}$ and $f_{2}$ would move up and away from $f_{x}$ by a decade, raising the phase margin significantly (see Problem 7.64).
(a) Estimate the phase margin of the amplifier of Fig. 7.90 for the special case $C_{c}=C_{L}(=1 \mathrm{pF})$.
(b) Comment on your results.

### Solution

(a) Equations (7.111) through (7.113) give $f_{1}=1 /\left(2 \pi \times 143.3 \times 10^{3} \times 0.9344 \times\right.$ $\left.10^{-3} \times 74.59 \times 10^{3} \times 1 \times 10^{-12}\right)=15.9 \mathrm{kHz}$ and $f_{0}=f_{2}=0.9344 \times$ $10^{-3} /\left(2 \pi \times 1 \times 10^{-12}\right)=149 \mathrm{MHz}$, so the gain is

$$
a(j f)=\frac{4245\left[1-j f /\left(149 \times 10^{6}\right)\right]}{\left[1+j f /\left(15.9 \times 10^{3}\right)\right] \times\left[1+j f /\left(149 \times 10^{6}\right)\right]}
$$

We easily find that the magnitude

$$
\begin{aligned}
|a(j f)| & =4245 \sqrt{\frac{1+f^{2} /\left(149 \times 10^{6}\right)^{2}}{\left[1+f^{2} /\left(15.9 \times 10^{3}\right)^{2}\right]\left[1+f^{2} /\left(149 \times 10^{6}\right)^{2}\right]}} \\
& =\frac{4245}{\sqrt{1+f^{2} /\left(15.9 \times 10^{3}\right)^{2}}}
\end{aligned}
$$

drops to $1 \mathrm{~V} / \mathrm{V}$ at $f_{x}=67.5 \mathrm{MHz}$, where

$$
\begin{aligned}
\phi_{x} & =-\tan ^{-1} \frac{67.5 \times 10^{6}}{15.9 \times 10^{3}}-\tan ^{-1} \frac{67.5 \times 10^{6}}{149 \times 10^{6}}-\tan ^{-1} \frac{67.5 \times 10^{6}}{149 \times 10^{6}} \\
& \cong-90^{\circ}-24.4^{\circ}-24.4^{\circ} \cong-139^{\circ}
\end{aligned}
$$

Consequently, $\phi_{m}=180-139=41^{\circ}$, which is generally not sufficiently high. (PSpice gives $f_{x}=63.5 \mathrm{MHz}, \phi_{x}=-141.6^{\circ}$, and $\phi_{m}=38.4^{\circ}$, in reasonable agreement with the calculations.)
(b) For $C_{c}=C_{L}$ the RHP zero and the second pole cancel each other from the magnitude expression, leaving only the dominant pole (this is confirmed by the magnitude curve corresponding to $C_{c}=1 \mathrm{pF}$ in Fig. 7.91). However, their individual phase lags, far from canceling out, reinforce each other!

To figure ways around the effect of low $g_{m 5}$, we need to take a closer look at the physical basis of the zero frequency $f_{0}$. With reference to Fig. 7.92 , we decompose the current through $C_{f}$ into a forward component $I_{f w}(j f)=V_{1} /\left(1 / j 2 \pi f C_{c}\right)$ and a reverse component $I_{r v}(j f)=V_{o} /\left(1 / j 2 \pi f C_{c}\right)$, or

$$
\begin{equation*}
I_{f w}(j f)=j 2 \pi f C_{c} V_{1} \quad I_{r v}(j f)=j 2 \pi f C_{c} V_{o} \tag{7.115}
\end{equation*}
$$

We make the following observations:

- $I_{r v}(j f)$ is responsible for making $C_{c}$ appear magnified by the Miller multiplier when reflected to the input node $V_{1}$. As such, $I_{r v}(j f)$ is desirable because it establishes the dominant pole.
- $I_{f w}(j f)$ is responsible for creating the RHP transmission zero at the output node $V_{o}$. As such, it is undesirable because the presence of this zero erodes the phase margin and halts the gain roll-off that is needed to stabilize the circuit. Recall from Section 6.3 that $f_{0}$ is the frequency at which the condition $\left|I_{f_{v}}\left(j f_{0}\right)\right|=g_{m 5} V_{1}$ is met, which causes $V_{o}$ to drop to zero (hence the name). Rewriting as $\left|j 2 \pi f_{0} C_{f} V_{1}\right|=$ $g_{m 5} V_{1}$ gives the familiar result $f_{0}=g_{m s} /\left(2 \pi C_{f}\right)$. For $f>f_{0}$ we have $\left|I_{f w}(j f)\right|>$ $g_{m 5} V_{1}$, indicating a polarity reversal of $V_{o}$ that turns feedback from negative to positive. This is not necessarily a problem if $f_{0} \gg f_{x}$, which is usually the case with bipolar amplifiers. However, in MOS amplifiers $f_{0}$ tends to be much lower due to the aforementioned low $g_{m}$ of FETs.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-087.jpg?height=623&width=1424&top_left_y=205&top_left_x=204)

FIGURE 7.93 The RHP zero can be eliminated via (a) a voltage buffer or (b) a current buffer, or it can be relocated via (c) a suitable series resistance $R_{c}$.

The best way to cope with the undesirable RHP zero is to eliminate it altogether or at least to shift it to a less harmful location. Figure 7.93 shows three different techniques for achieving this goal.

- The scheme ${ }^{8}$ of Fig. 7.93a exploits the unilateral nature of a CD voltage buffer to transmit $I_{r v}$ to node $V_{1}$ while diverting $I_{f w}$ to $V_{D D}$ and thus preventing it from reaching node $V_{o}$, where it would create the RHP zero (see Problem 7.69). A drawback of this scheme is a reduction in the OVS, as $v_{O(\min )}$ is raised from $V_{S S}+V_{O V S}$ to $V_{S S}+V\left(I_{S}\right)_{\min }+V_{G S(C D)}$, where $V\left(I_{S}\right)_{\text {min }}$ is the minimum allowable voltage drop across the $I_{S}$ current sink, and $V_{G S(C D)}$ is the gate-source voltage drop of the CD buffer.
- The scheme ${ }^{9}$ of Fig. $7.93 b$ uses a CG current buffer to transmit $I_{r v}$ to node $V_{1}$ while inhibiting the formation of $I_{f w}$ because of the high resistance seen looking into the buffer's drain (see Problem 7.70). A drawback of this scheme is that $I_{S}$ and $I_{D}$ must be closely matched to avoid creating an intolerable offset error (see Ref. [10] for an ingenious way around this).
- The scheme ${ }^{11}$ of Fig. $7.93 c$ utilizes a series resistance $R_{c}$ to curb $I_{f w}$ at high frequencies. At low frequencies, where $R_{c} \ll\left|1 /\left(j 2 \pi f C_{c}\right)\right|, C_{c}$ still dominates, giving $I_{r v}(j f) \cong j 2 \pi f C_{c} V_{o}$ to sustain the dominant pole $f_{1}$. But at high frequencies, the presence of $R_{c}$ changes the location of the transmission zero because we now have $I_{f w}(s)=V_{1} /\left(R_{c}+1 / s C_{c}\right)$. $V_{o}$ will drop to zero at the complex frequency $s_{0}$ such that $I_{f w}\left(s_{0}\right)=g_{m 5} V_{1}$, or

$$
\frac{V_{1}}{R_{c}+1 /\left(s_{0} C_{c}\right)}=g_{m 5} V_{1}
$$

Solving for $s_{0}$, we get the $s$-plane zero

$$
s_{0}=\frac{1}{\left(1 / g_{m 5}-R_{c}\right) C_{c}}
$$

As a consequence, the zero frequency in the numerator of Eq. (7.109) takes on the modified form

$$
\begin{equation*}
f_{0(\text { new })}=\frac{1}{2 \pi\left(1 / g_{m 5}-R_{c}\right) C_{c}} \tag{7.116}
\end{equation*}
$$

We observe that the presence of $R_{c}$ reduces the denominator (at least so long as $\left.R_{c}<1 / g_{m 5}\right)$, in turn raising $f_{0(\text { new })}$ and pushing its phase lag above and away from the crossover frequency $f_{x}$. Making $R_{c}=1 / g_{m 5}$ pushes $f_{0(\text { new })}$ to infinity and reduces the numerator of Eq. (7.109) to unity. Raising $R_{c}$ further $\left(R_{c}>1 / g_{m 5}\right)$ changes the polarity of $f_{0(\text { new })}$ in the numerator of Eq. (7.109), thus resulting in a left-half-plane (LHP) zero. As we know, this is highly desirable because it produces phase lead (as opposed to the phase lag of a RHP zero). The resistance $R_{c}$ is usually the channel of a MOSFET biased in the ohmic region (see Problem 7.71 for a popular circuit realization of $R_{c}$ ).
(a) Find $R_{c}$ and $C_{c}$ to compensate the two-stage op amp of Fig. 7.90 for $\phi_{m}=$ $75^{\circ}$ with $f_{0}=\infty$. Hence, estimate the open-loop gain $a(j f)$, the gain-bandwidth product GBP, and the slew rate SR.
(b) Compare with PSpice, and comment.
(c) Assuming $\beta=1$, plot the closed-loop frequency response as well as the transient response to a pulse alternating between -100 mV and +100 mV . Is the pulse response slew-rate limited?

### Solution

(a) The pole frequency due to $C_{L}$ is still $f_{2}=g_{m 5} /\left(2 \pi C_{L}\right) \cong 149 \mathrm{MHz}$. For $\phi_{m}=$ $75^{\circ}$ we need $\phi_{x}=75-180=-105^{\circ}$. With $-90^{\circ}$ coming from the dominant pole frequency $f_{1}$, the cumulative phase contribution by $f_{2}$ and higher-order root frequencies must be $90-105=-15^{\circ}$. Ignoring the higher-order roots, we require that $-15^{\circ} \cong-\tan ^{-1}\left(f_{x} / f_{2}\right)$, or

$$
f_{x} \cong f_{2} \times \tan 15^{\circ}=149 \times 0.268=39.8 \mathrm{MHz}
$$

The required dominant pole frequency is

$$
f_{1}=\frac{f_{x}}{a_{0}}=\frac{39.8 \times 10^{6}}{4245}=9.39 \mathrm{kHz}
$$

so Eq. (7.111) gives

$$
\begin{aligned}
C_{c} & \cong \frac{1}{2 \pi R_{1} g_{m 5} R_{2} f_{1}} \\
& =\frac{1}{2 \pi \times 143.3 \times 10^{3} \times 0.9344 \times 10^{-3} \times 74.59 \times 10^{3} \times 9.39 \times 10^{3}} \\
& \cong 1.70 \mathrm{pF}
\end{aligned}
$$

Finally, to move the zero frequency to infinity we need

$$
R_{c}=1 / g_{m 5}=1 /\left(0.9344 \times 10^{-3}\right)=1.07 \mathrm{k} \Omega
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-089.jpg?height=696&width=1107&top_left_y=213&top_left_x=280)

FIGURE 7.94 Frequency compensation for op amp of Example 7.37.
Ignoring higher-order roots, the gain after compensation is approximately

$$
a(j f) \cong \frac{4245}{\left[1+j f /\left(9.39 \times 10^{3}\right)\right] \times\left[1+j f /\left(149 \times 10^{6}\right)\right]}
$$

We also have $\mathrm{GBP} \cong f_{x}=39.8 \mathrm{MHz}$ and $\mathrm{SR}=I_{D 7} / C_{c}=(100 \mu \mathrm{~A}) /(1.70 \mathrm{pF}) \cong$ $59 \mathrm{~V} / \mu \mathrm{s}$.
(b) Using the PSpice circuit of Fig. 7.94, we obtain the plots of Fig. 7.95. Compared to Fig. 7.91, the phase curve at crossover is now far more convincingly bent
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-089.jpg?height=736&width=924&top_left_y=1384&top_left_x=275)

FIGURE 7.95 Magnitude and phase plots for the op amp of Fig. 7.94.
toward $-90^{\circ}$. In fact, using PSpice's cursor facility, we find $f_{x}=35.2 \mathrm{MHz}$, where $\phi_{x}=-107.2^{\circ}$, and, hence, $\phi_{m}=180-107.2=72.8^{\circ}$. These data are in fair agreement with the hand calculations, which are based on the assumption that all internal stray capacitances are negligible compared to $C_{c}$ and $C_{L}$.
(c) To achieve $\beta=1$ in Fig. 7.94 , lift $M_{1}$ 's gate off ground and tie it to node $V_{o}$. This yields the closed-loop responses of Fig 7.96. Note the absence of slewrate limiting in Fig. 7.96b.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-090.jpg?height=426&width=635&top_left_y=510&top_left_x=265)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-090.jpg?height=414&width=637&top_left_y=521&top_left_x=959)
(b)

FIGURE 7.96 (a) Frequency (b) pulse responses of the CMOS op amp of Fig. 7.94 configured for negative-feedback operation with $\beta=1$.

If $C_{L}$ is doubled in the circuit of Example 7.37, find $R_{c}$ so as to retain the same phase margin without increasing $C_{c}$. What is the expression for $a(j f)$ after compensation? Verify with PSpice and comment.

### Solution

Doubling $C_{L}$ will halve $f_{2}$ to 74.5 MHz , bringing it an octave closer to $f_{x}$, where it will erode $\phi_{m}$. Its phase at $f_{x}$ is $-\tan ^{-1}\left(f_{x} / f_{2}\right)=-\tan ^{-1}(39.8 / 74.5)=-28.1^{\circ}$, which exceeds the original $-15^{\circ}$ by $-28.1-(-15)=-13.1^{\circ}$. To retain the original $\phi_{m}$, we must neutralize this excess phase lag with the phase lead of a LHP zero. Its frequency $-f_{0 \text { (new) }}$ must be such that $+13.1^{\circ}=\tan ^{-1}\left[f_{x} /\left(-f_{0(\text { new })}\right)\right]=$ $\tan ^{-1}\left[39.8 /\left(-f_{0 \text { (new) }}\right)\right]$, which gives $-f_{0 \text { (new) }} \cong 171 \mathrm{MHz}$. Using Eq. (7.116)

$$
-171 \times 10^{6}=\frac{1}{2 \pi\left(1070-R_{c}\right) \times 1.7 \times 10^{-12}}
$$

gives $R_{c}=1.617 \mathrm{k} \Omega$. After compensation the gain is

$$
a(j f) \cong \frac{4245\left[1+j f /\left(171 \times 10^{6}\right)\right]}{\left[1+j f /\left(9.39 \times 10^{3}\right)\right] \times\left[1+j f /\left(74.5 \times 10^{6}\right)\right]}
$$

(note the + sign in the numerator, indicative of a LHP zero!). Re-running the PSpice circuit of Fig. 7.94, but with $C_{L}=2 \mathrm{pF}$ and $R_{c}=1.617 \mathrm{k} \Omega$ we find $f_{x}=35.2 \mathrm{MHz}$, where $\phi_{x}=-107.2^{\circ}$, and, hence, $\phi_{m}=180-107.2=72.8^{\circ}$. These data are again in fair agreement with the hand calculations, which are based on the assumption that all internal stray capacitances are negligible compared to $C_{c}$ and $C_{L}$.

### Frequency Compensation of the Folded-Cascode CMOS Op Amp

Figure 7.97 shows the ac model of the folded-cascode op amp, along with the most relevant capacitances intervening in its frequency response. Each capacitance is the result of lumping together all parasitic capacitances associated with the corresponding node (the output node includes also the external load capacitance). According to the OCTC procedure of Section 6.7, the $-3-\mathrm{dB}$ frequency is

$$
\begin{equation*}
f_{b} \cong \frac{1 / 2 \pi}{R_{1} C_{1}+R_{2} C_{2}+\cdots+R_{5} C_{5}+R_{o}\left(C_{6}+C_{c}\right)} \tag{7.117}
\end{equation*}
$$

where $R_{1}$ through $R_{5}$ are the open-circuit equivalent resistances seen by $C_{1}$ through $C_{5}$, and $R_{o}$ is the op amp's output resistance. By Eq. (5.69), this resistance is

$$
\begin{equation*}
R_{o} \cong\left[\left(g_{m 6}+g_{m b 6}\right) r_{o 6} r_{o 8}\right] / /\left[\left(g_{m 4}+g_{m b 4}\right) r_{o 4}\left(r_{o 2} / / r_{o 10}\right)\right] \tag{7.118}
\end{equation*}
$$

The resistances $R_{1}$ through $R_{5}$ are all source resistances, on the order of $1 /\left(g_{m}+g_{m b}\right)$. As such they are much smaller than $R_{o}$, and even though the time constants $R_{1} C_{1}$ through $R_{5} C_{5}$ are likely to differ from one another, they all tend to be negligible compared to that associated with $R_{o}$, so we approximate

$$
\begin{equation*}
f_{b} \cong \frac{1}{2 \pi R_{o}\left(C_{6}+C_{c}\right)} \tag{7.119}
\end{equation*}
$$

According to Eq. (7.94), the phase margin can be expressed as $\phi_{m}=90^{\circ}+\phi_{x(\mathrm{HOR})}$, where $\phi_{x(\mathrm{HOR})}$ is the combined phase shift due to all higher-order roots. Consequently,
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-091.jpg?height=924&width=1281&top_left_y=1182&top_left_x=205)

FIGURE 7.97 Ac model of the folded-cascode op amp.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-092.jpg?height=805&width=1060&top_left_y=208&top_left_x=447)

FIGURE 7.98 PSpice circuit to plot the gain of a folded-cascode CMOS op amp with a variable load $C_{c}$.
in order to compensate the folded-cascode op amp for a given $\phi_{m}$, we simply add enough capacitance to the output node to lower $f_{b}$ until the condition $\phi_{x(\mathrm{HOR})}=\phi_{m}-$ $90^{\circ}$ is met. The gain-bandwidth product after compensation is GBP $=a_{0} \times f_{b}$, where $a_{0}=g_{m 1} R_{o}, g_{m 1}$ being the transconductance of the transistors of the SC pair. Using Eq. (7.119), we get

$$
\begin{equation*}
\mathrm{GBP} \cong \frac{g_{m 1}}{2 \pi\left(C_{6}+C_{c}\right)} \tag{7.120}
\end{equation*}
$$

Let us illustrate the above concepts using the PSpice circuit of Fig. 7.98 as a practical example. We assume the same process parameters as the two-stage op amp of Fig. 7.90, which are based on $L_{\text {drawn }}=1 \mu \mathrm{~m}$ with effective channel lengths $L_{n}=0.7 \mu \mathrm{~m}$ and $L_{p}=0.6 \mu \mathrm{~m}$. Moreover, the $W \mathrm{~s}$ have been calculated on the basis of $V_{O V}=0.25 \mathrm{~V}$ for all FETs. The outcome is the following netlist:

```
* source CKT_of_Fig_7.98
V_VDD DD 0 2.5V
V_VSS 0 SS 2.5V
I_I1 DD S12 DC 100uA
V_V1 G90 SS 0.95V
V_V2 G34 G90 0.25V
M_M1 D9 IN S12 S12 Mp L=1u W=22u As=66p Ps=28u Ad=66p
+ Pd=28u
M_M2 {lo 0 S12 S12 Mp L=1u W=22u As=66p Ps=28u Ad=66p
```

| M_M3 | G56 G34 D9 SS Mn L=1u W=16U As=40p Ps=21u As=40p |
| :---: | :---: |
| + | $\mathrm{Ps}=21 \mathrm{u}$ |
| M_M4 | OUT G34 D10 SS Mn L=1u W=16U As=40p Ps=21u As=40p |
| + | Ps $=21 u$ |
| M_M5 | G56 G56 G78 DD Mp L=1u W=33u As=99p Ps=39u Ad=99p |
| + | Pd=39u |
| M_M6 | OUT G56 S6 DD Mp L=1u W=33u As=99p Ps=39u Ad=99p |
| $+$ | Pd=39u |
| M_M7 | G78 G78 DD DD Mp L=1u W=33u As=99p Ps=39u Ad=99p |
| $+$ | $\mathrm{Pd}=39 \mathrm{u}$ |
| M_M8 | S6 G78 DD DD Mp L=1u W=33u As=99p Ps=39u Ad=99p |
| $+$ | Pd=39u |
| M_M9 | D9 G90 SS SS Mn L=1u W=27U As=68p Ps=33u Ad=68p |
| $+$ | Pd=33u |
| M_M10 | D10 G90 SS SS Mn L=1u W=27.02U As=68p Ps=33u Ad=68p |
| $+$ | Pd=33u |
| C_Cc | V1 VO \{Ccvar\} |
| . INC | _of_Fig_9.11-SCHEMATIC1.par" |

The small-signal ( .TF) analysis gives the following low-frequency parameter values

$$
\begin{equation*}
a_{0}=2679 \mathrm{~V} / \mathrm{V} \quad R_{o}=6.391 \mathrm{M} \Omega \quad g_{m 1}=419 \mu \mathrm{~A} / \mathrm{V} \tag{7.121a}
\end{equation*}
$$

The ac analysis gives the open-loop responses of Fig. 7.99. Using PSpice's cursor facility, we find that the uncompensated response, corresponding to $C_{c}=0$, has

$$
\begin{equation*}
f_{b}=425 \mathrm{kHz} \quad f_{x}=749.5 \mathrm{MHz} \quad \phi_{x}=-131.5^{\circ} \quad \phi_{m}=48.5^{\circ} \tag{7.121b}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-093.jpg?height=401&width=1013&top_left_y=1286&top_left_x=207)
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-093.jpg?height=403&width=1013&top_left_y=1677&top_left_x=205)

FIGURE 7.99 Magnitude and phase plots for the op amp of Fig. 7.98 for different values of $C_{c}$.

To increase $\phi_{m}$ we deliberately add capacitance to the output node and obtain the curves shown for the cases $C_{c}=0.2 \mathrm{pF}$ and 1 pF . As expected, the price for more phase margin is bandwidth reduction.

EXAMPLE 7.39 (a) Using the above cursor data, estimate the output-node parasitic capacitance $C_{6}$.
(b) Find $C_{c}$ for $\phi_{m}=75^{\circ}$ using the fact that the cursor gives, for the uncompensated response, $f_{-105^{\circ}}=186 \mathrm{MHz}$. What are the ensuing bandwidth $f_{b}$ and GBP? Check with PSpice and comment.

### Solution

(a) For $C_{c}=0$ we use Eq. (7.119) to impose

$$
425 \times 10^{3}=\frac{1}{2 \pi \times 6.391 \times 10^{6} \times\left(C_{6}+0\right)}
$$

This gives $C_{6}=58.6 \mathrm{fF}$.
(b) Adapting Eq. (7.96) to the present case we write $f_{b}=f_{-105^{\circ}} / a_{0}=186 \times$ $10^{6} / 2679 \cong 69.4 \mathrm{kHz}$. Using again Eq. (7.119),

$$
69.4 \times 10^{3}=\frac{1}{2 \pi \times 6.391 \times 10^{6} \times\left(58.6 \times 10^{-15}+C_{c}\right)}
$$

which gives $C_{c}=300 \mathrm{fF}$ and $\mathrm{GBP}=186 \mathrm{MHz}$. Rerunning PSpice with $C_{c}=0.3 \mathrm{pF}$ we get $f_{b}=69.3 \mathrm{kHz}, \mathrm{GBP}=f_{x}=173 \mathrm{MHz}, \phi_{x}=-108^{\circ}$, and $\phi_{m}=72^{\circ}$, all in reasonable agreement with the calculated values.

### Comparing the Two-Stage and Folded-Cascode Op Amps

The two topologies exhibit similarities as well as differences:

- Both topologies exhibit a dominant pole frequency of the type

$$
f_{b} \propto \frac{1}{2 \pi R M C_{c}}
$$

where $R$ is a suitable resistance, and $M$ is a large multiplier that helps establish a suitably low $f_{b}$ with a compensation capacitance $C_{c}$ that can easily be fabricated on chip. In the two-stage topology it is $C_{c}$ that gets multiplied by $M$ by the Miller effect, whereas in the cascode topology it is $R$ that gets multiplied by $M$ because of cascoding.

- Increasing $C_{c}$ in the two-stage topology has a destabilizing effect because it lowers the RHP zero frequency, thus eroding the phase margin.
- Increasing $C_{c}$ in the cascode topology has a stabilizing effect because it lowers the first pole, thus pushing the phase margin closer to $90^{\circ}$. This makes cascode op amps particularly suited to driving arbitrary capacitive loads as in switchedcapacitor filters.

## 7.10 NOISE

Any disturbance that tends to obscure a signal of interest is generally referred to as noise. A familiar example is hum ("hmmm") in a poorly designed audio system. This noise is injected into the circuit from the outside (in this case from the utility power). Another example is the hiss ("shhh") produced by a low quality audio amplifier and best evidenced when we turn the volume all the way up with no audio input. This is an example of intrinsic noise, so called because it is generated internally by the components (resistors, diodes, and transistors) making up the circuit (conversely, noise injected from the outside is called extrinsic noise). Though we can virtually eliminate extrinsic noise via proper design, layout, and shielding, intrinsic noise is always present in a circuit. It can be reduced via proper component and circuit topology selection, and filtering, but it can never be eliminated entirely.

The most common example of intrinsic noise is resistor noise, which is the result of thermal agitation of the charge carriers (electrons in ordinary resistors and $n$-type materials, holes in $p$-type materials), and is present even if the resistor is sitting in the drawer. Though the voltage across an unconnected resistor averages to zero, its instantaneous value is constantly fluctuating about zero as depicted in Fig. 7.100.

### Basic Noise Properties

Denoting a noise voltage as $e_{n}(t)$ and a noise current as $i_{n}(t)$, we are interested in their root-mean-square (rms) values $E_{n}$ and $I_{n}$ over a time interval $t_{1}$ to $t_{2}$, respectively defined as

$$
\begin{equation*}
E_{n}=\sqrt{\frac{1}{t_{2}-t_{1}} \int_{t_{1}}^{t_{2}} e_{n}^{2}(t) d t} \quad I_{n}=\sqrt{\frac{1}{t_{2}-t_{1}} \int_{t_{1}}^{t_{2}} i_{n}^{2}(t) d t} \tag{7.122}
\end{equation*}
$$

Their physical meanings are that if we play $e_{n}(t)$ across or $i_{n}(t)$ through a resistor $R$, the power dissipated by $R$ is $E_{n}^{2} / R$ or $R I_{n}^{2}$. Alternatively, we say that $E_{n}^{2}$ and $I_{n}^{2}$ represent the power dissipated by $e_{n}(t)$ and $i_{n}(t)$ in a 1- $\Omega$ resistance. Though $e_{n}(t)$ and $i_{n}(t)$ cannot be integrated analytically because they are random variables, $E_{n}$ and $I_{n}$ are easily measured with a true rms multimeter.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-095.jpg?height=389&width=604&top_left_y=1637&top_left_x=205)

FIGURE 7.100 Oscilloscope display of (suitably magnified) resistor noise.

In the course of noise analysis we often deal with noise voltages in series or noise currents in parallel, so we are interested in the rms value of the combined noise. For the case of a pair of noise voltages $e_{n 1}(t)$ and $e_{n 2}(t)$ in series, the overall rms value is

$$
E_{n}^{2}=\frac{1}{t_{2}-t_{1}} \int_{t_{1}}^{t_{2}}\left[e_{n 1}(t)+e_{n 2}(t)\right]^{2} d t=E_{n 1}^{2}+\frac{2}{t_{2}-t_{1}} \int_{t_{1}}^{t_{2}} e_{n 1}(t) \times e_{n 2}(t) d t+E_{n 2}^{2}
$$

having expanded the quadratic term and then used Eq. (7.122) twice. In most cases of interest $e_{n 1}(t)$ and $e_{n 2}(t)$ are uncorrelated, so their product averages to zero, giving $E_{n}^{2}=E_{n 1}^{2}+E_{n 2}^{2}$. We readily generalize this result to the case of $N$ uncorrelated noise voltages in series or $N$ uncorrelated noise currents in parallel by stating that they combine in rms fashion as

$$
\begin{equation*}
E_{n}=\sqrt{E_{n 1}^{2}+E_{n 2}^{2} \cdots+E_{n N}^{2}} \quad I_{n}=\sqrt{I_{n 1}^{2}+I_{n 2}^{2} \cdots+I_{n N}^{2}} \tag{7.123}
\end{equation*}
$$

### Noise Spectra

The physical meaning of the rms value of noise is similar to the rms value of an ac signal, except that the power of a sinusoid is concentrated at just one frequency whereas noise power is usually spread all over the frequency spectrum. The frequency distribution of noise power is specified via the noise power densities $e_{n}^{2}(f)$ and $i_{n}^{2}(f)$, each representing the average noise power over a $1-\mathrm{Hz}$ bandwidth as a function of frequency $f$. We use the power densities to calculate analytically the rms values over an arbitrary frequency interval $f_{L}$ to $f_{H}$ as

$$
\begin{equation*}
E_{n}=\sqrt{\int_{f_{L}}^{f_{n}} e_{n}^{2}(f) d f} \quad I_{n}=\sqrt{\int_{f_{L}}^{f_{n}} i_{n}^{2}(f) d f} \tag{7.124}
\end{equation*}
$$

Since $E_{n}$ is in V and $f$ in Hz , it follows that $e_{n}^{2}(f)$ is in $\mathrm{V}^{2} / \mathrm{Hz}$; similarly, $i_{n}^{2}(f)$ is in $\mathrm{A}^{2} / \mathrm{Hz}$.
As an example, the power densities of integrated-circuit (IC) noise take on the analytical forms

$$
\begin{equation*}
e_{n}^{2}(f)=e_{n w}^{2}\left(\frac{f_{c e}}{f}+1\right) \quad i_{n}^{2}(f)=i_{n w}^{2}\left(\frac{f_{c i}}{f}+1\right) \tag{7.125}
\end{equation*}
$$

so substituting into Eq. (7.124) and integrating we obtain

$$
\begin{equation*}
E_{n}=e_{n v} \sqrt{f_{c e} \ln \left(\frac{f_{H}}{f_{L}}\right)+f_{H}-f_{L}} \quad I_{n}=i_{n v} \sqrt{f_{c i} \ln \left(\frac{f_{H}}{f_{L}}\right)+f_{H}-f_{L}} \tag{7.126}
\end{equation*}
$$

Data sheets usually show the square roots of the noise power densities, or $e_{n}(f)$ and $i_{n}(f)$. Called, if improperly, the noise voltage and the noise current for short (beware that their units are $\mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $\mathrm{pA} / \sqrt{\mathrm{Hz}}$, not nV and pA ), they are plotted in Fig. 7.101. We make the following observations:

- For $f \gg f_{c e}$ we have $e_{n} \rightarrow e_{n w}$, and for $f \gg f_{c i}$ we have $i_{n} \rightarrow i_{n w}$, indicating highfrequency asymptotes that are constant with frequency. This type of noise is
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-097.jpg?height=452&width=1405&top_left_y=204&top_left_x=199)

FIGURE 7.101 Typical spectral densities of integrated circuit noise: (a) noise voltage and (b) noise current.
called white noise by analogy with white light, which contains all frequency components, and $e_{n w}$ and $i_{n w}$ are aptly called white-noise floors.

- For $f \ll f_{c e}$ we have, by Eq. (7.125), $e_{n}^{2}(f) \propto 1 / f$, and for $f \ll f_{c i}$ we have $i_{n}^{2}(f) \propto 1 / f$, indicating low-frequency asymptotes with slopes of $-1 \mathrm{dec} / \mathrm{dec}$. (By contrast, the plots of the square roots of Fig. 7.101 exhibit slopes of $-0.5 \mathrm{dec} / \mathrm{dec}$ ). Noise with a power density inversely proportional to frequency $f$ is aptly called $1 / f$ noise.
- The frequencies $f_{c e}$ and $f_{c i}$, representing the borderlines between $1 / f$ noise and white noise are called the corner frequencies by analogy with filters. As a practical example, the data sheets of the popular 741 op amp give

$$
\begin{equation*}
e_{n w}=20 \mathrm{nV} / \sqrt{\mathrm{Hz}} \quad f_{c e}=200 \mathrm{~Hz} \quad i_{n w}=0.5 \mathrm{pA} / \sqrt{\mathrm{Hz}} \quad f_{c i}=2 \mathrm{kHz} \tag{7.127}
\end{equation*}
$$

(a) Find $E_{n}$ for the 741 op amp over the audio range ( 20 Hz to 20 kHz ).
(b) Repeat, but for the wide-band range of 0.1 Hz to 1 MHz , compare with (a), and comment.

### Solution

(a) Using Eq. (7.126),

$$
\begin{aligned}
E_{n} & =20 \times 10^{-9} \sqrt{200 \ln \left(\frac{20 \times 10^{3}}{20}\right)+20 \times 10^{3}-20} \\
& \cong 20 \times 10^{-9} \sqrt{1,382+20 \times 10^{3}}=2.92 \mu \mathrm{~V} \mathrm{rms}
\end{aligned}
$$

(b) Likewise,

$$
\begin{aligned}
E_{n} & =20 \times 10^{-9} \sqrt{200 \ln \left(\frac{10^{6}}{0.1}\right)+10^{6}-0.1} \\
& \cong 20 \times 10^{-9} \sqrt{3,224+10^{6}}=20.0 \mu \mathrm{~V} \mathrm{rms}
\end{aligned}
$$

Increasing the bandwidth increases both the $1 / f$ noise and the white noise contributions. However, due to its logarithmic dependence, the $1 / f$ noise contribution increases less noticeably than the white noise contribution, which increases with the square root of the bandwidth.

It is apparent that the lower the noise floor the lower the white noise contribution, and the lower the corner frequency the lower the $1 / f$ noise contribution. A circuit's noise performance strongly depends also on the frequency limits $f_{L}$ and $f_{H}$. Specifically, the $1 / f$ noise contribution is affected by the $\operatorname{ratiof}_{H} / f_{L}$, and the white noise contribution by the difference $f_{H}-f_{L}$. In general $f_{L}$ is taken as the reciprocal of the time interval over which noise is observed or measured (for instance, for an observation time of 10 s we let $f_{L}=1 / 10=0.1 \mathrm{~Hz}$ ). Shortly we shall discuss how the circuit's frequency characteristics establish the value of $f_{H}$. To avoid unnecessary noise, the user may deliberately apply filtering techniques to lower the value of $f_{H}$ to the minimum required by the application at hand (for instance, band-limiting an audio amplifier to 20 kHz will eliminate any noise contribution above that frequency).

### Noise Types

Noise stems from a number of different physical mechanisms. Following are the types of noise most commonly found in electronic devices:

- Thermal noise. As mentioned, this form of noise stems from thermal agitation of the charge carriers in conductors. It is white, and its power density is proportional to absolute temperature T. Also called Johnson noise for John B. Johnson who first investigated it in 1928, it is present in all resistors, whether intentional resistors or parasitic resistors like the bulk resistance of a pn junction, the base-region resistance of a BJT, or the channel resistance of a FET. We model an actual resistor with a noiseless resistance $R$ in series with a noise voltage $e_{n}$, as depicted in Fig. 7.102a. Or, we can perform a source transformation and use a noiseless resistance $R$ in parallel with a noise current $i_{n r}=e_{n r} / R$, as in Fig. 7.102b. The power densities are given by ${ }^{1}$

$$
\begin{equation*}
e_{n r}^{2}=4 k T R \quad i_{n r}^{2}=\frac{4 k T}{R} \tag{7.128}
\end{equation*}
$$

where $k=1.38 \times 10^{-23} \mathrm{~J} / \mathrm{K}$ is Boltzmann's constant. For instance, at room temperature a $1-\mathrm{k} \Omega$ resistor has $e_{n r}=\sqrt{4 \times 1.38 \times 10^{-23} \times 300 \times 10^{3}} \cong 4 \mathrm{nV} / \sqrt{\mathrm{Hz}}$ and $i_{n r}=4 \times 10^{-9} / 10^{3}=4 \mathrm{pA} / \sqrt{\mathrm{Hz}}$. The rms voltage over a 1-MHz bandwidth is $E_{n}=4 \times 10^{-9} \times \sqrt{10^{6}}=4 \mu \mathrm{~V}$ rms.
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-098.jpg?height=304&width=520&top_left_y=1698&top_left_x=440)

FIGURE 7.102 Resistor noise models, consisting of a noiseless resistance $R$ and (a) a series noise voltage $e_{n r}$ or (b) a parallel noise current $i_{n r}$.

- Shot Noise. As charge carriers flow across a potential barrier such as that of a $p n$ junction, they produce a current $i(t)$ that is constantly fluctuating around its average value $I$ because of the discrete nature of charge. The power density of these fluctuations is proportional to $I$ according to ${ }^{1}$

$$
\begin{equation*}
i_{n}^{2}=2 q I \tag{7.129}
\end{equation*}
$$

where $q=1.602 \times 10^{-19} \mathrm{C}$ is the electron charge.

- Flicker Noise. Also known as contact noise, this form of noise has various origins, depending on the device type. In transistors it is generally due to traps that capture and release charge carriers randomly as they flow to produce current. The ensuing fluctuations exhibit a power density of the type ${ }^{1}$

$$
\begin{equation*}
i_{n}^{2}=\frac{K I^{a}}{f^{b}} \tag{7.130}
\end{equation*}
$$

where $K$ is a device constant called the flicker coefficient, $I$ is the average current, and $a$ and $b$ are additional device constants with $0.5<a<2$ and $b \cong 1$. Since its power density is (approximately) inversely proportional to frequency $f$, flicker noise is also called $1 / f$ noise. Another name is pink noise, by analogy with pink light, whose power is denser at low frequencies.

- Other Forms of Noise. Another form of low-frequency noise is burst noise, so called because of its appearance when observed on the oscilloscope. Also called popcorn noise because of the sound it produces when played through a loudspeaker, it manifests itself in the presence of heavy metal-ion contaminants, such as gold doping ${ }^{1}$ (we will ignore this form of noise here). Another form of noise is breakdown noise, so called because produced by pn junctions when operated in breakdown.

### Noise Models of Semiconductor Devices

We now wish to develop noise models for semiconductor devices using noiseless devices but equipped with suitable external noise sources, in the manner already seen for the resistor.

- Diode Noise Model. To account for its shot and flicker noise, we model an actual diode with a noiseless $p n$ junction but having a parallel noise current $i_{n d}$ as depicted in Table 7.3. Also shown is a series noise voltage $e_{n r}$ modeling the thermal noise of the diode's bulk resistance $r_{S}$ (see Chapter 1$)$. The power densities of these sources are, respectively, ${ }^{1}$

$$
\begin{equation*}
i_{n d}^{2}=2 q I_{D}+\frac{K I_{D}^{a}}{f} \tag{7.131a}
\end{equation*}
$$

$$
\begin{equation*}
e_{n r}^{2}=4 k T_{S} \tag{7.131b}
\end{equation*}
$$

TABLE 7.3 Noise models and noise power densities for semiconductor devices (the devices in the models are assumed noiseless and noise is accounted for by suitable noise sources, as shown).
COADI
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-100.jpg?height=281&width=243&top_left_y=348&top_left_x=480)
LOAD2

$$
\begin{aligned}
& e_{n r}^{2}=4 k T r_{S} \\
& i_{n d}^{2}=2 q I_{D}+\frac{K I_{D}^{a}}{f}
\end{aligned}
$$

$$
\begin{aligned}
& e_{n b}^{2}=4 k T\left(r_{b}+\frac{1}{2 g_{m}}\right) \\
& i_{n b}^{2}=2 q\left(I_{B}+\frac{K I_{B}^{a}}{f}+\frac{I_{C}}{\left|\beta_{0}(j f)\right|^{2}}\right) \\
& i_{n d}^{2}=\frac{K I_{d}^{a}}{f}+4 k T \frac{2}{3} g_{m} \\
& e_{n g}^{2}=\frac{K}{W L C_{o x} f}+4 k T \frac{2}{3} \frac{1}{g_{m}}
\end{aligned}
$$

LOADI
![](https://cdn.mathpix.com/cropped/2024_11_07_ffd7a9d7977619733afcg-100.jpg?height=409&width=318&top_left_y=892&top_left_x=470)

- BJT Noise Model. A forward-biased BJT with base current $I_{B}$ and collector current $I_{C}$ exhibits shot-noise power densities of $2 q I_{B}$ at the base and $2 q I_{C}$ at the collector. Dividing $2 q I_{C}$ by $g_{m}^{2}, g_{m}=I_{C} / V_{T}=q I_{C} / k T$, reflects it to the base, where it is added to $4 k T r_{b}$, the thermal noise due to the base's bulk resistance $r_{b}$ (see Chapter 2). The result is the overall base power density ${ }^{1}$

$$
\begin{equation*}
e_{n b}^{2}=4 k T\left(r_{b}+\frac{1}{2 g_{m}}\right) \tag{7.132a}
\end{equation*}
$$

Likewise, dividing $2 q I_{C}$ by $\left|\beta_{0}(j f)\right|^{2}$ reflects it to the base, where it is added to the base's shot noise as well as to the base's flicker noise, to give the overall base power density ${ }^{1}$

$$
\begin{equation*}
i_{n b}^{2}=2 q\left(I_{B}+\frac{K I_{B}^{a}}{f}+\frac{I_{C}}{\left|\beta_{0}(j f)\right|^{2}}\right) \tag{7.132b}
\end{equation*}
$$

where $K$ and $a$ are process-related parameters. The BJT's noise model and relative power densities are summarized in Table 7.3. By Eq. (7.132a), a BJT

produces the same amount of voltage noise as a resistance $R_{e q}=r_{b}+1 /\left(2 g_{m}\right)$. For instance, a BJT with $r_{b}=250 \Omega$ operating at $I_{C}=0.1 \mathrm{~mA}$ has $R_{e q}=250+$ $(26 / 0.1) / 2=380 \Omega$, giving $e_{n b} \cong 2.5 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

- MOSFET Noise Models. The noise characteristics of a saturated MOSFET are dominated by two noise types: (a) flicker noise, due to the dangling bonds in the channel near the interface with the oxide, which act as traps, randomly capturing and releasing charge carriers as they flow from source to drain; (b) thermal noise, due to the channel's resistance. The noise power density of the drain current is given by ${ }^{1}$

$$
\begin{equation*}
i_{n d}^{2}=\frac{K_{d} I_{D}^{a}}{f}+4 k T \frac{2}{3} g_{m} \tag{7.133a}
\end{equation*}
$$

where $K_{d}$ and $a$ are suitable parameters. Alternatively, we reflect the drain noise to the gate as $e_{n g}^{2}=i_{n d}^{2} / g_{m}^{2}$. The result is expressed in the insightful form ${ }^{1}$

$$
\begin{equation*}
e_{n g}^{2}=\frac{K}{W L C_{o x} f}+4 k T \frac{2}{3} \frac{1}{g_{m}} \tag{7.133b}
\end{equation*}
$$

where $K$ is a process-related constant on the order of $10^{-24} \mathrm{~V}^{2} \mathrm{~F}$. The two MOSFET noise models and relative power densities are summarized in Table 7.3. Flicker noise is inversely proportional to the area $W \times L$, so the IC designer has the option of specifying large-area MOSFETs to keep flicker noise below a prescribed level. Also, $K$ tends to be lower in $p$ MOSFETs than in $n$ MOSFETs as holes are less likely to get trapped than electrons. This is another reason why $p$-channel input stages are preferable. By Eq. (7.133), a MOSFET produces the same amount of voltage noise as a resistance $R_{e q}=2 /\left(3 g_{m}\right)$. For instance, a FET with $g_{m}=1 \mathrm{~mA} / \mathrm{V}$ has $R_{e q}=667 \Omega$, giving $e_{n g} \cong 3.3 \mathrm{nV} / \sqrt{\mathrm{Hz}}$.

### Noise Dynamics

An integrated circuit such as an amplifier consists of a variety of devices, both active and passive, each contributing noise to the output, so finding the individual contributions may be an arduous task. Mercifully, the noise characteristics of the entire circuit can be modeled with just a pair of input noise sources as depicted in Fig. 7.103a. The source $e_{n}$ models the short-circuit input noise because shortcircuiting the input port forces $i_{n}$ to flow through $e_{n}$, so $i_{n}$ has no effect on the output noise, which is thus due exclusively to $e_{n}$. Conversely, the source $i_{n}$ models the opencircuit input noise because open-circuiting the input port eliminates the effect of $e_{n}$ and noise is now due exclusively to $i_{n}$ flowing through the circuit's input impedance.

Once we embed an amplifier in a circuit, we are interested in its total rms output noise $E_{n o}$ for the case of a voltage-output type, or in $I_{n o}$ for a current-output type (by total we mean over the frequency interval $f_{L}<f<\infty$ ). To this end, we first combine the effects of $e_{n}$ and $i_{n}$ into a single equivalent input source $e_{n i}(f)$ for a voltage-input type, or $i_{n i}(f)$ for a current-input type. Next, we multiply this input source by the
![](https://cdn.mathpix.com/cropped/2024_11_07_d01a6e6b2a212ec54522g-02.jpg?height=283&width=1030&top_left_y=211&top_left_x=443)

FIGURE 7.103 (a) Noise model of an amplifier. (b) Circuit for the calculation of the output noise voltage $e_{n o}$ of a voltage amplifier with total input noise voltage $e_{n i}$ and noise gain $A_{n}$.
circuit's noise gain to obtain the output noise. For example, in the case of the voltagetype amplifier exemplified in Fig. $7.103 b$ we write $e_{n o}(f)=\left|A_{n}(j f)\right| e_{n i}(f)$, where $A_{n}(j f)$ is the noise gain, in V/V. Finally, we adapt Eq. (7.124) to find the total rms output noise above some prescribed frequency $f_{L}$ as

$$
\begin{equation*}
E_{n o}=\sqrt{\int_{f_{L}}^{\infty}\left|A_{n}(j f)\right|^{2} e_{n i}^{2}(f) d f} \tag{7.134}
\end{equation*}
$$

Most noise gains of interest are dominated by a single pole, or

$$
\begin{equation*}
A_{n}(j f)=\frac{A_{n 0}}{1+j f / f_{B}} \tag{7.135}
\end{equation*}
$$

where $A_{n 0}$ is the dc gain and $f_{B}$ is the $-3-\mathrm{dB}$ frequency. We are interested in two special cases, namely, the case of white input noise and the case of $1 / f$ input noise.

- White-Noise Equivalent Bandwidth (NEB). Assuming $e_{n i}(f)=e_{n i v}$, we combine Eqs. (7.134) and (7.135) and obtain (see Problem 7.74)
$E_{n o}=A_{n 0} e_{n i w} \sqrt{\int_{f_{L}}^{\infty} \frac{d f}{1+\left(f / f_{B}\right)^{2}}}=A_{n 0} e_{n i w} \sqrt{f_{B}\left(\tan ^{-1} \infty-\tan ^{-1} \frac{f_{L}}{f_{B}}\right)}=A_{n 0} e_{n i w} \sqrt{\text { NEB }}$
where

$$
\begin{equation*}
\mathrm{NEB}=f_{B}\left(\frac{\pi}{2}-\tan ^{-1} \frac{f_{L}}{f_{B}}\right) \tag{7.136}
\end{equation*}
$$

is the white-noise equivalent bandwidth. Situations of practical interest are such that $f_{L} \ll f_{B}$, indicating that we can approximate $\tan ^{-1}\left(f_{L} / f_{B}\right) \cong f_{L} / f_{B}$ in Eq. (7.136). Consequently,

$$
\begin{equation*}
\mathrm{NEB} \cong 1.57 f_{B}-f_{L} \tag{7.137}
\end{equation*}
$$

We observe that if $\left|A_{n}(\mathrm{jf})\right|$ rolled off sharply (brick-wall type) at $f_{B}$, then $f_{H}$ would coincide with $f_{B}$ itself. However, because the rolloff is gradual (1st order), the noise above $f_{B}$ provides an additional contribution of $57 \%$.

- Brick-Wall Equivalent for Flicker Noise. Assuming $e_{n i}^{2}(f)=K I / f$, we again combine Eqs. (7.134) and (7.135) and obtain (see Problem 7.74)

$$
E_{n o}=A_{n 0} \sqrt{\int_{f_{L}}^{\infty} \frac{K I d f}{f\left[1+\left(f / f_{B}\right)^{2}\right]}}=A_{n 0} \sqrt{K I \ln \frac{f_{B} \sqrt{1+\left(f_{L} / f_{B}\right)^{2}}}{f_{L}}}=A_{n 0} \sqrt{K I \ln \frac{f_{H}}{f_{L}}}
$$

where

$$
\begin{equation*}
f_{H}=f_{B} \sqrt{1+\left(f_{L} / f_{B}\right)^{2}} \tag{7.138}
\end{equation*}
$$

In words, passing above- $f_{L}$-flicker-noise through a 1 st-order low-pass filter with $-3-\mathrm{dB}$ of $f_{B}$ is equivalent to passing it through a brick-wall filter with a cutoff frequency of $f_{H}$ as given above. Situations of practical interest are such that $f_{L} \ll f_{B}$, so we approximate the above expression as

$$
\begin{equation*}
f_{H} \cong f_{B} \tag{7.139}
\end{equation*}
$$

(a) A $p n$ junction with $r_{S} \cong 0, K=5 \times 10^{-17} \mathrm{~A}$, and $a=1$ is forward-biased at $I_{D}$ $=100 \mu \mathrm{~A}$ by means of a noiseless current source. Find the rms noise voltage $E_{n}$ across its terminals from 0.1 Hz to 1 MHz .
(b) Find a capacitance $C$ that, when placed across its terminals, will limit $E_{n}$ to $1.0 \mu \mathrm{~V} \mathrm{rms}$.

### Solution

(a) By Eq. $(7.131 a)$ we have

$$
\begin{aligned}
i_{n d}^{2} & =2 \times 1.602 \times 10^{-19} \times 100 \times 10^{-6}+\frac{5 \times 10^{-17} \times 100 \times 10^{-6}}{f} \\
& =(5.66 \mathrm{pA})^{2}\left(\frac{156}{f}+1\right)
\end{aligned}
$$

The noise voltage across the junction is $e_{n d}=r_{d} i_{n d}$, where $=r_{d}=26 / 0.1=$ $260 \Omega$, so

$$
e_{n d}^{2}=\left(260 \times 5.66 \times 10^{-12}\right)^{2}\left(\frac{156}{f}+1\right)=(1.472 \mathrm{nV})^{2}\left(\frac{156}{f}+1\right)
$$

Using Eq. (7.126) we get

$$
E_{n} \cong(1.472 \mathrm{nV}) \sqrt{156 \ln \left(\frac{10^{6}}{0.1}\right)+10^{6}} \cong(1.472 \mathrm{nV}) \sqrt{10^{6}}=1.47 \mu \mathrm{~V} \mathrm{rms}
$$

indicating that flicker noise is negligible in this case.
(b) Placing a capacitor $C$ in parallel with the junction establishes a pole frequency at $f_{B}=1 /\left(2 \pi r_{d} C\right)$. Since flicker noise is negligible, we impose

$$
(1.472 \mathrm{nV}) \sqrt{1.57 f_{B}}=1.0 \mu \mathrm{~V}
$$

to obtain $f_{B}=294 \mathrm{kHz}$. Finally, $C=1 /\left(2 \pi r_{d} f_{B}\right)=1 /(2 \pi \times 260 \times 294 \times$ $\left.10^{3}\right) \cong 2.1 \mathrm{nF}$.

### An Op Amp Circuit Example

The op amp circuit of Fig. 7.104a is a classic benchmark for noise calculations. No input signals are shown, so whatever emerges from the output is just noise. (The circuit is fairly general in that, depending on where we apply the input or inputs, it could be an inverting amplifier, a noninverting amplifier, a summing or a difference amplifier, a buffer, an I-V converter, and so forth.) We wish to find the total output noise $E_{n o}$ assuming an op amp with a constant GBP product of $f_{t}$ and the spectral densities of Eq. 7.126. To this end we redraw the circuit as in Fig. 7.104b, showing all noise sources explicitly. Since the op amp is a differential-input device, both noise currents $i_{n n}$ and $i_{n p}$ must be shown (however, the individual noise voltages are lumped together into a single source $e_{n}$ in series with just one of the inputs). Additionally, we must show the noise of each resistor (we use either the series or the parallel model, depending on which one makes the calculations easier). Next, we combine the effects of all sources into a single input source $e_{n i}$ as shown in Fig. 7.104c. Finally, we apply Eq. (7.134) to find $E_{n o}$.

The feedback factor is $\beta=R_{1} /\left(R_{1}+R_{2}\right)$, so $A_{n 0}=1 / \beta$ and $f_{B}=\beta f_{i}$, or

$$
\begin{equation*}
A_{n 0}=1+\frac{R_{2}}{R_{1}} \quad f_{B}=\frac{f_{t}}{1+R_{2} / R_{1}} \tag{7.140}
\end{equation*}
$$

To find the contributions to $e_{n i}$ by $e_{3}, e_{n}$, and $i_{n p}$, we observe that $R_{3}$ and $i_{n p}$ produce the noise voltage $R_{3} i_{n p}$, so their power densities combine as

$$
e_{3}^{2}+e_{n}^{2}+R_{3}^{2} i_{n p}^{2}=4 k T R_{3}+e_{n}^{2}+R_{3}^{2} i_{n p}^{2}
$$

where Eq. (7.128) has been used. To find the contributions to $e_{n i}$ by $i_{1}, i_{2}$, and $i_{n n}$, set $e_{3}, e_{n}$, and $i_{n p}$ to zero. This forces the inverting node to virtual ground, causing
![](https://cdn.mathpix.com/cropped/2024_11_07_d01a6e6b2a212ec54522g-04.jpg?height=672&width=1520&top_left_y=1371&top_left_x=123)

FIGURE 7.104 (a) Generalized resistive-type op amp circuit. (b) Redrawing the circuit with all noise sources explicitly shown. (c) Noise model after all sources have been combined into a single noise voltage $e_{n}$.
$i_{1}, i_{2}$, and $i_{n n}$ to flow through $R_{2}$ and thus yield the power density $R_{2}^{2}\left(i_{1}^{2}+i_{2}^{2}+i_{n n}^{2}\right)$ at the output. To find its contribution to $e_{n i}$, we must reflect the output power density to the noninverting input by dividing it by $A_{n 0}^{2}$. So, the contributions by $i_{1}, i_{2}$, and $i_{n n}$ are

$$
\begin{aligned}
\frac{R_{2}^{2}\left(i_{1}^{2}+i_{2}^{2}+i_{n n}^{2}\right)}{A_{n 0}^{2}} & =\frac{R_{2}^{2}\left(i_{1}^{2}+i_{2}^{2}+i_{n n}^{2}\right)}{\left(1+R_{2} / R_{1}\right)^{2}}=\left(R_{1} / / R_{2}\right)^{2}\left(i_{1}^{2}+i_{2}^{2}+i_{n n}^{2}\right) \\
& =4 k T\left(R_{1} / / R_{2}\right)+\left(R_{1} / / R_{2}\right)^{2} i_{n n}^{2}
\end{aligned}
$$

where Eq. (7.128) has been used again. Combining all contributions gives the total input power density

$$
\begin{equation*}
e_{n i}^{2}=4 k T\left[R_{3}+\left(R_{1} / / R_{2}\right)\right]+e_{n}^{2}+R_{3}^{2} i_{n p}^{2}+\left(R_{1} / / R_{2}\right)^{2} i_{n n}^{2} \tag{7.141}
\end{equation*}
$$

Finally, we substitute into Eq. (7.134) and write

$$
\begin{equation*}
E_{n o}=\sqrt{E_{r}^{2}+E_{n}^{2}+E_{n p}^{2}+E_{n n}^{2}} \tag{7.142}
\end{equation*}
$$

where $E_{r}, E_{n}, E_{n p}$ and $E_{n n}$ represent, respectively, the noise contributions by the resistances, $e_{n}, i_{n p}$, and $i_{n n}$. Applying Eq. (7.126) with $\mathrm{NEB}_{\text {white }}=1.57 f_{B}$ and $\mathrm{NEB}_{\text {flicker }} \cong f_{B}$, and ignoring $f_{L}$ compared to $1.57 f_{B}$, gives

$$
\begin{align*}
E_{r} & \cong A_{n 0} \sqrt{4 k T\left[R_{3}+\left(R_{1} / / R_{2}\right)\right] \times 1.57 f_{B}}  \tag{7.143a}\\
E_{n} & \cong A_{n 0} e_{n w} \sqrt{f_{c e} \ln \frac{f_{B}}{f_{L}}+1.57 f_{B}}  \tag{7.143b}\\
E_{n p} & \cong A_{n 0} R_{3} i_{n p w} \sqrt{f_{c i p} \ln \frac{f_{B}}{f_{L}}+1.57 f_{B}}  \tag{7.143c}\\
E_{n n} & \cong A_{n 0}\left(R_{1} / / R_{2}\right) i_{n n w} \sqrt{f_{c i n} \ln \frac{f_{B}}{f_{L}}+1.57 f_{B}} \tag{7.143d}
\end{align*}
$$

The above derivations for voltage-type amplifiers are easily generalized to other amplifier types such as current, transresistance, and transconductance amplifiers (see the end-of-chapter problems).
(a) If the circuit of Fig. 7.104 uses a 741 op amp with $R_{1}=20 \mathrm{k} \Omega, R_{2}=180 \mathrm{k} \Omega$, and $R_{3}=18 \mathrm{k} \Omega$, find the rms output noise above 0.1 Hz . Compare the different noise components and comment.
(b) What happens if all resistances are simultaneously scaled to one-tenth of their original value? How would you scale the resistances in order to minimize output noise? What would the minimum be?

### Solution

(a) We have $A_{n 0}=1+180 / 20=10 \mathrm{~V} / \mathrm{V}$ and $f_{B}=10^{6} / 10=10^{5} \mathrm{~Hz}$. Using Eq. (7.143) with the data of Eq. (7.127), and then substituting into Eq. (7.142), we find

$$
\begin{aligned}
& E_{r}= 10 \sqrt{4 \times 1.38 \times 10^{-23} \times 300 \times(18+18) 10^{3} \times 1.57 \times 10^{5}} \\
&= 96.7 \mu \mathrm{~V} \mathrm{rms} \\
& E_{n}= 10 \times 20 \times 10^{-9} \sqrt{200 \times \ln \frac{10^{5}}{0.1}+1.57 \times 10^{5}}=79.9 \mu \mathrm{~V} \mathrm{rms} \\
& E_{n p}= E_{n n}=10 \times 18 \times 10^{3} \times 0.5 \\
& \quad \times 10^{-12} \sqrt{2 \times 10^{3} \times \ln \frac{10^{5}}{0.1}+1.57 \times 10^{5}}=38.7 \mu \mathrm{~V} \mathrm{rms} \\
& \\
& E_{n o}= \sqrt{96.7^{2}+79.9^{2}+2 \times 38.7^{2}} \cong 137 \mu \mathrm{~V} \mathrm{rms}
\end{aligned}
$$

It is apparent that resistor noise dominates in this circuit, followed by op amp voltage noise, in turn followed by op amp current noise.
(b) Reducing all resistances to $1 / 10$ of their original values leaves $A_{n 0}, f_{B}$, and $E_{n}$ unchanged while reducing both $E_{n p}$ and $E_{n n}$ to $1 / 10$, or to $3.87 \mu \mathrm{~V} \mathrm{rms}$, which is negligible compared to $E_{n}$. However, because of the square-root dependence, $E_{r}$ is reduced only to $1 / \sqrt{10}$, or to $96.7 / \sqrt{10}=30.6 \mu \mathrm{~V} \mathrm{rms}$, giving $E_{n o} \cong \sqrt{30.6^{2}+79.9^{2}} \cong 85 \mu \mathrm{~V} \mathrm{rms}$. We can minimize noise by scaling all resistances further, until the condition $E_{r} \ll E_{n}$ is met, at which point $E_{n o} \cong$ $E_{n} \cong 80 \mu \mathrm{~V} \mathrm{rms}$. Of course, the price for smaller resistances is an increase in power dissipation.

High-gain amplifiers such as op amps and voltage comparators utilize a differential pair as the input stage. Since its noise adds directly to the useful input signals, its noise performance is usually critical (by contrast, a subsequent stage tends to be less critical because its noise, reflected to the input, gets divided by the gains of the preceding stages, as discussed in Section 7.2). It is therefore appropriate that we investigate the noise performance of differential pairs in detail.

### Noise in CMOS Differential Stages

We wish to model the noise characteristics of a CMOS differential stage with a single input source $e_{n}$ as in Fig. 7.105a, given the individual noise sources of Fig. 7.105b. To find $e_{n}$, we first calculate the short-circuit noise current $i_{n o}$ at the output, then we divide it by the circuit's transconductance $g_{m}$ to reflect it to the input and thus get $e_{n}=i_{n o} / g_{m}$. We use the superposition principle to find the power density contribution by each FET acting alone and then we add up all contributions to obtain $i_{n o}^{2}$.

By inspection, the contributions to $i_{n o}^{2}$ by $M_{1}$ and $M_{2}$ are, respectively, $g_{m 1}^{2} e_{n 1}^{2}$ and $g_{m 2}^{2} e_{n 2}^{2}$ (note that polarity inversion by one of the inputs is inconsequential because of the randomness of noise). Next, we find the contributions by $M_{3}$ and $M_{4}$ by setting
![](https://cdn.mathpix.com/cropped/2024_11_07_d01a6e6b2a212ec54522g-07.jpg?height=680&width=1379&top_left_y=205&top_left_x=198)

FIGURE 7.105 (a) Noise model of an active-loaded CMOS differential stage (all FETs in the model are assumed noiseless). (b) Noise circuit to find the individual FET contribution to the output noise current $i_{n o}$.
$e_{n 1}=e_{n 2}=e_{n 5}=0$. These conditions place $M_{3}$ 's gate at ac ground, so $M_{3}$ does not contribute noise directly. Rather, it contributes indirectly via $M_{4}$ because $e_{n 3}$ appears in series with $e_{n 4}$ and $e_{n 3}$ is referenced to ac ground. Consequently, $M_{4}$ contributes to $i_{n o}^{2}$ the power density $g_{m 4}^{2}\left(e_{n 3}^{2}+e_{n 4}^{2}\right)$. Finally, we observe that $e_{n 5}$ appears as a common-mode signal, so in a well-designed differential pair its contribution tends to be negligible compared to the others because the common-mode gain is usually very small. Summarizing, we have

$$
\begin{aligned}
i_{n o}^{2} & =g_{m 1}^{2} e_{n 1}^{2}+g_{m 2}^{2} e_{n 2}^{2}+g_{m 4}^{2}\left(e_{n 3}^{2}+e_{n 4}^{2}\right)=g_{m p}^{2}\left(e_{n p}^{2}+e_{n p}^{2}\right)+g_{m n}^{2}\left(e_{n n}^{2}+e_{n n}^{2}\right) \\
& =2\left(g_{m p}^{2} e_{n p}^{2}+g_{m n}^{2} e_{n n}^{2}\right)
\end{aligned}
$$

where the subscripts have been changed to $p$ and $n$ to identify $p$-channel and $n$-channel parameters. Dividing $i_{n o}^{2}$ by $g_{m p}^{2}$ reflects it to the input, giving

$$
e_{n}^{2}=2\left(e_{n p}^{2}+\frac{g_{m n}^{2}}{g_{m p}^{2}} e_{n n}^{2}\right)
$$

Combining with Eq. (7.133b) we obtain the more explicit expression

$$
e_{n}^{2}=2\left[\frac{K_{p}}{W_{p} L_{p} C_{o x} f}+4 k T_{\frac{2}{3}} \frac{1}{g_{m p}}+\frac{g_{m n}^{2}}{g_{m p}^{2}}\left(\frac{K_{n}}{W_{n} L_{n} C_{o x} f}+4 k T \frac{2}{3} \frac{1}{g_{m n}}\right)\right]
$$

where $K_{p}$ and $K_{n}$ are the flicker-noise coefficients of the $p$-type and $n$-type FETs. Regrouping terms and using $g_{m n}^{2} / g_{m p}^{2}=\left(2 k_{n} I_{D n}\right) /\left(2 k_{p} I_{D p}\right)=k_{n} / k_{p}=\left(\mu_{n} W_{n} / L_{n}\right) /\left(\mu_{p} W_{p} / L_{p}\right)$, we put the above expression in the more insightful form

$$
\begin{equation*}
e_{n}^{2}=e_{n(\text { thermal) }}^{2}+e_{n(\text { ficker })}^{2} \tag{7.144}
\end{equation*}
$$

where the term

$$
\begin{equation*}
e_{n \text { (thermal) }}^{2}=\frac{16}{3} k T \frac{1}{g_{m p}}\left(1+\frac{g_{m n}}{g_{m p}}\right) \tag{7.145}
\end{equation*}
$$

represents the thermal component of $e_{n}^{2}$, and the term

$$
\begin{equation*}
e_{n \text { (ficker) }}^{2}=\frac{2 K_{p}}{W_{p} L_{p} C_{o x} f}\left(1+\frac{K_{n}}{K_{p}} \frac{\mu_{n}}{\mu_{p}} \frac{L_{p}^{2}}{L_{n}^{2}}\right) \tag{7.146}
\end{equation*}
$$

represents the flicker component. We make the following observations:

- The term $(16 / 3) k T / g_{m p}$ in Eq. (7.145) represents the thermal noise of the differential pair acting alone.
- The presence of the active load augments this noise by the ratio $g_{m n} / g_{m p}$. For instance, if $g_{m n} / g_{m p}=1$, the presence of the load doubles the power density of the differential pair.
- Designing for $g_{m p} \gg g_{m n}$ will minimize the effect of the load, making $e_{n \text { (thermal })}^{2}$ approach the thermal noise of only the differential pair.
- If desirable, we can reduce the differential-pair noise by designing for a suitably large $g_{m p}$.
- The term $2 K_{p} /\left(W_{p} L_{p} C_{o x} f\right)$ in Eq. (7.146) represents the flicker noise of the differential pair alone.
- The presence of the active load augments this noise by the ratio $\left(K_{n} \mu_{n} L_{p}^{2}\right) /\left(K_{p} \mu_{p} L_{n}^{2}\right)$. (Interestingly, this augmentation depends only on the channel lengths, regardless of the channel widths.)
- Designing for $K_{p} \mu_{p} L_{n}^{2} \gg K_{n} \mu_{n} L_{p}^{2}$ will minimize the effect of the load, in turn making $e_{n \text { (ficker })}^{2}$ approach the flicker noise of only the differential pair.
- If desirable, we can reduce the differential-pair noise by designing for a suitably large area $W_{p} L_{p}$.

### Noise in Bipolar Differential Pairs

We wish to find an expression for the sources modeling the noise characteristics of the bipolar differential pair of Fig. 7.106 $a$. To find the short-circuit noise $e_{n}$, refer to the circuit of Fig. 7.106b, whose inputs have been grounded to blank out the noise currents and leave active only the noise voltages. Assuming $r_{o} \gg R_{C}$, the voltage noise gain is $g_{m} R_{C}$, so we write, by inspection,

$$
e_{n o}^{2}=g_{m 1}^{2} R_{C}^{2} e_{n 1}^{2}+g_{m 2}^{2} R_{C}^{2} e_{n 2}^{2}+e_{r 1}^{2}+e_{r 2}^{2}=2\left[g_{m}^{2} R_{C}^{2} e_{n 1}^{2}+4 k T R_{C}\right]
$$

having ignored the source $e_{n 3}$ because of the high CMRR of this circuit. Reflecting $e_{n o}^{2}$ to the input gives

$$
e_{n}^{2}=\frac{e_{n o}^{2}}{g_{m}^{2} R_{C}^{2}}=2\left[e_{n 1}^{2}+\frac{4 k T}{g_{m}^{2} R_{C}}\right]
$$

Substituting the expression of Eq. (7.132a) for $e_{n 1}^{2}$ we get, after minor algebra,

$$
e_{n}^{2}=2\left[4 k T\left(r_{b}+\frac{1}{2 g_{m}}+\frac{1}{\left(g_{m} R_{C}\right) g_{m}}\right)\right]
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_d01a6e6b2a212ec54522g-09.jpg?height=752&width=1563&top_left_y=171&top_left_x=181)

FIGURE 7.106 (a) Noise model of a resistive-loaded bipolar differential pair (the transistors and resistors in the model are assumed noiseless). Noise circuits to find (a) $e_{n}$ and (b) $i_{n n}$ and $i_{n p}$.

But a well-designed differential amplifier has $g_{m} R_{C} \gg 2$, so the above expression reduces to

$$
\begin{equation*}
e_{n}^{2} \cong 2 \times 4 k T\left(r_{b}+\frac{1}{2 g_{m}}\right)=2 e_{n b}^{2} \tag{7.147}
\end{equation*}
$$

It is apparent that the noise of the resistive load tends to play an insignificant role, though this is not necessarily true in the case of an active load (see Problem 7.85).

To find the open-circuit noise currents $i_{n n}$ and $i_{n p}$, refer to the circuit of Fig. 7.106c, whose inputs have been left floating to blank out the effect of the noise voltages and enable only that of the noise currents. We find $i_{n n}$ by reflecting $i_{r 1}$ to $Q_{1}$ 's base and then combining it with $i_{n 1}$. Since the current noise gain is $\left|\beta_{0}(j f)\right|$, we get

$$
i_{n n}^{2}=i_{n 1}^{2}+\frac{i_{r 1}^{2}}{\left|\beta_{0}(j f)\right|^{2}}=i_{n 1}^{2}+\frac{4 k T / R_{C}}{\left|\beta_{0}(j f)\right|^{2}}
$$

Substituting the expression of Eq. (7.132b) for $i_{n 1}^{2}$ we get

$$
\begin{equation*}
i_{n n}^{2}=2 q\left(I_{B}+\frac{K I_{B}^{a}}{f}+\frac{I_{C}}{\left|\beta_{0}(j f)\right|^{2}}\right)+\frac{4 k T / R_{C}}{\left|\beta_{0}(j f)\right|^{2}}=2 q\left(I_{B}+\frac{K I_{B}^{a}}{f}+\frac{I_{C}+2 V_{T} / R_{C}}{\left|\beta_{0}(j f)\right|^{2}}\right) \cong i_{n b}^{2} \tag{7.148}
\end{equation*}
$$

having exploited the fact that in a well-designed differential circuit the condition $R_{C} I_{C} \gg 2 V_{T}$ holds. It is apparent that the noise of a resistive load plays an insignificant role also in the case of current noise. By symmetry, similar considerations hold for $i_{n p}$, so we summarize by writing

$$
\begin{equation*}
i_{n p}^{2}=i_{n n}^{2} \cong 2 q\left(I_{B}+\frac{K I_{B}^{a}}{f}+\frac{I_{C}}{\left|\beta_{0}(j f)\right|^{2}}\right) \tag{7.149}
\end{equation*}
$$

This completes the noise analysis of the bipolar pair.

### SPICE Simulation of Noise

Used judiciously, SPICE is a powerful tool for noise analysis. As an example, let us use PSpice to verify the pn junction calculations of Example 7.41. SPICE calculates diode noise as

$$
\begin{equation*}
i_{n d}^{2}(f)=\mathrm{KF} \frac{I_{D}^{\mathrm{AF}}}{f}+2 q I_{D} \tag{7.150}
\end{equation*}
$$

where KF is the flicker noise coefficient and AF the exponent. These parameters must be specified in the device's .model statement, as exemplified for the following homebrew diode called Dnoise

```
.model Dnoise D(Is=2fA n=1 KF=5E-17 AF=1)
```

To obtain the noise plots we must direct SPICE to perform the ac analysis with the noise analysis enabled. Noise analysis requires that we specify the Output Vol tage and the I/V Source. For the example of Fig. 7.107a these are, respectively, V (vD) and ID. After running PSpice we specify the trace V(ONOISE) to display $e_{n d}$, and the trace SQRT ( $\mathrm{S}(\mathrm{V}(\mathrm{ONOISE}) * \mathrm{~V}(\mathrm{ONOISE}))$ ) to display $E_{n}$.

The results of the simulation, shown in Fig. 7.107b, confirm that the value of $E_{n}$ strongly depends on our choice of $f_{H}$. For $f_{H}=1 \mathrm{MHz}$ PSpice gives $E_{n}=1.466 \mu \mathrm{~V}$ rms , in excellent agreement with hand calculations. Placing a $2.1-\mathrm{nF}$ capacitance in parallel with the diode filters out high-frequency noise, causing $E_{n}$ to settle asymptotically to $1.0 \mu \mathrm{~V} \mathrm{rms}$, as desired.
![](https://cdn.mathpix.com/cropped/2024_11_07_d01a6e6b2a212ec54522g-10.jpg?height=341&width=595&top_left_y=1647&top_left_x=280)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_d01a6e6b2a212ec54522g-10.jpg?height=727&width=733&top_left_y=1271&top_left_x=904)
(b)

FIGURE 7.107 (a) PSpice circuit to plot the noise characteristics of the diode of Example 7.41. (b) Frequency plots of the noise voltage $e_{n d}(t o p)$ and the rms voltage $E_{n}$ (bottom).
