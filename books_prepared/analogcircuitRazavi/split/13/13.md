# Feedback

Feedback is an integral part of our lives. Try touching your fingertips together with your eyes closed; you may not succeed the first time because you have broken a feedback loop that ordinarily "regulates" your motions. The regulatory role of feedback manifests itself in biological, mechanical, and electronic systems, allowing precise realization of "functions." For example, an amplifier targeting a precise gain of 2.00 is designed much more easily with feedback than without.

This chapter deals with the fundamentals of (negative) feedback and its application to electronic circuits. The outline is shown below.

General Considerations

- Elements of Feedback Systems
- Loop Gain
- Properties of Negative Feedback

Amplifiers and Sense/Return
Methods
- Types of Amplifiers
- Amplifier Models
- Sense/Return Methods
- Polarity of Feedback

## 12.1 GENERAL CONSIDERATIONS

As soon as he reaches the age of 18 , John eagerly obtains his driver's license, buys a used car, and begins to drive. Upon his parents' stern advice, John continues to observe the speed limit while noting that every other car on the highway drives faster. He then reasons that the speed limit is more of a "recommendation" and exceeding it by a small amount would not be harmful. Over the ensuing months, John gradually raises his speed so as to catch up with the rest of the drivers on the road, only to see flashing lights in his rear-view mirror one day. He pulls over to the shoulder of the road, listens to the sermon given by the police officer, receives a speeding ticket, and, dreading his parents' reaction, drives home-now strictly adhering to the speed limit.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-32.jpg?height=874&width=1639&top_left_y=682&top_left_x=1475)

Figure 12.1 General feedback system.

John's story exemplifies the "regulatory" or "corrective" role of negative feedback. Without the police officer's involvement, John would probably continue to drive increasingly faster, eventually becoming a menace on the road.

Shown in Fig. 12.1, a negative feedback system consists of four essential components. (1) The "feedforward" system: ${ }^{1}$ the main system, probably "wild" and poorly controlled. John, the gas pedal, and the car form the feedforward system, where the input is the amount of pressure that John applies to the gas pedal and the output is the speed of the car. (2) Output sense mechanism: a means of measuring the output. The police officer's radar serves this purpose here. (3) Feedback network: a network that generates a "feedback signal," $X_{F}$, from the sensed output. The police officer acts as the feedback network by reading the radar display, walking to John's car, and giving him a speeding ticket. The quantity $K=X_{F} / Y$ is called the "feedback factor." (4) Comparison or return mechanism: a means of subtracting the feedback signal from the input to obtain the "error," $E=X-X_{F}$. John makes this comparison himself, applying less pressure to the gas pedal-at least for a while.

The feedback in Fig. 12.1 is called "negative" because $X_{F}$ is subtracted from $X$. Positive feedback, too, finds application in circuits such as oscillators and digital latches. If $K=0$, i.e., no signal is fed back, then we obtain the "open-loop" system. If $K \neq 0$, we say the system operates in the "closed-loop" mode. As seen throughout this chapter, analysis of a feedback system requires expressing the closed-loop parameters in terms of the open-loop parameters. Note that the input port of the feedback network refers to that sensing the output of the forward system.

As our first step towards understanding the feedback system of Fig. 12.1, let us determine the closed-loop transfer function $Y / X$. Since $X_{F}=K Y$, the error produced by the subtractor is equal to $X-K Y$, which serves as the input of the forward system:

$$
\begin{equation*}
(X-K Y) A_{1}=Y \tag{12.1}
\end{equation*}
$$

That is,

$$
\begin{equation*}
\frac{Y}{X}=\frac{A_{1}}{1+K A_{1}} . \tag{12.2}
\end{equation*}
$$

This equation plays a central role in our treatment of feedback, revealing that negative feedback reduces the gain from $A_{1}$ (for the open-loop system) to $A_{1} /\left(1+K A_{1}\right)$.

[^11]The quantity $A_{1} /\left(1+K A_{1}\right)$ is called the "closed-loop gain." Why do we deliberately lower the gain of the circuit? As explained in Section 12.2, the benefits accruing from negative feedback very well justify this reduction of the gain.

Example 12.1

Analyze the noninverting amplifier of Fig. 12.2 from a feedback point of view.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-33.jpg?height=583&width=691&top_left_y=1141&top_left_x=2052)

Figure 12.2

Solution The op amp $A_{1}$ performs two functions: subtraction of $X$ and $X_{F}$ and amplification. The network $R_{1}$ and $R_{2}$ also performs two functions: sensing the output voltage and providing a feedback factor of $K=R_{2} /\left(R_{1}+R_{2}\right)$. Thus, Eq. (12.2) gives

$$
\begin{equation*}
\frac{Y}{X}=\frac{A_{1}}{1+\frac{R_{2}}{R_{1}+R_{2}} A_{1}} \tag{12.3}
\end{equation*}
$$

which is identical to the result obtained in Chapter 8.

Exercise $\quad$ Perform the above analysis if $R_{2}=\infty$.

It is instructive to compute the error, $E$, produced by the subtractor. Since $E=X-X_{F}$ and $X_{F}=K A_{1} E$,

$$
\begin{equation*}
E=\frac{X}{1+K A_{1}} \tag{12.4}
\end{equation*}
$$

suggesting that the difference between the feedback signal and the input diminishes as $K A_{1}$ increases. In other words, the feedback signal becomes a close "replica" of the input (Fig. 12.3). This observation leads to a great deal of insight into the operation of feedback systems.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-33.jpg?height=606&width=1092&top_left_y=4229&top_left_x=1840)

Figure 12.3 Feedback signal as a good replica of the input.

Example
12.2 $\begin{aligned} & \text { Explain why in the circuit of Fig. 12.2, } Y / X \text { approaches } 1+R_{1} / R_{2} \text { as }\left[R_{2} /\left(R_{1}+R_{2}\right)\right] A_{1} \\ & \text { becomes much greater than unity. }\end{aligned}$ becomes much greater than unity.

Solution If $K A_{1}=\left[R_{2} /\left(R_{1}+R_{2}\right)\right] A_{1}$ is large, $X_{F}$ becomes almost identical to $X$, i.e., $X_{F} \approx X$. The voltage divider therefore requires that

$$
\begin{equation*}
Y \frac{R_{2}}{R_{1}+R_{2}} \approx X \tag{12.5}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{Y}{X} \approx 1+\frac{R_{1}}{R_{2}} \tag{12.6}
\end{equation*}
$$

Of course, Eq. (12.3) yields the same result if $\left[R_{2} /\left(R_{1}+R_{2}\right)\right] A_{1} \gg 1$.
Exercise $\quad$ Repeat the above example if $R_{2}=\infty$.

### 12.1.1 Loop Gain

In Fig. 12.1, the quantity $K A_{1}$, which is equal to product of the gain of the forward system and the feedback factor, determines many properties of the overall system. Called the "loop gain," $K A_{1}$ has an interesting interpretation. Let us set the input $X$ to zero and "break" the loop at an arbitrary point, e.g., as depicted in Fig. 12.4(a).
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-34.jpg?height=834&width=2210&top_left_y=2580&top_left_x=1190)

Figure 12.4 Computation of the loop gain by (a) breaking the loop and (b) applying a test signal.
The resulting topology can be viewed as a system with an input $M$ and an output $N$. Now, as shown in Fig. 12.4(b), let us apply a test signal at $M$ and follow it through the feedback network, the subtractor, and the forward system to obtain the signal at $N .^{2}$ The input of $A_{1}$ is equal to $-K V_{\text {test }}$, yielding

$$
\begin{equation*}
V_{N}=-K V_{\text {test }} A_{1} \tag{12.7}
\end{equation*}
$$

and hence

$$
\begin{equation*}
K A_{1}=-\frac{V_{N}}{V_{\text {test }}} \tag{12.8}
\end{equation*}
$$

In other words, if a signal "goes around the loop," it experiences a gain equal to $-K A_{1}$; hence the term "loop gain." It is important not to confuse the closed-loop gain, $A_{1} /\left(1+K A_{1}\right)$, with the loop gain, $K A_{1}$.

[^12]Example Compute the loop gain of the feedback system of Fig. 12.1 by breaking the loop at the 12.3 input of $A_{1}$.

Solution Illustrated in Fig. 12.5 is the system with the test signal applied to the input of $A_{1}$. The output of the feedback network is equal to $K A_{1} V_{\text {test }}$, yielding

$$
\begin{equation*}
V_{N}=-K A_{1} V_{\text {test }} \tag{12.9}
\end{equation*}
$$

and hence the same result as in Eq. (12.8).
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-35.jpg?height=602&width=1351&top_left_y=1263&top_left_x=1710)

Figure 12.5
Exercise Compute the loop gain by breaking the loop at the input of the subtractor.

The reader may wonder if an ambiguity exists with respect to the direction of the signal flow in the loop gain test. For example, can we modify the topology of Fig. 12.4(b) as shown in Fig. 12.6? This would mean applying $V_{\text {test }}$ to the output of $A_{1}$ and expecting to observe a signal at its input and eventually at $N$. While possibly yielding a finite value, such a test does not represent the actual behavior of the circuit. In the feedback system, the signal flows from the input of $A_{1}$ to its output and from the input of the feedback network to its output.

Did you know?

Negative feedback is a common phenomenon in nature. When you enter a bright room, your brain commands your pupils to become smaller. If you listen to very loud music for several hours, you feel hard of hearing afterwards because your ear has adjusted your hearing threshold in response to the volume. And if you try writing with your eyes closed, your handwriting will not be good because the feedback loop monitoring your pen strokes is broken.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-35.jpg?height=794&width=1074&top_left_y=3827&top_left_x=1843)

Figure 12.6 Incorrect method of applying test signal.

## 12.2 PROPERTIES OF NEGATIVE FEEDBACK

### 12.2.1 Gain Desensitization

Suppose $A_{1}$ in Fig. 12.1 is an amplifier whose gain is poorly controlled. For example, a CS stage provides a voltage gain of $g_{m} R_{D}$ while both $g_{m}$ and $R_{D}$ vary with process and temperature; the gain thus may vary by as much as $\pm 20 \%$. Also, suppose we require a voltage gain of $4.00 .^{3}$ How can we achieve such precision? Equation (12.2) points to a potential solution: if $K A_{1} \gg 1$, we have

$$
\begin{equation*}
\frac{Y}{X} \approx \frac{1}{K} \tag{12.10}
\end{equation*}
$$

a quantity independent of $A_{1}$. From another perspective, Eq. (12.4) indicates that $K A_{1} \gg 1$ leads to a small error, forcing $X_{F}$ to be nearly equal to $X$ and hence $Y$ nearly equal to $X / K$. Thus, if $K$ can be defined precisely, then $A_{1}$ impacts $Y / X$ negligibly and a high precision in the gain is attained. The circuit of Fig. 12.2 exemplifies this concept very well. If $A_{1} R_{2} /\left(R_{1}+R_{2}\right) \gg 1$, then

$$
\begin{align*}
\frac{Y}{X} & \approx \frac{1}{K}  \tag{12.11}\\
& \approx 1+\frac{R_{1}}{R_{2}} \tag{12.12}
\end{align*}
$$

Why is $R_{1} / R_{2}$ more precisely defined than $g_{m} R_{D}$ is? If $R_{1}$ and $R_{2}$ are made of the same material and constructed identically, then the variation of their value with process and temperature does not affect their ratio. As an example, for a closed-loop gain of 4.00, we choose $R_{1}=3 R_{2}$ and implement $R_{1}$ as the series combination of three "unit" resistors equal to $R_{2}$. Illustrated in Fig. 12.7, the idea is to ensure that $R_{1}$ and $R_{2}$ "track" each other; if $R_{2}$ increases by $20 \%$, so does each unit in $R_{1}$ and hence the total value of $R_{1}$, still yielding a gain of $1+1.2 R_{1} /\left(1.2 R_{2}\right)=4$.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-36.jpg?height=516&width=1157&top_left_y=3230&top_left_x=1722)

Figure 12.7 Construction of resistors for good matching.

The circuit of Fig. 12.2 is designed for a nominal gain of 4. (a) Determine the actual gain 12.4 if $A_{1}=1000$. (b) Determine the percentage change in the gain if $A_{1}$ drops to 500.

Solution For a nominal gain of 4 , Eq. (12.12) implies that $R_{1} / R_{2}=3$. (a) The actual gain is given by

$$
\begin{align*}
\frac{Y}{X} & =\frac{A_{1}}{1+K A_{1}}  \tag{12.13}\\
& =3.984 . \tag{12.14}
\end{align*}
$$

[^13]Note that the loop gain $K A_{1}=1000 / 4=250$. (b) If $A_{1}$ falls to 500 , then

$$
\begin{equation*}
\frac{Y}{X}=3.968 \tag{12.15}
\end{equation*}
$$

Thus, the closed-loop gain changes by only $(3.984 / 3.968) / 3.984=0.4 \%$ if $A_{1}$ drops by factor of 2 .

Exercise Determine the percentage change in the gain if $A_{1}$ falls to 200.

The above example reveals that the closed-loop gain of a feedback circuit becomes relatively independent of the open-loop gain so long as the loop gain, $K A_{1}$, remains sufficiently higher than unity. This property of negative feedback is called "gain desensitization."

We now see why we are willing to accept a reduction in the gain by a factor of $1+K A_{1}$. We begin with an amplifier having a high, but poorly-controlled gain and apply negative feedback around it so as to obtain a better-defined, but inevitably lower gain. This concept was also extensively employed in the op amp circuits described in Chapter 8.

The gain desensitization property of negative feedback means that any factor that influences the open-loop gain has less effect on the closed-loop gain. Thus far, we have blamed only process and temperature variations, but many other phenomena change the gain as well.

- As the signal frequency rises, $A_{1}$ may fall, but $A_{1} /\left(1+K A_{1}\right)$ remains relatively constant. We therefore expect that negative feedback increases the bandwidth (at the cost of gain).
- If the load resistance changes, $A_{1}$ may change; e.g., the gain of a CS stage depends on the load resistance. Negative feedback, on the other hand, makes the gain less sensitive to load variations.
- The signal amplitude affects $A_{1}$ because the forward amplifier suffers from nonlinearity. For example, the large-signal analysis of differential pairs in Chapter 10 reveals that the small-signal gain falls at large input amplitudes. With negative feedback, however, the variation of the open-loop gain due to nonlinearity manifests itself to a lesser extent in the closed-loop characteristics. That is, negative feedback improves the linearity.

We now study these properties in greater detail.

### 12.2.2 Bandwidth Extension

Let us consider a one-pole open-loop amplifier with a transfer function

$$
\begin{equation*}
A_{1}(s)=\frac{A_{0}}{1+\frac{s}{\omega_{0}}} \tag{12.16}
\end{equation*}
$$

Here, $A_{0}$ denotes the low-frequency gain and $\omega_{0}$ the -3 dB bandwidth. Noting from Eq. (12.2) that negative feedback lowers the low-frequency gain by a factor of $1+K A_{1}$, we wish to determine the resulting bandwidth improvement. The closed-loop transfer
function is obtained by substituting Eq. (12.16) for $A_{1}$ in Eq. (12.2):

$$
\begin{equation*}
\frac{Y}{X}=\frac{\frac{A_{0}}{1+\frac{s}{\omega_{0}}}}{1+K \frac{A_{0}}{1+\frac{s}{\omega_{0}}}} \tag{12.17}
\end{equation*}
$$

Multiplying the numerator and the denominator by $1+s / \omega_{0}$ gives

$$
\begin{align*}
\frac{Y}{X}(s) & =\frac{A_{0}}{1+K A_{0}+\frac{s}{\omega_{0}}}  \tag{12.18}\\
& =\frac{\frac{A_{0}}{1+K A_{0}}}{1+\frac{s}{\left(1+K A_{0}\right) \omega_{0}}} \tag{12.19}
\end{align*}
$$

In analogy with Eq. (12.16), we conclude that the closed-loop system now exhibits:

$$
\begin{align*}
\text { Closed-Loop Gain } & =\frac{A_{0}}{1+K A_{0}}  \tag{12.20}\\
\text { Closed-Loop Bandwidth } & =\left(1+K A_{0}\right) \omega_{0} \tag{12.21}
\end{align*}
$$

In other words, the gain and bandwidth are scaled by the same factor but in opposite directions, displaying a constant product.

Example Plot the closed-loop frequency response given by Eq. (12.19) for $K=0,0.1$, and 0.5 . 12.5 Assume $A_{0}=200$.

Solution For $K=0$, the feedback vanishes and $Y / X$ reduces to $A_{1}(s)$ as given by Eq. (12.16). For $K=0.1$, we have $1+K A_{0}=21$, noting that the gain decreases and the bandwidth increases by the same factor. Similarly, for $K=0.5,1+K A_{0}=101$, yielding a proportional reduction in gain and increase in bandwidth. The results are plotted in Fig. 12.8.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-38.jpg?height=749&width=1074&top_left_y=4112&top_left_x=1752)

Figure 12.8

Exercise Repeat the above example for $K=1$.

Example Prove that the unity-gain bandwidth of the above system remains independent of $K$ if 12.6 $1+K A_{0} \gg 1$ and $K^{2} \ll 1$.

Solution The magnitude of Eq. (12.19) is equal to

$$
\begin{equation*}
\left|\frac{Y}{X}(j \omega)\right|=\frac{\frac{A_{0}}{1+K A_{0}}}{\sqrt{1+\frac{\omega^{2}}{\left(1+K A_{0}\right)^{2} \omega_{0}^{2}}}} \tag{12.22}
\end{equation*}
$$

Equating this result to unity and squaring both sides, we write

$$
\begin{equation*}
\left(\frac{A_{0}}{1+K A_{0}}\right)^{2}=1+\frac{\omega_{u}^{2}}{\left(1+K A_{0}\right)^{2} \omega_{0}^{2}} \tag{12.23}
\end{equation*}
$$

where $\omega_{u}$ denotes the unity-gain bandwidth. It follows that

$$
\begin{align*}
\omega_{u} & =\omega_{0} \sqrt{A_{0}^{2}-\left(1+K A_{0}\right)^{2}}  \tag{12.24}\\
& \approx \omega_{0} \sqrt{A_{0}^{2}-K^{2} A_{0}^{2}}  \tag{12.25}\\
& \approx \omega_{0} A_{0} \tag{12.26}
\end{align*}
$$

which is equal to the gain-bandwidth product of the open-loop system. Figure 12.9 depicts the results.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-39.jpg?height=600&width=1154&top_left_y=3005&top_left_x=1809)

Figure 12.9

Exercise If $A_{0}=1000, \omega_{0}=2 \pi \times(10 \mathrm{MHz})$, and $K=0.5$, calculate the unity-gain bandwidth from Eqs. (12.24) and (12.26) and compare the results.

### 12.2.3 Modification of I/O Impedances

As mentioned above, negative feedback makes the closed-loop gain less sensitive to the load resistance. This effect fundamentally arises from the modification of the output impedance as a result of feedback. Feedback modifies the input impedance as well. We will formulate these effects carefully in the following sections, but it is instructive to study an example at this point.

Example
12.7

Figure 12.10 depicts a transistor-level realization of the feedback circuit shown in Fig. 12.2. Assume $\lambda=0$ and $R_{1}+R_{2} \gg R_{D}$ for simplicity. (a) Identify the four components of the feedback system. (b) Determine the open-loop and closed-loop voltage gain. (c) Determine the open-loop and closed-loop I/O impedances.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-40.jpg?height=701&width=757&top_left_y=1042&top_left_x=1922)

Figure 12.10
Solution
(a) In analogy with Fig. 12.10, we surmise that the forward system (the main amplifier) consists of $M_{1}$ and $R_{D}$, i.e., a common-gate stage. Resistors $R_{1}$ and $R_{2}$ serve as both the sense mechanism and the feedback network, returning a signal equal to $V_{\text {out }} R_{2} /\left(R_{1}+R_{2}\right)$ to the subtractor. Transistor $M_{1}$ itself operates as the subtractor because the smallsignal drain current is proportional to the difference between the gate and source voltages:

$$
\begin{equation*}
i_{D}=g_{m}\left(v_{G}-v_{S}\right) \tag{12.27}
\end{equation*}
$$

(b) The forward system provides a voltage gain equal to

$$
\begin{equation*}
A_{0} \approx g_{m} R_{D} \tag{12.28}
\end{equation*}
$$

because $R_{1}+R_{2}$ is large enough that its loading on $R_{D}$ can be neglected. The closed-loop voltage gain is thus given by

$$
\begin{align*}
\frac{v_{\text {out }}}{v_{\text {in }}} & =\frac{A_{0}}{1+K A_{0}}  \tag{12.29}\\
& =\frac{g_{m} R_{D}}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m} R_{D}} \tag{12.30}
\end{align*}
$$

We should note that the overall gain of this stage can also be obtained by simply solving the circuit's equations-as if we know nothing about feedback. However, the use of feedback concepts both provides a great deal of insight and simplifies the task as circuits become more complex.
(c) The open-loop I/O impedances are those of the CG stage:

$$
\begin{align*}
R_{i n, \text { open }} & =\frac{1}{g_{m}}  \tag{12.31}\\
R_{\text {out }, \text { open }} & =R_{D} \tag{12.32}
\end{align*}
$$

At this point, we do not know how to obtain the closed-loop I/O impedances in terms of the open-loop parameters. We therefore simply solve the circuit. From Fig. 12.11(a), we recognize that $R_{D}$ carries a current approximately equal to $i_{X}$ because $R_{1}+R_{2}$ is assumed large. The drain voltage of $M_{1}$ is thus given by $i_{X} R_{D}$,
leading to a gate voltage equal to $+i_{X} R_{D} R_{2} /\left(R_{1}+R_{2}\right)$. Transistor $M_{1}$ generates a drain current proportional to $v_{G S}$ :

$$
\begin{align*}
i_{D} & =g_{m} v_{G S}  \tag{12.33}\\
& =g_{m}\left(\frac{+i_{X} R_{D} R_{2}}{R_{1}+R_{2}}-v_{X}\right) \tag{12.34}
\end{align*}
$$

Since $i_{D}=-i_{X}$, Eq. (12.34) yields

$$
\begin{equation*}
\frac{v_{X}}{i_{X}}=\frac{1}{g_{m}}\left(1+\frac{R_{2}}{R_{1}+R_{2}} g_{m} R_{D}\right) . \tag{12.35}
\end{equation*}
$$

That is, the input resistance increases from $1 / g_{m}$ by a factor equal to $1+$ $g_{m} R_{D} R_{2} /\left(R_{1}+R_{2}\right)$, the same factor by which the gain decreases.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-41.jpg?height=812&width=823&top_left_y=1826&top_left_x=1415)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-41.jpg?height=691&width=874&top_left_y=1818&top_left_x=2508)
(b)

Figure 12.11

To determine the output resistance, we write from Fig. 12.11(b),

$$
\begin{equation*}
v_{G S}=\frac{R_{2}}{R_{1}+R_{2}} v_{X} \tag{12.36}
\end{equation*}
$$

and hence

$$
\begin{align*}
i_{D} & =g_{m} v_{G S}  \tag{12.37}\\
& =g_{m} \frac{R_{2}}{R_{1}+R_{2}} v_{X} \tag{12.38}
\end{align*}
$$

Noting that, if $R_{1}+R_{2} \gg R_{D}$, then $i_{X} \approx i_{D}+v_{X} / R_{D}$, we obtain

$$
\begin{equation*}
i_{X} \approx g_{m} \frac{R_{2}}{R_{1}+R_{2}} v_{X}+\frac{v_{X}}{R_{D}} . \tag{12.39}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
\frac{v_{X}}{i_{X}}=\frac{R_{D}}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m} R_{D}} \tag{12.40}
\end{equation*}
$$

The output resistance thus decreases by the "universal" factor $1+g_{m} R_{D} R_{2} /\left(R_{1}+R_{2}\right)$.

The above computation of I/O impedances can be greatly simplified if feedback concepts are employed. As exemplified by Eqs. (12.35) and (12.40), the factor $1+K A_{0}=1+g_{m} R_{D} R_{2} /\left(R_{1}+R_{2}\right)$ plays a central role here. Our treatment of feedback circuits in this chapter will provide the foundation for this point.

Exercise In some applications, the input and output impedances of an amplifier must both be equal to $50 \Omega$. What relationship guarantees that the input and output impedances of the above circuit are equal?

The reader may raise several questions at this point. Do the input impedance and the output impedance always scale down and up, respectively? Is the modification of I/O impedances by feedback desirable? We consider one example here to illustrate a point and defer more rigorous answers to subsequent sections.
$\begin{array}{cl}\text { Example } & \begin{array}{l}\text { The common-gate stage of Fig. } 12.10 \text { must drive a load resistance } \\ \text { does the gain change (a) without feedback, (b) with feedback? }\end{array}\end{array}$ does the gain change (a) without feedback, (b) with feedback?

Solution (a) Without feedback [Fig. 12.12(a)], the CG gain is equal to $g_{m}\left(R_{D} \| R_{L}\right)=g_{m} R_{D} / 3$. That is, the gain drops by factor of three.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-42.jpg?height=589&width=794&top_left_y=2548&top_left_x=1909)

Figure 12.12
(b) With feedback, we use Eq. (12.30) but recognize that the open-loop gain has fallen to $g_{m} R_{D} / 3$ :

$$
\begin{align*}
\frac{v_{\text {out }}}{v_{\text {in }}} & =\frac{g_{m} R_{D} / 3}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m} R_{D} / 3}  \tag{12.41}\\
& =\frac{g_{m} R_{D}}{3+\frac{R_{2}}{R_{1}+R_{2}} g_{m} R_{D}} \tag{12.42}
\end{align*}
$$

For example, if $g_{m} R_{D} R_{2} /\left(R_{1}+R_{2}\right)=10$, then this result differs from the "unloaded" gain expression in Eq. (12.30) by about $18 \%$. Feedback therefore desensitizes the gain to load variations.

Exercise $\quad$ Repeat the above example for $R_{L}=R_{D}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-43.jpg?height=937&width=2524&top_left_y=559&top_left_x=1124)

Figure 12.13 (a) Nonlinear open-loop characteristic of an amplifier, (b) improvement in linearity due to feedback.

### 12.2.4 Linearity Improvement

Consider a system having the input/output characteristic shown in Fig. 12.13(a). The nonlinearity observed here can also be viewed as the variation of the slope of the characteristic, i.e., the small-signal gain. For example, this system exhibits a gain of $A_{1}$ near $x=x_{1}$ and $A_{2}$ near $x=x_{2}$. If placed in a negative-feedback loop, the system provides a more uniform gain for different signal levels and, therefore, operates more linearly. In fact, as illustrated in Fig. 12.13(b) for the closed-loop system, we can write

$$
\text { Gain at } \begin{align*}
x_{1} & =\frac{A_{1}}{1+K A_{1}}  \tag{12.43}\\
& \approx \frac{1}{K}\left(1-\frac{1}{K A_{1}}\right) \tag{12.44}
\end{align*}
$$

where it is assumed $K A_{1} \gg 1$. Similarly,

$$
\text { Gain at } \begin{align*}
x_{2} & =\frac{A_{2}}{1+K A_{2}}  \tag{12.45}\\
& \approx \frac{1}{K}\left(1-\frac{1}{K A_{2}}\right) \tag{12.46}
\end{align*}
$$

Thus, so long as $K A_{1}$ and $K A_{2}$ are large, the variation of the closed-loop gain with the signal level remains much less than that of the open-loop gain.

All of the above attributes of negative feedback can also be considered a result of the minimal error property illustrated in Fig. 12.3. For example, if at different signal levels, the forward amplifier's gain varies,

Did you know?

The large-signal behavior of circuits is generally nonlinear. For example, a low-quality audio amplifier driving a speaker suffers from nonlinearity as we increase the volume (i.e., the output signal swing); the result is the distinct distortion in the sound. A familiar type of nonlinearity is the type observed in differential pairs, e.g., the hyperbolic relationship obtained for bipolar implementations. In fact, the audio amplifier in your stereo system incorporates a differential pair at the input and other stages that can deliver a high output power [Fig. (a)]. To reduce distortion, the circuit is then placed in a negative feedback loop [Fig. (b)].
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-43.jpg?height=1562&width=1388&top_left_y=3179&top_left_x=2637)
(b)

Amplifier driving a speaker (a) without, and (b) with feedback.
the feedback still ensures the feedback signal is a close replica of the input, and so is the output.

## 12.3 TYPES OF AMPLIFIERS

The amplifiers studied thus far in this book sense and produce voltages. While less intuitive, other types of amplifiers also exist, i.e., those that sense and/or produce currents. Figure 12.14 depicts the four possible combinations along with their input and output impedances in the ideal case. For example, a circuit sensing a current must display a low input impedance to resemble a current meter. Similarly, a circuit generating an output current must achieve a high output impedance to approximate a current source. The reader is encouraged to confirm the other cases as well. The distinction among the four types of amplifiers becomes important in the analysis of feedback circuits. Note that the "current-voltage" and "voltagecurrent" amplifiers of Figs. 12.14(b) and (c) are commonly known as "transimpedance" and "transconductance" amplifiers, respectively.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-44.jpg?height=1206&width=2345&top_left_y=1823&top_left_x=1162)

Figure 12.14 (a) Voltage, (b) transimpedance, (c) transconductance, and (d) current amplifiers.

### 12.3.1 Simple Amplifier Models

For our studies later in this chapter, it is beneficial to develop simple models for the four amplifier types. Depicted in Fig. 12.15 are the models for the ideal case. The voltage amplifier in Fig. 12.15(a) provides an infinite input impedance so that it can sense voltages as an ideal voltmeter, i.e., without loading the preceding stage. Also, the circuit exhibits a
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-44.jpg?height=904&width=1910&top_left_y=3829&top_left_x=1351)

Figure 12.15 Ideal models for (a) voltage, (b) transimpedance, (c) transconductance, and (d) current amplifiers.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-45.jpg?height=366&width=845&top_left_y=633&top_left_x=976)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-45.jpg?height=429&width=823&top_left_y=1087&top_left_x=901)
(d)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-45.jpg?height=417&width=965&top_left_y=625&top_left_x=1949)
(b)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-45.jpg?height=407&width=1006&top_left_y=1098&top_left_x=1946)
(e)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-45.jpg?height=401&width=858&top_left_y=633&top_left_x=2933)
(c)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-45.jpg?height=412&width=861&top_left_y=1084&top_left_x=2975)
(f)

Figure 12.16 (a) Realistic model of voltage amplifier, (b) incorrect voltage amplifier model, (c) realistic model of transimpedance amplifier, (d) incorrect model of transimpedance amplifier, (e) realistic model of transconductance amplifier, (f) realistic model of current amplifier.
zero output impedance so as to serve as an ideal voltage source, i.e., deliver $v_{\text {out }}=A_{0} v_{\text {in }}$ regardless of the load impedance.

The transimpedance amplifier in Fig. 12.15(b) has a zero input impedance so that it can measure currents as an ideal current meter. Similar to the voltage amplifier, the output impedance is also zero if the circuit operates as an ideal voltage source. Note that the "transimpedance gain" of this amplifier, $R_{0}=v_{\text {out }} / i_{\text {in }}$, has a dimension of resistance. For example, a transimpedance gain of $2 \mathrm{k} \Omega$ means a 1-mA change in the input current leads to a 2-V change at the output.

The I/O impedances of the topologies in Figs. 12.15(c) and (d) follow similar observations. It is worth noting that the amplifier of Fig. 12.15(c) has a "transconductance gain," $G_{m}=i_{\text {out }} / v_{\text {in }}$, with a dimension of transconductance.

In reality, the ideal models in Fig. 12.15 may not be accurate. In particular, the I/O impedances may not be negligibly large or small. Figure 12.16 shows more realistic models of the four amplifier types. Illustrated in Fig. 12.16(a), the voltage amplifier model contains an input resistance in parallel with the input port and an output resistance in series with the output port. These choices are unique and become clearer if we attempt other combinations. For example, if we envision the model as shown in Fig. 12.16(b), then the input and output impedances remain equal to infinity and zero, respectively, regardless of the values of $R_{\text {in }}$ and $R_{\text {out }}$. (Why?) Thus, the topology of Fig. 12.16(a) serves as the only possible model representing finite I/O impedances.

Figure 12.16(c) depicts a nonideal transimpedance amplifier. Here, the input resistance appears in series with the input. Again, if we attempt a model such as that in Fig. 12.16(d), the input resistance is zero. The other two amplifier models in Figs. 12.16(e) and (f) follow similar concepts.

### 12.3.2 Examples of Amplifier Types

It is instructive to study examples of the above four types. Figure 12.17(a) shows a cascade of a CS stage and a source follower as a "voltage amplifier." The circuit indeed provides a high input impedance (similar to a voltmeter) and a low output impedance (similar to a voltage source). Figure 12.17(b) depicts a cascade of a CG stage and a source follower as a transimpedance amplifier. Such a circuit displays low input and output impedances to serve as a "current sensor" and a "voltage generator." Figure 12.17(c) illustrates a single
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-46.jpg?height=1702&width=2626&top_left_y=530&top_left_x=976)

Figure 12.17 Examples of (a) voltage, (b) transimpedance, (c) transconductance, and (d) current amplifiers.

MOSFET as a transconductance amplifier. With high input and output impedances, the circuit efficiently senses voltages and generates currents. Finally, Fig. 12.17(d) shows a common-gate transistor as a current amplifier. Such a circuit must provide a low input impedance and a high output impedance.

Let us also determine the small-signal "gain" of each circuit in Fig. 12.17, assuming $\lambda=0$ for simplicity. The voltage gain, $A_{0}$, of the cascade in Fig. 12.17(a) is equal to $-g_{m} R_{D}$ if $\lambda=0 .{ }^{4}$ The gain of the circuit in Fig. 12.17(b) is defined as $v_{\text {out }} / i_{\text {in }}$, called the "transimpedance gain," and denoted by $R_{T}$. In this case, $i_{i n}$ flows through $M_{1}$ and $R_{D}$, generating a voltage equal to $i_{i n} R_{D}$ at both the drain of $M_{1}$ and the source of $M_{2}$. That is, $v_{\text {out }}=i_{\text {in }} R_{D}$ and hence $R_{T}=R_{D}$.

For the circuit in Fig. 12.17(c), the gain is defined as $i_{\text {out }} / v_{\text {in }}$, called the "transconductance gain," and denoted by $G_{m}$. In this example, $G_{m}=g_{m}$. For the current amplifier in Fig. 12.17(d), the current gain, $A_{I}$, is equal to unity because the input current simply flows to the output.

Example With a current gain of unity, the topology of Fig. 12.17(d) appears hardly better than a 12.9 piece of wire. What is the advantage of this circuit?

Solution The important property of this circuit lies in its input impedance. Suppose the current source serving as the input suffers from a large parasitic capacitance, $C_{p}$. If applied directly to a resistor $R_{D}$ [Fig. 12.18(a)], the current would be wasted

[^14]![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-47.jpg?height=406&width=863&top_left_y=1144&top_left_x=1452)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-47.jpg?height=789&width=840&top_left_y=764&top_left_x=2485)
(b)

Figure 12.18
through $C_{p}$ at high frequencies, exhibiting a -3 dB bandwidth of only $\left(R_{D} C_{p}\right)^{-1}$. On the other hand, the use of a CG stage [Fig. 12.18(b)] moves the input pole to $g_{m} / C_{p}$, a much higher frequency.

Exercise Determine the transfer function $V_{\text {out }} / I_{\text {in }}$ for each of the above circuits.

## 12.4 SENSE AND RETURN TECHNIQUES

Recall from Section 12.1 that a feedback system includes means of sensing the output and "returning" the feedback signal to the input. In this section, we study such means so as to recognize them easily in a complex feedback circuit.

How do we measure the voltage across a port? We place a voltmeter in parallel with the port, and require that the voltmeter have a high input impedance so that it does not disturb the circuit [Fig. 12.19(a)]. By the same token, a feedback circuit sensing an output voltage must appear in parallel with the output and, ideally, exhibit an infinite impedance [Fig. 12.19(b)]. Shown in Fig. 12.19(c) is an example in which the resistive divider consisting of $R_{1}$ and $R_{2}$ senses the output voltage and generates the feedback signal, $v_{F}$. To approach the ideal case, $R_{1}+R_{2}$ must be very large so that $A_{1}$ does not "feel" the effect of the resistive divider.

How do we measure the current flowing through a wire? We break the wire and place a current meter in series with the wire [Fig. 12.20(a)]. The current meter in fact consists of a small resistor, so that it does not disturb the circuit, and a voltmeter that measures
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-47.jpg?height=720&width=2935&top_left_y=4292&top_left_x=907)

Figure 12.19 (a) Sensing a voltage by a voltmeter, (b) sensing the output voltage by the feedback network, (d) example of implementation.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-48.jpg?height=1560&width=1919&top_left_y=567&top_left_x=1324)

Figure 12.20 (a) Sensing a current by a current meter, (b) actual realization of current meter, (c) sensing the output current by the feedback network, (d) example of implementation.
the voltage drop across the resistor [Fig. 12.20(b)]. Thus, a feedback circuit sensing an output current must appear in series with the output and, ideally, exhibit a zero impedance [Fig. 12.20(c)]. Depicted in Fig. 12.20(d) is an implementation of this concept. A resistor placed in series with the source of $M_{1}$ senses the output current, generating a proportional feedback voltage, $V_{F}$. Ideally, $R_{S}$ is so small ( $\ll 1 / g_{m 1}$ ) that the operation of $M_{1}$ remains unaffected.

To return a voltage or current to the input, we must employ a mechanism for adding or subtracting such quantities. ${ }^{5}$ To add two voltage sources, we place them in series [Fig. 12.21(a)]. Thus, a feedback network returning a voltage must appear in series with the input signal [Fig. 12.21(b)], so that

$$
\begin{equation*}
v_{e}=v_{i n}-v_{F} \tag{12.47}
\end{equation*}
$$

For example, as shown in Fig. 12.21(c), a differential pair can subtract the feedback voltage from the input. Alternatively, as mentioned in Example 12.7, a single transistor can operate as a voltage subtractor [Fig. 12.21(d)].

To add two current sources, we place them in parallel [Fig. 12.22(a)]. Thus, a feedback network returning a current must appear in parallel with the input signal, Fig. 12.22(b), so that

$$
\begin{equation*}
i_{e}=i_{i n}-i_{F} \tag{12.48}
\end{equation*}
$$

For example, a transistor can return a current to the input [Fig. 12.22(c)]. So can a resistor if it is large enough to approximate a current source [Fig. 12.22(d)].

[^15]![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-49.jpg?height=1353&width=1987&top_left_y=351&top_left_x=1398)

Figure 12.21 (a) Addition of two voltages, (b) addition of feedback and input voltages, (c) differential pair as a voltage subtractor, (d) single transistor as a voltage subtractor.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-49.jpg?height=515&width=412&top_left_y=2037&top_left_x=1501)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-49.jpg?height=527&width=1057&top_left_y=2699&top_left_x=1287)
(c)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-49.jpg?height=555&width=908&top_left_y=1960&top_left_x=2514)
(b)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-49.jpg?height=486&width=931&top_left_y=2702&top_left_x=2594)
(d)

Figure 12.22 (a) Addition of two currents, (b) addition of feedback current and input current, (c) circuit realization, (d) another realization.

Example 12.10

Determine the types of sensed and returned signals in the circuit of Fig. 12.23.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-49.jpg?height=851&width=1046&top_left_y=3890&top_left_x=1863)

Figure 12.23

Solution This circuit is an implementation of the noninverting amplifier shown in Fig. 12.2. Here, the differential pair with the active load plays the role of an op amp. The resistive divider senses the output voltage and serves as the feedback network, producing $v_{F}=\left[R_{2} /\left(R_{1}+R_{2}\right)\right] v_{\text {but }}$. Also, $M_{1}$ and $M_{2}$ operate as both part of the op amp (the forward system) and a voltage subtractor. The amplifier therefore combines the topologies in Figs. 12.19(c) and 12.21(c).

Exercise $\quad$ Repeat the above example if $R_{2}=\infty$.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-50.jpg?height=1034&width=2415&top_left_y=1566&top_left_x=488)

Figure 12.24

Solution Transistor $M_{F}$ both senses the output voltage and returns a current to the input. The feedback factor is thus given by

$$
\begin{equation*}
K=\frac{i_{F}}{v_{\text {out }}}=g_{m F} \tag{12.49}
\end{equation*}
$$

where $g_{m F}$ denotes the transconductance of $M_{F}$.

Exercise Calculate the feedback factor if $M_{F}$ is degenerated by a resistor of value $R_{S}$.

Let us summarize the properties of the "ideal" feedback network. As illustrated in Fig. 12.25(a), we expect such a network to exhibit an infinite input impedance if sensing a voltage and a zero input impedance if sensing a current. Moreover, the network must provide a zero output impedance if returning a voltage and an infinite output impedance if returning a current.

## 12.5 POLARITY OF FEEDBACK

While the block diagram of a feedback system, e.g., Fig. 12.1, readily reveals the polarity of feedback, an actual circuit implementation may not. The procedure of determining this polarity involves three steps: (a) assume the input signal goes up (or down); (b) follow the change through the forward amplifier and the feedback network; (c) determine whether the returned quantity opposes or enhances the original "effect" produced by the input change. A simpler procedure is as follows: (a) set the input to zero; (b) break the loop; (c) apply a test signal, $V_{\text {test }}$, travel around the loop, examine the returned signal, $V_{\text {ret }}$, and determine the polarity of $V_{\text {ret }} / V_{\text {test }}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-51.jpg?height=779&width=3127&top_left_y=461&top_left_x=834)

Figure 12.25 (a) Input impedance of ideal feedback networks for sensing voltage and current quantities, (b) output impedance of ideal feedback networks for producing voltage and current quantities.

Example Determine the polarity of feedback in the circuit of Fig. 12.26. <br> 12.12

![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-51.jpg?height=851&width=1057&top_left_y=1915&top_left_x=1869)

Figure 12.26

Solution If $V_{\text {in }}$ goes up, $I_{D 1}$ tends to increase and $I_{D 2}$ tends to decrease. As a result, $V_{o u t}$ and hence $V_{X}$ tend to rise. The rise in $V_{X}$ tends to increase $I_{D 2}$ and decrease $I_{D 1}$, counteracting the effect of the change in $V_{i n}$. The feedback is therefore negative. The reader is encouraged to apply the second procedure.

Exercise $\quad$ Suppose the top terminal of $R_{1}$ is tied to the drain of $M_{1}$ rather than the the drain of $M_{2}$. Determine the polarity of feedback.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-51.jpg?height=1052&width=2381&top_left_y=3795&top_left_x=579)

Figure 12.27

Solution If $V_{\text {in }}$ goes up, $I_{D 1}$ tends to increase. Thus, $V_{A}$ falls, $V_{o u t}$ rises, and so does $V_{X}$. The rise in $V_{X}$ tends to reduce $I_{D 1}$ (why?), thereby opposing the effect produced by $V_{i n}$. The feedback is therefore negative.

Exercise Repeat the above example if $M_{2}$ is converted to a CG stage, i.e., its source is tied to node $A$ and its gate to a bias voltage.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-52.jpg?height=1039&width=2399&top_left_y=1250&top_left_x=490)

Figure 12.28

Solution If $I_{\text {in }}$ goes up, $V_{X}$ tends to rise (why?), thus raising $I_{D 1}$. As a result, $V_{\text {out }}$ falls and $I_{D 2}$ decreases, allowing $V_{X}$ to rise (why?). Since the returned signal enhances the effect produced by $I_{i n}$, the polarity of feedback is positive.

Exercise Repeat the above example if $M_{2}$ is a PMOS device (still operating as a CS stage). What happens if $R_{D} \rightarrow \infty$ ? Is this result expected?

Did you know?

While we focus on negative feedback in this book, positive feedback also finds its own applications. Suppose, for example, that a new ice cream store adopts a unique recipe and begins to attract many customers. If the store now adds one more scoop to each ice cream for free, then it will draw even more customers. That is, the store owner is providing a feedback signal that enhances the customer response (positive feedback). On the other hand, if the owner is greedy and reduces the size of the ice cream, then the store loses customers (negative feedback).

## 12.6 FEEDBACK TOPOLOGIES

Our study of different types of amplifiers in Section 12.3 and sense and return mechanisms in Section 12.4 suggests that four feedback topologies can be constructed. Each topology includes one of four types of amplifiers as its forward system. The feedback network must, of course, sense and return quantities compatible with those produced and sensed by the forward system, respectively. For example, a voltage amplifier requires that the feedback network sense and return voltages, whereas a transimpedance amplifier must employ a feedback network that senses a voltage and returns a current. In this section, we study each topology and compute the closed-loop characteristics such as gain and I/O impedances with the assumption that the feedback network is ideal (Fig. 12.25).

### 12.6.1 Voltage-Voltage Feedback

Illustrated in Fig. 12.29(a), this topology incorporates a voltage amplifier, requiring that the feedback network sense the output voltage and return a voltage to the subtractor. Recall from Section 12.4 that such a feedback network appears in parallel with the output and in series with the input, ${ }^{6}$ ideally exhibiting an infinite input impedance and a zero output impedance.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-53.jpg?height=720&width=983&top_left_y=964&top_left_x=1889)

Figure 12.29 Voltage-voltage feedback.

We first calculate the closed-loop gain. Since

$$
\begin{align*}
V_{1} & =V_{\text {in }}-V_{F}  \tag{12.50}\\
V_{\text {out }} & =A_{0} V_{1}  \tag{12.51}\\
V_{F} & =K V_{\text {out }}, \tag{12.52}
\end{align*}
$$

we have

$$
\begin{equation*}
V_{\text {out }}=A_{0}\left(V_{\text {in }}-K V_{\text {out }}\right) \tag{12.53}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{A_{0}}{1+K A_{0}} \tag{12.54}
\end{equation*}
$$

an expected result.

Determine the closed-loop gain of the circuit shown in Fig. 12.30, assuming $R_{1}+R_{2}$ is very large.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-53.jpg?height=863&width=1051&top_left_y=3518&top_left_x=1866)

Figure 12.30
${ }^{6}$ For this reason, this type of feedback is also called the "series-shunt" topology, where the first term refers to the return mechanism at the input and the second term to the sense mechanism at the output.
| Solution As evident from Examples 12.10 and 12.12, this topology indeed employs negative voltage-voltage feedback: the resistive network senses $V_{\text {out }}$ with a high impedance (because $R_{1}+R_{2}$ is very large), returning a voltage to the gate of $M_{2}$. As mentioned in Example $12.10, M_{1}$ and $M_{2}$ serve as the input stage of the forward system and as a subtractor.

Noting that $A_{0}$ is the gain of the circuit consisting of $M_{1}-M_{4}$, we write from Chapter 10

$$
\begin{equation*}
A_{0}=g_{m N}\left(r_{O N} \| r_{O P}\right) \tag{12.55}
\end{equation*}
$$

where the subscripts $N$ and $P$ refer to NMOS and PMOS devices, respectively. ${ }^{7}$ With $K=R_{2} /\left(R_{1}+R_{2}\right)$, we obtain

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{g_{m N}\left(r_{O N} \| r_{O P}\right)}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m N}\left(r_{O N} \| r_{O P}\right)} \tag{12.56}
\end{equation*}
$$

As expected, if the loop gain remains much greater than unity, then the closed-loop gain is approximately equal to $1 / K=1+R_{1} / R_{2}$.

Exercise If $g_{m N}=1 /(100 \Omega), r_{O N}=5 \mathrm{k} \Omega$, and $r_{O P}=2 \mathrm{k} \Omega$, determine the required value of $R_{2} /\left(R_{1}+R_{2}\right)$ for a closed loop gain of 4 . Compare the result with the nominal value of $\left(R_{2}+R_{1}\right) / R_{2}=4$.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-54.jpg?height=777&width=1445&top_left_y=2648&top_left_x=1709)

Figure 12.31 Calculation of input impedance.
In order to analyze the effect of feedback on the I/O impedances, we assume the forward system is a nonideal voltage amplifier (i.e., it exhibits finite I/O impedances) while the feedback network remains ideal. Depicted in Fig. 12.31 is the overall topology including a finite input resistance for the forward amplifier. Without feedback, of course, the entire input signal would appear across $R_{i n}$, producing an input current of $V_{i n} / R_{i n}{ }^{8}$ With feedback, on the other hand, the voltage developed at the input of $A_{0}$ is equal to $V_{i n}-V_{F}$ and also equal to $I_{i n} R_{i n}$. Thus,

$$
\begin{align*}
I_{i n} R_{i n} & =V_{i n}-V_{F}  \tag{12.57}\\
& =V_{i n}-\left(I_{i n} R_{i n}\right) A_{0} K \tag{12.58}
\end{align*}
$$

[^16]It follows that

$$
\begin{equation*}
\frac{V_{i n}}{I_{i n}}=R_{i n}\left(1+K A_{0}\right) \tag{12.59}
\end{equation*}
$$

Interestingly, negative feedback around a voltage amplifier raises the input impedance by the universal factor of one plus the loop gain. This impedance modification brings the circuit closer to an ideal voltage amplifier.

Example Determine the input impedance of the stage shown in Fig. 12.32(a) if $R_{1}+R_{2}$ is very 12.16 large.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-55.jpg?height=698&width=743&top_left_y=1763&top_left_x=1501)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-55.jpg?height=726&width=766&top_left_y=1766&top_left_x=2517)
(b)

Figure 12.32
Solution We first open the loop to calculate $R_{\text {in }}$ in Eq. (12.59). To open the loop, we break the gate of $M_{1}$ from the feedback signal and tie it to ground [Fig. 12.32(b)]:

$$
\begin{equation*}
R_{i n}=\frac{1}{g_{m}} \tag{12.60}
\end{equation*}
$$

The closed-loop input impedance is therefore given by

$$
\begin{equation*}
\frac{V_{i n}}{I_{i n}}=\frac{1}{g_{m}}\left(1+\frac{R_{2}}{R_{1}+R_{2}} g_{m} R_{D}\right) \tag{12.61}
\end{equation*}
$$

Exercise What happens if $R_{2} \rightarrow \infty$ ? Is this result expected?

The effect of feedback on the output impedance can be studied with the aid of the diagram shown in Fig. 12.33, where the forward amplifier exhibits an output impedance of $R_{\text {out }}$. Expressing the error signal at the input of $A_{0}$ as $-V_{F}=-K V_{X}$, we write the output voltage of $A_{0}$ as $-K A_{0} V_{X}$ and hence

$$
\begin{equation*}
I_{X}=\frac{V_{X}-\left(-K A_{0} V_{X}\right)}{R_{\text {out }}} \tag{12.62}
\end{equation*}
$$

where the current drawn by the feedback network is neglected. Thus,

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{\text {out }}}{1+K A_{0}} \tag{12.63}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-56.jpg?height=771&width=1410&top_left_y=585&top_left_x=1544)

Figure 12.33 Calculation of output impedance.
revealing that negative feedback lowers the output impedance if the topology senses the output voltage. The circuit is now a better voltage amplifier-as predicted by our gain desensitization analysis in Section 12.2.

Example $\quad$ Calculate the output impedance of the circuit shown in Fig. 12.34 if $R_{1}+R_{2}$ is very large.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-56.jpg?height=863&width=1212&top_left_y=2377&top_left_x=1700)

Figure 12.34

Solution Recall from Example 12.15 that the open-loop output impedance is equal to $r_{O N} \| r_{O P}$ and $K A_{0}=\left[R_{2} /\left(R_{1}+R_{2}\right)\right] g_{m N}\left(r_{O N} \| r_{O P}\right)$. Thus, the closed-loop output impedance, $R_{\text {out,closed }}$, is given by

$$
\begin{equation*}
R_{\text {out }, \text { closed }}=\frac{r_{O N} \| r_{O P}}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m N}\left(r_{O N} \| r_{O P}\right)} \tag{12.64}
\end{equation*}
$$

If the loop gain is much greater than unity,

$$
\begin{equation*}
R_{\text {out }, \text { closed }} \approx\left(1+\frac{R_{1}}{R_{2}}\right) \frac{1}{g_{m N}} \tag{12.65}
\end{equation*}
$$

a value independent of $r_{O N}$ and $r_{O P}$. In other words, while the open-loop amplifier suffers from a high output impedance, the application of negative feedback lowers $R_{\text {out }}$ to a multiple of $1 / g_{m N}$.

Exercise What happens if $R_{2} \rightarrow \infty$ ? Can you prove this result by direct analysis of the circuit?

In summary, voltage-voltage feedback lowers the gain and the output impedance by $1+K A_{0}$ and raises the input impedance by the same factor.

### 12.6.2 Voltage-Current Feedback

Depicted in Fig. 12.35, this topology employs a transimpedance amplifier as the forward system, requiring that the feedback network sense the output voltage and return a current to the subtractor. In our terminology, the first term in "voltage-current feedback" refers to the quantity sensed at the output, and the second, to the quantity returned to the input. (This terminology is not standard.) Also, recall from Section 12.4 that such a feedback network must appear in parallel with the output and with the input, ${ }^{9}$ ideally providing both an infinite input impedance and an infinite output impedance (why?). Note that the feedback factor in this case has a dimension of conductance because $K=I_{F} / V_{\text {out }}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-57.jpg?height=761&width=1119&top_left_y=2679&top_left_x=1113)

Figure 12.35 Voltage-current feedback.
We first compute the closed-loop gain, expecting to obtain a familiar result. Since $I_{e}=I_{\text {in }}-I_{F}$ and $V_{\text {out }}=I_{e} R_{0}$, we have

$$
\begin{align*}
V_{\text {out }} & =\left(I_{\text {in }}-I_{F}\right) R_{0}  \tag{12.66}\\
& =\left(I_{\text {in }}-K V_{\text {out }}\right) R_{0}, \tag{12.67}
\end{align*}
$$

and hence

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{R_{0}}{1+K R_{0}} . \tag{12.68}
\end{equation*}
$$

For the circuit shown in Fig. 12.36(a), assume $\lambda=0$ and $R_{F}$ is very large and (a) prove that 12.18

Did you know?

Most electronic devices incorporate negative feedback in their "voltage regulators." Since the integrated circuits in a device such as a cell phone must operate with a tight supply voltage range, a regulator follows the battery so as to deliver a relatively constant voltage as the battery discharges and its voltage falls. The figure below shows an example, where $Q_{1}$, the resistor divider, and the op amp form a negative-feedback loop. To regulate the output voltage, $V_{\text {reg }}$, the loop divides it and compares the result with a reference voltage, $V_{\text {REF }}$. With a high loop gain, we must have $V_{\text {reg }} R_{1} /\left(R_{1}+R_{2}\right) \approx V_{R E F}$ and hence $V_{\text {reg }} \approx\left(1+R_{2} / R_{1}\right) V_{\text {REF }}$. That is, the output is independent of $V_{\text {bat }}$ and $A_{1}$. Of course, $V_{\text {REF }}$ itself must remain constant. This voltage is provided by a Zener diode in discrete implementations or a "bandgap circuit" in integrated designs.
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-57.jpg?height=857&width=1439&top_left_y=2323&top_left_x=2500)

Voltage regulator using negative feedback.
the feedback is negative; (b) calculate the open-loop gain; (c) calculate the closed-loop
gain.

[^17]Solution (a) If $I_{\text {in }}$ increases, $I_{D 1}$ decreases and $V_{X}$ rises. As a result, $V_{\text {out }}$ falls, thereby reducing $I_{R F}$. Since the currents injected by $I_{i n}$ and $R_{F}$ into the input node change in opposite directions, the feedback is negative.
(b) To calculate the open-loop gain, we consider the forward amplifier without the feedback network, exploiting the assumption that $R_{F}$ is very large [Fig. 12.36(b)].
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-58.jpg?height=949&width=2821&top_left_y=1055&top_left_x=890)

Figure 12.36
The transimpedance gain is given by the gain from $I_{\text {in }}$ to $V_{X}$ (i.e., $R_{D 1}$ ) multiplied by that from $V_{X}$ to $V_{\text {out }}$ (i.e., $-g_{m 2} R_{D 2}$ ):

$$
\begin{equation*}
R_{0}=R_{D 1}\left(-g_{m 2} R_{D 2}\right) \tag{12.69}
\end{equation*}
$$

Note that this result assumes $R_{F} \gg R_{D 2}$ so that the gain of the second stage remains equal to $-g_{m 2} R_{D 2}$.
(c) To obtain the closed-loop gain, we first note that the current returned by $R_{F}$ to the input is approximately equal to $V_{\text {out }} / R_{F}$ if $R_{F}$ is very large. To prove this, we consider a section of the circuit as in Fig. 12.36(c) and write

$$
\begin{equation*}
I_{R F}=\frac{V_{\text {out }}}{R_{F}+\frac{1}{g_{m 1}}} \tag{12.70}
\end{equation*}
$$

Thus, if $R_{F} \gg 1 / g_{m 1}$, the returned current is approximately equal to $V_{\text {out }} / R_{F}$. (We say " $R_{F}$ operates as a current source.") That is, $K=-1 / R_{F}$, where the negative sign arises from the direction of the current drawn by $R_{F}$ from the input node with respect to that in Fig. 12.35. Forming $1+K R_{0}$, we express the closed-loop gain as

$$
\begin{equation*}
\left.\frac{V_{\text {out }}}{I_{\text {in }}}\right|_{\text {closed }}=\frac{-g_{m 2} R_{D 1} R_{D 2}}{1+\frac{g_{m 2} R_{D 1} R_{D 2}}{R_{F}}} \tag{12.71}
\end{equation*}
$$

which reduces to $-R_{F}$ if $g_{m 2} R_{D 1} R_{D 2} \gg R_{F}$.
It is interesting to note that the assumption that $R_{F}$ is very large translates to two conditions in this example: $R_{F} \gg R_{D 2}$ and $R_{F} \gg 1 / g_{m 1}$. The former arises from the output network calculations and the latter from the input network calculations. What happens if one or both of these assumptions are not valid? We deal with this (relatively common) situation in Section 12.7.

What is the closed-loop gain if $R_{D 1} \rightarrow \infty$ ? How can this result be interpreted? (Hint: the infinite open-loop gain creates a virtual ground node at the source of $M_{1}$.)
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-59.jpg?height=555&width=1268&top_left_y=339&top_left_x=1866)

Figure 12.37 Calculation of input impedance.

We now proceed to determine the closed-loop I/O impedances. Modeling the forward system as an ideal transimpedance amplifier but with a finite input impedance $R_{\text {in }}$ (Section 12.3), we construct the test circuit shown in Fig. 12.37. Since the current flowing through $R_{\text {in }}$ is equal to $V_{X} / R_{\text {in }}$ (why?), the forward amplifier produces an output voltage equal to $\left(V_{X} / R_{\text {in }}\right) R_{0}$ and hence

$$
\begin{equation*}
I_{F}=K \frac{V_{X}}{R_{i n}} R_{0} \tag{12.72}
\end{equation*}
$$

Writing a KCL at the input node thus yields

$$
\begin{equation*}
I_{X}-K \frac{V_{X}}{R_{i n}} R_{0}=\frac{V_{X}}{R_{i n}} \tag{12.73}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{i n}}{1+K R_{0}} \tag{12.74}
\end{equation*}
$$

That is, a feedback loop returning current to the input lowers the input impedance by a factor of one plus the loop gain, bringing the circuit closer to an ideal "current sensor."

| Example <br> 12.19 | Determine the closed-loop input impedance of the circuit studied in Example 12.18. |
| :--- | :--- |
| Solution | The open-loop amplifier shown in Fig. 12.36(b) exhibits an input impedance $R_{\text {in }}=1 / g_{m 1}$ <br> because $R_{F}$ is assumed to be very large. With $1+K R_{0}$ from the denominator of <br> Eq. (12.71), we obtain |
| $\qquad R_{\text {in, closed }}=\frac{1}{g_{m 1}} \cdot \frac{1}{1+\frac{g_{m 2} R_{D 1} R_{D 2}}{R_{F}}}$. |  |

Exercise Explain what happens if $R_{D 1} \rightarrow \infty$ and why.

From our study of voltage-voltage feedback in Section 12.6.1, we postulate that voltage-current feedback too lowers the output impedance because a feedback loop "regulating" the output voltage tends to stabilize it despite load impedance variations. Drawing the circuit as shown in Fig. 12.38, where the input current source is set to zero and $R_{\text {out }}$ models the open-loop output resistance, we observe that the feedback network produces a current of $I_{F}=K V_{X}$. Upon flowing through the forward amplifier, this current translates
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-60.jpg?height=538&width=1092&top_left_y=393&top_left_x=1760)

Figure 12.38 Calculation of output impedance.
to $V_{A}=-K V_{X} R_{0}$ and hence

$$
\begin{align*}
I_{X} & =\frac{V_{X}-V_{A}}{R_{\text {out }}}  \tag{12.76}\\
& =\frac{V_{X}+K V_{X} R_{0}}{R_{\text {out }}} \tag{12.77}
\end{align*}
$$

where the current drawn by the feedback network is neglected. Thus,

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{\text {out }}}{1+K R_{0}} \tag{12.78}
\end{equation*}
$$

an expected result.

Example Calculate the closed-loop output impedance of the circuit studied in Example 12.18.
12.20

Solution From the open-loop circuit in Fig. 12.36(b), we have $R_{\text {out }} \approx R_{D 2}$ because $R_{F}$ is assumed very large. Writing $1+K R_{0}$ from the denominator of Eq. (12.71) gives

$$
\begin{equation*}
R_{\text {out }, \text { closed }}=\frac{R_{D 2}}{1+\frac{g_{m 2} R_{D 1} R_{D 2}}{R_{F}}} \tag{12.79}
\end{equation*}
$$

Exercise Explain what happens if $R_{D 1} \rightarrow \infty$ and why.

### 12.6.3 Current-Voltage Feedback

Shown in Fig. 12.39(a), this topology incorporates a transconductance amplifier, requiring that the feedback network sense the output current and return a voltage to the subtractor. Again, in our terminology, the first term in "current-voltage feedback" refers to the
![](https://cdn.mathpix.com/cropped/2024_11_08_9ec87a8d4dad7fdd2420g-60.jpg?height=761&width=920&top_left_y=4106&top_left_x=1869)

Figure 12.39 Current-voltage feedback.

[^0]:    ${ }^{10}$ The Early effect and channel-length modulation are neglected here.

[^1]:    ${ }^{11}$ Recall that we denote frequency-domain quantities with upper-case letters.

[^2]:    ${ }^{12}$ As explained in more advanced courses, this zero does become problematic in the internal circuitry of op amps.

[^3]:    ${ }^{13}$ The large discrepancy between $\left|\omega_{p, \text { out }}\right|$ and $\left|\omega_{p 2}\right|$ results from an effect called "pole splitting" and is studied in more advanced courses.

[^4]:    ${ }^{14}$ In calculation of the input impedance, the output impedance of the preceding stage (denoted by $R_{S}$ ) is excluded.

[^5]:    ${ }^{15}$ One exception is encountered in radio-frequency circuits (e.g., cellphones), where the input capacitance becomes undesirable.

[^6]:    ${ }^{16}$ In reality, the junction capacitances $C_{S B}$ and $C_{D B}$ sustain different reverse bias voltages and are therefore not quite equal.

[^7]:    ${ }^{17}$ If the follower output resistance is greater than $R_{S}$, then it is better to omit the follower!

[^8]:    ${ }^{18}$ The voltage division between $R_{S}$ and $r_{\pi 1}$ lowers the gain slightly in the bipolar circuit.

[^9]:    *This section can be skipped in a first reading.

[^10]:    ${ }^{19}$ With this estimate of the gain, we can express the Miller effect of $R_{F}$ at the output as $R_{F} /\left(1-A_{v 2}^{-1}\right) \approx 8.7 \mathrm{k} \Omega$, place this resistance in parallel with $R_{L 2}$, and write $A_{v 2}=-g_{m 2}\left(R_{D 2} \| 8.7 \mathrm{k} \Omega\right)=-5.98$. But we continue without this iteration for simplicity. ${ }^{20}$ If not, then the circuit must be solved using a complete small-signal equivalent.

[^11]:    ${ }^{1}$ Also called the "forward" system.

[^12]:    ${ }^{2}$ We use voltage quantities in this example, but other quantities work as well.

[^13]:    ${ }^{3}$ Some analog-to-digital converters (ADCs) require very precise voltage gains. For example, a 10-bit ADC may call for a gain of 2.000 .

[^14]:    ${ }^{4}$ Recall from Chapter 7 that the gain of the source follower is equal to unity in this case.

[^15]:    ${ }^{5}$ Of course, only quantities having the same dimension can be added or subtracted. That is, a voltage cannot be added to a current.

[^16]:    ${ }^{7}$ We observe that $R_{1}+R_{2}$ must be much greater than $r_{O N} \| r_{O P}$ for this to hold. This serves as the definition of $R_{1}+R_{2}$ being "very large."
${ }^{8}$ Note that $V_{\text {in }}$ and $R_{\text {in }}$ carry equal currents because the feedback network must appear in series with the input [Fig. 12.21(a)].

[^17]:    ${ }^{9}$ For this reason, this type is also called "shunt-shunt" feedback.

quantity sensed at the output, and the second, to the quantity returned to the input. Recall from Section 12.4 that such a feedback network must appear in series with the output and with the input, ${ }^{10}$ ideally exhibiting zero input and output impedances. Note that the feedback factor in this case has a dimension of resistance because $K=V_{F} / I_{\text {out }}$.

Let us first confirm that the closed-loop gain is equal to the open-loop gain divided by one plus the loop gain. Since the forward system produces a current equal to $I_{\text {out }}=G_{m}\left(V_{\text {in }}-V_{F}\right)$ and since $V_{F}=K I_{\text {out }}$, we have

$$
\begin{equation*}
I_{\text {out }}=G_{m}\left(V_{\text {in }}-K I_{\text {out }}\right) \tag{12.80}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{I_{\text {out }}}{V_{\text {in }}}=\frac{G_{m}}{1+K G_{m}} \tag{12.81}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-01.jpg?height=2633&width=3208&top_left_y=1720&top_left_x=565)

Figure 12.40

[^0]Solution If the gain of the op amp is very high, the difference between $V_{i n}$ and $V_{F}$ is very small. Thus, $R_{M}$ sustains a voltage equal to $V_{i n}$ and hence

$$
\begin{equation*}
I_{\text {out }} \approx \frac{V_{\text {in }}}{R_{M}} \tag{12.82}
\end{equation*}
$$

We now determine the open-loop gain of the transistor-level implementation in Fig. 12.40(c). The forward amplifier can be identified as shown in Fig. 12.40(d), where the gate of $M_{4}$ is grounded because the feedback signal (voltage) is set to zero. Since $I_{\text {out }}=-g_{m 1} V_{X}($ why? $)$ and $V_{X}=-g_{m 3}\left(r_{O 3} \| r_{O 5}\right) V_{\text {in }}$, we have

$$
\begin{equation*}
G_{m}=g_{m 1} g_{m 3}\left(r_{O 3} \| r_{O 5}\right) \tag{12.83}
\end{equation*}
$$

The feedback factor $K=V_{F} / I_{\text {out }}=R_{M}$. Thus,

$$
\begin{equation*}
\left.\frac{I_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }}=\frac{g_{m 1} g_{m 3}\left(r_{O 3} \| r_{O 5}\right)}{1+g_{m 1} g_{m 3}\left(r_{O 3} \| r_{O 5}\right) R_{M}} \tag{12.84}
\end{equation*}
$$

Note that if the loop gain is much greater than unity, then

$$
\begin{equation*}
\left.\frac{I_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }} \approx \frac{1}{R_{M}} \tag{12.85}
\end{equation*}
$$

We must now answer two questions. First, why is the drain of $M_{1}$ shorted to ground in the open-loop test? The simple answer is that, if this drain is left open, then $I_{\text {out }}=0$ ! But, more fundamentally, we can observe a duality between this case and that of voltage outputs, e.g., in Fig. 12.36. If driving no load, the output port of a voltage amplifier is left open. Similarly, if driving no load, the output port of a circuit delivering a current must be shorted to ground.

Second, why is the active-load amplifier in Fig. 12.40(c) drawn with the diodeconnected device on the right? This is to ensure negative feedback. For example, if $V_{\text {in }}$ goes up, $V_{X}$ goes down (why?), $M_{1}$ provides a greater current, and the voltage drop across $R_{M}$ rises, thereby steering a larger fraction of $I_{S S}$ to $M_{4}$ and opposing the effect of the change in $V_{\text {in }}$. Alternatively, the circuit can be drawn as shown in Fig. 12.40(e).

Exercise Suppose $V_{\text {in }}$ is a sinusoid with a peak amplitude of 100 mV . Plot $V_{F}$ and the current through the laser as a function of time if $R_{M}=10 \Omega$ and $G_{m}=1 /(0.5 \Omega)$. Is the voltage at the gate of $M_{1}$ necessarily a sinusoid?

From our analysis of other feedback topologies in Sections 12.6 .1 and 12.6.2, we postulate that current-voltage feedback increases the input impedance by a factor of $1+K G_{m}$. In fact, the test circuit shown in Fig. 12.41(a) is similar to that in Fig. 12.31-except that the forward system is denoted by $G_{m}$ rather than $A_{0}$. Thus, Eq. (12.59) can be rewritten as

$$
\begin{equation*}
\frac{V_{i n}}{I_{i n}}=R_{i n}\left(1+K G_{m}\right) \tag{12.86}
\end{equation*}
$$

The output impedance is calculated using the test circuit of Fig. 12.41(b). Note that, in contrast to the cases in Figs. 12.33 and 12.38, the test voltage source is inserted in series with the output port of the forward amplifier and the input port of the feedback network. The voltage developed at port $A$ is equal to $-K I_{X}$ and the current drawn by the $G_{m}$ stage
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-03.jpg?height=840&width=2650&top_left_y=619&top_left_x=1061)

Figure 12.41 Calculation of (a) input and (b) output impedances.
equal to $-K G_{m} I_{X}$. Since the current flowing through $R_{\text {out }}$ is given by $V_{X} / R_{\text {out }}$, a KCL at the output node yields

$$
\begin{equation*}
I_{X}=\frac{V_{X}}{R_{\text {out }}}-K G_{m} I_{X} \tag{12.87}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=R_{\text {out }}\left(1+K G_{m}\right) \tag{12.88}
\end{equation*}
$$

Interestingly, a negative feedback loop sensing the output current raises the output impedance, bringing the circuit closer to an ideal current generator. As in other cases studied thus far, this occurs because negative feedback tends to regulate the output quantity that it senses.

Example An alternative approach to regulating the current delivered to a laser diode is shown in
12.22 Fig. 12.42(a). As in the circuit of Fig. 12.40(b), the very small resistor $R_{M}$ monitors the current, generating a proportional voltage and feeding it back to the subtracting device, $M_{1}$. Determine the closed-loop gain and I/O impedances of the circuit.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-03.jpg?height=840&width=828&top_left_y=3433&top_left_x=1367)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-03.jpg?height=588&width=800&top_left_y=3439&top_left_x=2591)
(b)

Figure 12.42

Solution Since $R_{M}$ is very small, the open-loop circuit reduces to that shown in Fig. 12.42(b), where the gain can be expressed as

$$
\begin{align*}
G_{m} & =\frac{V_{X}}{V_{\text {in }}} \cdot \frac{I_{\text {out }}}{V_{X}}  \tag{12.89}\\
& =g_{m 1} R_{D} \cdot g_{m 2} \tag{12.90}
\end{align*}
$$

The input impedance is equal to $1 / g_{m 1}$ and the output impedance equal to $1 / g_{m 2}{ }^{12}$ The feedback factor is equal to $R_{M}$, yielding

$$
\begin{equation*}
\left.\frac{I_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }}=\frac{g_{m 1} g_{m 2} R_{D}}{1+g_{m 1} g_{m 2} R_{D} R_{M}} \tag{12.91}
\end{equation*}
$$

which reduces to $1 / R_{M}$ if the loop gain is much greater than unity. The input impedance rises by a factor of $1+G_{m} R_{M}$ :

$$
\begin{equation*}
R_{\text {in,closed }}=\frac{1}{g_{m 1}}\left(1+g_{m 1} g_{m 2} R_{D} R_{M}\right) \tag{12.92}
\end{equation*}
$$

and so does the output impedance (i.e., that seen by the laser):

$$
\begin{equation*}
R_{\text {out }, \text { closed }}=\frac{1}{g_{m 2}}\left(1+g_{m 1} g_{m 2} R_{D} R_{M}\right) \tag{12.93}
\end{equation*}
$$

Exercise If an input impedance of $500 \Omega$ and an output impedance of $5 \mathrm{k} \Omega$ are desired, determine the required values of $g_{m 1}$ and $g_{m 2}$. Assume $R_{D}=1 \mathrm{k} \Omega$ and $R_{M}=100 \Omega$.

Example A student attempts to calculate the output impedance of the current-voltage feedback
12.23
topology with the aid of circuit depicted in Fig. 12.43. Explain why this topology is an incorrect representation of the actual circuit.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-04.jpg?height=600&width=1496&top_left_y=2965&top_left_x=1495)

Figure 12.43

Solution If sensing the output current, the feedback network must remain in series with the output port of the forward amplifier, and so must the test voltage source. In other words, the output current of the forward system must be equal to both the input current of the feedback network and the current drawn by $V_{X}$ [as in Fig. 12.41(b)]. In the arrangement of Fig. 12.43, however, these principles are violated because $V_{X}$ is placed in parallel with the output. ${ }^{13}$

Exercise Apply the above (incorrect) test to the circuit of Fig. 12.42 and examine the results.

[^1]![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-05.jpg?height=595&width=1194&top_left_y=456&top_left_x=1715)

Figure 12.45 Calculation of input impedance.

For the output impedance, we utilize the test circuit shown in Fig. 12.46, where the input is left open and $V_{X}$ is inserted in series with the output port. Since $I_{F}=K I_{X}$, the forward amplifier produces an output current equal to $-K A_{I} I_{X}$. Noting that $R_{\text {out }}$ carries a current of $V_{X} / R_{\text {out }}$ and writing a KCL at the output node, we have

$$
\begin{equation*}
I_{X}=\frac{V_{X}}{R_{\text {out }}}-K A_{I} I_{X} \tag{12.100}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=R_{\text {out }}\left(1+K A_{I}\right) . \tag{12.101}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-05.jpg?height=691&width=1182&top_left_y=2360&top_left_x=1692)

Figure 12.46 Calculation of output impedance.

Consider the circuit shown in Fig. 12.47(a), where the output current delivered to a
laser diode is regulated by negative feedback. Prove that the feedback is negative and compute the closed-loop gain and I/O impedances if $R_{M}$ is very small and $R_{F}$ very large.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-05.jpg?height=828&width=920&top_left_y=3924&top_left_x=1184)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-05.jpg?height=817&width=920&top_left_y=3924&top_left_x=2497)
(b)

Figure 12.47

Solution $\quad$ Suppose $I_{i n}$ increases. Then, the source voltage of $M_{1}$ tends to rise, and so does its drain voltage (why?). As a result, the overdrive of $M_{2}$ decreases, $I_{\text {out }}$ and hence $V_{P}$ fall, and $I_{F}$ increases, thereby lowering the source voltage of $M_{1}$. Since the feedback signal, $I_{F}$, opposes the effect produced by $I_{i n}$, the feedback is negative.

We must now analyze the open-loop system. Since $R_{M}$ is very small, we assume $V_{P}$ remains near zero, arriving at the open-loop circuit depicted in Fig. 12.47(b). The assumption that $R_{F}$ is very large $\left(\gg 1 / g_{m 1}\right)$ indicates that almost all of $I_{i n}$ flows through $M_{1}$ and $R_{D}$, thus generating $V_{X}=I_{i n} R_{D}$ and hence

$$
\begin{align*}
I_{\text {out }} & =-g_{m 2} V_{X}  \tag{12.102}\\
& =-g_{m 2} R_{D} I_{i n} . \tag{12.103}
\end{align*}
$$

That is,

$$
\begin{equation*}
A_{I}=-g_{m 2} R_{D} \tag{12.104}
\end{equation*}
$$

The input impedance is approximately equal to $1 / g_{m 1}$ and the output impedance is equal to $\mathrm{r}_{\mathrm{O} 2}$.

To obtain the closed-loop parameters, we must compute the feedback factor, $I_{F} / I_{\text {out }}$. Recall from Example 12.18 that the current returned by $R_{F}$ can be approximated as $-V_{P} / R_{F}$ if $R_{F} \gg 1 / g_{m 1}$. We also note that $V_{P}=I_{o u t} R_{M}$, concluding that

$$
\begin{align*}
K & =\frac{I_{F}}{I_{\text {out }}}  \tag{12.105}\\
& =\frac{-V_{P}}{R_{F}} \cdot \frac{1}{I_{\text {out }}}  \tag{12.106}\\
& =-\frac{R_{M}}{R_{F}} \tag{12.107}
\end{align*}
$$

The closed-loop parameters are therefore given by:

$$
\begin{align*}
A_{I, \text { closed }} & =\frac{-g_{m 2} R_{D}}{1+g_{m 2} R_{D} \frac{R_{M}}{R_{F}}}  \tag{12.108}\\
R_{\text {in, closed }} & =\frac{1}{g_{m 1}} \cdot \frac{1}{1+g_{m 2} R_{D} \frac{R_{M}}{R_{F}}}  \tag{12.109}\\
R_{\text {out }, \text { closed }} & =r_{02}\left(1+g_{m 2} R_{D} \frac{R_{M}}{R_{F}}\right) . \tag{12.110}
\end{align*}
$$

Note that if $g_{m 2} R_{D} R_{M} / R_{F} \gg 1$, then the closed-loop gain is simply given by $-R_{F} / R_{M}$.
Noting that $\left.R_{\text {out }}\right|_{\text {closed }}$ is the impedance seen by the laser in the closed-loop circuit, construct a Norton equivalent for the entire circuit that drives the laser.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-07.jpg?height=1314&width=1731&top_left_y=410&top_left_x=1429)

Figure 12.48 Effect of feedback on input and output impedances.

The effect of feedback on the input and output impedances of the forward amplifier is summarized in Fig. 12.48.

## 12.7 EFFECT OF NONIDEAL I/O IMPEDANCES

Our study of feedback topologies in Section 12.6 has been based on idealized models for the feedback network, always assuming that the I/O impedances of this network are very large or very small depending on the type of feedback. In practice, however, the finite I/O impedances of the feedback network may considerably alter the performance of the circuit, thereby necessitating analysis techniques to account for these effects. In such cases, we say the feedback network "loads" the forward amplifier and the "loading effects" must be determined.

Before delving into the analysis, it is instructive to understand the difficulty in the context of an example.

Example 12.25

Suppose in the circuit of Example 12.7, $R_{1}+R_{2}$ is not much greater than $R_{D}$. How should we analyze the circuit?

Solution In Example 12.7, we constructed the open-loop circuit by simply neglecting the effect of $R_{1}+R_{2}$. Here, on the other hand, $R_{1}+R_{2}$ tends to reduce the open-loop gain because it appears in parallel with $R_{D}$. We therefore surmise that the open-loop circuit must be configured as shown in Fig. 12.49, with the open-loop gain given by

$$
\begin{equation*}
A_{O}=g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right] \tag{12.111}
\end{equation*}
$$

and the output impedance

$$
\begin{equation*}
R_{\text {out }, \text { open }}=R_{D} \|\left(R_{1}+R_{2}\right) \tag{12.112}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-08.jpg?height=697&width=731&top_left_y=719&top_left_x=2032)

Figure 12.49
Other forward and feedback parameters are identical to those calculated in Example 12.7. Thus,

$$
\begin{align*}
A_{v, \text { closed }} & =\frac{g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]}  \tag{12.113}\\
R_{\text {in,closed }} & =\frac{1}{g_{m 1}}\left\{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]\right\}  \tag{12.114}\\
R_{\text {out,closed }} & =\frac{R_{D} \|\left(R_{1}+R_{2}\right)}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]} \tag{12.115}
\end{align*}
$$

Exercise Repeat the above example if $R_{D}$ is replaced with an ideal current source.

The above example easily lends itself to intuitive inspection. But many other circuits do not. To gain more confidence in our analysis and deal with more complex circuits, we must develop a systematic approach.

### 12.7.1 Inclusion of I/O Effects

We present a methodology here that allows the analysis of the four feedback topologies even if the I/O impedances of the forward amplifier or the feedback network depart from their ideal values. The methodology is based on a formal proof that is somewhat beyond the scope of this book and can be found in [1].

Our methodology proceeds in six steps:

1. Identify the forward amplifier.
2. Identify the feedback network.
3. Break the feedback network according to the rules described below.
4. Calculate the open-loop parameters.
5. Determine the feedback factor according to the rules described below.
6. Calculate the closed-loop parameters.

Rules for Breaking the Feedback Network The third step is carried out by "duplicating" the feedback network at both the input and the output of the overall system.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-09.jpg?height=680&width=1205&top_left_y=596&top_left_x=1692)

Figure 12.50 Method of breaking the feedback loop.

Illustrated in Fig. 12.50, the idea is to "load" both the input and the output of the forward amplifier by proper copies of the feedback network. The copy tied to the output is called the "sense duplicate" and that connected to the input, the "return duplicate." We must also decide what to do with the output port of the former and the input port of the latter, i.e., whether to short or open these ports. This is accomplished through the use of the "termination" rules depicted in Fig. 12.51. For example, for voltage-voltage feedback [Fig. 12.51(a)], the output port of the sense replica is left open while the input of the return duplicate is shorted. Similarly, for voltage-current feedback [Fig. 12.51(b)], both the output port of the sense duplicate and the input port of the return duplicate are shorted.

The formal proof of these concepts is given in [1] but it is helpful to remember these rules based on the following intuitive (but not quite rigorous) observations. In an ideal situation, a feedback network sensing an output voltage is driven by a zero impedance, namely, the output impedance of the forward amplifier. Thus, the input port of the return duplicate is shorted. Moreover, a feedback network returning a voltage to the input ideally sees an infinite impedance, namely, the input impedance of the forward amplifier. Thus, the output port of the sense duplicate is left open. Similar observations apply to the other three cases.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-09.jpg?height=1279&width=2564&top_left_y=3687&top_left_x=1030)

Figure 12.51 Proper termination of duplicates in (a) voltage-voltage, (b) voltagecurrent, (c) current-current, and (d) current-voltage feedback.

Solution We identify the forward system as $M_{1}$ and $R_{D}$, and the feedback network as $R_{1}$ and $R_{2}$. We construct the open-loop circuit according to Fig. 12.51(a), as shown in Fig. 12.53(b). Note that the feedback network appears twice. The sense duplicate output port is left open and the input port of the return duplicate is shorted. The open-loop parameters of this topology were computed in Example 12.25.

To determine the feedback factor, we follow the rule in Fig. 12.52(a) to form the circuit shown in Fig. 12.53(c), arriving at

$$
\begin{align*}
K & =\frac{V_{2}}{V_{1}}  \tag{12.116}\\
& =\frac{R_{2}}{R_{1}+R_{2}} . \tag{12.117}
\end{align*}
$$

It follows that

$$
\begin{equation*}
K A_{0}=\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right] \tag{12.118}
\end{equation*}
$$

and hence

$$
\begin{align*}
A_{v, \text { closed }} & =\frac{g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]}  \tag{12.119}\\
R_{\text {in,closed }} & =\frac{1}{g_{m 1}}\left\{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]\right\}  \tag{12.120}\\
R_{\text {out }, \text { closed }} & =\frac{R_{D} \|\left(R_{1}+R_{2}\right)}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m 1}\left[R_{D} \|\left(R_{1}+R_{2}\right)\right]} \tag{12.121}
\end{align*}
$$

Obtained through our general methodology, these results agree with those found by inspection in Example 12.25.

Exercise Repeat the above analysis if $R_{D}$ is replaced with an ideal current source.

Analyze the circuit of Fig. 12.54(a) if $R_{1}+R_{2}$ is not much greater than $r_{O P} \| r_{O N}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-10.jpg?height=857&width=1051&top_left_y=3972&top_left_x=907)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-10.jpg?height=834&width=1548&top_left_y=3967&top_left_x=2143)
(b)

Figure 12.54

Solution Here, $M_{1}-M_{4}$ constitute the forward amplifier, and $R_{1}$ and $R_{2}$ the feedback network. The loop is broken in a manner similar to that in Example 12.26 because the type of feedback is the same [Fig. 12.54(b)]. The open-loop parameters are therefore given by

$$
\begin{align*}
A_{0} & =g_{m N}\left[r_{O N}\left\|r_{O P}\right\|\left(R_{1}+R_{2}\right)\right]  \tag{12.122}\\
R_{\text {in,open }} & =\infty  \tag{12.123}\\
R_{\text {out,open }} & =r_{O N}\left\|r_{O P}\right\|\left(R_{1}+R_{2}\right) . \tag{12.124}
\end{align*}
$$

The test circuit for calculation of the feedback factor is identical to that in Fig. 12.53(c), yielding

$$
\begin{equation*}
K=\frac{R_{2}}{R_{1}+R_{2}} \tag{12.125}
\end{equation*}
$$

It follows that

$$
\begin{align*}
\left.\frac{V_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }} & =\frac{g_{m N}\left[r_{O N}\left\|r_{O P}\right\|\left(R_{1}+R_{2}\right)\right]}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m N}\left[r_{O N}\left\|r_{O P}\right\|\left(R_{1}+R_{2}\right)\right]}  \tag{12.126}\\
R_{\text {in }, \text { closed }} & =\infty  \tag{12.127}\\
R_{\text {out }, \text { closed }} & =\frac{r_{O N}\left\|r_{O P}\right\|\left(R_{1}+R_{2}\right)}{1+\frac{R_{2}}{R_{1}+R_{2}} g_{m N}\left[r_{O N}\left\|r_{O P}\right\|\left(R_{1}+R_{2}\right)\right]} \tag{12.128}
\end{align*}
$$

Exercise Repeat the above example if a load resistor of $R_{L}$ is tied between the output of the circuit and ground.

Example
12.28 Analyze the circuit of Fig. 12.55(a).
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-11.jpg?height=949&width=2324&top_left_y=3778&top_left_x=1224)

Figure 12.55

We identify the forward system as $M_{1}, R_{D 1}, M_{2}$, and $R_{D 2}$. The feedback network consists of $R_{1}$ and $R_{2}$ and returns a voltage to the source of the subtracting transistor, $M_{1}$. In a manner similar to the above two examples, the open-loop circuit is constructed as shown in Fig. 12.55(b). Note that $M_{1}$ is now degenerated by $R_{1} \| R_{2}$. Writing $A_{0}=\left(V_{X} / V_{\text {in }}\right)\left(V_{\text {out }} / V_{X}\right)$, we have

$$
\begin{align*}
A_{0} & =\frac{-R_{D 1}}{\frac{1}{g_{m}}+R_{1} \| R_{2}} \cdot\left\{-g_{m 2}\left[R_{D 2} \|\left(R_{1}+R_{2}\right)\right]\right\}  \tag{12.129}\\
R_{\text {in,open }} & =\infty  \tag{12.130}\\
R_{\text {out }, \text { open }} & =R_{D 2} \|\left(R_{1}+R_{2}\right) . \tag{12.131}
\end{align*}
$$

As in the above example, the feedback factor is equal to $R_{2} /\left(R_{1}+R_{2}\right)$, yielding

$$
\begin{align*}
\left.\frac{V_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }} & =\frac{A_{0}}{1+\frac{R_{2}}{R_{1}+R_{2}} A_{0}}  \tag{12.132}\\
R_{\text {in }, \text { closed }} & =\infty  \tag{12.133}\\
R_{\text {out }, \text { closed }} & =\frac{R_{D 2} \|\left(R_{1}+R_{2}\right)}{1+\frac{R_{2}}{R_{1}+R_{2}} A_{0}} \tag{12.134}
\end{align*}
$$

where $A_{0}$ is given by Eq. (12.129).

Exercise Repeat the above example if $M_{2}$ is degenerated by a resistor of value $R_{S}$.

Analyze the circuit of Fig. 12.56(a), assuming that $R_{F}$ is not very large.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-12.jpg?height=30&width=132&top_left_y=3618&top_left_x=593)

As a voltage-current feedback topology, this circuit must be handled according to the rules in Figs. 12.51(b) and 12.52(b). The forward amplifier is formed by $M_{1}, R_{D 1}, M_{2}$, and $R_{D 2}$. The feedback network simply consists of $R_{F}$. The loop is opened as shown in Fig. 12.56(b), where, from Fig. 12.51(b), the output port of the sense duplicate is shorted. Since $I_{i n}$ splits between $R_{F}$ and $M_{1}$, we have

$$
\begin{equation*}
V_{X}=I_{i n} \frac{R_{F} R_{D 1}}{R_{F}+\frac{1}{g_{m 1}}} \tag{12.135}
\end{equation*}
$$

Noting that $R_{0}=V_{\text {out }} / I_{\text {in }}=\left(V_{X} / I_{\text {in }}\right)\left(V_{\text {out }} / V_{X}\right)$, we write

$$
\begin{equation*}
R_{0}=\frac{R_{F} R_{D 1}}{R_{F}+\frac{1}{g_{m 1}}} \cdot\left[-g_{m 2}\left(R_{D 2} \| R_{F}\right)\right] \tag{12.136}
\end{equation*}
$$

The open-loop input and output impedances are respectively given by

$$
\begin{align*}
R_{\text {in,open }} & =\frac{1}{g_{m 1}} \| R_{F}  \tag{12.137}\\
R_{\text {out }, \text { open }} & =R_{D 2} \| R_{F} \tag{12.138}
\end{align*}
$$

To obtain the feedback factor, we follow the rule in Fig. 12.52(b) and construct the test circuit shown in Fig. 12.56(c), obtaining

$$
\begin{align*}
K & =\frac{I_{2}}{V_{1}}  \tag{12.139}\\
& =-\frac{1}{R_{F}} \tag{12.140}
\end{align*}
$$

Note that both $R_{0}$ and $K$ are negative here, yielding a positive loop gain and hence confirming that the feedback is negative. The closed-loop parameters are thus expressed as

$$
\begin{align*}
\left.\frac{V_{\text {out }}}{I_{\text {in }}}\right|_{\text {closed }} & =\frac{R_{0}}{1-\frac{R_{0}}{R_{F}}}  \tag{12.141}\\
R_{\text {in }, \text { closed }} & =\frac{\frac{1}{g_{m 1}} \| R_{F}}{1-\frac{R_{0}}{R_{F}}}  \tag{12.142}\\
R_{\text {out }, \text { closed }} & =\frac{R_{D 2} \| R_{F}}{1-\frac{R_{0}}{R_{F}}} \tag{12.143}
\end{align*}
$$

where $R_{0}$ is given by Eq. (12.136).

Exercise Repeat the above example if $R_{D 2}$ is replaced with an ideal current source.

Example
12.30

Analyze the circuit of Fig. 12.57(a), assuming $R_{M}$ is not small, $r_{O 1}<\infty$, and the laser diode has an impedance of $R_{L}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-14.jpg?height=891&width=1097&top_left_y=742&top_left_x=901)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-14.jpg?height=874&width=1593&top_left_y=762&top_left_x=2183)
(b)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-14.jpg?height=880&width=1759&top_left_y=1729&top_left_x=1427)
(c)

Figure 12.57

Solution
This circuit employs current-voltage feedback and must be opened according to the rules shown in Figs. 12.51(d) and 12.52(d). The forward amplifier is formed by $M_{1}$ and $M_{3}-M_{6}$, and the feedback network consists of $R_{M}$. Depicted in Fig. 12.52(d), the openloop circuit contains two instances of the feedback network, with the output port of the sense duplicate and the input port of the return duplicate left open. The open-loop gain $G_{m}=I_{\text {out }} / V_{\text {in }}=\left(V_{X} / V_{\text {in }}\right)\left(I_{\text {out }} / V_{X}\right)$, and

$$
\begin{equation*}
\frac{V_{X}}{V_{i n}}=-g_{m 3}\left(r_{O 3} \| r_{O 5}\right) \tag{12.144}
\end{equation*}
$$

To calculate $I_{\text {out }} / V_{X}$, we note that the current produced by $M_{1}$ is divided between $r_{O 1}$ and $R_{L}+R_{M}$ :

$$
\begin{equation*}
I_{\text {out }}=-\frac{r_{O 1}}{r_{O 1}+R_{L}+R_{M}} g_{m 1} V_{X} \tag{12.145}
\end{equation*}
$$

where the negative sign arises because $I_{\text {out }}$ flows out of the transistor. The open-loop gain is therefore equal to

$$
\begin{equation*}
G_{m}=\frac{g_{m 3}\left(r_{O 3} \| r_{O 5}\right) g_{m 1} r_{O 1}}{r_{O 1}+R_{L}+R_{M}} \tag{12.146}
\end{equation*}
$$

The output impedance is measured by replacing $R_{L}$ with a test voltage source and measuring the small-signal current [Fig. 12.57(c)]. The top and bottom terminals
of $V_{X}$ respectively see an impedance of $r_{O 1}$ and $R_{M}$ to ac ground; thus,

$$
\begin{align*}
R_{\text {in,open }} & =\frac{V_{X}}{I_{X}}  \tag{12.147}\\
& =r_{O 1}+R_{M} . \tag{12.148}
\end{align*}
$$

The feedback factor is computed according to the rule in Fig. 12.52(d):

$$
\begin{align*}
K & =\frac{V_{2}}{I_{1}}  \tag{12.149}\\
& =R_{M} . \tag{12.150}
\end{align*}
$$

Forming $K G_{m}$, we express the closed-loop parameters as

$$
\begin{align*}
\left.\frac{I_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }} & =\frac{G_{m}}{1+R_{M} G_{m}}  \tag{12.151}\\
R_{\text {in }, \text { closed }} & =\infty  \tag{12.152}\\
R_{\text {out }, \text { closed }} & =\left(r_{O 1}+R_{M}\right)\left(1+R_{M} G_{m}\right) \tag{12.153}
\end{align*}
$$

where $G_{m}$ is given by Eq. (12.146).
Construct the Norton equivalent of the entire circuit that drives the laser.

Example Analyze the circuit of Fig. 12.58(a), assuming $R_{M}$ is not small, and the laser diode exhibits 12.31 an impedance of $R_{L}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-15.jpg?height=817&width=715&top_left_y=3427&top_left_x=1104)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-15.jpg?height=812&width=823&top_left_y=3424&top_left_x=1912)
(b)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-15.jpg?height=824&width=858&top_left_y=3418&top_left_x=2813)
(c)

Figure 12.58

Solution
The forward amplifier consisting of $M_{1}, R_{D}$, and $M_{2}$ senses a voltage and delivers a current to the load, and resistor $R_{M}$ plays the role of the feedback network. In a manner similar to Example 12.30, we open the loop as shown in Fig. 12.58(b), where $G_{m}=I_{\text {out }} / V_{\text {in }}=\left(V_{X} / V_{\text {in }}\right)\left(I_{\text {out }} / V_{X}\right)$. As a common-gate stage, $M_{1}$ and $R_{D}$ yield
$V_{X} / V_{\text {in }}=g_{m 1} R_{D}$. To determine $I_{\text {out }}$, we first view $M_{2}$ as a source follower and calculate the voltage gain $V_{A} / V_{X}$ from Chapter 7:

$$
\begin{equation*}
\frac{V_{A}}{V_{X}}=\frac{R_{L}+R_{M}}{R_{L}+R_{M}+\frac{1}{g_{m 2}}} \tag{12.154}
\end{equation*}
$$

Thus,

$$
\begin{align*}
I_{\text {out }} & =\frac{V_{A}}{R_{L}+R_{M}}  \tag{12.155}\\
& =\frac{V_{X}}{R_{L}+R_{M}+\frac{1}{g_{m 2}}} \tag{12.156}
\end{align*}
$$

yielding the open-loop gain as

$$
\begin{equation*}
G_{m}=\frac{g_{m 1} R_{D}}{R_{L}+R_{M}+\frac{1}{g_{m 2}}} \tag{12.157}
\end{equation*}
$$

The open-loop input impedance is equal to $1 / g_{m 1}$. For the open-loop output impedance, we replace $R_{L}$ with a test voltage source [Fig. 12.58(c)], obtaining

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{1}{g_{m 2}}+R_{M} \tag{12.158}
\end{equation*}
$$

The feedback factor remains identical to that in Example 12.30, leading to the following expressions for the closed-loop parameters:

$$
\begin{align*}
\left.\frac{I_{\text {out }}}{V_{\text {in }}}\right|_{\text {closed }} & =\frac{G_{m}}{1+R_{M} G_{m}}  \tag{12.159}\\
R_{\text {in, closed }} & =\frac{1}{g_{m 1}}\left(1+R_{M} G_{m}\right)  \tag{12.160}\\
R_{\text {out }, \text { closed }} & =\left(\frac{1}{g_{m 2}}+R_{M}\right)\left(1+R_{M} G_{m}\right) \tag{12.161}
\end{align*}
$$

where $G_{m}$ is given by Eq. (12.157).

Exercise Repeat the above example if a resistor of value of $R_{1}$ is tied between the source of $M_{2}$ and ground.

Analyze the circuit of Fig. 12.59(a), assuming $R_{F}$ is not large, $R_{M}$ is not small, and the 12.32 laser diode is modeled by a resistance $R_{L}$. Also, assume $r_{O 2}<\infty$.

Solution As a current-current feedback topology, the amplifier must be analyzed according to the rules illustrated in Figs. 12.51(c) and 12.52(c). The forward system consists of $M_{1}$, $R_{D}$, and $M_{2}$, and the feedback network includes $R_{M}$ and $R_{F}$. The loop is opened as depicted in Fig. 12.59(b), where the output port of the sense duplicate is shorted because the feedback network returns a current to the input. Given by $\left(V_{X} / I_{\text {in }}\right)\left(I_{\text {out }} / V_{X}\right)$,
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-17.jpg?height=926&width=2889&top_left_y=576&top_left_x=953)

Figure 12.59
the open-loop gain is computed as

$$
\begin{equation*}
A_{I, \text { open }}=\frac{\left(R_{F}+R_{M}\right) R_{D}}{R_{F}+R_{M}+\frac{1}{g_{m 1}}} \cdot \frac{-g_{m 2} r_{O 2}}{r_{O 2}+R_{L}+R_{M} \| R_{F}} \tag{12.162}
\end{equation*}
$$

where the two fractions account for the division of $I_{i n}$ between $R_{F}+R_{M}$ and $M_{1}$, and the division of $I_{D 2}$ between $r_{O 2}$ and $R_{L}+R_{M} \| R_{F}$.

The open-loop I/O impedances are expressed as

$$
\begin{align*}
R_{\text {in,open }} & =\frac{1}{g_{m 1}} \|\left(R_{F}+R_{M}\right)  \tag{12.163}\\
R_{\text {out,open }} & =r_{O 2}+R_{F} \| R_{M} \tag{12.164}
\end{align*}
$$

with the latter obtained in a manner similar to that depicted in Fig. 12.57(c).
To determine the feedback factor, we apply the rule of Fig. 12.52(c) as shown in Fig. 12.59(c), thereby obtaining

$$
\begin{align*}
K & =\frac{I_{2}}{I_{1}}  \tag{12.165}\\
& =-\frac{R_{M}}{R_{M}+R_{F}} \tag{12.166}
\end{align*}
$$

The closed-loop parameters are thus given by

$$
\begin{align*}
A_{I, \text { closed }} & =\frac{A_{I, \text { open }}}{1-\frac{R_{M}}{R_{M}+R_{F}} A_{I, \text { open }}}  \tag{12.167}\\
R_{\text {in }, \text { closed }} & =\frac{\frac{1}{g_{m 1}} \|\left(R_{F}+R_{M}\right)}{1-\frac{R_{M}}{R_{M}+R_{F}} A_{I, \text { open }}}  \tag{12.168}\\
R_{\text {out }, \text { closed }} & =\left(r_{O 2}+R_{F} \| R_{M}\right)\left(1-\frac{R_{M}}{R_{M}+R_{F}} A_{I, \text { open }}\right) \tag{12.169}
\end{align*}
$$

where $A_{I, \text { open }}$ is expressed by Eq. (12.162).

Exercise Construct the Norton equivalent of the entire circuit that drives the laser.

Example
12.33

Figure 12.60(a) depicts a circuit similar to that in Fig. 12.59(a), but the output of interest here is $V_{\text {out }}$. Analyze the amplifier and study the differences between the two.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-18.jpg?height=823&width=772&top_left_y=781&top_left_x=881)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-18.jpg?height=817&width=954&top_left_y=779&top_left_x=1692)
(b)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-18.jpg?height=802&width=1106&top_left_y=775&top_left_x=2626)
(c)

Figure 12.60

Solution

The circuit incorporates voltage-current feedback. In contrast to the previous case, $R_{M}$ now belongs to the forward amplifier rather than the feedback network. After all, $M_{2}$ would not be able to generate an output voltage without $R_{M}$. In fact, this circuit resembles the configuration of Fig. 12.56(a), except that the common-source stage employs a PMOS device.

Opening the loop with the aid of the rules in Fig. 12.51(b), we arrive at the topology in Fig. 12.60(b). Note that the return duplicate in this case $\left(R_{F}\right)$ differs from that in Fig. 12.59(b) $\left(R_{F}+R_{M}\right)$. The open-loop gain is then equal to

$$
\begin{align*}
R_{O} & =\frac{V_{\text {out }}}{I_{\text {in }}}  \tag{12.170}\\
& =\frac{R_{F} R_{D}}{R_{F}+\frac{1}{g_{m 1}}}\left[-g_{m 2}\left(R_{F} \| R_{M}\right)\right] \tag{12.171}
\end{align*}
$$

and the open-loop input impedance is given by

$$
\begin{equation*}
R_{\text {in,open }}=\frac{1}{g_{m 1}} \| R_{F} \tag{12.172}
\end{equation*}
$$

The output impedance is computed as illustrated in Fig. 12.60(c):

$$
\begin{align*}
R_{\text {out }, \text { open }} & =\frac{V_{X}}{I_{X}}  \tag{12.173}\\
& =R_{F} \| R_{M} \tag{12.174}
\end{align*}
$$

If $r_{O 2}<\infty$, then it simply appears in parallel with $R_{F}$ and $R_{M}$ in both Eqs. (12.171) and (12.174).

The feedback factor also differs from that in Example 12.32 and is determined with the aid of Fig. 12.52(b):

$$
\begin{align*}
K & =\frac{I_{2}}{V_{1}}  \tag{12.175}\\
& =-\frac{1}{R_{F}} \tag{12.176}
\end{align*}
$$

yielding the following expressions for the closed-loop parameters:

$$
\begin{align*}
\left.\frac{V_{\text {out }}}{I_{\text {in }}}\right|_{\text {closed }} & =\frac{R_{O}}{1-\frac{R_{O}}{R_{F}}}  \tag{12.177}\\
R_{\text {in }, \text { closed }} & =\frac{\frac{1}{g_{m 1}} \| R_{F}}{1-\frac{R_{O}}{R_{F}}}  \tag{12.178}\\
R_{\text {out }, \text { closed }} & =\frac{R_{F} \| R_{M}}{1-\frac{R_{O}}{R_{F}}} . \tag{12.179}
\end{align*}
$$

In contrast to Example 12.32 , the output impedance in this case decreases by $1-R_{O} / R_{F}$ even though the circuit topology remains unchanged. This is because the output impedance is measured very differently in the two cases.

Exercise Repeat the above example if $M_{2}$ is degenerated by a resistor of value $R_{S}$.

## 12.8 STABILITY IN FEEDBACK SYSTEMS

Our studies in this chapter have thus far revealed many important benefits of negative feedback. Unfortunately, if designed poorly, negative-feedback amplifiers may behave "badly" or even oscillate. We say the system is marginally stable or simply unstable. In this section, we reexamine our understanding of feedback so as to define the meaning of "behaving badly" and determine the sources of instability.

Did you know?

A simple feedback circuit that, in fact, creates quite a bit of confusion is the op-amp-based noninverting amplifier [Fig. (a)] or a "poor man's" realization thereof [Fig. (b)]. What type of feedback do we have here? The quantity sensed at the output is a voltage, but what is returned to the input? Since the input signal, $V_{i n}$, is a voltage quantity, we may suspect that the feedback network $\left(R_{2}\right)$ returns a voltage. However, for two voltages to add or subtract, they must be placed in series. The proper view here is to assume $R_{1}$ and $R_{2}$, respectively, convert $V_{\text {in }}$ and $V_{\text {out }}$ to current, and the resulting currents are summed at the virtual ground node, $X$. We study these commonly-used circuits in more advanced courses.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-19.jpg?height=555&width=1106&top_left_y=4454&top_left_x=1091)
(a)

Inverting amplifier with feedback.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-19.jpg?height=771&width=949&top_left_y=4198&top_left_x=2385)
(b)

### 12.8.1 Review of Bode's Rules

In our review of Bode's rules in Chapter 11, we noted that the slope of the magnitude of a transfer function decreases (increases) by $20 \mathrm{~dB} / \mathrm{dec}$ as the frequency passes a pole (zero). We now review Bode's rule for plotting the phase of the transfer function:

The phase of a transfer function begins to decrease (increase) at one-tenth of the pole (zero) frequency, incurs a change of $-45^{\circ}\left(+45^{\circ}\right)$ at the pole (zero) frequency, and experiences a total change of nearly $-90^{\circ}\left(+90^{\circ}\right)$ at ten times the pole (zero) frequency. ${ }^{14}$

Since the phase begins to change at one-tenth of a pole or zero frequency, even poles or zeros that seem far may affect it significantly-a point of contrast to the behavior of the magnitude.

Example
12.34

Figure 12.61(a) depicts the magnitude response of an amplifier. Using Bode's rule, plot the phase response. ${ }^{15}$

Solution Plotted in Fig. 12.61(b), the phase begins to fall at $0.1 \omega_{p 1}$, reaches $-45^{\circ}$ at $\omega_{p 1}$ and $-90^{\circ}$ at $10 \omega_{p 1}$, begins to rise at $0.1 \omega_{z}$, reaches $-45^{\circ}$ at $\omega_{z}$ and approximately zero at $10 \omega_{z}$, and finally begins to fall at $0.1 \omega_{p 2}$, reaching $-45^{\circ}$ at $\omega_{p 2}$ and $-90^{\circ}$ at $10 \omega_{p 2}$. In this example, we have assumed that the pole and zero frequencies are so wide apart that $10 \omega_{p 1}<0.1 \omega_{z}$ and $10 \omega_{z}<0.1 \omega_{p 2}$. In practice, this may not hold, requiring more detailed calculations.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-20.jpg?height=583&width=1582&top_left_y=2956&top_left_x=1504)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-20.jpg?height=478&width=1471&top_left_y=3631&top_left_x=1605)
(b)

Figure 12.61

Exercise Repeat the above example if $\omega_{p 1}$ falls between $\omega_{z}$ and $\omega_{p 2}$.

Amplifiers having multiple poles may become unstable if placed in a negative-feedback loop. The following example serves as our first step toward understanding this phenomenon.

[^2]Example Construct the magnitude and phase response of an amplifier having (a) one pole, 12.35 (b) two poles, or (c) three poles.

Solution Figures 12.62(a)-(c) show the response for the three cases. The phase shift between the input and the output asymptotically approaches $-90^{\circ},-180^{\circ}$, and $-270^{\circ}$ in one-pole, two-pole, and three-pole systems, respectively. An important observation here is that the three-pole system introduces a phase shift of $-180^{\circ}$ at a finite frequency $\omega_{1}$, reversing the sign of an input sinusoid at this frequency [Fig. 12.62(d)]. For example, a 1-GHz sinusoid is shifted (delayed) by 0.5 ns .
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-21.jpg?height=2484&width=2849&top_left_y=1452&top_left_x=950)

Figure 12.62

Exercise

Repeat the above analysis for a three-pole system if $\omega_{p 1}=\omega_{p 2}$.

### 12.8.2 Problem of Instability

Suppose an amplifier having a transfer function $H(s)$ is placed in a negative feedback loop (Fig. 12.63). As with the cases studied in Section 12.1, we write the closed-loop transfer function as

$$
\begin{equation*}
\frac{Y}{X}(s)=\frac{H(s)}{1+K H(s)} \tag{12.180}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-22.jpg?height=652&width=1046&top_left_y=376&top_left_x=1783)

Figure 12.63 Negative feedback system.
where $K H(s)$ is sometimes called the "loop transmission" rather than the loop gain to emphasize its frequency dependence. Recall from Chapter 11 that for a sinusoidal input, $x(t)=A \cos \omega t$, we simply make the substitution $s=j \omega$ in the above transfer function. We assume the feedback factor, $K$, exhibits no frequency dependence. (For example, it is equal to the ratio of two resistors.)

An interesting question that arises here is, what happens if at a certain input frequency $\omega_{1}$, the loop transmission, $K H\left(j \omega_{1}\right)$, becomes equal to -1 ? Then, the closed-loop system provides an infinite gain (even though the open-loop amplifier does not). To understand the consequences of infinite gain, we recognize that even an infinitesimally small input at $\omega_{1}$ leads to a finite output component at this frequency. For example, the devices comprising the subtractor generate electronic "noise" containing all frequencies. A small noise component at $\omega_{1}$ therefore experiences a very high gain and emerges as a large sinusoid at the output. We say the system oscillates at $\omega_{1}{ }^{16}$

It is also possible to understand the above oscillation phenomenon intuitively. Recall from Example 12.35 that a three-pole system introducing a phase shift of $-180^{\circ}$ reverses the sign of the input signal. Now, if $H(s)$ in Fig. 12.63 contains three poles such that $\angle H=-180^{\circ}$ at $\omega_{1}$, then the feedback becomes positive at this frequency, thereby producing a feedback signal that enhances the input. Circulating around the loop, the signal may thus continue to grow in amplitude. In practice, the final amplitude remains bounded by the supply voltage or other "saturation" mechanisms in the circuit.

For analysis purposes, we express the condition $K H\left(j \omega_{1}\right)=-1$ in a different form. Viewing $K H$ as a complex quantity, we recognize that this condition is equivalent to

$$
\begin{align*}
\mid K H\left(j \omega_{1} \mid\right. & =1  \tag{12.181}\\
\angle K H\left(j \omega_{1}\right) & =-180^{\circ} \tag{12.182}
\end{align*}
$$

the latter confirming our above intuitive perspective. In fact, Eq. (12.182) guarantees positive feedback (sufficient delay) and Eq. (12.181) ensures sufficient loop gain for the circulating signal to grow. Called "Barkhausen's criteria" for oscillation, Eqs. (12.181) and (12.182) prove extremely useful in the study of stability.

Example Explain why a two-pole system cannot oscillate. ${ }^{17}$ <br> 12.36

Solution As evident from the Bode plots in Fig. 12.62(b), the phase shift produced by such a system reaches $-180^{\circ}$ only at $\omega=\infty$, where $|H| \rightarrow 0$. In other words, at no frequency are both Eqs. (12.181) and (12.182) satisfied.

Exercise What happens if one of the poles is at the origin?

[^3]![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-23.jpg?height=1012&width=3022&top_left_y=447&top_left_x=955)

Figure 12.64 Evolution of oscillatory system with time: (a) a component at $\omega_{1}$ is sensed at input, (b) the component returns to subtractor with a $180^{\circ}$ phase shift, (c) the subtractor enhances the signal at node $B$.

In summary, a negative feedback system may become unstable if the forward amplifier introduces a phase shift of $-180^{\circ}$ at a finite frequency, $\omega_{1}$, and the loop transmission $|K H|$ is equal to unity at that frequency. These conditions become intuitive in the time domain as well. Suppose, as shown in Fig. 12.64(a), we apply a small sinusoid at $\omega_{1}$ to the system and follow it around the loop as time progresses. The sinusoid incurs a sign reversal as it emerges at the output of the forward amplifier [Fig. 12.64(b)]. Assumed frequencyindependent, the feedback factor simply scales the result by a factor of $K$, producing an inverted replica of the input at node $A$ if $\left|K H\left(j \omega_{1}\right)\right|=1$. This signal is now subtracted from the input, generating a sinusoid at node $B$ with twice the amplitude [Fig. 12.64(c)]. The signal level thus continues to grow after each trip around the loop. On the other hand, if $\left|K H\left(j \omega_{1}\right)\right|<1$, then the output cannot grow indefinitely.

A three-pole feedback system exhibits the frequency response depicted in Fig. 12.65.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-23.jpg?height=1188&width=1325&top_left_y=3693&top_left_x=1729)

Figure 12.65

Solution Yes, it does. The loop gain at $\omega_{1}$ is greater than unity, but we note from the analysis in Fig. 12.64 that indefinite signal growth still occurs, in fact more rapidly. After each trip around the loop, a sinusoid at $\omega_{1}$ experiences a gain of $|K H|>1$ and returns with opposite phase to the subtractor.

Exercise Suppose $\omega_{p 1}$ is halved in value. Does the system still oscillate?

Did you know?

We have seen that a negative-feedback system can become unstable if the loop experiences a large phase shift. Since phase shift and delay are roughly equivalent, we can say excess delay causes instability. Two people walking past each other in a narrow hallway sometimes end up dancing to the left and to the right because of the slight delay they incur in correcting themselves. A microphone connected to a speaker system (as shown in the figure below) may whistle because the sound coming back from the speaker to the microphone through the air experiences delay. In this case, the feedback system consisting of the microphone, the amplifier, the speaker, and the return path through the air oscillates. You can change the frequency of oscillation (the pitch of the whistle) by adjusting the delay.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-24.jpg?height=515&width=1479&top_left_y=2865&top_left_x=379)

Unwanted feedback from speaker to microphone.

### 12.8.3 Stability Condition

Our foregoing investigation indicates that if $\left|K H\left(j \omega_{1}\right)\right| \geq 1$ and $\angle H\left(j \omega_{1}\right)=-180^{\circ}$, then the negative feedback system oscillates. Thus, to avoid instability, we must ensure that these two conditions do not occur at the same frequency.

Figure 12.66 depicts two scenarios wherein the two conditions do not coincide. Are both of these systems stable? In Fig. 12.66(a), the loop gain at $\omega_{1}$ exceeds unity ( 0 dB ), still leading to oscillation. In Fig. 12.66(b), on the other hand, the system cannot oscillate at $\omega_{1}$ (due to insufficient phase shift) or $\omega_{2}$ (because of inadequate loop gain).

The frequencies at which the loop gain falls to unity or the phase shift reaches $-180^{\circ}$ play such a critical role as to deserve specific names. The former is called the "gain crossover frequency" $\left(\omega_{G X}\right)$ and the latter, the "phase crossover frequency" $\left(\omega_{P X}\right)$. In Fig. 12.66(b), for example, $\omega_{G X}=\omega_{1}$ and $\omega_{P X}=\omega_{2}$. The key point emerging from the two above scenarios is that stability requires that

$$
\begin{equation*}
\omega_{G X}<\omega_{P X} \tag{12.183}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-24.jpg?height=943&width=1074&top_left_y=3627&top_left_x=2374)
(b)

Figure 12.66 Systems with phase reaching $-180^{\circ}$ (a) before and (b) after the loop gain reaches unity.

In summary, to guarantee stability in negative-feedback systems, we must ensure that the loop gain falls to unity before the phase shift reaches $-180^{\circ}$ so that Barkhausen's criteria do not hold at the same frequency.

We wish to apply negative feedback with $K=1$ around the three-stage amplifier shown in Fig. 12.67(a). Neglecting other capacitances and assuming identical stages, plot the frequency response of the circuit and determine the condition for stability. Assume $\lambda=0$.

Solution The circuit exhibits a low-frequency gain of $\left(g_{m} R_{D}\right)^{3}$ and three coincident poles given by $\left(R_{D} C_{1}\right)^{-1}$. Thus, as depicted in Fig. 12.67(b), $|H|$ begins to fall at a rate of $60 \mathrm{~dB} / \mathrm{dec}$ at $\omega_{p}=\left(R_{D} C_{1}\right)^{-1}$. The phase begins to change at one-tenth of this frequency, ${ }^{18}$ reaches $-135^{\circ}$ at $\omega_{p}$, and approaches $-270^{\circ}$ at $10 \omega_{p}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-25.jpg?height=1839&width=2815&top_left_y=2100&top_left_x=978)

Figure 12.67

To guarantee that a unity-feedback system incorporating this amplifier remains stable, we must ensure that $|K H|(=|H|)$ falls below unity at the phase crossover frequency. Illustrated in Fig. 12.67(c), the procedure entails identifying $\omega_{P X}$ on the phase response, finding the corresponding point, $P$, on the gain response, and requiring that $\left|H_{P}\right|<1$.

[^4]We now repeat the procedure analytically. The amplifier transfer function is given by the product of those of the three stages: ${ }^{19}$

$$
\begin{equation*}
H(s)=\frac{\left(g_{m} R_{D}\right)^{3}}{\left(1+\frac{s}{\omega_{p}}\right)^{3}} \tag{12.184}
\end{equation*}
$$

where $\omega_{p}=\left(R_{D} C_{1}\right)^{-1}$. The phase of the transfer function can be expressed as ${ }^{20}$

$$
\begin{equation*}
\angle H(j \omega)=-3 \tan ^{-1} \frac{\omega}{\omega_{p}} \tag{12.185}
\end{equation*}
$$

where the factor 3 accounts for the three coincident poles. The phase crossover occurs if $\tan ^{-1}\left(\omega / \omega_{p}\right)=60^{\circ}$ and hence

$$
\begin{equation*}
\omega_{P X}=\sqrt{3} \omega_{p} \tag{12.186}
\end{equation*}
$$

The magnitude must remain less than unity at this frequency:

$$
\begin{equation*}
\frac{\left(g_{m} R_{D}\right)^{3}}{\left[\sqrt{1+\left(\frac{\omega_{P X}}{\omega_{p}}\right)^{2}}\right]^{3}}<1 \tag{12.187}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
g_{m} R_{D}<2 \tag{12.188}
\end{equation*}
$$

If the low-frequency gain of each stage exceeds 2 , then a feedback loop around this amplifier with $K=1$ becomes unstable.

Exercise Repeat the above example if the last stage incorporates a load resistance equal to $2 R_{D}$.

Example A common-source stage is placed in a unity-gain feedback loop as shown in Fig. 12.68.
12.39 Explain why this circuit does not oscillate.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-26.jpg?height=543&width=549&top_left_y=3427&top_left_x=2014)

Figure 12.68

Solution Since the circuit contains only one pole, the phase shift cannot reach $180^{\circ}$ at any frequency. The circuit is thus stable.

Exercise What happens if $R_{D} \rightarrow \infty$ and $\lambda \rightarrow 0$ ?

[^5]Example Repeat Example 12.38 if the target value of $K$ is $1 / 2$, i.e., the feedback is weaker.
12.40

Solution We plot $|K H|=0.5|H|$ and $\angle K H=\angle H$ as shown in Fig. 12.69(a). Note the $|K H|$ plot is simply shifted down by 6 dB on a logarithmic scale. Starting from the phase crossover frequency, we determine the corresponding point, $P$, on $|K H|$ and require that $0.5\left|H_{P}\right|<1$. Recognizing that Eqs. (12.185) and (12.186) still hold, we write

$$
\begin{equation*}
\frac{0.5\left(g_{m} R_{D}\right)^{3}}{\left[\sqrt{1+\left(\frac{\omega_{P X}}{\omega_{p}}\right)^{2}}\right]^{3}}<1 \tag{12.189}
\end{equation*}
$$

That is,

$$
\begin{equation*}
\left(g_{m} R_{D}\right)^{3}<\frac{2^{3}}{0.5} \tag{12.190}
\end{equation*}
$$

Thus, the weaker feedback permits a greater open-loop gain.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-27.jpg?height=1103&width=1388&top_left_y=2405&top_left_x=1686)

Figure 12.69

Repeat the above example if the third stage incorporates a load resistor of value $2 R_{D}$.

### 12.8.4 Phase Margin

Our study of instability in negative-feedback systems reveals that $\omega_{G X}$ must remain below $\omega_{P X}$ to avoid oscillation. But by how much? We surmise that if $\omega_{G X}<\omega_{P X}$ but the difference between the two is small, then the feedback system displays an almost-oscillatory response. Shown in Fig. 12.70 are three cases illustrating this point. In Fig. 12.70(a), Barkhausen's criteria are met and the system produces oscillation in response to an input step. In Fig. 12.70(b), $\omega_{G X}<\omega_{P X}$, but the step response "rings" for a long time because the system is "marginally" stable and behaves "badly." We therefore postulate that a
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-28.jpg?height=2958&width=2524&top_left_y=724&top_left_x=1033)
(c)

Figure 12.70 Systems with (a) coincident gain and phase crossovers, (b) gain crossover slightly below phase crossover, (c) gain crossover well below phase crossover.
well-behaved system is obtained only if a sufficient "margin" is allowed between $\omega_{G X}$ and $\omega_{P X}$ [Fig. 12.70(c)]. Note that in this case, $\angle K H$ at $\omega_{G X}$ remains significantly more positive than $-180^{\circ}$.

A measure commonly used to quantify the stability of feedback systems is the "phase margin" (PM). As exemplified by the cases in Fig. 12.70, the more stable a system is, the greater is the difference between $\angle H\left(\omega_{G X}\right)$ and $-180^{\circ}$. Indeed, this difference is called the phase margin:

$$
\begin{equation*}
\text { Phase Margin }=\angle H\left(\omega_{G X}\right)+180^{\circ} . \tag{12.191}
\end{equation*}
$$

Example
12.41

Figure 12.71 plots the frequency response of a multipole amplifier. The magnitude drops to unity at the second pole frequency. Determine the phase margin of a feedback system employing this amplifier with $K=1$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-29.jpg?height=1132&width=1160&top_left_y=998&top_left_x=1806)

Figure 12.71

Solution The plot suggests that the phase reaches $-135^{\circ}$ at the second pole frequency (i.e., the poles are far apart). Thus, the phase margin is equal to $45^{\circ}$.

Exercise Is the phase margin greater or less than $45^{\circ}$ if $K=0.5$ ?

How much phase margin is necessary? For a well-behaved response, we typically require a phase margin of $60^{\circ}$. Thus, the above example is not considered an acceptable design. In other words, the gain crossover must fall below the second pole.

### 12.8.5 Frequency Compensation

It is possible that after the design of an amplifier is completed, the phase margin proves inadequate. How is the circuit modified to improve the stability? For example, how do we make the three-stage amplifier of Example 12.38 stable if $K=1$ and $g_{m} R_{D}>2$ ? The solution is to make two of the poles unequal in magnitude. Called "frequency compensation," this task can be accomplished by shifting $\omega_{G X}$ toward the origin (without changing $\omega_{P X}$ ). In other words, if $|K H|$ is forced to drop to unity at a lower frequency, then the phase margin increases [Fig. 12.72(a)].

How can $\omega_{G X}$ be shifted toward the origin? We recognize that if the dominant pole is translated to lower frequencies, so is $\omega_{G X}$. Figure 12.72(b) illustrates an example where the first pole is shifted from $\omega_{p 1}$ to $\omega_{p 1}^{\prime}$, but other poles are constant. As a result, $\omega_{G X}$ decreases in magnitude.

What happens to the phase after compensation? As shown in Fig. 12.72(b), the lowfrequency section of $\angle K H$ changes because $\omega_{p 1}$ is moved to $\omega_{P 1}^{\prime}$, but the critical section near $\omega_{G X}$ does not. Consequently, the phase margin increases.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-30.jpg?height=1126&width=2684&top_left_y=510&top_left_x=947)

Figure 12.72 (a) Concept of frequency compensation, (b) effect on phase profile.

Example 12.42

The amplifier shown in Fig. 12.73(a) employs a cascode stage and a CS stage. Assuming that the pole at node $B$ is dominant, sketch the frequency response and explain how the circuit can be "compensated."
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-30.jpg?height=1216&width=2838&top_left_y=2326&top_left_x=876)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-30.jpg?height=652&width=1788&top_left_y=3590&top_left_x=1218)
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-30.jpg?height=475&width=1668&top_left_y=4283&top_left_x=1335)
(c)

Figure 12.73

Solution Recall from Chapter 11 that the cascode stage exhibits one pole arising from node $A$ and another from node $B$, with the latter falling much closer to the origin. We can express these poles respectively as

$$
\begin{align*}
\omega_{p, A} & \approx \frac{g_{m 2}}{C_{A}}  \tag{12.192}\\
\omega_{p, B} & \approx \frac{1}{\left[\left(g_{m 2} r_{O 2} r_{O 1}\right) \|\left(g_{m 3} r_{O 3} r_{O 4}\right)\right] C_{B}} \tag{12.193}
\end{align*}
$$

where $C_{A}$ and $C_{B}$ denote the total capacitance seen at each node to ground. The third pole is associated with the output node:

$$
\begin{equation*}
\omega_{p, \text { out }}=\frac{1}{\left(r_{O 5} \| r_{O 6}\right) C_{\text {out }}} \tag{12.194}
\end{equation*}
$$

where $C_{\text {out }}$ represents the total capacitance at the output node. We assume $\omega_{P, B}<$ $\omega_{P, \text { out }}<\omega_{P, A}$. The frequency response of the amplifier is plotted in Fig. 12.73(b).

To compensate the circuit for use in a feedback system, we can add capacitance to node $B$ so as to reduce $\omega_{p, B}$. If $C_{c o m p}$ is sufficiently large, the gain crossover occurs well below the phase crossover, providing adequate phase margin [Fig. 12.73(c)]. An important observation here is that frequency compensation inevitably degrades the speed because the dominant pole is reduced in magnitude.

Exercise Repeat the above example if $M_{2}$ and $M_{3}$ are omitted, i.e., the first stage is a simple CS amplifier.

We now formalize the procedure for frequency compensation. Given the frequency response of an amplifier and the desired phase margin, we begin from the phase response and determine the frequency, $\omega_{P M}$, at which $\angle H=-180^{\circ}+$ PM (Fig. 12.74). We then mark $\omega_{P M}$ on the magnitude response and draw a line having a slope of $20 \mathrm{~dB} / \mathrm{dec}$ toward the vertical axis. The point at which this line intercepts the original magnitude response represents the new position of the dominant pole, $\omega_{p 1}^{\prime}$. By design, the compensated amplifier now exhibits a gain crossover at $\omega_{P M}$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-31.jpg?height=994&width=1456&top_left_y=3898&top_left_x=1658)

Figure 12.74 Systematic method for frequency compensation.

| Example |
| :---: |
| 12.43 |

A multipole amplifier exhibits the frequency response plotted in Fig. 12.75(a). Assuming the poles are far apart, compensate the amplifier for a phase margin of $45^{\circ}$ with $K=1$.
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-32.jpg?height=1125&width=1308&top_left_y=796&top_left_x=1641)

Figure 12.75
Solution Since the phase reaches $-135^{\circ}$ at $\omega=\omega_{p 2}$, in this example $\omega_{P M}=\omega_{p 2}$. We thus draw a line with a slope of $-20 \mathrm{~dB} / \mathrm{dec}$ from $\omega_{p 2}$ toward the vertical axis. The dominant pole must therefore be translated to $\omega_{p 1}^{\prime}$. Since this phase margin is generally inadequate, in practice, $\omega_{P M}<\omega_{p 2}$.

Exercise Repeat the above example for $K=0.5$ and compare the results.

Did you know?

It is interesting to know how one capacitor changed the fate of a product forever. A generalpurpose, innovative op amp (LM101) introduced by Robert Widlar at National Semiconductor in 1967 employed Miller compensation but with an external 30 pF capacitor. Evidently, the compensation capacitor was left off-chip to provide greater flexibility for the user. In 1968, David Fullagar at Fairchild Semiconductor introduced another op amp very similar to the LM101, except that the compensation capacitor was integrated on the chip. This was the 741 op amp, which quickly became popular and has served the electronics industry for nearly half a century.

The reader may wonder why the line originating at $\omega_{P M}$ must rise at a slope of $20 \mathrm{~dB} / \mathrm{dec}$ (rather than 40 or $60 \mathrm{~dB} / \mathrm{dec}$ ) toward the vertical axis. Recall from Examples 12.41 and 12.43 that, for adequate phase margin, the gain crossover must occur below the second pole. Thus, the magnitude response of the compensated amplifier does not "see" the second pole as it approaches $\omega_{G X}$; i.e., the magnitude response has a slope of only $-20 \mathrm{~dB} / \mathrm{dec}$.

### 12.8.6 Miller Compensation

In Example 12.42, we noted that a capacitor can be tied from node $B$ to ground to compensate the amplifier. The required value of this capacitor may be quite large, necessitating a large area on an integrated circuit. But recall from Miller's theorem in Chapter 11 that the apparent value of a capacitor increases if the device is connected between the input and output of an inverting amplifier. We also observe that the two-stage amplifier of Fig. 12.73(a) can employ Miller multiplication because the second stage provides some voltage gain. Illustrated in Fig. 12.76, the idea
![](https://cdn.mathpix.com/cropped/2024_11_08_849de92dc48c74a3acccg-33.jpg?height=863&width=2376&top_left_y=459&top_left_x=1192)

Figure 12.76 Example of Miller compensation.
is to introduce the compensation capacitor between the input and output of the second stage, thereby creating an equivalent grounded capacitance at $B$ given by

$$
\begin{align*}
C_{e q} & =\left(1-A_{v}\right) C_{c}  \tag{12.195}\\
& =\left[1+g_{m 5}\left(r_{O 5} \| r_{O 6}\right)\right] C_{c} . \tag{12.196}
\end{align*}
$$

Called "Miller compensation," this technique reduces the required value of $C_{c}$ by a factor of $1+g_{m 5}\left(r_{O 5} \| r_{O 6}\right)$.

Miller compensation entails a number of interesting side effects. For example, it shifts not only the dominant pole but also the output pole. Such phenomena are studied in more advanced texts, e.g., [1].

## 12.9 CHAPTER SUMMARY

- Negative feedback can be used to regulate the behavior of systems that are otherwise "untamed" and poorly controlled.
- A negative feedback system consists of four components: forward system, output sense mechanism, feedback network, and input comparison mechanism.
- The loop gain of a feedback system can, in principle, be obtained by breaking the loop, injecting a test signal, and calculating the gain as the signal goes around the loop. The loop gain determines many properties of feedback systems, e.g., gain, frequency response, and I/O impedances.
- The loop gain and closed-loop gain should not be confused with each other. The latter refers to the overall gain from the main input to the main output while the feedback loop is closed.
- If the loop gain is much greater than unity, the closed-loop gain becomes approximately equal to the inverse of the feedback factor.
- Making the closed-loop gain relatively independent of the open-loop gain, negative feedback provides many useful properties: it reduces the sensitivity of the gain to component variations, load variations, frequency variations, and signal level variations.
- Amplifiers can generally be viewed as one of four types with voltage or current inputs and outputs. In the ideal case, the input impedance of a circuit is infinite if it senses a voltage or zero if it senses a current. Also, the output impedance of an ideal circuit is zero if it generates a voltage or infinite if it generates a current.
- Voltage quantities are sensed in parallel and current quantities in series. Voltage quantities are summed in series and current quantities in parallel.
- Depending on the type of the forward amplifier, four feedback topologies can be constructed. The closed-loop gain of each is equal to the open-loop gain divided by one plus the loop gain.
- A negative-feedback loop sensing and regulating the output voltage lowers the output impedance by a factor of one plus the loop gain, making the circuit a better voltage source.
- A negative-feedback loop sensing and regulating the output current raises the output impedance by a factor of one plus the loop gain, making the circuit a better current source.
- A negative-feedback loop returning a voltage to the input raises the input impedance by one plus the loop gain, making the circuit a better voltage sensor.
- A negative-feedback loop returning a current to the input lowers the input impedance by one plus the loop gain, making the circuit a better current sensor.
- If the feedback network departs from its ideal model, then it "loads" the forward amplifier characteristics. In this case, a methodical method must be followed that included the effect of finite I/O impedances.
- A high-frequency signal traveling through a forward amplifier experiences significant phase shift. With several poles, it is possible that the phase shift reaches $180^{\circ}$.
- A negative-feedback loop that introduces a large phase shift may become a positivefeedback loop at some frequency and begin to oscillate if the loop gain at that frequency is unity or higher.
- To avoid oscillation, the gain crossover frequency must fall below the phase crossover frequency.
- Phase margin is defined as $180^{\circ}$ minus the phase of the loop transmission at the gain crossover frequency.
- To ensure a well-behaved time and frequeny response, a negative-feedback system must realize sufficient phase margin, e.g., $60^{\circ}$.
- If a feedback circuit suffers from insufficient phase margin, then it must be "frequencycompensated." The most common method is to lower the dominant pole so as to reduce the gain crossover frequency (without changing the phase profile). This typically requires adding a large capacitor from the dominant pole node to ground.
- To lower the dominant pole, one can exploit Miller multiplication of capacitors.
