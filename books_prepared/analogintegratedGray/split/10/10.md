# 10. Nonlinear Analog Circuits

## 10.1 Introduction

Chapters 1 through 9 dealt almost entirely with analog circuits whose primary function is linear amplification of signals. Although some of the circuits discussed (such as Class AB output stages) were actually nonlinear in their operation, the operations performed on the signal passing through the amplifier were well approximated by linear relations.

Nonlinear operations on continuous-valued analog signals are often required in instrumentation, communication, and control-system design. These operations include modulation, demodulation, frequency translation, multiplication, and division. In this chapter, we analyze the most commonly used techniques for performing these operations within a monolithic integrated circuit. We first discuss the use of the bipolar transistor to synthesize nonlinear analog circuits and analyze the Gilbert multiplier cell, which is the basis for a wide variety of such circuits. Next we consider the application of this building block as a small-signal analog multiplier, as a modulator, as a phase comparator, and as a large-signal, four-quadrant multiplier.

Following the multiplier discussion, we introduce a highly useful circuit technique for performing demodulation of FM and AM signals and, at the same time, performing bandpass filtering. This circuit, the phase-locked-loop (PLL), is particularly well-suited to monolithic construction. After exploring the basic concepts involved, we analyze the behavior of the PLL in the locked condition, and then consider the capture transient. Finally, some methods of realizing arbitrary nonlinear transfer functions using bipolar transistors are considered.

## 10.2 Analog Multipliers Employing the Bipolar Transistor

In analog-signal processing the need often arises for a circuit that takes two analog inputs and produces an output proportional to their product. Such circuits are termed analog multipliers. In the following sections we examine several analog multipliers that depend on the exponential transfer function of bipolar transistors.

### 10.2.1 The Emitter-Coupled Pair as a Simple Multiplier

The emitter-coupled pair, shown in Fig. 10.1, was shown in Chapter 3 to produce output currents that are related to the differential input voltage by

$$
\begin{align*}
I_{c 1} & =\frac{I_{E E}}{1+\exp \left(-\frac{V_{i d}}{V_{T}}\right)}  \tag{10.1}\\
I_{c 2} & =\frac{I_{E E}}{1+\exp \left(\frac{V_{i d}}{V_{T}}\right)} \tag{10.2}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-005.jpg?height=646&width=724&top_left_y=182&top_left_x=251)

Figure 10.1 Emitter-coupled pair.
where base current has been neglected. Equations 10.1 and 10.2 can be combined to give the difference between the two output currents:

$$
\begin{equation*}
\Delta I_{c}=I_{c 1}-I_{c 2}=I_{E E} \tanh \left(\frac{V_{i d}}{2 V_{T}}\right) \tag{10.3}
\end{equation*}
$$

This relationship is plotted in Fig. 10.2 and shows that the emitter-coupled pair by itself can be used as a primitive multiplier. We first assume that the differential input voltage $V_{i d}$ is much less than $V_{T}$. If this is true, we can utilize the approximation

$$
\begin{equation*}
\tanh \frac{V_{i d}}{2 V_{T}} \approx \frac{V_{i d}}{2 V_{T}} \quad \frac{V_{i d}}{2 V_{T}} \ll 1 \tag{10.4}
\end{equation*}
$$

And (10.3) becomes

$$
\begin{equation*}
\Delta I_{c} \approx I_{E E}\left(\frac{V_{i d}}{2 V_{T}}\right) \tag{10.5}
\end{equation*}
$$

The current $I_{E E}$ is actually the bias current for the emitter-coupled pair. With the addition of more circuitry, we can make $I_{E E}$ proportional to a second input signal $V_{i 2}$, as shown in
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-005.jpg?height=479&width=743&top_left_y=1800&top_left_x=261)

Figure 10.2 The dc transfer characteristic of the emitter-coupled pair.
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-006.jpg?height=962&width=676&top_left_y=198&top_left_x=265)
I_{c 3} & =\frac{I_{c 1}}{1+\exp \left(-\frac{V_{1}}{V_{T}}\right)}  \tag{10.8}\\
I_{c 4} & =\frac{I_{c 1}}{1+\exp \left(\frac{V_{1}}{V_{T}}\right)} \tag{10.9}
\end{align*}

Similarly, the collector currents of $Q_{5}$ and $Q_{6}$ are given by

$$
\begin{align*}
I_{c 5} & =\frac{I_{c 2}}{1+\exp \left(\frac{V_{1}}{V_{T}}\right)}  \tag{10.10}\\
I_{c 6} & =\frac{I_{c 2}}{1+\exp \left(-\frac{V_{1}}{V_{T}}\right)}
\end{align*}
$$

The two currents $I_{c 1}$ and $I_{c 2}$ can be related to $V_{2}$ by again using (10.1) and (10.2)

$$
\begin{align*}
I_{c 1} & =\frac{I_{E E}}{1+\exp \left(-\frac{V_{2}}{V_{T}}\right)}  \tag{10.12}\\
I_{c 2} & =\frac{I_{E E}}{1+\exp \left(\frac{V_{2}}{V_{T}}\right)} \tag{10.13}
\end{align*}
$$

Combining (10.8) through (10.13), we obtain expressions for collector currents $I_{c 3}, I_{c 4}, I_{c 5}$, and $I_{c 6}$ in terms of input voltages $V_{1}$ and $V_{2}$.

$$
\begin{gather*}
I_{c 3}=\frac{I_{E E}}{\left[1+\exp \left(-\frac{V_{1}}{V_{T}}\right)\right]\left[1+\exp \left(-\frac{V_{2}}{V_{T}}\right)\right]}  \tag{10.14}\\
I_{c 4}=\frac{I_{E E}}{\left[1+\exp \left(-\frac{V_{2}}{V_{T}}\right)\right]\left[1+\exp \left(\frac{V_{1}}{V_{T}}\right)\right]}  \tag{10.15}\\
I_{c 5}=\frac{I_{E E}}{\left[1+\exp \left(\frac{V_{1}}{V_{T}}\right)\right]\left[1+\exp \left(\frac{V_{2}}{V_{T}}\right)\right]}  \tag{10.16}\\
I_{c 6}=\frac{I_{E E}}{\left[1+\exp \left(\frac{V_{2}}{V_{T}}\right)\right]\left[1+\exp \left(-\frac{V_{1}}{V_{T}}\right)\right]}
\end{gather*}
$$

The differential output current is then given by

$$
\begin{align*}
\Delta I & =I_{c 3-5}-I_{c 4-6}=I_{c 3}+I_{c 5}-\left(I_{c 6}+I_{c 4}\right) \\
& =\left(I_{c 3}-I_{c 6}\right)-\left(I_{c 4}-I_{c 5}\right)  \tag{10.18}\\
& =I_{E E}\left[\tanh \left(\frac{V_{1}}{2 V_{T}}\right)\right]\left[\tanh \left(\frac{V_{2}}{2 V_{T}}\right)\right] \tag{10.19}
\end{align*}
$$

The dc transfer characteristic, then, is the product of the hyperbolic tangent of the two input voltages.

Practical applications of the multiplier cell can be divided into three categories according to the magnitude relative to $V_{T}$ of applied signals $V_{1}$ and $V_{2}$. If the magnitude of $V_{1}$ and $V_{2}$ are kept small with respect to $V_{T}$, the hyperbolic tangent function can be approximated as linear and the circuit behaves as a multiplier, developing the product of $V_{1}$ and $V_{2}$. However, by including nonlinearity to compensate for the hyperbolic tangent function in series with each input, the range of input voltages over which linearity is maintained can be greatly extended. This technique is used in so-called four-quadrant analog multipliers.

The second class of applications is distinguished by the application to one of the inputs of a signal that is large compared to $V_{T}$, causing the transistors to which that signal is applied to behave like switches rather than near-linear devices. This effectively multiplies the applied small signal by a square wave, and in this mode of operation the circuit acts as a modulator.

In the third class of applications, the signals applied to both inputs are large compared to $V_{T}$, and all six transistors in the circuit behave as nonsaturating switches. This mode of operation is useful for the detection of phase differences between two amplitude-limited signals, as is required in phase-locked loops, and is sometimes called the phase-detector mode.

We first consider the application of the circuit as an analog multiplier of two continuous signals.

### 10.2.3 The Gilbert Cell as an Analog Multiplier

As mentioned earlier, the hyperbolic tangent function may be represented by the infinite series:

$$
\begin{equation*}
\tanh x=x-\frac{x^{3}}{3} \cdots \tag{10.20}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-009.jpg?height=1016&width=913&top_left_y=205&top_left_x=262)

Figure 10.5 Gilbert multiplier with emitter degeneration applied to improve input voltage range on $V_{2}$ input.

Assuming that $x$ is much less than one, the hyperbolic tangent can then be approximated by

$$
\begin{equation*}
\tanh x \approx x \tag{10.21}
\end{equation*}
$$

Applying this relation to (10.19), we have

$$
\begin{equation*}
\Delta I \approx I_{E E}\left(\frac{V_{1}}{2 V_{T}}\right)\left(\frac{V_{2}}{2 V_{T}}\right) \quad V_{1}, V_{2} \ll V_{T} \tag{10.22}
\end{equation*}
$$

Thus for small-amplitude signals, the circuit performs an analog multiplication. Unfortunately, the amplitudes of the input signals are often much larger than $V_{T}$, but larger signals can be accommodated in this mode in a number of ways. In the event that only one of the signals is large compared to $V_{T}$, emitter degeneration can be utilized in the lower emitter-coupled pair, increasing the linear input range for $V_{2}$ as shown in Fig. 10.5. Unfortunately, this cannot be done with the cross-coupled pairs $Q_{3}-Q_{6}$ because the degeneration resistors destroy the required nonlinear relation between $I_{c}$ and $V_{b e}$ in those devices.

An alternate approach is to introduce a nonlinearity that predistorts the input signals to compensate for the hyperbolic tangent transfer characteristic of the basic cell. The required nonlinearity is an inverse hyperbolic tangent characteristic, and a hypothetical example of such a system is shown in Fig. 10.6. Fortunately, this particular nonlinearity is straightforward to generate.

Referring to Fig. 10.7, we assume for the time being that the circuitry within the box develops a differential output current that is linearly related to the input voltage $V_{1}$. Thus

$$
\begin{align*}
& I_{1}=I_{o 1}+K_{1} V_{1}  \tag{10.23}\\
& I_{2}=I_{o 1}-K_{1} V_{1} \tag{10.24}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-010.jpg?height=824&width=987&top_left_y=208&top_left_x=428)

Figure 10.6 Gilbert multiplier with predistortion circuits.
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-010.jpg?height=692&width=662&top_left_y=1117&top_left_x=272)

Figure 10.7 Inverse hyperbolic tangent circuit.

Here $I_{o 1}$ is the dc current that flows in each output lead if $V_{1}$ is equal to zero, and $K_{1}$ is the transconductance of the voltage-to-current converter. The differential voltage developed across the two diode-connected transistors is

$$
\begin{align*}
\Delta V & =V_{T} \ln \left(\frac{I_{o 1}+K_{1} V_{1}}{I_{S}}\right)-V_{T} \ln \left(\frac{I_{o 1}-K_{1} V_{1}}{I_{S}}\right) \\
& =V_{T} \ln \left(\frac{I_{o 1}+K_{1} V_{1}}{I_{o 1}-K_{1} V_{1}}\right) \tag{10.25}
\end{align*}
$$

This function can be transformed using the identity

$$
\begin{equation*}
\tanh ^{-1} x=\frac{1}{2} \ln \left(\frac{1+x}{1-x}\right) \tag{10.26}
\end{equation*}
$$

into the desired relationship.

$$
\begin{equation*}
\Delta V=2 V_{T} \tanh ^{-1}\left(\frac{K_{1} V_{1}}{I_{o 1}}\right) \tag{10.27}
\end{equation*}
$$

Thus if this functional block is used as the compensating nonlinearity in series with each input as shown in Fig. 10.6, the overall transfer characteristic becomes, using (10.19),

$$
\begin{equation*}
\Delta I=I_{E E}\left(\frac{K_{1} V_{1}}{I_{o 1}}\right)\left(\frac{K_{2} V_{2}}{I_{o 2}}\right) \tag{10.28}
\end{equation*}
$$

where $I_{o 2}$ and $K_{2}$ are the parameters of the functional block following $V_{2}$.
Equation 10.28 shows that the differential output current is directly proportional to the product $V_{1} V_{2}$, and, in principle, this relationship holds for all values of $V_{1}$ and $V_{2}$ for which the two output currents of the differential voltage-to-current converters are positive. For this to be true, $I_{1}$ and $I_{2}$ must always be positive, and from (10.23) and (10.24), we have

$$
\begin{align*}
& -\frac{I_{o 1}}{K_{1}}<V_{1}<\frac{I_{o 1}}{K_{1}}  \tag{10.29}\\
& -\frac{I_{o 2}}{K_{2}}<V_{2}<\frac{I_{o 2}}{K_{2}} \tag{10.30}
\end{align*}
$$

Note that the inclusion of a compensating nonlinearity on the $V_{2}$ input simply makes the collector currents of $Q_{1}$ and $Q_{2}$ directly proportional to input voltage $V_{2}$ rather than to its hyperbolic tangent. Thus the combination of the pair $Q_{1}-Q_{2}$ and the compensating nonlinearity on the $V_{2}$ input is redundant, and the output currents of the voltage-to-current converter on the $V_{2}$ input can be fed directly into the emitters of the $Q_{3}-Q_{4}$ and $Q_{5}-Q_{6}$ pairs with exactly the same results. The multiplier then takes on the form shown in Fig. 10.8.

### 10.2.4 A Complete Analog Multiplier ${ }^{2}$

In order to be useful in a wide variety of applications, the multiplier circuit must develop an output voltage that is referenced to ground and can take on both positive and negative values. The transistors $Q_{3}, Q_{4}, Q_{5}, Q_{6}, Q_{7}$, and $Q_{8}$, shown in Fig. 10.8 , are referred to as the multiplier core and produce a differential current output that then must be amplified, converted to a single-ended signal, and referenced to ground. An output amplifier is thus required, and the complete multiplier consists of two voltage-current converters, the core transistors, and an output current-to-voltage amplifier. While the core configuration of Fig. 10.8 is common to most four-quadrant transconductance multipliers, the rest of the circuitry can be realized in a variety of ways.

The most common configurations used for the voltage-current converters are emittercoupled pairs with emitter degeneration as shown in Fig. 10.5. The differential-to-single-ended converter of Fig. 10.8 is often realized with an op amp circuit of the type shown in Fig. 6.4. If this circuit has a transresistance given by

$$
\begin{equation*}
\frac{V_{\text {out }}}{\Delta I}=K_{3} \tag{10.31}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-012.jpg?height=771&width=1035&top_left_y=208&top_left_x=404)

Figure 10.8 Complete four-quadrant multiplier.
then substitution in (10.28) gives for the overall multiplier characteristic

$$
\begin{equation*}
V_{\text {out }}=I_{E E} K_{3} \frac{K_{1}}{I_{o 1}} \frac{K_{2}}{I_{o 2}} V_{1} V_{2} \tag{10.32}
\end{equation*}
$$

The output voltage is thus proportional to the product $V_{1} V_{2}$ over a wide range. The constants in (10.32) are usually chosen so that

$$
\begin{equation*}
V_{\text {out }}=0.1 V_{1} V_{2} \tag{10.33}
\end{equation*}
$$

and all voltages have $\mathrm{a} \pm 10-\mathrm{V}$ range.

### 10.2.5 The Gilbert Multiplier Cell as a Balanced Modulator and Phase Detector

The four-quadrant multiplier just described is an example of an application of the multiplier cell in which all the devices remain in the active region during normal operation. Used in this way the circuit is capable of performing precise multiplication of one continuously varying analog signal by another. In communications systems, however, the need frequently arises for the multiplication of a continuously varying signal by a square wave. This is easily accomplished with the multiplier circuit by applying a sufficiently large signal (i.e., large compared to $2 V_{T}$ ) directly to the cross-coupled pair so that two of the four transistors alternately turn completely off and the other two conduct all the current. Since the transistors in the circuit do not enter saturation, this process can be accomplished at high speed. A set of typical waveforms that might result when a sinusoid is applied to the small-signal input and a square wave to the large-signal input is shown in Fig. 10.9. Note that since the devices in the multiplier are being switched on and off by the incoming square wave, the amplitude of the output waveform is independent of the amplitude of the square wave as long as it is large enough to cause the devices in the multiplier circuit to be fully on or fully off. Thus the circuit in this mode does not perform a linear multiplication of two waveforms, but actually causes the output voltage of the circuit produced by the small-signal input to be alternately multiplied by +1 and -1 .
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-013.jpg?height=724&width=1190&top_left_y=192&top_left_x=319)

Figure 10.9 Input and output waveforms for a phase detector with large input signals.

The spectrum of the output may be developed directly from the Fourier series of the two inputs. For the low-frequency modulating sinusoidal input,

$$
\begin{equation*}
V_{m}(t)=V_{m} \cos \omega_{m} t \tag{10.34}
\end{equation*}
$$

and for the high-frequency square wave input, which we assume has an amplitude of $\pm 1$ as discussed above,

$$
\begin{equation*}
V_{c}(t)=\sum_{n=1}^{\infty} A_{n} \cos n \omega_{c} t, \quad A_{n}=\frac{\sin \frac{n \pi}{2}}{\frac{n \pi}{4}} \tag{10.35}
\end{equation*}
$$

Thus the output signal is

$$
\begin{align*}
V_{o}(t) & =K\left[V_{c}(t) V_{m}(t)\right]=K \sum_{n=1}^{\infty} A_{n} V_{m} \cos \omega_{n} t \cos n \omega_{c} t  \tag{10.36}\\
& =K \sum_{n=1}^{\infty} \frac{A_{n} V_{m}}{2}\left[\cos \left(n \omega_{c}+\omega_{m}\right) t+\cos \left(n \omega_{c}-\omega_{m}\right) t\right] \tag{10.37}
\end{align*}
$$

where $K$ is the magnitude of the gain of the multiplier from the small-signal input to the output.
The spectrum has components located at frequencies $\omega_{m}$ above and below each of the harmonics of $\omega_{c}$, but no component at the carrier frequency $\omega_{c}$ or its harmonics. The spectrum of the input signals and the resulting output signal is shown in Fig. 10.10. The lack of an output component at the carrier frequency is a very useful property of balanced modulators. The signal is usually filtered following the modulation process so that only the components near $\omega_{c}$ are retained.

If a dc component is added to the modulating input, the result is a signal component in the output at the carrier frequency and its harmonics. If the modulating signal is given by

$$
\begin{equation*}
V_{m}(t)=V_{m}\left(1+M \cos \omega_{m} t\right) \tag{10.38}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-014.jpg?height=957&width=854&top_left_y=191&top_left_x=254)

Figure 10.10 Input and output spectra for a balanced modulator.
where the parameter $M$ is called the modulation index, then the output is given by

$$
\begin{equation*}
V_{o}(t)=K \sum_{n=1}^{\infty} A_{n} V_{m}\left[\cos \left(n \omega_{c} t\right)+\frac{M}{2} \cos \left(n \omega_{c}+\omega_{m}\right) t+\frac{M}{2} \cos \left(n \omega_{c}-\omega_{m}\right) t\right] \tag{10.39}
\end{equation*}
$$

This dc component can be introduced intentionally to provide conventional amplitude modulation or it can be the result of offset voltages in the devices within the modulator, which results in undesired carrier feedthrough in suppressed-carrier modulators.

Note that the balanced modulator actually performs a frequency translation. Information contained in the modulating signal $V_{m}(t)$ was originally concentrated at the modulating frequency $\omega_{m}$. The modulator has translated this information so that it is now contained in spectral components located near the harmonics of the high-frequency signal $V_{c}(t)$, usually called the carrier. Balanced modulators are also useful for performing demodulation, which is the extraction of information from the frequency band near the carrier and retranslation of the information back down to low frequencies.

In frequency translation, signals at two different frequencies are applied to the two inputs, and the sum or the difference frequency component is taken from the output. If unmodulated signals of identical frequency $\omega_{o}$ are applied to the two inputs, the circuit behaves as a phase detector and produces an output whose dc component is proportional to the phase difference between the two inputs. For example, consider the two input waveforms in Fig. 10.11, which are applied to the Gilbert multiplier shown in the same figure. We assume first for simplicity that both inputs are large in magnitude so that all the transistors in the circuit are behaving as switches. The output waveform that results is shown in Fig. 10.11c and consists of a dc component and a component at twice the incoming frequency. The dc component of this
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-015.jpg?height=1503&width=1119&top_left_y=192&top_left_x=382)

Figure 10.11 Typical input and output waveforms for a phase detector.
waveform is given by

$$
\begin{align*}
V_{\text {average }} & =\frac{1}{2 \pi} \int_{0}^{2 \pi} V_{o}(t) d\left(\omega_{0} t\right)  \tag{10.40}\\
& =\frac{-1}{\pi}\left(A_{1}-A_{2}\right) \tag{10.41}
\end{align*}
$$

where areas $A_{1}$ and $A_{2}$ are as indicated in Fig. 10.11c. Thus,

$$
\begin{align*}
V_{\text {average }} & =-\left[I_{E E} R_{C} \frac{(\pi-\phi)}{\pi}-\frac{I_{E E} R_{C} \phi}{\pi}\right]  \tag{10.42}\\
& =I_{E E} R_{C}\left(\frac{2 \phi}{\pi}-1\right) \tag{10.43}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-016.jpg?height=537&width=832&top_left_y=207&top_left_x=265)

Figure 10.12 Phase detector output versus phase difference.

This phase relationship is plotted in Fig. 10.12. This phase demodulation technique is widely used in phase-locked loops.

We assumed above that the input waveforms were large in amplitude and were square waves. If the input signal amplitude is large, the actual waveform shape is unimportant since the multiplier simply switches from one state to the other at the zero crossings of the waveform. For the case in which the amplitude of one or both of the input signals has an amplitude comparable to or smaller than $V_{T}$, the circuit still acts as a phase detector. However, the output voltage then depends both on the phase difference and on the amplitude of the two input waveforms. The operation of the circuit in this mode is considered further in Section 10.3.3.

## 10.3 Phase-Locked Loops (PLL)

The phase-locked loop concept was first developed in the 1930s. ${ }^{3}$ It has since been used in communications systems of many types, particularly in satellite communications systems. Until recently, however, phase-locked systems have been too complex and costly for use in most consumer and industrial systems, where performance requirements are more modest and other approaches are more economical. The PLL is particularly amenable to monolithic construction, however, and integrated-circuit phase-locked loops can now be fabricated at very low cost. ${ }^{4}$ Their use has become attractive for many applications such as FM demodulators, stereo demodulators, tone detectors, frequency synthesizers, and others. In this section we first explore the basic operation of the PLL, and then consider analytically the performance of the loop in the locked condition. We then discuss the design of monolithic PLLs.

### 10.3.1 Phase-Locked Loop Concepts

A block diagram of the basic phase-locked loop system is shown in Fig. 10.13. The elements of the system are a phase comparator, a loop filter, an amplifier, and a voltage-controlled oscillator. The voltage-controlled oscillator, or VCO, is simply an oscillator whose frequency is proportional to an externally applied voltage. When the loop is locked on an incoming periodic signal, the VCO frequency is exactly equal to that of the incoming signal. The phase detector produces a dc or low-frequency signal proportional to the phase difference between the incoming signal and the VCO output signal. This phase-sensitive signal is then passed through the loop filter and amplifier and is applied to the control input of the VCO. If, for example, the frequency of the incoming signal shifts slightly, the phase difference between
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-017.jpg?height=280&width=1043&top_left_y=203&top_left_x=390)

Figure 10.13 Phase-locked-loop system.
the VCO signal and the incoming signal will begin to increase with time. This will change the control voltage on the VCO in such a way as to bring the VCO frequency back to the same value as the incoming signal. Thus the loop can maintain lock when the input signal frequency changes, and the VCO input voltage is proportional to the frequency of the incoming signal. This behavior makes PLLs particularly useful for the demodulation of FM signals, where the frequency of the incoming signal varies in time and contains the desired information. The range of input signal frequencies over which the loop can maintain lock is called the lock range.

An important aspect of PLL performance is the capture process, by which the loop goes from the unlocked, free-running condition to that of being locked on a signal. In the unlocked condition, the VCO runs at the frequency corresponding to zero applied dc voltage at its control input. This frequency is called the center frequency, or free-running frequency. When a periodic signal is applied that has a frequency near the free-running frequency, the loop may or may not lock on it depending on a number of factors. The capture process is inherently nonlinear in nature, and we will describe the transient in only a qualitative way.

First assume that the loop is opened between the loop filter and the VCO control input, and that a signal whose frequency is near, but not equal to, the free-running frequency is applied to the input of the PLL. The phase detector is usually of the type discussed in the last section, but for this qualitative discussion we assume that the phase detector is simply an analog multiplier that multiplies the two sinusoids together. Thus the output of the multiplierphase detector contains the sum and difference frequency components, and we assume that the sum frequency component is sufficiently high in frequency that it is filtered out by the low-pass filter. The output of the low-pass filter, then, is a sinusoid with a frequency equal to the difference between the VCO free-running frequency and the incoming signal frequency.

Now assume that the loop is suddenly closed, and the difference frequency sinusoid is now applied to the VCO input. This will cause the VCO frequency itself to become a sinusoidal function of time. Let us assume that the incoming frequency was lower than the free-running frequency. Since the VCO frequency is varying as a function of time, it will alternately move closer to the incoming signal frequency and farther away from the incoming signal frequency. The output of the phase detector is a near-sinusoid whose frequency is the difference between the VCO frequency and the input frequency. When the VCO frequency moves away from the incoming frequency, this sinusoid moves to a higher frequency. When the VCO frequency moves closer to the incoming frequency, the sinusoid moves to a lower frequency. If we examine the effect of this on the phase detector output, we see that the frequency of this sinusoidal difference-frequency waveform is reduced when its incremental amplitude is negative, and increased when its amplitude is positive. This causes the phase detector output to have an asymmetrical waveform during capture, as shown in Fig. 10.14. This asymmetry in the waveform introduces a dc component in the phase detector output that shifts the average VCO frequency toward the incoming signal frequency, so that the difference frequency gradually decreases. Once the system becomes locked, of course, the difference frequency becomes zero and only a dc voltage remains at the loop-filter output.
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-018.jpg?height=479&width=893&top_left_y=212&top_left_x=269)

Figure 10.14 Typical phase detector output during capture transient.

The capture range of the loop is that range of input frequencies around the center frequency onto which the loop will become locked from an unlocked condition. The pull-in time is the time required for the loop to capture the signal. Both these parameters depend on the amount of gain in the loop itself, and the bandwidth of the loop filter. The objective of the loop filter is to filter out difference components resulting from interfering signals far away from the center frequency. It also provides a memory for the loop in case lock is momentarily lost due to a large interfering transient. Reducing the loop filter bandwidth thus improves the rejection of out-of-band signals, but, at the same time, the capture range is decreased, the pull-in time becomes longer, and the loop phase margin becomes poorer.

### 10.3.2 The Phase-Locked Loop in the Locked Condition

Under locked conditions, a linear relationship exists between the output voltage of the phase detector and the phase difference between the VCO and the incoming signal. This fact allows the loop to be analyzed using standard linear feedback concepts when in the locked condition. A block diagram representation of the system in this mode is shown in Fig. 10.15. The gain of the phase comparator is $K_{D} \mathrm{~V} / \mathrm{rad}$ of phase difference, the loop-filter transfer function is $F(s)$, and any gain in the forward loop is represented by $A$. The VCO gain is $K_{o} \mathrm{rad} / \mathrm{s}$ per volt.

If a constant input voltage is applied to the VCO control input, the output frequency of the VCO remains constant. However, the phase comparator is sensitive to the difference between the phase of the VCO output and the phase of the incoming signal. The phase of the VCO output is actually equal to the time integral of the VCO output frequency, since

$$
\begin{equation*}
\omega_{\mathrm{osc}}(t)=\frac{d \phi_{\mathrm{osc}}(t)}{d t} \tag{10.44}
\end{equation*}
$$

and thus

$$
\begin{equation*}
\phi_{\mathrm{osc}}(t)=\left.\phi_{\mathrm{osc}}\right|_{t=0}+\int_{0}^{t} \omega_{\mathrm{osc}}(t) d t \tag{10.45}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-018.jpg?height=313&width=1006&top_left_y=1927&top_left_x=416)

Figure 10.15 Block diagram of the PLL system.

Thus an integration inherently takes place within the phase-locked loop. This integration is represented by the $1 / s$ block in Fig. 10.15.

For practical reasons, the VCO is actually designed so that when the VCO input voltage (i.e., $V_{o}$ ) is zero, the VCO frequency is not zero. The relation between the VCO output frequency $\omega_{\text {osc }}$ and $V_{o}$ is actually

$$
\omega_{\mathrm{osc}}=\omega_{o}+K_{O} V_{o}
$$

where $\omega_{o}$ is the free-running frequency that results when $V_{o}=0$.
The system can be seen from Fig. 10.15 to be a classical linear feedback control system. ${ }^{5}$ The closed-loop transfer function is given by

$$
\begin{align*}
\frac{V_{o}}{\phi_{i}} & =\frac{K_{D} F(s) A}{1+K_{D} F(s) A \frac{K_{o}}{s}}  \tag{10.46}\\
& =\frac{s K_{D} F(s) A}{s+K_{D} K_{O} A F(s)} \tag{10.47}
\end{align*}
$$

Usually we are interested in the response of this loop to frequency variations at the input, so that the input variable is frequency rather than phase. Since

$$
\begin{equation*}
\omega_{i}=\frac{d \phi_{i}}{d t} \tag{10.48}
\end{equation*}
$$

then

$$
\begin{equation*}
\omega_{i}(s)=s \phi_{i}(s) \tag{10.49}
\end{equation*}
$$

and

$$
\begin{equation*}
\frac{V_{o}}{\omega_{i}}=\frac{1}{s} \frac{V_{o}}{\phi_{i}}=\frac{K_{D} F(s) A}{s+K_{D} K_{O} A F(s)} \tag{10.50}
\end{equation*}
$$

We first consider the case in which the loop filter is removed entirely, and $F(s)$ is unity. This is called a first-order loop and we have

$$
\begin{equation*}
\frac{V_{o}}{\omega_{i}}=\left(\frac{K_{v}}{s+K_{v}}\right)\left(\frac{1}{K_{O}}\right) \tag{10.51}
\end{equation*}
$$

where

$$
\begin{equation*}
K_{v}=K_{O} K_{D} A \tag{10.52}
\end{equation*}
$$

Thus the loop inherently produces a first-order, low-pass transfer characteristic. Remember that we regard the input variable as the frequency $\omega_{i}$ of the incoming signal. The response calculated above, then, is really the response from the frequency modulation on the incoming carrier to the loop voltage output.

The constant above $\left(K_{v}\right)$ is termed the loop bandwidth. If the loop is locked on a carrier signal, and the frequency of that carrier is made to vary sinusoidally in time with a frequency $\omega_{m}$, then a sinusoid of frequency $\omega_{m}$ will be observed at the loop output. When $\omega_{m}$ is increased above $K_{v}$, the magnitude of the sinusoid at the output falls. The loop bandwidth $K_{v}$, then, is the effective bandwidth for the modulating signal that is being demodulated by the PLL. In terms of the loop parameters, $K_{v}$ is simply the product of the phase detector gain, VCO gain, and any other electrical gain in the loop. The root locus of this single pole as a function of loop gain $K_{v}$ is shown in Fig. 10.16a. The frequency response is also shown in this figure. The response of the loop to variations in input frequency is illustrated in Fig. $10.16 b$ and by the following example.
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-020.jpg?height=1707&width=1173&top_left_y=198&top_left_x=333)

Parameters for example:
$\omega_{o}=$ Oscillator free-run frequency $=500 \mathrm{~Hz}$
$K_{O}=1 \mathrm{kHz} / \mathrm{V}$
$K_{v}=500 \mathrm{~s}^{-1}$
(b)

Figure 10.16 (a) Root locus and frequency response of a first-order, phase-locked loop. (b) Response of the loop output voltage to step changes in input frequency, example first-order loop.

#### EXAMPLE

A PLL has a $K_{O}$ of $2 \pi(1 \mathrm{kHz} / \mathrm{V})$, a $K_{v}$ of $500 \mathrm{~s}^{-1}$, and a free-running frequency of 500 Hz .
(a) For a constant input signal frequency of 250 Hz and 1 kHz , find $V_{o}$.

$$
V_{o}=\frac{\omega_{i}-\omega_{o}}{K_{O}}
$$

where

$$
\omega_{o}=\text { oscillator free-running frequency }
$$

At 250 Hz

$$
V_{o}=\frac{2 \pi(250 \mathrm{~Hz})-2 \pi(500 \mathrm{~Hz})}{2 \pi(1 \mathrm{kHz} / \mathrm{V})}=-0.25 \mathrm{~V}
$$

At 1 kHz

$$
V_{o}=\frac{2 \pi(1 \mathrm{kHz})-2 \pi(500 \mathrm{~Hz})}{2 \pi(1 \mathrm{kHz} / \mathrm{V})}=+0.5 \mathrm{~V}
$$

(b) Now the input signal is frequency modulated, so that

$$
\omega_{i}(t)=(2 \pi) 500 \mathrm{~Hz}\left[1+0.1 \sin \left(2 \pi \times 10^{2}\right) t\right]
$$

Find the output signal $V_{o}(t)$. From (10.51) we have

$$
\begin{aligned}
\frac{V_{o}(j \omega)}{\omega_{i}(j \omega)} & =\frac{1}{K_{O}}\left(\frac{K_{v}}{K_{v}+j \omega}\right)=\frac{1}{K_{O}}\left[\frac{K_{v}}{K_{v}+j\left(2 \pi \times 10^{2}\right)}\right] \\
& =\frac{1}{2 \pi(1 \mathrm{kHz} / \mathrm{V})}\left(\frac{500}{500+j 628}\right) \\
& =\frac{1}{2 \pi(1 \mathrm{kHz} / \mathrm{V})}(0.39-j 0.48)
\end{aligned}
$$

The magnitude of $\omega_{i}(j \omega)$ is

$$
\left|\omega_{i}(j \omega)\right|=(0.1)(500 \mathrm{~Hz})(2 \pi)=(50)(2 \pi)
$$

Therefore

$$
V_{o}(j \omega)=\frac{50 \mathrm{~Hz}}{1 \mathrm{kHz}}(0.39-j 0.48)=\frac{50}{1000}\left(0.62 \angle-51^{\circ}\right)
$$

and

$$
V_{o}(t)=0.031 \sin \left[\left(2 \pi \times 10^{2} t\right)-51^{\circ}\right]
$$

Operating the loop with no loop filter has several practical drawbacks. Since the phase detector is really a multiplier, it produces a sum frequency component at its output as well as the difference frequency component. This component at twice the carrier frequency will be fed directly to the output if there is no loop filter. Also, all the out-of-band interfering signals present at the input will appear, shifted in frequency, at the output. Thus, a loop filter is very desirable in applications where interfering signals are present.

The most common configuration for integrated circuit PLLs is the second-order loop. Here, loop filter $F(s)$ is simply a single-pole, low-pass filter, usually realized with a single
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-022.jpg?height=810&width=1195&top_left_y=203&top_left_x=324)

Figure 10.17 Root locus and frequency response of second-order, phase-locked loop.
resistor and capacitor. Thus

$$
\begin{equation*}
F(s)=\left(\frac{1}{1+\frac{s}{\omega_{1}}}\right) \tag{10.53}
\end{equation*}
$$

By substituting into (10.50), the transfer function becomes

$$
\begin{equation*}
\frac{V_{o}}{\omega_{1}}(s)=\frac{1}{K_{O}}\left(\frac{1}{1+\frac{s}{K_{v}}+\frac{s^{2}}{\omega_{1} K_{v}}}\right) \tag{10.54}
\end{equation*}
$$

The root locus for this feedback system as $K_{v}$ varies is shown in Fig. 10.17, along with the corresponding frequency response. The roots of the transfer function are

$$
\begin{equation*}
s=-\frac{\omega_{1}}{2}\left(1 \pm \sqrt{1-\frac{4 K_{v}}{\omega_{1}}}\right) \tag{10.55}
\end{equation*}
$$

Equation 10.54 can be expressed as

$$
\begin{equation*}
\frac{V_{o}}{\omega_{i}}=\frac{1}{K_{O}}\left(\frac{1}{\frac{s^{2}}{\omega_{n}^{2}}+\frac{2 \zeta}{\omega_{n}} s+1}\right) \tag{10.56}
\end{equation*}
$$

where

$$
\begin{align*}
\omega_{n} & =\sqrt{K_{v} \omega_{1}}  \tag{10.57}\\
\zeta & =\frac{1}{2} \sqrt{\frac{\omega_{1}}{K_{v}}} \tag{10.58}
\end{align*}
$$

The basic factor setting the loop bandwidth is $K_{v}$ as in the first-order case. The magnitude $\omega_{1}$ of the additional pole is then made as low as possible without causing an unacceptable amount of peaking in the frequency response. This peaking is of concern both because it distorts the demodulated FM output and because it causes the loop to ring, or experience a poorly damped oscillatory response, when a transient disturbs the loop. A good compromise is using a maximally flat low-pass pole configuration in which the poles are placed on radials angled $45^{\circ}$ from the negative real axis. For this response, the damping factor $\zeta$ should be equal to $1 / \sqrt{2}$. Thus

$$
\begin{equation*}
\frac{1}{\sqrt{2}}=\frac{1}{2} \sqrt{\frac{\omega_{1}}{K_{v}}} \tag{10.59}
\end{equation*}
$$

and

$$
\begin{equation*}
\omega_{1}=2 K_{v} \tag{10.60}
\end{equation*}
$$

The $-3-\mathrm{dB}$ frequency of the transfer function $\left(V_{o} / \omega_{i}\right)(j \omega)$ is then

$$
\begin{equation*}
\omega_{-3 \mathrm{~dB}}=\omega_{n}=\sqrt{K_{v} \omega_{1}}=\sqrt{2} K_{v} \tag{10.61}
\end{equation*}
$$

A disadvantage of the second-order loop as discussed thus far is that the $-3-\mathrm{dB}$ bandwidth of the loop is basically dictated by loop gain $K_{v}$ as shown by (10.61). As we will show, the loop gain also sets the lock range, so that with the simple filter used above these two parameters are constrained to be comparable. Situations do arise in phase-locked communications in which a wide lock range is desired for tracking large signal-frequency variations, yet a narrow loop bandwidth is desired for rejecting out-of-band signals. Using a very small $\omega_{1}$ would accomplish this were it not for the fact that this produces underdamped loop response. By adding a zero to the loop filter, the loop filter pole can be made small while still maintaining good loop dampening.

The effect of the addition of a zero on the loop response is best seen by examining the open-loop response of the circuit. Shown in Fig. $10.18 a$ is the open-loop response of the circuit with no loop filter. Because of the integration inherent in the loop, the response has a $-20-\mathrm{dB} /$ decade slope throughout the frequency range and crosses unity gain at $K_{v}$. In Fig. $10.18 b$, a loop filter in which $\omega_{1}$ is much less than $K_{v}$ has been added, and, as a result, the loop
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-023.jpg?height=702&width=861&top_left_y=1578&top_left_x=261)

Figure 10.18 (a) PLL open-loop response with no loop filter.
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-024.jpg?height=1452&width=855&top_left_y=197&top_left_x=271)

Figure 10.18 (b) PLL open-loop response with a single-pole filter and $\omega_{1} \ll K_{v}$.

Figure 10.18 (c) PLL open-loop response with a zero added in loop filter at $s=-\omega_{2}$.
phase shift is very nearly $180^{\circ}$ at the crossover frequency. The result is a sharp peak in the closed-loop frequency response at the crossover frequency. By adding a zero in the loop filter at $\omega_{2}$, as shown in Fig. 10.18c, the loop phase margin can be greatly improved. Note that for this case the loop bandwidth, which is equal to the crossover frequency, is much lower than $K_{v}$. This ability to set loop bandwidth and $K_{\nu}$ independently is an advantage of this type of loop filter. An R-C circuit that provides the necessary pole and zero in the filter response is shown in Fig. 10.18d. The root locus for this loop filter and the resulting closed-loop response are also shown.

Loop Lock Range. The loop lock range is the range of input frequencies about the center frequency for which the loop maintains lock. In most cases, it is limited by the fact that the phase comparator has a limited phase comparison range; once the phase difference between
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-025.jpg?height=1166&width=1177&top_left_y=199&top_left_x=326)

Figure 10.18 (d) Root locus and frequency response of a second-order PLL with a zero. Frequency response shown is for large loop gain such that poles are located as shown in the root locus.
the input signal and the VCO output reaches some critical value, the phase comparator ceases to behave linearly. The transfer characteristic of a typical analog phase comparator is shown in Fig. 10.12. It is clear from this figure that in order to maintain lock, the phase difference between the VCO output and the incoming signal must be kept between zero and $\pi$. If the phase difference is equal to either zero or $\pi$, then the magnitude of the dc voltage at the output of the phase comparator is

$$
\begin{equation*}
V_{o(\max )}= \pm K_{D}\left(\frac{\pi}{2}\right) \tag{10.62}
\end{equation*}
$$

This dc voltage is amplified by the electrical gain $A$, and the result is applied to the VCO input, producing a frequency shift away from the free-running center frequency of

$$
\begin{equation*}
\Delta \omega_{\mathrm{osc}}=K_{D} A K_{O}\left(\frac{\pi}{2}\right)=\left(\frac{K_{v} \pi}{2}\right) \tag{10.63}
\end{equation*}
$$

If the input frequency is now shifted away from the free-running frequency, more voltage will have to be applied to the VCO in order for the VCO frequency to shift accordingly. However, the phase detector can produce no more dc output voltage to shift the VCO frequency further,
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-026.jpg?height=1028&width=847&top_left_y=202&top_left_x=270)

Figure 10.19 PLL output versus frequency of input.
so the loop will lose lock. The lock range $\omega_{L}$ is then given by

$$
\begin{equation*}
\omega_{L}=K_{v} \frac{\pi}{2} \tag{10.64}
\end{equation*}
$$

This is the frequency range on either side of the free-running frequency for which the loop will track input frequency variations. It is a parameter that depends only on the dc gain in the loop and is independent of the properties of the loop filter. Other types ${ }^{6}$ of phase detectors can give larger linear ranges of phase-comparator operation.

The capture range is the range of input frequencies for which the initially unlocked loop will lock on an input signal when initially in an unlocked condition and is always less than the lock range. When the input frequency is swept through a range around the center frequency, the output voltage as a function of input frequency displays a hysteresis effect, as shown in Fig. 10.19. As discussed earlier, the capture range is difficult to predict analytically. As a very rough rule of thumb, the approximate capture range can be estimated using the following procedure: Refer to Fig. 10.13 and assume that the loop is opened at the loop-amplifier output and that a signal with a frequency not equal to the free-running VCO frequency is applied at the input of the PLL. The sinusoidal difference frequency component that appears at the output of the phase detector has the value

$$
\begin{equation*}
V_{p}(t)=\frac{\pi}{2} K_{D} \cos \left(\omega_{i}-\omega_{\mathrm{osc}}\right) t \tag{10.65}
\end{equation*}
$$

where $\omega_{i}$ is the input signal frequency and $\omega_{\text {osc }}$ is the VCO free-running frequency. This component is passed through the loop filter, and the output from the loop amplifier resulting
from this component is

$$
\begin{equation*}
V_{o}(t)=\frac{\pi}{2} K_{D} A\left|F\left[j\left(\omega_{i}-\omega_{\mathrm{osc}}\right)\right]\right| \cos \left[\left(\omega_{i}-\omega_{\mathrm{osc}}\right) t+\phi\right] \tag{10.66}
\end{equation*}
$$

where

$$
\phi=\angle F\left[j\left(\omega_{i}-\omega_{\mathrm{osc}}\right)\right]
$$

The output from the loop amplifier thus consists of a sinusoid at the difference frequency whose amplitude is reduced by the loop filter. In order for capture to occur, the magnitude of the voltage that must be applied to the VCO input is

$$
\begin{equation*}
\left|V_{\mathrm{osc}}\right|=\frac{\omega_{i}-\omega_{\mathrm{osc}}}{K_{O}} \tag{10.67}
\end{equation*}
$$

The capture process itself is rather complex, but the capture range can be estimated by setting the magnitudes of (10.66) and (10.67) equal. The result is that capture is likely to occur if the following inequality is satisfied:

$$
\begin{equation*}
\left|\left(\omega_{i}-\omega_{\mathrm{osc}}\right)\right|<\frac{\pi}{2} K_{D} K_{O} A\left|F\left[j\left(\omega_{i}-\omega_{\mathrm{osc}}\right)\right]\right| \tag{10.68}
\end{equation*}
$$

This equation implicitly gives an estimation of the capture range. For the first-order loop, where $F(s)$ is unity, it predicts that the lock range and capture range are approximately equal, and that for the second-order loop the capture range is significantly less than the lock range because $\left|F\left[j\left(\omega_{i}-\omega_{\text {oss }}\right)\right]\right|$ is then less than unity.

### 10.3.3 Integrated-Circuit Phase-Locked Loops

The principal reason that PLLs have come to be widely used as system components is that the elements of the phase-locked loop are particularly suited to monolithic construction, and complete PLL systems can be fabricated on a single chip. We now discuss the design of the individual PLL components.

Phase Detector. Phase detectors for monolithic PLL applications are generally of the Gilbert multiplier configuration shown in Fig. 10.4. As illustrated in Fig. 10.11, if two signals large enough in amplitude to cause limiting in the emitter-coupled pairs making up the circuit are applied to the two inputs, the output will contain a dc component given by

$$
\begin{equation*}
V_{\text {average }}=-I_{E E} R_{C}\left(1-\frac{2 \phi}{\pi}\right) \tag{10.69}
\end{equation*}
$$

where $\phi$ is the phase difference between the input signals. An important aspect of the performance of this phase detector is that if the amplitude of the applied signal at $V_{\mathrm{in} 2}$ is small compared to the thermal voltage $V_{T}$, the circuit behaves as a balanced modulator, and the dc compartment of the output depends on the amplitude of the low-level input. The output waveform is then a sinusoid multiplied by a synchronous square wave, as shown in Fig. 10.20. In the limiting case when the small input is small compared to $V_{T}$, the dc component in the output becomes, referring to Fig. 10.20,

$$
\begin{align*}
V_{\text {average }} & =\frac{1}{\pi} g_{m} R_{C} V_{i}\left[\int_{0}^{\phi}(\sin \omega t) d(\omega t)-\int_{\phi}^{\pi}(\sin \omega t) d(\omega t)\right]  \tag{10.70}\\
& =-\frac{2 g_{m} R_{C} V_{i} \cos \phi}{\pi} \tag{10.71}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-028.jpg?height=347&width=545&top_left_y=209&top_left_x=625)
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-028.jpg?height=808&width=602&top_left_y=574&top_left_x=616)

Figure 10.20 Sinusoid multiplied by a synchronous square wave.
where $R_{C}$ is the collector resistor in the Gilbert multiplier and $g_{m}$ is the transconductance of the transistors. The phase detector output voltage then becomes proportional to the amplitude $V_{i}$ of the incoming signal, and if the signal amplitude varies, then the loop gain of the phaselocked loop changes. Thus when the signal amplitude varies, it is often necessary to precede the phase detector with an amplifier/limiter to avoid this problem. In FM demodulators, for example, any amplitude modulation appearing on the incoming frequency-modulated signal will be demodulated, producing an erroneous output.

In PLL applications the frequency response of the phase detector is usually not the limiting factor in the usable operating frequency range of the loop itself. At high operating frequencies, the parasitic capacitances of the devices result in a feedthrough of the carrier frequency, giving an erroneous component in the output at the center frequency. This component is removed by the loop filter, however, and does not greatly affect loop performance. The VCO is usually the limiting factor in the operating frequency range.

Voltage-Controlled Oscillator. The operating frequency range, FM distortion, centerfrequency drift, and center-frequency supply-voltage sensitivity are all determined by the performance of the VCO. Integrated-circuit VCOs often are simply R-C multivibrators in which the charging current in the capacitor is varied in response to the control input. We first consider the emitter-coupled multivibrator as shown in Fig. 10.21a, which is typical of those
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-029.jpg?height=1001&width=856&top_left_y=196&top_left_x=263)

Figure 10.21 (a) Voltagecontrolled, emitter-coupled multivibrator.
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-029.jpg?height=771&width=832&top_left_y=1208&top_left_x=265)

Figure 10.21 (b) Equivalent circuit during one half-cycle.
used in this application. We calculate the period by first assuming that $Q_{1}$ is turned off and $Q_{2}$ is turned on. The circuit then appears as shown in Fig. 10.21b. We assume that current $I$ is large so that the voltage drop $I R$ is large enough to turn on diode $Q_{6}$. Thus the base of $Q_{4}$ is one diode drop below $V_{C C}$, the emitter is two diode drops below $V_{C C}$, and the base of $Q_{1}$ is two diode drops below $V_{C C}$. If we can neglect the base current of $Q_{3}$, its base is at $V_{C C}$ and its
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-030.jpg?height=1486&width=864&top_left_y=203&top_left_x=490)

Figure 10.21 (c) Waveforms within the emitter-coupled multivibrator.
emitter is one diode drop below $V_{C C}$. Thus the emitter of $Q_{2}$ is two diode drops below $V_{C C}$. Since $Q_{1}$ is off, the current $I_{1}$ is charging the capacitor so that the emitter of $Q_{1}$ is becoming more negative. $Q_{1}$ will turn on when the voltage at its emitter becomes equal to three diode drops below $V_{C C}$. Transistor $Q_{1}$ will then turn on, and the resulting collector current in $Q_{1}$ turns on $Q_{5}$. As a result, the base of $Q_{3}$ moves in the negative direction by one diode drop, causing the base of $Q_{2}$ to move in the negative direction by one diode drop. $Q_{2}$ will turn off, causing the base of $Q_{1}$ to move positive by one diode drop because $Q_{6}$ also turns off. As a result, the emitter-base junction of $Q_{2}$ is reverse biased by one diode drop because the voltage on $C$ cannot change instantaneously. Current $I_{1}$ must now charge the capacitor voltage in the negative direction by an amount equal to two diode drops before the circuit will switch back again. Since the circuit is symmetrical, the half period is given by the time required to charge
the capacitor and is

$$
\begin{equation*}
\frac{T}{2}=\frac{Q}{I_{1}} \tag{10.72}
\end{equation*}
$$

where $Q=C \Delta V=2 C V_{B E(\text { on })}$ is the charge on the capacitor. The frequency of the oscillator is thus

$$
\begin{equation*}
f=\frac{1}{T}=\frac{I_{1}}{4 C V_{B E(\mathrm{on})}} \tag{10.73}
\end{equation*}
$$

The various waveforms in the circuit are shown in Fig. 10.21c. This emitter-coupled configuration is nonsaturating and contains only npn transistors. Furthermore, the voltage swings within the circuit are small. As a result, the circuit is capable of operating up to approximately 1 GHz for typical integrated-circuit transistors. However, the usable frequency range is limited to a value lower than this because the center frequency drift with temperature variations becomes large at the higher frequencies. This drift occurs because the switching transients themselves become a large percentage of the period of the oscillation, and the duration of the switching transients depends on circuit parasitics, circuit resistances, transistor transconductance, and transistor input resistance, which are all temperature sensitive.

Although the emitter-coupled configuration is capable of high operating speed, it displays considerable sensitivity of center frequency to temperature even at low frequencies, since the period is dependent on $V_{B E(\text { on })}$. Utilizing $(10.73)$ we can calculate the temperature coefficient of the center frequency as

$$
\begin{equation*}
\frac{1}{\omega_{\mathrm{osc}}} \frac{d \omega_{\mathrm{osc}}}{d T}=-\frac{1}{V_{B E(\mathrm{on})}} \frac{d V_{B E(\mathrm{on})}}{d T}=\frac{+2 \mathrm{mV} /{ }^{\circ} \mathrm{C}}{600 \mathrm{mV}}=+3300 \mathrm{ppm} /{ }^{\circ} \mathrm{C} \tag{10.74}
\end{equation*}
$$

This temperature sensitivity of center frequency can be compensated by causing current $I_{1}$ to be temperature sensitive in such a way that its effect is equal and opposite to the effect of the variation of $V_{B E(\text { on })}$.

## 10.4 Nonlinear Function Synthesis

The need often arises in electronic systems for circuits with arbitrary nonlinear transfer functions. For example, a common need is for square-law and square-root transfer characteristics in order to generate true rms quantities. The unique, precision exponential transfer characteristic of the bipolar transistor can be used ${ }^{7,8}$ to generate these and many other nonlinear functions.

Consider the circuit shown in Fig. 10.22a. We have

$$
\begin{equation*}
V_{B E 1}+V_{B E 2}-V_{B E 3}-V_{B E 4}=0 \tag{10.75}
\end{equation*}
$$

Neglecting base currents and assuming all devices are forward active, we find

$$
V_{T} \ln \frac{I_{B}}{I_{S 1}}+V_{T} \ln \frac{I_{i}}{I_{S 2}}-V_{T} \ln \frac{I_{o}}{I_{S 3}}-V_{T} \ln \frac{I_{o}}{I_{S 4}}=0
$$

and thus

$$
\begin{equation*}
I_{o}=\sqrt{I_{i}} \sqrt{I_{B}} \sqrt{\frac{I_{S 3} I_{S 4}}{I_{S 1} I_{S 2}}} \tag{10.76}
\end{equation*}
$$

This circuit thus realizes a square-root transfer function with a scale factor set only by the bias current $I_{B}$ (which could be another input signal) and device area ratios. There is no (first-order) dependence on supply voltage or temperature. Not that the input current source
![](https://cdn.mathpix.com/cropped/2024_11_07_9972cfe7f689622347f7g-032.jpg?height=1421&width=940&top_left_y=187&top_left_x=226)

Figure 10.22 Bipolar nonlinear function circuits. (a) Square root. (b) Square law.
$I_{i}$ must be capable of working into a dc bias voltage of one $V_{B E}$ set by $Q_{1}$. The small-signal input impedance of the circuit is very low due to the feedback provided by $Q_{1}$ and $Q_{2}$. Since all nodes in the circuit are low impedance, parasitic capacitance has little influence, and the bandwidth of the circuit can be on the order of the device $f_{T}$.

For the circuit in Fig. $10.22 b$ we have

$$
\begin{equation*}
V_{B E 1}+V_{B E 5}+V_{B E 2}=V_{B E 3}+V_{B E 4}+V_{B E 6} \tag{10.77}
\end{equation*}
$$

from which

$$
\begin{equation*}
I_{o}=I_{i}^{2} \frac{I_{B 1}}{I_{B 2}^{2}} \frac{I_{S 3} I_{S 4} I_{S 6}}{I_{S 1} I_{S 5} I_{S 2}} \tag{10.78}
\end{equation*}
$$

Thus this circuit realizes the square-law transfer function with very wide bandwidth and insensitivity to temperature and supply voltage. Simpler versions of this circuit can be derived if the current source $I_{B 1}$ is used as a signal input. However, this requires that $I_{B 1}$ be realized by an active $p n p$ current source (or a PMOS current source in BiCMOS technology), which will usually restrict the circuit bandwidth.
