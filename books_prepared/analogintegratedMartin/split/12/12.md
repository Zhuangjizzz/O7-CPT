# 12 Continuous-Time Filters

Integrated analog filters can be realized in either discrete time or continuous time. Discrete-time filters and signal processing are addressed in Chapter 13 and their implementation, switched-capacitor circuits, are discussed in Chapter 14. In switched-capacitor circuits, although the signals remain continuous in voltage (i.e., they are never quantized) they require sampling in the time domain. Because of this time-domain sampling, the clock rate must always be at least twice that of the highest frequency being processed to eliminate aliasing. In fact, typically the clock rate is much greater than twice the signal bandwidth, to reduce the requirements of an anti-aliasing filter. As a result, switched-capacitor filters are limited in their ability to process high-frequency signals.

This chapter focuses on continuous-time filtering. As their name suggests, continuous-time filters have signals that remain continuous in time and that have analog signal levels. Since no sampling is required, continuous-time filters have a significant speed advantage over their switched-capacitor counterparts. However, continuous-time filters do have some disadvantages. One is their need for tuning circuitry. Tuning is required because their filter coefficients are determined by the product of two dissimilar elements, such as capacitance and resistance (or transconductance) values. Thus, whereas switched-capacitor filter coefficients are determined by capacitance ratios and therefore have accuracies of 0.1 percent, integrated continuous-time coefficients are initially set to only

Key Point: Continuous-time integrated analog filters process signals that are both continuous in amplitude and time. Discrete-time analog filters process signals sampled in time, and therefore generally operate on lower-frequency signals than their continuoustime counterparts.
about 30 -percent accuracy! Fortunately, tuning circuitry can set the filter coefficient accuracy to around 1 percent at the cost of more (and sometimes complex) circuitry, as we will see in Section 12.9. Another practical disadvantage exhibited by most continuous-time filters is their relatively poor linearity and noise performance. Although low-frequency switched-capacitor filters have been realized with nonlinear distortion and noise performance better than 90 dB , high-frequency continuous-time filters typically have distortion plus noise performance not much better than 60 dB (often it is much worse). However, there are numerous high-speed applications in which distortion and noise performances are not too demanding, such as many data communication and video circuits.

## 12.1 INTRODUCTION TO CONTINUOUS-TIME FILTERS

The basics of first- and second-order transfer functions were presented in Section 4.1. In analog filters, these transfer functions are realized by combinations of integrators, summers, and gain elements. These are the fundamental building blocks of integrated continuous-time filters. Combining these elements, any rational transfer function may be realized.

Key Point: Integrators, summers, and gain stages are the fundamental building blocks of analog filters.

Key Point: Any rational transfer function with real-valued coefficients may be factored into first- and second-order terms and, therefore, implemented as a cascade of first- and second-order filters.

Any rational transfer function with real-valued coefficients may be factored into first- and second-order terms that also have real-valued coefficients, so any order filter can be realized by cascading first- and second-order sections. Such a cascade is common in practice, and we therefore restrict ourselves to a discussion of first- and second-order filters here.

### 12.1.1 First-Order Filters

Key Point: One integrator is required for each pole in an analog filter.

A block diagram for a general first-order continuous-time filter is shown in Fig. 12.1. It is composed of one integrator, one summer, and up to three gain elements. In general, the number of integrators required is equal to the order of the desired transfer function.

It can be shown that the transfer function for this block diagram is given by

$$
\begin{equation*}
H(s) \equiv \frac{V_{\text {out }}(s)}{V_{\text {in }}(s)}=\frac{k_{1} s+k_{0}}{s+\omega_{0}} \tag{12.1}
\end{equation*}
$$

It has a real pole at a frequency $\omega_{0}$. To ensure the pole is in the left half of the s-plane, the value of $\omega_{0}$ must be positive. The dc gain is $H(0)=k_{0} / \omega_{0}$, and the gain at very high frequencies is $H(\infty)=k_{1}$.

### 12.1.2 Second-Order Filters

Second-order filters are also called biquadratic filters or biquads for short because in their most general form their transfer function is the ratio of two quadratic polynomials. The block diagram of a practical implementation is shown in Fig. 12.2. The transfer function for this second-order filter is given by
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-070.jpg?height=272&width=798&top_left_y=1243&top_left_x=496)

Fig. 12.1 A block diagram of a general first-order continuous-time filter.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-070.jpg?height=439&width=1092&top_left_y=1657&top_left_x=358)

Fig. 12.2 A block diagram of a general second-order (biquadratic) continuous-time filter.

$$
\begin{equation*}
H(s) \equiv \frac{V_{\text {out }}(s)}{V_{\text {in }}(s)}=\frac{k_{2} s^{2}+k_{1} s+k_{0}}{s^{2}+\left(\frac{\omega_{0}}{Q}\right) s+\omega_{0}^{2}} \tag{12.2}
\end{equation*}
$$

The system's poles, like any linear system, can be determined by considering the system's undriven behavior, $\mathrm{V}_{\text {in }}=0$, and are therefore independent of the feed-in gains, $\mathrm{k}_{1,2,3}$. Two integrators are needed to realize the two poles. To ensure stability, $\omega_{0} / Q$ must be positive, which implies that one of the two integrators in Fig. 12.2 must have negative feedback around it, making it lossy. A large feedback coefficient $\omega_{0} / Q$ implies a very lossy integrator and, therefore, a low $Q$-factor. With $Q<1 / 2$ the two poles are real, whereas with $\mathrm{Q}>1 / 2$ the poles form a complex-conjugate pair arranged as illustrated in Fig. 4.9.

The numerator of (12.2) and hence the zeros of the biquad are determined by the feed-in gains $\mathrm{k}_{1,2,3}$. By omitting some of the feed-in branches of Fig. 12.2, it can be used to realize either low-pass, high-pass, or band-pass biquads.

#### EXAMPLE 12.1

Find the gain coefficients in the biquad of Fig. 12.2 required to realize a low-pass transfer function with a dc gain of $6 \mathrm{~dB}, Q=1 / \sqrt{2}$, and a $3-\mathrm{dB}$ bandwidth of $\omega_{3-\mathrm{dB}}=10^{6} \mathrm{rad} / \mathrm{sec}$.

#### Solution

A low-pass biquad is obtained with $\mathrm{k}_{1}=\mathrm{k}_{2}=0$.

$$
\begin{equation*}
H(s)=\frac{k_{0}}{s^{2}+\left(\frac{\omega_{0}}{Q}\right) s+\omega_{0}^{2}} \tag{12.3}
\end{equation*}
$$

The $3-\mathrm{dB}$ bandwidth is the frequency at which the magnitude of the denominator is $\sqrt{2}$ times larger than its dc value, which for $Q=1 / \sqrt{2}$ is the solution to

$$
\begin{align*}
\left|-\omega_{3-\mathrm{dB}}^{2}+\mathrm{j} \sqrt{2} \omega_{0} \omega_{3-\mathrm{dB}}+\omega_{\mathrm{o}}^{2}\right| & =\sqrt{2} \omega_{\mathrm{o}}^{2}  \tag{12.4}\\
\Rightarrow \omega_{3-\mathrm{dB}} & =\omega_{0}
\end{align*}
$$

Hence, in this case $\omega_{0}=10^{6}$. Finally, for a dc gain of $6 \mathrm{~dB}, \mathrm{k}_{0} / \omega_{0}^{2}=2 \Rightarrow \mathrm{k}_{0}=2 \omega_{0}^{2}$. The block diagram of Fig. 12.2 may be simplified somewhat by incorporating a gain $\omega_{0}$ into each integrator, resulting in the biquad of Fig. 12.3.

## 12.2 INTRODUCTION TO $\mathrm{G}_{\mathrm{m}}$-C FILTERS

This section gives a brief introduction to $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filters. We will see here that the main circuit building blocks of $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filters are transconductors. The basic functions of transconductors are described in this section, and circuit techniques for realizing transconductors are presented in the following sections.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-072.jpg?height=323&width=1088&top_left_y=176&top_left_x=358)

Fig. 12.3 The biquad filter of Example 12.1.

### 12.2.1 Integrators and Summers

Key Point: In $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filters, integrators are realized with a transconductor, which produces a output current proportional to the input voltage, and a capacitor, which integrates the current to produce the output voltage.

An integrator is the main building block for most continuous-time filters. To realize an integrator in $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ technology, a transconductor and a capacitor can be used as shown in Fig. 12.4. A transconductor is essentially a transconductance cell (an input voltage creates an output current) with the additional requirement that the output current be linearly related to the input voltage. Here, the output of the transconductor is the current $i_{0}$, and, in the ideal case, both the input and output impedance of this block are infinite. The output current is linearly related to the differential input voltage signal by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o}}=\mathrm{G}_{\mathrm{m}} \mathrm{v}_{\mathrm{i}} \tag{12.5}
\end{equation*}
$$

where $G_{m}$ is the transconductance of the cell. It should be re-emphasized that this relationship is different from that of an operational-transconductance amplifier (OTA) in that here, the output current should be linearly related to the input voltage. In addition, a transconductor should have a well-known (or at least controllable) transconductance value. In the case of an OTA, the transconductance does not necessarily need to be a linear function of the input voltage or a well-controlled value (though usually the transconductance value should be as large as possible).

This output current is applied to the integrating capacitor, $\mathrm{C}_{1}$, resulting in the voltage across $\mathrm{C}_{1}$ being given by

$$
\begin{equation*}
V_{o}=\frac{I_{0}}{s C_{1}}=\frac{G_{m} V_{i}}{s C_{1}} \tag{12.6}
\end{equation*}
$$

Defining $\omega_{\mathrm{ti}}$ to be the unity-gain frequency of the integrator, we can write

$$
\begin{equation*}
V_{o} \equiv\left(\frac{\omega_{i t}}{s}\right) V_{i}=\left(\frac{G_{m}}{s C_{i}}\right) V_{i} \tag{12.7}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-072.jpg?height=320&width=1035&top_left_y=1783&top_left_x=371)

Fig. 12.4 $A$ single-ended $G_{m}-C$ integrator.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-073.jpg?height=448&width=1053&top_left_y=180&top_left_x=371)

Fig. 12.5 A three-input, single-ended integrator/summer circuit.

Thus, we see that the output voltage is equal to the integration of the differential input voltage multiplied by the integrator unity-gain frequency, which is given by

$$
\begin{equation*}
\omega_{\mathrm{ti}}=\frac{\mathrm{G}_{\mathrm{m}}}{\mathrm{C}_{1}} \tag{12.8}
\end{equation*}
$$

To realize a more general integrator/summer circuit, one need only connect multiple transconductors in parallel since the output currents all sum together. An example of a three-input integrator/summer circuit is shown in Fig. 12.5.

Key Point: Current signals are readily summed by simply shorting them together.

#### EXAMPLE 12.2

What transconductance is needed for an integrator that has a unity-gain frequency of 20 MHz , assuming a 2-pF integrating capacitor?

#### Solution

Rearranging (12.8), we have

$$
\begin{align*}
\mathrm{G}_{\mathrm{m}} & =2 \pi \times 20 \mathrm{MHz} \times 2 \mathrm{pF}  \tag{12.9}\\
& =0.251 \mathrm{~mA} / \mathrm{V}
\end{align*}
$$

Note that this transconductance value corresponds to

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=1 / 3.98 \mathrm{k} \Omega \tag{12.10}
\end{equation*}
$$

which, not surprisingly, is related to the unity-gain frequency by

$$
\begin{equation*}
2 \pi \times 20 \mathrm{MHz}=\frac{1}{3.98 \mathrm{k} \Omega \times 2 \mathrm{pF}} \tag{12.11}
\end{equation*}
$$

In other words, the required transconductance value is the inverse of the resistance value needed to form an RC time constant that corresponds to the desired unity-gain frequency.

### 12.2.2 Fully Differential Integrators

Key Point: Fully-differential circuits are often preferred in analog integrated circuits as they provide improved linearity and noise immunity.

Although the preceding blocks have all been shown with single-ended signals, ${ }^{1}$ in most integrated applications it is desirable to keep the signals fully differential. As discussed in Section 6.7, fully differential circuits have better noise immunity and distortion properties. Thus, fully differential circuits are the primary focus of the remainder of this chapter.

A fully differential transconductor has two outputs-one positive output (current flowing out for a positive input voltage) and one negative output (current flowing in for a positive input voltage). With this new degree of freedom (having two outputs instead of just one), a fully differential integrator can be realized in one of two ways, as shown in Fig. 12.6.

Note that the integrator shown in Fig. 12.6(a) requires one-fourth the capacitance needed for the integrator of Fig. $12.6(b)$ to achieve the same integrator coefficient. Although at first glance, this increase in size appears to be a disadvantage of the circuit shown in Fig. 12.6(b), it should be mentioned that fully differential circuits require some method of common-mode feedback. This requirement is due to the fact that, although the differential signal remains stable due to connections of the filter feedback network, the common-mode signal is free to drift if it is not also controlled using some feedback circuit. As a result, one must also be concerned with the stability of the common-mode feedback circuit. Since dominant pole compensation using capacitors on the output nodes is often used to stabilize the common-mode network, the integrator shown in Fig. $12.6(b)$ has the advantage that the integrating capacitors, $2 \mathrm{C}_{1}$, can also be used for this purpose. Also, recall that the single capacitor of the integrator shown in Fig. 12.6(a) must be realized using integrated capacitors, and thus top- and bottom-plate parasitic capacitances exist. Since the bottom-plate parasitic capacitance can be quite large (up to 20 percent of the capacitance value), to maintain symmetry, $\mathrm{C}_{1}$ is often realized using two parallel capacitors, as shown in Fig. 12.7. We take the parallel combination of the two capacitances,
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-074.jpg?height=640&width=1366&top_left_y=1278&top_left_x=214)

Fig. 12.6 Fully differential $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ integrators: (a) single capacitor, (b) two capacitors.

1. The transconductor input may be differential, but its output is single ended, and single-ended signals are typically applied to the transconductor inputs.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-075.jpg?height=252&width=574&top_left_y=180&top_left_x=562)

$$
v_{o}=\frac{G_{m} v_{i}}{s\left(C_{1}+C_{p} / 2\right)} \quad \omega_{t i}=\frac{G_{m}}{\left(C_{1}+C_{p} / 2\right)}
$$

Fig. 12.7 A fully differential integrator maintaining symmetry and showing parasitic capacitances.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-075.jpg?height=313&width=1305&top_left_y=711&top_left_x=247)

Fig. 12.8 A single-ended first-order $\mathrm{G}_{m}-\mathrm{C}$ filter.
which equals $C_{1}$, and include the effect of the parasitic capacitances, $C_{p}$, to obtain the output voltage, given by

$$
\begin{equation*}
V_{o}=\frac{G_{m} V_{i}}{s\left(C_{1}+C_{p} / 2\right)} \tag{12.12}
\end{equation*}
$$

Thus, we see here that the parasitic capacitances affect the integration coefficient and must be taken into account.

### 12.2.3 First-Order Filter

A single-ended $\mathrm{G}_{\mathrm{m}}$-C filter that realizes the first-order filter depicted in Fig. 12.1 is shown in Fig. 12.8. Note that the gains in Fig. 12.1 are provided by the transconductors, the integration is performed by the capacitor $C_{A}$, and the capacitor $C_{x}$ corresponds to the differentiating feed-in path $\mathrm{k}_{1}$ in Fig. 12.1.

The transfer function for this first-order $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filter is found by writing a cur-

Key Point: Differentiating signal paths are sometimes provided by capacitive feed-ins.
rent equation for the output node, $\mathrm{V}_{\text {out }}(\mathrm{s})$ :

$$
\begin{equation*}
G_{m 1} V_{\text {in }}(s)+s C_{x}\left[V_{\text {in }}(s)-V_{\text {out }}(s)\right]-s C_{A} V_{\text {out }}(s)-G_{m 2} V_{\text {out }}(s)=0 \tag{12.13}
\end{equation*}
$$

Rearranging to find $\mathrm{V}_{\text {out }}(\mathrm{s}) / \mathrm{V}_{\text {in }}(\mathrm{s})$, we have

$$
\begin{equation*}
\frac{V_{\text {out }}(s)}{V_{\text {in }}(s)}=\frac{s C_{x}+G_{m 1}}{s\left(C_{A}+C_{x}\right)+G_{m 2}}=\frac{\left[s\left(\frac{C_{X}}{C_{A}+C_{X}}\right)+\left(\frac{G_{m 1}}{C_{A}+C_{X}}\right)\right]}{\left[s+\left(\frac{G_{m 2}}{C_{A}+C_{X}}\right)\right]} \tag{12.14}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-076.jpg?height=380&width=1339&top_left_y=173&top_left_x=207)

Fig. 12.9 A fully differential general first-order $G_{m}-C$ filter.
Equating (12.14) with (12.1) results in the following relationships:

$$
\begin{align*}
\mathrm{C}_{\mathrm{x}} & =\left(\frac{\mathrm{k}_{1}}{1-\mathrm{k}_{1}}\right) \mathrm{C}_{\mathrm{A}}  \tag{12.15}\\
\mathrm{G}_{\mathrm{m} 1} & =\mathrm{k}_{0}\left(\mathrm{C}_{\mathrm{A}}+\mathrm{C}_{\mathrm{x}}\right)  \tag{12.16}\\
\mathrm{G}_{\mathrm{m} 2} & =\omega_{0}\left(\mathrm{C}_{\mathrm{A}}+\mathrm{C}_{\mathrm{X}}\right) \tag{12.17}
\end{align*}
$$

It should be noted from (12.15) that, for $\mathrm{C}_{\mathrm{x}}$ to remain a positive value, the term $\mathrm{k}_{1}$ must satisfy $0 \leq \mathrm{k}_{1}<1$. What this restriction implies is that the shown circuit cannot realize a filter that has a high-frequency gain that is either negative or greater than 1 . Such a result should come as no surprise since the high-frequency gain of this circuit is simply a capacitor-divider circuit, and hence the restriction on $\mathrm{k}_{1}$.

Finally, the equivalent fully differential first-order $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filter is shown in Fig. 12.9. Note that capacitor sizes are doubled here, in relation to the single-ended case, so that the same design equations occur. Also note that the same restriction holds on $\mathrm{k}_{1}$, although a negative value of $\mathrm{k}_{1}$ can be realized by cross-coupling the feed-in capacitor pair, $\mathrm{C}_{\mathrm{x}}$.

#### EXAMPLE 12.3

Based on Fig. 12.9, find component values for a first-order filter with a dc gain of 0.5 , a pole at 20 MHz , and a zero at 40 MHz . Assume the integrating capacitors are sized $\mathrm{C}_{\mathrm{A}}=2 \mathrm{pF}$.

#### Solution

A first-order filter with a zero at 40 MHz and a pole at 20 MHz is given by

$$
\begin{equation*}
\mathrm{H}(\mathrm{~s})=\frac{\mathrm{k}(\mathrm{~s}+2 \pi \times 40 \mathrm{MHz})}{(\mathrm{s}+2 \pi \times 20 \mathrm{MHz})} \tag{12.18}
\end{equation*}
$$

The leading coefficient is determined by setting the dc gain to 0.5 , resulting in $\mathrm{k}=0.25$. Thus, we have

$$
\begin{equation*}
\mathrm{H}(\mathrm{~s})=\frac{0.25 \mathrm{~s}+2 \pi \times 10 \mathrm{MHz}}{\mathrm{~s}+2 \pi \times 20 \mathrm{MHz}} \tag{12.19}
\end{equation*}
$$

and equating this transfer function to (12.1) results in

$$
\begin{gather*}
\mathrm{k}_{1}=0.25  \tag{12.20}\\
\mathrm{k}_{0}=2 \pi \times 10^{7}  \tag{12.21}\\
\omega_{0}=4 \pi \times 10^{7} \tag{12.22}
\end{gather*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-077.jpg?height=584&width=1281&top_left_y=183&top_left_x=291)

Fig. 12.10 A general second-order filter using fully differential $G_{m}-C$ techniques.

Using the design equations shown in Fig. 12.9, we find

$$
\begin{gather*}
\mathrm{C}_{\mathrm{x}}=2 \mathrm{pF} \times \frac{0.25}{1-0.25}=0.667 \mathrm{pF}  \tag{12.23}\\
\mathrm{G}_{\mathrm{m} 1}=2 \pi \times 10^{7} \times 2.667 \mathrm{pF}=0.168 \mathrm{~mA} / \mathrm{V}  \tag{12.24}\\
\mathrm{G}_{\mathrm{m} 2}=4 \pi \times 10^{7} \times 2.667 \mathrm{pF}=0.335 \mathrm{~mA} / \mathrm{V} \tag{12.25}
\end{gather*}
$$

where $\mathrm{C}_{\mathrm{A}}=2 \mathrm{pF}$, as given.

### 12.2.4 Biquad Filter

A fully-differential biquadratic $\mathrm{G}_{\mathrm{m}-} \mathrm{C}$ filter is shown in Fig. 12.10. The transfer function of this biquad filter is found to be given by

$$
\begin{equation*}
H(s) \equiv \frac{V_{\text {out }}(s)}{V_{\text {in }}(s)}=\frac{s^{2}\left(\frac{C_{x}}{C_{x}+C_{B}}\right)+s\left(\frac{G_{m 5}}{C_{x}+C_{B}}\right)+\left(\frac{G_{m 2} G_{m 4}}{C_{A}\left(C_{x}+C_{B}\right)}\right.}{s^{2}+s\left(\frac{G_{m 3}}{C_{x}+C_{b}}\right)+\left(\frac{G_{m 1} G_{m 2}}{C_{A}\left(C_{x}+C_{B}\right)}\right)} \tag{12.26}
\end{equation*}
$$

Equating the coefficients of (12.2) and (12.26) results in

$$
\begin{align*}
k_{2} & =\frac{C_{x}}{C_{X}+C_{B}}  \tag{12.27}\\
k_{1} & =\frac{G_{m 5}}{C_{x}+C_{B}}  \tag{12.28}\\
k_{0} & =\frac{G_{m 2} G_{m 4}}{C_{A}\left(C_{X}+C_{B}\right)} \tag{12.29}
\end{align*}
$$

and

$$
\begin{equation*}
\omega_{\circ}^{2}=\frac{G_{m 1} G_{m 2}}{C_{A}\left(C_{X}+C_{B}\right)} \tag{12.30}
\end{equation*}
$$

For Q, we note that

$$
\begin{equation*}
\frac{\omega_{o}}{Q}=\frac{G_{m 3}}{C_{x}+C_{b}} \tag{12.31}
\end{equation*}
$$

and so, by using (12.30), we can solve for $Q$, resulting in

$$
\begin{equation*}
Q=\sqrt{\left(\frac{G_{m 1} G_{m}}{G_{m 3}^{2}}\right)\left(\frac{C_{X}+C_{B}}{C_{A}}\right)} \tag{12.32}
\end{equation*}
$$

Although the preceding equations are for analyzing a given circuit, they can also be used for design, resulting in the following design equations:

$$
\begin{gathered}
C_{x}=C_{B}\left(\frac{k_{2}}{1-k_{2}}\right) \quad \text { where } 0 \leq k_{2}<1 \\
G_{m 1}=\omega_{0} C_{A} \quad G_{m 2}=\omega_{0}\left(C_{B}+C_{x}\right) \quad G_{m 3}=\frac{\omega_{0}\left(C_{B}+C_{x}\right)}{Q} \\
G_{m 4}=\left(k_{0} C_{A}\right) / \omega_{0} \quad G_{m 5}=k_{1}\left(C_{B}+C_{x}\right)
\end{gathered}
$$

Note that for this design, there is a restriction on the high-frequency gain coefficient, $\mathrm{k}_{2}$, similar to that occurring in the first-order case.

#### EXAMPLE 12.4

Find the transconductance and capacitor values for a second-order filter that has a bandpass response with a center frequency of 20 MHz , a $Q$ value of 5 , and a center frequency gain of 1 . Assume that $C_{A}=C_{B}=2 \mathrm{pF}$.

#### Solution

A bandpass transfer function has the form

$$
\begin{equation*}
H(s) \equiv \frac{V_{\text {out }}(s)}{V_{\text {in }}(s)}=\frac{G s \frac{\omega_{o}}{Q}}{s^{2}+s \frac{\omega_{o}}{Q}+\omega_{0}^{2}} \tag{12.33}
\end{equation*}
$$

where $G=1$ is the gain at the center frequency. Using the facts that $\omega_{0}=2 \pi \times 20 \mathrm{MHz}$ and $\mathrm{Q}=5$, we find

$$
\begin{equation*}
\mathrm{k}_{1}=\mathrm{G} \frac{\omega_{0}}{\mathrm{Q}}=2.513 \times 10^{7} \mathrm{rad} / \mathrm{s} \tag{12.34}
\end{equation*}
$$

Since $k_{0}$ and $k_{2}$ are zero, we have $C_{x}=G_{m 4}=0$ and

$$
\begin{gather*}
G_{m 1}=\omega_{0} C_{A}=0.2513 \mathrm{~mA} / \mathrm{V}  \tag{12.35}\\
G_{m 2}=\omega_{0}\left(C_{B}+C_{x}\right)=0.2513 \mathrm{~mA} / \mathrm{V} \tag{12.36}
\end{gather*}
$$

and, in this case,

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m} 3}=\mathrm{G}_{\mathrm{m} 5}=\mathrm{k}_{1} \mathrm{C}_{\mathrm{B}}=50.27 \mu \mathrm{~A} / \mathrm{V} \tag{12.37}
\end{equation*}
$$

## 12.3 TRANSCONDUCTORS USING FIXED RESISTORS

Two similar approaches for using resistors to linearize the relationship between differential input voltage and output current of a differential pair of transistors are shown in Fig. 12.11. To understand the basic operation of the two circuits, we first make the simplifying assumption that the $\mathrm{V}_{\mathrm{gs}}$ voltages of the transistors are constant. As a result, we see that the differential input voltage, $\mathrm{v}_{\mathrm{i}}$, appears across the two $\mathrm{R}_{\mathrm{S}} / 2$ resistors in Fig. 12.11(a) and across $R_{S}$ in Fig. 12.11(b). Thus, the drain current $I_{D 1}$ is given by

$$
\begin{equation*}
I_{D 1}=I_{1}+\frac{v_{i}}{R_{S}} \tag{12.38}
\end{equation*}
$$

and the drain current $I_{D 2}$ is given by

$$
\begin{equation*}
\mathrm{I}_{\mathrm{D} 2}=\mathrm{I}_{1}-\frac{\mathrm{v}_{\mathrm{i}}}{\mathrm{R}_{\mathrm{S}}} \tag{12.39}
\end{equation*}
$$

Then defining $\mathrm{i}_{01}$ to be the difference in the drain currents from $I_{1}$ (as shown), we have

$$
\begin{equation*}
\mathrm{i}_{01}=\frac{v_{i}}{R_{S}} \tag{12.40}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-079.jpg?height=734&width=1291&top_left_y=1309&top_left_x=275)

Fig. 12.11 Fixed transconductors using resistors. The circuit in (a) has smaller common-mode range and output swing than the circuit in (b) due to bias currents flowing through the $\mathrm{R}_{\mathrm{S}} / 2$ resistors.

Key Point: Source-degenerating a differential pair with a resistor linearizes the relationship between differential input voltage and output current. The result is a transconductor with a value approximately equal to the degeneration resistance.

Thus, we see that the transconductance of these two differential input circuits is a fixed value of $1 / R_{S}$. One important difference between the two fixed transconductors of Fig. 12.11 is that, in the case of $v_{i}=0$, a bias current of $I_{1}$ flows through the two $R_{S} / 2$ resistors in Fig. 12.11(a), whereas no bias current is flowing through $\mathrm{R}_{\mathrm{S}}$ in Fig. 12.11(b). As a result, the common-mode voltage of Fig. $12.11(b)$ can be closer to ground. For example, if a bias current of $I_{1}=100 \mu \mathrm{~A}$ is used together with $R_{S}=20 \mathrm{k} \Omega$, then the voltage drop across each of the two $R_{S} / 2$ resistors would result in 1 V less of common-mode range. It should be noted here that the common-mode input voltage must be far enough above ground to account for the largest expected differential input voltage, $v_{i}$. Specifically, one must ensure that the circuit remains functional while the gate on one side of the differential pair is lower than the common-mode voltage by $\mathrm{v}_{\mathrm{i}} / 2$.

A simple estimate of the maximum differential input range for both these circuits can be found by determining how much voltage exists across the linearizing resistors at the point where one transistor just turns off. For example, in Fig. $12.11(a)$, when $Q_{2}$ turns off due to a large positive input voltage, all of $2 I_{1}$ flows through $R_{s} / 2$ on the left and nothing flows through $R_{s} / 2$ on the right. Thus, the voltage at the center of the two resistors equals that of the source of $Q_{2}$ (since no current flows right), and the maximum input voltage equals that voltage across the left $R_{S} / 2$ resistor, giving

$$
\begin{equation*}
V_{i, \max }=I_{1} R_{S} \tag{12.41}
\end{equation*}
$$

A similar argument gives the same maximum input voltage for the circuit of Fig. 12.11(b). It should be noted here that this simple estimate does not take into account that significant distortion occurs when this maximum input voltage is applied. Specifically, at $\mathrm{V}_{\mathrm{i}, \max }=\mathrm{I}_{1} \mathrm{R}_{\mathrm{S}}$, one of the two transistors will be off, implying that $\mathrm{V}_{\mathrm{Gs}}$ has not remained a relatively constant value, as we assumed earlier in this section. Typically, the maximum input range that applies to the preceding fixed transconductors might be one-half that of (12.41), or, equivalently, $\left(I_{1} / 2\right) R_{S}$.

So far, we have assumed that the transistor's $\mathrm{V}_{\mathrm{gs}}$ voltages remain constant. Such an assumption is reasonably valid if the MOSFETs are replaced by bipolar transistors as shown in Fig. 12.12 due to the exponential currentvoltage relationship of bipolar transistors. However, it is less accurate with a MOFET differential pair, whose
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-080.jpg?height=722&width=1243&top_left_y=1324&top_left_x=262)

Fig. 12.12 Bipolar implementations of the transconductors shown in Fig. 12.11.
gate-source voltage changes appreciably with input voltage. In either the MOS or bipolar circuits, the assumption is reasonable when one restricts the minimum drain (or collector) current, $\mathrm{I}_{\mathrm{D}, \mathrm{min}}$, in either transistor to be that which keeps the small-signal transconductance, $g_{m}$, large enough to ensure $1 / g_{m}<<R_{S}$, recalling that

$$
\begin{equation*}
g_{m}=\sqrt{2 \mu_{n} C_{o x}(W / L) I_{D}} \gg 1 / R_{S} \tag{12.42}
\end{equation*}
$$

For the bipolar circuit, we have the simpler requirement,

$$
\begin{equation*}
\mathrm{r}_{\mathrm{e}, \max }=\frac{\mathrm{V}_{\mathrm{T}}}{\mathrm{I}_{\mathrm{E}, \min }} \ll \mathrm{R}_{\mathrm{S}} \tag{12.43}
\end{equation*}
$$

or equivalently,

$$
\begin{equation*}
I_{E, \min }>>\frac{V_{T}}{R_{S}} \tag{12.44}
\end{equation*}
$$

For example, if $R_{S}=20 \mathrm{k} \Omega$ and $\mathrm{V}_{\mathrm{T}}=25 \mathrm{mV}$, the minimum emitter current in either transistor should be much greater than $1.25 \mu \mathrm{~A}$. A good question is, How much is "much greater than"? The answer to this question depends on how much distortion can be tolerated since, when $1 / g_{m}$ becomes a comparable size to $R_{S}$, the varying $\mathrm{V}_{\mathrm{gs}}$ or $\mathrm{V}_{\mathrm{be}}$ voltage will result in the output current, $i_{o}$, being a significant nonlinear function of the input voltage, $v_{i}$. For example, if the maximum value of $1 / g_{m}$ goes to 10 percent of that of $R_{S}$ when the maximum applied input voltage is $\left(I_{1} / 2\right) R_{S}$, then a linearity deviation of about 3 percent occurs. Thus, to attain a high linearity with the preceding circuits, the bias currents should be large and the input signal should be small (to ensure large values of $\mathrm{g}_{\mathrm{m}}$ ). Of course, the use of small input signals may result in noise becoming a problem.

In applications in which a moderate amount of nonlinearity can be tolerated, $\mathrm{R}_{\mathrm{S}}$ might be chosen similar in size to the nominal bias value of $1 / \mathrm{g}_{\mathrm{m}}$. In this case, the overall transconductance of this transconductor is most easily found using the hybrid T model for the input transistor pair. With such an approach, the output current is more accurately described by

$$
\begin{equation*}
i_{01}=\frac{v_{i}}{1 / g_{m 1}+R_{S}+1 / g_{m} 2}=\frac{v_{i}}{2 / g_{m}+R_{s}} \tag{12.45}
\end{equation*}
$$

Note that (12.45) reduces to (12.40) when $R_{S}$ is chosen much larger than $2 / g_{m}$. In summary, a more accurate formula for the transconductance of the circuits of Fig. 12.11 (and Fig. 12.12) is

$$
\begin{equation*}
G_{m}=\frac{i_{o 1}}{v_{i}}=\frac{1}{2 / g_{m}+R_{s}} \tag{12.46}
\end{equation*}
$$

### EXAMPLE 12.5

Consider the circuit of Fig. $12.12(b)$, where $R_{S}=3 \mathrm{k} \Omega$ (such that $G_{m} \approx 0.333 \mathrm{~mA} / \mathrm{V}$ ) and the maximum differential input voltage is $\pm 500 \mathrm{mV}$. Choose an appropriate bias current, $I_{1}$, such that $r_{e, \max }<0.1 R_{s}$, and find a more precise value for $G_{m}$. Find the new value of $I_{1}$ and $G_{m}$ if the constraint $r_{e, \max }<0.01 R_{s}$ is used instead.

### Solution

In the first case, we have $r_{\mathrm{e}, \max }<0.1 \mathrm{R}_{\mathrm{s}}=300 \Omega$. Thus, in the case of $\mathrm{v}_{\mathrm{i}}=500 \mathrm{mV}$, we require that $\mathrm{r}_{\mathrm{e} 2} \approx 300 \Omega$, which is attained for an emitter current of

$$
\begin{equation*}
\mathrm{I}_{\mathrm{E} 2, \min }=\frac{\mathrm{V}_{\mathrm{T}}}{\mathrm{r}_{\mathrm{e}, \max }}=\frac{26 \mathrm{mV}}{300 \Omega}=86.7 \mu \mathrm{~A} \tag{12.47}
\end{equation*}
$$

For this same input voltage, the resistor current is approximately

$$
\begin{equation*}
\mathrm{I}_{\mathrm{RE}} \cong \frac{500 \mathrm{mV}}{3 \mathrm{k} \Omega}=167 \mu \mathrm{~A} \tag{12.48}
\end{equation*}
$$

and since the current through $R_{s}$ plus $I_{\mathrm{E} 2}$ must equal $I_{1}$ (according to the node currents at the emitter of $Q_{2}$ ), we have

$$
\begin{equation*}
I_{1}=167+86.7=253 \mu \mathrm{~A} \tag{12.49}
\end{equation*}
$$

In other words, a minimum bias current of $253 \mu \mathrm{~A}$ should be chosen. For this value of bias current, the nominal value of $r_{e}$ is given by

$$
\begin{equation*}
\mathrm{r}_{\mathrm{e}}=\frac{\mathrm{V}_{\mathrm{T}}}{\mathrm{I}_{1}}=103 \Omega \tag{12.50}
\end{equation*}
$$

resulting in

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{1}{\left(2 \mathrm{r}_{\mathrm{e}}+\mathrm{R}_{\mathrm{s}}\right)}=0.312 \mathrm{~mA} / \mathrm{V} \tag{12.51}
\end{equation*}
$$

For the case $r_{e, \max }<0.01 R_{E}$, one finds $I_{1}=1.03 \mathrm{~mA}$ and $G_{m}=0.328 \mathrm{~mA} / V$. Note here that the nominal value of $r_{e}$ is now only $26 \Omega$, which is significantly less than $R_{s}$. Although this second design will have less distortion than the first (about 10 times better), it uses much more power. Next, we look at using feedback to improve distortion without resorting to large bias currents.

One way to improve the distortion properties of the preceding fixed transconductors without using large bias currents and small input signal levels is to use an extra pair of amplifiers, as shown in Fig. 12.13. Here, the virtual ground in each opamp forces the source voltages of $Q_{1}$ and $Q_{2}$ to equal those of $v_{i}^{+}$and $v_{i}^{-}$. As a result, the input voltage appears directly across $R_{s}$ and does not depend on the $V_{g s}$ voltages of $Q_{1}$ and $Q_{2}$. Thus, the transconductance of this circuit is given by

$$
\begin{equation*}
G_{m}=\frac{i_{o 1}}{v_{i}^{+}-v_{i}^{-}}=\frac{1}{R_{S}} \tag{12.52}
\end{equation*}
$$

It should be mentioned here that the opamps can be quite simple (typically, a single stage) because they merely improve an input stage that is already reasonably linear.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-082.jpg?height=711&width=923&top_left_y=1412&top_left_x=422)

Fig. 12.13 Improving the linearity of a fixed transconductor through the use of opamps.

Another method for improving the linearity of a fixed transconductor is to force constant currents through $\mathrm{Q}_{1}$ and $\mathrm{Q}_{2}$, as shown in Fig. 12.14 for a bipolar input pair [Koyama, 1993]. Here, $I_{1}$ flows through each of $Q_{1}$ and $Q_{2}$ so that $V_{\text {be1 }}$ and $V_{\text {be2 }}$ are fixed, while $Q_{3}$ and $Q_{4}$ have varying collector currents corresponding to the current flow through $R_{s}$. The output currents can then be obtained at the collectors of $\mathrm{Q}_{7}$ and $\mathrm{Q}_{8}$, which mirror the current through $Q_{3}$ and $Q_{4}$. Thus, assuming the current mirror transistors consisting of $Q_{7}$ and $Q_{8}$ are equal in size to those of $Q_{3}$ and $Q_{4}$, the transconductance of this cell is given by

$$
\begin{equation*}
G_{m}=\frac{i_{01}}{v_{i}^{+}-v_{i}^{-}}=\frac{1}{R_{s}} \tag{12.53}
\end{equation*}
$$

If the current mirror transistors are scaled in relation to $Q_{3}$ and $Q_{4}$, then the transconductance for this cell is also scaled by the same amount.

It should be noted that simple diode-connected transistors are not used at $Q_{3}$ and $Q_{4}$ since a feedback circuit is required to set the voltage level at the collectors of $Q_{1}$ and $Q_{2}$ without drawing much current. The feedback loop occurs as follows: If the voltage at the collector of $Q_{1}$ increases because $I_{C 1}$ is less than $I_{1}$, then $V_{\text {be3 }}$ also increases, forcing more current through $Q_{3}$ and $Q_{1}$ until $I_{C 1}$ once again equals $I_{1}$. Although the circuit shown results in each of $Q_{1}$ and $Q_{2}$ collector voltages being set to two diode drops above ground (i.e., $V_{\text {be3 }}+V_{\text {be } 5}$ ), a larger voltage can be obtained by adding diode-connected transistors that operate as voltage level-shifters. It is possible to combine parts of this fixed-transconductor circuit with a gain-cell stage, as was done in [Koyama, 1993]. The same linearization technique has been used in a CMOS variable transconductor that will be presented in Section 12.4.1, where the resistance $R_{S}$ is realized using a MOS transistor operating in the triode region [Welland, 1994].

A problem with the transconductors shown so far is that there is no obvious mechanism for tuning the transconductance to ensure accuracy over process, voltage, and temperature variations. One solution is to provide an array of degeneration resistors $\mathrm{R}_{\mathrm{S}}$ and somehow select the most appropriate value using switches. Alternatively, triode devices may be used in series with or in place of $\mathrm{R}_{\mathrm{S}}$, and their gate voltage used to tune the effective source degeneration. This is the topic of the following section.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-083.jpg?height=729&width=1174&top_left_y=1293&top_left_x=308)

Fig. 12.14 Improving the linearity of a fixed transconductor by maintaining a constant $\mathrm{V}_{\text {be }}$ voltage for $Q_{1}$ and $Q_{2}$. Level shifts should be added at the emitters of $Q_{5}, Q_{6}$ if a larger input range is desired.

Key Point: Feedback may be used to more accurately reproduce the input voltage across the degeneration resistor or further improve the linearity of transconductors with fixed resistors.

## 12.4 CMOS TRANSCONDUCTORS USING TRIODE TRANSISTORS

In this section, we discuss transconductor circuit techniques that rely on transistors operating in the triode region. It should be stated here that in the following circuits, not all transistors are in the triode region. As we will see, most of the transistors are biased in the active region, but the transconductance of the circuit relies on one or two key transistors biased in the triode region.

We begin this section by recalling the classical model equation for an $n$-channel transistor operating in the triode region.

$$
\begin{equation*}
\mathrm{I}_{\mathrm{D}}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)\left[\left(\mathrm{V}_{\mathrm{GS}}-\mathrm{V}_{\mathrm{tn}}\right) \mathrm{V}_{\mathrm{DS}}-\frac{\mathrm{V}_{\mathrm{DS}}^{2}}{2}\right] \tag{12.54}
\end{equation*}
$$

Also recall that a transistor remains in the triode region as long as the drain-source voltage is lower than the effective gate-source voltage. In other words, the following condition must be satisfied:

$$
\begin{equation*}
V_{D s}<V_{\text {eff }} \quad \text { where } V_{\text {eff }}=V_{G S}-V_{t n} \tag{12.55}
\end{equation*}
$$

We will see next that if the preceding equations were exact, then perfectly linear circuits could be realized. However, these equations are only mildly accurate for a modern short-channel process, and therefore some distortion occurs because higher-order terms are not modelled in the preceding equations. Hence, almost all practical continuous-time circuits use fully differential architectures to reduce even-order distortion products, leaving the third-order term to dominate.

### 12.4.1 Transconductors Using a Fixed-Bias Triode Transistor

We see from (12.54) that if a small drain-source voltage, $\mathrm{V}_{\mathrm{DS}}$, is used, the $\mathrm{V}_{\mathrm{DS}}^{2}$ term goes to zero quickly and the drain current is approximately linear with respect to an applied drain-source voltage. Thus, we can model a transistor in triode as a resistor given by

$$
\begin{equation*}
\left.r_{D S} \equiv\left(\frac{\partial i_{D}}{\partial v_{D S}}\right)^{-1}\right|_{v_{D S}=0} \tag{12.56}
\end{equation*}
$$

which results in a small-signal resistance of

$$
\begin{equation*}
r_{D S}=\frac{1}{\mu_{\mathrm{n}} C_{o x}\left(\frac{W}{L}\right)\left(V_{G S}-V_{\mathrm{tn}}\right)} \tag{12.57}
\end{equation*}
$$

Key Point: Triode transistors can be used in placed of fixed resistors to make transconductors tunable, although their linearity is generally reduced.

One approach for using this equivalent resistance to realize a transconductor with moderate linearity is shown in Fig. 12.15 [Welland, 1994]. This circuit has the same structure as that of the bipolar circuit of Fig. 12.14. However, here the bipolar transistors are replaced with their MOSFET counterparts (biased in the active region), and the resistor is replaced with a transistor operating in the triode region. Note that the circuit of Fig. 12.15 forces constant currents through $\mathrm{Q}_{1}$ and $\mathrm{Q}_{2}$ (as in the bipolar case) such that their individual gate-source voltages remain
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-085.jpg?height=805&width=1140&top_left_y=198&top_left_x=307)

Fig. 12.15 A CMOS transconductor using $Q_{9}$ in the triode region.
constant. As a result, the transconductance of this cell is equal to the inverse of the small-signal resistance, $r_{d s}$, of $Q_{9}$. Using the small-signal resistance result of (12.57), the overall transconductance of this cell is given by

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{\mathrm{i}_{\mathrm{ol}}}{\mathrm{v}_{\mathrm{i}}^{+}-\mathrm{v}_{\mathrm{i}}^{-}}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{9}\left(\mathrm{~V}_{\mathrm{gs} 9}-\mathrm{V}_{\mathrm{tn}}\right) \tag{12.58}
\end{equation*}
$$

Thus, this transconductor has a variable transconductance value that can be adjusted by changing the value of $V_{\text {gs9. }}$. As in the bipolar case, this transconductance value can be scaled by scaling the current mirrors $Q_{7}$ and $Q_{8}$ with respect to $Q_{3}$ and $Q_{4}$.

A similar approach but with reduced complexity and fewer p -channel inputs is shown in Fig. 12.16 [Kwan, 1991]. Here, a constant current of $I_{2}$ is forced through each of $Q_{1}$ and $Q_{2}$, whereas the dc bias current for each of $Q_{3}$ and $Q_{4}$ equals the difference between $I_{1}$ and $I_{2}$. The signal current, $i_{11}$, also flows through $Q_{3}$ and $Q_{4}$, which is mirrored to the output transistors, $Q_{5}$ and $Q_{6}$. Note that this configuration has one less transistor stage around the input transistor loops. Specifically, the $Q_{5}$ and $Q_{6}$ source followers shown in Fig. 12.15 are not required in the circuit of Fig. 12.16, which usually results in a speed advantage for the latter.

An advantage of the transconductors in Figs. 12.15 and 12.16 (and other similar ones) is that they are easily modified to have multiple outputs by simply including additional output transistors. For example, the transconductor in Fig. 12.16 with two outputs is shown in Fig. 12.17. These additional transistors can be scaled for any desired ratio of output currents. These multiple outputs often allow filters to be realized using fewer transconductors. For example, a biquad similar to that in Fig. 12.10, but using multiple-output transconductors, is shown in Fig. 12.18. The transconductors are now associated with the outputs rather than the inputs. There is one transconductor per filter order plus an additional one for the input conversion from voltage to current. This approach has resulted in a savings of two transconductors. Not only does this approach save die area, but, often more importantly, it saves power.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-086.jpg?height=606&width=1230&top_left_y=181&top_left_x=248)

Fig. 12.16 A CMOS transconductor with p-channel inputs.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-086.jpg?height=613&width=1188&top_left_y=901&top_left_x=283)

Fig. 12.17 A multiple-output CMOS transconductor.

### 12.4.2 Transconductors Using Varying Bias-Triode Transistors

Another way to linearize a MOSFET differential stage, using transistors primarily in the triode region, is shown in Fig. 12.19 [Krummenacher, 1988]. Note that here the gates of transistors $Q_{3}, Q_{4}$ are connected to the differential input voltage rather than to a bias voltage. As a result, triode transistors $Q_{3}$ and $Q_{4}$ undergo varying bias conditions to improve the linearity of this circuit (as discussed shortly). To see that $Q_{3}$ and $Q_{4}$ are generally in the triode region, we look at the case of equal input signals (i.e., $v_{1}=v_{2}$ ), resulting in

$$
\begin{equation*}
v_{x}=v_{y}=v_{1}-v_{G S 1}=v_{1}-\left(v_{\text {eff } 1}+V_{t \mathrm{t}}\right) \tag{12.59}
\end{equation*}
$$

Thus, the drain-source voltages of $Q_{3}, Q_{4}$ are both zero. However, their gate-source voltages equal those of $\mathrm{Q}_{1}, \mathrm{Q}_{2}$, implying that they are indeed in the triode region.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-087.jpg?height=531&width=1354&top_left_y=182&top_left_x=218)

Fig. 12.18 A general biquad realized using multiple-output transconductors.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-087.jpg?height=718&width=887&top_left_y=876&top_left_x=431)

Fig. 12.19 A linearized CMOS differential pair using transistors $Q_{3}, Q_{4}$ primarily in the triode region. The top pair of current sources can be set equal to the bottom pair through the use of a common-mode feedback.

To determine the small-signal transconductance of this stage, we note from (12.57) that the small-signal drain-source resistance of $Q_{3}, Q_{4}$ is given by

$$
\begin{equation*}
r_{\mathrm{ds} 3}=r_{\mathrm{ds} 4}=\frac{1}{2 \mathrm{k}_{3}\left(\mathrm{~V}_{\mathrm{GS} 1}-\mathrm{V}_{\mathrm{tn}}\right)} \tag{12.60}
\end{equation*}
$$

where we have assumed that $Q_{3}$ and $Q_{4}$ are matched devices and have defined

$$
\begin{equation*}
\mathrm{k}_{3}=\frac{\mu_{\mathrm{n}} \mathrm{Cox}_{\mathrm{ox}}}{2}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{3} \tag{12.61}
\end{equation*}
$$

Note that in this circuit we cannot ignore the effect of the varying gate-source voltages of $Q_{1}$ and $Q_{2}$ since their drain currents are not fixed to a constant value (as in Fig. 12.15). The small-signal source resistance values of $Q_{1}$ and $Q_{2}$ are given by

$$
\begin{equation*}
r_{s 1}=r_{s 2}=\frac{1}{g_{m 1}}=\frac{1}{2 k_{1}\left(V_{\mathrm{GS} 1}-V_{t n}\right)} \tag{12.62}
\end{equation*}
$$

Using the small-signal T model, we find the small-signal output current of $i_{01}$ to be equal to

$$
\begin{equation*}
i_{01}=\frac{v_{1}-v_{2}}{r_{s 1}+r_{s 2}+\left(r_{d s 3} \| r_{d s 4}\right)} \tag{12.63}
\end{equation*}
$$

Thus, defining $G_{m} \equiv i_{01} /\left(v_{1}-v_{2}\right)$, we have

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{1}{\mathrm{r}_{\mathrm{s} 1}+\mathrm{r}_{\mathrm{s} 2}+\left(\mathrm{r}_{\mathrm{ds} 3} \| \mathrm{r}_{\mathrm{ds} 4}\right)} \tag{12.64}
\end{equation*}
$$

which can be shown to be

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{4 \mathrm{k}_{1} \mathrm{k}_{3}\left(\mathrm{~V}_{\mathrm{GS} 1}-\mathrm{V}_{\mathrm{tn}}\right)}{\mathrm{k}_{1}+4 \mathrm{k}_{3}} \tag{12.65}
\end{equation*}
$$

Finally, to modify this result such that it is in terms of current, we note that

$$
\begin{equation*}
\mathrm{I}_{1}=\mathrm{k}_{1}\left(\mathrm{~V}_{\mathrm{GS} 1}-\mathrm{V}_{\mathrm{tn}}\right)^{2} \tag{12.66}
\end{equation*}
$$

or, equivalently,

$$
\begin{equation*}
\left(\mathrm{V}_{\mathrm{GS} 1}-\mathrm{V}_{\mathrm{tn}}\right)=\sqrt{\frac{\mathrm{I}_{1}}{\mathrm{k}_{1}}} \tag{12.67}
\end{equation*}
$$

which leads to

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{4 \mathrm{k}_{1} \mathrm{k}_{3} \sqrt{\mathrm{I}_{1}}}{\left(\mathrm{k}_{1}+4 \mathrm{k}_{3}\right) \sqrt{\mathrm{k}_{1}}} \tag{12.68}
\end{equation*}
$$

Thus, we see that the transconductance of this transconductor can be tuned by changing the bias current, $I_{1}$. Note also that the transconductance is proportional to the square root of the bias current as opposed to a linear relation in the case of a bipolar transconductor.

To see how varying bias conditions for the triode transistors improves the linearity of this circuit, first consider the case of small differences in $\mathrm{V}_{1}$ and $\mathrm{V}_{2}$ (say, 100 mV ). In this small-input-signal case, $Q_{3}$ and $Q_{4}$ essentially act as two source degeneration resistors. Thus, linearity improves (assuming $r_{\mathrm{ds} 3}>>r_{s 1}$ ) over that of a simple differential pair, since transistors in triode are more linear than the source resistances of transistors in the active region. In other words, for a small-input-signal value, the linearity of this circuit is similar to that for a circuit in which the gates of $Q_{3}, Q_{4}$ are connected to fixed-bias voltages. However, if the gates of $Q_{3}, Q_{4}$ were connected to fixed-bias voltages, (12.54) shows that, as their drain-source voltage is increased, the drain current is reduced below that which would occur in a linear relationship due to the squared $\mathrm{V}_{\mathrm{DS}}$ term. In addition, the changing values of $\mathrm{V}_{\mathrm{GS} 1}$ and $\mathrm{V}_{\mathrm{GS} 2}$ (due to current changes) also reduce the value of $\mathrm{V}_{\mathrm{DS}}$, and hence the transconductance of the cell for large input signals. To alleviate this reduction in transconductance for large input signals, the gates of $Q_{3}$ or $Q_{4}$ are connected to the input signals as shown. Now, as the input signal is increased, the small-signal resistance of one of the two triode transistors in parallel, $Q_{3}$ or $Q_{4}$, is reduced. This reduced resistance attempts to increase the transconductance, resulting in a partial cancelling of the decreasing transconductance value. Thus, if a proper ratio of $k_{1} / k_{3}$ is chosen, a more stable transconductance (and hence better linearity) is achieved. For a 4-MHz filter presented in [Krummenacher, 1988], a ratio of $k_{1} / k_{3}=6.7$ is used to obtain distortion levels around 50 dB below the maximum output signal level of 350
mVrms. Also, an extension of this approach is presented in [Silva-Martinez, 1991], where the input signal is split over two input stages to further improve the distortion performance.

#### EXAMPLE 12.6

Consider the circuit of Fig. 12.19 with the following values: $I_{1}=100 \mu \mathrm{~A}, \quad \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}=96 \mu \mathrm{~A} / \mathrm{V}^{2}$, $(\mathrm{W} / \mathrm{L})_{1}=(\mathrm{W} / \mathrm{L})_{2}=20,(\mathrm{~W} / \mathrm{L})_{3}=(\mathrm{W} / \mathrm{L})_{4}=3$, and $\mathrm{v}_{2}=0 \mathrm{~V}$.

1. Assuming a perfectly linear transconductor, use (12.68) to find $i_{01}$ when $v_{1}$ equals 2.5 mV and 250 mV .
2. Assume the gates of $Q_{3}, Q_{4}$ are connected to ground and use classical models for both the triode and active regions. Find the true value of $i_{01}$ when $v_{1}$ equals 2.5 mV and 250 mV . Compare your results with those in part 1.
3. Repeat part 2 , assuming the gates of $\mathrm{Q}_{3}, \mathrm{Q}_{4}$ are connected to the input signals as shown in Fig. 12.19.

#### Solution

1. For the given values, we have

$$
\begin{align*}
& \mathrm{k}_{1}=\frac{96}{2} \times 20=960 \mu \mathrm{~A} / \mathrm{V}^{2}  \tag{12.69}\\
& \mathrm{k}_{3}=\frac{96}{2} \times 3=144 \mu \mathrm{~A} / \mathrm{V}^{2} \tag{12.70}
\end{align*}
$$

and substituting the above values in (12.68), we have

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{4 \mathrm{k}_{1} \mathrm{k}_{3} \sqrt{100}}{\left(\mathrm{k}_{1}+4 \mathrm{k}_{3}\right) \sqrt{\mathrm{k}_{1}}}=116.2 \mu \mathrm{~A} / \mathrm{V} \tag{12.71}
\end{equation*}
$$

Now, to find $i_{01}$, we use the definition of $G_{m}$ to find

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o} 1}=\mathrm{G}_{\mathrm{m}}\left(\mathrm{v}_{1}-\mathrm{v}_{2}\right)=\mathrm{G}_{\mathrm{m}} \mathrm{v}_{1} \tag{12.72}
\end{equation*}
$$

Thus, for $\mathrm{v}_{1}=2.5 \mathrm{mV}$, we have $\mathrm{i}_{01}=0.2905 \mu \mathrm{~A}$. However, if $\mathrm{v}_{1}=250 \mathrm{mV}$, then $\mathrm{i}_{\mathrm{ol}}=29.05 \mu \mathrm{~A}$. In other words, for a $250-\mathrm{mV}$ input voltage, the total drain current of $\mathrm{Q}_{1}$ would be $129.05 \mu \mathrm{~A}$, whereas that for $Q_{2}$ would be $70.95 \mu \mathrm{~A}$.
2. To find $i_{01}$ in this case, we first note that the sum of the drain currents in $Q_{1}$ and $Q_{2}$ must equal the total bias current, $200 \mu \mathrm{~A}$. In other words,

$$
\begin{equation*}
\mathrm{i}_{\mathrm{D} 1}+\mathrm{i}_{\mathrm{D} 2}=2 \mathrm{I}_{1}=200 \mu \mathrm{~A} \tag{12.73}
\end{equation*}
$$

And since (using $\mathrm{V}_{\text {effi }}=\mathrm{V}_{\mathrm{GSi}}-\mathrm{V}_{\mathrm{tn}}$ ) the drain currents in $\mathrm{Q}_{1}$ and $\mathrm{Q}_{2}$ are given by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{D} 1}=\frac{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}}{2}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{1}\left(\mathrm{v}_{\mathrm{eff} 1}^{2}\right) \quad \text { and } \quad \mathrm{i}_{\mathrm{D} 2}=\frac{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}}{2}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{2}\left(\mathrm{v}_{\mathrm{eff} 2}^{2}\right) \tag{12.74}
\end{equation*}
$$

we can write (12.73) as

$$
\begin{equation*}
v_{\mathrm{eff} 1}^{2}+\mathrm{v}_{\mathrm{eff} 2}^{2}=\frac{5}{24} \mathrm{~V}^{2} \tag{12.75}
\end{equation*}
$$

The current from node $\mathrm{v}_{\mathrm{x}}$ to $\mathrm{v}_{\mathrm{y}}$ through the two triode transistors is given by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{xy}}=2 \times \mathrm{i}_{\mathrm{D} 3}=2 \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{3}\left(\mathrm{v}_{\mathrm{eff} 2} \mathrm{v}_{\mathrm{xy}}-\frac{\mathrm{v}_{\mathrm{xy}}^{2}}{2}\right) \tag{12.76}
\end{equation*}
$$

where we have noted that $v_{\text {eff } 3}=v_{\text {eff } 2}$. The sum of $i_{x y}$ and $i_{D 2}$ must equal $I_{1}$, resulting in

$$
\begin{equation*}
960 v_{\text {eff } 2}^{2}+576\left(v_{\text {eff } 2} v_{x y}-\frac{v_{\mathrm{xy}}^{2}}{2}\right)=100 \tag{12.77}
\end{equation*}
$$

Finally, we note that the input signal is equal to the following sum (the threshold voltage terms cancel):

$$
\begin{equation*}
-v_{\text {eff } 2}+v_{\mathrm{xy}}+v_{\text {eff } 1}=v_{\text {in }} \tag{12.78}
\end{equation*}
$$

Equations (12.75), (12.77), and (12.78) can be solved using an equation solver and then choosing the solution that has all positive values.

For a value of $\mathrm{v}_{\mathrm{in}}=2.5 \mathrm{mV}$, the following results are obtained.

$$
\begin{align*}
\mathrm{v}_{\text {eff } 1} & =0.32322 \mathrm{~V} \\
\mathrm{v}_{\mathrm{eff} 2} & =0.32228 \mathrm{~V} \\
\mathrm{v}_{\mathrm{xy}} & =0.0015648 \mathrm{~V} \tag{12.79}
\end{align*}
$$

These values of effective gate voltages imply that the drain currents are

$$
\begin{equation*}
\mathrm{i}_{\mathrm{D} 1}=100.2898 \mu \mathrm{~A} \quad \mathrm{i}_{\mathrm{D} 2}=99.7104 \mu \mathrm{~A} \tag{12.80}
\end{equation*}
$$

which, in turn, imply that

$$
\begin{equation*}
\mathrm{i}_{\mathrm{ol}}=\mathrm{i}_{\mathrm{D} 1}-100 \mu \mathrm{~A}=0.2898 \mu \mathrm{~A} \tag{12.81}
\end{equation*}
$$

Such a result agrees closely with that of part 1 .
However, for the case of $\mathrm{v}_{\mathrm{in}}=250 \mathrm{mV}$, we have

$$
\begin{align*}
\mathrm{v}_{\text {eff } 1} & =0.35452 \mathrm{~V} \\
\mathrm{v}_{\text {eff } 2} & =0.28749 \mathrm{~V} \\
\mathrm{v}_{\mathrm{xy}} & =0.18297 \mathrm{~V} \tag{12.82}
\end{align*}
$$

resulting in $\mathrm{i}_{01}=20.66 \mu \mathrm{~A}$. This result is about 30 percent lower than that expected by a linear transconductor value of $29.05 \mu \mathrm{~A}$, as found in part 1 .
3. Finally, if the gates are connected to the input signal, the preceding equations in part 2 remain the same, except for $i_{x y}$, which is now the sum of $i_{D 3}$ and $i_{D 4}$, resulting in,

$$
\begin{align*}
\mathrm{i}_{\mathrm{xy}}= & \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{3}\left[\left(\mathrm{v}_{\mathrm{eff} 2}+\mathrm{v}_{\mathrm{in}}\right) \mathrm{v}_{\mathrm{xy}}-\frac{\mathrm{v}_{\mathrm{xy}}^{2}}{2}\right]  \tag{12.83}\\
& +\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{4}\left(\mathrm{v}_{\mathrm{eff} 2} \mathrm{v}_{\mathrm{xy}}-\frac{\mathrm{v}_{\mathrm{xy}}^{2}}{2}\right)
\end{align*}
$$

and so (12.77) is replaced with

$$
\begin{equation*}
960 v_{\text {eff } 2}^{2}+576\left[\left(2 v_{\text {eff } 2}+v_{i n}\right) v_{x y}-v_{x y}^{2}\right]=100 \tag{12.84}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-091.jpg?height=631&width=800&top_left_y=173&top_left_x=317)

$$
G_{m}=\mu_{n} C_{o x}\left(\frac{W}{L}\right)_{1} V_{D S}
$$

Fig. 12.20 A differential transconductor using triode transistors that have constant drain-source voltages. The control signal, $\mathrm{V}_{\mathrm{C}}$, adjusts the transconductance value, whereas $\mathrm{V}_{\mathrm{CM}}$ is a fixed common-mode voltage. The top current pair, $\mathrm{I}_{1}$, is set equal to the bias current through $\mathrm{Q}_{1}, \mathrm{Q}_{2}$, using a common-mode feedback circuit (not shown).

Once again, using an equation solver, we find that in the case of $\mathrm{v}_{\mathrm{in}}=2.5 \mathrm{mV}$, the results are essentially the same as in parts 1 and 2 . However, in the case of $v_{i n}=250 \mathrm{mV}$, we find that

$$
\begin{align*}
\mathrm{v}_{\text {eff } 1} & =0.36620 \mathrm{~V} \\
\mathrm{v}_{\text {eff } 2} & =0.27245 \mathrm{~V} \\
\mathrm{v}_{\mathrm{xy}} & =0.15625 \mathrm{~V} \tag{12.85}
\end{align*}
$$

These values lead to $\mathrm{i}_{01}=28.74 \mu \mathrm{~A}$, which is only 1 percent below that expected by a linear transconductor value of $29.05 \mu \mathrm{~A}$.

### 12.4.3 Transconductors Using Constant Drain-Source Voltages

Recall, once again, the classical model for a transistor biased in the triode region,

$$
\begin{equation*}
\mathrm{i}_{\mathrm{D}}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)\left[\left(\mathrm{V}_{\mathrm{GS}}-\mathrm{V}_{\mathrm{tn}}\right) \mathrm{V}_{\mathrm{DS}}-\frac{\mathrm{V}_{\mathrm{DS}}^{2}}{2}\right] \tag{12.86}
\end{equation*}
$$

We see here that if the drain-source voltage, $\mathrm{V}_{\mathrm{DS}}$, is kept constant, the drain current is linear with respect to an applied gate-source voltage (ignoring the dc offset current due to the squared $\mathrm{V}_{\mathrm{DS}}$ term) [Pennock, 1985]. Unfortunately, this simple model does not account for important second-order effects (such as velocity saturation and mobility degradation) that severely limit the accuracy of the preceding equation model. However, if fully differential structures are used to cancel even-order error terms, a reasonably linear transconductor (around 50 dB ) can be built using this constant- $\mathrm{V}_{\mathrm{DS}}$ approach.

One possible implementation based on the linearization scheme just described is shown in Fig. 12.20. Here, $Q_{1}$ and $Q_{2}$ are placed in the triode region and their drain-source voltages are set equal to $V_{C}$ through the use of $Q_{3}, Q_{4}$
and two extra amplifiers. The differential input signal is applied to the gates of $Q_{1}, Q_{2}$ and is superimposed on a constant common-mode voltage signal, $\mathrm{V}_{\mathrm{CM}}$. An alternative design here is to use an extra opamp to create a $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ opamp integrator [Wong, 1989].

For the circuit of Fig. 12.20, we have

$$
\begin{equation*}
\mathrm{i}_{\mathrm{D} 1}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{1}\left[\left(\frac{\mathrm{~V}_{\mathrm{i}}}{2}+\mathrm{V}_{\mathrm{CM}}-\mathrm{V}_{\mathrm{tn}}\right) \mathrm{V}_{\mathrm{DS}}-\mathrm{V}_{\mathrm{DS}}^{2} / 2\right] \tag{12.87}
\end{equation*}
$$

Noting that $i_{01}$ is the difference between this current and $I_{1}$, which is set via a common-mode feedback signal equal to

$$
\begin{equation*}
\mathrm{I}_{1}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{1}\left[\left(\mathrm{~V}_{\mathrm{CM}}-\mathrm{V}_{\mathrm{tn}}\right) \mathrm{V}_{\mathrm{DS}}-\mathrm{V}_{\mathrm{DS}}^{2} / 2\right] \tag{12.88}
\end{equation*}
$$

we then have

$$
\begin{equation*}
\mathrm{i}_{\mathrm{ol}}=\mathrm{i}_{\mathrm{D} 1}-\mathrm{I}_{1}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{1}\left(\frac{\mathrm{v}_{\mathrm{i}}}{2}\right) \mathrm{V}_{\mathrm{DS}} \tag{12.89}
\end{equation*}
$$

Then, defining $G_{m} \equiv i_{01} / v_{i}$ results in

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{1} \mathrm{~V}_{\mathrm{DS}} \tag{12.90}
\end{equation*}
$$

Note that here the transconductance value is proportional to the drain-source voltage, and from (12.88), we see that the bias current is also approximately proportional to the drain-source voltage (if $\mathrm{V}_{\mathrm{DS}}$ is small).

#### EXAMPLE 12.7

Consider the circuit shown in Fig. 12.20, where $\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}=96 \mu \mathrm{~A} / \mathrm{V}^{2},(\mathrm{~W} / \mathrm{L})_{1}=(\mathrm{W} / \mathrm{L})_{2}=10, \mathrm{~V}_{\mathrm{tn}}=0.8 \mathrm{~V}$, and $\mathrm{V}_{\mathrm{CM}}=2 \mathrm{~V}$. Find the transconductance value when $\mathrm{V}_{\mathrm{C}}=0.2 \mathrm{~V}$ and when $\mathrm{V}_{\mathrm{C}}=0.4 \mathrm{~V}$. For these two controlsignal values, also find the bias currents through $Q_{1}$ and $Q_{2}$ (i.e., when $v_{i}=0$ ) and the maximum input signal swing before either transistor exits the triode region (assume the classical transistor model).

#### Solution

Using (12.90), for $\mathrm{V}_{\mathrm{C}}=0.2 \mathrm{~V}$, we have

$$
\mathrm{G}_{\mathrm{m}}=96 \mu \mathrm{~A} / \mathrm{V}^{2} \times 10 \times 0.2 \mathrm{~V}=0.192 \mathrm{~mA} / \mathrm{V}
$$

Also, the bias current through $Q_{1}$ or $Q_{2}$ for this $V_{C}$ value can be found using (12.88):

$$
I_{1}=96 \mu \mathrm{~A} / \mathrm{V}^{2} \times 10\left[(2-0.8) 0.2-\frac{0.2^{2}}{2}\right]=0.211 \mathrm{~mA}
$$

Finally, to remain in the triode region, the effective gate-source voltages of $Q_{1}$ and $Q_{2}$ must remain above $V_{D S}=0.2 \mathrm{~V}$. In other words, their gate-source voltages must remain above $V_{D S}+V_{t}=1.0 \mathrm{~V}$. Since the commonmode voltage, $\mathrm{V}_{\mathrm{CM}}$, equals 2 V , the negative portion, $\mathrm{v}_{\mathrm{i}} / 2$, must not go below a level of -1 V , otherwise the transistor will enter the active region. Thus, a maximum differential input voltage, $\mathrm{v}_{\mathrm{i}}$, of 2 V can be applied in this case.

Similarly, for $\mathrm{V}_{\mathrm{C}}=0.4 \mathrm{~V}$, we have twice the transconductance value of $\mathrm{G}_{\mathrm{m}}=0.384 \mathrm{~mA} / \mathrm{V}$. Here, the bias current is found to be $I_{1}=0.384 \mathrm{~mA}$ and the maximum input signal swing is a differential voltage of $v_{i}=1.6 \mathrm{~V}$. Note that doubling the drain-source voltage doubles the transconductance (as expected) but requires almost a doubling of the bias current and a loss of signal swing.

## 12.5 CMOS TRANSCONDUCTORS USING ACTIVE TRANSISTORS

In general, CMOS transconductors based on the use of active transistors ${ }^{2}$ have worse linearity performance than their triode-based counterparts. However, active-based designs often have improved speed performance (assuming equal bias currents in the two cases). The linearity of active-transistor transconductors is only moderate (around 30 to 50 dB ) because they rely on the square-law model of MOS transistors, which is not very accurate (particularly in short-channel processes). In addition, only the difference in output

Key Point: Transconductors whose gain is based upon the small-signal transconductance of active-mode transistors generally offer increased speed, butreduced linearity, compared with transconductors based upon triode devices.
currents is ideally linear, whereas individual currents have significant sec-ond-order harmonics. Thus, second-order harmonic distortion also occurs if the difference is not taken precisely.

We should mention here that not all linearization techniques using active transistors are discussed. For example, one approach not discussed is a technique in which the tail current of a differential pair is adaptively biased [Nedungadi, 1984]. This technique is limited in its frequency response, and thus a designer would usually choose a triode-based design instead. In summary, in this section we present CMOS linearization techniques intended for high-speed operation and only moderate linearity.

### 12.5.1 CMOS Pair

Before proceeding to look at transconductor circuits that have active transistors, it is worthwhile to introduce a two-transistor circuit known as the CMOS pair, as shown in Fig. 12.21 [Seevinck, 1987]. As we will show, this two-transistor pair acts as a single transistor, assuming that both transistors remain in the active region. Such an observation allows one to more easily derive some of the CMOS transconductors described later in this section.

To show that this two-transistor pair acts as a single transistor, we first assume that both transistors remain in the active region. Thus, we can write their drain currents as

$$
\begin{equation*}
\mathrm{I}_{\mathrm{D}}=\mathrm{K}_{\mathrm{n}}\left(\mathrm{~V}_{\mathrm{GSn}}-\mathrm{V}_{\mathrm{tn}}\right)^{2} \quad \text { where } \mathrm{V}_{\mathrm{tn}}>0 \tag{12.91}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{I}_{\mathrm{D}}=\mathrm{K}_{\mathrm{p}}\left(\mathrm{~V}_{\mathrm{SGp}}+\mathrm{V}_{\mathrm{tp}}\right)^{2} \quad \text { where } \mathrm{V}_{\mathrm{tp}}<0 \tag{12.92}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-093.jpg?height=362&width=1182&top_left_y=1504&top_left_x=304)

Fig. 12.21 A CMOS pair, where both transistors are in the active region. The transistor pair is equivalent to a single transistor with an equivalent threshold voltage, $\mathrm{V}_{\mathrm{t} \text {-eq }}$, and device parameter, $\mathrm{K}_{\text {eq }}$
2. Active transistors are those transistors that operate in the active region. The active region is also known as the pinch-off, or saturation, region. This active region for an $n$-channel transistor occurs when $V_{G S}$ is greater than $V_{t n}$ and $V_{D S} \geq V_{G S}-V_{t n}=V_{\text {eff }}$.

Rearranging these two equations in terms of their gate-source voltages gives
and

$$
\begin{equation*}
\mathrm{V}_{\mathrm{SGp}}=-\mathrm{V}_{\mathrm{tp}}+\frac{1}{\sqrt{\mathrm{~K}_{\mathrm{p}}}} \sqrt{\mathrm{I}_{\mathrm{D}}} \tag{12.94}
\end{equation*}
$$

Defining the equivalent gate-source voltage, $\mathrm{V}_{\mathrm{GS}-\mathrm{eq}}$, to be the difference between the two gate voltages, we have

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS}-\mathrm{eq}} \equiv \mathrm{~V}_{\mathrm{GSn}}+\mathrm{V}_{\mathrm{SGp}}=\left(\mathrm{V}_{\mathrm{tn}}-\mathrm{V}_{\mathrm{tp}}\right)+\left(\frac{1}{\sqrt{\mathrm{~K}_{\mathrm{n}}}}+\frac{1}{\sqrt{\mathrm{~K}_{\mathrm{p}}}}\right) \sqrt{\mathrm{I}_{\mathrm{D}}} \tag{12.95}
\end{equation*}
$$

Since this equation has the same form as those for a single transistor (equations (12.93) and (12.94)), we define the equivalent threshold voltage, $\mathrm{V}_{\mathrm{t} \text {-eq }}$, as

$$
\begin{equation*}
\mathrm{V}_{\mathrm{t}-\mathrm{eq}} \equiv \mathrm{~V}_{\mathrm{tn}}-\mathrm{V}_{\mathrm{tp}} \quad \text { where } \mathrm{V}_{\mathrm{tn}}>0 \text { and } \mathrm{V}_{\mathrm{tp}}<0 \tag{12.96}
\end{equation*}
$$

and we define the equivalent device parameter, $\mathrm{K}_{\mathrm{eq}}$, as

$$
\begin{equation*}
\frac{1}{\sqrt{\mathrm{~K}_{\mathrm{eq}}}} \equiv \frac{1}{\sqrt{\mathrm{~K}_{\mathrm{n}}}}+\frac{1}{\sqrt{\mathrm{~K}_{\mathrm{p}}}} \tag{12.97}
\end{equation*}
$$

which can be rewritten as

$$
\begin{equation*}
\mathrm{K}_{\mathrm{eq}}=\frac{\mathrm{K}_{\mathrm{n}} \mathrm{~K}_{\mathrm{p}}}{\left(\sqrt{\mathrm{~K}_{\mathrm{n}}}+\sqrt{\mathrm{K}_{\mathrm{p}}}\right)^{2}} \tag{12.98}
\end{equation*}
$$

Finally, combining (12.95), (12.96), and (12.98) and rearranging, we see that when both transistors are in their active regions, the drain current can be written as

$$
\begin{equation*}
\mathrm{i}_{\mathrm{D}}=\mathrm{K}_{\mathrm{eq}}\left(\mathrm{~V}_{\mathrm{GS}-\mathrm{eq}}-\mathrm{V}_{\mathrm{t}-\mathrm{eq}}\right)^{2} \tag{12.99}
\end{equation*}
$$

where $\mathrm{K}_{\text {eq }}, \mathrm{V}_{\mathrm{GS}-\mathrm{eq}}$, and $\mathrm{V}_{\mathrm{t} \text {-eq }}$ are defined as just described. Clearly, this equation is in the same form as that for a single transistor, and thus this two-transistor pair can replace single transistors in many circuits. As we will see next, this replacement can be quite useful in designing linear transconductor circuits.

### 12.5.2 Constant Sum of Gate-Source Voltages

One popular approach for creating an active transistor transconductor is by using a constant sum of gatesource voltages, as shown in Fig. 12.22. Assuming the two transistors are operating in the active region (i.e., the drain voltages are high and each of $\mathrm{v}_{\mathrm{GS} 1}$ and $\mathrm{V}_{\mathrm{GS} 2}$ remain greater than $\mathrm{V}_{\mathrm{tn}}$ ), the output differential current is given by

$$
\begin{equation*}
\left(\mathrm{i}_{\mathrm{D} 1}-\mathrm{i}_{\mathrm{D} 2}\right)=\mathrm{K}\left(\mathrm{v}_{\mathrm{GS} 1}+\mathrm{v}_{\mathrm{GS} 2}-2 \mathrm{~V}_{\mathrm{tn}}\right)\left(\mathrm{v}_{\mathrm{GS} 1}-\mathrm{v}_{\mathrm{GS} 2}\right) \tag{12.100}
\end{equation*}
$$

Here, the output differential current is linear if the sum of the two gate-sour ce voltages remains constant. As we will see next, there are a variety of ways to make the sum of the gate-source voltages remain constant when applying an input signal. One important point to note here is that, although the differential current is linear, the individual drain currents are not linear. Thus, if the subtraction between currents has some error (as it certainly will), some distortion products will occur even if perfect square-law devices are obtainable.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-095.jpg?height=246&width=387&top_left_y=215&top_left_x=268)
(Matched devices)

$$
\begin{gathered}
\mathrm{K}=\left(\mu_{\mathrm{n}} / 2\right) \mathrm{C}_{\mathrm{Ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right) \\
\mathrm{i}_{\mathrm{D} 1}=\mathrm{K}\left(\mathrm{v}_{\mathrm{GS} 1}-\mathrm{V}_{\mathrm{tn}}\right)^{2} \quad \text { and } \quad \mathrm{i}_{\mathrm{D} 2}=\mathrm{K}\left(\mathrm{v}_{\mathrm{GS} 2}-\mathrm{V}_{\mathrm{tn}}\right)^{2} \\
\left(\mathrm{i}_{\mathrm{D} 1}-\mathrm{i}_{\mathrm{D} 2}\right)=\mathrm{K}\left(\mathrm{v}_{\mathrm{GS} 1}+\mathrm{v}_{\mathrm{GS} 2}-2 \mathrm{~V}_{\mathrm{tn}}\right)\left(\mathrm{v}_{\mathrm{GS} 1}-\mathrm{v}_{\mathrm{GS} 2}\right)
\end{gathered}
$$

Fig. 12.22 Two-transistor circuit in which the difference in the drain currents is linear with respect to $\left(\mathrm{v}_{\mathrm{GS} 1}-\mathrm{v}_{\mathrm{GS} 2}\right)$ if the sum of the two gate-source voltages remains constant. Transistors are matched and in the active region.

### 12.5.3 Source-Connected Differential Pair

One approach to maintain a constant sum of gate-source voltages is to apply a balanced differential input voltage, as shown in Fig. 12.23. Here, the differential pair is biased using the dc common-mode voltage, $\mathrm{V}_{\mathrm{CM}}$, whereas the input signal varies symmetrically around this common-mode voltage. Note that, from the preceding analysis, this input signal symmetry is important in maintaining linearity. However, in practice, a slightly nonbalanced input signal is not the dominant source of nonlinearity. Specifically, the linearity achievable with this approach is quite limited because MOS transistors are not well modelled by square-law behavior. In addition, it is difficult to obtain a precise difference between the two drain currents, which also causes even-order harmonics. As a result, this technique is typically limited to less than 50 dB of linearity.

To tune the transconductance of this circuit, the common-mode voltage, $\mathrm{V}_{\mathrm{CM}}$, can be adjusted. However, it should be noted that, in a short-channel process and when moderate gate-source voltages are used, carrier velocity saturation occurs and limits the transconductance variation. In addition, one should be aware that as the input common-mode voltage is adjusted, linearity performance and maximum signal swing levels change as well. One example of this approach is presented in [Snelgrove, 1992] where speeds up to 450 MHz are demonstrated in a $0.9-\mu \mathrm{m}$ CMOS process with around a $30-$ to $40-\mathrm{dB}$ dynamic range performance.

### 12.5.4 Inverter-Based

A transconductor approach similar to the source-connected differential pair is the inverter-based transconductor, shown in Fig. 12.24 [Park, 1986]. Here, two CMOS pairs, $Q_{1 a}, Q_{1 b}$ and $Q_{2 a}, Q_{2 b}$, have replaced the two individual
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-095.jpg?height=412&width=1225&top_left_y=1632&top_left_x=276)

Fig. 12.23 A source-connected differential-pair transconductor. The differential input signal must be balanced around $\mathrm{V}_{\mathrm{CM}}$ for linearization of the transistor square-law relation to occur.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-096.jpg?height=631&width=1078&top_left_y=180&top_left_x=349)

Fig. 12.24 Complementary differential-pair transconductor using CMOS pairs.
transistors in a traditional CMOS inverter, and the difference in their output currents is the overall output current, $\mathrm{i}_{\mathrm{o}}$. Assuming that all four transistors are in the active region and that the two CMOS pairs are matched, we can use the previous results on CMOS pairs to write

$$
\begin{equation*}
\mathrm{i}_{1}=\mathrm{K}_{\mathrm{eq}}\left(\mathrm{~V}_{\mathrm{GS}-\mathrm{eq} 1}-\mathrm{V}_{\mathrm{t}-\mathrm{eq}}\right)^{2} \tag{12.101}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{i}_{2}=\mathrm{K}_{\mathrm{eq}}\left(\mathrm{~V}_{\mathrm{GS}-\mathrm{eq} 2}-\mathrm{V}_{\mathrm{t}-\mathrm{eq}}\right)^{2} \tag{12.102}
\end{equation*}
$$

Note here that these equations are in the same form as those shown in Fig. 12.22. Thus, as in (12.100), the output current is given by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o}} \equiv \mathrm{i}_{1}-\mathrm{i}_{2}=\mathrm{K}_{\mathrm{eq}}\left(\mathrm{~V}_{\mathrm{GS}-\mathrm{eq} 1}+\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 2}-2 \mathrm{~V}_{\mathrm{t}-\mathrm{eq}}\right)\left(\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 1}-\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 2}\right) \tag{12.103}
\end{equation*}
$$

Thus, the output current is linearly related to the difference in equivalent gate-source voltages of the CMOS pairs if the sum of their equivalent gate-source voltages is a constant value. To see that a constant equivalent gate-source voltage sum occurs, we have

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS} \text {-eq1 }}=\mathrm{V}_{\mathrm{C} 1}-\mathrm{V}_{\mathrm{in}} \tag{12.104}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 2}=\mathrm{V}_{\mathrm{in}}-\mathrm{V}_{\mathrm{C} 2} \tag{12.105}
\end{equation*}
$$

and therefore

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 1}+\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 2}=\mathrm{V}_{\mathrm{C} 1}-\mathrm{V}_{\mathrm{C} 2} \tag{12.106}
\end{equation*}
$$

Also, the difference in equivalent gate-source voltages is given by

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 1}-\mathrm{V}_{\mathrm{GS}-\mathrm{eq} 2}=\mathrm{V}_{\mathrm{C} 1}+\mathrm{V}_{\mathrm{C} 2}-2 \mathrm{~V}_{\mathrm{in}} \tag{12.107}
\end{equation*}
$$

Finally, in the case where we choose $\mathrm{V}_{\mathrm{C} 2}=-\mathrm{V}_{\mathrm{C} 1}$, we have

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o}}=4 \mathrm{~K}_{\mathrm{eq}}\left(\mathrm{~V}_{\mathrm{C} 1}-\mathrm{V}_{\mathrm{t}-\mathrm{eq}}\right)\left(\mathrm{V}_{\mathrm{in}}\right) \tag{12.108}
\end{equation*}
$$

and the transconductance value can be varied by changing the control voltages, $\mathrm{V}_{\mathrm{C} 1}$ and $\mathrm{V}_{\mathrm{C} 2}$ (which, incidentally, are high-input impedance nodes and thus are easily adjustable). Note that, with this transconductor, matching need occur only for transistors of the same type. Specifically, the n -channel transistors should match and the p -channel transistors should match, but there is no need to match n - and p -channel transistors to each other.

### 12.5.5 Differential-Pair with Floating Voltage Sources

Another approach to maintain a constant sum of gate-source voltages is by using two floating dc voltage sources, as shown in Fig. 12.25 [Nedungadi, 1984]. Writing a voltage equation around the loop, we have

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS} 1}-\left(\mathrm{V}_{\mathrm{x}}+\mathrm{V}_{\mathrm{tn}}\right)+\mathrm{V}_{\mathrm{GS} 2}-\left(\mathrm{V}_{\mathrm{x}}+\mathrm{V}_{\mathrm{tn}}\right)=0 \tag{12.109}
\end{equation*}
$$

and thus,

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS} 1}+\mathrm{V}_{\mathrm{GS} 2}=2\left(\mathrm{~V}_{\mathrm{x}}+\mathrm{V}_{\mathrm{tn}}\right) \tag{12.110}
\end{equation*}
$$

As a result, this circuit maintains a constant sum of gate-source voltages even if the applied differential signal is not balanced. Also, writing two equations that describe the relationship between $v_{1}$ and $v_{2}$, we have

$$
\begin{equation*}
\mathrm{V}_{1}-\mathrm{V}_{\mathrm{GS} 1}+\mathrm{V}_{\mathrm{x}}+\mathrm{V}_{\mathrm{tn}}=\mathrm{V}_{2} \tag{12.111}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{V}_{2}-\mathrm{V}_{\mathrm{GS} 2}+\mathrm{V}_{\mathrm{x}}+\mathrm{V}_{\mathrm{tn}}=\mathrm{V}_{1} \tag{12.112}
\end{equation*}
$$

Subtracting (12.111) from (12.112) and rearranging, we obtain

$$
\begin{equation*}
\mathrm{v}_{\mathrm{GS} 1}-\mathrm{v}_{\mathrm{GS} 2}=2\left(\mathrm{v}_{1}-\mathrm{v}_{2}\right) \tag{12.113}
\end{equation*}
$$

Thus, the difference between the input voltages is equal to one half the difference between the gate-source voltages. Finally, the differential output current is found by combining (12.100), (12.110), and (12.113) to give

$$
\begin{equation*}
\left(i_{D 1}-i_{D 2}\right)=4 K V_{x}\left(v_{1}-v_{2}\right) \tag{12.114}
\end{equation*}
$$

One simple way to realize the floating voltage sources of Fig. 12.25 is to use two source followers, as shown in Fig. 12.26 [Nedungadi, 1984]. The transistors labelled nK are n times larger than the other two transistors, and thus
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-097.jpg?height=319&width=622&top_left_y=1215&top_left_x=326)

$$
\begin{aligned}
\left(\mathrm{i}_{\mathrm{D} 1}-\mathrm{i}_{\mathrm{D} 2}\right) & =4 \mathrm{KV} \mathrm{~V}_{\mathrm{x}}\left(\mathrm{v}_{1}-\mathrm{V}_{2}\right) \\
\mathrm{G}_{\mathrm{m}} & =4 \mathrm{KV} \mathrm{~V}_{\mathrm{x}}
\end{aligned}
$$

Fig. 12.25 A linearized differential pair using floating voltage sources.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-097.jpg?height=421&width=674&top_left_y=1659&top_left_x=307)

$$
\begin{array}{r}
\left(i_{D 1}-i_{D 2}\right)=\left(\frac{n}{n+1}\right) 4 \sqrt{K I_{B}}\left(v_{1}-v_{2}\right) \\
G_{m}=\left(\frac{n}{n+1}\right) 4 \sqrt{K I_{B}}
\end{array}
$$

Fig. 12.26 A linear transconductor for large n.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-098.jpg?height=364&width=636&top_left_y=179&top_left_x=301)

$$
\left(\mathrm{i}_{\mathrm{D} 1}-\mathrm{i}_{\mathrm{D} 2}\right)=4 \mathrm{~K}_{\mathrm{eq}} \mathrm{~V}_{\mathrm{x}}\left(\mathrm{v}_{1}-\mathrm{v}_{2}\right)
$$

Fig. 12.27 A linearized differential pair in which the floating voltage sources need drive only the transistor gates.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-098.jpg?height=591&width=1256&top_left_y=652&top_left_x=292)

Fig. 12.28 A transconductor that uses CMOS pairs and floating voltage sources.
they act as source followers when n is large (typically, when n is 5 or greater). If n is not large, the bias current through the two source followers changes as the input signal is applied and linearity is worsened. A disadvantage of this circuit is that a large dc bias current passes through the two source followers. However, if only moderate linearity is desired and the input signal is relatively small (say, 500 mV ), then this approach can be quite useful.

Since it is difficult to realize a floating voltage source that drives the source of another transistor, another approach is to modify the circuit of Fig. 12.25 such that the floating voltage sources need drive only the transistor gates. Such a modification is possible by replacing the single transistors shown in Fig. 12.25 with their CMOS pairs, as shown in Figure 12.27. Note that the voltage sources must now be larger than $\mathrm{V}_{\mathrm{t} \text {-eq }}$ and must include a controllable $\mathrm{V}_{\mathrm{x}}$ voltage. Fortunately, such circuits are easily accomplished by using two more CMOS pairs, as shown in Fig. 12.28, where the pairs $\mathrm{Q}_{3 \mathrm{a}}, \mathrm{Q}_{3 \mathrm{~b}}$ and $\mathrm{Q}_{4 \mathrm{a}}, \mathrm{Q}_{4 \mathrm{~b}}$ have been added together with two adjustable current sources [Seevinck, 1987]. Referring back to (12.99), we see that $\mathrm{V}_{\mathrm{x}}$ is given by

$$
\begin{equation*}
\mathrm{V}_{\mathrm{x}}=\frac{1}{\sqrt{\mathrm{~K}_{\mathrm{eq}}}} \sqrt{\mathrm{I}_{\mathrm{B}}} \tag{12.115}
\end{equation*}
$$

where, for simplicity, we have assumed that all CMOS pairs are matched. As a result, the differential output current is given by

$$
\begin{equation*}
\left(i_{D 1}-i_{D 2}\right)=4 \sqrt{K_{e q} I_{B}}\left(v_{1}-v_{2}\right) \tag{12.116}
\end{equation*}
$$

Thus, we see that the output current can be tuned by adjusting the dc bias current, $\mathrm{I}_{\mathrm{B}}$. Note that the transconductance coefficient is proportional to the square root of $I_{B}$ and thus a fourfold increase in current results in only a factor of 2 coefficient increase.

Before leaving this circuit, a couple of points are worth mentioning. First, note that the output currents from this circuit are available at both the upper pair, $Q_{1 a}, Q_{2 a}$, as well as at the lower pair, $Q_{1 b}, Q_{2 b}$. Such flexibility may be useful in the remaining transconductor circuitry. Second, note that $V_{\text {ss }}$ must be at least $V_{\mathrm{tn}}+\left|V_{\mathrm{tp}}\right|$ below the most negative input signal swing of either $v_{1}$ or $V_{2}$. If we assume $v_{1}$ and $v_{2}$ have $\pm 1-V$ signals associated with them around ground, then, for $\mathrm{V}_{\mathrm{tn}}=-\mathrm{V}_{\mathrm{tp}}=1 \mathrm{~V}$, $\mathrm{V}_{\mathrm{ss}}$ would have to be less than -3 V . Thus, assuming we have symmetrical power supplies, a 6-V power supply would be needed for only a $2-\mathrm{V}$ signal swing.

### 12.5.6 Bias-Offset Cross-Coupled Differential Pairs

Another approach to realize a transconductor with active transistors is to use two cross-coupled differential pairs where the input into one pair is intentionally voltage offset [Wang, 1990]. One implementation of this approach is shown in Fig. 12.29, where the differential pair $Q_{1}, Q_{2}$ is cross coupled with the bias-offset differential pair $Q_{3}, Q_{4}$. Here, we assume all transistors are in the active region and are matched (i.e., we assume all transistors have equal device parameters of K and equal threshold voltages of $\mathrm{V}_{\mathrm{tn}}$ ).

To find the differential output current, we first find

$$
\begin{equation*}
\mathrm{i}_{1}=\mathrm{K}\left(\mathrm{~V}_{1}-\mathrm{V}_{\mathrm{x}}-\mathrm{V}_{\mathrm{tn}}\right)^{2}+\mathrm{K}\left(\mathrm{~V}_{2}-\mathrm{V}_{\mathrm{B}}-\mathrm{V}_{\mathrm{x}}-\mathrm{V}_{\mathrm{tn}}\right)^{2} \tag{12.117}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{i}_{2}=\mathrm{K}\left(\mathrm{~V}_{2}-\mathrm{V}_{\mathrm{x}}-\mathrm{V}_{\mathrm{tn}}\right)^{2}+\mathrm{K}\left(\mathrm{~V}_{1}-\mathrm{V}_{\mathrm{B}}-\mathrm{V}_{\mathrm{x}}-\mathrm{V}_{\mathrm{tn}}\right)^{2} \tag{12.118}
\end{equation*}
$$

Now finding the difference, $\boldsymbol{i}_{1}-\mathrm{i}_{2}$, we have

$$
\begin{equation*}
\left(i_{1}-i_{2}\right)=2 K V_{B}\left(v_{1}-v_{2}\right) \tag{12.119}
\end{equation*}
$$

Thus, the output differential current is linear with respect to the differential input voltage (as expected) and the transconductance value is proportional to $\mathrm{V}_{\mathrm{B}}$. Note, however, that the bias currents through $\mathrm{Q}_{5}, \mathrm{Q}_{6}, \mathrm{Q}_{7}$, and $\mathrm{Q}_{8}$ are all square-law related to $\mathrm{V}_{\mathrm{B}}$. Thus, the transconductance value is proportional to the square root of the changing bias current, as in the other active transistor CMOS transconductors. Also, note that the bias current, $\mathrm{I}_{\mathrm{SS}}$, does not affect the transconductance value but does determine the maximum (or minimum) output current available.

Finally, note that this offset-bias linearization technique can also be realized in a single-ended version with only a few transistors, as shown in Fig. 12.30 [Bult, 1987]. The analysis is left to the reader.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-099.jpg?height=681&width=857&top_left_y=1404&top_left_x=293)

$$
\begin{aligned}
\left(i_{1}-i_{2}\right) & =2 K V_{B}\left(V_{1}-v_{2}\right) \\
G_{m} & =2 K V_{B}
\end{aligned}
$$

Fig. 12.29 A bias-offset cross-coupled transconductor.
![](https://cdn.mathpix.com/cropped/2024_11_07_78b9e5ba0b09189ab604g-100.jpg?height=387&width=353&top_left_y=181&top_left_x=417)

$$
\mathrm{i}_{1}-\mathrm{i}_{2}=\mathrm{K}\left(\mathrm{~V}_{\mathrm{B}}-2 \mathrm{~V}_{\mathrm{tn}}\right)\left(2 \mathrm{v}_{1}-\mathrm{V}_{\mathrm{B}}\right)
$$

Fig. 12.30 A single-ended offset-bias transconductor.

## 12.6 BIPOLAR TRANSCONDUCTORS

There are two main approaches for realizing bipolar transconductors. One approach is to use a fixed transconductor cascaded with a gain cell. The fixed transconductor is typically a differential pair linearized through resistor degeneration. The gain cell allows scaling of the output current by varying the ratio of two current sources. The other approach is to use a differential input stage with multiple inputs, where the transistors are scaled such that improved linearity occurs. In this case, the transconductance value can be tuned by varying the bias current through the input stage.

### 12.6.1 Gain-Cell Transconductors

Key Point: Bipolar transconductors based on fixed resistors may be made tunable by cascading them with an adjustable-gain cell.

The bipolar transconductors in Fig. 12.12 and Fig. 12.14 have a fixed transconductance value equal to approximately $1 / R_{S}$. However, to accommodate tuning, variable transconductance values are required. One common approach for creating tunable transconductors that have a fixed transconductance input stage is to use a gain cell as described in Section 11.5. Recall that in a gain cell, the output current is equal to a scaled version of the input current, where the scaling factor is determined by the ratio of two dc bias currents. In addition, the circuit is highly linear.

A tunable transconductor that uses a gain cell is shown in Fig. 12.31. Here, the voltage sources, $\mathrm{V}_{\mathrm{Ls}}$, represent voltage level shifters and could be realized using the circuit shown in Fig. 12.32. By combining the relationships given for the fixed transconductor and the gain cell, specifically, (12.40) and (11.17), then the output current is given by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o}}=\frac{\mathrm{v}_{\mathrm{i}} \mathrm{I}_{2}}{\mathrm{R}_{\mathrm{E}} \mathrm{I}_{1}} \tag{12.120}
\end{equation*}
$$

resulting in a transconductance value equal to

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\left(\frac{1}{\mathrm{R}_{\mathrm{E}}}\right)\left(\frac{\mathrm{I}_{2}}{\mathrm{I}_{1}}\right) \tag{12.121}
\end{equation*}
$$

Thus, the transconductance value is proportional to the ratio of $\mathrm{I}_{2} / \mathrm{I}_{1}$.
It is also possible to place the gain cell below the input differential pair, as shown in Fig. 12.33 [Wyszynski, 1993; Moree, 1993]. Note that while the previous designs have $2 r_{e}$ in series with the degeneration resistor, $R_{E}$, this circuit has $4 r_{e}$ in series with $R_{E}$ (that of $Q_{1}-Q_{4}$ ), which might affect the distortion performance. However, the gain cell shown has less distortion due to finite $\beta$ effects and has therefore been referred to as a beta-immune type- $A$ cell [Gilbert, 1990].

[^0]:    3. For a transistor in the triode region that has zero $\mathrm{V}_{\mathrm{DS}}$, it doesn't matter which junctions are called the drain and the source, since both junctions are at the same potential.
4. Transistors also accumulate channel charge when turning on, but this does not typically affect circuit performance since the charge comes from low-impedance nodes.
[^1]:    7. p-channel transistors exhibit trapping for positive gate voltages since only electrons, and not holes, are trapped. Therefore, to prevent trapping, they should never be turned off.
[^2]:    4. A translinear multiplier is also commonly called a Gilbert multiplier or an analog multiplier.

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-001.jpg?height=745&width=1228&top_left_y=180&top_left_x=281)

Fig. 12.31 A typical gain-cell transconductor.

### 12.6.2 Transconductors Using Multiple Differential Pairs

Quite a different approach for realizing a bipolar transconductor is by partially linearizing the input stage through the use of multiple differential pairs. To see how this linearization is achieved, consider a simple differential pair, as shown in Fig. 12.34(a). Ignoring base currents, we saw in Section 8.5.3 that the collector current $\mathbf{i}_{\mathrm{C} 2}$ is given by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{C} 2}=\frac{\mathrm{I}_{1}}{1+\mathrm{e}^{\mathrm{v}_{\mathrm{i}} / \mathrm{V}_{\mathrm{T}}}} \tag{12.122}
\end{equation*}
$$

This current is plotted in Fig. $12.34(b)$, where we note that the curve is relatively linear near $v_{i}=0$. It is well known that the slope at this point equals the transconductance of this differential Ginput stage and is given by

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{1}{2 \mathrm{r}_{\mathrm{e}}}=\frac{\mathrm{I}_{1}}{4 \mathrm{~V}_{\mathrm{T}}} \tag{12.123}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-001.jpg?height=437&width=759&top_left_y=1663&top_left_x=513)

Fig. 12.32 A possible realization of the level shifters.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-002.jpg?height=656&width=1239&top_left_y=181&top_left_x=273)

Fig. 12.33 A gain-cell transconductor with the gain cell below the input differential pair.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-002.jpg?height=608&width=1373&top_left_y=970&top_left_x=254)

Fig. 12.34 (a) Differential pair. (b) Current output versus input voltage.

Thus, we see that the transconductance is proportional to the bias current, $\mathrm{I}_{1}$. Unfortunately, this two-transistor input stage has a very limited input range when used as a linear transconductor. In fact, when $\mathrm{v}_{\mathrm{i}}$ becomes greater than around $32 \mathrm{mV}_{\mathrm{pp}}$ (i.e., $\mathrm{v}_{\mathrm{i}}> \pm 16 \mathrm{mV}$ ), the total harmonic distortion of the output current becomes greater than 1 percent (see Example 12.8). We now discuss a method to use parallel differential pairs to increase the linear input range [Calder, 1984].

Consider the input stage shown in Fig. 12.35(a), where two differential pairs are connected in parallel but with a dc offset voltage applied to each. The currents of the right side transistors in each transistor pair are shown in Fig. 12.35(b). If the dc offset voltages, $\mathrm{v}_{1}$, are chosen carefully, then the two current curves will partially linearize each other when they are added together, as shown in Fig. 12.35(c). In this case, $\mathrm{v}_{1}$ is chosen to be equal to $1.317 \mathrm{~V}_{\mathrm{T}}$ to maximize the linear input range [Tanimoto, 1991]. As a result of this linearization technique, the input range can now be approximately three times that of the original differential pair or, equivalently, $96 \mathrm{mV}_{\mathrm{pp}}$, and achieve the same distortion performance.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-003.jpg?height=972&width=1486&top_left_y=176&top_left_x=136)

Fig. $\mathbf{1 2 . 3 5}$ (a) A linearized differential input; (b) individual right-side currents; (c) total linearized
To reduce circuitry, the two dc offset voltage sources can be eliminated by sizing the differential pair of transistors appropriately. Specifically, assuming that $\mathrm{V}_{\mathrm{i}}=0$, then when $\mathrm{V}_{1}=1.317 \mathrm{~V}_{\mathrm{T}}$, the collector currents of $\mathrm{Q}_{2}$ and $Q_{4}$ are given by

$$
\begin{equation*}
\mathrm{i}_{\mathrm{C} 2}=\frac{\mathrm{I}_{1}}{1+\mathrm{e}^{1.317}}=0.2113 \mathrm{I}_{1} \tag{12.124}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathbf{i}_{\mathrm{C} 4}=\mathbf{i}_{\mathrm{C} 1}=\frac{\mathrm{I}_{1}}{1+\mathrm{e}^{-1.317}}=0.7887 \mathrm{I}_{1} \tag{12.125}
\end{equation*}
$$

If a two-transistor differential pair has unequal-sized transistors such that the same two currents occur for $v_{i}=0$, then this unequal-sized differential pair will behave the same as that of an equal-sized differential pair with a dc offset applied. To determine the sizing of the unequal-sized differential pair, define k to be the ratio of the baseemitter area of $Q_{1}$ with respect to $Q_{2}$. Thus, for this unequal-sized case, when $v_{i}=0$, we have

$$
\begin{equation*}
\mathrm{i}_{\mathrm{C} 1}=\mathrm{kI} \mathrm{I}_{\mathrm{s}} \mathrm{e}^{\left(\mathrm{v}_{\mathrm{be}} / \mathrm{V}_{\mathrm{T}}\right)}=0.7887 \mathrm{I}_{1} \tag{12.126}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathbf{i}_{\mathrm{C} 2}=\mathrm{I}_{\mathrm{s}} \mathrm{e}^{\left(\mathrm{v}_{\mathrm{be}} / \mathrm{v}_{\mathrm{T}}\right)}=0.2113 \mathrm{I}_{1} \tag{12.127}
\end{equation*}
$$

Dividing (12.126) by (12.127), we obtain

$$
\begin{equation*}
k=3.73 \tag{12.128}
\end{equation*}
$$

Thus, we should make $Q_{1} 3.73$ times larger than $Q_{2}$, and similarily $Q_{4}$ should be 3.73 times larger than $Q_{3}$. Such transistor sizing achieves the same result as the dc offset voltages. This result should make intuitive sense
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-004.jpg?height=681&width=1004&top_left_y=180&top_left_x=393)

Fig. 12.36 Using transistor sizing to create a linearized differential transconductor.
since we require that the ratio of the two currents be $0.7887 / 0.2113$ when their base-emitter voltages are equal; this requirement results in the area ratio. Typically, this area ratio is set to 4 for practical reasons, and the final linearized transconductor is realized as shown in Fig. 12.36. Thus, for this circuit with $\mathrm{v}_{\mathrm{i}}=0$, the currents through $Q_{1}$ and $Q_{2}$ are $0.8 I_{1}$ and $0.2 I_{1}$, respectively.

To determine the transconductance of the circuit of Fig. 12.36, we note that $\mathrm{G}_{\mathrm{m}}$ equals the sum of the transconductance of the two differential pairs, resulting in

$$
\begin{equation*}
G_{m}=\frac{1}{r_{e 1}+r_{e 2}}+\frac{1}{r_{e 3}+r_{e 4}} \tag{12.129}
\end{equation*}
$$

Also, at $\mathrm{v}_{\mathrm{i}}=0$, we have

$$
\begin{equation*}
r_{e 1}=r_{e 4}=\frac{V_{T}}{0.8 I_{1}} \tag{12.130}
\end{equation*}
$$

and

$$
\begin{equation*}
r_{e 2}=r_{e 3}=\frac{V_{T}}{0.2 I_{1}} \tag{12.131}
\end{equation*}
$$

Combining (12.129) to (12.131), we have

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{8 \mathrm{I}_{1}}{25 \mathrm{~V}_{\mathrm{T}}} \tag{12.132}
\end{equation*}
$$

which is 28 percent greater than the transconductance value for the transistor pair shown in Fig. 12.34(a). However, this comparison is not fair since two differential pairs and twice the current are used in this linearized approach. If two differential pairs of Fig. 12.34(a) are used together, then their total transconductance would be $\mathrm{G}_{\mathrm{m}}=\mathrm{I}_{1} /\left(2 \mathrm{~V}_{\mathrm{T}}\right)$, implying that this linearized approach has a 36 percent smaller transconductance. Also note that, as in the two-transistor pair case, this transconductance value is also proportional to the bias current, $\mathrm{I}_{1}$, and thus no gain cell is required.

This approach was ued in a 2 - to $10-\mathrm{MHz}$ programmable filter intended for disk-drive applications in [De Veirman, 1992]. This same technique can be extended to a larger number of input stages to further improve the
linear input range [Tanimoto, 1991]. Using four differential input pairs in parallel, the linear input range was reported to be 16 times better than that for a single differential pair.

#### EXAMPLE 12.8

Consider the single differential pair shown in Fig. 12.34(a), where $I_{1}=2 \mathrm{~mA}$. Find the percentage error between an ideal linear transconductor and the true output current when $\mathrm{v}_{\mathrm{i}}=16 \mathrm{mV}$.

#### Solution

Using (12.123), we have

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{\mathrm{I}_{1}}{4 \mathrm{~V}_{\mathrm{T}}}=19.2 \mathrm{~mA} / \mathrm{V} \tag{12.133}
\end{equation*}
$$

Thus, for an ideal linear transconductor, the output current for a $16-\mathrm{mV}$ input voltage would be

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o}}=\mathrm{G}_{\mathrm{m}} \times 16 \mathrm{mV}=0.307 \mathrm{~mA} \tag{12.134}
\end{equation*}
$$

The true output current can be found from (12.122) as

$$
\begin{align*}
& \mathrm{I}_{\mathrm{C} 2}=\frac{2 \mathrm{~mA}}{1+\mathrm{e}^{16 / 26}}=0.702 \mathrm{~mA}  \tag{12.135}\\
& \mathrm{I}_{\mathrm{C} 1}=\frac{2 \mathrm{~mA}}{1+\mathrm{e}^{-16 / 26}}=1.298 \mathrm{~mA} \tag{12.136}
\end{align*}
$$

implying that the change in current from the bias current of 1 mA is 0.298 mA . Thus, the percentage error between the true output current and the ideal linear transconductor output is

$$
\begin{equation*}
\frac{0.298-0.307}{0.307} \times 100=-3 \% \tag{12.137}
\end{equation*}
$$

In this case, the deviation is three-percent worst case, which results in about a one-percent total-harmonicdistortion (THD) measurement (see Section 9.5.1).

#### EXAMPLE 12.9

Consider the linearized differential pairs shown in Fig. 12.35(a), where $I_{1}=2 \mathrm{~mA}$. Find the percentage error between an ideal linear transconductor and the true output current when $\mathrm{v}_{\mathrm{i}}=16 \mathrm{mV}$.

#### Solution

First, we need to derive a formula for $G_{m}$ in a manner similar to that for (12.132), where

$$
\begin{align*}
& r_{\mathrm{e} 1}=r_{\mathrm{e} 4}=\frac{\mathrm{V}_{\mathrm{T}}}{0.7887 \mathrm{I}_{1}}  \tag{12.138}\\
& \mathrm{r}_{\mathrm{e} 2}=\mathrm{r}_{\mathrm{e} 3}=\frac{\mathrm{V}_{\mathrm{T}}}{0.2113 \mathrm{I}_{1}} \tag{12.139}
\end{align*}
$$

Thus, the transconductance is given by

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=\frac{1}{\mathrm{r}_{\mathrm{e} 1}+\mathrm{r}_{\mathrm{e} 2}}+\frac{1}{\mathrm{r}_{\mathrm{e} 3}+\mathrm{r}_{\mathrm{e} 4}}=\frac{0.333 \mathrm{I}_{1}}{\mathrm{~V}_{\mathrm{T}}}=25.6 \mathrm{~mA} / \mathrm{V} \tag{12.140}
\end{equation*}
$$

For an ideal linear transconductor, the output current for a $16-\mathrm{mV}$ input voltage would result in

$$
\begin{equation*}
\mathrm{i}_{\mathrm{o}}=\mathrm{G}_{\mathrm{m}} \times 16 \mathrm{mV}=0.4102 \mathrm{~mA} \tag{12.141}
\end{equation*}
$$

To calculate the true output current, we first note that

$$
\begin{equation*}
\mathrm{v}_{1}=1.317 \mathrm{~V}_{\mathrm{T}}=34.24 \mathrm{mV} \tag{12.142}
\end{equation*}
$$

and since $v_{i}=16 \mathrm{mV}$, we use $v_{i}+v_{1}$ to find $I_{C 1}$, resulting in

$$
\begin{align*}
& \mathrm{I}_{\mathrm{C} 1}=\frac{2 \mathrm{~mA}}{1+\mathrm{e}^{-50.24 / 26}}=1.747 \mathrm{~mA}  \tag{12.143}\\
& \mathrm{I}_{\mathrm{C} 2}=2 \mathrm{~mA}-\mathrm{I}_{\mathrm{C} 1}=0.253 \mathrm{~mA} \tag{12.144}
\end{align*}
$$

For $\mathrm{I}_{\mathrm{C} 4}$, we use $\mathrm{v}_{1}-\mathrm{v}_{\mathrm{i}}$ to obtain

$$
\begin{align*}
& \mathrm{I}_{\mathrm{C} 4}=\frac{2 \mathrm{~mA}}{1+\mathrm{e}^{-18.24 / 26}}=1.337 \mathrm{~mA}  \tag{12.145}\\
& \mathrm{I}_{\mathrm{C} 3}=2 \mathrm{~mA}-\mathrm{I}_{\mathrm{C} 4}=0.663 \mathrm{~mA} \tag{12.146}
\end{align*}
$$

The true output is then equal to

$$
\begin{align*}
& \mathrm{I}_{\mathrm{C} 1}+\mathrm{I}_{\mathrm{C} 3}=2.41 \mathrm{~mA}  \tag{12.147}\\
& \mathrm{I}_{\mathrm{C} 2}+\mathrm{I}_{\mathrm{C} 4}=1.59 \mathrm{~mA} \tag{12.148}
\end{align*}
$$

implying that the change in current from the bias current of 2 mA is 0.4099 mA . Thus, the percentage error between the true output current and the ideal linear transconductor output is

$$
\begin{equation*}
\frac{0.4099-0.4102}{0.4102} \times 100=-0.1 \% \tag{12.149}
\end{equation*}
$$

Note that this error is over ten times better than with a simple differential pair.

## 12.7 BICMOS TRANSCONDUCTORS

In this section, we discuss some of the reported approaches for realizing BiCMOS transconductors and filters.

### 12.7.1 Tunable MOS in Triode

One approach for realizing a BiCMOS integrator is shown in Fig. 12.37 [Laber, 1993]. Here, linearization and tuning are accomplished by using transistors $Q_{1}$ through $Q_{4}$, which are all assumed to be in the triode region. As we saw in Section 12.4, the currents through these transistors are ideally linear if their drain-source voltages are kept constant. Although in practice these currents have rather large second-order distortion, fortunately even-order distortion products are significantly reduced in a fully differential structure. The drain-source voltages of $Q_{1}$ through $Q_{4}$ are controlled through the use of the two emitter followers, $Q_{5}, Q_{6}$. This simple voltage control is one of the benefits of using a BiCMOS process since a MOS source follower would have too much voltage variation. Note that additional inputs into this integrator are added as simply two extra transistors (a two-input integrator is shown). Various coefficient ratios can be obtained by scaling the sizes of the input transistors. However, because of the shown tuning circuit connection, all coefficients in one integrator will scale together as the control voltage is varied. Note also that a $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ opamp integrator is used to reduce the effects of parasitic capacitance.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-007.jpg?height=594&width=902&top_left_y=180&top_left_x=444)

Fig. 12.37 A fully differential two-input BiCMOS integrator using MOS transistors in triode, $\mathrm{Q}_{1}$ through $Q_{4} G_{m}-C$ opamp integration is used to reduce parasitic capacitance effects. Note that, in addition to a common-mode feedback circuit for the output (not shown), the common-mode voltage at the input nodes of the opamp must also be set.

Also, transistors $\mathrm{Q}_{7}, \mathrm{Q}_{8}$ are included to realize lead compensation. Finally, it should be mentioned that a common-mode feedback circuit is required at the output nodes of the differential opamp. Also, some method is needed for setting the common-mode voltage at the opamp inputs. The BiCMOS filter in [Laber, 1993] is built in a $1.5-\mu \mathrm{m}, 4-\mathrm{GHz}$ BiCMOS technology and operated around 20 MHz using a $5-\mathrm{V}$ supply. The transconductor demonstrated moderate linearity of around 50 dB when processing $2-\mathrm{V}_{\mathrm{pp}}$ differential output signals, but no mention is made of any intermodulation results or the frequency of the test signals.

### 12.7.2 Fixed-Resistor Transconductor with a Translinear Multiplier

Another approach that has been successfully used to realize BiCMOS filters that have very high linearity has been to use highly linear transconductors realized using fixed resistors and then achieve tuning by following the transconductor with a translinear multiplier. As we saw in Chapter 11, the output of a translinear multiplier is linear with respect to one of its input currents, and its gain coefficient can be scaled as the ratio of two other currents in either a positive or negative fashion.

A translinear multiplier can be used for realizing a low-distortion BiCMOS integrator, as shown in Fig. 12.38 [Willingham, 1993]. Here, the output currents from fixed-value transconductors are applied to a translinear multiplier, such that tuning can be accomplished while maintaining high linearity. The outputs of the translinear multiplier are applied to a opamp-based integrator to maintain high linearity. In this implementation, the input impedance of the fully differential opamp is kept low such that a fixed voltage occurs at the input nodes of the opamp, thereby setting the input common-mode voltage. Phase-lead resistors are also used in series with the integration capacitors (not shown) to improve the integrator's phase response.

The fixed transconductors are realized using resistor degeneration and local feedback, as shown in Fig. 12.39. Fig. 12.39(a) shows that local feedback around the two shown opamps force their input nodes to be equal, and therefore the applied input voltage appears across $\mathrm{R}_{\mathrm{x}}$. A simplified circuit implementation of this approach is shown in Fig. 12.39(b), which shows that the opamps are implemented with only a PMOS transistor and current source.

This integrator was used to build a seventh-order low-pass filter in a $2-\mu \mathrm{m}, 2.5-\mathrm{GHz}$ BiCMOS process that featured thin-film resistors. The filter passband edge was tunable from 7.5 MHz to 10 MHz . The results of this low-distortion BiCMOS filter are quite impressive; third-order intermodulation products remained below 65 dB ,
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-008.jpg?height=371&width=1032&top_left_y=180&top_left_x=372)

Fixed transconductors
Fig. 12.38 A two-input BiCMOS integrator using fixed resistor-degenerated transconductors together with a translinear multiplier for tuning. The common-mode voltage at nodes A and B was set by using a low-input-impedance opamp.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-008.jpg?height=627&width=1366&top_left_y=748&top_left_x=205)

Fig. 12.39 A fixed BiCMOS transconductor: (a) the two local feedbacks keep the input voltage applied across $R_{x}$; (b) circuit implementation.
with respect to the input signal, when measured using two-tone inputs near 4 MHz . Finally, it should be mentioned that the circuit also uses a center tap on each of the $\mathrm{R}_{\mathrm{x}}$ resistors to set the common-mode voltage of the preceding output. With this simple addition, much of the traditional common-mode circuitry is eliminated since it is necessary only to compare the center tap voltage with a dc reference signal and then feed back the appropriate control signal.

Similar approaches, in which a highly linear transconductor that has local feedback is followed by a current attenuator, are also possible using ordinary CMOS and are now gaining in popularity [Chang, 1995].

### 12.7.3 Fixed Active MOS Transconductor with a Translinear Multiplier

A BiCMOS integrator intended for applications that require high-speed operation, wide tuning range, and only moderate linearity is shown in Fig. 12.40 [Shoval, 1993]. In this circuit, the common-mode voltage, $\mathrm{V}_{\mathrm{CM}}$, is set to a constant value (it is set by a common-mode feedback circuit); the result is that the differential currents of $Q_{1}, Q_{4}$ and $Q_{2}, Q_{3}$ are linearly related to the balanced differential voltage (as discussed in Section 12.5). This linear volt-age-to-current conversion remains at a fixed value (resulting in a relatively constant linearity performance and
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-009.jpg?height=590&width=1269&top_left_y=178&top_left_x=265)

Fig. 12.40 A BiCMOS integrator using MOS transistors in the active region for linearization, and a translinear multiplier for tuning. The common-mode feedback circuit is not shown.
input swing level), and transconductance tuning is performed with the aid of a translinear multiplier. Note, however, that two pairs of MOS transistors are performing voltage-to-current conversion on the balanced input signal. The reason for using two pairs is to maximize the largest possible transconductance of the overall circuit for a given bias current. Specifically, if the multiplier is tuned to send all of $\mathrm{i}_{\mathrm{C} 6}, \mathrm{i}_{\mathrm{C} 7}$ through to $\mathrm{v}_{\mathrm{o}}^{+}, \mathrm{v}_{\mathrm{o}}^{-}$, respectively, then the signal currents add together and the overall transconductance is equal to twice that which occurs for a single set of MOS transistors (without an increase in bias current). Alternatively, if the multiplier is tuned to send all of $\mathrm{i}_{\mathrm{C} 6}, \mathrm{i}_{\mathrm{C} 7}$ through to $\mathrm{v}_{\mathrm{o}}^{-}, \mathrm{v}_{\mathrm{o}}^{+}$, respectively, then the currents subtract, causing a zero overall transconductance. Finally, if the translinear multiplier is tuned to cause a zero output (i.e., to cause two constant dc currents at the multiplier outputs), the overall transconductance is equal to that caused by transistors $Q_{2}, Q_{3}$, which is half the maximum value. Thus, the use of two pairs on the input signal doubles the maximum possible transconductance at the cost of being able to tune the transconductance only from zero to the maximum value. In other words, the overall transconductance value cannot change signs by changing the multiplier control signal. Of course, both positive and negative transconductance values can be obtained by cross-coupling the output signals.

This BiCMOS integrator is used to realize a second-order pulse-shaping filter operating on $100-\mathrm{Mb} / \mathrm{s}$ data. Although the filter has a wide tuning range of approximately $10: 1$, it achieves only a moderate spurious-free dynamic range level of 35 dB .

## 12.8 ACTIVE RC AND MOSFET-C FILTERS

Another technique for the realization of analog integrated filters is active RC or MOSFET-C filters. In both techniques, integration of current is performed upon capacitors connected in feedback around a high-gain amplifier, as opposed to transconductance-C filters which use grounded capacitors to integrate current. This is sometimes called Miller integration, since like the Miller compensation capacitor in a two-stage opamp, integrating capacitors are connected around high-gain amplifiers. Miller integration improves linearity, but the need for a high gain-bandwidth product in the amplifier makes active RC and MOSFET-C filters generally slower than their $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ counterparts. Also, they are further reduced in speed in a CMOS technology because opamps capable of driving resistive loads are required as opposed to only capacitive loads in $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filters. However, they are particularly attractive in BiCMOS technologies where high-transconductance opamps are available.

### 12.8.1 Active RC Filters

Active RC filters are well established in both discrete component and integrated analog filter design. Recall that the basic building blocks of analog filters are the integrator, summer, and gain stage. A basic active RC integrator is shown in single-ended form in Fig. 12.41(a). Assuming an ideal opamp, a virtual ground is maintained at $\mathrm{V}_{\mathrm{x}}$. Hence, voltage-to-current conversion is performed by the resistor $R$. The gain of this conversion is determined by the resistor value, which unfortunately will vary under process and temperature variations. However, the use of a passive resistor provides excellent linearity. The resulting current is the integrated upon the capacitor $C_{1}$ and the inverted output appears at $v_{0}$.

Key Point: Active RC filters employ resistors connected to virtual ground nodes to perform voltage-to-current conversion, and then integrate the resulting currents upon Miller capacitors, connected in feedback around high-gain amplifiers.

In Fig. $12.41(b)$, summing is incorporated into the integrator. Its fully-differential implementation is shown. The resistors $\mathrm{R}_{\mathrm{p} 1, \mathrm{p} 2, \mathrm{n} 1, \mathrm{n} 2}$ convert the differential voltage inputs into differential currents. The currents $i_{p 1, p_{2}}$ and $i_{n 1, n 2}$ are then summed by shunting them at the virtual ground nodes $\mathrm{V}_{\mathrm{x}}$. The resulting total current is integrated upon the capacitors $C_{1}$. If pure gain and/or summartion is required without integration, the capacitors may be replaced by resistors in feedback around the opamp, resulting in the familiar inverting opamp configuration.

#### EXAMPLE 12.10

Consider the basic active RC integrator of Fig. 12.41(a), but assume the opamp has a first-order open-loop response characterized by a finite dc gain of $\mathrm{A}_{0}$ and unity-gain frequency $\omega_{\mathrm{ta}}$. What is the resulting frequency response of the integrator?

#### Solution

The frequency response is the expected ideal value of $-1 /(s R C)$ multiplied by $\mathrm{L}(\mathrm{s}) /(1+\mathrm{L}(\mathrm{s})$ ) where $\mathrm{L}(\mathrm{s})$ is the open loop response, being the product of the opamp's open-loop frequency response,

$$
\begin{equation*}
\mathrm{A}(\mathrm{~s})=\frac{\mathrm{A}_{0}}{1+\frac{\mathrm{A}_{0} \mathrm{~S}}{\omega_{\mathrm{ta}}}} \tag{12.150}
\end{equation*}
$$

and the feedback network's frequency response

$$
\begin{equation*}
\beta(s)=\frac{s R C}{1+s R C} \tag{12.151}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-010.jpg?height=316&width=529&top_left_y=1634&top_left_x=311)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-010.jpg?height=392&width=615&top_left_y=1601&top_left_x=930)
(b)

Fig. 12.41 (a) A single-ended active RC integrator. (b) A two-input active-RC fully differential integrator.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-011.jpg?height=960&width=1136&top_left_y=182&top_left_x=368)

Fig. 12.42 The Bode plot of an active RC integrator with finite opamp bandwidth and unity-gain frequency.

Using (12.150) and (12.151) allows us to find the nonideal integrator's actual frequency response.

$$
\begin{equation*}
H(s)=-\frac{1}{(s R C)} \cdot \frac{\left(\frac{A_{0}}{1+\mathrm{A}_{0} s / \omega_{\mathrm{ta}}}\right)\left(\frac{\mathrm{sRC}}{1+\mathrm{sRC}}\right)}{1+\left(\frac{\mathrm{A}_{0}}{1+\mathrm{A}_{0} \mathrm{~s} / \omega_{\mathrm{ta}}}\right)\left(\frac{\mathrm{sRC}}{1+\mathrm{sRC}}\right)} \tag{12.152}
\end{equation*}
$$

Making the assumption $\omega_{\mathrm{ta}} \gg>1 / \mathrm{RC},(12.152)$ may be manipulated to show

$$
\begin{equation*}
\mathrm{H}(\mathrm{~s}) \cong-\frac{\mathrm{A}_{0}}{\left(1+\mathrm{sA} \mathrm{~A}_{0} \mathrm{RC}\right)\left(1+\mathrm{s} / \omega_{\mathrm{ta}}\right)} \tag{12.153}
\end{equation*}
$$

A bode plot of $\mathrm{H}(\mathrm{s})$ appears in Fig. 12.42. Rather than the infinite dc gain provided by an ideal integrator, the dc gain is simply that of the opamp, $A_{0}$. At angular frequencies above $1 / A_{0} R C$, the frequency response is a good approximation of the ideal integrator, $-1 / \mathrm{sRC}$. Then, at frequencies around the unity gain frequency of the opamp, the integrator again deviates from its ideal value due to the limited gain-bandwidth of the opamp. Hence, the integrator is well behaved over the frequency range $1 / A_{0} R C<\omega<\omega_{t a}$ which may place requirements upon the opamp's dc gain and unity gain frequency.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-012.jpg?height=414&width=606&top_left_y=181&top_left_x=597)

Fig. 12.43 A two-input two-transistor MOSFET-C integrator. The MOS transistors are in the triode region.

Based on the block diagram shown in Fig. 12.2, an example active RC implementation of the two-integrator biquad is illustrated in Fig. 12.44(a). The negative conductances are easily realized by cross-connections in a fully-differential implementation. Note that two opamps are required: one for each integrator-hence, one for each pole in the filter. The output of the first integrator is given by

$$
\begin{equation*}
v_{1}(s)=-\frac{G_{1}}{s C_{A}} v_{i}(s)-\frac{G_{4}}{s C_{A}} v_{o}(s) \tag{12.154}
\end{equation*}
$$

whereas the second integrator's output is given by

$$
\begin{equation*}
s C_{B} v_{0}(s)=G_{3} v_{1}(s)-G_{2} v_{i}(s)-s C_{1} v_{i}(s)-G_{5} v_{0}(s) \tag{12.155}
\end{equation*}
$$

Combining the preceding two equations and rearranging, we have

$$
\begin{equation*}
\frac{v_{o}(s)}{v_{i}(s)}=-\frac{\left[\left(\frac{C_{1}}{C_{B}}\right) s^{2}+\left(\frac{G_{2}}{C_{B}}\right) s+\left(\frac{G_{1} G_{3}}{C_{A} C_{B}}\right)\right]}{\left[s^{2}+\left(\frac{G_{5}}{C_{B}}\right) s+\left(\frac{G_{3} G_{4}}{C_{A} C_{B}}\right)\right]} \tag{12.156}
\end{equation*}
$$

Thus, we see that the transfer function is general, and that negative coefficients can be realized by crosscoupling appropriate signal wires.

### 12.8.2 MOSFET-C Two-Transistor Integrators

MOSFET-C filters are similar to fully differential active-RC filters, except resistors are replaced with equivalent MOS transistors in triode. Since active-RC and MOSFET-C filters are closely related, one benefit of MOSFET-C filters is that a designer can use the wealth of knowledge available for active-RC filters. Here, we discuss three variations of MOSFET-C filters-two-transistor integrators, four-transistor integrators, and R-MOSFET-C filters.

An example of a two-transistor MOSFET-C integrator is shown in Fig. 12.43 [Banu, 1983]. It is the counterpart of the two-input fully differential active-RC integrator of Fig. 12.41(b). Before we look at the linearization mechanism that occurrs in a MOSFET-C integrator, let us look at the equivalence of the two circuits in Fig. 12.41(b) and Fig. 12.43. In the active-RC filter, the two input voltages of the opamp are equal (due to negative feedback) and, defining these two input voltages to be $\mathrm{V}_{\mathrm{x}}$, we can write

$$
\begin{equation*}
i_{n o}=i_{p 1}+i_{p 2}=\frac{v_{p 1}-V_{x}}{R_{p 1}}+\frac{v_{p 2}-V_{x}}{R_{p 2}} \tag{12.157}
\end{equation*}
$$

and

$$
\begin{equation*}
i_{p o}=i_{n 1}+i_{n 2}=\frac{v_{n 1}-V_{x}}{R_{n 1}}+\frac{v_{n 2}-V_{x}}{R_{n 2}} \tag{12.158}
\end{equation*}
$$

The output signals are given by

$$
\begin{equation*}
v_{p o}=V_{x}-\frac{i_{p o}}{s C_{I}} \tag{12.159}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{v}_{\mathrm{no}}=\mathrm{V}_{\mathrm{x}}-\frac{\mathrm{i}_{\mathrm{no}}}{\mathrm{~s} \mathrm{C}_{\mathrm{I}}} \tag{12.160}
\end{equation*}
$$

Thus, the differential output signal, $\mathrm{v}_{\text {diff }}$, is

$$
\begin{equation*}
v_{\text {diff }} \equiv v_{\mathrm{po}}-\mathrm{v}_{\mathrm{no}}=\frac{\mathrm{i}_{\mathrm{no}}-\mathrm{i}_{\mathrm{p}}}{\mathrm{~s} C_{\mathrm{I}}} \tag{12.161}
\end{equation*}
$$

Assuming the component values in the positive and negative half circuits are equal, or specifically, if

$$
\begin{equation*}
\mathrm{R}_{1} \equiv \mathrm{R}_{\mathrm{p} 1}=\mathrm{R}_{\mathrm{n} 1} \quad \text { and } \quad \mathrm{R}_{2} \equiv \mathrm{R}_{\mathrm{p} 2}=\mathrm{R}_{\mathrm{n} 2} \tag{12.162}
\end{equation*}
$$

we have

$$
\begin{equation*}
v_{\text {diff }}=\frac{1}{s R_{1} C_{I}}\left(v_{p 1}-v_{n 1}\right)+\frac{1}{s R_{2} C_{I}}\left(v_{p 2}-v_{n 2}\right) \tag{12.163}
\end{equation*}
$$

Thus, we see that the differential output signal, $\mathrm{v}_{\text {diff }}$, equals positive integration of the two input differential signals. Negative integration is easily obtained by cross-coupling two input or output wires. Note that the commonmode signal, $\mathrm{V}_{\mathrm{x}}$, does not affect the final result.

Since the transistors in the MOSFET-C integrator, shown in Fig. 12.43, are assumed to be in the triode region, the small-signal analysis for the MOSFET-C integrator is quite similar to that for the active-RC circuit. Recall from (12.57) that the small-signal equivalent resistance of a transistor in triode is given by

$$
\begin{equation*}
r_{D S}=\frac{1}{\mu_{\mathrm{n}} C_{o x}\left(\frac{W}{L}\right)\left(V_{G S}-V_{t n}\right)} \tag{12.164}
\end{equation*}
$$

Thus, assuming the transistors are matched, the differential output of the MOSFET-C integrator is given by

$$
\begin{equation*}
v_{\text {diff }}=\frac{1}{s r_{\mathrm{DS} 1} C_{I}}\left(v_{p 1}-v_{n 1}\right)+\frac{1}{s r_{D S 2} C_{I}}\left(v_{p 2}-v_{n 2}\right) \tag{12.165}
\end{equation*}
$$

where

$$
\begin{equation*}
r_{D S i}=\frac{1}{\mu_{n} C_{o x}\left(\frac{W}{L}\right)_{i}\left(V_{c}-V_{x}-V_{t n}\right)} \tag{12.166}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-014.jpg?height=1172&width=1062&top_left_y=170&top_left_x=364)

Fig. 12.44 (a) A general second-order active-RC half circuit. (b) The equivalent MOSFET-C filter.

Here, note that $\mathrm{V}_{\mathrm{x}}$ is important because it helps to determine the small-signal resistance of the transistors. Tuning can be accomplished by varying the control voltage, $\mathrm{V}_{\mathrm{c}}$.

Key Point: Replacing the fixed resistors of an active $R C$ integrator with transistors in triode provides tunability, but reduces linearity.

So far, we have analyzed the small-signal operation of a MOSFET-C integrator. In this MOSFET-C case, the differential input signals, $\left(\mathrm{v}_{\mathrm{p} 1}, \mathrm{v}_{\mathrm{n} 1}\right)$ and $\left(\mathrm{v}_{\mathrm{p} 2}, \mathrm{v}_{\mathrm{n} 2}\right)$, are assumed to be balanced around a common-mode voltage, $\mathrm{V}_{\mathrm{CM}}$, set by the output common-mode feedback from the previous integrators. The common-mode feedback of the integrator causes the integrator's two outputs to be balanced also. As a result, it can be shown that $\mathrm{V}_{\mathrm{x}}$ is related to the square of the input signal. This nonlinear relationship at $\mathrm{V}_{\mathrm{x}}$ together with the nonlinear current through triode transistors results in quite linear single-ended signals at $\mathrm{V}_{\mathrm{no}}$ and $\mathrm{V}_{\mathrm{po}}$. In addition, since the circuit is fully differential, evenorder distortion products cancel, as depicted in Section 6.7. Thus, two-transistor MOSFET-C integrators can be used to realize filters with around a $50-\mathrm{dB}$ linearity.

An example of a general second-order MOSFET-C filter is shown in Fig. 12.44(b). It is equivalent to the active RC filter half-circuit of Fig. $12.44(a)$, with the terms $\mathrm{G}_{\mathrm{i}}$ representing the small-signal drain-source conductance of the transistors. The transfer function for this filter is the same as its equivalent active-RC half circuit, given by (12.156).

### 12.8.3 Four-Transistor Integrators

One way to improve the linearity of a MOSFET-C filter is to use four-transistor MOSFET-C integrators, as shown in Fig. 12.45 [Czarnul, 1986]. The small-signal analysis of this four-transistor integrator can be found by treating this one-input integrator as effectively a two-input integrator in which the two input signals are $\left(\mathrm{v}_{\mathrm{pi}}-\mathrm{v}_{\mathrm{ni}}\right)$ and the inverted signal is $\left(\mathrm{v}_{\mathrm{ni}}-\mathrm{v}_{\mathrm{pi}}\right)$. With such an observation, and applying (12.165), the output signal is given by

$$
\begin{equation*}
\mathrm{v}_{\mathrm{diff}}=\frac{1}{\mathrm{sr}_{\mathrm{DS} 1} \mathrm{C}_{\mathrm{I}}}\left(\mathrm{v}_{\mathrm{pi}}-\mathrm{v}_{\mathrm{ni}}\right)+\frac{1}{\mathrm{sr}_{\mathrm{DS} 2} \mathrm{C}_{\mathrm{I}}}\left(\mathrm{v}_{\mathrm{ni}}-\mathrm{v}_{\mathrm{pi}}\right) \tag{12.167}
\end{equation*}
$$

where

$$
\begin{equation*}
\mathrm{r}_{\mathrm{DS} 1}=\frac{1}{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)_{1}\left(\mathrm{~V}_{\mathrm{C} 1}-\mathrm{V}_{\mathrm{x}}-\mathrm{V}_{\mathrm{t}}\right)} \tag{12.168}
\end{equation*}
$$

and

$$
\begin{equation*}
r_{D S 2}=\frac{1}{\mu_{n} C_{o x}\left(\frac{W}{L}\right)_{2}\left(V_{C 2}-V_{x}-V_{t}\right)} \tag{12.169}
\end{equation*}
$$

In the case where all four transistors are matched, we can combine the preceding equations to obtain

$$
\begin{equation*}
\mathrm{v}_{\mathrm{diff}}=\mathrm{v}_{\mathrm{po}}-\mathrm{v}_{\mathrm{no}}=\frac{1}{\mathrm{sr}_{\mathrm{DS}} \mathrm{C}_{\mathrm{I}}}\left(\mathrm{v}_{\mathrm{pi}}-\mathrm{v}_{\mathrm{ni}}\right) \tag{12.170}
\end{equation*}
$$

where $r_{D S}$ is given by

$$
\begin{equation*}
\mathrm{r}_{\mathrm{DS}}=\frac{1}{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)\left(\mathrm{V}_{\mathrm{C} 1}-\mathrm{V}_{\mathrm{C} 2}\right)} \tag{12.171}
\end{equation*}
$$

Thus, we see that the effective resistance is determined by the difference in the control voltages.
With regard to the distortion properties of this integrator, it has been shown for long channel-length transistors that the drain-source current in a triode transistor is reasonably well modelled by an equation in which the nonlinear distortion terms do not depend on the controlling gate voltage. In other words, although the linear term of each drain
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-015.jpg?height=417&width=759&top_left_y=1627&top_left_x=518)

Fig. 12.45 A single-input four-transistor MOSFET-C integrator. It can cancel both even and odd distortion products if the nonlinear terms are not dependent on the control signals, $\mathrm{V}_{\mathrm{C} 1}$ and $\mathrm{V}_{\mathrm{C} 2}$.
current is set by the controlling gate voltage, all distortion terms of the drain currents remain equal in the pair $\mathrm{Q}_{\mathrm{p} 1}, \mathrm{Q}_{\mathrm{p} 2}$ as well as in the pair, $\mathrm{Q}_{\mathrm{n} 1}, \mathrm{Q}_{\mathrm{n} 2}$ since, within each pair, the drain-source voltages are equal. As a result of the cross-coupling connection, both the even and odd distortion terms cancel. Unfortunately, this model does not hold as well for short-channel devices, and transistor mismatch also limits the achievable distortion performance. Hence, in practice, one might expect around a $10-\mathrm{dB}$ linearity improvement using this technique over the two-transistor MOSFET-C integrator.

### 12.8.4 R-MOSFET-C Filters

Another technique intended to improve the linearity of MOSFET-C filters is the use of additional linear resistors [Moon, 1993]. An R-MOSFET-C first-order filter and its MOSFET-C counterpart are shown in Fig. 12.46. Using the equivalent active-RC half circuit, shown in Fig. 12.46(c), one finds the transfer function of this first-order R-MOSFET-C filter to be given by

$$
\begin{equation*}
\frac{v_{0}(s)}{v_{i}(s)}=-\frac{R_{2} / R_{1}}{s C_{1}\left[R_{2}\left(1+\frac{R_{Q_{1}}}{R_{1}\left\|R_{2}\right\| R_{Q_{2}}}\right)\right]+1} \tag{12.172}
\end{equation*}
$$

Key Point: Adding fixed passive series resistors to active MOSFET-C filters can improve their linearity.
where $R_{Q 1}$ and $R_{Q 2}$ represent the small-signal drain-source resistances of $Q_{1}$ and $\mathrm{Q}_{2}$, respectively. Note that the dc gain of this first-order filter is not adjustable. However, it can be set precisely since it is determined by the ratio of two resistors. In addition, the time constant can vary from a minimum value of $R_{2} C_{I}$ to an arbitrarily large value by changing the values of $R_{Q_{1}}$ and $R_{Q 2}$ via the control voltages, $\mathrm{V}_{\mathrm{C} 1}$ and $\mathrm{V}_{\mathrm{C} 2}$. What this transfer function equation indicates is that at low frequencies, the feedback around $R_{2}$ forces node $v_{x}$ to act as a virtual ground, and therefore excellent linearity is obtained since the circuit is essentially a resistor-only circuit. In [Moon, 1993], a linearity of approximately -90 dB is observed with input signals in the range of a few kilohertz. At higher frequencies, the linearity steadily decreases, and measured results of -70 dB are reported at the passband edge of a fifth-order Bessel filter (the passband is around 20 kHz ). However, it should be noted that the measured values are total-harmonic-distortion values, and no intermodulation results are reported.

One other approach that has been used to realize high-linearity continuous-time filters is simply to realize differential active-RC filters, but to realize the capacitors using digitally programmable capacitor arrays. For example, [Durham, 1993] describes a filter intended for digital-audio interfaces that achieves distortion products at a -94-dB and a $95-\mathrm{dB}$ signal-to-noise ratio.

## 12.9 TUNING CIRCUITRY

Key Point: Analog filter time constants, determined by $\mathrm{G}_{\mathrm{m}} / \mathrm{C}$ or RC products, vary considerably over process and temperature. Hence, tuning is required to ensure accurate and repeatable frequency responses.

As mentioned at the beginning of this chapter, one disadvantage of continuoustime integrated filters is the requirement of additional tuning circuitry. This requirement is a result of large time-constant fluctuations due mainly to process variations. For example, integrated capacitors might have 10 percent variations, whereas resistors or transconductance values might have around 20 percent variations. Since these elements are constructed quite differently, the resulting RC or $\mathrm{G}_{\mathrm{m}} / \mathrm{C}$ time-constant products are accurate to only around 30 percent with these process variations. In addition, temperature variations further aggravate the situation because resistance and transconductance values change substantially
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-017.jpg?height=533&width=553&top_left_y=181&top_left_x=164)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-017.jpg?height=399&width=680&top_left_y=805&top_left_x=176)

$$
\frac{v_{0}(s)}{v_{i}(s)}=-\frac{R_{2} / R_{1}}{s C_{I}\left[R_{2}\left(1+\frac{R_{Q 1}}{R_{1}\left\|R_{2}\right\| R_{Q 2}}\right)\right]+1}
$$

(c)

Fig. $\mathbf{1 2 . 4 6}$ (a) A first-order MOSFET-C filter. (b) A first-order R-MOSFET-C filter. (c) Equivalent active-RC half-circuit for R-MOSFET-C filter.
over temperature. Thus, we need tuning circuitry to modify transconductance values such that the resulting overall time constants are set to known values. It should be noted, however, that although absolute component tolerances are high, relative accuracies can be quite good. Specifically, the ratio of two capacitors (or two resistors, or two transistors) can be matched to under 1 percent. This section discusses some techniques to realize tuning circuitry for integrated continuous-time filters. Note that, although the tuning approaches are discussed while we refer to $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ (transconductance-C) filters, the concepts are easily extended to other integrated continuous-time filters, such as MOSFET-C filters.

### 12.9.1 Tuning Overview

Consider once again the $G_{m}-C$ continuous-time biquad filter shown in Fig. 12.10. Its transfer function, repeated here for convenience, is given by

$$
\begin{equation*}
H(s)=\frac{s^{2}\left[\frac{C K_{x}}{C_{x}+C_{B}}\right]+s\left[\frac{G_{m 5}}{C_{X}+C_{B}}\right]+\left(\frac{G_{m 2} G_{m 4}}{\left[C_{A}\left(C_{x}+C_{B}\right)\right]}\right)}{s^{2}+s\left[\frac{G_{m 3}}{C_{x}+C_{B}}\right]+\left(\frac{G_{m 1} G_{m 2}}{\left[C_{A}\left(C_{X}+C_{B}\right)\right]}\right)} \tag{12.173}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-018.jpg?height=387&width=1056&top_left_y=176&top_left_x=381)

Fig. 12.47 Indirect frequency tuning. Note that, although the tuning signal is shown here as a voltage signal, it may also be realized using a set of current controlling signals.

Although the transconductances, $\mathrm{G}_{\mathrm{mi}}$, have large variations in their absolute values, relative transconductance values can also be set reasonably accurately. For example, if the transconductors are realized as bipolar differential pairs with an emitter degeneration resistor (as shown in Fig. 12.12), then the relative transconductance values of two transconductors is set by the ratio of their respective emitter degeneration resistors (assuming the gain-cell currents are equal in the two transconductors). Similarly, if other transconductors of the same type are used, their relative $G_{m}$ values can be accurately set by choosing appropriate transistor sizes, bias currents, or resistor values (or some combination of the three). As a result, we can write all the transconductance values, $\mathrm{G}_{\mathrm{mi}}$, as an accurate constant multiplied by some basic transconductance value. Specifically, let us write all the transconductance values, $G_{m i}$, as a function of $G_{m 1}$, resulting in

$$
\begin{equation*}
G_{m i}=k_{m i} G_{m 1} \tag{12.174}
\end{equation*}
$$

Here, the constants, $\mathrm{k}_{\mathrm{mi}}$, are set reasonably accurately by appropriate transistor, resistor, or bias-current scaling. Furthermore, let us also write

$$
\begin{equation*}
C_{X}+C_{B}=k_{X B} C_{A} \tag{12.175}
\end{equation*}
$$

where $k_{X B}$ is a constant that is accurately set as the ratio of capacitance values. Similarly, let $k_{X}=C_{X} / C_{A}$. With such an approach, (12.173) becomes

$$
\begin{equation*}
H(s)=\frac{s^{2}\left[\frac{k_{x}}{k_{x B}}\right]+s\left(\frac{k_{m 5}}{k_{X B}}\right)\left(\frac{G_{m 1}}{C_{A}}\right)+\left(\frac{k_{m 2} k_{m 4}}{k_{X B}}\right)\left(\frac{G_{m 1}}{C_{A}}\right)^{2}}{s^{2}+s\left(\frac{k_{m 3}}{k_{x B}}\right)\left(\frac{G_{m 1}}{C_{A}}\right)+\left(\frac{k_{m 1} k_{m 2}}{k_{x B}}\right)\left(\frac{G_{m 1}}{C_{A}}\right)^{2}} \tag{12.176}
\end{equation*}
$$

We see from (12.176) that the coefficients for this second-order filter can be accurately set if only one ratio is tuned-that of $G_{m 1} / C_{A}$. Since it is difficult to tune $C_{A}$, the ratio $G_{m 1} / C_{A}$ is tuned by changing $G_{m 1}$. Of course, as $G_{m 1}$ is varied, all the other transconductance values, $G_{m i}$, are also changed since their values must track that of $\mathrm{G}_{\mathrm{m} 1}$ by their respective constants, $\mathrm{k}_{\mathrm{m}}$. It should be mentioned here that this same single transconductance tuning is also valid for higher-order filter structures.

In summary, the most common way to tune a continuous-time integrated filter is to build an extra transconductor that is tuned (tuning details are discussed next) and to use the resulting tuning signal to control the filter transconductors, as shown in Fig. 12.47. Such an approach is commonly referred to as indirect frequency tuning. This tuning is indirect since one relies on matching between the filter transconductors (and parasitic capacitances) and the extra transconductor. In other words, the filter is not directly tuned by looking at its output signal. Frequency tuning refers to the fact that the ratio $G_{m 1} / C_{A}$ is equal to the unity-gain frequency of a $G_{m}-C$ integrator. ( $\mathrm{G}_{\mathrm{m} 1} / \mathrm{C}_{\mathrm{A}}$ is also proportional to the pole frequency, $\omega_{0}$, in a first- or second-order filter.)

Unfortunately, this frequency-tuning approach may not be sufficient in some applications due to nonideal integrators or mismatch effects. In these applications, some extra tuning circuitry known as Q-factor tuning (discussed later in this section) can be used. It is also possible to implement direct tuning where the filter is tuned by directly looking at the filter's output. Two such direct approaches are also discussed in this section.

### 12.9.2 Constant Transconductance

As just discussed, if no tuning is performed, one might expect around a 30-percent tolerance on the absolute value for the $\mathrm{G}_{\mathrm{m}} / \mathrm{C}$ ratio. However, integrated capacitance tolerance typically accounts for only a 10 -percent variation in the overall 30-percent tolerance. Thus, in applications where a 10-percent variation can be permitted (such as an anti-aliasing filter with a sample rate moderately higher than the Nyquist rate), it is sufficient to set only the $\mathrm{G}_{\mathrm{m}}$ value with the use of a fixed external resistor. As we will see below, such tuning of a $G_{m}$ value is not difficult and does not require any clock signals.

In the case where 10-percent accuracy is not enough, clearly one must also account for capacitor tolerance. One way to do so (while still not needing a clock signal) is to have a variety of external resistors available and choose the most appropriate one to also account for capacitor tolerance. With such an approach, one might expect that the overall $G_{m} / C$ ratio would be accurate to under 1 percent. Although a variety of methods exist for choosing this external resistance, one way is to use a known value of external resistance and measure the step response of the filter during system production. This step-response result can then be used to determine the C value, and hence the proper resistance value can be calculated. Finally, since integrated capacitors typically have small temperature coefficients, overall temperature effects are small if the external resistor is also chosen to have a low temperature coefficient.

To set a transconductance value equal to the inverse of an external resistance, (i.e., $G_{m}=1 / R_{\text {ext }}$ ), a variety of feedback circuits can be used. Two example circuits are shown in Fig. 12.48, where it should be noted that, in both cases, it is assumed the transconductor's transconductance increases as the level of the control signal is increased. In Fig. 12.48(a), if $\mathrm{G}_{\mathrm{m}}$ is too small, the current through $\mathrm{R}_{\text {ext }}$ is larger than the current supplied by the transconductor, and the difference between these two currents is integrated with the opamp and capacitor. As a result, the control voltage, $\mathrm{V}_{\text {cntt }}$, is increased until these two currents are equal (but opposite in direction) and, therefore, $\mathrm{G}_{\mathrm{m}}=1 / \mathrm{R}_{\text {ext }}$. The circuit in Fig. 12.48(b) shows two voltage-to-current converters-one is the transconductor being tuned, and the other is a fixed voltage-to-current converter that simply needs a large transconductance and is
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-019.jpg?height=359&width=1370&top_left_y=1462&top_left_x=203)
(For both circuits)
(a)

$$
\begin{equation*}
G_{m}=\frac{1}{R_{e x t}} \tag{b}
\end{equation*}
$$

Fig. 12.48 Constant transconductance tuning. Possible tuning circuits if the transconductors are (a) voltage controlled or (b) current controlled. In both circuits, it is assumed the transconductor's transconductance increases as the level of the control signal increases. $\mathrm{V}_{\mathrm{B}}$ is an arbitrary voltage level, whereas $C_{I}$ is an integrating capacitor used to maintain loop stability.
not necessarily linear. (It might be implemented as a simple differential pair.) This circuit operates as follows: If $G_{m}$ is too small, then the voltage at the top of $R_{\text {ext }}$ will be less than $V_{B}$ and the fixed $V / I$ converter will increase $I_{\text {cntl }}$. At steady state, the differential voltage into the fixed V/I converter will be zero, resulting in $G_{m}=1 / R_{\text {ext }}$.

### 12.9.3 Frequency Tuning

A precise tuning of a $G_{m} / C_{A}$ ratio can be achieved if an accurate time period is available. For example, assuming one has available an accurate clock frequency, say, $\mathrm{f}_{\mathrm{clk}}$, then one method of frequency tuning is by using a switchcapacitor circuit as shown in Fig. 12.49 [Viswanathan, 1982]. Here, the tuning circuit is quite similar to the constant-transconductance approaches of Fig. 12.48, except that the external resistance is replaced with a switched-capacitor equivalent resistance. From Chapter 14, the equivalence resistance of the switched-capacitor circuit is given by $R_{e q}=1 /\left(f_{c l k} C_{m}\right)$, and therefore the transconductance value, $G_{m}$, is set to $f_{c l k} C_{m}$. In this way, the $G_{m} / C_{A}$ ratio is accurately set to $\left(f_{c \mid k} C_{m}\right) / C_{A}$, and hence precise frequency tuning can be achieved without any external components. Note that an additional low-pass filter, $\mathrm{R}_{1} \mathrm{C}_{1}$, has been added here to remove the highfrequency ripple voltage due to using a switched-capacitor circuit. It should also be noted that, since this method requires a clock signal, there is a strong possibility that some of the clock signal will leak into the continuous-time filter, either mainly through the transconductor controlling signal or through the IC substrate.

One difficulty with this switched-capacitor tuning approach is that it requires large transconductance ratios (and hence poorer matching) if high-frequency filters are desired. For example, consider the case of a $100-\mathrm{MHz}$ filter, where the $G_{m} / C_{A}$ ratio should be set to around $2 \pi \times 100 \mathrm{MHz}$. If a capacitance value, $C_{A}$, is assumed to be 1 pF , then $\mathrm{G}_{\mathrm{m}}=2 \pi \times 10^{-4} \mathrm{~V} / \mathrm{A}$. Thus, in the tuning circuit of Fig. 12.49 , assuming that $\mathrm{C}_{\mathrm{m}}=1 \mathrm{pF}$, we would require the switched-capacitor circuit to be clocked at the impractical frequency of

$$
\begin{equation*}
\mathrm{f}_{\mathrm{clk}}=\frac{\mathrm{G}_{\mathrm{m}}}{\mathrm{C}_{\mathrm{m}}}=\frac{2 \pi \times 10^{-4}}{1 \times 10^{-12}}=628 \mathrm{MHz} \tag{12.177}
\end{equation*}
$$

At first glance, one might consider reducing this clock frequency by increasing the value of $C_{m}$, but, although $f_{c k}$ is reduced, settling-time requirements remain difficult since the capacitance, $C_{m}$, is larger. Another way to reduce $f_{c l k}$ is to let the tuning circuit set a smaller transconductance value, say, $0.1 \mathrm{G}_{\mathrm{m}}$. In this way, $\mathrm{f}_{\mathrm{cl}}$ is reduced by ten but the filter's transconductors must be 10 times greater than the tuning circuitry's transconductor. Thus, poorer matching occurs between the filter and the tuning circuitry, resulting in a less accurate frequency setting for the filter.

Another approach to lower the clock frequency of this switched-capacitor tuning circuitry is by using two scaled current sources, as shown in Fig. 12.50 [SilvaMartinez, 1992]. Using an equivalent resistance of
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-020.jpg?height=442&width=1090&top_left_y=1569&top_left_x=341)

Fig. 12.49 A frequency-funing circuit where $G_{m}$ is set by a switched-capacitor circuit. The switched-capacitor branch has a clock frequency of $f_{c l k}$. The low-pass filter, $R_{1} C_{1}$, is set to a frequency low enough to reduce the high-frequency ripple voltage.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-021.jpg?height=428&width=1231&top_left_y=179&top_left_x=275)

Fig. 12.50 A switched-capacitor frequency-tuning circuit that operates at a lower clock frequency.
$-1 / \mathrm{f}_{\mathrm{ck}} \mathrm{C}_{\mathrm{m}}$ for the switched-capacitance circuit, and noting that the diode-connected transconductor is equivalent to a resistor of value $1 / \mathrm{G}_{\mathrm{m}}$, one can show that when the average current into the integrator is zero, the transconductance value is given by

$$
\begin{equation*}
\mathrm{G}_{\mathrm{m}}=N \mathrm{f}_{\mathrm{clk}} \mathrm{C}_{\mathrm{m}} \tag{12.178}
\end{equation*}
$$

Thus, the clock frequency of this circuit is N times lower than that for the circuit shown in 15.47. This circuit was used to tune a $10.7-\mathrm{MHz}$ bandpass filter, where a value of $\mathrm{N}=148$ was used, resulting in a clock frequency of only 450 kHz . The low-pass filter was also realized by using a switched-capacitor circuit and an off-chip capacitor.

Another approach to achieving frequency tuning is to use a phase-locked loop (PLL) (described in Chapter 19) as shown in Fig. 12.51 [Tan, 1978]. Here, two continuous-time integrators are placed in a loop to realize a voltage-controlled oscillator that is placed into a phase-locked loop. After the circuit is powered up, the negative feedback of the PLL causes the VCO frequency and phase to lock to the external reference clock. Once the VCO output is locked to an external reference signal, the $\mathrm{G}_{\mathrm{m}} / \mathrm{C}$ ratio of the VCO is set to a desired value, and the control voltage, $\mathrm{V}_{\text {cntt }}$, can be used to tune the integrated filter. It should be noted that choosing the external reference clock is a trade-off because it affects both the tuning accuracy as well as the tuning signal leak into the main filter. Specifically, for best matching between the tuning circuitry and the main filter, it is best to choose the reference frequency that is equal to the filter's upper passband edge. However, noise gains for the main filter are typically the largest at the filter's upper passband edge, and therefore the reference-signal leak into the main filter's output might be too severe. As one moves away from the upper passband edge, the matching will be poorer, but an improved immunity to the reference signal results. Another problem with this approach is that, unless some kind of power-supply-insensitive voltage control is added to the VCO, any power-supply noise will inject jitter into the control signal, $\mathrm{V}_{\mathrm{cnt1}}$. The addition of amplitude control is quite complicated. For a good discussion of this phase-locked-loop approach, see [Krummenacher, 1988; Khoury, 1991]. For a better understanding of the operation of a phase-locked loop, see Chapter 19.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-021.jpg?height=336&width=1131&top_left_y=1695&top_left_x=325)

Fig. 12.51 Frequency tuning using a phase-locked loop. The VCO is realized by using transconductor-based integrators that are tuned to adjust the VCO's frequency.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-022.jpg?height=261&width=1284&top_left_y=182&top_left_x=244)

Fig. 12.52 Using a tracking filter to derive a control signal for tuning continuous-time filters.

Another, somewhat similar, approach that has been used is based on having a tracking filter that locks onto a fixed-frequency input [Khorramabadi, 1984]. This approach is reported to be less sensitive to power-supply noise. The control voltage for the tracking filter is used to adjust the transconductors that are used in the actual system, assuming the transconductors in the tracking filter match the transconductors in the actual system. An example calibration system is shown in Fig. 12.52. When the low-pass filter has the same resonant frequency as the external reference clock, it has exactly a 90 -degree phase shift. Therefore, the correlation between its input and output is zero. If the frequencies are not the same, then the correlation, as obtained by the multiplier and integrator, is nonzero. The negative feedback from the output of the integrator to the frequency-control voltage of the filter drives the resonant frequency in the proper direction to equalize the two frequencies. After lock is obtained, the same control voltage can be used for other filters. The other filters will be tuned to known time constants, assuming they match the filter in the control loop.

It is important that the integrator in the loop have a very low-frequency time constant in order to filter out the component at twice the external reference frequency that is present at the output of the multiplier. Otherwise, this component can cause clock leakage into the other filters being tuned. A variant on this scheme drives the correlation between a notch output and a low-pass filter output (obtained from the same biquad) to zero when one is obtaining the control voltage [Kwan, 1991]. This latter method has much fewer signal components at twice the frequency of the external reference clock and does not require as large a time constant for the integrator in the loop. This makes the latter method more readily integrable without external components. Also, the loop is less sensitive to phase errors; it will always converge to the notch frequency, even when the difference in phase between the low-pass and notch outputs is not exactly $90^{\circ}$.

### 12.9.4 Q-Factor Tuning

In some applications, such as high-speed or highly-selective filtering, nonideal integrator effects and parasitic components force the need to also tune the Q-factors of the poles of the integrated filter. Although we have seen that tuning a single time constant can set all coefficients of an integrated filter with around $1 \%$ accuracy, when $\mathrm{Q}>1$, even small errors in the Q -factor can result in large errors in the filter frequency and step response. Hence, in some applications additional tuning is needed to precisely set the Q -factors.

One way to perform Q-factor tuning is to tune the phase of the filter's integrators to ensure that they all have a 90-degree phase lag near the filter's passband edge. An integrator's phase response can be adjusted by introducing a tunable resistance (say, realized as a transistor in triode) in series with the integrating capacitor. The control voltage for this tunable resistance, $\mathrm{V}_{\mathrm{Q}}$, is generated by a Q -factor tuning circuit, shown in Fig. 12.53, and passed to all the filter integrators.

Alternatively, in the case where the integrated filter is second order, the pole Q can be adjusted by changing the transconductance of the damping transconductor in the filter. Specifically, referring back to (12.176) and equating the denominator to a second-order denominator written in the form of $\omega_{0}$ and $Q$, we have

$$
\begin{equation*}
s^{2}+s\left(\frac{k_{m 3}}{k_{X B}}\right)\left(\frac{G_{m 1}}{C_{A}}\right)+\left(\frac{k_{m 1} k_{m 2}}{k_{X B}}\right)\left(\frac{G_{m 1}}{C_{A}}\right)^{2}=s^{2}+s\left(\frac{\omega_{o}}{Q}\right)+\omega_{o}^{2} \tag{12.179}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-023.jpg?height=407&width=1314&top_left_y=180&top_left_x=236)

Fig. 12.53 A magnitude-locked loop for Q-factor tuning. The Q-reference circuit is typically a second-order filter that is frequency tuned through the use of $\mathrm{V}_{\text {cntt }}$.

Solving, we find the following relationships:

$$
\begin{align*}
\omega_{o} & =\left(\frac{G_{m 1}}{C_{A}}\right) \sqrt{\frac{k_{m 1} k_{m}}{k_{X B}}}  \tag{12.180}\\
Q & =\left(\frac{k_{x B}}{k_{m 3}}\right) \sqrt{\frac{k_{m 1} k_{m} 2}{k_{x B}}} \tag{12.181}
\end{align*}
$$

From this $Q$ relationship, we see that the $Q$ factor of the filter's poles is inversely proportional to $k_{m 3}$, and hence one need only tune $G_{m 3}$ to adjust the Q factor of this second-order filter.

The control signal, $\mathrm{V}_{\mathrm{Q}}$, for either of the preceding Q -factor tuning approaches can be realized using the mag-nitude-locked loop system shown in Fig. 12.53 [Schaumann, 1990]. The circuit's operation is based on the knowledge that a Q-factor error results in a magnitude error in a filter's frequency response. To measure the magnitude error, a sinusoidal signal of an appropriate reference frequency is applied to a Q-reference circuit, and the magnitude of its output is compared to a scaled version of the input signal's magnitude. This sinusoidal frequency might be obtained as the output of the VCO in the frequency-tuning circuitry.

### 12.9.5 Tuning Methods Based on Adaptive Filtering

Adaptive filters are commonly used in digital-signal-processing applications such as model matching, channel equalization, and noise (or echo) cancellation. It is also possible to use adaptive filter techniques to tune a continuous-time integrated filter to a given specification. One example of such an approach is shown in Fig. 12.54 [Kozma, 1991], where the adaptive tuning circuitry is used to minimize the error signal. During tuning, the input to the tunable filter is a predetermined output from a pseudorandom (PN) 4-bit sequence and a D/A converter. Since the input is known and repetitive, the ideal output from a desired transfer-function can be precalculated (or simulated) and used as a reference signal for the adaptive system. After adaptation, the transfer function of the tunable filter should match that of the desired filter, and, by freezing the coefficients (assuming they are digitally controlled), the tunable filter can be disconnected from the tuning circuit and used in the desired operation. With this approach, it is possible to tune all the poles and zeros of the tunable filter to better match the desired transfer function.

Another adaptive-filter tuning method intended for high-speed data transmission over a twisted-wire pair is shown in Fig. 12.55 [Shoval, 1995]. In this application, the filter input is a data stream of ones and zeros that are represented by the input signal being either high or low. Before transmission, a pulse-shaping filter is required to ensure that not too much high-frequency power is radiated from the twisted-wire channel. The two tuning loops
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-024.jpg?height=535&width=960&top_left_y=180&top_left_x=408)

Fig. 12.54 A tuning approach in which all the poles and zeros of the tunable filter can be adjusted. The 15-level DAC outputs are determined by what the ideal filter response would generate, while the adaptive tuning circuitry minimizes the error signal.
(frequency and Q-factor loops) rely on the fact that the input to the filter is a series of steps (say, $\pm 1 \mathrm{~V}$ ), and thus, in fact, tune the step response of the filter. Specifically, frequency tuning is accomplished by ensuring that the zero crossing of the filter's low-pass output occurs at the correct time period after a data transition. Also, Q-factor tuning is performed by comparing the peak in the filter's bandpass output with a known voltage. Fortunately, the peak in the bandpass output occurs at approximately the same time as the zero crossing, so both detectors can be realized through the use of two clocked comparators, which are triggered at a set time after a data transition. In summary, clever tuning techniques can be implemented when a restricted set of input signals are applied to a tunable filter such as in data communication circuits.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-024.jpg?height=788&width=1183&top_left_y=1266&top_left_x=299)

Fig. 12.55 A tuning method to implement a pulse-shaping filter needed for data communication systems.

## 12.10 INTRODUCTION TO COMPLEX FILTERS

This section is based upon the tutorial introduction published in [Martin, 2004] much of which is in turn based upon work published in [Lang, 1981], [Snelgrove, 1981], [Snelgrove, 1982], [Allen, 1985].

### 12.10.1 Complex Signal Processing

A complex signal consists of a pair of real signals at an instant in time. If one denotes the complex signal, $\mathrm{X}(\mathrm{t})$, as $\mathrm{X}(\mathrm{t})=\mathrm{X}_{\mathrm{r}}(\mathrm{t})+\mathrm{j} \mathrm{x}_{\mathrm{q}}(\mathrm{t})$, where $\mathrm{j}=\sqrt{-1}$, then a Hilbert Space can be defined using appropriate definitions for addition, multiplication, and an inner-product and norm. In an actual physical system, the signals are both real (but are called the real and imaginary parts) and are found in two distinct signal paths. The multiplier " j " is used to help define operations between different complex signals, and is to some degree imaginary; i.e., it doesn't actually exist in real systems. Often the dependence of signals on time is not shown explicitly.

The use of complex signal processing to describe wireless systems is increasingly important and ubiquitous for the following reasons: it often allows for image-reject architectures to be described more compactly and simply; it leads to a graphical or signal-flow-graph (SFG) description of signal-processing systems providing insight, and it often leads to the development of new systems where the use of high-frequency highly selective image-reject filters is minimized. The result is more highly integrated systems using less power and requiring less physical space.

As an example, consider the popular "quadrature" mixer with a real input as shown in Fig. 12.56. In the complex SFG, two real multiplications have been replaced by a single complex multiplication. Furthermore, since in the time domain we have

$$
\begin{align*}
Y(t) & =y_{r}(t)+j y_{q}(t)  \tag{12.182}\\
& =X(t) e^{j \omega_{i} t} \\
Y(\omega) & =X\left(\omega-\omega_{i}\right) \tag{12.183}
\end{align*}
$$

then taking the Fourier transform we have
and we see that an ideal quadrature mixer results in a simple frequency-shift of the input signal with no images occurring, a conclusion that is obvious from Fig. 12.56(b), but is certainly not obvious from Fig. 12.56(a). If this mixer is followed by a low-pass filter in each path, then it can be used to directly demodulate carrier-frequency signals without images. For this reason, it often called an image-reject mixer although if one is being accurate, the term should denote the combination of the quadrature mixer and lowpass filters.

Complex signal processing systems operate on ordered pairs of real signals. A possible definition for a complex inner-product is

$$
\begin{equation*}
\left\langle\mathrm{x}_{1}(\mathrm{t}), \mathrm{x}_{2}(\mathrm{t})\right\rangle=\lim _{\mathrm{t} \rightarrow \infty} \frac{1}{2 \mathrm{t}} \int_{-\mathrm{t}}^{\mathrm{t}} \mathrm{x}_{1}(\tau) \mathrm{x}_{2}^{*}(\tau) \mathrm{d} \tau \tag{12.184}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-025.jpg?height=316&width=571&top_left_y=1689&top_left_x=267)

$$
X(t)=x_{r}(t)+j \times 0
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-025.jpg?height=126&width=282&top_left_y=1704&top_left_x=1284)

$$
e^{j \omega_{i} t}
$$

(b)

Fig. 12.56 A signal-flow-graph (SFG) of an quadrature mixer using (a) a real SFG and (b) a complex SFG.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-026.jpg?height=298&width=816&top_left_y=184&top_left_x=834)

Fig. 12.57 (a) The real SFG for adding two complex signals and (b) the equivalent complex SFG.

Combining this definition with the typical definitions for complex inversion, addition, and multiplication, and with the properties of commutation and association, constitutes a Hilbert space. It is assumed that all signals are periodic and frequency-limited and therefore can be expressed as a finite series of "complexoids" ${ }^{3}$

$$
\begin{equation*}
x_{i}(t)=\sum_{i=-N} k_{i} e^{j \omega_{0} i t} \tag{12.185}
\end{equation*}
$$

where $k_{i}$ is in general complex. Here, we will limit our consideration to a single (or a few) complexoids in order to simplify explanations.

### 12.10.2 Complex Operations

Complex continuous-time filters are realized using only three basic operations: complex addition, complex multiplication, and complex integration.

Key Point: Complex filters are realized using three basic operations performed on ordered pairs of real signals: complex addition, multiplication, and integration.

A complex addition of two complex signals simply adds the two real parts and the two imaginary parts independently. Consider the real SFG that represents adding a complex signal to a second complex signal, as is shown in Fig. 12.57(a). Its complex SFG is shown in Fig. 12.57(b).

Slightly more complicated is a complex multiplication; consider multiplying a complexoid $X(t)=e^{j \omega_{i} t}$ by a complex coefficient $\mathrm{K}=\mathrm{a}+\mathrm{jb}$. We have

$$
\begin{align*}
\mathrm{Y}(\mathrm{t})= & \left\{\mathrm{a} \cos \left(\omega_{\mathrm{i}} \mathrm{t}\right)-\mathrm{b} \sin \left(\omega_{\mathrm{i}} \mathrm{t}\right)\right\}  \tag{12.186}\\
& +\mathrm{j}\left\{\mathrm{a} \sin \left(\omega_{\mathrm{i}} \mathrm{t}\right)+\mathrm{b} \cos \left(\omega_{\mathrm{i}} \mathrm{t}\right)\right\}
\end{align*}
$$

The real SFG of this operation is shown in Fig. 12.58(a). Once again the complex SFG of a multiplication operation, as shown in Fig. 12.58(b), is considerably simpler. Note that the real SFG does not include the constant j anywhere, whereas, in the complex SFG, it is admissible.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-026.jpg?height=382&width=1049&top_left_y=1585&top_left_x=316)

Fig. 12.58 (a) The real SFG of a complex multiplication and (b) the equivalent complex SFG.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-027.jpg?height=674&width=811&top_left_y=188&top_left_x=138)

Fig. 12.5 9 Multiplying a signal by the imaginary constant j.

Fig. 12.60 The analog integration operator for complex signals.

A special case is the multiplication of an input signal by the constant j . This is shown using a complex SFG in Fig. 12.59(a) and a real SFG in Fig. 12.59(b). This operation is simply an interchanging of the real and inverted imaginary parts; this operation is the basis of realizing imaginary components in complex networks; that is, imaginary gains are realized by cross-coupling in the two real networks.

One additional operation is required for realizing complex filters: the integration operator. This simply consists of applying the corresponding real operation to each part of the complex signal, as shown in Fig. 12.60.

### 12.10.3 Complex Filters

Complex filters are important and widely used signal processing blocks in modern wireless transceivers. Complex filters use cross-coupling between the real and imaginary signal paths in order to realize asymmetrical (in the frequency domain) filters having transfer functions that do not have the conjugate symmetry of real filters. This implies that their transfer functions have complex coefficients. Complex filters can be realized using the basic operations of addition and multiplication and the integrator operator.

A complex transfer function can be realized by using four real SFG filters

Key Point: Complex filters use cross-coupling between real and imaginary signal paths to realize transfer functions that do not have the frequencydomain conjugate symmetry of real filters.
as shown in Figure 12.61 where we have

$$
\begin{equation*}
\mathrm{R}(\mathrm{~s})=\frac{\mathrm{H}(\mathrm{~s})+\mathrm{H}^{*}(\mathrm{~s})}{2} \tag{12.187}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{jQ}(\mathrm{~s})=\frac{\mathrm{H}(\mathrm{~s})-\mathrm{H}^{*}(\mathrm{~s})}{2} \tag{12.188}
\end{equation*}
$$

When the filters leading from the real and imaginary branches of Fig. 12.61 do not exactly match, imaging errors (plus less harmful magnitude response errors) occur.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-028.jpg?height=469&width=1399&top_left_y=167&top_left_x=159)

Fig. 12.61 Realizing a complex filter $H(s)=R(s)+j Q(s)$ by real SFG transfer filters $R(s)$ and $Q(s)$.

### 12.10.4 Frequency-Translated Analog Filters

Key Point: Real filters can be frequencytranslated into complex transfer functions by substituting $(s-j \omega)$ for $s$.

Complex analog transfer functions can be realized by frequency-translating real filters [Snelgrove, 1982], [Sedra, 1985]. Specifically, one method for deriving complex transfer functions is to employ a complex substitution for the Laplace variable s. For example, to effect a positive frequency shift, one uses the substitution

$$
\begin{equation*}
s \rightarrow s-j \omega_{0} \tag{12.189}
\end{equation*}
$$

The effect of this substitution on a low-pass filter is shown in Fig. 12.62
A method for realizing complex analog filters is to start with an active RC prototype filter and then transform it to a complex frequency-translated filter; the procedure to do this is simple:

- First, use an active-RC prototype filter that is fully-differential. This is used to make the realization of negative components trivial.
- Secondly, replicate exactly the prototype filter in order to realize the signal path for the imaginary signal components.
- Finally, add cross-coupled resistors for each capacitor. The size and signs of these resistors determine the frequency translation.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-028.jpg?height=238&width=793&top_left_y=1461&top_left_x=859)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-028.jpg?height=303&width=791&top_left_y=1796&top_left_x=853)
(b)
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-029.jpg?height=944&width=549&top_left_y=176&top_left_x=591)

Fig. 12.63 (a) A capacitor in the real prototype filter, (b) the transformed capacitor in the complex filter, and (c) the real-component realization of the complex capacitor.

The second step transforms the real prototype filter into a complex conjugate symmetric filter at the same frequencies as the prototype filter. To see how the third steps results in the desired frequency translation, consider Fig. 12.63.

Fig. 12.63(a) shows one of the capacitors in a complex filter at the same frequencies as the real prototype filter. Applying the frequency translation $\mathrm{s} \rightarrow \mathrm{s}-\mathrm{j} \omega_{0}$ results in transforming the capacitor to an admittance of a capacitor (of the same size) in parallel with an imaginary resistor of size $-\mathrm{j} \omega_{0} \mathrm{C}$ according

Key Point: Beginning with an active-RC prototype filter, duplicating it, and cross-coupling the two signal paths with resistors results in a complex frequency translation of the filter response.
to the substitution

$$
\begin{equation*}
s C \rightarrow s C-j \omega_{0} C \tag{12.190}
\end{equation*}
$$

This is shown in Fig. 12.63(b) where

$$
\begin{equation*}
\mathrm{G}_{\mathrm{i}}=\omega_{0} \mathrm{C}_{\mathrm{i}} \tag{12.191}
\end{equation*}
$$

In order to realize the complex filter using real components, two identical real filters are used with crosscoupling, as is shown in Fig. 12.63(c). The negative cross-coupled resistor can be realized using fully differential circuits.

#### EXAMPLE 12.11

Design a complex filter with a transmission zero at $\mathrm{S}=-\mathrm{j} \omega_{0}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-030.jpg?height=1229&width=1064&top_left_y=182&top_left_x=347)

Fig. 12.64 Using a complex frequency translation to realize a PPF: (a) the high-pass prototype, (b) the complex band-stop having a complex admittance, (c) a fully-differential version of (b), and (d) replacing the complex admittances with cross-coupled real admittances between the real and imaginary paths.

#### Solution

Begin with the passive RC high-pass filter shown in Fig. 12.64(a) which has a transmission zero at $\mathrm{s}=0$. The transmission zero at dc will be frequency-shifted to negative frequencies, so we use the substitution $\mathrm{s} \rightarrow \mathrm{s}+\mathrm{j} \omega_{0}$. Letting

$$
\begin{equation*}
\omega_{0}=\frac{\mathrm{G}_{2}}{\mathrm{C}} \tag{12.192}
\end{equation*}
$$

gives the required substitution as

$$
\begin{equation*}
\mathrm{sC} \rightarrow \mathrm{sC}+\mathrm{j} \mathrm{G}_{2} \tag{12.193}
\end{equation*}
$$

Thus, the complex frequency-shifted high-pass is now as shown in Fig. 12.64(b). A fully-differential version of the circuit of Fig. 12.64(b) is shown in Fig. 12.64(c). This complex filter can be realized by two parallel real filters
![](https://cdn.mathpix.com/cropped/2024_11_07_20b049a9b1012d1b244fg-031.jpg?height=677&width=1376&top_left_y=173&top_left_x=175)

Fig. 12.65 Frequency shifting a real integrator to a complex positive-frequency integrator.
with cross-coupled resistors, as is shown in Fig. 12.64( $d$ ). This circuit is referred to as a poly-phase network. Taking the load $\mathrm{G}_{1}=0$ would result in very narrow notches. Normally, poly-phase networks are intended to be cascaded [Gingell, 1973] and the load on each section is the succeeding section [Behbahani, 2001].

An alternative procedure for realizing continuous-time complex filters is based on frequency-translating SFG prototype filters which are based on integrators [Snelgrove, 1982]. This procedure is illustrated by applying it to the single integrator shown in Fig. 12.65(a). In Fig. 12.65(b) and (c) are shown complex SFGs that realize the fre-quency-shifted integrator. The complex SFG of Fig. 12.65(c) is converted to the equivalent real SFG of Fig. $12.65(d)$, where the necessary cross-coupling is explicit. The procedure for frequency-shifting any real SFG integrator-based filter is simply: a) replicate the real SFG filter for the imaginary path, and b) cross-couple at each integrator, as is shown in Fig. 12.65(d); the strength of the cross-couplings determine the frequency of the shift. As always, this cross-coupling is simplified by using fully-differential circuits.

## 12.11 KEY POINTS

- Continuous-time integrated analog filters process signals that are both continuous in amplitude and time. Dis-crete-time analog filters process signals sampled in time, and therefore generally operate on lower-frequency signals than their continuous-time counterparts. [p. 469]
- Integrators, summers, and gain stages are the fundamental building blocks of analog filters. [p. 469]
- Any rational transfer function with real-valued coefficients may be factored into first- and second-order terms and, therefore, implemented as a cascade of first- and second-order filters. [p. 470]
- One integrator is required for each pole in an analog filter. [p. 470]
- A popular biquad implementation is two integrators in a loop, one being lossy. The gains around the loop determine its resonant frequency, the integrator loss determines the Q-factor, and the input gains and locations determine the transfer function zeros and gain. [p. 471]
- In $\mathrm{G}_{\mathrm{m}}-\mathrm{C}$ filters, integrators are realized with a transconductor, which produces a output current proportional to the input voltage, and a capacitor, which integrates the current to produce the output voltage. [p. 472]
- Current signals are readily summed by simply shorting them together. [p. 473]
- Fully-differential circuits are often preferred in analog integrated circuits as they provide improved linearity and noise immunity. [p. 474]
- Differentiating signal paths are sometimes provided by capacitive feed-ins. [p. 475]
- Source-degenerating a differential pair with a resistor linearizes the relationship between differential input voltage and output current. The result is a transconductor with a value approximately equal to the degeneration resistance. [p. 480]
- Feedback may be used to more accurately reproduce the input voltage across the degeneration resistor or further improve the linearity of transconductors with fixed resistors. [p. 483]
- Triode transistors can be used in placed of fixed resistors to make transconductors tunable, although their linearity is generally reduced. [p. 484]
- Transconductors whose gain is based upon the small-signal transconductance of active-mode transistors generally offer increased speed, but reduced linearity, compared with transconductors based upon triode devices. [p. 493]
- Bipolar transconductors based on fixed resistors may be made tunable by cascading them with an adjustablegain cell. [p. 500]
- Active RC filters employ resistors connected to virtual ground nodes to perform voltage-to-current conversion, and then integrate the resulting currents upon Miller capacitors, connected in feedback around high-gain amplifiers. [p. 510]
- Replacing the fixed resistors of an active RC integrator with transistors in triode provides tunability, but reduces linearity. [p. 514]
- Adding fixed passive series resistors to active MOSFET-C filters can improve their linearity. [p. 516]
- Analog filter time constants, determined by $\mathrm{G}_{\mathrm{m}} / \mathrm{C}$ or RC products, vary considerably over process and temperature. Hence, tuning is required to ensure accurate and repeatable frequency responses. [p. 516]
- Complex filters are realized using three basic operations performed on ordered pairs of real signals: complex addition, multiplication, and integration. [p. 526]
- Complex filters use cross-coupling between real and imaginary signal paths to realize transfer functions that do not have the frequency-domain conjugate symmetry of real filters. [p. 527]
- Real filters can be frequency-translated into complex transfer functions by substituting ( $\mathrm{s}-\mathrm{j} \omega$ ) for s . [p. 528]
- Beginning with an active-RC prototype filter, duplicating it, and cross-coupling the two signal paths with resistors results in a complex frequency translation of the filter response. [p. 529]
