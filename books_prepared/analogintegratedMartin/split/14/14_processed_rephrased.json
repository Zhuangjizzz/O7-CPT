[

{
    "text": "Arguably the most prevalent method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits is via switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. A switched-capacitor circuit functions as a discrete-time signal processor (without employing A/D or D/A converters). Consequently, these circuits are most effectively analyzed using z-transform techniques and generally necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored for filtering due to their precise frequency response, along with excellent linearity and dynamic range. The accuracy of discrete-time frequency responses is achieved because filter coefficients are governed by capacitance ratios, which can be precisely set in an integrated circuit (to about 0.1 percent). This level of precision significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately established, its overall frequency response depends on the clock (or sampling) frequency. Fortunately, clock frequencies can be very accurately set using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can be employed to realize various other signal-processing elements, such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will cover the fundamental principles of switched-capacitor filters and also explore some non-filtering functions achievable with switched-capacitor circuits."
},
{
    "text": "Perhaps the most widely used method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits is via switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. A switched-capacitor circuit functions as a discrete-time signal processor (albeit without employing A/D or D/A converters). Consequently, these circuits are most effectively analyzed using z-transform techniques and generally necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored as a filtering technique due to their precise frequency response, along with excellent linearity and dynamic range. The accurate discrete-time frequency responses are achieved because filter coefficients are dictated by capacitance ratios, which can be precisely set in an integrated circuit (to approximately 0.1 percent). This level of accuracy significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately established, its overall frequency response depends on the clock (or sampling) frequency. Thankfully, clock frequencies can also be precisely controlled using a crystal oscillator.\n\nBeyond their use in filtering functions, switched-capacitor circuit techniques can be employed to implement various other signal-processing components, such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will present the fundamental principles of switched-capacitor filters and also cover some non-filtering functions achievable with switched-capacitor circuits."
},
{
    "text": "Perhaps the most widely-used method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits involves switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. These circuits function as discrete-time signal processors (without relying on A/D or D/A converters). Consequently, they are most effectively analyzed using z-transform techniques and often necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored for filtering due to their precise frequency response, excellent linearity, and broad dynamic range. The accuracy of their discrete-time frequency responses stems from filter coefficients being determined by capacitance ratios, which can be finely tuned in an integrated circuit (to about 0.1 percent). This level of precision significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately established, its overall frequency response depends solely on the clock (or sampling) frequency.幸运的是, clock frequencies can also be precisely controlled using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can be employed to create various other signal-processing components such as gain stages, voltage-controlled oscillators, and modulators. This chapter will cover the fundamental principles of switched-capacitor filters and explore some additional non-filtering functions achievable with these circuits."
},
{
    "text": "One of the most widely adopted methods for implementing analog signal processing in MOS (or BiCMOS) integrated circuits involves the utilization of switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. These circuits function as discrete-time signal processors (without employing A/D or D/A converters). Consequently, they are most effectively analyzed using z-transform techniques and often necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored as a filtering method because of their precise frequency response, along with excellent linearity and dynamic range. The accuracy of their discrete-time frequency responses is achieved because filter coefficients are governed by capacitance ratios, which can be very precisely established in an integrated circuit (to about 0.1 percent). This level of precision significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately determined, its overall frequency response depends on the clock (or sampling) frequency. Fortunately, clock frequencies can be precisely controlled using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can be employed to implement various other signal-processing components, such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will delve into the fundamental principles of switched-capacitor filters and also explore some non-filtering functions that can be realized using these circuits."
},
{
    "text": "Arguably the most prevalent method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits involves the deployment of switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. These circuits function as discrete-time signal processors (albeit without employing A/D or D/A converters). Consequently, they are most effectively analyzed using z-transform techniques and generally necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored for filtering purposes due to their precise frequency response, along with excellent linearity and dynamic range. The accurate discrete-time frequency responses are achieved because filter coefficients are dictated by capacitance ratios, which can be very precisely established in an integrated circuit (to around 0.1 percent). This level of precision significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately set, its overall frequency response depends solely on the clock (or sampling) frequency.幸运的是, clock frequencies can also be precisely controlled using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can be employed to realize various other signal-processing components such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will present the fundamental principles of switched-capacitor filters and explore some additional non-filtering functions achievable with switched-capacitor circuits."
},
{
    "text": "Perhaps the most favored method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits is via switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. A switched-capacitor circuit functions as a discrete-time signal processor (albeit without employing A/D or D/A converters). Consequently, these circuits are most effectively analyzed using z-transform techniques and generally necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are widely used in filtering due to their precise frequency response, along with excellent linearity and dynamic range. The accurate discrete-time frequency responses are achieved because filter coefficients are determined by capacitance ratios, which can be very precisely set in an integrated circuit (to about 0.1 percent). This level of accuracy significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately established, its overall frequency response depends on the clock (or sampling) frequency. Fortunately, clock frequencies can also be precisely controlled using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can be employed to realize various other signal-processing components such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will present the fundamental principles of switched-capacitor filters and explore some additional non-filtering functions achievable with switched-capacitor circuits."
},
{
    "text": "Perhaps the most widely used method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits involves switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. A switched-capacitor circuit functions as a discrete-time signal processor (without employing A/D or D/A converters). Consequently, these circuits are most effectively analyzed using z-transform techniques and generally necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored for filtering due to their precise frequency response, excellent linearity, and broad dynamic range. The accurate discrete-time frequency responses are achieved because filter coefficients are dictated by capacitance ratios, which can be precisely set in an integrated circuit (to about 0.1 percent). This level of accuracy significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately established, its overall frequency response depends on the clock (or sampling) frequency. Fortunately, clock frequencies can be precisely controlled using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can be employed to realize various other signal-processing components, such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will cover the fundamental principles of switched-capacitor filters and also explore some non-filtering functions achievable with switched-capacitor circuits."
},
{
    "text": "Perhaps the most widely used method for implementing analog signal processing in MOS (or BiCMOS) integrated circuits involves switched-capacitor circuits [Poschenrieder, 1966; Fried, 1972; Caves, 1977; Hosticka, 1977; Young, 1977]. A switched-capacitor circuit functions as a discrete-time signal processor (albeit without employing A/D or D/A converters). Consequently, these circuits are most effectively analyzed using z-transform techniques and generally necessitate anti-aliasing and smoothing filters when integrated with continuous-time circuits.\n\nSwitched-capacitor circuits are favored as a filtering technique due to their precise frequency response, along with excellent linearity and dynamic range. The accurate discrete-time frequency responses are achieved because filter coefficients are based on capacitance ratios, which can be precisely set in an integrated circuit (to around 0.1 percent). This level of accuracy significantly surpasses that of integrated RC time constants, which can vary by up to 20 percent. Once the coefficients of a switched-capacitor discrete-time filter are accurately established, its overall frequency response depends on the clock (or sampling) frequency. Fortunately, clock frequencies can be very precisely controlled using a crystal oscillator.\n\nBeyond filtering functions, switched-capacitor circuit techniques can also be employed to create various other signal-processing components such as gain-stages, voltage-controlled oscillators, and modulators. This chapter will delve into the fundamental principles of switched-capacitor filters and explore some additional non-filtering functions that can be realized using switched-capacitor circuits."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal operational amplifiers (opamps). Nevertheless, certain critical nonidealities of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. The input impedance of opamps is typically capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains influence the precision of the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insight into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided that minimal slew-rate behavior occurs and the phase margin exceeds 70 degrees. Contemporary switched-capacitor (SC) circuits frequently utilize high-frequency single-stage opamps with extremely high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Since these opamps are loaded purely capacitively (never resistively), their dc gains remain elevated even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are dictated by the load capacitance, which also functions as the compensation capacitor. Consequently, in these single-stage opamps, doubling the load capacitance would reduce the unity-gain frequency by half and enhance the phase margin.\n\nThe finite slew rate of an opamp can constrain the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Therefore, during charge transfer, it is not unusual for opamps to experience slew-rate limiting.\n\nA non-zero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Fortunately, a method called correlated double sampling can substantially mitigate this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal opamps. Nevertheless, several critical nonidealities of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. The input impedance of opamps is predominantly capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains can compromise the precision of the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insights into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided that minimal slew-rate behavior is present and the phase margin exceeds 70 degrees. Contemporary SC circuits frequently utilize high-frequency single-stage opamps with exceptionally high output impedances (often $100 \\mathrm{k} \\Omega$ or more). Given that these opamps' loads are exclusively capacitive (never resistive), their dc gains remain substantial even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also functions as the compensation capacitor. Therefore, in these single-stage opamps, doubling the load capacitance will halve the unity-gain frequency and enhance the phase margin.\n\nThe finite slew rate of an opamp can restrict the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Consequently, during charge transfer, opamps often encounter slew-rate limitations.\n\nA non-zero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Fortunately, a method called correlated double sampling can substantially mitigate this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "Understanding the fundamental principles of switched-capacitor circuits is straightforward when assuming ideal opamps. Nevertheless, several critical nonidealities of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. Typically, the input impedance of opamps is capacitive, especially when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains can compromise the accuracy of the discrete-time transfer function in a switched-capacitor filter.\n\nKey Point: Nonidealities such as dc gain, unity-gain frequency, phase margin, slew rate, and dc offset significantly affect the performance of switched-capacitor circuits.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insight into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided the slew rate is minimal and the phase margin exceeds 70 degrees. Modern switched-capacitor circuits often use high-frequency single-stage opamps with extremely high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Since these opamps are loaded purely capacitively (never resistively), their dc gains remain high even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also acts as the compensation capacitor. Consequently, in these single-stage opamps, doubling the load capacitance halves the unity-gain frequency and enhances the phase margin.\n\nThe finite slew rate of an opamp can restrict the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Therefore, during charge transfer, opamps frequently encounter slew-rate limitations.\n\nA nonzero dc offset can lead to a substantial output dc offset in the circuit, depending on the selected topology. Fortunately, a method known as correlated double sampling can effectively minimize this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal operational amplifiers (opamps). Nevertheless, several critical nonideal characteristics of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. The input impedance of opamps is predominantly capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains influence the precision of the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insight into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided that minimal slew-rate behavior is observed and the phase margin exceeds 70 degrees. Contemporary switched-capacitor (SC) circuits frequently utilize high-frequency single-stage opamps with exceptionally high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Since these opamps are loaded purely by capacitive elements (never resistive), their dc gains remain elevated even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also acts as the compensation capacitor. Consequently, in these single-stage opamps, doubling the load capacitance would reduce the unity-gain frequency by half and enhance the phase margin.\n\nThe limited slew rate of an opamp can restrict the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Therefore, during charge transfer, opamps often encounter slew-rate limitations.\n\nA non-zero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Thankfully, a method known as correlated double sampling can substantially decrease this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal operational amplifiers (opamps). Nevertheless, several critical nonideal characteristics of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. The input impedance of opamps is predominantly capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains influence the precision of the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insights into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided that minimal slew-rate behavior is present and the phase margin exceeds 70 degrees. Contemporary switched-capacitor (SC) circuits frequently utilize high-frequency single-stage opamps with exceptionally high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Given that these opamps' loads are exclusively capacitive (never resistive), their dc gains remain elevated even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also functions as the compensation capacitor. Consequently, in these single-stage opamps, doubling the load capacitance would reduce the unity-gain frequency by half and enhance the phase margin.\n\nThe limited slew rate of an opamp can constrain the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Therefore, during charge transfer, it is not unusual for opamps to experience slew-rate limiting.\n\nA non-zero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Fortunately, a method called correlated double sampling can substantially decrease this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal opamps. Nevertheless, several critical nonidealities of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. The input impedance of opamps is predominantly capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains influence the precision\n\nKey Point: Opamp nonidealities such as dc gain, unity-gain frequency, phase margin, slew rate, and dc offset affect the performance of switched-capacitor circuits.\nof the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insight into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided that minimal slew-rate behavior occurs and the phase margin exceeds 70 degrees. Contemporary SC circuits frequently utilize high-frequency single-stage opamps with extremely high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Since these opamps are loaded purely capacitively (never resistively), their dc gains remain elevated even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also acts as the compensation capacitor. Therefore, in these single-stage opamps, doubling the load capacitance would reduce the unity-gain frequency by half and enhance the phase margin.\n\nThe finite slew rate of an opamp can restrict the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Consequently, during charge transfer, opamps often experience slew-rate limiting.\n\nA non-zero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Thankfully, a method called correlated double sampling can substantially decrease this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal opamps. Nevertheless, several critical nonidealities of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency and phase margin, slew rate, and dc offset. The input impedance of opamps is typically capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains influence the precision\n\nKey Point: Nonidealities in opamps, such as dc gain, unity-gain frequency and phase margin, slew rate, and dc offset, affect the performance of switched-capacitor circuits.\nof the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insight into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided that minimal slew-rate behavior occurs and the phase margin exceeds 70 degrees. Contemporary SC circuits frequently utilize high-frequency single-stage opamps with exceptionally high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Since these opamps are loaded purely capacitively (never resistively), their dc gains remain elevated even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also acts as the compensation capacitor. Therefore, in these single-stage opamps, doubling the load capacitance would reduce the unity-gain frequency by half and enhance the phase margin.\n\nThe finite slew rate of an opamp can restrict the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Consequently, it is typical for opamps to experience slew-rate limiting during charge transfer.\n\nA nonzero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Fortunately, a method called correlated double sampling can substantially decrease this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "The fundamental concepts of switched-capacitor circuits can be effectively grasped by assuming ideal opamps. Nonetheless, several critical nonidealities of opamps in practical switched-capacitor circuits include dc gain, unity-gain frequency, phase margin, slew rate, and dc offset. The input impedance of opamps is predominantly capacitive when MOSFET input stages are employed. ${ }^{1}$\n\nIn MOS technology designed for switched-capacitor circuits, the dc gain of opamps usually ranges from 40 to 80 dB. Low dc gains influence the precision\n\nKey Point: Nonidealities in opamps, such as dc gain, unity-gain frequency, phase margin, slew rate, and dc offset, affect the performance of switched-capacitor circuits.\nof the discrete-time transfer function in a switched-capacitor filter.\n\n[^1]The unity-gain frequency and phase margin of an opamp provide insight into its small-signal settling behavior. A common guideline is that the clock frequency of a switched-capacitor circuit should be at least five times lower than the opamp's unity-gain frequency, provided there is minimal slew-rate behavior and the phase margin exceeds 70 degrees. Contemporary SC circuits frequently utilize high-frequency single-stage opamps with extremely high output impedances (up to $100 \\mathrm{k} \\Omega$ or more). Since these opamps' loads are exclusively capacitive (never resistive), their dc gains remain elevated even without an output buffer stage. It is important to note that their unity-gain frequency and phase margin are influenced by the load capacitance, which also functions as the compensation capacitor. Therefore, in these single-stage opamps, doubling the load capacitance would reduce the unity-gain frequency by half and enhance the phase margin.\n\nThe finite slew rate of an opamp can restrict the maximum clock rate in a switched-capacitor circuit, as these circuits depend on rapid charge transfer between capacitors. Consequently, it is typical for opamps to experience slew-rate limiting during charge transfer.\n\nA non-zero dc offset can lead to a significant output dc offset in the circuit, depending on the selected topology. Fortunately, a method known as correlated double sampling can substantially mitigate this output offset and concurrently reduce low-frequency opamp input noise (i.e., $1 / \\mathrm{f}$ noise)."
},
{
    "text": "A highly linear capacitance in an integrated circuit is usually composed of two closely positioned conducting layers, as depicted in Fig. 14.1(a). ${ }^{2}$ The required capacitance, C, results from the overlapping area between these two conductive layers, specifically layer 1 and layer 2. However, because the substrate beneath layer 1 serves as an AC ground (being connected to either a power supply or analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{p}1}$, is also present, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This substantial parasitic capacitance, $\\mathrm{C}_{\\mathrm{p}1}$, is referred to as the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p}2}$, arises mainly due to interconnect capacitance, though it is generally much smaller (usually less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), with the bottom plate often highlighted to emphasize the larger parasitic capacitance present at that node."
},
{
    "text": "A highly linear capacitance in an integrated circuit is usually formed from two closely-positioned conducting layers, as depicted in Fig. 14.1(a). ${ }^{2}$ The target capacitance, C, results from the overlapping area between these two conductive layers, namely layer 1 and layer 2. However, because the substrate beneath layer 1 acts as an ac ground (being connected to either a power supply or analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, arises, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This considerable parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is referred to as the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, is present, mainly due to interconnect capacitance, though it is generally much smaller (usually less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), with the bottom plate often explicitly shown to highlight the larger parasitic capacitance at that node."
},
{
    "text": "A highly linear capacitance within an integrated circuit is usually fabricated from two closely positioned conducting layers, as depicted in Fig. 14.1(a). The required capacitance, C, results from the overlap area between these two conductive layers, designated as layer 1 and layer 2. However, because the substrate beneath layer 1 serves as an AC ground (being connected to either a power supply or analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, is also present, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This substantial parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is referred to as the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, arises mainly due to interconnect capacitance, though it is generally much smaller (usually less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), where the bottom plate is often distinctly shown to highlight the presence of a larger parasitic capacitance at that node."
},
{
    "text": "A highly linear capacitance within an integrated circuit is usually formed by two closely-positioned conducting layers, as depicted in Fig. 14.1(a). The target capacitance, C, arises from the overlapping area between these two conductive layers, identified as layer 1 and layer 2. Nevertheless, because the substrate beneath layer 1 functions as an AC ground (being connected to either a power supply or an analog ground), a considerable parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, is also present, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is termed the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, arises mainly due to interconnect capacitance, though it is generally much smaller (usually less than 5 percent of C). In essence, the equivalent model for a solitary integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), where the bottom plate is often highlighted to signify the presence of a larger parasitic capacitance at that node."
},
{
    "text": "A highly linear capacitance within an integrated circuit is usually composed of two closely positioned conducting layers, as depicted in Fig. 14.1(a). ${ }^{2}$ The intended capacitance, C, arises from the overlapping area between these two conductive layers, namely layer 1 and layer 2. Nevertheless, because the substrate beneath layer 1 serves as an ac ground (being connected to either a power supply or analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, is also present, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This substantial parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is referred to as the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, arises mainly due to interconnect capacitance, though it is generally much smaller (usually less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), where the bottom plate is often explicitly depicted to highlight the presence of a larger parasitic capacitance at that node."
},
{
    "text": "A highly linear capacitance within an integrated circuit is usually formed from two closely positioned conducting layers, as depicted in Fig. 14.1(a). ${ }^{2}$ The target capacitance, C, arises from the overlapping area between these two conductive layers, specifically layer 1 and layer 2. However, because the substrate beneath layer 1 acts as an ac ground (being connected to either a power supply or analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, is also present, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This substantial parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is termed the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, exists mainly due to interconnect capacitance, but it is generally much smaller (usually less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), where the bottom plate is often highlighted to signify the presence of a larger parasitic capacitance at that node."
},
{
    "text": "A highly linear capacitance in an integrated circuit is usually formed from two closely-positioned conducting layers, as depicted in Fig. 14.1(a). ${ }^{2}$ The intended capacitance, C, results from the overlapping area between these two conductive layers, namely layer 1 and layer 2. Nevertheless, because the substrate beneath layer 1 serves as an ac ground (being connected to either a power supply or analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, is also present, potentially reaching up to 20 percent of $\\mathrm{C}_{1}$. This substantial parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is referred to as the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, arises mainly due to interconnect capacitance, though it is usually much smaller (commonly less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor comprises three capacitors, as illustrated in Fig. 14.1(b), where the bottom plate is often highlighted to signify the presence of a larger parasitic capacitance at that node."
},
{
    "text": "A highly linear capacitance in an integrated circuit is usually composed of two closely-positioned conducting layers, as depicted in Fig. 14.1(a). ${ }^{2}$ The target capacitance, C, arises from the overlap area between these two conductive layers, namely layer 1 and layer 2. However, because the substrate beneath layer 1 serves as an ac ground (being connected to either a power supply or an analog ground), a significant parasitic capacitance, $\\mathrm{C}_{\\mathrm{pl}}$, is also present, which can reach up to 20 percent of $\\mathrm{C}_{1}$. This substantial parasitic capacitance, $\\mathrm{C}_{\\mathrm{p} 1}$, is referred to as the bottom plate capacitance. Additionally, a top plate capacitance, $\\mathrm{C}_{\\mathrm{p} 2}$, exists mainly due to interconnect capacitance, though it is usually much smaller (typically less than 5 percent of C). In essence, the equivalent model for a single integrated capacitor consists of three capacitors, as illustrated in Fig. 14.1(b), where the bottom plate is often highlighted to signify the presence of a larger parasitic capacitance at that node."
},
{
    "text": "The specifications for switches in switched-capacitor circuits include having an extremely high off resistance to minimize charge leakage, a relatively low on resistance to enable the circuit to stabilize within less than half the clock period, and no offset voltage when activated, unlike bipolar switches which have an on voltage equal to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$. MOSFET transistors as switches meet these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, no offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, depending on the transistor size.\n\nFig. 14.2 illustrates the symbol for a switch and various MOSFET circuits that implement a switch. The signal $\\phi$ alternates between two logic levels, typically corresponding to the maximum and minimum power supply voltages. By convention, when the clock signal $\\phi$ is high, the switch is considered on (i.e., closed). While a switch can be realized using a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this reduces the switch's signal range. For instance, in an ideal n-channel transistor switch shown in Fig. 14.2(b) used in a circuit with power supplies ranging from 0 to 1.8 V and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, the switch can be turned off by applying 0 V to its gate regardless of the input voltage. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equalize voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is limited to 0 to 1.3 V. A similar limitation applies to the p-channel switch in Fig. 14.2(c), with a signal range from 0.5 to 1.8 V. For full signal range from 0 to 1.8 V, two transistors in parallel, as shown in Fig. 14.2(d), are used, commonly referred to as a CMOS switch or CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on each side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated using parasitic insensitive structures, as detailed in Section 14.2, while channel charge injection is minimized through precise switch timing, as explained in Section 14.6."
},
{
    "text": "The specifications for switches in switched-capacitor circuits mandate that they possess an exceptionally high off resistance (to minimize charge leakage), a moderately low on resistance (to enable the circuit to stabilize within half a clock cycle), and introduce no offset voltage when activated (unlike bipolar switches with an on voltage equal to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$). MOSFET transistors as switches fulfill these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, zero offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, contingent on transistor dimensions.\n\nFig. 14.2 illustrates the symbol for a switch and various MOSFET circuits that implement a switch. The signal $\\phi$ alternates between two logic levels, typically corresponding to the highest and lowest power supply voltages. By convention, a high clock signal $\\phi$ signifies that the switch is on (i.e., closed). While a switch can be realized using a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this limits the switch's signal range. For instance, in an ideal n-channel transistor switch shown in Fig. 14.2(b) within a circuit powered from 0 to 1.8 V with a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, the switch can be turned off by applying 0 V to its gate. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equilibrate voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is constrained to 0 to 1.3 V. A similar rationale applies to the p-channel switch in Fig. 14.2(c), but with a signal range from 0.5 to 1.8 V. To utilize the full signal range of 0 to 1.8 V, two transistors in parallel, as shown in Fig. 14.2(d), are employed, forming either a CMOS switch or a CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on either side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated using parasitic-insensitive structures, as detailed in Section 14.2, while channel charge injection is diminished through meticulous switch timing, as covered in Section 14.6."
},
{
    "text": "The criteria for switches in switched-capacitor circuits include possessing an exceptionally high off resistance (to minimize charge leakage), a relatively low on resistance (enabling the circuit to stabilize in less than half the clock period), and introducing no offset voltage when activated (unlike bipolar switches with an on voltage equivalent to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$). MOSFET transistors meet these criteria effectively, offering off resistances up to the $\\mathrm{G} \\Omega$ range, zero offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, depending on the transistor size.\n\nFig. 14.2 illustrates the symbol for a switch and various MOSFET circuits that can realize a switch. In this context, the signal $\\phi$ represents one of two logic levels, typically corresponding to the highest and lowest power supply voltages. By convention, when the clock signal $\\phi$ is high, the switch is considered on (i.e., closed). While a switch can be implemented using a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this limits the switch's signal range. For instance, in an ideal n-channel transistor switch shown in Fig. 14.2(b), with power supplies ranging from 0 to 1.8 V and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, the switch can be turned off regardless of the input voltage by applying 0 V to its gate. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equalize voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is constrained to 0 to 1.3 V. A similar rationale applies to the p-channel switch in Fig. 14.2(c), with a signal range limited to 0.5 to 1.8 V. Although this range is adequate in some scenarios, the full signal range of 0 to 1.8 V can be achieved using two transistors in parallel, as shown in Fig. 14.2(d). This configuration is commonly referred to as either a CMOS switch (distinct from the NMOS switch in Fig. 14.2(a)) or a CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include the nonlinear junction capacitance on either side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated through parasitic-insensitive structures, as outlined in Section 14.2, while channel charge injection is minimized by precise switch timing, as discussed in Section 14.6."
},
{
    "text": "The specifications for switches in switched-capacitor circuits include a very high off resistance to minimize charge leakage, a relatively low on resistance to enable the circuit to settle in less than half the clock period, and no offset voltage when activated, unlike bipolar switches which have an on voltage equal to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$. MOSFET transistors meet these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, zero offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, depending on the transistor size.\n\nFig. 14.2 illustrates the switch symbol and various MOSFET circuits that function as switches. The signal $\\phi$ toggles between two logic levels, typically corresponding to the maximum and minimum power supply voltages. By convention, a high clock signal $\\phi$ indicates the switch is on (i.e., closed). While a switch can be realized with a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this limits the signal range. For instance, an ideal n-channel transistor switch in Fig. 14.2(b), used in a circuit with power supplies ranging from 0 to 1.8 V and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, can be turned off by applying 0 V to its gate. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equalize voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is restricted to 0 to 1.3 V. A similar limitation applies to the p-channel switch in Fig. 14.2(c), with a signal range of 0.5 to 1.8 V. To utilize the full signal range of 0 to 1.8 V, two transistors in parallel, as shown in Fig. 14.2(d), are used, forming a CMOS switch or CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on either side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated using parasitic insensitive structures, as detailed in Section 14.2, while channel charge injection is minimized through precise switch timing, as discussed in Section 14.6."
},
{
    "text": "The specifications for switches in switched-capacitor circuits mandate that they possess an exceptionally high off resistance (to minimize charge leakage), a moderately low on resistance (to enable the circuit to stabilize within half a clock cycle), and introduce no offset voltage when activated (unlike bipolar switches where the on voltage equals $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$). MOSFET transistors as switches meet these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, zero offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, contingent on transistor dimensions.\n\nFig. 14.2 illustrates the switch symbol and various MOSFET circuits that implement a switch. The signal $\\phi$ toggles between two logic levels, typically corresponding to the highest and lowest power supply voltages. By convention, when the clock signal $\\phi$ is high, the switch is deemed on (i.e., closed). While a switch can be realized using a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this limits the switch's signal range. For instance, an ideal n-channel transistor switch in Fig. 14.2(b), used in a circuit with power supplies ranging from 0 to 1.8 V and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, can always be turned off by applying 0 V to its gate. However, when on with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equalize voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, its signal range is restricted to 0 to 1.3 V. A similar rationale applies to the p-channel switch in Fig. 14.2(c), but its range would be 0.5 to 1.8 V. Although acceptable in some scenarios, the full 0 to 1.8 V range can be achieved using two transistors in parallel, as shown in Fig. 14.2(d), often referred to as a CMOS switch or CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on either side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each switch side. Nonlinear capacitance effects are mitigated using parasitic-insensitive structures, as outlined in Section 14.2, while channel charge injection is minimized through precise switch timing, as discussed in Section 14.6."
},
{
    "text": "The specifications for switches employed in switched-capacitor circuits include a very high off resistance (to minimize charge leakage), a relatively low on resistance (to enable the circuit to settle in less than half the clock period), and the absence of offset voltage when activated (unlike bipolar switches with an on voltage equal to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$). MOSFET transistors as switches meet these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, no offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, depending on transistor sizing.\n\nFig. 14.2 illustrates the symbol for a switch and various MOSFET circuits that implement a switch. The signal $\\phi$ alternates between two logic levels, typically corresponding to the maximum and minimum power supply voltages. By convention, when the clock signal $\\phi$ is high, the switch is considered on (i.e., closed). While a switch can be realized using a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this limits the switch's signal range. For instance, in an ideal n-channel transistor switch shown in Fig. 14.2(b) with power supplies ranging from 0 to 1.8 V and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, the switch can be turned off by applying 0 V to its gate. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equalize voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is restricted to 0 to 1.3 V. A similar limitation applies to the p-channel switch in Fig. 14.2(c), with a signal range from 0.5 to 1.8 V. To achieve the full signal range of 0 to 1.8 V, two transistors can be used in parallel, as shown in Fig. 14.2(d), forming a CMOS switch or CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on each side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated using parasitic insensitive structures, as detailed in Section 14.2, while channel charge injection is minimized through precise switch timing, as discussed in Section 14.6."
},
{
    "text": "The specifications for switches in switched-capacitor circuits dictate that they must possess an exceptionally high off resistance to minimize charge leakage, a relatively low on resistance to enable the circuit to stabilize within less than half the clock cycle, and introduce no offset voltage when activated, akin to a bipolar switch with an on voltage equivalent to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$. MOSFET transistors, when used as switches, fulfill these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, zero offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, contingent on the transistor's size.\n\nFigure 14.2 illustrates the symbol for a switch and various MOSFET circuits that implement a switch. The signal $\\phi$ alternates between two logic levels, typically corresponding to the highest and lowest power supply voltages. By convention, a high clock signal $\\phi$ signifies that the switch is on (i.e., closed). While a switch can be realized using a single transistor, as depicted in Figures 14.2(b) and 14.2(c), this limits the switch's signal range. For instance, an ideal n-channel transistor switch in Figure 14.2(b), operating within a 0 to 1.8 V power supply and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, can be turned off by applying 0 V to its gate. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equilibrate voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is confined to 0 to 1.3 V. A similar rationale applies to the p-channel switch in Figure 14.2(c), but its range would be 0.5 to 1.8 V. Although acceptable in certain scenarios, the full 0 to 1.8 V range can be achieved using two transistors in parallel, as shown in Figure 14.2(d), commonly referred to as a CMOS switch or CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on either side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated through parasitic-insensitive structures, as detailed in Section 14.2, while channel charge injection is minimized by precise switch timing, as discussed in Section 14.6."
},
{
    "text": "The criteria for switches in switched-capacitor circuits include having an extremely high off resistance to minimize charge leakage, a relatively low on resistance to enable the circuit to stabilize in less than half the clock period, and no offset voltage when activated, unlike bipolar switches which have an on voltage equal to $\\mathrm{V}_{\\mathrm{CE}(\\mathrm{sat})}$. MOSFET transistors as switches meet these criteria, offering off resistances up to the $\\mathrm{G} \\Omega$ range, zero offset on voltages, and on resistances of $5 \\mathrm{k} \\Omega$ or lower, depending on transistor sizing.\n\nFig. 14.2 illustrates the symbol for a switch and various MOSFET circuits that implement a switch. The signal $\\phi$ represents one of two logic levels, typically corresponding to the highest and lowest power supply levels. By convention, when the clock signal $\\phi$ is high, the switch is considered on (i.e., closed). While a switch can be realized using a single transistor, as depicted in Fig. 14.2(b) and Fig. 14.2(c), this reduces the switch's signal range. For instance, in an ideal n-channel transistor switch shown in Fig. 14.2(b) used in a circuit with power supplies ranging from 0 to 1.8 V and a threshold voltage $\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, the switch can be turned off by applying 0 V to its gate regardless of the input voltage. However, when on, with a gate voltage of $\\mathrm{V}_{\\mathrm{DD}}=1.8 \\mathrm{~V}$, the switch can only equalize voltages if $\\mathrm{V}_{1}$ and/or $\\mathrm{V}_{2}$ are below $\\mathrm{V}_{\\mathrm{DD}}-\\mathrm{V}_{\\mathrm{tn}}$, approximately 1.3 V, considering the body effect. Thus, the signal range is limited to 0 to 1.3 V. A similar rationale applies to the p-channel switch in Fig. 14.2(c), but its signal range would be restricted to 0.5 to 1.8 V. While this range is adequate in some cases, the full signal range of 0 to 1.8 V can be achieved using two transistors in parallel, as shown in Fig. 14.2(d). This configuration is commonly referred to as either a CMOS switch (distinct from the NMOS switch in Fig. 14.2(a)) or a CMOS transmission gate.\n\nKey nonideal effects in switched-capacitor circuits include nonlinear junction capacitance on either side of the switch, channel charge injection, and capacitive coupling from the logic signal $\\phi$ to each side of the switch. Nonlinear capacitance effects are mitigated using parasitic insensitive structures, as detailed in Section 14.2, while channel charge injection is minimized through precise switch timing, as discussed in Section 14.6."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits. These clocks dictate the timing of charge transfers and must be nonoverlapping to prevent unintended charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized relative to the clock period, T, illustrating the sample numbers of discrete-time signals in switched-capacitor filters. By convention, we assign\nimage_name:(a)\ndescription:Fig. 14.3(a) presents the concept of nonoverlapping clock signals, showing two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits for timing control. The graph is a time-domain waveform plot.\n\n1. **Graph Type and Function:**\n- The graph is a time-domain waveform plot showing two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axes Labels and Units:**\n- The horizontal axis is labeled \\( t/T \\), representing normalized time relative to the clock period \\( T \\). This axis is dimensionless but indicates time intervals compared to the clock period.\n- The vertical axis indicates voltage levels \\( V_{on} \\) and \\( V_{off} \\), marking the high and low states of the digital signals.\n\n3. **General Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate between \\( V_{on} \\) and \\( V_{off} \\) as square waves.\n- \\( \\phi_1 \\) and \\( \\phi_2 \\) are configured so they never both are high at the same time, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Features and Technical Details:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period, specifically at \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between the high phases of \\( \\phi_1 \\) and \\( \\phi_2 \\), preventing simultaneous high states.\n\n5. **Annotations and Specific Data Points:**\n- The clock signals' frequency is noted as \\( f_s = 1/T \\), representing the sampling frequency.\n- The diagram visually confirms the nonoverlapping nature of the clock signals, crucial for applications like switched-capacitor filters to avoid charge sharing between phases.\n\nThe graph effectively shows the timing and sequence of the nonoverlapping clock signals, highlighting their synchronized but non-simultaneous high states.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) A potential circuit implementation of nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (i.e., $(n-1),(n),(n+1)$, etc.) just before the end of clock phase $\\phi_{1}$, while the end of clock phase $\\phi_{2}$ is considered $1 / 2$ sample off the integer values as indicated (i.e., $(n-3 / 2),(n-1 / 2)$, etc.). However, it is not essential for the falling edge of $\\phi_{2}$ to occur exactly one-half a clock period before the falling edge of $\\phi_{1}$. Generally, the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to allow complete charge settling (assuming separate low-jitter sample and holds are used at the input and output of the overall circuit).\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. Here, delay blocks are employed to maintain nonoverlapping clocks. These delays can be implemented using a cascade of an even number of inverters or an RC network."
},
{
    "text": "At least one set of nonoverlapping clocks is crucial in switched-capacitor circuits. These clocks dictate the timing of charge transfers and must be nonoverlapping to prevent accidental charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, highlighting the sample numbers of discrete-time signals in switched-capacitor filters. By convention, we represent the sampling numbers as integer values (e.g., (n-1), n, (n+1)) just before the end of clock phase \\( \\phi_1 \\), while the end of clock phase \\( \\phi_2 \\) is offset by half a sample (e.g., (n-3/2), (n-1/2)). It's important to note that the precise timing of \\( \\phi_2 \\)'s falling edge relative to \\( \\phi_1 \\) is not critical. Generally, the clock edges of \\( \\phi_1 \\) and \\( \\phi_2 \\) need only be moderately controlled to ensure complete charge settling, assuming separate low-jitter sample and hold circuits are used at the input and output.\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. This method employs delay blocks to maintain nonoverlapping clocks, which can be implemented using a series of an even number of inverters or an RC network.\n\n**Image Description (a):**\nThe graph labeled (a) in Fig. 14.3 demonstrates the concept of nonoverlapping clock signals, showing two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits to control operation timing. It is a time-domain waveform plot.\n\n1. **Graph Type and Function:**\n- The graph displays two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time in a time-domain waveform plot.\n\n2. **Axes Labels and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), denoting the high and low states of the digital signals.\n\n3. **Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) are square waves alternating between \\( V_{on} \\) and \\( V_{off} \\).\n- They are arranged to never be high simultaneously, ensuring nonoverlapping behavior.\n- The signals are periodic, repeating every clock period \\( T \\).\n\n4. **Key Features and Technical Details:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period, specifically at \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between the high phases of \\( \\phi_1 \\) and \\( \\phi_2 \\), preventing simultaneous high states.\n\n5. **Annotations and Specific Data Points:**\n- The clock signals' frequency is \\( f_s = 1/T \\), indicating the sampling frequency.\n- The diagram visually confirms the nonoverlapping nature of the clock signals, crucial for preventing charge sharing in applications like switched-capacitor filters.\n\nThe graph effectively shows the timing and sequence of the nonoverlapping clock signals, highlighting their synchronized yet non-simultaneous high states.\n\n**Image Description (b):**\nThe circuit generates nonoverlapping clock signals \\( \\phi_1 \\) and \\( \\phi_2 \\) from a single clock input \\( \\phi \\). Delays are introduced to ensure \\( \\phi_1 \\) and \\( \\phi_2 \\) do not overlap.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\). (b) A possible circuit implementation of nonoverlapping clocks from a single clock."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits, as they dictate the timing of charge transfers and must be nonoverlapping to prevent accidental charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, illustrating the sample numbers of discrete-time signals in switched-capacitor filters. By convention, we represent\nimage_name:(a)\ndescription:Fig. 14.3(a) graphically represents nonoverlapping clock signals, showing two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits for timing control. The graph is a time-domain waveform plot.\n\n1. **Graph Type and Function:**\n- This time-domain waveform plot displays two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axes Labels and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), marking the high and low states of the digital signals.\n\n3. **Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate between \\( V_{on} \\) and \\( V_{off} \\) as square waves.\n- They are arranged to never be high concurrently, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Features and Technical Details:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period, specifically at \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between the high phases of \\( \\phi_1 \\) and \\( \\phi_2 \\), preventing simultaneous high states.\n\n5. **Annotations and Specific Data Points:**\n- The clock signals' frequency is \\( f_s = 1/T \\), representing the sampling frequency.\n- The diagram visually confirms the nonoverlapping nature of the clock signals, crucial for preventing charge sharing in applications like switched-capacitor filters.\n\nThe graph effectively demonstrates the timing and sequence of nonoverlapping clock signals, highlighting their synchronized yet non-concurrent high states.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) A potential circuit implementation for nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (i.e., $(n-1),(n),(n+1)$, etc.) just before the end of clock phase $\\phi_{1}$, whereas the end of clock phase $\\phi_{2}$ is considered to be $1 / 2$ sample off the integer values (i.e., $(n-3 / 2),(n-1 / 2)$, etc.). However, it is not essential for the falling edge of $\\phi_{2}$ to occur precisely one-half a clock period before the falling edge of $\\phi_{1}$. Generally, the positions of the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to ensure complete charge settling (assuming separate low-jitter sample and holds are employed at the input and output of the overall circuit).\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. In this setup, delay blocks are utilized to maintain nonoverlapping clocks. These delays can be implemented using a cascade of an even number of inverters or an RC network."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits. These clocks dictate the timing of charge transfers and must be nonoverlapping to prevent accidental charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, illustrating the sample numbers of discrete-time signals in switched-capacitor filters. By convention, we denote\nimage_name:(a)\ndescription:Fig. 14.3(a) shows the concept of nonoverlapping clock signals, featuring two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits for timing control. The graph is a time-domain waveform plot.\n\n1. **Graph Type and Function:**\n- The graph is a time-domain waveform plot of two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axes Labels and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), representing the high and low states of the digital signals.\n\n3. **General Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate as square waves between \\( V_{on} \\) and \\( V_{off} \\).\n- They are timed so that neither is high at the same time, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Features and Technical Details:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period, specifically at \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between the high phases of \\( \\phi_1 \\) and \\( \\phi_2 \\), preventing simultaneous high states.\n\n5. **Annotations and Specific Data Points:**\n- The clock signals' frequency is \\( f_s = 1/T \\), representing the sampling frequency.\n- The diagram visually confirms the nonoverlapping nature of the clock signals, crucial for preventing charge sharing in applications like switched-capacitor filters.\n\nThe graph effectively demonstrates the timing and sequence of the nonoverlapping clock signals, highlighting their synchronized but non-simultaneous high states.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) A potential circuit implementation of nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (i.e., $(n-1),(n),(n+1)$, etc.) just before the end of clock phase $\\phi_{1}$, while the end of clock phase $\\phi_{2}$ is marked $1 / 2$ sample off the integer values (i.e., $(n-3 / 2),(n-1 / 2)$, etc.). However, it is not essential for the falling edge of $\\phi_{2}$ to occur exactly one-half a clock period before the falling edge of $\\phi_{1}$. Generally, the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to allow complete charge settling (assuming separate low-jitter sample and holds are used at the circuit's input and output).\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. This method employs delay blocks to maintain nonoverlapping clocks. These delays can be implemented using a cascade of an even number of inverters or an RC network."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits, as they dictate the timing of charge transfers and must be nonoverlapping to prevent unintended charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, illustrating the positions of the discrete-time signal sample numbers in switched-capacitor filters. By convention, we assign\nimage_name:(a)\ndescription:Fig. 14.3(a) presents the concept of nonoverlapping clock signals, showing two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits to manage operation timing. This is a time-domain waveform plot.\n\n1. **Graph Type and Purpose:**\n- The graph is a time-domain waveform plot, displaying two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axes and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), marking the high and low states of the digital signals.\n\n3. **Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate between \\( V_{on} \\) and \\( V_{off} \\) as square waves.\n- They are timed so that neither is high at the same moment, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Characteristics and Technical Aspects:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period, specifically at \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between their high phases, preventing simultaneous high states.\n\n5. **Annotations and Data Points:**\n- The clock signals' frequency is noted as \\( f_s = 1/T \\), representing the sampling frequency.\n- The diagram clearly shows the nonoverlapping nature of the clock signals, essential in applications like switched-capacitor filters to avoid charge sharing between phases.\n\nThe graph effectively demonstrates the timing and sequence of the nonoverlapping clock signals, highlighting their synchronized but non-simultaneous high states.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) Example circuit for generating nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (e.g., $(n-1),(n),(n+1)$) just before the end of clock phase $\\phi_{1}$, while the end of clock phase $\\phi_{2}$ is offset by $1 / 2$ sample from the integer values (e.g., $(n-3 / 2),(n-1 / 2)$). However, it is not critical for the falling edge of $\\phi_{2}$ to occur exactly one-half a clock period before the falling edge of $\\phi_{1}$. Generally, the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to ensure complete charge settling (assuming separate low-jitter sample and holds are used at the circuit's input and output).\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. This method employs delay blocks to maintain nonoverlapping clocks. These delays can be implemented using a series of an even number of inverters or an RC network."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits. These clocks dictate the timing of charge transfers and must be nonoverlapping to prevent accidental charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, illustrating the positions of the discrete-time signal sample numbers in switched-capacitor filters. By convention, we denote\nimage_name:(a)\ndescription:Fig. 14.3(a) depicts the concept of nonoverlapping clock signals, showing two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits to control operation timing. The graph is a time-domain waveform plot.\n\n1. **Graph Type and Function:**\n- The graph is a time-domain waveform plot of two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axes Labels and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), marking the high and low states of the digital signals.\n\n3. **Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate between \\( V_{on} \\) and \\( V_{off} \\) as square waves.\n- They are timed so that neither is high at the same moment, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Features and Technical Details:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period: \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, transitioning at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between their high phases, preventing simultaneous high states.\n\n5. **Annotations and Specific Data Points:**\n- The clock signals' frequency is \\( f_s = 1/T \\), indicating the sampling frequency.\n- The diagram visually confirms the nonoverlapping nature of the clock signals, crucial for preventing charge sharing in applications like switched-capacitor filters.\n\nThe graph effectively showcases the timing and sequence of nonoverlapping clock signals, highlighting their synchronized but non-simultaneous high states.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) A possible circuit implementation of nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (i.e., $(n-1),(n),(n+1)$, etc.) just before the end of clock phase $\\phi_{1}$, while the end of clock phase $\\phi_{2}$ is offset by $1 / 2$ sample from the integer values (i.e., $(n-3 / 2),(n-1 / 2)$, etc.). However, it is not essential for the falling edge of $\\phi_{2}$ to occur exactly one-half a clock period before the falling edge of $\\phi_{1}$. Generally, the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to allow for complete charge settling (assuming separate low-jitter sample and holds are used at the input and output of the overall circuit).\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. This method employs delay blocks to maintain nonoverlapping clocks. These delays can be implemented using a cascade of an even number of inverters or an RC network."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits. These clocks dictate the timing of charge transfers and must be nonoverlapping to prevent accidental charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals operating at the same frequency, arranged so that neither signal is high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, highlighting the sample numbers of discrete-time signals in switched-capacitor filters. By convention, we represent\nimage_name:(a)\ndescription:Fig. 14.3(a) depicts nonoverlapping clock signals, showing two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), used in digital circuits for timing control. The graph is a time-domain waveform plot.\n\n1. **Graph Type and Purpose:**\n- The graph is a time-domain waveform plot displaying two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axes and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), denoting the high and low states of the signals.\n\n3. **Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate between \\( V_{on} \\) and \\( V_{off} \\) as square waves.\n- They are timed so that neither is high at the same moment, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Characteristics and Technical Aspects:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period: \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between their high phases, preventing simultaneous high states.\n\n5. **Annotations and Data Points:**\n- The clock signals' frequency is \\( f_s = 1/T \\), indicating the sampling frequency.\n- The diagram highlights the nonoverlapping nature of the signals, crucial for preventing charge sharing in applications like switched-capacitor filters.\n\nThe graph effectively demonstrates the synchronized but non-simultaneous high states of the nonoverlapping clock signals.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) A potential circuit implementation for nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (e.g., $(n-1),(n),(n+1)$) just before the end of clock phase $\\phi_{1}$, while the end of clock phase $\\phi_{2}$ is offset by $1 / 2$ sample from these integers (e.g., $(n-3 / 2),(n-1 / 2)$). It is important to note that the precise timing of the falling edge of $\\phi_{2}$ relative to $\\phi_{1}$ is not critical. Generally, the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to ensure complete charge settling, especially if separate low-jitter sample and hold circuits are used at the circuit's input and output.\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. This method employs delay blocks to maintain nonoverlapping clocks. These delays can be implemented using a cascade of an even number of inverters or an RC network."
},
{
    "text": "A minimum of one pair of nonoverlapping clocks is crucial in switched-capacitor circuits, as they dictate the timing of charge transfers and must be nonoverlapping to prevent accidental charge loss. As depicted in Fig. 14.3(a), nonoverlapping clocks are two logic signals of the same frequency arranged so that neither are high simultaneously. The time axis in Fig. 14.3(a) is normalized to the clock period, T, highlighting the sample numbers of discrete-time signals in switched-capacitor filters. By convention, we assign\nimage_name:(a)\ndescription:Fig. 14.3(a) shows the concept of nonoverlapping clock signals, represented by two periodic waveforms, \\( \\phi_1 \\) and \\( \\phi_2 \\), which control timing in digital circuits. This is a time-domain waveform plot.\n\n1. **Graph Type and Purpose:**\n- The plot is a time-domain waveform, displaying two digital clock signals, \\( \\phi_1 \\) and \\( \\phi_2 \\), over time.\n\n2. **Axis Labels and Units:**\n- The horizontal axis, labeled \\( t/T \\), represents normalized time relative to the clock period \\( T \\), dimensionless but indicating time intervals.\n- The vertical axis shows voltage levels \\( V_{on} \\) and \\( V_{off} \\), marking the high and low states of the signals.\n\n3. **General Behavior and Trends:**\n- Both \\( \\phi_1 \\) and \\( \\phi_2 \\) oscillate between \\( V_{on} \\) and \\( V_{off} \\) as square waves.\n- They are timed so that neither is high at the same moment, ensuring nonoverlapping operation.\n- The signals repeat every clock period \\( T \\).\n\n4. **Key Characteristics and Technical Aspects:**\n- \\( \\phi_1 \\) transitions at integer multiples of the period, specifically at \\( n-2, n-1, n, n+1 \\), where \\( n \\) is an integer.\n- \\( \\phi_2 \\) is offset by half a sample period, with transitions at \\( n-3/2, n-1/2, n+1/2 \\), etc.\n- This offset creates a gap between their high phases, preventing simultaneous high states.\n\n5. **Annotations and Specifics:**\n- The clock signals' frequency is \\( f_s = 1/T \\), representing the sampling frequency.\n- The diagram clearly shows the nonoverlapping nature of the signals, essential in applications like switched-capacitor filters to avoid charge sharing.\n\nThe graph effectively portrays the timing and sequence of the nonoverlapping clock signals, highlighting their synchronized but non-concurrent high states.\nimage_name:(b)\ndescription:The circuit generates nonoverlapping clock signals ϕ1 and ϕ2 from a single clock input ϕ, with delays ensuring no overlap between ϕ1 and ϕ2.\n\nFig. 14.3 Nonoverlapping clocks. (a) Clock signals, $\\phi_{1}$ and $\\phi_{2}$. (b) A potential circuit for generating nonoverlapping clocks from a single clock.\nthe sampling numbers as integer values (i.e., $(n-1),(n),(n+1)$, etc.) just before the end of clock phase $\\phi_{1}$, whereas the end of clock phase $\\phi_{2}$ is marked $1 / 2$ sample off the integer values (i.e., $(n-3 / 2),(n-1 / 2)$, etc.). It is important to note that the falling edge of $\\phi_{2}$ does not need to be exactly one-half a clock period before the falling edge of $\\phi_{1}$. Generally, the clock edges of $\\phi_{1}$ and $\\phi_{2}$ need only be moderately controlled to allow for complete charge settling (assuming separate low-jitter sample and holds are employed at the circuit's input and output).\n\nA straightforward approach to generating nonoverlapping clocks is illustrated in Fig. 14.3(b) [Martin, 1981]. This method uses delay blocks to maintain nonoverlapping clocks, which can be implemented through a series of an even number of inverters or an RC network."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ represent two dc voltage sources. To understand this circuit's operation, we approach it from a charge-based perspective. Recall that the charge stored in a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, is the product of its capacitance, $\\mathrm{C}_{\\mathrm{x}}$, and the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2, resulting in a charge change ΔQ = C1(V1 - V2) per clock period.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The resistor equivalent of the switched-capacitor circuit is illustrated. The equivalent resistance is calculated as Req = T/C1, with T being the clock period and C1 the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are nonoverlapping clock signals, $\\mathrm{C}_{1}$ is first charged to $\\mathrm{V}_{1}$ and then to $\\mathrm{V}_{2}$ during each clock cycle. Consequently, the charge variation (in coulombs) over a single clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is calculated as\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer recurs every clock period, the equivalent average current due to this transfer can be determined by dividing the charge by the clock period. In other words, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average coulombs per second, given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Comparing (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current in the switched-capacitor circuit of Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because as the clock frequency rises, the same charge is transferred more rapidly, increasing the average current. Similarly, increasing $C_{1}$ results in a greater charge transfer per period, also boosting the average current. Consequently, raising the average current is akin to lowering the equivalent resistance between the voltage nodes, making the equivalent resistance inversely proportional to both capacitance and clock frequency.\n\nIt is important to note that this resistor approximation holds when the charge transferred per clock cycle remains consistent over numerous cycles, allowing for an average current calculation. Thus, it is primarily useful for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are slow relative to the clock frequency. For moderate input frequencies (relative to the sampling frequency), a precise discrete-time analysis is necessary, as covered in the subsequent subsection. Discrete-time analysis is applicable to switched-capacitor circuits because charge transfers depend on node voltages at specific instances and ideally ignore transients during nonsampled times.\n\nKey Point: When signal voltages vary slowly compared to the clock frequency, a switched-capacitor circuit exhibits an average current inversely proportional to the voltage across it, mimicking resistor behavior.\n\nKey Point: When signal voltages change significantly between clock cycles, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we get\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a substantial impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a modest capacitance. Such high impedance typically demands a significant amount of CMOS silicon area if realized as a resistor without specialized fabrication techniques."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ are two dc voltage sources. To understand this circuit's operation, we examine it from a charge perspective. Remember that the charge on a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, equals the capacitance, $\\mathrm{C}_{\\mathrm{x}}$, multiplied by the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit alternately connects C1 to V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2. This leads to a charge change ΔQ = C1(V1 - V2) every clock period.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The equivalent resistor circuit of the switched-capacitor circuit is illustrated. The equivalent resistance is calculated as Req = T/C1, where T is the clock period and C1 is the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are non-overlapping clock signals, $\\mathrm{C}_{1}$ is charged to $\\mathrm{V}_{1}$ and then to $\\mathrm{V}_{2}$ during each clock period. Consequently, the charge change (in coulombs) over one clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer occurs every clock period, the equivalent average current due to this transfer can be determined by dividing by the clock period. Thus, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average coulombs per second and is given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Comparing (14.3) with the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current in the switched-capacitor circuit of Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because as the clock frequency increases, the same charge is transferred more rapidly, raising the average current. Similarly, increasing $C_{1}$ results in more charge being transferred per period, also boosting the average current. Consequently, higher average current corresponds to lower equivalent resistance between the voltage nodes, indicating an inverse relationship between resistance and capacitance/clock frequency.\n\nIt is important to note that this resistor approximation relies on the assumption that the charge transferred per clock cycle remains consistent over numerous cycles, allowing for an average current calculation. Therefore, it is primarily useful for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are much slower than the clock frequency. For moderate input frequencies (relative to the sampling frequency), a precise discrete-time analysis is necessary, as covered in the following subsection. Discrete-time analysis is applicable to switched-capacitor circuits because charge transfers depend on node voltages at specific instances and ideally ignore transients during non-sampled times.\n\nKey Point: When signal voltages vary slowly relative to the clock frequency, a switched-capacitor behaves like a resistor with an average current inversely proportional to the voltage across it.\n\nKey Point: When signal voltages change significantly from one clock cycle to the next, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we obtain\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a substantial impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a modest capacitance. Typically, such high impedance would demand a significant amount of CMOS silicon area if implemented as a resistor without specialized fabrication techniques."
},
{
    "text": "Consider the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ are two dc voltage sources. To examine this circuit's behavior, we approach it from a charge perspective. Recall that the charge on a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, is the product of its capacitance, $\\mathrm{C}_{\\mathrm{x}}$, and the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2, resulting in a charge change ΔQ = C1(V1 - V2) per clock period.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The equivalent resistor model of the switched-capacitor circuit is shown, with the equivalent resistance given by Req = T/C1, where T is the clock period and C1 is the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are non-overlapping clock signals, $\\mathrm{C}_{1}$ charges to $\\mathrm{V}_{1}$ and then $\\mathrm{V}_{2}$ during each clock period. Consequently, the charge change (in coulombs) over one clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer repeats every clock period, the equivalent average current due to this transfer can be found by dividing the charge by the clock period. Thus, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average coulombs per second, given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Comparing (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current through the switched-capacitor circuit in Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because increasing the clock frequency transfers the same charge more rapidly, raising the average current. Similarly, increasing $C_{1}$ transfers more charge per period, also boosting the average current. Consequently, higher average current equates to lower equivalent resistance between the voltage nodes, indicating an inverse relationship between resistance and capacitance-clock frequency.\n\nIt's important to note that this resistor approximation holds when the charge transferred per cycle remains consistent over many cycles, allowing for an average current calculation. This method is primarily useful for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are slow relative to the clock frequency. For moderate input frequencies (relative to the sampling frequency), a precise discrete-time analysis, as discussed in the subsequent subsection, is necessary. Discrete-time analysis is applicable because charge transfers depend on node voltages at specific times and ideally ignore transients during non-sampled periods.\n\nKey Point: When signal voltages vary slowly compared to the clock frequency, a switched-capacitor behaves like a resistor with an average current inversely proportional to the voltage across it.\n\nKey Point: When signal voltages change significantly between clock cycles, a discrete-time analysis is essential to accurately predict the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we get\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a large impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a small capacitance. Typically, such high impedance would require a substantial CMOS silicon area if realized as a resistor without specialized fabrication techniques."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ are two dc voltage sources. To understand this circuit's operation, we examine it from a charge perspective. Remember that the charge on a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, equals the capacitance, $\\mathrm{C}_{\\mathrm{x}}$, multiplied by the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2. This leads to a charge change ΔQ = C1(V1 - V2) every clock cycle.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The equivalent resistor circuit of the switched-capacitor circuit is illustrated. The equivalent resistance is determined by Req = T/C1, where T is the clock period and C1 is the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are non-overlapping clock signals, $\\mathrm{C}_{1}$ is first charged to $\\mathrm{V}_{1}$ and then to $\\mathrm{V}_{2}$ during each clock period. Consequently, the charge change (in coulombs) over one clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is calculated as\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer occurs every clock period, the equivalent average current due to this transfer can be found by dividing the charge by the clock period. In other words, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average coulombs/second and is given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Comparing (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current through the switched-capacitor circuit in Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because as the clock frequency increases, the same charge is transferred more rapidly, raising the average current. If $C_{1}$ increases, more charge is transferred each period, also boosting the average current. Additionally, a higher average current corresponds to a lower equivalent resistance between the voltage nodes, indicating that the equivalent resistance is inversely proportional to the capacitance and clock frequency.\n\nIt is important to note that this resistor approximation relies on the assumption that the charge transferred per clock cycle remains consistent over many cycles, allowing for an average current calculation. Thus, it is primarily useful for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are slow relative to the clock frequency. For moderate input frequencies (relative to the sampling frequency), a precise discrete-time analysis is necessary, as covered in the following subsection. Discrete-time analysis is applicable to switched-capacitor circuits because charge transfers depend on node voltages at specific instances and ideally ignore transients during non-sampled times.\n\nKey Point: When signal voltages vary slowly compared to the clock frequency, a switched-capacitor circuit exhibits an average current inversely proportional to the voltage across it, mimicking a resistor.\n\nKey Point: When signal voltages change significantly from one clock cycle to the next, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we obtain\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a very high impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a relatively small capacitance. Typically, such high impedance would require a substantial amount of CMOS silicon area if implemented as a resistor without specialized fabrication techniques."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ are two dc voltage sources. To understand this circuit's operation, we examine it from a charge standpoint. Remember that the charge on a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, equals the capacitance, $\\mathrm{C}_{\\mathrm{x}}$, multiplied by the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2. This leads to a charge change ΔQ = C1(V1 - V2) every clock cycle.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The resistor equivalent of the switched-capacitor circuit is illustrated. The equivalent resistance is determined by Req = T/C1, where T is the clock period and C1 is the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are nonoverlapping clock signals, $\\mathrm{C}_{1}$ is charged to $\\mathrm{V}_{1}$ and then $\\mathrm{V}_{2}$ during each clock period. Consequently, the change in charge (in coulombs) over one clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer recurs every clock period, the equivalent average current due to this transfer can be found by dividing by the clock period. In other words, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average number of coulombs/second, given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Relating (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current through the switched-capacitor circuit in Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because as the clock frequency rises, the same charge is transferred each period but more rapidly, thus increasing the average current. If $C_{1}$ increases, more charge is transferred each period, also boosting the average current. Additionally, increasing the average current is akin to reducing the equivalent resistance between the two voltage nodes, making the equivalent resistance inversely proportional to the capacitance and clock frequency.\n\nIt's important to note that this resistor approximation assumes a constant charge transfer per clock cycle over many cycles, allowing for an average current calculation. Hence, it is primarily useful for analyzing the low-frequency behavior of switched-capacitor circuits, where voltages change very slowly compared to the clock frequency. For moderate input frequencies (relative to the sampling frequency), an accurate discrete-time analysis is necessary, as covered in the next subsection. Discrete-time analysis is applicable to switched-capacitor circuits because charge transfers depend on node voltages at specific instances and are ideally unaffected by transients during nonsampled times.\n\nKey Point: When signal voltages change very slowly relative to the clock frequency, a switched-capacitor behaves like a resistor with an average current inversely proportional to the voltage across it.\n\nKey Point: When signal voltages vary significantly from one clock cycle to the next, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we get\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a very high impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a relatively small capacitance. Such high impedance typically demands a substantial CMOS silicon area if realized as a resistor without specialized processing techniques."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ represent two dc voltage sources. To understand this circuit's operation, we approach it from a charge-based perspective. Remember, the charge on a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, equals the product of its capacitance, $\\mathrm{C}_{\\mathrm{x}}$, and the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2, resulting in a charge change ΔQ = C1(V1 - V2) each clock period.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The resistor equivalent of the switched-capacitor circuit is illustrated. The equivalent resistance is calculated as Req = T/C1, where T denotes the clock period and C1 is the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are non-overlapping clock signals, $\\mathrm{C}_{1}$ is first charged to $\\mathrm{V}_{1}$ and then to $\\mathrm{V}_{2}$ during each clock cycle. Consequently, the charge variation (in coulombs) over a single clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is calculated as\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer recurs with each clock period, the equivalent average current due to this transfer can be determined by dividing the charge by the clock period. In other words, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average coulombs per second and is given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Comparing (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current through the switched-capacitor circuit in Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because as the clock frequency rises, the same charge is transferred more rapidly, increasing the average current. Similarly, increasing $C_{1}$ results in a greater charge transfer per period, also boosting the average current. An increase in average current corresponds to a decrease in the equivalent resistance between the voltage nodes, thus making the equivalent resistance inversely proportional to the capacitance and clock frequency.\n\nIt is important to note that this resistor approximation relies on the assumption that the charge transferred per clock cycle remains consistent over numerous cycles, allowing for the calculation of an average current. Therefore, it is primarily applicable for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are much slower than the clock frequency. For moderate input frequencies relative to the sampling frequency, a precise discrete-time analysis is necessary, as covered in the following subsection. Discrete-time analysis is suitable for switched-capacitor circuits because charge transfers depend on node voltages at specific instances and ideally ignore transients during non-sampled times.\n\nKey Point: When signal voltages vary slowly compared to the clock frequency, a switched-capacitor behaves like a resistor, producing an average current inversely proportional to the voltage across it.\n\nKey Point: When signal voltages change significantly from one clock cycle to the next, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we get\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a substantial impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a relatively small capacitance. Typically, such high impedance would necessitate a large CMOS silicon area if implemented as a resistor without specialized fabrication techniques."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ represent two dc voltage sources. To understand this circuit's operation, we approach it from the perspective of charge. Recall that the charge stored in a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, is the product of its capacitance, $\\mathrm{C}_{\\mathrm{x}}$, and the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2. This leads to a charge change ΔQ = C1(V1 - V2) with each clock cycle.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The equivalent resistor model of the switched-capacitor circuit is illustrated. The equivalent resistance is calculated as Req = T/C1, with T being the clock period and C1 the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are nonoverlapping clock signals, $\\mathrm{C}_{1}$ is alternately charged to $\\mathrm{V}_{1}$ and then $\\mathrm{V}_{2}$ during each clock period. Consequently, the charge variation (in coulombs) over a single clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer recurs every clock period, the equivalent average current due to this transfer can be determined by dividing the charge by the clock period. Thus, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equates to the average coulombs per second and is given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). By comparing (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current in the switched-capacitor circuit of Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because increasing the clock frequency transfers the same charge more rapidly, thereby raising the average current. Similarly, increasing $C_{1}$ results in a greater charge transfer per period, also boosting the average current. Consequently, higher average current corresponds to lower equivalent resistance between the voltage nodes, making the equivalent resistance inversely proportional to both capacitance and clock frequency.\n\nIt is important to note that this resistor approximation relies on the assumption that the charge transferred per clock cycle remains consistent over numerous cycles, enabling the determination of an average current flow. Hence, it is primarily applicable for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are minimal compared to the clock frequency. For moderate input frequencies relative to the sampling frequency, a precise discrete-time analysis is necessary, as covered in the subsequent subsection. Discrete-time analysis is suitable for switched-capacitor circuits because charge transfers depend on node voltages at specific instances and ideally disregard transients during nonsampled periods.\n\nKey Point: When signal voltages vary slowly relative to the clock frequency, a switched-capacitor circuit exhibits an average current inversely proportional to the voltage across it, mimicking the behavior of a resistor.\n\nKey Point: When signal voltages undergo significant changes between clock cycles, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nApplying (14.5), we get\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a substantial impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a modest capacitance. Typically, such high impedance would necessitate a large CMOS silicon area if realized as a resistor without specialized fabrication techniques."
},
{
    "text": "Examine the switched-capacitor circuit depicted in Fig. 14.4(a), where $\\mathrm{V}_{1}$ and $\\mathrm{V}_{2}$ are two dc voltage sources. To understand this circuit's operation, we examine it from a charge perspective. Recall that the charge on a capacitor, $\\mathrm{Q}_{\\mathrm{x}}$, equals the capacitance, $\\mathrm{C}_{\\mathrm{x}}$, multiplied by the voltage across it, $\\mathrm{V}_{\\mathrm{x}}$. Mathematically, this is expressed as\n\n$$\n\\begin{equation*}\nQ_{x}=C_{x} V_{x} \\tag{14.1}\n\\end{equation*}\n$$\n\nimage_name:(a)\ndescription:The switched-capacitor circuit toggles the connection of C1 between V1 and V2 using non-overlapping clock signals ϕ1 and ϕ2, resulting in a charge change ΔQ = C1(V1 - V2) each clock period.\n\nimage_name:(b)\ndescription:\n[\nname: Req, type: Resistor, value: Req, ports: {N1: V1, N2: V2}\n]\nextrainfo:The equivalent resistor representation of the switched-capacitor circuit is illustrated. The equivalent resistance is determined by Req = T/C1, where T is the clock period and C1 is the capacitance.\n\nFig. 14.4 Resistor equivalence of a switched capacitor. (a) Switched-capacitor circuit, and (b) resistor equivalent.\n\nGiven that $\\phi_{1}$ and $\\phi_{2}$ are non-overlapping clock signals, $\\mathrm{C}_{1}$ charges to $\\mathrm{V}_{1}$ and then $\\mathrm{V}_{2}$ during each clock period. Consequently, the charge change (in coulombs) over one clock period, $\\Delta \\mathbf{Q}_{1}$, transferred from node $V_{1}$ to node $V_{2}$, is\n\n$$\n\\begin{equation*}\n\\Delta Q_{1}=C_{1}\\left(V_{1}-V_{2}\\right) \\tag{14.2}\n\\end{equation*}\n$$\n\nSince this charge transfer recurs every clock period, the equivalent average current due to this transfer can be calculated by dividing by the clock period. Thus, the average current, $\\mathrm{I}_{\\mathrm{avg}}$ (in amps), equals the average coulombs/second and is given by\n\n$$\n\\begin{equation*}\n\\mathrm{I}_{\\mathrm{avg}}=\\frac{\\mathrm{C}_{1}\\left(\\mathrm{~V}_{1}-\\mathrm{V}_{2}\\right)}{\\mathrm{T}} \\tag{14.3}\n\\end{equation*}\n$$\n\nwhere $T$ is the clock period (i.e., the sampling frequency $f_{s}=1 / T$ ). Comparing (14.3) to the equivalent resistor circuit in Fig. 14.4(b), where\n\n$$\n\\begin{equation*}\nI_{e q}=\\frac{V_{1}-V_{2}}{R_{e q}} \\tag{14.4}\n\\end{equation*}\n$$\n\nwe find that the average current through the switched-capacitor circuit in Fig. 14.4(a) matches that of the resistor circuit in Fig. 14.4(b) if\n\n$$\n\\begin{equation*}\nR_{e q}=\\frac{T}{C_{1}}=\\frac{1}{C_{1} f_{s}} \\tag{14.5}\n\\end{equation*}\n$$\n\nThis relationship is intuitively clear because increasing the clock frequency transfers the same charge more rapidly, raising the average current. Similarly, increasing $C_{1}$ transfers more charge per period, also boosting the average current. This increase in average current corresponds to a decrease in the equivalent resistance between the voltage nodes, making the equivalent resistance inversely proportional to the capacitance and clock frequency.\n\nIt is important to note that this resistor approximation holds when the charge transferred per clock cycle remains consistent over many cycles, allowing for an average current calculation. This method is primarily useful for analyzing the low-frequency behavior of switched-capacitor circuits, where voltage changes are slow relative to the clock frequency. For moderate input frequencies (relative to the sampling frequency), a precise discrete-time analysis is necessary, as covered in the following subsection. Discrete-time analysis is applicable because charge transfers depend on node voltages at specific times and ideally ignore transients during non-sampled periods.\n\nKey Point: When signal voltages vary slowly compared to the clock frequency, a switched-capacitor behaves like a resistor with an average current inversely proportional to the voltage across it.\n\nKey Point: When signal voltages change significantly from one clock cycle to the next, a discrete-time analysis is essential for accurately predicting the input-output behavior of switched-capacitor circuits.\n\n#### EXAMPLE 14.1\n\nWhat is the equivalent resistance of a 5 pF capacitance sampled at a clock frequency of 100 kHz?\n\n#### Solution\n\nUsing (14.5), we find\n\n$$\n\\mathrm{R}_{\\mathrm{eq}}=\\frac{1}{\\left(5 \\times 10^{-12}\\right)\\left(100 \\times 10^{3}\\right)}=2 \\mathrm{M} \\Omega\n$$\n\nNotably, a substantial impedance of $2 \\mathrm{M} \\Omega$ can be achieved on an integrated circuit using just two transistors, a clock, and a relatively small capacitance. Typically, such high impedance would require a large CMOS silicon area if implemented as a resistor without specialized fabrication techniques."
},
{
    "text": "The illustration of an early switched-capacitor discrete-time integrator from [Hosticka, 1977] is presented in Fig. 14.5. An additional switch adjacent to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, is depicted to denote that the output signal is valid at the conclusion of $\\phi_{1}$, adhering to the sampling-time convention depicted in Fig. 14.3(a). This implies that any circuit utilizing the output of this discrete-time integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. However, no assumptions are made regarding when $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ alters its value (it could be either $\\phi_{1}$ or $\\phi_{2}$); this is insignificant since $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the circuit depicted.\n\nKey Point: During each clock cycle, a switched-capacitor integrator samples a quantity of charge proportional to the input voltage and the sampling capacitance, which is then transferred to a second integrating capacitor.\n\nTo examine this circuit, we once again consider the charge behavior and observe that a virtual ground is present at the opamp's negative input. Assuming an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$ suggests that the charge on $\\mathrm{C}_{2}$ is equivalent to $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. Additionally, at time $(n T-T)$, $\\phi_{1}$ is just turning off (and $\\phi_{2}$ is off), allowing the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t}$) to be sampled, resulting in the charge on $\\mathrm{C}_{1}$ being equal to $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as illustrated in Fig. 14.6(a). When $\\phi_{2}$ goes high, its switch causes $C_{1}$ to discharge by establishing a virtual ground on the top plate of $\\mathrm{C}_{1}$, as shown in Fig. 14.6(b). This discharging current must flow through $\\mathrm{C}_{2}$, thereby adding the charge on $\\mathrm{C}_{1}$ to the charge already present on $\\mathrm{C}_{2}$. A positive input voltage will result in a negative voltage across $\\mathrm{C}_{2}$, and consequently, a negative output voltage; hence, the integrator is an inverting integrator. At the conclusion of $\\phi_{2}$ (once things have stabilized), we can formulate the charge equation,\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.6}\n\\end{equation*}\n$$\n\nThe negative sign in (14.6) indicates that the integrator is an inverting integrator.\nAlthough (14.6) is accurate, we aim to determine the charge on $\\mathrm{C}_{2}$ at the end of $\\phi_{1}$ (or equivalently, nT) as indicated by the switch shown near $v_{\\mathrm{co}}(\\mathrm{t})$ in Fig. 14.5. To find this charge, we note that once $\\phi_{2}$ turns off, the charge on $\\mathrm{C}_{2}$ will remain constant during the subsequent $\\phi_{1}$, until $\\phi_{2}$ turns on again in its next cycle. Therefore, the charge on $C_{2}$ at time $(n T)$ at the end of the next $\\phi_{1}$ is equal to that at time $(n T-T / 2)$, or mathematically,\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2) \\tag{14.7}\n\\end{equation*}\n$$\n\nCombining (14.6) and (14.7) yields\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.8}\n\\end{equation*}\n$$\n\nDividing by $C_{2}$ and using the discrete-time variables $v_{i}(n)=v_{\\mathrm{ci}}(n T)$ and $v_{0}(n)=v_{c o}(n T)$, we obtain the following discrete-time relationship for the circuit of Fig. 14.5:\n\n$$\n\\begin{equation*}\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n-1) \\tag{14.9}\n\\end{equation*}\n$$\n\nApplying the $\\mathbf{z}$-transform to (14.9), we also derive\n\n$$\n\\begin{equation*}\nV_{0}(z)=z^{-1} V_{0}(z)-\\frac{C_{1}}{C_{2}} z^{-1} V_{i}(z) \\tag{14.10}\n\\end{equation*}\n$$\n\nfrom which we can ultimately determine the transfer function, $H(z)$, given by\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.11}\n\\end{equation*}\n$$\n\nThe transfer function realizes its gain coefficient as a ratio of two capacitances, allowing for precise definition in an integrated circuit. Often, the transfer function is rewritten to eliminate terms of $z$ with negative powers, resulting in\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.12}\n\\end{equation*}\n$$\n\nFig. 14.7 depicts typical voltage waveforms for this discrete-time integrator. It is important to note that the derived discrete-time equation only represents the relationship of the voltage signals $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ and $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ at the time $(\\mathrm{nT})$, which occurs just before the end of $\\phi_{1}$. It does not provide information about the voltages at other times. In reality, the voltages remain constant at other times (disregarding second-order effects), which is analogous to using sampled voltages as inputs to a sample and hold circuit for this specific SC integrator.\n\nKey Point: The discrete-time transfer function of a switched-capacitor integrator exhibits a pole at $d c, z=1$.\n\n#### EXAMPLE 14.2\n\nDemonstrate that for frequencies much lower than the sampling frequency, equation (14.11) approximates the transfer function of an ideal continuous-time integrator.\n\nFig. 14.7 displays typical voltage waveforms for the discrete-time integrator depicted in Fig. 14.5.\n\n#### Solution\n\nEquation (14.11) can be rewritten as\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{z^{1 / 2}-z^{-1 / 2}} \\tag{14.13}\n\\end{equation*}\n$$\n\nTo determine the frequency response, we utilize the fact that\n\n$$\n\\begin{equation*}\nz=e^{j \\omega T}=\\cos (\\omega T)+j \\sin (\\omega T) \\tag{14.14}\n\\end{equation*}\n$$\n\nwhere T, the period, is the reciprocal of the sampling frequency. Therefore,\n\n$$\n\\begin{equation*}\nz^{1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)+j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.15}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\nz^{-1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)-j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.16}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.13) yields\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j 2 \\sin \\left(\\frac{\\omega T}{2}\\right)} \\cong-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j \\omega T} \\tag{14.17}\n\\end{equation*}\n$$\n\nfor $\\omega \\mathrm{T}<<1$. The $\\mathrm{z}^{-1 / 2}$ in the numerator represents a simple delay and can be disregarded. Thus, we observe that the transfer function is approximately that of a continuous-time integrator with a gain constant of\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{\\mathrm{I}} \\cong-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2} \\mathrm{~T}}\\right) \\tag{14.18}\n\\end{equation*}\n$$\n\nwhich depends solely on the integrator capacitor ratio and clock frequency.\n\nSo far, we have neglected the impact of parasitic capacitances associated with the creation of $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$, as well as the nonlinear capacitances linked to the switches. The inclusion of such parasitic capacitances results in the circuit shown in Fig. 14.8. Here, $\\mathrm{C}_{\\mathrm{p} 1}$ represents the parasitic capacitance of the top plate of $\\mathrm{C}_{1}$ and the nonlinear capacitances associated with the two switches; $\\mathrm{C}_{\\mathrm{p} 2}$ represents the parasitic capacitance of the bottom plate of $\\mathrm{C}_{1}$; while $\\mathrm{C}_{\\mathrm{p} 3}$ represents the parasitic capacitance associated with the top plate of $\\mathrm{C}_{2}$, the input capacitance of the opamp, and that of the $\\phi_{2}$ switch. Finally, $\\mathrm{C}_{\\mathrm{p} 4}$ accounts for the bottom-plate parasitic capacitance of $\\mathrm{C}_{2}$ and any additional capacitance that the opamp output must drive.\n\nIn considering these parasitic capacitances, we can immediately disregard the effect of $\\mathrm{C}_{\\mathrm{p} 2}$ since it is always connected to ground. Similarly, the effect of $\\mathrm{C}_{\\mathrm{p} 3}$ on the transfer function is minimal since it is always connected to the virtual ground of the opamp. Additionally, $\\mathrm{C}_{\\mathrm{p} 4}$ is connected to the opamp output; thus, although it may affect the speed of the opamp, it would not impact the final settling point of the opamp output. Finally, we note that $C_{p 1}$ is in parallel with $C_{1}$, resulting in the transfer function of this discrete-time integrator, including the effects of parasitic capacitance, being given by\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}+C_{p 1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.19}\n\\end{equation*}\n$$\n\nFrom (14.19), we observe that the gain coefficient is related to the parasitic coefficient $\\mathrm{C}_{\\mathrm{pl}}$, which is not well-controlled and would be partially nonlinear due to the input capacitances of the switches and top-plate parasitic capacitance. To address this limitation, innovative circuits known as parasitic-insensitive structures were developed [Martin, 1978; Allstot, 1978; Jacobs, 1978]."
},
{
    "text": "The original text provided an in-depth analysis of a switched-capacitor discrete-time integrator, including its operation, analysis of charge behavior, and the effects of parasitic capacitances. It also touched upon the derivation of the transfer function and its approximation to an ideal continuous-time integrator's transfer function at low frequencies.\n\nIn Fig. 14.5, a representation of an early switched-capacitor discrete-time integrator from [Hosticka, 1977] is presented. An additional switch is depicted close to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, to signify that the output signal is valid at the conclusion of $\\phi_{1}$, aligning with the sampling-time convention illustrated in Fig. 14.3(a). Consequently, any circuit utilizing the output from this discrete-time integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. It is worth noting that the text does not specify when $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ alters its value (it could be during either $\\phi_{1}$ or $\\phi_{2}$); however, this is inconsequential since $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the depicted circuit.\n\nA key point discussed is that during each clock cycle, a switched-capacitor integrator samples a quantity of charge proportional to the input voltage and the sampling capacitance, subsequently transferring it to a second integrating capacitor.\n\nFor a thorough analysis of this circuit, the text examines the charge dynamics and observes the emergence of a virtual ground at the opamp's negative input. Assuming an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$ suggests that the charge on $\\mathrm{C}_{2}$ is equivalent to $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. At this same time, $\\phi_{1}$ is in the process of turning off (while $\\phi_{2}$ is off), thus sampling the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t}$), resulting in the charge on $\\mathrm{C}_{1}$ being $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as depicted in Fig. 14.6(a). As $\\phi_{2}$ turns on, its switch causes $C_{1}$ to discharge, creating a virtual ground at the top plate of $\\mathrm{C}_{1}$, as shown in Fig. 14.6(b). This discharge current flows through $\\mathrm{C}_{2}$, thereby adding the charge from $\\mathrm{C}_{1}$ to the existing charge on $\\mathrm{C}_{2}$. The integrator is inverting, which means a positive input voltage will lead to a negative output voltage across $\\mathrm{C}_{2}$, resulting in a negative output voltage.\n\nThe text proceeds to derive the charge equation and the discrete-time relationship for the circuit, ultimately leading to the transfer function, $H(z)$. It also discusses how the transfer function can be affected by parasitic capacitances and the development of parasitic-insensitive structures to mitigate these effects.\n\nThe waveforms in Fig. 14.7 illustrate the typical behavior of the discrete-time integrator, showing the clock signals, input voltage, intermediate voltage, and output voltage over time.\n\nFinally, the text presents a solution demonstrating how equation (14.11) can be approximated to represent the transfer function of an ideal continuous-time integrator at frequencies much lower than the sampling frequency. It also addresses the impact of parasitic capacitances on the circuit and how they can affect the transfer function."
},
{
    "text": "An early illustration of a switched-capacitor discrete-time integrator is depicted in Fig. 14.5, as introduced by Hosticka in 1977. The figure illustrates an additional switch adjacent to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, signifying that the output signal is valid at the conclusion of $\\phi_{1}$, in accordance with the sampling-time convention depicted in Fig. 14.3(a). Put differently, any circuit utilizing the output of this discrete-time integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. However, it's important to note that the exact timing of $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ value change is not specified (it could occur during $\\phi_{1}$ or $\\phi_{2}$); this ambiguity is inconsequential because $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the depicted circuit.\n\nA pivotal point to understand is that during each clock cycle, a switched-capacitor integrator samples a quantity of charge that is proportional to the input voltage and the sampling capacitance, subsequently transferring this charge to a secondary integrating capacitor.\n\nWhen analyzing this circuit, we focus on the charge dynamics and observe the presence of a virtual ground at the op-amp's negative input. Assuming an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$ suggests that the charge on $\\mathrm{C}_{2}$ equals $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. Also, at time $(n T-T)$, $\\phi_{1}$ is just deactivating (while $\\phi_{2}$ is off), which results in the sampling of the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$, causing the charge on $\\mathrm{C}_{1}$ to be equivalent to $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as depicted in Fig. 14.6(a). When $\\phi_{2}$ becomes active, its switch causes $C_{1}$ to discharge, establishing a virtual ground on the top plate of $\\mathrm{C}_{1}$, as shown in Fig. 14.6(b). This discharge current passes through $\\mathrm{C}_{2}$, thereby adding the charge from $C_{1}$ to the existing charge on $\\mathrm{C}_{2}$. A positive input voltage leads to a negative voltage across $\\mathrm{C}_{2}$ and, consequently, a negative output voltage; hence, the integrator functions as an inverting integrator. At the end of $\\phi_{2}$, once the circuit stabilizes, we can formulate the charge equation.\n\nThrough a series of calculations and transformations, we arrive at the discrete-time relationship for the circuit of Fig. 14.5, and subsequently derive the transfer function, $H(z)$.\n\nIllustrated in Fig. 14.7 are the typical voltage waveforms for this discrete-time integrator. It's important to recognize that the derived discrete-time equation only portrays the relationship between the voltage signals $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ and $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ at the specific time $(\\mathrm{nT})$, immediately preceding the end of $\\phi_{1}$. It does not provide information on voltage levels at other times. In reality, voltages remain constant at other times (neglecting higher-order effects), which is analogous to employing sampled voltages as inputs to a sample-and-hold circuit for this particular SC integrator.\n\nAn example problem demonstrates that for frequencies significantly lower than the sampling frequency, equation (14.11) approximates the transfer function of an ideal continuous-time integrator.\n\nThe circuit in Fig. 14.8 shows a discrete-time integrator with parasitic capacitances. The impact of these parasitic capacitances is considered in the derivation of the transfer function, which now includes the effects of the parasitic capacitance $C_{\\mathrm{pl}}$. To address the limitations imposed by these parasitic elements, innovative circuits known as parasitic-insensitive structures were developed."
},
{
    "text": "A representation of an early switched-capacitor discrete-time integrator, as introduced by Hosticka in 1977, is depicted in Fig. 14.5. The figure includes an additional switch adjacent to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, to signify that the output is valid at the conclusion of $\\phi_{1}$, aligning with the sampling-time convention from Fig. 14.3(a). This implies that circuits utilizing the output from this integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. However, there's no assumption regarding when $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ alters its value—it could be during $\\phi_{1}$ or $\\phi_{2}$—which is inconsequential because $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the presented circuit.\n\nA pivotal aspect is that during each clock cycle, a switched-capacitor integrator captures a charge proportional to the input voltage and the sampling capacitance, then transfers this charge to another integrating capacitor.\n\nFor analysis, we focus on charge dynamics and observe a virtual ground at the opamp's negative input. Assuming an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$ indicates that the charge on $\\mathrm{C}_{2}$ is $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. At this same time, $\\phi_{1}$ is turning off (while $\\phi_{2}$ is off), leading to the sampling of the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ and resulting in the charge on $\\mathrm{C}_{1}$ being $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as depicted in Fig. 14.6(a). When $\\phi_{2}$ is activated, its switch causes $C_{1}$ to discharge by establishing a virtual ground on the top plate of $C_{1}$, as shown in Fig. 14.6(b). The discharging current passes through $C_{2}$, thereby adding the charge from $C_{1}$ to the existing charge on $C_{2}$. The integrator is inverting, hence a positive input voltage leads to a negative output voltage across $C_{2}$.\n\nAt the end of $\\phi_{2}$, when the system stabilizes, the charge equation can be written as\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.6}\n\\end{equation*}\n$$\n\nThe negative sign in (14.6) signifies the inverting nature of the integrator.\n\nTo determine the charge on $\\mathrm{C}_{2}$ at the end of $\\phi_{1}$ (or at nT), we consider that after $\\phi_{2}$ switches off, the charge on $\\mathrm{C}_{2}$ remains constant during the subsequent $\\phi_{1}$ until $\\phi_{2}$ activates again in the next cycle. Thus, the charge on $C_{2}$ at time $(n T)$, at the end of the following $\\phi_{1}$, is equal to that at time $(n T-T / 2)$, mathematically represented as\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2) \\tag{14.7}\n\\end{equation*}\n$$\n\nCombining (14.6) and (14.7) yields\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.8}\n\\end{equation*}\n$$\n\nUpon dividing by $C_{2}$ and using discrete-time variables $v_{i}(n)=v_{\\mathrm{ci}}(n T)$ and $v_{0}(n)=v_{c o}(n T)$, the discrete-time relationship for the circuit in Fig. 14.5 is\n\n$$\n\\begin{equation*}\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n-1) \\tag{14.9}\n\\end{equation*}\n$$\n\nThe $\\mathbf{z}$-transform of (14.9) is\n\n$$\n\\begin{equation*}\nV_{0}(z)=z^{-1} V_{0}(z)-\\frac{C_{1}}{C_{2}} z^{-1} V_{i}(z) \\tag{14.10}\n\\end{equation*}\n$$\n\nFrom this, the transfer function $H(z)$ is derived as\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.11}\n\\end{equation*}\n$$\n\nThe transfer function's gain coefficient is defined as a ratio of capacitances, allowing precise definition in integrated circuits. Often, the transfer function is rewritten to eliminate negative powers of $z$:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.12}\n\\end{equation*}\n$$\n\nFig. 14.7 displays typical voltage waveforms for the discrete-time integrator. The derived discrete-time equation only represents the relationship of $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ and $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ at time $(\\mathrm{nT})$, just before the end of $\\phi_{1}$. It doesn't specify voltage levels at other times, although in reality, voltages remain constant at those times (disregarding second-order effects), akin to using sampled voltages as inputs to a sample and hold circuit for this SC integrator.\n\nAn important point is that the discrete-time transfer function of a switched-capacitor integrator has a pole at $z=1$.\n\n#### EXAMPLE 14.2\n\nDemonstrate that for frequencies much lower than the sampling frequency, equation (14.11) approximates the transfer function of an ideal continuous-time integrator.\n\nThe graph in Fig. 14.7 illustrates time-domain waveforms depicting the operation of a discrete-time integrator. It consists of several waveforms plotted against time (t) on the horizontal axis.\n\n1. **Type of Graph and Function:**\n- This is a time-domain waveform graph that illustrates the operation of a switched-capacitor integrator.\n\n2. **Axes Labels and Units:**\n- The horizontal axis represents time (t).\n- The vertical axes show various voltage levels, labeled as \\( \\phi_1 \\), \\( \\phi_2 \\), \\( v_{ci}(t) \\), \\( v_{cx}(t) \\), and \\( v_{co}(t) \\).\n\n3. **Overall Behavior and Trends:**\n- **\\( \\phi_1 \\) and \\( \\phi_2 \\) Waveforms:** These are digital clock signals with non-overlapping square wave patterns. \\( \\phi_1 \\) and \\( \\phi_2 \\) alternate in a complementary fashion, indicating the switching phases of the integrator.\n- **\\( v_{ci}(t) \\):** This waveform shows a continuous and slightly decreasing trend, representing the input voltage to the integrator.\n- **\\( v_{cx}(t) \\):** This waveform exhibits a step-like behavior with a slight downward trend, reflecting the intermediate voltage across the capacitor during switching.\n- **\\( v_{co}(t) \\):** This is a step waveform, showing discrete levels that change only at the edges of the clock cycles, representing the output voltage of the integrator.\n\n4. **Key Features and Technical Details:**\n- The clock signals \\( \\phi_1 \\) and \\( \\phi_2 \\) are crucial for controlling the timing of the switched-capacitor network.\n- The input voltage \\( v_{ci}(t) \\) shows a smooth decay, typical of a signal being integrated over time.\n- The step changes in \\( v_{cx}(t) \\) and \\( v_{co}(t) \\) correspond to the clock edges, with \\( v_{co}(t) \\) showing the sampled and held output of the integrator.\n\n5. **Annotations and Specific Data Points:**\n- The graph features dashed vertical lines indicating the sampling instances where the clock signals transition, marking key points for the waveform changes.\n- There are no specific numerical values provided for the voltages or time intervals, but the consistent pattern of the waveforms suggests regular clock intervals and voltage levels consistent with typical switched-capacitor integrator operation.\n\nFig. 14.7 Typical voltage waveforms for the discrete-time integrator shown in Fig. 14.5.\n\n#### Solution\n\nEquation (14.11) can be rewritten as\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{z^{1 / 2}-z^{-1 / 2}} \\tag{14.13}\n\\end{equation*}\n$$\n\nTo find the frequency response, we use the fact that\n\n$$\n\\begin{equation*}\nz=e^{j \\omega T}=\\cos (\\omega T)+j \\sin (\\omega T) \\tag{14.14}\n\\end{equation*}\n$$\n\nwhere T , the period, is one over the sampling frequency. Therefore,\n\n$$\n\\begin{equation*}\nz^{1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)+j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.15}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\nz^{-1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)-j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.16}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.13) gives\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j 2 \\sin \\left(\\frac{\\omega T}{2}\\right)} \\cong-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j \\omega T} \\tag{14.17}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.8\ndescription:The circuit is a discrete-time integrator with parasitic capacitances. It uses two NMOS transistors (M1 and M2) for switching, controlled by clock signals (Phi1 and Phi2). The op-amp A1 is used to achieve the integration with capacitors C1 and C2. Parasitic capacitors Cp1, Cp2, Cp3, and Cp4 are connected to ground. The input voltage is Vi(n) and the output is Vo(n).\n\nFig. 14.8 A discrete-time integrator with parasitic capacitances shown.\nfor $\\omega \\mathrm{T}<<1$. The $\\mathrm{z}^{-1 / 2}$ in the numerator represents a simple delay and can be ignored. Thus, we see that the transfer function is approximately that of a continuous-time integrator having a gain constant of\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{\\mathrm{I}} \\cong-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2} \\mathrm{~T}}\\right) \\tag{14.18}\n\\end{equation*}\n$$\n\nwhich is a function of the integrator capacitor ratio and clock frequency only.\n\nSo far, the impact of parasitic capacitances due to the creation of $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$, as well as the nonlinear capacitances associated with the switches, has been neglected. The circuit in Fig. 14.8 incorporates these parasitic capacitances. Here, $\\mathrm{C}_{\\mathrm{p} 1}$ represents the parasitic capacitance of the top plate of $\\mathrm{C}_{1}$ and the nonlinear capacitances of the switches; $\\mathrm{C}_{\\mathrm{p} 2}$ represents the parasitic capacitance of the bottom plate of $\\mathrm{C}_{1}$; while $\\mathrm{C}_{\\mathrm{p} 3}$ represents the parasitic capacitance associated with the top plate of $\\mathrm{C}_{2}$, the input capacitance of the opamp, and that of the $\\phi_{2}$ switch. Finally, $\\mathrm{C}_{\\mathrm{p} 4}$ accounts for the bottom-plate parasitic capacitance of $\\mathrm{C}_{2}$ and any additional capacitance the opamp output must drive.\n\nAccounting for these parasitic capacitances, we can disregard the effect of $\\mathrm{C}_{\\mathrm{p} 2}$ since it is always connected to ground. Similarly, the effect of $\\mathrm{C}_{\\mathrm{p} 3}$ on the transfer function is minor since it is always connected to the virtual ground of the opamp. Also, $\\mathrm{C}_{\\mathrm{p} 4}$ is connected to the opamp output; thus, although it may affect the opamp's speed, it would not impact the final settling point of the opamp output. Finally, $C_{p 1}$ is in parallel with $C_{1}$, and the transfer function of this discrete-time integrator, including the effects of parasitic capacitance, is given by\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}+C_{p 1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.19}\n\\end{equation*}\n$$\n\nFrom (14.19), we observe that the gain coefficient is related to the parasitic coefficient $\\mathrm{C}_{\\mathrm{pl}}$, which is not well controlled and would be partially nonlinear due to the input capacitances of the switches and top-plate parasitic capacitance. To address this limitation, innovative circuits known as parasitic-insensitive structures were developed [Martin, 1978; Allstot, 1978; Jacobs, 1978]."
},
{
    "text": "An instance of one of the pioneering switched-capacitor discrete-time integrators is depicted in Fig. 14.5, as cited in [Hosticka, 1977]. This illustration includes an additional switch situated close to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, signifying that the output signal is valid at the conclusion of $\\phi_{1}$, in conformity with the sampling-time convention depicted in Fig. 14.3(a). In essence, any circuit utilizing the output of this discrete-time integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. However, it's worth noting that the timing of $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ value change (whether it be during $\\phi_{1}$ or $\\phi_{2}$) is irrelevant since $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the presented circuit.\n\nThe integral operation within a switched-capacitor integrator involves sampling a quantity of charge proportional to the input voltage and the sampling capacitance during each clock cycle, which is then transferred to a second integrating capacitor.\n\nWhen analyzing this circuit, the focus is on charge behavior, with a virtual ground present at the op-amp's negative input. If we assume an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$, it follows that the charge on $\\mathrm{C}_{2}$ equals $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. Simultaneously, as $\\phi_{1}$ is shutting off (and $\\phi_{2}$ is off), the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled, leading to the charge on $\\mathrm{C}_{1}$ equating to $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as represented in Fig. 14.6(a). When $\\phi_{2}$ turns on, its switch prompts $C_{1}$ to discharge by establishing a virtual ground on the top plate of $C_{1}$, as shown in Fig. 14.6(b). The resulting discharging current flows through $\\mathrm{C}_{2}$, thereby adding the charge from $C_{1}$ to the existing charge on $\\mathrm{C}_{2}$. As a positive input voltage results in a negative voltage across $\\mathrm{C}_{2}$ and hence a negative output voltage, the integrator functions as an inverting integrator. At the conclusion of $\\phi_{2}$, once the circuit has stabilized, we can formulate the charge equation.\n\nSubsequent mathematical manipulations and the application of the $\\mathbf{z}$-transform yield the discrete-time relationship and the transfer function, $H(z)$, for the circuit of Fig. 14.5. This transfer function effectively captures the gain coefficient as a ratio of two capacitances, allowing for precise definition within an integrated circuit.\n\nThe analysis also considers the impact of parasitic capacitances, which are illustrated in Fig. 14.8, and their influence on the transfer function. These parasitic capacitances, such as $\\mathrm{C}_{\\mathrm{p} 1}$, $\\mathrm{C}_{\\mathrm{p} 2}$, $\\mathrm{C}_{\\mathrm{p} 3}$, and $\\mathrm{C}_{\\mathrm{p} 4}$, can affect the operation of the integrator, necessitating the development of parasitic-insensitive structures to mitigate their impact."
},
{
    "text": "The original description of Fig. 14.5 depicts a discrete-time integrator with an emphasis on parasitic capacitances. This circuit operates within two distinct clock phases, phi1 and phi2, with M1 and M2 serving as switches governed by these phases. It integrates the input voltage Vci over time to generate the output voltage Vco. A notable characteristic of this integrator is its inversion, where a positive input translates to a negative output voltage.\n\nFig. 14.5 presents a discrete-time integrator that is particularly susceptible to parasitic capacitances, which are not explicitly shown in the diagram. The circuit's operation is divided into two phases, phi1 and phi2. During phi1, M1 is active, charging C1, while during phi2, M2 is active, transferring the charge from C1 to C2. This action integrates the input voltage Vci to produce the output voltage Vco. The integrator is of the inverting type, leading to a negative output voltage.\n\nFig. 14.6 displays the discrete-time integrator circuit during the two clock phases: (a) phi1 and (b) phi2. The image description details the behavior of the circuit components during each phase, emphasizing the charging and discharging actions that lead to the integration of the input signal.\n\nFig. 14.7 presents typical voltage waveforms for the discrete-time integrator. This graph illustrates the operation of the integrator through time-domain waveforms plotted against time (t) on the horizontal axis. The waveforms include clock signals phi1 and phi2, the input voltage vci(t), an intermediate voltage vcx(t), and the output voltage vco(t). The graph highlights the discrete nature of the output due to the sampling action of the clock signals.\n\nThe solution section provides a detailed analysis of the transfer function of the discrete-time integrator, showing how it approximates the transfer function of an ideal continuous-time integrator at frequencies much lower than the sampling frequency. It also accounts for the effects of parasitic capacitances on the circuit's transfer function, leading to the development of parasitic-insensitive structures to mitigate their impact.\n\nThe analysis demonstrates that the discrete-time integrator's transfer function has a pole at z=1 and that the gain coefficient is influenced by the ratio of the capacitances and the clock frequency. It also acknowledges the presence of parasitic capacitances and their effect on the circuit\nThe original description of Fig. 14.5 presents a discrete-time integrator circuit that is sensitive to parasitic capacitances. The circuit operates across two clock phases, phi1 and phi2, with M1 and M2 acting as switches controlled by these clock phases. The input voltage Vci is integrated over time to generate the output voltage Vco. The integrator is of the inverting type, meaning a positive input results in a negative output voltage.\n\nFig. 14.5 showcases a discrete-time integrator sensitive to parasitic capacitances. This circuit functions within two clock phases, phi1 and phi2, where M1 and M2 serve as switches controlled by these phases. The input voltage Vci is integrated over time to produce the output voltage Vco. The integrator is an inverting one, with a positive input leading to a negative output voltage.\n\nFig. 14.6 illustrates the discrete-time integrator circuit during the two clock phases: (a) phi1 and (b) phi2. The image description details the behavior of the circuit components during each phase, emphasizing the charging and discharging actions that lead to the integration of the input signal.\n\nFig. 14.7 depicts typical voltage waveforms for the discrete-time integrator. This graph presents the operation of the integrator through time-domain waveforms plotted against time (t) on the horizontal axis. The waveforms include clock signals phi1 and phi2, the input voltage vci(t), an intermediate voltage vcx(t), and the output voltage vco(t). The graph highlights the discrete nature of the output due to the sampling action of the clock signals.\n\nThe solution section provides a detailed analysis of the transfer function of the discrete-time integrator, demonstrating how it approximates the transfer function of an ideal continuous-time integrator at frequencies much lower than the sampling frequency. It also accounts for the effects of parasitic capacitances on the circuit's transfer function, leading to the development of parasitic-insensitive structures to mitigate their impact.\n\nThe analysis reveals that the discrete-time integrator's transfer function has a pole at z=1 and that the gain coefficient is influenced by the ratio of the capacitances and the clock frequency. It also acknowledges the presence of parasitic capacitances and their effect on the overall circuit behavior, emphasizing the need for parasitic-insensitive designs to ensure accurate and stable operation."
},
{
    "text": "An illustration of an early switched-capacitor discrete-time integrator, as presented by Hosticka in 1977, is depicted in Fig. 14.5. The figure includes an additional switch adjacent to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, indicating that the output signal is valid at the conclusion of $\\phi_{1}$, consistent with the sampling-time convention depicted in Fig. 14.3(a). This implies that any circuit relying on the output from this discrete-time integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. It's important to note that the timing of $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ value changes (whether during $\\phi_{1}$ or $\\phi_{2}$) is irrelevant since $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the depicted circuit.\n\nKey Point: During each clock cycle, a switched-capacitor integrator captures a quantity of charge proportional to the input voltage and the sampling capacitance, subsequently transferring it to a secondary integrating capacitor.\n\nTo examine this circuit, we once again observe the charge behavior and note the emergence of a virtual ground at the opamp's negative input. Assuming an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$ indicates that the charge on $\\mathrm{C}_{2}$ is equivalent to $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. Simultaneously, at time $(n T-T)$, $\\phi_{1}$ is just deactivating (and $\\phi_{2}$ is off), resulting in the sampling of the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$, and thus the charge on $\\mathrm{C}_{1}$ equals $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as depicted in Fig. 14.6(a). When $\\phi_{2}$ becomes active, its switch initiates the discharge of $C_{1}$ by establishing a virtual ground at the top plate of $\\mathrm{C}_{1}$, as shown in Fig. 14.6(b). However, this discharge current must traverse $\\mathrm{C}_{2}$, thereby adding the charge from $\\mathrm{C}_{1}$ to the existing charge on $\\mathrm{C}_{2}$. It's worth noting that a positive input voltage will lead to a negative voltage across $\\mathrm{C}_{2}$, and hence a negative output voltage, confirming that the integrator is an inverting integrator. At the conclusion of $\\phi_{2}$ (once the system stabilizes), we can formulate the charge equation as follows:\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.6}\n\\end{equation*}\n$$\n\nThe negative sign in (14.6) signifies the inverting nature of the integrator. Despite the correctness of (14.6), our objective is to determine the charge on $\\mathrm{C}_{2}$ at the end of $\\phi_{1}$ (or equivalently, nT), as indicated by the switch near $v_{\\mathrm{co}}(\\mathrm{t})$ in Fig. 14.5. Recognizing that once $\\phi_{2}$ is turned off, the charge on $\\mathrm{C}_{2}$ remains constant during the subsequent $\\phi_{1}$ until $\\phi_{2}$ reactivates in the next cycle, we can infer that the charge on $C_{2}$ at time $(n T)$ at the end of the subsequent $\\phi_{1}$ is equivalent to that at time $(n T-T / 2)$, or mathematically:\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2) \\tag{14.7}\n\\end{equation*}\n$$\n\nCombining (14.6) and (14.7) yields:\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.8}\n\\end{equation*}\n$$\n\nDividing by $C_{2}$ and utilizing the discrete-time variables $v_{i}(n)=v_{\\mathrm{ci}}(n T)$ and $v_{0}(n)=v_{c o}(n T)$, we derive the following discrete-time relationship for the circuit in Fig. 14.5:\n\n$$\n\\begin{equation*}\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n-1) \\tag{14.9}\n\\end{equation*}\n$$\n\nApplying the $\\mathbf{z}$-transform to (14.9) results in:\n\n$$\n\\begin{equation*}\nV_{0}(z)=z^{-1} V_{0}(z)-\\frac{C_{1}}{C_{2}} z^{-1} V_{i}(z) \\tag{14.10}\n\\end{equation*}\n$$\n\nFrom which the transfer function, $H(z)$, can be expressed as:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.11}\n\\end{equation*}\n$$\n\nIt's important to note that this transfer function achieves its gain coefficient as a ratio of two capacitances, allowing for precise definition within an integrated circuit. Typically, the transfer function is rewritten to eliminate terms of $z$ with negative powers, resulting in:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.12}\n\\end{equation*}\n$$\n\nFig. 14.7 presents typical voltage waveforms for this discrete-time integrator. It's crucial to understand that the derived discrete-time equation only represents the relationship between the voltage signals $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ and $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ at the time $(\\mathrm{nT})$, which occurs just before the end of $\\phi_{1}$. It does not provide information about the voltages at other times. In reality, the voltages remain constant at other times (disregarding second-order effects), which is analogous to using the sampled voltages as inputs to a sample and hold circuit for this specific SC integrator.\n\nKey Point: The discrete-time transfer function of a switched-capacitor integrator exhibits a pole at $d c, z=1$.\n\n#### EXAMPLE 14.2\n\nDemonstrate that for frequencies significantly lower than the sampling frequency, equation (14.11) approximates the transfer function of an ideal continuous-time integrator.\n\nFig. 14.7 portrays typical voltage waveforms for the discrete-time integrator depicted in Fig. 14.5.\n\n#### Solution\n\nBy rewriting equation (14.11), we obtain:\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{z^{1 / 2}-z^{-1 / 2}} \\tag{14.13}\n\\end{equation*}\n$$\n\nTo determine the frequency response, we leverage the fact that:\n\n$$\n\\begin{equation*}\nz=e^{j \\omega T}=\\cos (\\omega T)+j \\sin (\\omega T) \\tag{14.14}\n\\end{equation*}\n$$\n\nwhere T, the period, corresponds to the inverse of the sampling frequency. Therefore:\n\n$$\n\\begin{equation*}\nz^{1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)+j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.15}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\nz^{-1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)-j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.16}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.13) yields:\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j 2 \\sin \\left(\\frac{\\omega T}{2}\\right)} \\cong-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j \\omega T} \\tag{14.17}\n\\end{equation*}\n$$\n\nfor $\\omega \\mathrm{T}<<1$. The $\\mathrm{z}^{-1 / 2}$ in the numerator signifies a simple delay and can be disregarded. Consequently, we observe that the transfer function approximates that of a continuous-time integrator with a gain constant of:\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{\\mathrm{I}} \\cong-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2} \\mathrm{~T}}\\right) \\tag{14.18}\n\\end{equation*}\n$$\n\nThis gain constant is a function of the integrator capacitor ratio and the clock frequency alone.\n\nThus far, we have neglected the impact of parasitic capacitances stemming from the creation of $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$, as well as the nonlinear capacitances associated with the switches. Incorporating these parasitic capacitances leads to the circuit depicted in Fig. 14.8. Here, $\\mathrm{C}_{\\mathrm{p} 1}$ represents the parasitic capacitance of the top plate of $\\mathrm{C}_{1}$, along with the nonlinear capacitances associated with the two switches; $\\mathrm{C}_{\\mathrm{p} 2}$ represents the parasitic capacitance of the bottom plate of $\\mathrm{C}_{1}$; while $\\mathrm{C}_{\\mathrm{p} 3}$ accounts for the parasitic capacitance associated with the top plate of $\\mathrm{C}_{2}$, the input capacitance of the opamp, and that of the $\\phi_{2}$ switch. Finally, $\\mathrm{C}_{\\mathrm{p} 4}$ encompasses the bottom-plate parasitic capacitance of $\\mathrm{C}_{2}$, as well as any additional capacitance the opamp output must drive.\n\nConsidering these parasitic capacitances, we can immediately dismiss the effect of $\\mathrm{C}_{\\mathrm{p} 2}$ since it remains constantly connected to ground. Similarly, the impact of $\\mathrm{C}_{\\mathrm{p} 3}$ on the transfer function is negligible due to its constant connection to the virtual ground of the opamp. Additionally, $\\mathrm{C}_{\\mathrm{p} 4}$, being connected to the opamp output, may influence the opamp's speed but does not affect the final settling point of the opamp output. Finally, we note that $C_{p 1}$ is in parallel with $C_{1}$, leading to the following transfer function for the discrete-time integrator, including the effects of parasitic capacitance:\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}+C_{p 1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.19}\n\\end{equation*}\n$$\n\nEquation (14.19) reveals that the gain coefficient is related to the parasitic coefficient $\\mathrm{C}_{\\mathrm{pl}}$, which is not well-controlled and is partially nonlinear due to the input capacitances of the switches and the top-plate parasitic capacitance. To address this limitation, innovative circuits known as parasitic-insensitive structures were developed [Martin, 1978; Allstot, 1978; Jacobs, 1978]."
},
{
    "text": "The first switched-capacitor discrete-time integrator example [Hosticka, 1977] is depicted in Fig. 14.5. The figure illustrates an additional switch adjacent to the output voltage, $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$, signifying that the output signal is valid at the conclusion of $\\phi_{1}$, consistent with the sampling-time convention depicted in Fig. 14.3(a). This implies that any circuit utilizing the output of this discrete-time integrator should sample $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ during $\\phi_{1}$. However, no assumptions are made regarding when $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ alters its value (it could be during $\\phi_{1}$ or $\\phi_{2}$); this is irrelevant because $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ is sampled at the end of $\\phi_{1}$ in the circuit depicted.\n\nKey Point: During each clock cycle, a switched-capacitor integrator samples a quantity of charge proportional to an input voltage and the sampling capacitance, subsequently transferring it to a second integrating capacitor.\n\nTo analyze this circuit, we once again examine the charge behavior and observe the presence of a virtual ground at the opamp's negative input. Assuming an initial integrator output voltage of $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})$ implies that the charge on $\\mathrm{C}_{2}$ is equal to $\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(n T-T)$ at time $(n T-T)$. Also, at time $(n T-T)$, $\\phi_{1}$ is just turning off (and $\\phi_{2}$ is off), causing the input signal $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ to be sampled, resulting in the charge on $\\mathrm{C}_{1}$ being equal to $\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T})$, as shown in Fig. 14.6(a). When $\\phi_{2}$ goes high, its switch forces $C_{1}$ to discharge by creating a virtual ground on the top plate of $\\mathrm{C}_{1}$, as depicted in Fig. 14.6(b). This discharging current must flow through $\\mathrm{C}_{2}$, thereby adding the charge on $\\mathrm{C}_{1}$ to the charge already present on $\\mathrm{C}_{2}$. Note that a positive input voltage will result in a negative voltage across $\\mathrm{C}_{2}$ and, consequently, a negative output voltage; hence, the integrator is an inverting integrator. At the end of $\\phi_{2}$ (once things have settled), we can write the charge equation,\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.6}\n\\end{equation*}\n$$\n\nThe negative sign in (14.6) signifies that the integrator is an inverting integrator.\nAlthough (14.6) is correct, we aim to determine the charge on $\\mathrm{C}_{2}$ at the end of $\\phi_{1}$ (or equivalently, nT) as indicated by the switch shown near $v_{\\mathrm{co}}(\\mathrm{t})$ in Fig. 14.5. To find this charge, we note that once $\\phi_{2}$ turns off, the charge on $\\mathrm{C}_{2}$ will remain constant during the next $\\phi_{1}$ until $\\phi_{2}$ turns on again in its next cycle. Therefore, the charge on $C_{2}$ at time $(n T)$ at the end of the next $\\phi_{1}$ is equal to that at time ($n T-T / 2$), or mathematically,\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2) \\tag{14.7}\n\\end{equation*}\n$$\n\nBy combining (14.6) and (14.7), we can write\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT})=\\mathrm{C}_{2} \\mathrm{v}_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T})-\\mathrm{C}_{1} \\mathrm{v}_{\\mathrm{ci}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.8}\n\\end{equation*}\n$$\n\nDividing by $C_{2}$ and using the discrete-time variables $v_{i}(n)=v_{\\mathrm{ci}}(n T)$ and $v_{0}(n)=v_{c o}(n T)$, we obtain the following discrete-time relationship for the circuit of Fig. 14.5:\n\n$$\n\\begin{equation*}\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n-1) \\tag{14.9}\n\\end{equation*}\n$$\n\nTaking the $\\mathbf{z}$-transform of (14.9), we also have\n\n$$\n\\begin{equation*}\nV_{0}(z)=z^{-1} V_{0}(z)-\\frac{C_{1}}{C_{2}} z^{-1} V_{i}(z) \\tag{14.10}\n\\end{equation*}\n$$\n\nfrom which we can finally determine the transfer function, $H(z)$, as\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.11}\n\\end{equation*}\n$$\n\nIt is important to note that this transfer function realizes its gain coefficient as a ratio of two capacitances, allowing for accurate definition in an integrated circuit. Often, the transfer function is rewritten to eliminate terms of $z$ with negative powers, resulting in\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.12}\n\\end{equation*}\n$$\n\nFig. 14.7 displays typical voltage waveforms for this discrete-time integrator. It is crucial to understand that the discrete-time equation derived only represents the relationship of the voltage signals $\\mathrm{v}_{\\mathrm{ci}}(\\mathrm{t})$ and $\\mathrm{v}_{\\mathrm{co}}(\\mathrm{t})$ at the time $(\\mathrm{nT})$, which occurs just before the end of $\\phi_{1}$. It does not provide information about the voltages at other times. In reality, the voltages remain constant at other times (ignoring second-order effects), which is analogous to using the sampled voltages as inputs to a sample and hold for this particular SC integrator.\n\nKey Point: The discrete-time transfer function of a switched-capacitor integrator possesses a pole at $d c, z=1$.\n\n#### EXAMPLE 14.2\n\nShow that for frequencies much lower than the sampling frequency, equation (14.11) approximates the transfer function of an ideal continuous-time integrator.\n\nFig. 14.7 depicts typical voltage waveforms for the discrete-time integrator shown in Fig. 14.5.\n\n#### Solution\n\nEquation (14.11) can be rewritten as\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{z^{1 / 2}-z^{-1 / 2}} \\tag{14.13}\n\\end{equation*}\n$$\n\nTo find the frequency response, we utilize the fact that\n\n$$\n\\begin{equation*}\nz=e^{j \\omega T}=\\cos (\\omega T)+j \\sin (\\omega T) \\tag{14.14}\n\\end{equation*}\n$$\n\nwhere T, the period, is one over the sampling frequency. Therefore,\n\n$$\n\\begin{equation*}\nz^{1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)+j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.15}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\nz^{-1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)-j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.16}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.13) gives\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j 2 \\sin \\left(\\frac{\\omega T}{2}\\right)} \\cong-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1 / 2}}{j \\omega T} \\tag{14.17}\n\\end{equation*}\n$$\n\nfor $\\omega \\mathrm{T}<<1$. The $\\mathrm{z}^{-1 / 2}$ in the numerator represents a simple delay and can be ignored. Thus, we observe that the transfer function is approximately that of a continuous-time integrator having a gain constant of\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{\\mathrm{I}} \\cong-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2} \\mathrm{~T}}\\right) \\tag{14.18}\n\\end{equation*}\n$$\n\nwhich is a function of the integrator capacitor ratio and clock frequency only.\n\nSo far, we have disregarded the impact of parasitic capacitances resulting from the creation of $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$, as well as the nonlinear capacitances associated with the switches. Incorporating these parasitic capacitances leads to the circuit shown in Fig. 14.8. Here, $\\mathrm{C}_{\\mathrm{p} 1}$ represents the parasitic capacitance of the top plate of $\\mathrm{C}_{1}$ and the nonlinear capacitances associated with the two switches; $\\mathrm{C}_{\\mathrm{p} 2}$ represents the parasitic capacitance of the bottom plate of $\\mathrm{C}_{1}$; $\\mathrm{C}_{\\mathrm{p} 3}$ represents the parasitic capacitance associated with the top plate of $\\mathrm{C}_{2}$, the input capacitance of the opamp, and that of the $\\phi_{2}$ switch. Finally, $\\mathrm{C}_{\\mathrm{p} 4}$ accounts for the bottom-plate parasitic capacitance of $\\mathrm{C}_{2}$ and any additional capacitance that the opamp output must drive.\n\nIn considering these parasitic capacitances, we can immediately disregard the effect of $\\mathrm{C}_{\\mathrm{p} 2}$ since it is always connected to ground. Similarly, the effect of $\\mathrm{C}_{\\mathrm{p} 3}$ on the transfer function is minimal since it is always connected to the virtual ground of the opamp. Additionally, $\\mathrm{C}_{\\mathrm{p} 4}$ is connected to the opamp output; therefore, although it may affect the speed of the opamp, it would not impact the final settling point of the opamp output. Finally, we note that $C_{p 1}$ is in parallel with $C_{1}$, and thus the transfer function of this discrete-time integrator, including the effects of parasitic capacitance, is given by\n\n$$\n\\begin{equation*}\nH(z)=-\\left(\\frac{C_{1}+C_{p 1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.19}\n\\end{equation*}\n$$\n\nFrom (14.19), we see that the gain coefficient is related to the parasitic coefficient $\\mathrm{C}_{\\mathrm{pl}}$, which is not well controlled and would be partially nonlinear due to the input capacitances of the switches and top-plate parasitic capacitance. To address this limitation, innovative circuits known as parasitic-insensitive structures were developed [Martin, 1978; Allstot, 1978; Jacobs, 1978]."
},
{
    "text": "The development of parasitic-insensitive integrators was pivotal for achieving high-precision integrated circuits. Early on, noninverting integrators, such as the one depicted in Fig. 14.9, demonstrated resistance to parasitic effects, whereas inverting integrators, as shown in Fig. 14.8, were susceptible [Allstot, 1978]. \n\nFig. 14.9 presents a noninverting discrete-time integrator that remains unaffected by parasitic capacitances. It functions across two clock phases, ϕ1 and ϕ2, with input and output voltages denoted as vi(n) and vo(n), respectively.\n\nIn contrast, the development of parasitic-insensitive inverting integrators [Martin, 1978; Jacobs, 1978] rendered the entire filter resistant to parasitics, significantly reducing second-order errors. The implementation of a parasitic-insensitive discrete-time integrator involves the use of two additional switches, as illustrated in Fig. 14.9. During\nThe parasitic-insensitive integrator was a key\nThe parasitic-insensitive integrator was a pivotal that enabled the creation of high-precision integrated circuits. In advancement\nThe parasitic-insensitive integrator was a breakthrough innovation that paved the way for high creation of highly-precision integrated circuits. This development was particularly significant in the context of earlyator-based filters, where non initial noninverting integrators (referenced Fig. 14.9) exhibited ins to parasitic effects, whereas the inverting integrators (refer to Fig. 14.8) were susceptible sensitive toAllstot, 1978]. \n\n introductioninverting integrator shown in Fig. 14.9 operates on two clock phases, ϕ1 and ϕ2, and features\nThe parasitic-insensitive integrator was a pivotal\nThe parasitic-insensitive integrator was a pivotal advancement\nThe parasitic-insensitive integrator was a key\nThe parasitic-insensitive integrator was a seminal advancement\nThe parasitic-insensitive integrator was a critical\nThe parasitic-insensitive integrator was a crucial innovation in facilitated\nThe parasitic-insensitive integrator was a critical\nThe parasitic-insensitive integrator was a"
},
{
    "text": "The realization of high-accuracy integrated circuits was significantly advanced by the creation of the parasitic-insensitive integrator. In early integrator-based filter designs, noninverting integrators (Fig. 14.9) demonstrated immunity to parasitic effects, while inverting integrators (Fig. 14.8) remained susceptible [Allstot, 1978]. \n\nThe circuit represented in Fig. 14.9 is a noninverting, discrete-time integrator designed to be impervious to parasitic capacitances. It operates across two clock phases, ϕ1 and ϕ2, with corresponding input and output voltages denoted as vi(n) and vo(n).\n\nFig. 14.9 presents a noninverting, discrete-time integrator resilient to parasitic capacitances, featuring operation across two clock phases: ϕ1 and ϕ2, with input and output voltages labeled vi(n) and vo(n), respectively.\n\nThe subsequent development of a parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] led to filters that were completely insensitive to parasitic effects, substantially reducing second-order errors. This was achieved by incorporating two additional switches, as depicted in Fig. 14.9. During the ϕ1 phase, C1 charges to C1vci(nT-T), as shown in Fig. 14.10(a). When ϕ2 is active, C1's connection is effectively reversed, causing discharge through what was the ground node rather than the input signal side, as depicted in Fig. 14.10(b). This reversed connection leads to vco(t) increasing for a positive vci(nT-T), rendering the integrator noninverting. The transfer function, H(z), for this discrete-time integrator is expressed as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nThis transfer function corresponds to a positive discrete-time integrator with a full delay from input to output, hence the circuit in Fig. 14.9 is termed a delaying discrete-time integrator. The transfer function is often rewritten to eliminate negative powers of z, resulting in:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nInvestigating the impact of parasitic capacitances on this noninverting integrator involves examining the circuit with parasitic capacitances included, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not impact the circuit's operation. Cp2 is either connected to ground via the ϕ1 switch or to virtual ground through the ϕ2 switch, ensuring it remains discharged and does not affect the circuit. Cp1 is continuously charged to vi(n) and discharged to ground. However, during ϕ1, the simultaneous charging of Cp1 to vi(n-1) does not interfere with the charge on C1. During ϕ2, Cp1 is discharged through the ϕ2 switch without affecting the charge accumulation on C2. Thus, parasitic capacitances may prolong the settling time but do not alter the discrete-time difference equation within the integrator of Fig. 14.9.\n\nTo create an inverting, parasitic-insensitive discrete-time integrator, the same circuit as the noninverting version can be utilized, but with the switch phases near the opamp input side of C1 interchanged, as shown in Fig. 14.12 [Martin, 1978]. This configuration ensures that the charge on C2 remains unchanged when ϕ2 is on and ϕ1 is off. The charge on C1 is fully discharged at the end of ϕ2, and when ϕ1 is activated, C1 charges up to vci(t). However, the current required to charge C1 passes through C2, effectively altering its charge. At the end of ϕ1, the remaining charge on C2 equals its original charge minus the charge needed to charge C1 to vci(nT). This leads to the following charge relationship:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT})=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)-C_{1} v_{\\mathrm{ci}}(\\mathrm{nT}) \\tag{14.23}\n$$\n\nThe transfer function, H(z), for this delay-free integrator is found to be:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{1-z^{-1}} \\tag{14.25}\n$$\n\nThe differing gains of the delaying and delay-free integrators—positive and negative, respectively—can be advantageous in single-ended switched-capacitor designs. However, modern integrated circuits often employ fully differential signals for superior noise performance, where sign changes can be achieved through output wire cross-coupling. Therefore, when implemented differentially, the circuits in Figs. 14.9 or 14.12 can realize either positive or negative gain, making it more precise to refer to Fig. 14.9 as a delayed integrator and Fig. 14.12 as a delay-free integrator.\n\nFig. 14.14 illustrates a three-input switched capacitor summing/integrator stage. The circuit integrates the summed signal from inputs V1(z), V2(z), and V3(z) using capacitors C1, C2, C3, and CA, with amplification provided by op-amp A1. The system block diagram in Fig. 14.14(b) represents this stage as a signal-flow graph, simplifying the representation of the circuit's signal processing."
},
{
    "text": "The parasitic-insensitive integrator played a crucial role in enabling the creation of high-accuracy integrated circuits. In the initial integrator-based filters, noninverting integrators (Fig. 14.9) were immune to parasitic effects, whereas inverting integrators (Fig. 14.8) were susceptible to them [Allstot, 1978]. The circuit in Fig. 14.9 is a noninverting delaying discrete-time integrator that is not affected by parasitic capacitances. It operates using two clock phases, ϕ1 and ϕ2, with input and output voltages denoted as vi(n) and vo(n), respectively.\n\nFig. 14.9 illustrates a noninverting delaying discrete-time integrator that is insensitive to parasitic capacitances. The circuit operates on two clock phases, ϕ1 and ϕ2, with input and output voltages represented as vi(n) and vo(n), respectively.\n\nThe development of the parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] allowed the entire filter to become insensitive to parasitic effects, significantly reducing second-order errors. To achieve a parasitic-insensitive discrete-time integrator, two additional switches are utilized, as depicted in Fig. 14.9. Analyzing this circuit, when ϕ1 is active, C1 is charged to C1vci(nT-T), as shown in Fig. 14.10(a). When ϕ2 is activated, C1 is effectively connected in reverse, and the discharge occurs through what was previously the ground node rather than the input signal side, as shown in Fig. 14.10(b). This reverse connection causes vco(t) to increase for a positive vci(nT-T), resulting in a noninverting integrator. The transfer function, H(z), for this discrete-time integrator is given as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nEquation (14.20) represents a positive discrete-time integrator with a full delay from input to output (due to the z^{-1} in the numerator, which signifies a one-period delay), so we refer to the circuit in Fig. 14.9 as a delaying discrete-time integrator. Similar to the parasitic sensitive inverting integrator in Fig. 14.8, the transfer function is often rewritten to eliminate negative powers of z, resulting in:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nTo analyze the behavior of this noninverting integrator with respect to parasitic capacitances, consider the same circuit with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not impact the circuit's operation. Additionally, Cp2 is either connected to ground through the ϕ1 switch or to virtual ground through the ϕ2 switch. Therefore, since Cp2 always remains discharged (after settling), it also does not affect the circuit's operation. Finally, Cp1 is continuously being charged to vi(n) and discharged to ground. However, during ϕ1, the fact that Cp1 is also charged to vi(n-1) does not affect the charge placed on C1. When ϕ2 is activated, Cp1 is discharged through the ϕ2 switch attached to its node, and none of its discharging current passes through C1 to affect the charge accumulating on C2. Hence, it also does not affect the circuit's operation. In summary, while parasitic capacitances may slow down settling time behavior, they do not affect the discrete-time difference equation in the integrator shown in Fig. 14.9.\n\nTo create an inverting discrete-time integrator that is also parasitic insensitive, the same circuit as the parasitic-insensitive noninverting integrator can be used, but with the two switch phases near the opamp input side of C1 (i.e., the top-plate of C1) interchanged, as shown in Fig. 14.12 [Martin, 1978]. With this configuration, note that the charge on C2 does not change when ϕ2 is activated (and ϕ1 is off) as illustrated in Fig. 14.13(b). Therefore, we can write:\n\n$$\nC_{2} v_{co}(nT-T/2)=C_{2} v_{co}(nT-T) \\tag{14.22}\n$$\n\nAdditionally, note that C1 is fully discharged at the end of ϕ2. When ϕ1 is activated in Fig. 14.13(a), C1 is charged up to vci(t). However, the current required to charge C1 passes through C2, effectively changing the charge on C2 by that amount. At the end of ϕ1, the charge remaining on C2 is equal to its previous charge (before ϕ1 was on) subtracted from the charge needed to charge up C1 to vci(nT). Thus, we have the following charge relationship:\n\n$$\nC_{2} v_{co}(nT)=C_{2} v_{co}(nT-T/2)-C_{1} v_{ci}(nT) \\tag{14.23}\n$$\n\nNote that vci(nT) appears in the preceding equation instead of vci(nT-T) since the charge on C2 at the end of ϕ1 is related to the value of vci(nT) at the same time, and thus the integrator is considered to be delay free. Substituting in (14.22), dividing by C2, and switching to discrete-time variables, we obtain:\n\n$$\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n) \\tag{14.24}\n$$\n\nTaking the z-transform of both sides, the transfer function, H(z), for this delay-free integrator is found to be:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{1-z^{-1}} \\tag{14.25}\n$$\n\nwhere the purely real term in the numerator indicates the integrator being delay free. As before, (14.25) is often rewritten as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z}{z-1} \\tag{14.26}\n$$\n\nKey Point: Both delayed and delay-free integrators can be realized with the same switched-capacitor circuit by altering the clock phases applied to two of the switches. In a fully-differential implementation, both can be configured to provide either positive or negative dc gain.\n\nFinally, note that the preceding delay-free integrator has a negative gain, while the delaying integrator has a positive gain. While these sign changes in gain can be quite useful in single-ended switched-capacitor designs, most modern integrated circuits employ fully differential signals for improved noise performance, and sign changes can be achieved by simply cross-coupling output wires. Thus, either of the circuits in Figs. 14.9 or 14.12, when implemented fully differentially, may be used to realize either a positive or negative gain. It is more specific to refer to Fig. 14.9 as a delayed integrator and Fig. 14.12 as a delay-free integrator.\n\nFig. 14.14 depicts a three-input switched capacitor summing/integrator stage. (a) Circuit. (b) Equivalent signal-flow graph."
},
{
    "text": "The parasitic-insensitive integrator was a pivotal innovation that facilitated the creation of high-precision integrated circuits. In the initial integrator-based filters, the noninverting integrators (Fig. 14.9) were resilient to parasitic effects, whereas the inverting integrators (Fig. 14.8) were susceptible [Allstot, 1978]. \n\nFig. 14.9 depicts a noninverting delaying discrete-time integrator that remains unaffected by parasitic capacitances. It operates using two clock phases, ϕ1 and ϕ2, with input and output voltages denoted as vi(n) and vo(n), respectively.\n\nThe development of the parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] rendered the entire filter impervious to parasitic effects, significantly reducing second-order errors. To achieve a parasitic-insensitive discrete-time integrator, two additional switches are employed, as illustrated in Fig. 14.9. Analyzing this circuit as previously done, observe that when ϕ1 is active, C1 is charged to C1vci(nT-T), as shown in Fig. 14.10(a). When ϕ2 is activated, C1 is effectively reversed, and the discharge now occurs through what was the ground node instead of the input signal side, as depicted in Fig. 14.10(b). This reverse connection causes vco(t) to rise for a positive vci(nT-T), thereby rendering the integrator noninverting. The transfer function, H(z), for this discrete-time integrator is given as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nNote that (14.20) represents a positive discrete-time integrator with a complete delay from input to output (due to the z^-1 in the numerator, which signifies a one-period delay), hence we refer to the circuit of Fig. 14.9 as a delaying discrete-time integrator. Similar to the parasitic sensitive inverting integrator of Fig. 14.8, one often rewrites the transfer function to eliminate negative powers of z, resulting in:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nTo examine the behavior of this noninverting integrator concerning parasitic capacitances, consider the same circuit depicted with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not impact the circuit's operation as before. Additionally, Cp2 is either connected to ground via the ϕ1 switch or to virtual ground through the ϕ2 switch. Therefore\nThe development\nThe developmentitic-insensitive integrator was a pivotal innovation that facilitated the creation of high-precision integrated circuits. In the initial integrator-based filters, the noninverting integrators (Fig. 14.9) were resilient to parasitic effects, whereas the inverting integrators (Fig. 14.8) were susceptible [Allstot, 1978]. \n\nFig. 14.9 depicts a noninverting delaying discrete-time integrator that remains unaffected by parasitic capacitances. It operates using two clock phases, ϕ1 and ϕ2, with input and output voltages denoted as vi(n) and vo(n), respectively.\n\nThe development of the parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] rendered the entire filter impervious to parasitic effects, significantly reducing second-order errors. To achieve a parasitic-insensitive discrete-time integrator, two additional switches are employed, as illustrated in Fig. 14.9. Analyzing this circuit as previously done, observe that when ϕ1 is active, C1 is charged to C1vci(nT-T), as shown in Fig. 14.10(a). When ϕ2 is activated, C1 is effectively reversed, and the discharge now occurs through what was the ground node instead of the input signal side, as depicted in Fig. 14.10(b). This reverse connection causes vco(t) to rise for a positive vci(nT-T), thereby rendering the integrator noninverting. The transfer function, H(z), for this discrete-time integrator is given as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nNote that (14.20) represents a positive discrete-time integrator with a complete delay from input to output (due to the z^-1 in the numerator, which signifies a one-period delay), hence we refer to the circuit of Fig. 14.9 as a delaying discrete-time integrator. Similar to the parasitic sensitive inverting integrator of Fig. 14.8, one often rewrites the transfer function to eliminate negative powers of z, resulting in:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nTo examine the behavior of this noninverting integrator concerning parasitic capacitances, consider the same circuit depicted with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not impact the circuit's operation as before. Additionally, Cp2 is either connected to ground through the ϕ1 switch or to virtual ground through the ϕ2 switch. Therefore, since Cp2 always remains discharged (after settling), it also does not affect the circuit's operation. Finally, Cp1 is continuously being charged to vi(n) and discharged to ground. However, during ϕ1 on, the fact that Cp1 is also charged to vi(n-1) does not affect the charge that is placed on C1. When ϕ2 is turned on, Cp1 is discharged through the ϕ2 switch attached to its node, and none of its discharging current passes through C1 to affect the charge accumulating on C2. Therefore, it also does not affect the circuit operation. In summary, while the parasitic capacitances may slow down settling time behavior, they do not affect the discrete-time difference equation that occurs in the integrator shown in Fig. 14.9.\n\nTo obtain an inverting discrete-time integrator that is also parasitic insensitive, the same circuit as the parasitic-insensitive noninverting integrator can be used, but with the two switch phases on the switches near the opamp input side of C1 (that is, the top-plate of C1) interchanged as shown in Fig. 14.12 [Martin, 1978]. With this arrangement, observe that the charge on C2 does not change when ϕ2 turns on (and ϕ1 is off) as illustrated in Fig. 14.13(b). Therefore, we can write:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.22}\n$$\n\nAlso, note that C1 is fully discharged at the end of ϕ2 on. Now when ϕ1 is turned on in Fig. 14.13(a), C1 is charged up to vci(t). However, the current needed to charge C1 passes through C2, effectively changing the charge on C2 by that amount. At the end of ϕ1 on, the charge left on C2 is equal to its old charge (before ϕ1 was on) subtracted from the charge needed to charge up C1 to vci(nT). Thus, we have the following charge relationship:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT})=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)-C_{1} v_{\\mathrm{ci}}(\\mathrm{nT}) \\tag{14.23}\n$$\n\nNote that vci(nT) appears in the preceding equation rather than vci(nT-T), since the charge on C2 at the end of ϕ1 is related to the value of vci(nT) at the same time, and therefore the integrator is considered to be delay free. Substituting in (14.22), dividing by C2, and switching to discrete-time variables, we have:\n\n$$\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n) \\tag{14.24}\n$$\n\nTaking the z-transform of both sides, the transfer function, H(z), for this delay-free integrator is found to be:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{1-z^{-1}} \\tag{14.25}\n$$\n\nwhere the fact that the numerator has a purely real term is indicative of the integrator being delay free. As before, (14.25) is often rewritten as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z}{z-1} \\tag{14.26}\n$$\n\nKey Point: Both delayed and delay-free integrators can be realized with the same switched-capacitor circuit by altering the clock phases applied to two of the switches. In a fully-differential implementation, both can be configured to provide either positive or negative dc gain.\n\nFinally, note that the preceding delay-free integrator has a negative gain, while the delaying integrator has a positive gain. While these sign changes in the gain can be quite useful in single-ended switched-capacitor designs, most modern integrated circuits make use of fully differential signals for improved noise performance, and sign changes can be achieved by simply cross-coupling output wires. Hence, either of the circuits in Figs. 14.9 or 14.12, when implemented fully differentially, may be used to realize either a positive or negative gain. It is therefore more specific to refer to Fig. 14.9 as a delayed integrator and Fig. 14.12 as a delay-free integrator.\n\nFig. 14.14 represents a three-input switched capacitor summing/integrator stage. It combines inputs V1(z), V2(z), and V3(z) through capacitors C1, C2, and C3, and integrates the summed signal using capacitor CA and op-amp A1. The system block diagram in Fig. 14.14(b) depicts a three-input switched capacitor summing/integrator stage, represented as a signal-flow graph. This diagram provides a simplified representation of the circuit's signal processing."
},
{
    "text": "The development of the parasitic-insensitive integrator was a pivotal achievement, enabling the creation of high-precision integrated circuits. Early integrator-based filters utilized noninverting integrators (Fig. 14.9), which were insensitive to parasitic effects, while the inverting integrators (Fig. 14.8) were susceptible to such effects [Allstot, 1978]. \n\nThe noninverting discrete-time integrator depicted in Fig. 14.9 operates on two clock phases, ϕ1 and ϕ2, with input and output voltages denoted as vi(n) and vo(n), respectively. This circuit is insensitive to parasitic capacitances. Fig. 14.10 illustrates the integrator on the two clock phases: (a) ϕ1 and (b) ϕ2.\n\nThe advancement of the parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] led to the creation of filters that were completely insensitive to parasitic effects, significantly reducing second-order errors. To implement a parasitic-insensitive discrete-time integrator, two additional switches are employed, as depicted in Fig. 14.9. \n\nAnalyzing this circuit, it is observed that when ϕ1 is activated, C1 is charged to C1vci(nT-T), as shown in Fig. 14.10(a). When ϕ2 is activated, C1 is effectively connected in reverse, causing the discharge to occur through what was previously the ground node rather than the input signal side, as depicted in Fig. 14.10(b). This reverse connection results in vco(t) increasing for a positive vci(nT-T), making the integrator noninverting. \n\nThe transfer function, H(z), for this discrete-time integrator is given as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nEquation (14.20) represents a positive discrete-time integrator with a full delay from input to output (due to the z^{-1} in the numerator, which signifies a one-period delay). Therefore, the circuit in Fig. 14.9 is referred to as a delaying discrete-time integrator. As done for the parasitic sensitive inverting integrator in Fig. 14.8, the transfer function is often rewritten to eliminate negative powers of z, resulting in:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nTo study the impact of parasitic capacitances on this noninverting integrator, consider the same circuit with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not affect the circuit's operation. Additionally, Cp2 is either connected to ground through the ϕ1 switch or to virtual ground through the ϕ2 switch. Consequently, since Cp2 always remains discharged (after settling), it also does not affect the circuit's operation. Finally, Cp1 is continuously charged to vi(n) and discharged to ground. However, during ϕ1 activation, the fact that Cp1 is also charged to vi(n-1) does not affect the charge placed on C1. When ϕ2 is activated, Cp1 is discharged through the ϕ2 switch connected to its node, and none of its discharging current passes through C1 to impact the charge accumulating on C2. Therefore, it also does not affect the circuit operation. In summary, while parasitic capacitances may slow down the settling time behavior, they do not affect the discrete-time difference equation that occurs in the integrator shown in Fig. 14.9.\n\nTo obtain an inverting discrete-time integrator that is also parasitic insensitive, the same circuit as the parasitic-insensitive noninverting integrator can be utilized, but with the two switch phases on the switches near the opamp input side of C1 (i.e., the top-plate of C1) interchanged, as shown in Fig. 14.12 [Martin, 1978]. With this arrangement, it is observed that the charge on C2 does not change when ϕ2 is activated (and ϕ1 is deactivated), as illustrated in Fig. 14.13(b). Therefore, we can write:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.22}\n$$\n\nIt is also noted that C1 is fully discharged at the end of ϕ2 activation. Now, when ϕ1 is activated in Fig. 14.13(a), C1 is charged up to vci(t). However, the current required to charge C1 passes through C2, effectively changing the charge on C2 by that amount. At the end of ϕ1 activation, the charge remaining on C2 is equal to its previous charge (before ϕ1 was activated) subtracted from the charge needed to charge up C1 to vci(nT). Thus, we have the following charge relationship:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT})=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)-C_{1} v_{\\mathrm{ci}}(\\mathrm{nT}) \\tag{14.23}\n$$\n\nIt is important to note that vci(nT) appears in the preceding equation rather than vci(nT-T) because the charge on C2 at the end of ϕ1 is related to the value of vci(nT) at the same time, making the integrator delay-free. Substituting in (14.22), dividing by C2, and switching to discrete-time variables, we obtain:\n\n$$\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n) \\tag{14.24}\n$$\n\nTaking the z-transform of both sides, the transfer function, H(z), for this delay-free integrator is found to be:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{1-z^{-1}} \\tag{14.25}\n$$\n\nThe purely real term in the numerator indicates that the integrator is delay-free. As before, (14.25) is often rewritten as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z}{z-1} \\tag{14.26}\n$$\n\nKey Point: Both delayed and delay-free integrators can be realized with the same switched-capacitor circuit by altering the clock phases applied to two of the switches. In a fully-differential implementation, both can be configured to provide either positive or negative dc gain.\n\nIt is important to note that the preceding delay-free integrator has a negative gain, while the delaying integrator has a positive gain. While these sign changes in the gain can be quite useful in single-ended switched-capacitor designs, most modern integrated circuits utilize fully differential signals for improved noise performance, and sign changes can be achieved by simply cross-coupling output wires. Therefore, either of the circuits in Figs. 14.9 or 14.12, when implemented fully differentially, may be used to realize either a positive or negative gain. It is more appropriate to refer to Fig. 14.9 as a delayed integrator and Fig. 14.12 as a delay-free integrator.\n\nThe circuit in Fig. 14.14(a) represents a three-input switched capacitor summing/integrator stage. It combines inputs V1(z), V2(z), and V3(z) through capacitors C1, C2, and C3, and integrates the summed signal using capacitor CA and op-amp A1. The system block diagram in Fig. 14.14(b) represents a three-input switched capacitor summing/integrator stage, depicted as a signal-flow graph. This diagram provides a simplified representation of the circuit's signal processing.\n\n1. **Main Components:**\n   - **Input Nodes:** There are three input signals labeled as \\( V_1(z) \\), \\( V_2(z) \\), and \\( V_3(z) \\).\n   - **Summation Junction:** The inputs are fed into a summation block, where they are weighted and summed.\n   - **Transfer Function Block:** The summed signal is then processed by a transfer function block, which applies a specific transfer function to the input sum.\n   - **Output Node:** The output of the transfer function block is \\( V_o(z) \\), representing the system's output signal.\n\n2. **Flow of Information or Control:**\n   - The input signals \\( V_1(z) \\), \\( V_2(z) \\), and \\( V_3(z) \\) are each multiplied by specific coefficients before entering the summation block. These coefficients are \\(-C_1(1 - z^{-1})\\) for \\( V_1(z) \\), \\( C_2z^{-1} \\) for \\( V_2(z) \\), and \\(-C_3\\) for \\( V_3(z) \\).\n   - The summation block combines these weighted inputs into a single signal.\n   - The combined signal is then fed into a transfer function block characterized by \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), which integrates the input based on the given transfer function.\n\n3. **Labels, Annotations, and Key Indicators:**\n   - Input signals are clearly labeled with \\( V_1(z) \\), \\( V_2(z) \\), and \\( V_3(z) \\).\n   - Coefficients \\(-C_1(1 - z^{-1})\\), \\( C_2z^{-1} \\), and \\(-C_3\\) indicate the weighting applied to each input.\n   - The transfer function \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\) is annotated within the block, defining the system's integration and scaling behavior.\n\n4. **Overall System Function:**\n   - The primary function of this system is to sum the three input signals with specific weightings and then integrate the result. The integration is accomplished through the transfer function block, which effectively accumulates the input over time, producing the output \\( V_o(z) \\). This design allows for flexible signal processing, combining multiple inputs into a single integrated output, useful in applications requiring signal summation and integration.\n\nFig. 14.14 Three-input switched capacitor summing/integrator stage. (a) Circuit. (b) Equivalent signal-flow-graph."
},
{
    "text": "The parasitic-insensitive integrator represented a pivotal breakthrough, enabling the production of high-accuracy integrated circuits. Among the first integrator-based filters, noninverting integrators, depicted in Fig. 14.9, were resilient to parasitic effects, in contrast to the inverting integrators, shown in Fig. 14.8, which were susceptible to such disturbances, as noted by Allstot in 1978.\n\nFig. 14.9 illustrates a noninverting delaying discrete-time integrator with immunity to parasitic capacitances. The circuit functions across two clock phases, ϕ1 and ϕ2, processing input and output voltages denoted as vi(n) and vo(n), respectively.\n\nThe advent of the parasitic-insensitive inverting integrator, as detailed by Martin and Jacobs in 1978, ensured the entire filter's resilience to parasitic interference, substantially reducing second-order errors. The design of a parasitic-insensitive discrete-time integrator incorporates two additional switches, as depicted in Fig. 14.9. Analyzing this circuit, when ϕ1 is activated, C1 charges to C1vci(nT-T), as shown in Fig. 14.10(a). Upon ϕ2 activation, C1 is effectively reversed, causing discharge through what was the ground node rather than the input signal side, as shown in Fig. 14.10(b). This reverse connection leads to vco(t) increasing for a positive vci(nT-T), thereby confirming the integrator's noninverting nature.\n\nThe transfer function, H(z), for this discrete-time integrator is expressed as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nThis equation signifies a positive discrete-time integrator with a complete delay from input to output (owing to the z^{-1} in the numerator, indicating a one-period delay), which is why the circuit in Fig. 14.9 is termed a delaying discrete-time integrator. As done previously for the parasitic-sensitive inverting integrator of Fig. 14.8, the transfer function is often rewritten to remove negative powers of z, resulting in:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nInvestigating the noninverting integrator's behavior concerning parasitic capacitances involves examining the circuit with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not impact the circuit's operation. Moreover, Cp2 is either connected to ground via the ϕ1 switch or to virtual ground through the ϕ2 switch, remaining discharged and thus not affecting the circuit. Cp1 is continuously charged to vi(n) and discharged to ground. However, during ϕ1 activation, Cp1's simultaneous charging to vi(n-1) does not interfere with the charge on C1. When ϕ2 is activated, Cp1 discharges through the ϕ2 switch attached to its node, without affecting the charge accumulating on C2. Hence, parasitic capacitances may prolong settling time but do not alter the discrete-time difference equation within the integrator of Fig. 14.9.\n\nTo create an inverting discrete-time integrator that is also parasitic-insensitive, the same circuit as the paras\nI apologize for the confusion, but the original text provided is quite extensive and complex. To rephrase it effectively while maintaining the original meaning and length, it would be best to break it down into smaller sections. Could\nUnderstood. Let's start with the first paragraph of the provided text.\n\nOriginal text:\n```\nThe parasitic-insensitive integrator was a critical development that allowed the realization of high-accuracy integrated circuits. In the first integrated integrator-based filters, the noninverting integrators (Fig. 14.9) were parasitic insensitive, whereas the inverting integrators (Fig. 14.8) were parasitic sensitive [Allstot, 1978].\n```\n\nRephrased text:\n```\nThe invention of the parasitic-insensitive integrator marked a significant milestone, facilitating the creation of highly precise integrated circuits. During the initial stages of integrated integrator-based filters, noninverting integrators, as depicted in Fig. 14.9, demonstrated immunity to parasitic effects, unlike the inverting integrators shown in Fig. 14.8, which were vulnerable to such sensitivities, as reported by Allstot in 1978.\n```"
},
{
    "text": "The realization of high-accuracy integrated circuits was significantly advanced by the development of the parasitic-insensitive integrator. Early integrated integrator-based filters saw noninverting integrators (Fig. 14.9) as parasitic-insensitive, whereas the inverting integrators (Fig. 14.8) were parasitic-sensitive [Allstot, 1978]. Fig. 14.9 depicts a noninverting delaying discrete-time integrator that is resilient to parasitic capacitances, functioning across two clock phases, ϕ1 and ϕ2, with vi(n) and vo(n) denoting the input and output voltages, respectively.\n\nThe advent of the parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] enabled the creation of fully insensitive filters, markedly reducing second-order errors. A parasitic-insensitive discrete-time integrator utilizes two additional switches, as illustrated in Fig. 14.9. Analyzing this circuit, it is observed that during ϕ1, C1 charges to C1vci(nT-T), as depicted in Fig. 14.10(a). Upon ϕ2 activation, C1 is effectively reversed, causing discharge through what was the ground node instead of the input signal side, as shown in Fig. 14.10(b). This reversed connection leads to vco(t) increasing for a positive vci(nT-T), rendering the integrator noninverting. The transfer function, H(z), for this discrete-time integrator is expressed as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nThis represents a positive discrete-time integrator with a complete delay from input to output, and thus, the circuit of Fig. 14.9 is referred to as a delaying discrete-time integrator. As with the parasitic-sensitive inverting integrator of Fig. 14.8, the transfer function is often rewritten to eliminate negative powers of z:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nTo study the impact of parasitic capacitances on this noninverting integrator, consider the same circuit with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not influence the circuit's operation. Cp2 is either connected to ground via the ϕ1 switch or to virtual ground through the ϕ2 switch, thus remaining discharged and not affecting the circuit. Cp1 is continuously charged to vi(n) and discharged to ground. During ϕ1, Cp1's charge to vi(n-1) does not affect the charge on C1. When ϕ2 is activated, Cp1 discharges through the ϕ2 switch, with none of its discharging current affecting the charge on C2. Therefore, parasitic capacitances may prolong settling time but do not affect the discrete-time difference equation in the integrator of Fig. 14.9.\n\nAn inverting discrete-time integrator that is also parasitic-insensitive can be achieved by using the same circuit as the parasitic-insensitive noninverting integrator but with the switch phases near the opamp input side of C1 interchanged, as shown in Fig. 14.12 [Martin, 1978]. This arrangement ensures that the charge on C2 remains unchanged during ϕ2 activation, as depicted in Fig. 14.13(b). Therefore, the charge relationship is:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T}) \\tag{14.22}\n$$\n\nWith C1 fully discharged at the end of ϕ2 activation, ϕ1 activation charges C1 to vci(t). The current required to charge C1 passes through C2, effectively altering the charge on C2. At the end of ϕ1 activation, the remaining charge on C2 equals its previous charge minus the charge needed to charge C1 to vci(nT). Thus, the charge relationship is:\n\n$$\nC_{2} v_{\\mathrm{co}}(\\mathrm{nT})=C_{2} v_{\\mathrm{co}}(\\mathrm{nT}-\\mathrm{T} / 2)-C_{1} v_{\\mathrm{ci}}(\\mathrm{nT}) \\tag{14.23}\n$$\n\nThis indicates a delay-free integrator, as the charge on C2 at the end of ϕ1 activation is related to vci(nT) at the same time. Substituting in (14.22), dividing by C2, and switching to discrete-time variables, we obtain:\n\n$$\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n) \\tag{14.24}\n$$\n\nTaking the z-transform of both sides, the transfer function, H(z), for this delay-free integrator is found to be:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{1-z^{-1}} \\tag{14.25}\n$$\n\nThe purely real term in the numerator signifies the integrator being delay free. As before, (14.25) is often rewritten as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z}{z-1} \\tag{14.26}\n$$\n\nBoth delayed and delay-free integrators can be realized with the same switched-capacitor circuit by altering the clock phases applied to two of the switches. In a fully-differential implementation, both can be configured to provide either positive or negative dc gain.\n\nThe delay-free integrator exhibits a negative gain, while the delaying integrator has a positive gain. While these sign changes in gain are useful in single-ended switched-capacitor designs, most modern integrated circuits employ fully differential signals for enhanced noise performance, and sign changes can be achieved by simply cross-coupling output wires. Therefore, Figs. 14.9 and 14.12, when implemented fully differentially, can be used to realize either positive or negative gain. It is more precise to refer to Fig. 14.9 as a delayed integrator and Fig. 14.12 as a delay-free integrator.\n\nFig. 14.14 represents a three-input switched capacitor summing/integrator stage. It integrates the summed signal from inputs V1(z), V2(z), and V3(z) using capacitors C1, C2, C3, and CA, with op-amp A1 providing amplification and feedback from the output node Vo(z). The system block diagram in Fig. 14.14(b) illustrates this as a signal-flow graph, providing a simplified representation of the circuit's signal processing.\n\nThe primary function of this system is to sum the three input signals with specific weightings and then integrate the result. The integration is achieved through the transfer function block, which effectively accumulates the input over time, producing the output Vo(z). This design facilitates flexible signal processing, combining multiple inputs into a single integrated output, useful in applications requiring signal summation and integration."
},
{
    "text": "The parasitic-insensitive integrator was a pivotal breakthrough that made high-precision integrated circuits achievable. Early on, in the initial integrator-based filters, the non-inverting integrators (Fig\nThe parasitic-insensitive integrator was a pivotal breakthrough that made high-precision integrated circuits achievable. Early on, in the initial integrator-based filters, the non-inverting integrators (Fig. 14.9) exhibited insensitivity to parasitics, whereas the inverting integrators (Fig. 14.8) were susceptible to them [Allstot, 1978]. The images depict the circuit of a non-inverting delaying discrete-time integrator that remains unaffected by parasitic capacitances. It functions using two clock phases, ϕ1 and ϕ2, with input and output voltages denoted as vi(n) and vo(n), respectively.\n\nThe development of the parasitic-insensitive inverting integrator [Martin, 1978; Jacobs, 1978] rendered the entire filter resilient to parasitics, substantially reducing second-order errors. To create a parasitic-insensitive discrete-time integrator, two additional switches are incorporated, as illustrated in Fig. 14.9. Analyzing this circuit as previously done, it's observed that when ϕ1 is active, C1 is charged to C1vci(nT-T), as depicted in Fig. 14.10(a). When ϕ2 is activated, C1 is effectively connected in reverse, causing the discharge to occur through what was the ground node instead of the input signal side, as shown in Fig. 14.10(b). This reverse connection leads to vco(t) increasing for a positive vci(nT-T), thus rendering the integrator non-inverting. The transfer function, H(z), for this discrete-time integrator is expressed as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z^{-1}}{1-z^{-1}} \\tag{14.20}\n$$\n\nThis represents a positive discrete-time integrator with a full delay from input to output (due to the z^{-1} in the numerator, indicating a one-period delay), which is why the circuit in Fig. 14.9 is referred to as a delaying discrete-time integrator. Similar to the parasitic sensitive inverting integrator of Fig. 14.8, the transfer function is often rewritten to eliminate negative powers of z:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{z-1} \\tag{14.21}\n$$\n\nTo examine the behavior of this non-inverting integrator concerning parasitic capacitances, consider the same circuit depicted with parasitic capacitances, as shown in Fig. 14.11. Here, Cp3 and Cp4 do not impact the circuit's operation as before. Additionally, Cp2 is either connected to ground via the ϕ1 switch or to virtual ground through the ϕ2 switch. Hence, since Cp2 always remains discharged (after settling), it also does not affect the circuit's operation. Lastly, Cp1 is continuously charged to vi(n) and discharged to ground. However, during ϕ1 on, the fact that Cp1 is also charged to vi(n-1) does not affect the charge placed on C1. When ϕ2 is activated, Cp1 is discharged through the ϕ2 switch attached to its node, and none of its discharging current passes through C1 to influence the charge accumulating on C2. Therefore, it also does not affect the circuit operation. In summary, while parasitic capacitances may slow down settling time behavior, they do not affect the discrete-time difference equation that occurs in the integrator shown in Fig. 14.9.\n\nTo achieve an inverting discrete-time integrator that is also parasitic-insensitive, the same circuit as the parasitic-insensitive non-inverting integrator can be utilized, but with the two switch phases on the switches near the op-amp input side of C1 (i.e., the top plate of C1) interchanged, as shown in Fig. 14.12 [Martin, 1978]. With this configuration, it's noted that the charge on C2 does not change when ϕ2 is activated (and ϕ1 is off) as depicted in Fig. 14.13(b). Therefore, we can write:\n\n$$\nC_{2} v_{co}(nT-T / 2)=C_{2} v_{co}(nT-T) \\tag{14.22}\n$$\n\nIt's also observed that C1 is fully discharged at the end of ϕ2 on. Now, when ϕ1 is activated in Fig. 14.13(a), C1 is charged up to vci(t). However, the current required to charge C1 flows through C2, effectively altering the charge on C2 by that amount. At the end of ϕ1 on, the charge remaining on C2 is equal to its previous charge (before ϕ1 was on) subtracted from the charge needed to charge up C1 to vci(nT). Thus, we have the following charge relationship:\n\n$$\nC_{2} v_{co}(nT)=C_{2} v_{co}(nT-T / 2)-C_{1} v_{ci}(nT) \\tag{14.23}\n$$\n\nNote that vci(nT) appears in the preceding equation rather than vci(nT-T), since the charge on C2 at the end of ϕ1 is related to the value of vci(nT) at the same time, and thus the integrator is considered to be delay-free. Substituting in (14.22), dividing by C2, and switching to discrete-time variables, we obtain:\n\n$$\nv_{0}(n)=v_{0}(n-1)-\\frac{C_{1}}{C_{2}} v_{i}(n) \\tag{14.24}\n$$\n\nTaking the z-transform of both sides, the transfer function, H(z), for this delay-free integrator is found to be:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{1}{1-z^{-1}} \\tag{14.25}\n$$\n\nThe purely real term in the numerator indicates the integrator's delay-free nature. As before, (14.25) is often rewritten as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\left(\\frac{C_{1}}{C_{2}}\\right) \\frac{z}{z-1} \\tag{14.26}\n$$\n\nA key point to note is that both delayed and delay-free integrators can be realized with the same switched-capacitor circuit by altering the clock phases applied to two of the switches. In a fully differential implementation, both can be configured to provide either positive or negative DC gain.\n\nLastly, it's worth mentioning that the aforementioned delay-free integrator has a negative gain, while the delaying integrator has a positive gain. Although these sign changes in gain can be quite useful in single-ended switched-capacitor designs, most modern integrated circuits employ fully differential signals for enhanced noise performance, and sign changes can be achieved by simply cross-coupling output wires. Therefore, either of the circuits in Figs. 14.9 or 14.12, when implemented fully differentially, may be used to realize either a positive or negative gain. It is more precise to refer to Fig. 14.9 as a delayed integrator and Fig. 14.12 as a delay-free integrator."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to graphically create and analyze such circuits. Take the three-input integrator depicted in Fig. 14.14 as an example. By leveraging the principle of superposition, it becomes evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is simply an inverting gain stage, represented by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the end of $\\phi_{1}$, as illustrated.\nBy combining equations (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) can be derived as\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:Fig. 14.15 presents a graphical representation of noise sampling in a switched capacitor circuit. The graph features a time-domain waveform depicting the voltage across the capacitor, \\( V_C(t) \\), over time \\( t \\). The plot is segmented according to the circuit's switching phases, labeled \\( \\phi_1 \\) as 'on' and 'off'.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units in seconds or a submultiple like milliseconds.\n- The vertical axis shows the capacitor voltage \\( V_C(t) \\), typically measured in volts.\n\n**Overall Behavior and Trends:**\n- The waveform exhibits noisy signals sampled at distinct intervals, aligning with the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), the voltage \\( V_C(t) \\) is sampled, resulting in a noisy segment.\n- In the 'off' phase, the waveform stabilizes at specific values, labeled \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform is marked by high-frequency noise during the sampling ('on') phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the 'on' duration significantly exceeds the RC time constant, implying a lengthy sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\).\n- Dashed lines mark the transition points between 'on' and 'off' phases, highlighting the sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be graphically analyzed using a signal-flow-graph that represents the opamp stage with an integrating block and substitutes each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Consequently, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ is employed to represent the opamp stage, while three distinct gain factors are used for the potential input stages. For a non-switched capacitor input stage, the gain factor is $-C_{1}\\left(1-z^{-1}\\right)$. A delaying switched capacitor is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, the gain factor is $-\\mathrm{C}_{3}$. However, it is crucial to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be re-expressed in powers of $\\mathbf{z}$ instead of $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, it is important to note that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be realized by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to graphically create and analyze such circuits. Consider the three-input integrator depicted in Fig. 14.14. Using the principle of superposition, it is evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are given by\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, we observe that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is simply an inverting gain stage expressed as\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the end of $\\phi_{1}$, as illustrated.\nCombining (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) is\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:The graph in Fig. 14.15 depicts noise sampling in a switched capacitor circuit. It shows a time-domain waveform representing the voltage across the capacitor, \\( V_C(t) \\), over time \\( t \\). The graph is segmented according to the circuit's switching phases, labeled \\( \\phi_1 \\) as 'on' and 'off'.\n\n**Axes Labels and Units:**\n- The horizontal axis represents time \\( t \\), with implied units in seconds or submultiples like milliseconds.\n- The vertical axis represents the capacitor voltage \\( V_C(t) \\), typically in volts, though specific units are not provided.\n\n**Overall Behavior and Trends:**\n- The waveform displays noisy signals sampled at discrete intervals, corresponding to the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), the voltage \\( V_C(t) \\) is sampled, resulting in noisy segments.\n- In the 'off' phase, the waveform stabilizes at discrete values, \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), indicating sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform exhibits high-frequency noise during the sampling ('on') phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the 'on' time is much longer than the RC time constant, suggesting a prolonged sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph is annotated with switching phases (on/off) and sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing discrete sampled values during the 'off' phase.\n- Transition points between 'on' and 'off' phases are marked with dashed lines, indicating sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be analyzed graphically using a signal-flow-graph that represents the opamp stage with an integrating block and replaces each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Thus, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ represents the opamp stage, while three distinct gain factors represent the possible input stages. For a non-switched capacitor input stage, a gain factor of $-C_{1}\\left(1-z^{-1}\\right)$ is used. If a delaying switched capacitor is employed, it is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, a gain factor of $-\\mathrm{C}_{3}$ is used. However, note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be rewritten in powers of $\\mathbf{z}$ rather than $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, it should be noted that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be achieved by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to construct and analyze these circuits graphically. Take, for example, the three-input integrator depicted in Fig. 14.14. By employing the principle of superposition, it becomes evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is simply an inverting gain stage, represented by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the conclusion of $\\phi_{1}$, as illustrated.\nBy combining equations (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) can be written as\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:Fig. 14.15 depicts noise sampling in a switched capacitor circuit through a time-domain waveform representing the capacitor voltage, \\( V_C(t) \\), over time \\( t \\). The graph is segmented according to the circuit's switching phases, marked as \\( \\phi_1 \\) 'on' and 'off'.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units in seconds or a submultiple like milliseconds.\n- The vertical axis shows the capacitor voltage \\( V_C(t) \\), typically in volts, though specific units are not provided.\n\n**Overall Behavior and Trends:**\n- The waveform displays noisy signals sampled at specific intervals, corresponding to the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), \\( V_C(t) \\) is sampled, resulting in noisy waveform segments.\n- In the 'off' phase, the waveform stabilizes at discrete values, labeled \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform is marked by high-frequency noise during the 'on' (sampling) phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the 'on' time is much longer than the RC time constant, suggesting a prolonged sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\).\n- Dashed lines mark the transition points between 'on' and 'off' phases, highlighting the sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be analyzed graphically using a signal-flow-graph that represents the opamp stage with an integrating block and replaces each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Thus, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ represents the opamp stage, while three distinct gain factors represent the possible input stages. For a non-switched capacitor input stage, the gain factor is $-C_{1}\\left(1-z^{-1}\\right)$. A delaying switched capacitor is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, the gain factor is $-\\mathrm{C}_{3}$. However, it is important to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be rewritten in terms of powers of $\\mathbf{z}$ instead of $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be realized by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to construct and analyze these circuits graphically. Take, for example, the three-input integrator depicted in Fig. 14.14. By employing the principle of superposition, it becomes evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is merely an inverting gain stage, represented by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the conclusion of $\\phi_{1}$, as illustrated.\nBy combining equations (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) can be derived as\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:Fig. 14.15 presents a graphical representation of noise sampling in a switched capacitor circuit. The graph features a time-domain waveform depicting the voltage across the capacitor, \\( V_C(t) \\), as it varies over time \\( t \\). The plot is segmented according to the circuit's switching phases, marked as \\( \\phi_1 \\) in 'on' and 'off' states.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units of seconds or milliseconds, though not explicitly stated.\n- The vertical axis measures the capacitor voltage \\( V_C(t) \\), typically in volts, though specific units are omitted.\n\n**Overall Behavior and Trends:**\n- The waveform exhibits noisy signals sampled at specific intervals, corresponding to the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), the voltage \\( V_C(t) \\) is captured, resulting in a noisy segment of the waveform.\n- In the 'off' phase, the waveform stabilizes at distinct values, labeled \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform is marked by high-frequency noise during the sampling ('on') phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the duration of the 'on' phase is substantially longer than the RC time constant, signifying a prolonged sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), which are the discrete values captured during the 'off' phase.\n- Dashed lines mark the transition points between the 'on' and 'off' phases, highlighting the sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be effectively analyzed graphically by using a signal-flow-graph that represents the opamp stage with an integrating block and substituting each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Consequently, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ is employed to represent the opamp stage, while three distinct gain factors are used to depict the various input stages. For a non-switched capacitor input stage, a gain factor of $-C_{1}\\left(1-z^{-1}\\right)$ is applied. If a delaying switched capacitor is utilized, it is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, a gain factor of $-\\mathrm{C}_{3}$ is used. However, it is important to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs are sampling their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be recast in terms of powers of $\\mathbf{z}$ instead of $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, it should be acknowledged that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be realized by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to graphically create and analyze such circuits. Take the three-input integrator depicted in Fig. 14.14 as an example. By employing the principle of superposition, it becomes evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is simply an inverting gain stage, represented by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the conclusion of $\\phi_{1}$, as illustrated.\nBy combining equations (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) can be derived as\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:Fig. 14.15 presents a graphical depiction of noise sampling in a switched capacitor circuit. The graph features a time-domain waveform representing the capacitor voltage, \\( V_C(t) \\), over time \\( t \\). The graph is segmented according to the circuit's switching phases, labeled \\( \\phi_1 \\) as 'on' and 'off'.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units in seconds or a submultiple like milliseconds.\n- The vertical axis shows the capacitor voltage \\( V_C(t) \\), typically measured in volts.\n\n**Overall Behavior and Trends:**\n- The waveform displays noisy signals sampled at distinct intervals, aligned with the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), \\( V_C(t) \\) is sampled, producing a noisy segment of the waveform.\n- In the 'off' phase, the waveform stabilizes at specific values, noted as \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The sampling ('on') phase is marked by high-frequency noise in the waveform.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the duration of the 'on' phase is much longer than the RC time constant, signifying an extended sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\).\n- Dashed lines mark the transition points between the 'on' and 'off' phases, highlighting the sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be analyzed graphically by using a signal-flow-graph that represents the opamp stage with an integrating block and substituting each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted using the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. To create an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ represents the opamp stage, while three distinct gain factors represent the possible input stages. For a non-switched capacitor input stage, the gain factor is $-C_{1}\\left(1-z^{-1}\\right)$. A delaying switched capacitor is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, the gain factor is $-\\mathrm{C}_{3}$. However, it is important to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be rewritten in terms of powers of $\\mathbf{z}$ rather than $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be achieved by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to construct and analyze such circuits graphically. Take, for instance, the three-input integrator depicted in Fig. 14.14. By employing the principle of superposition, it is evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is merely an inverting gain stage, represented by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the conclusion of $\\phi_{1}$, as illustrated.\nBy combining equations (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) is derived as\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:The diagram in Fig. 14.15 depicts noise sampling in a switched capacitor circuit. It features a time-domain waveform representing the capacitor voltage, \\( V_C(t) \\), over time \\( t \\). The graph is segmented according to the circuit's switching phases, marked as \\( \\phi_1 \\) in 'on' and 'off' states.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units in seconds or a fraction thereof, such as milliseconds.\n- The vertical axis indicates the capacitor voltage \\( V_C(t) \\), typically measured in volts, though specific units are not specified.\n\n**Overall Behavior and Trends:**\n- The waveform displays noisy signals sampled at specific intervals, aligning with the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), the voltage \\( V_C(t) \\) is sampled, resulting in a noisy segment of the waveform.\n- In the 'off' phase, the waveform stabilizes at discrete values, labeled \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform is marked by high-frequency noise during the sampling ('on') phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the duration of the 'on' phase is much longer than the RC time constant, suggesting an extended sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), which are the discrete values captured during the 'off' phase.\n- Dashed lines mark the transition points between the 'on' and 'off' phases, highlighting the sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be analyzed graphically by using a signal-flow-graph to represent the opamp stage with an integrating block and substituting each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Thus, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ is employed to represent the opamp stage, while three distinct gain factors are used to represent the various input stages. For a non-switched capacitor input stage, a gain factor of $-C_{1}\\left(1-z^{-1}\\right)$ is applied. If a delaying switched capacitor is used, it is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, a gain factor of $-\\mathrm{C}_{3}$ is utilized. However, it is important to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be rewritten in terms of powers of $\\mathbf{z}$ instead of $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, it should be noted that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be realized by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to graphically create and analyze such circuits. Take, for example, the three-input integrator depicted in Fig. 14.14. By employing the principle of superposition, it becomes evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is simply an inverting gain stage, given by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the conclusion of $\\phi_{1}$, as illustrated.\nBy combining equations (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) is determined to be\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:The graph in Fig. 14.15 depicts noise sampling in a switched capacitor circuit. It features a time-domain waveform representing the voltage across the capacitor, \\( V_C(t) \\), over time \\( t \\). The graph is segmented according to the circuit's switching phases, labeled \\( \\phi_1 \\) as 'on' and 'off'.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units in seconds or a submultiple like milliseconds.\n- The vertical axis shows the capacitor voltage \\( V_C(t) \\), typically in volts, though specific units are not provided.\n\n**Overall Behavior and Trends:**\n- The waveform displays noisy signals sampled at discrete intervals, corresponding to the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), the voltage \\( V_C(t) \\) is sampled, resulting in a noisy waveform segment.\n- In the 'off' phase, the waveform stabilizes at discrete values, marked as \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), indicating the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform exhibits high-frequency noise during the sampling ('on') phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the 'on' time is much longer than the RC time constant, suggesting a prolonged sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing discrete sampled values during the 'off' phase.\n- Transition points between 'on' and 'off' phases are marked with dashed lines, indicating sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be analyzed graphically using a signal-flow-graph that represents the opamp stage with an integrating block and replaces each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Thus, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ represents the opamp stage, while three distinct gain factors represent the possible input stages. For a non-switched capacitor input stage, a gain factor of $-C_{1}\\left(1-z^{-1}\\right)$ is used. If a delaying switched capacitor is employed, it is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, a gain factor of $-\\mathrm{C}_{3}$ is applied. However, it is crucial to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be rewritten in terms of powers of $\\mathbf{z}$ instead of $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, it is important to note that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be realized by simply swapping the input wires."
},
{
    "text": "Clearly, applying the described charge transfer equations to larger circuits would be cumbersome. Instead, several rules can be formulated to graphically create and analyze such circuits. Take, for example, the three-input integrator depicted in Fig. 14.14. Utilizing the principle of superposition, it becomes evident that the input-output relationships for $\\mathrm{V}_{2}(\\mathrm{z})$ and $V_{3}(z)$ are expressed as\n\n$$\n\\begin{align*}\n& \\frac{V_{0}(z)}{V_{2}(z)}=\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right)  \\tag{14.27}\\\\\n& \\frac{V_{0}(z)}{V_{3}(z)}=-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) \\tag{14.28}\n\\end{align*}\n$$\n\nFor the input $\\mathrm{V}_{1}(\\mathrm{z})$, it is observed that its relationship to $\\mathrm{V}_{0}(\\mathrm{z})$ is simply an inverting gain stage, represented by\n\n$$\n\\begin{equation*}\n\\frac{V_{0}(z)}{V_{1}(z)}=-\\left(\\frac{C_{1}}{C_{A}}\\right) \\tag{14.29}\n\\end{equation*}\n$$\n\nwith the output being sampled at the conclusion of $\\phi_{1}$, as illustrated.\nBy combining (14.27), (14.28), and (14.29), the input-output relationship for the circuit in Fig. 14.14(a) is derived as\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{z^{-1}}{1-z^{-1}}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{1}{1-z^{-1}}\\right) V_{3}(z) \\tag{14.30}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.15 Noise sampling on a switched capacitor\ndescription:The diagram in Fig. 14.15 depicts noise sampling in a switched capacitor circuit. It features a time-domain waveform representing the voltage across the capacitor, \\( V_C(t) \\), over time \\( t \\). The graph is segmented according to the circuit's switching phases, marked as \\( \\phi_1 \\) for 'on' and 'off'.\n\n**Axes Labels and Units:**\n- The horizontal axis denotes time \\( t \\), with implied units in seconds or a submultiple like milliseconds.\n- The vertical axis shows the capacitor voltage \\( V_C(t) \\), typically in volts, though specific units are not provided.\n\n**Overall Behavior and Trends:**\n- The waveform displays noisy signals sampled at specific intervals, corresponding to the switching phases.\n- During the 'on' phase of \\( \\phi_1 \\), the voltage \\( V_C(t) \\) is sampled, resulting in a noisy waveform segment.\n- In the 'off' phase, the waveform stabilizes at discrete values, labeled \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), indicating the sampled voltage levels.\n\n**Key Features and Technical Details:**\n- The waveform is marked by high-frequency noise during the sampling ('on') phase.\n- The notation \\( T_{on} \\gg R_{on}C \\) indicates that the 'on' duration is much longer than the RC time constant, suggesting a prolonged sampling period relative to the switch's resistance-capacitance product.\n\n**Annotations and Specific Data Points:**\n- The graph includes annotations for the switching phases (on/off) and the sampled voltage levels \\( V_C(k) \\), \\( V_C(k+1) \\), and \\( V_C(k+2) \\), representing discrete sampled values during the 'off' phase.\n- Transition points between 'on' and 'off' phases are marked with dashed lines, indicating the sampling intervals.\n\nFig. 14.15 Noise sampling on a switched capacitor.\n\nKey Point: Complex switched-capacitor circuits can be analyzed graphically by using a signal-flow-graph to represent the opamp stage with an integrating block and replacing each input branch with the corresponding non-switched, delayed, or delay-free gain factor.\n\nThis relationship can also be depicted by the signal-flow-graph in Fig. 14.14(b), where the input stages are separated from the opamp stage. Thus, to derive an equivalent signal-flow-graph, the block $\\left(1 / C_{A}\\right)\\left[1 /\\left(1-z^{-1}\\right)\\right]$ represents the opamp stage, while three distinct gain factors represent the possible input stages. For a non-switched capacitor input stage, a gain factor of $-C_{1}\\left(1-z^{-1}\\right)$ is used. If a delaying switched capacitor is employed, it is represented by $\\mathrm{C}_{2} z^{-1}$. For a delay-free switched-capacitor input, a gain factor of $-\\mathrm{C}_{3}$ is applied. However, it is important to note that the output, $\\mathrm{V}_{0}(\\mathrm{z})$, should be sampled on $\\phi_{1}$ when the switched-capacitor inputs sample their input signals on $\\phi_{1}$.\nAs previously mentioned, this transfer function can often be rewritten in terms of powers of $\\mathbf{z}$ instead of $\\mathbf{z}^{-1}$, resulting in\n\n$$\n\\begin{equation*}\nV_{0}(z)=-\\left(\\frac{C_{1}}{C_{A}}\\right) V_{1}(z)+\\left(\\frac{C_{2}}{C_{A}}\\right)\\left(\\frac{1}{z-1}\\right) V_{2}(z)-\\left(\\frac{C_{3}}{C_{A}}\\right)\\left(\\frac{z}{z-1}\\right) V_{3}(z) \\tag{14.31}\n\\end{equation*}\n$$\n\nLastly, it should be noted that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}$, $\\mathrm{C}_{2}$, and $\\mathrm{C}_{3}$ can be realized by simply swapping the input wires."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from the analysis presented earlier in this text. The noise analysis in Chapter 9 assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be considered stationary. In contrast, switched-capacitor circuits continually alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis, beneficial for design, by examining the circuit in each of its clock phases. Additionally, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases叠加, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be substantially less than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis is conducted under the assumption of zero input voltage, with the rms noise voltage for each capacitor given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on the noise, we assume the input voltage to the branch is zero (ground). Each of the four switches contributes to the noise. In clock phase $\\phi_{1}$, a rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled onto the capacitor. Consequently, the charge stored on the capacitor is a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is entirely delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge arises due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming an ideal opamp, which can maintain a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Hence, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that including the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically small when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that presented earlier in this text. The noise analysis in Chapter 9 assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be considered stationary. Conversely, switched-capacitor circuits continuously alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis, beneficial for design, by examining the circuit in each of its clock phases. Furthermore, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases叠加, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be substantially less than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis is conducted under the assumption of zero input voltage. The rms noise voltage for each capacitor is specified as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances. $\\mathrm{R}_{\\text {on }}$\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on the noise, we assume the input voltage to the branch is zero (ground). Noise is contributed by each of the four switches. In clock phase $\\phi_{1}$, an rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled onto the capacitor. The charge stored on the capacitor is, therefore, a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is entirely delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge is introduced due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming the opamp is ideal and can maintain a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Thus, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Hence, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that incorporating the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that presented earlier in this text. Chapter 9's noise analysis assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be treated as stationary. In contrast, switched-capacitor circuits continually alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis, beneficial for design, by examining the circuit in each of its clock phases. Additionally, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases combines, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched-capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be significantly shorter than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady-state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis assumes zero input voltage, with the rms noise voltage for each capacitor given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on noise, we assume the input voltage to the branch is zero (ground). Noise is contributed by each of the four switches. During clock phase $\\phi_{1}$, a rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled on the capacitor. The charge stored on the capacitor thus becomes a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is fully delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge is introduced due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming an ideal opamp, which can maintain a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Consequently, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Therefore, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that incorporating nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that discussed earlier in this text. The noise analysis in Chapter 9 assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be considered stationary. Conversely, switched-capacitor circuits continually alter their configuration due to the switching actions. We will conduct a simplified analysis suitable for design by examining the circuit in each of its clock phases. Additionally, we assume that the noise voltage across capacitors is instantaneously and perfectly sampled when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases叠加, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be significantly shorter than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis assumes zero input voltage, with the rms noise voltage for each capacitor given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since we are currently focused only on the noise, we assume the input voltage to the branch is zero (ground). Each of the four switches contributes to the noise. In clock phase $\\phi_{1}$, an rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled onto the capacitor. Consequently, the charge stored on the capacitor is a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is fully transferred to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge arises due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming an ideal opamp capable of maintaining a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Hence, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that including the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that presented earlier in this text. The noise analysis in Chapter 9 assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be considered stationary. In contrast, switched-capacitor circuits continually alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis, useful for design, by examining the circuit in each of its clock phases. Additionally, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches turn off.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. Sampled kT/C noise from both clock phases superimpose, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch turns on, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be significantly less than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage has reached its steady-state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present on the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis assumes zero input voltage, with the rms noise voltage for each capacitor given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since we are currently focused only on the noise, we assume the input voltage to the branch is zero (ground). Noise is contributed by each of the four switches. In clock phase $\\phi_{1}$, a rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled on the capacitor. The charge stored on the capacitor is, therefore, a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random quantity of charge is fully delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random quantity of charge arises due to the switches on during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming the opamp is ideal and can maintain a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Hence, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be shown that incorporating nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is generally minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits diverges subtly from the methods discussed earlier in this text. The noise analysis in Chapter 9 is based on continuous-time circuits operating under constant bias conditions, where the random noise statistics are assumed to be stationary. In contrast, switched-capacitor circuits undergo frequent configuration changes due to the opening and closing of switches. We will conduct a simplified yet practical analysis by examining the circuit in each of its clock phases. Furthermore, we assume that the noise voltage across capacitors is instantaneously and perfectly sampled when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise from the switches. The sampled kT/C noise from both clock phases叠加, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant formed by the switch on resistance, $R_{o n}$, and capacitance $C$ should be significantly shorter than the switch on time to ensure the signal voltages on the capacitor stabilize. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis is conducted under the assumption of zero input voltage, with the rms noise voltage for each capacitor given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases, with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on noise, we assume the input voltage to the branch is zero (ground). Noise is contributed by each of the four switches. During clock phase $\\phi_{1}$, an rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled onto the capacitor. Consequently, the charge stored on the capacitor is a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is entirely delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge arises from the switches active during clock phase $\\phi_{2}$. Thermal noise in these switches generates a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming an ideal opamp capable of maintaining a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an extra random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis matches the charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Thus, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that incorporating the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that discussed earlier in this text. The noise analysis in Chapter 9 assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be considered stationary. In contrast, switched-capacitor circuits continuously alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis, useful for design, by examining the circuit in each of its clock phases. Furthermore, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches turn off.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases superimposes, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be significantly shorter than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present on the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis assumes zero input voltage, with the rms noise voltage for each capacitor given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since we are currently focused only on the noise, we assume the input voltage to the branch is zero (ground). Noise is contributed by each of the four switches. In clock phase $\\phi_{1}$, an rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled on the capacitor. The charge stored on the capacitor is thus a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is fully delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge is introduced due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming the opamp is ideal and can maintain a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Hence, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that including the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is generally minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that presented earlier in this text. Chapter 9's noise analysis assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be considered stationary. In contrast, switched-capacitor circuits continuously alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis suitable for design by examining the circuit in each of its clock phases. Additionally, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases combines, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched-capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be considerably less than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady-state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis assumes zero input voltage, and the rms noise voltage for each capacitor is given as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on the noise, we assume the input voltage to the branch is zero (ground). Each of the four switches contributes to the noise. In clock phase $\\phi_{1}$, a rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled on the capacitor. Consequently, the charge stored on the capacitor is a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is entirely delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge arises from the switches active during clock phase $\\phi_{2}$. Thermal noise in these switches generates a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming an ideal opamp capable of maintaining a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage results in an extra random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Thus, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that incorporating the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is generally minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits diverges subtly from the approach outlined earlier in this text. The noise analysis in Chapter 9 assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be treated as stationary. In contrast, switched-capacitor circuits continuously alter their configuration due to the switching actions. We will conduct a simplified analysis, beneficial for design, by examining the circuit in each of its clock phases. Additionally, we presume that the noise voltage across capacitors is sampled instantaneously and flawlessly when the switches deactivate.\n\nKey Point: Switched capacitors gather the thermal noise of the switches. The sampled kT/C noise from both clock phases叠加, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant formed by the switch on resistance, $R_{o n}$, and capacitance $C$ should be considerably shorter than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and retained on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis is conducted under the assumption of zero input voltage. The rms noise voltage for each capacitor is specified as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch depicted in each clock phase with the switch resistances $\\mathrm{R}_{\\text {on }}$.\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is shown in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on the noise, we assume the input voltage to the branch is zero (ground). Noise is contributed by each of the four switches. During clock phase $\\phi_{1}$, an rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled onto the capacitor. Consequently, the charge stored on the capacitor is a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is entirely transferred to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge arises due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming the opamp is ideal and can maintain a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an extra random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Thus, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that incorporating the nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "The examination of noise in switched-capacitor circuits differs subtly from that presented earlier in this text. Chapter 9's noise analysis assumes continuous-time circuits under constant bias conditions, allowing the random noise statistics to be regarded as stationary. In contrast, switched-capacitor circuits continually alter their configuration due to the opening and closing of switches. We will conduct a simplified analysis, beneficial for design, by examining the circuit in each of its clock phases. Furthermore, we assume that the noise voltage across capacitors is sampled instantaneously and perfectly when the switches deactivate.\n\nKey Point: Switched capacitors accumulate the thermal noise of the switches. The sampled kT/C noise from both clock phases combines, resulting in a total mean squared input-referred noise of $2 \\mathrm{kT} / \\mathrm{C}$.\n\nThe process of sampling a noise signal on a capacitor is depicted in Fig. 14.15. Once the switch activates, thermal noise from the switch accumulates on the capacitor. For any practical switched capacitor circuit, the time constant of the switch on resistance, $R_{o n}$, and capacitance $C$ should be significantly shorter than the switch on time to ensure the settling of signal voltages on the capacitor. Thus, by the time the switch opens, the rms noise voltage reaches its steady state value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ (refer to Chapter 9). The voltage sampled and stored on the capacitor, $\\mathrm{V}_{\\mathrm{C}}(\\mathrm{k})$, is therefore a discrete-time noise voltage with an rms value of $\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. When an input signal is present at the left terminal of the switched capacitor in Fig. 14.15, the sampled noise voltage is superimposed on the sampled input voltage.\nimage_name:Fig. 14.16\ndescription:The circuit diagram illustrates a switched-capacitor branch in two clock phases with switch resistances Ron. Noise analysis is conducted under the assumption of zero input voltage. The rms noise voltage for each capacitor is specified as sqrt(kT/C).\n\nFig. 14.16 A switched-capacitor branch shown in each clock phase with the switch resistances. $\\mathrm{R}_{\\text {on }}$\n\nNext, consider the delayed parasitic-insensitive switched capacitor introduced in Fig. 14.9. In Fig. 14.16, the switched-capacitor branch is depicted in each of its two clock phases with the switches represented by their on resistance $R_{\\text {on }}$. Since our current focus is solely on the noise, we assume the input voltage to the branch is zero (ground). Each of the four switches contributes to the noise. In clock phase $\\phi_{1}$, an rms voltage $\\mathrm{V}_{\\mathrm{cl}(\\mathrm{ms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$ is sampled on the capacitor. Consequently, the charge stored on the capacitor is a random quantity with an rms value\n\n$$\n\\begin{equation*}\n\\Delta Q_{1(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.32}\n\\end{equation*}\n$$\n\nThis random charge is entirely delivered to the opamp feedback network during clock phase $\\phi_{2}$.\n\nAdditionally, another random charge arises due to the switches active during clock phase $\\phi_{2}$. Again, thermal noise in the switches results in a capacitor noise voltage $\\mathrm{V}_{\\mathrm{c2} .(\\mathrm{rms})}^{2}=\\sqrt{\\mathrm{kT} / \\mathrm{C}}$. Assuming an ideal opamp capable of maintaining a precise virtual ground during $\\phi_{2}$, this capacitor noise voltage leads to an additional random charge being delivered to (or from) the feedback network.\n\n$$\n\\begin{equation*}\n\\Delta Q_{2(\\mathrm{rms})}=C \\cdot \\sqrt{\\mathrm{kT} / \\mathrm{C}}=\\sqrt{\\mathrm{kTC}} \\tag{14.33}\n\\end{equation*}\n$$\n\nThe noise quantities $V_{c 1}$ and $V_{c 2}$ are uncorrelated, as are the charges $\\Delta Q_{1}$ and $\\Delta Q_{2}$. Therefore, the mean square total charge delivered by the switched capacitor branch is the sum of the squares of (14.32) and (14.33).\n\n$$\n\\begin{equation*}\n\\Delta \\mathrm{Q}_{(\\mathrm{rms})}{ }^{2}=\\Delta \\mathrm{Q}_{1(\\mathrm{rms})}{ }^{2}+\\Delta \\mathrm{Q}_{2(\\mathrm{rms})}{ }^{2}=2 \\mathrm{kTC} \\tag{14.34}\n\\end{equation*}\n$$\n\nThis is exactly the same charge that would be delivered if the switches were noiseless and the input mean squared voltage were $2 \\mathrm{kT} / \\mathrm{C}$. Hence, assuming an ideal opamp, the switched capacitor branch can be considered to have an input-referred noise,\n\n$$\n\\begin{equation*}\nV_{i n(r m s)}=\\sqrt{\\frac{2 \\mathrm{kT}}{\\mathrm{C}}} \\tag{14.35}\n\\end{equation*}\n$$\n\nIt can be demonstrated that incorporating nonideal effects of the opamp results in a slightly higher input-referred noise than the value in (14.35), but the difference is typically minor when the opamp's noise is dominated by its input differential pair transistors [Schreier, 2005]."
},
{
    "text": "Key Point: Initiating with conventional continuous-time active RC filters and substituting each resistor with a switched capacitor yields a discrete-time filter whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output derived from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently employed to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals relative to the clock frequency, their performance at frequencies moderately close to the clock frequency is precisely determined using the z-domain signal-flow-graph approach previously outlined.\n\nA typical first-order active-RC filter is illustrated in Fig. 14.17. To achieve a switched-capacitor filter with equivalent low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are utilized as they produce negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its corresponding signal-flow graph are depicted in Fig. 14.18. An equation describing this signal-flow graph is\n\nimage_name: (a)\ndescription: This circuit is a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to emulate the low-frequency behavior of an active-RC filter. It includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" illustrates the equivalent signal-flow graph of a first-order switched-capacitor filter, providing a visual representation of the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, depicted as a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are represented by arrows with labels indicating the gain values:\n  - **-C1(1 - z^-1):** This block represents the input signal weighted by -C1 with a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) denote the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), indicating its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The configuration of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, preserving the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nFrom this, the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is located by setting the denominator to zero, resulting in a pole position, $\\mathrm{z}_{\\mathrm{p}}$, given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nFor positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. Specifically, with $C_{3}=0$, the pole is at $\\mathbf{z}=1$, effectively making the circuit a discrete-time integrator, as expected. The zero of (14.37) is found by setting the numerator to zero, yielding a zero location, $\\mathbf{z}_{z}$, given by\n\n$$\n\\begin{equation*}\n\\mathrm{z}_{\\mathrm{z}}=\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{1}+\\mathrm{C}_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is determined by setting $z=1$, resulting in\n\n$$\n\\begin{equation*}\n\\mathrm{H}(1)=\\frac{-\\mathrm{C}_{2}}{\\mathrm{C}_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nIn a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}, \\mathrm{C}_{2}$, and $C_{3}$ can be realized by swapping the input wires. For instance, a zero at $z=-1$ can be achieved by setting\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{1}=-0.5 \\mathrm{C}_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nThis means the capacitors representing $C_{1}$ would be half the size of those representing $C_{2}$, with the input wires interchanged into the $C_{1}$ pair so that $-V_{i}(z)$ is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit with a $3-\\mathrm{dB}$ point at 10 kHz using a 100 kHz clock frequency. The filter should also have zero gain at 50 kHz and a unity dc gain. Assume $C_{A}=10 \\mathrm{pF}$.\n\n#### Solution\n\nFirst, note that zero gain at 50 kHz corresponds to placing a zero at -1. Using the bilinear transform $p=(z-1) /(z+1)$ as described in Section 13.5.4, the zero at -1 maps to $\\Omega=\\infty$. Additionally, the frequency warping between domains, $\\Omega=\\tan (\\omega / 2)$, maps the $-3-\\mathrm{dB}$ frequency of 10 kHz (or $0.2 \\pi \\mathrm{rad} /$ sample) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, the specification simplifies to finding the pole location for a continuous-time filter with a $-3-\\mathrm{dB}$ frequency of $0.3249 \\mathrm{rad} / \\mathrm{s}$ and a zero at $\\infty$. The required continuous-time pole, $p_{p}$, is\n\n$$\n\\mathrm{p}_{\\mathrm{p}}=-0.3249\n$$\n\nThis pole maps back to a $\\mathbf{Z}$-domain pole, $\\mathbf{z}_{\\mathrm{p}}$, of\n\n$$\n\\mathrm{z}_{\\mathrm{p}}=\\frac{1+\\mathrm{p}_{\\mathrm{p}}}{1-\\mathrm{p}_{\\mathrm{p}}}=0.5095\n$$\n\nTherefore, the desired discrete-time transfer function, $H(z)$, is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere k is determined by setting the dc gain to one (i.e., $\\mathrm{H}(1)=1$), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\n\\mathrm{H}(\\mathrm{z})=\\frac{0.4814 \\mathrm{z}+0.4814}{1.9627 \\mathrm{z}-1}\n$$\n\nEquating these coefficients with those of (14.37) (assuming $\\mathrm{C}_{\\mathrm{A}}=10 \\mathrm{pF}$) yields\n\n$$\n\\begin{aligned}\n& \\mathrm{C}_{1}=4.814 \\mathrm{pF} \\\\\n& \\mathrm{C}_{2}=-9.628 \\mathrm{pF} \\\\\n& \\mathrm{C}_{3}=9.628 \\mathrm{pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example with a zero at one-half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, approximations can be used to derive equations for the capacitor ratios based on the desired zero and pole, assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. By approximating $\\omega T<<1$, (14.43) simplifies to\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe method used is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{z}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{2} / \\mathrm{C}_{1}}{1+\\frac{\\mathrm{C}_{2}}{2 \\mathrm{C}_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{p}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{3} / \\mathrm{C}_{\\mathrm{A}}}{1+\\frac{\\mathrm{C}_{3}}{2 \\mathrm{C}_{\\mathrm{A}}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value $\\mathrm{C}_{3}$ required for a first-order low-pass switched-capacitor filter with $\\mathrm{C}_{1}=0$ and a pole at 1/64th the sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for $C_{3} / C_{A}$, we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose $C_{A}=10 \\mathrm{pF}$, then $C_{3}=1.032 \\mathrm{pF}$. From (14.44) with $\\mathrm{C}_{1}=0$, the low-frequency gain is $\\mathrm{C}_{2} / \\mathrm{C}_{3}$. For unity gain, $\\mathrm{C}_{2}$ must also be $1.032 \\mathrm{pF}$."
},
{
    "text": "Key Point: By starting with traditional continuous-time active RC filters and substituting each resistor with a switched capacitor, a discrete-time filter is created whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output taken from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently used to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), their behavior at signal frequencies moderately close to the clock frequency is precisely determined using the z-domain signal-flow-graph approach previously outlined.\n\nA general first-order active-RC filter is depicted in Fig. 14.17. To achieve a switched-capacitor filter with equivalent low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are employed as they create negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its corresponding signal-flow graph are illustrated in Fig. 14.18. An equation describing this signal-flow graph is\n\nimage_name: (a)\ndescription: This circuit is a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to match the low-frequency behavior of an active-RC filter. It includes capacitors C1, C2, C3, CA, and operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" depicts the equivalent signal-flow graph of a first-order switched-capacitor filter, visually representing the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, represented by a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are depicted by arrows with labels indicating the gain values:\n  - **-C1(1 - z^-1):** This block represents the input signal weighted by -C1 with a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) indicate the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), denoting its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The arrangement of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the configured capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, maintaining the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nfrom which the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is found by setting the denominator to zero, resulting in a pole location, \\( z_{p} \\), given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. In fact, with \\( C_{3}=0 \\), the circuit's pole is at \\( z=1 \\), effectively making it a discrete-time integrator, as expected. The zero of (14.37) is found by setting the numerator to zero, resulting in a zero location, \\( z_{z} \\), given by\n\n$$\n\\begin{equation*}\nz_{z}=\\frac{C_{1}}{C_{1}+C_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is determined by setting \\( z=1 \\), resulting in the dc gain being\n\n$$\n\\begin{equation*}\nH(1)=\\frac{-C_{2}}{C_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nRecall that in a fully differential implementation, effective negative capacitances can be realized for \\( C_{1}, C_{2} \\), and \\( C_{3} \\) by swapping the input wires. For instance, a zero at \\( z=-1 \\) can be achieved by setting\n\n$$\n\\begin{equation*}\nC_{1}=-0.5 C_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing \\( C_{1} \\) would be half the size of those representing \\( C_{2} \\), and the input wires would be interchanged into the \\( C_{1} \\) pair so that \\( -V_{i}(z) \\) is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit such that its 3-dB point is at 10 kHz with a clock frequency of 100 kHz. Additionally, the filter should have zero gain at 50 kHz and a dc gain of unity. Assume \\( C_{A}=10 \\text{ pF} \\).\n\n#### Solution\n\nFirst, note that achieving zero gain at 50 kHz equates to placing a zero at -1. Using the bilinear transform \\( p=(z-1)/(z+1) \\) as described in Section 13.5.4, the zero at -1 maps to \\( \\Omega=\\infty \\). Furthermore, the frequency warping between the two domains, \\( \\Omega=\\tan(\\omega/2) \\), maps the 3-dB frequency of 10 kHz (or \\( 0.2 \\pi \\text{ rad/sample} \\)) in the Z-domain to\n\n$$\n\\Omega=\\tan\\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, our specification simplifies to finding the pole location for a continuous-time filter with a 3-dB frequency of \\( 0.3249 \\text{ rad/s} \\) and a zero at \\( \\infty \\). Clearly, the required continuous-time pole, \\( p_{p} \\), is\n\n$$\np_{p}=-0.3249\n$$\n\nThis pole maps back to a Z-domain pole, \\( z_{p} \\), of value\n\n$$\nz_{p}=\\frac{1+p_{p}}{1-p_{p}}=0.5095\n$$\n\nTherefore, the desired discrete-time transfer function, \\( H(z) \\), is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere \\( k \\) is determined by setting the dc gain to one (i.e., \\( H(1)=1 \\)), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\nH(z)=\\frac{0.4814z+0.4814}{1.9627z-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming \\( C_{A}=10 \\text{ pF} \\)) yields\n\n$$\n\\begin{aligned}\n& C_{1}=4.814 \\text{ pF} \\\\\n& C_{2}=-9.628 \\text{ pF} \\\\\n& C_{3}=9.628 \\text{ pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example, which had a zero at half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, some approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1/2}-z^{-1/2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)z^{1/2}}{z^{1/2}-z^{-1/2}+\\frac{C_{3}}{C_{A}}z^{1/2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j\\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j\\omega T}\\right)}{V_{i}\\left(e^{j\\omega T}\\right)}=-\\frac{j\\frac{2C_{1}+C_{2}}{C_{A}}\\sin\\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}}\\cos\\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right)\\sin\\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}}\\cos\\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. By making the approximation \\( \\omega T<<1 \\), (14.43) can be simplified to\n\n$$\n\\begin{equation*}\nH\\left(e^{j\\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j\\omega T}\\right)}{V_{i}\\left(e^{j\\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2}/2}{C_{A}}\\right)\\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2C_{A}}\\right)\\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure just described is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the following approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\nj\\omega_{z}T=\\frac{-C_{2}/C_{1}}{1+\\frac{C_{2}}{2C_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the following approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\nj\\omega_{p}T=\\frac{-C_{3}/C_{A}}{1+\\frac{C_{3}}{2C_{A}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value \\( C_{3} \\) needed for a first-order low-pass switched-capacitor filter with \\( C_{1}=0 \\) and a pole at the 1/64th sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for \\( C_{3}/C_{A} \\), we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p}T}{1-\\omega_{p}T/2}=\\frac{2\\pi/64}{1-2\\pi/128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose \\( C_{A}=10 \\text{ pF} \\), then \\( C_{3}=1.032 \\text{ pF} \\). From (14.44) with \\( C_{1}=0 \\), we see that the low-frequency gain is given by \\( C_{2}/C_{3} \\). For unity gain, this means \\( C_{2}=1.032 \\text{ pF} \\) as well."
},
{
    "text": "Key Point: Initiating with conventional continuous-time active RC filters and substituting each resistor with a switched capacitor yields a discrete-time filter whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output derived from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently employed to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), for signal frequencies moderately close to the clock frequency, the behavior of the switched-capacitor circuit is precisely determined using the z-domain signal-flow-graph approach previously outlined.\n\nA general first-order active-RC filter is depicted in Fig. 14.17. To achieve a switched-capacitor filter with equivalent low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are used as they create negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its corresponding signal-flow-graph are illustrated in Fig. 14.18. An equation describing this signal-flow-graph is\n\nimage_name: (a)\ndescription: This circuit is a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to mimic the low-frequency behavior of an active-RC filter. It includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" depicts the equivalent signal-flow graph of a first-order switched-capacitor filter, providing a visual representation of the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, represented by a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are depicted by arrows with labels indicating the gain values:\n  - **-C1(1 - z^-1):** This block represents the weighted input signal with a gain of -C1 and a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other multiplied by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) denote the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), indicating its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The configuration of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, preserving the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nfrom which the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is determined by setting the denominator to zero, resulting in a pole location, $\\mathrm{z}_{\\mathrm{p}}$, given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. In fact, with $C_{3}=0$, the circuit's pole is at $\\mathbf{z}=1$, effectively making it a discrete-time integrator, as expected. The zero of (14.37) is found by setting the numerator to zero, resulting in a zero location, $\\mathbf{z}_{z}$, given by\n\n$$\n\\begin{equation*}\n\\mathrm{z}_{\\mathrm{z}}=\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{1}+\\mathrm{C}_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is determined by setting $z=1$, resulting in the dc gain being\n\n$$\n\\begin{equation*}\n\\mathrm{H}(1)=\\frac{-\\mathrm{C}_{2}}{\\mathrm{C}_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nRecall that in a fully differential implementation, effective negative capacitances can be realized for $\\mathrm{C}_{1}, \\mathrm{C}_{2}$, and $C_{3}$ by swapping the input wires. For instance, a zero at $z=-1$ can be achieved by setting\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{1}=-0.5 \\mathrm{C}_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing $C_{1}$ would be half the size of those representing $C_{2}$, with the input wires interchanged into the $C_{1}$ pair so that $-V_{i}(z)$ is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit such that its $3-\\mathrm{dB}$ point is at 10 kHz with a clock frequency of 100 kHz. Additionally, the filter should have zero gain at 50 kHz and a dc gain of unity. Assume $C_{A}=10 \\mathrm{pF}$.\n\n#### Solution\n\nFirst, note that achieving zero gain at 50 kHz is equivalent to placing a zero at -1. Using the bilinear transform $p=(z-1) /(z+1)$ as described in Section 13.5.4, the zero at -1 maps to $\\Omega=\\infty$. Furthermore, the frequency warping between the two domains, $\\Omega=\\tan (\\omega / 2)$, maps the $-3-\\mathrm{dB}$ frequency of 10 kHz (or $0.2 \\pi \\mathrm{rad} /$ sample) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, our specification simplifies to finding the pole location for a continuous-time filter with a $-3-\\mathrm{dB}$ frequency of $0.3249 \\mathrm{rad} / \\mathrm{s}$ and a zero at $\\infty$. Clearly, the required continuous-time pole, $p_{p}$, is\n\n$$\n\\mathrm{p}_{\\mathrm{p}}=-0.3249\n$$\n\nThis pole maps back to a $\\mathbf{Z}$-domain pole, $\\mathbf{z}_{\\mathrm{p}}$, of value\n\n$$\n\\mathrm{z}_{\\mathrm{p}}=\\frac{1+\\mathrm{p}_{\\mathrm{p}}}{1-\\mathrm{p}_{\\mathrm{p}}}=0.5095\n$$\n\nTherefore, the desired discrete-time transfer function, $H(z)$, is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere k is determined by setting the dc gain to one (i.e., $\\mathrm{H}(1)=1$), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\n\\mathrm{H}(\\mathrm{z})=\\frac{0.4814 \\mathrm{z}+0.4814}{1.9627 \\mathrm{z}-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming $\\mathrm{C}_{\\mathrm{A}}=10 \\mathrm{pF}$) yields\n\n$$\n\\begin{aligned}\n& \\mathrm{C}_{1}=4.814 \\mathrm{pF} \\\\\n& \\mathrm{C}_{2}=-9.628 \\mathrm{pF} \\\\\n& \\mathrm{C}_{3}=9.628 \\mathrm{pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example, which had a zero at one-half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, some approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. Making the approximation $\\omega T<<1$ simplifies (14.43) to\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure just described is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the following approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{z}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{2} / \\mathrm{C}_{1}}{1+\\frac{\\mathrm{C}_{2}}{2 \\mathrm{C}_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the following approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{p}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{3} / \\mathrm{C}_{\\mathrm{A}}}{1+\\frac{\\mathrm{C}_{3}}{2 \\mathrm{C}_{\\mathrm{A}}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value $\\mathrm{C}_{3}$ required for a first-order low-pass switched-capacitor filter with $\\mathrm{C}_{1}=0$ and a pole at the 1/64th sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for $C_{3} / C_{A}$, we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose $C_{A}=10 \\mathrm{pF}$, then $C_{3}=1.032 \\mathrm{pF}$. From (14.44) with $\\mathrm{C}_{1}=0$, we see that the low-frequency gain is $\\mathrm{C}_{2} / \\mathrm{C}_{3}$. For unity gain, this means $\\mathrm{C}_{2}=1.032 \\mathrm{pF}$."
},
{
    "text": "Key Point: Initiating with traditional continuous-time active RC filters and substituting each resistor with a switched capacitor yields a discrete-time filter whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output taken from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently employed to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), their performance at frequencies moderately close to the clock frequency is precisely determined using the z-domain signal-flow-graph approach previously outlined.\n\nA typical first-order active-RC filter is depicted in Fig. 14.17. To achieve a switched-capacitor filter with identical low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are used to create negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its equivalent signal-flow graph are illustrated in Fig. 14.18. An equation describing this signal-flow graph is\n\nimage_name: (a)\ndescription: This circuit is a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to match the low-frequency behavior of an active-RC filter. It includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" depicts the equivalent signal-flow graph of a first-order switched-capacitor filter, providing a visual representation of the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, represented by a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are depicted by arrows with labels indicating the gain values:\n  - **-C1(1 - z^-1):** This block represents the input signal weighted by -C1 with a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) denote the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), indicating its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The configuration of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, preserving the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nFrom this, the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is located by setting the denominator to zero, resulting in a pole position, $\\mathrm{z}_{\\mathrm{p}}$, given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. Indeed, with $C_{3}=0$, the circuit's pole is at $\\mathbf{z}=1$, effectively making it a discrete-time integrator, as expected. The zero of (14.37) is found by setting the numerator to zero, resulting in a zero location, $\\mathbf{z}_{z}$, given by\n\n$$\n\\begin{equation*}\n\\mathrm{z}_{\\mathrm{z}}=\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{1}+\\mathrm{C}_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is determined by setting $z=1$, resulting in the dc gain being\n\n$$\n\\begin{equation*}\n\\mathrm{H}(1)=\\frac{-\\mathrm{C}_{2}}{\\mathrm{C}_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nRecall that in a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}, \\mathrm{C}_{2}$, and $C_{3}$ can be realized by swapping the input wires. For instance, a zero at $z=-1$ can be achieved by setting\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{1}=-0.5 \\mathrm{C}_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing $C_{1}$ would be half the size of those representing $C_{2}$, with the input wires interchanged into the $C_{1}$ pair so that $-V_{i}(z)$ is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit such that its $3-\\mathrm{dB}$ point is at 10 kHz with a clock frequency of 100 kHz. The filter should also have zero gain at 50 kHz and a dc gain of unity. Assume $C_{A}=10 \\mathrm{pF}$.\n\n#### Solution\n\nFirst, note that zero gain at 50 kHz corresponds to placing a zero at -1. Using the bilinear transform $p=(z-1) /(z+1)$ as described in Section 13.5.4, the zero at -1 maps to $\\Omega=\\infty$. Additionally, the frequency warping between domains, $\\Omega=\\tan (\\omega / 2)$, maps the $-3-\\mathrm{dB}$ frequency of 10 kHz (or $0.2 \\pi \\mathrm{rad} /$ sample) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, our specification simplifies to finding the pole location for a continuous-time filter with a $-3-\\mathrm{dB}$ frequency of $0.3249 \\mathrm{rad} / \\mathrm{s}$ and a zero at $\\infty$. Clearly, the required continuous-time pole, $p_{p}$, is\n\n$$\n\\mathrm{p}_{\\mathrm{p}}=-0.3249\n$$\n\nThis pole maps back to a $\\mathbf{Z}$-domain pole, $\\mathbf{z}_{\\mathrm{p}}$, of value\n\n$$\n\\mathrm{z}_{\\mathrm{p}}=\\frac{1+\\mathrm{p}_{\\mathrm{p}}}{1-\\mathrm{p}_{\\mathrm{p}}}=0.5095\n$$\n\nThus, the desired discrete-time transfer function, $H(z)$, is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere k is determined by setting the dc gain to one (i.e., $\\mathrm{H}(1)=1$), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\n\\mathrm{H}(\\mathrm{z})=\\frac{0.4814 \\mathrm{z}+0.4814}{1.9627 \\mathrm{z}-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming $\\mathrm{C}_{\\mathrm{A}}=10 \\mathrm{pF}$) yields\n\n$$\n\\begin{aligned}\n& \\mathrm{C}_{1}=4.814 \\mathrm{pF} \\\\\n& \\mathrm{C}_{2}=-9.628 \\mathrm{pF} \\\\\n& \\mathrm{C}_{3}=9.628 \\mathrm{pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example with a zero at one-half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, some approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. Making the approximation $\\omega T<<1$ simplifies (14.43) to\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure used is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{z}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{2} / \\mathrm{C}_{1}}{1+\\frac{\\mathrm{C}_{2}}{2 \\mathrm{C}_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{p}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{3} / \\mathrm{C}_{\\mathrm{A}}}{1+\\frac{\\mathrm{C}_{3}}{2 \\mathrm{C}_{\\mathrm{A}}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value $\\mathrm{C}_{3}$ required for a first-order low-pass switched-capacitor filter with $\\mathrm{C}_{1}=0$ and a pole at the 1/64th sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for $C_{3} / C_{A}$, we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose $C_{A}=10 \\mathrm{pF}$, then $C_{3}=1.032 \\mathrm{pF}$. From (14.44) with $\\mathrm{C}_{1}=0$, the low-frequency gain is $\\mathrm{C}_{2} / \\mathrm{C}_{3}$. For unity gain, $\\mathrm{C}_{2}$ must also be $1.032 \\mathrm{pF}$."
},
{
    "text": "Key Point: By starting with conventional continuous-time active RC filters and substituting each resistor with a switched capacitor, a discrete-time filter is created whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit depicts a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output taken from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently used to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), for signal frequencies moderately close to the clock frequency, the behavior of the switched-capacitor circuit is precisely determined using the z-domain signal-flow-graph approach previously described.\n\nA general first-order active-RC filter is illustrated in Fig. 14.17. To achieve a switched-capacitor filter with the same low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are used to create negative integration, similar to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its equivalent signal-flow graph are presented in Fig. 14.18. An equation describing this signal-flow graph is\n\nimage_name: (a)\ndescription: This circuit represents a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to mimic the low-frequency behavior of an active-RC filter. It includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" illustrates the equivalent signal-flow graph of a first-order switched-capacitor filter, providing a visual representation of the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, depicted as a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are represented by arrows with labels indicating the gain values:\n  - **-C1(1 - z^-1):** This block represents the input signal weighted by -C1 with a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other multiplied by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is sent to the integrator block, producing the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) indicate the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), denoting its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The arrangement of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the configured capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing a mechanism for controlling the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, maintaining the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nfrom which the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is found by setting the denominator to zero, resulting in a pole location, $\\mathrm{z}_{\\mathrm{p}}$, given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is restricted to the real axis between zero and one, ensuring the circuit's stability. With $C_{3}=0$, the circuit's pole is at $\\mathbf{z}=1$, effectively becoming a discrete-time integrator, as expected. The zero of (14.37) is found by setting the numerator to zero, resulting in a zero location, $\\mathbf{z}_{z}$, given by\n\n$$\n\\begin{equation*}\n\\mathrm{z}_{\\mathrm{z}}=\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{1}+\\mathrm{C}_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is determined by setting $z=1$, resulting in the dc gain being\n\n$$\n\\begin{equation*}\n\\mathrm{H}(1)=\\frac{-\\mathrm{C}_{2}}{\\mathrm{C}_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nIn a fully differential implementation, effective negative capacitances for $\\mathrm{C}_{1}, \\mathrm{C}_{2}$, and $C_{3}$ can be realized by interchanging the input wires. For instance, a zero at $z=-1$ can be achieved by setting\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{1}=-0.5 \\mathrm{C}_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing $C_{1}$ would be half the size of those representing $C_{2}$, with the input wires interchanged into the $C_{1}$ pair so that $-V_{i}(z)$ is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit with a $3-\\mathrm{dB}$ point at 10 kHz using a clock frequency of 100 kHz. The filter should have zero gain at 50 kHz and a dc gain of unity. Assume $C_{A}=10 \\mathrm{pF}$.\n\n#### Solution\n\nFirst, note that zero gain at 50 kHz corresponds to placing a zero at -1. Using the bilinear transform $p=(z-1) /(z+1)$ as described in Section 13.5.4, the zero at -1 maps to $\\Omega=\\infty$. Additionally, the frequency warping between domains, $\\Omega=\\tan (\\omega / 2)$, maps the $-3-\\mathrm{dB}$ frequency of 10 kHz (or $0.2 \\pi \\mathrm{rad} /$ sample) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, the specification simplifies to finding the pole location for a continuous-time filter with a $-3-\\mathrm{dB}$ frequency of $0.3249 \\mathrm{rad} / \\mathrm{s}$ and a zero at $\\infty$. Clearly, the required continuous-time pole, $p_{p}$, is\n\n$$\n\\mathrm{p}_{\\mathrm{p}}=-0.3249\n$$\n\nThis pole maps back to a $\\mathbf{Z}$-domain pole, $\\mathbf{z}_{\\mathrm{p}}$, of value\n\n$$\n\\mathrm{z}_{\\mathrm{p}}=\\frac{1+\\mathrm{p}_{\\mathrm{p}}}{1-\\mathrm{p}_{\\mathrm{p}}}=0.5095\n$$\n\nThus, the desired discrete-time transfer function, $H(z)$, is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere k is determined by setting the dc gain to one (i.e., $\\mathrm{H}(1)=1$), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\n\\mathrm{H}(\\mathrm{z})=\\frac{0.4814 \\mathrm{z}+0.4814}{1.9627 \\mathrm{z}-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming $\\mathrm{C}_{\\mathrm{A}}=10 \\mathrm{pF}$) yields\n\n$$\n\\begin{aligned}\n& \\mathrm{C}_{1}=4.814 \\mathrm{pF} \\\\\n& \\mathrm{C}_{2}=-9.628 \\mathrm{pF} \\\\\n& \\mathrm{C}_{3}=9.628 \\mathrm{pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly less than the clock frequency (unlike the previous example with a zero at one-half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. Making the approximation $\\omega T<<1$ simplifies (14.43) to\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure just described is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{z}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{2} / \\mathrm{C}_{1}}{1+\\frac{\\mathrm{C}_{2}}{2 \\mathrm{C}_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{p}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{3} / \\mathrm{C}_{\\mathrm{A}}}{1+\\frac{\\mathrm{C}_{3}}{2 \\mathrm{C}_{\\mathrm{A}}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value $\\mathrm{C}_{3}$ required for a first-order low-pass switched-capacitor filter with $\\mathrm{C}_{1}=0$ and a pole at 1/64th the sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for $C_{3} / C_{A}$, we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose $C_{A}=10 \\mathrm{pF}$, then $C_{3}=1.032 \\mathrm{pF}$. From (14.44) with $\\mathrm{C}_{1}=0$, we see that the low-frequency gain is $\\mathrm{C}_{2} / \\mathrm{C}_{3}$. For unity gain, this means $\\mathrm{C}_{2}=1.032 \\mathrm{pF}$."
},
{
    "text": "Key Point: Initiating with traditional continuous-time active RC filters and substituting each resistor with a switched capacitor yields a discrete-time filter whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output derived from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor behaves equivalently to a resistor. This equivalence is frequently employed to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), for signal frequencies moderately close to the clock frequency, the behavior of the switched-capacitor circuit is precisely determined using the z-domain signal-flow-graph approach previously outlined.\n\nA typical first-order active-RC filter is depicted in Fig. 14.17. To achieve a switched-capacitor filter with equivalent low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are utilized since they induce negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its corresponding signal-flow-graph are illustrated in Fig. 14.18. An equation describing this signal-flow-graph is\n\nimage_name: (a)\ndescription: This depicts a first-order switched-capacitor filter circuit. The resistors are replaced with delay-free switched capacitors to achieve low-frequency behavior similar to an active-RC filter. The circuit includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" represents the equivalent signal-flow graph of a first-order switched-capacitor filter. This diagram visually depicts the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, depicted as a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are represented by arrows with labels indicating the gain values:\n  - **-C1(1 - z^-1):** This block represents the weighted input signal with a gain of -C1 and a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other multiplied by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) indicate the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), denoting its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The configuration of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, maintaining the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nFrom this, the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is found by setting the denominator to zero, resulting in a pole location, \\( z_{p} \\), given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. In fact, with \\( C_{3}=0 \\), the circuit's pole is at \\( z=1 \\), effectively making it a discrete-time integrator, as expected. The zero of (14.37) is determined by setting the numerator to zero, resulting in a zero location, \\( z_{z} \\), given by\n\n$$\n\\begin{equation*}\nz_{z}=\\frac{C_{1}}{C_{1}+C_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is found by setting \\( z=1 \\), resulting in the dc gain being\n\n$$\n\\begin{equation*}\nH(1)=\\frac{-C_{2}}{C_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nRecall that in a fully differential implementation, effective negative capacitances can be realized for \\( C_{1}, C_{2} \\), and \\( C_{3} \\) by swapping the input wires. For instance, a zero at \\( z=-1 \\) can be achieved by setting\n\n$$\n\\begin{equation*}\nC_{1}=-0.5 C_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing \\( C_{1} \\) would be half the size of those representing \\( C_{2} \\), with the input wires interchanged into the \\( C_{1} \\) pair so that \\( -V_{i}(z) \\) is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit such that its 3-dB point is at 10 kHz with a clock frequency of 100 kHz. Additionally, the filter should have zero gain at 50 kHz and a dc gain of unity. Assume \\( C_{A}=10 \\text{ pF} \\).\n\n#### Solution\n\nFirst, note that achieving zero gain at 50 kHz equates to placing a zero at -1. Using the bilinear transform \\( p=(z-1) /(z+1) \\) as described in Section 13.5.4, the zero at -1 maps to \\( \\Omega=\\infty \\). Furthermore, the frequency warping between the domains, \\( \\Omega=\\tan (\\omega / 2) \\), maps the 3-dB frequency of 10 kHz (or \\( 0.2 \\pi \\text{ rad} / \\text{sample} \\)) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, our specification simplifies to finding the pole location for a continuous-time filter with a 3-dB frequency of \\( 0.3249 \\text{ rad} / \\text{s} \\) and a zero at \\( \\infty \\). Clearly, the required continuous-time pole, \\( p_{p} \\), is\n\n$$\np_{p}=-0.3249\n$$\n\nThis pole maps back to a Z-domain pole, \\( z_{p} \\), of\n\n$$\nz_{p}=\\frac{1+p_{p}}{1-p_{p}}=0.5095\n$$\n\nTherefore, the desired discrete-time transfer function, \\( H(z) \\), is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere \\( k \\) is determined by setting the dc gain to one (i.e., \\( H(1)=1 \\)), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\nH(z)=\\frac{0.4814z+0.4814}{1.9627z-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming \\( C_{A}=10 \\text{ pF} \\)) yields\n\n$$\n\\begin{aligned}\n& C_{1}=4.814 \\text{ pF} \\\\\n& C_{2}=-9.628 \\text{ pF} \\\\\n& C_{3}=9.628 \\text{ pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example, which had a zero at one-half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, some approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. Making the approximation \\( \\omega T<<1 \\) simplifies (14.43) to\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure just described is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\nj \\omega_{z} T=\\frac{-C_{2} / C_{1}}{1+\\frac{C_{2}}{2 C_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\nj \\omega_{p} T=\\frac{-C_{3} / C_{A}}{1+\\frac{C_{3}}{2 C_{A}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value \\( C_{3} \\) required for a first-order low-pass switched-capacitor filter with \\( C_{1}=0 \\) and a pole at the 1/64th sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for \\( C_{3} / C_{A} \\), we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose \\( C_{A}=10 \\text{ pF} \\), then \\( C_{3}=1.032 \\text{ pF} \\). From (14.44) with \\( C_{1}=0 \\), we see that the low-frequency gain is \\( C_{2} / C_{3} \\). For unity gain, this means \\( C_{2}=1.032 \\text{ pF} \\)."
},
{
    "text": "Key Point: Initiating with conventional continuous-time active RC filters and substituting each resistor with a switched capacitor yields a discrete-time filter whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected via R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output derived from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently employed to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), for signal frequencies moderately close to the clock frequency, the behavior of the switched-capacitor circuit is precisely determined using the z-domain signal-flow-graph approach previously outlined.\n\nA general first-order active-RC filter is depicted in Fig. 14.17. To achieve a switched-capacitor filter with equivalent low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are used as they create negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its corresponding signal-flow-graph are illustrated in Fig. 14.18. An equation describing this signal-flow-graph is\n\nimage_name: (a)\ndescription: This circuit is a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to achieve low-frequency behavior similar to an active-RC filter. The circuit includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" depicts the equivalent signal-flow graph of a first-order switched-capacitor filter, providing a visual representation of the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, represented by a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are depicted by arrows with labels indicating their gain values:\n  - **-C1(1 - z^-1):** This block represents the weighted input signal with a gain of -C1 and a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other multiplied by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) indicate the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), denoting its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The arrangement of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the configured capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, maintaining the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nFrom this, the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is determined by setting the denominator to zero, resulting in a pole location, $\\mathrm{z}_{\\mathrm{p}}$, given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. In fact, with $C_{3}=0$, the circuit's pole is at $\\mathbf{z}=1$, effectively making it a discrete-time integrator, as expected. The zero of (14.37) is found by setting the numerator to zero, resulting in a zero location, $\\mathbf{z}_{z}$, given by\n\n$$\n\\begin{equation*}\n\\mathrm{z}_{\\mathrm{z}}=\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{1}+\\mathrm{C}_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is determined by setting $z=1$, resulting in the dc gain being\n\n$$\n\\begin{equation*}\n\\mathrm{H}(1)=\\frac{-\\mathrm{C}_{2}}{\\mathrm{C}_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nRecall that in a fully differential implementation, effective negative capacitances can be realized for $\\mathrm{C}_{1}, \\mathrm{C}_{2}$, and $C_{3}$ by interchanging the input wires. For instance, a zero at $z=-1$ can be achieved by setting\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{1}=-0.5 \\mathrm{C}_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing $C_{1}$ would be half the size of those representing $C_{2}$, with the input wires interchanged into the $C_{1}$ pair so that $-V_{i}(z)$ is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit such that its $3-\\mathrm{dB}$ point is at 10 kHz with a clock frequency of 100 kHz. Additionally, the filter should have zero gain at 50 kHz and a dc gain of unity. Assume $C_{A}=10 \\mathrm{pF}$.\n\n#### Solution\n\nFirst, note that zero gain at 50 kHz corresponds to placing a zero at -1. Using the bilinear transform $p=(z-1) /(z+1)$ as described in Section 13.5.4, the zero at -1 maps to $\\Omega=\\infty$. Also, the frequency warping between the two domains, $\\Omega=\\tan (\\omega / 2)$, maps the $-3-\\mathrm{dB}$ frequency of 10 kHz (or $0.2 \\pi \\mathrm{rad} /$ sample) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, the specification simplifies to finding the pole location for a continuous-time filter with a $-3-\\mathrm{dB}$ frequency of $0.3249 \\mathrm{rad} / \\mathrm{s}$ and a zero at $\\infty$. Clearly, the required continuous-time pole, $p_{p}$, is\n\n$$\n\\mathrm{p}_{\\mathrm{p}}=-0.3249\n$$\n\nThis pole maps back to a $\\mathbf{Z}$-domain pole, $\\mathbf{z}_{\\mathrm{p}}$, of value\n\n$$\n\\mathrm{z}_{\\mathrm{p}}=\\frac{1+\\mathrm{p}_{\\mathrm{p}}}{1-\\mathrm{p}_{\\mathrm{p}}}=0.5095\n$$\n\nTherefore, the desired discrete-time transfer function, $H(z)$, is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere k is determined by setting the dc gain to one (i.e., $\\mathrm{H}(1)=1$), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\n\\mathrm{H}(\\mathrm{z})=\\frac{0.4814 \\mathrm{z}+0.4814}{1.9627 \\mathrm{z}-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming $\\mathrm{C}_{\\mathrm{A}}=10 \\mathrm{pF}$) results in\n\n$$\n\\begin{aligned}\n& \\mathrm{C}_{1}=4.814 \\mathrm{pF} \\\\\n& \\mathrm{C}_{2}=-9.628 \\mathrm{pF} \\\\\n& \\mathrm{C}_{3}=9.628 \\mathrm{pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example, which had a zero at one-half the clock frequency), it is unnecessary to pre-warp the specifications using the bilinear transform. Instead, some approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. Making the approximation $\\omega T<<1$ allows (14.43) to be simplified as\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure just described is quite useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero gives the following approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{z}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{2} / \\mathrm{C}_{1}}{1+\\frac{\\mathrm{C}_{2}}{2 \\mathrm{C}_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the following approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{p}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{3} / \\mathrm{C}_{\\mathrm{A}}}{1+\\frac{\\mathrm{C}_{3}}{2 \\mathrm{C}_{\\mathrm{A}}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value $\\mathrm{C}_{3}$ required for a first-order low-pass switched-capacitor filter with $\\mathrm{C}_{1}=0$ and a pole at the 1/64th sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for $C_{3} / C_{A}$, we have\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose $C_{A}=10 \\mathrm{pF}$, then $C_{3}=1.032 \\mathrm{pF}$. From (14.44) with $\\mathrm{C}_{1}=0$, we see that the low-frequency gain is given by $\\mathrm{C}_{2} / \\mathrm{C}_{3}$. For unity gain, this means we need $\\mathrm{C}_{2}=1.032 \\mathrm{pF}$ as well."
},
{
    "text": "Key Point: By starting with traditional continuous-time active RC filters and substituting each resistor with a switched capacitor, a discrete-time filter is created whose frequency response closely mirrors that of the original continuous-time filter at frequencies significantly below the sampling frequency. Once the filter structure is established, its precise frequency response is determined through discrete-time analysis.\n\nimage_name: Fig. 14.17\ndescription: This circuit represents a first-order active-RC filter utilizing an operational amplifier. The input is connected through R1 and C1 to the inverting input of the op-amp. The feedback network comprises R2 and C2, with the output taken from the op-amp's output terminal.\n\nFig. 14.17 A first-order active-RC filter.\n\nAs discussed in Section 14.2.1, at low frequencies, a switched capacitor is equivalent to a resistor. This equivalence is frequently used to derive effective switched-capacitor filter structures from their active-RC counterparts. However, while these structures exhibit similar behavior for low-frequency input signals (relative to the clock frequency), their behavior at signal frequencies near the clock frequency is accurately determined using the z-domain signal-flow-graph approach previously described.\n\nA general first-order active-RC filter is depicted in Fig. 14.17. To achieve a switched-capacitor filter with identical low-frequency behavior, the resistors are replaced with delay-free switched capacitors (delay-free inputs are employed as they produce negative integration, akin to resistive inputs), while the nonswitched capacitor feed-in remains unchanged. The resulting first-order switched-capacitor filter and its equivalent signal-flow graph are illustrated in Fig. 14.18. An equation describing this signal-flow graph is\n\nimage_name: (a)\ndescription: This circuit is a first-order switched-capacitor filter where resistors are replaced with delay-free switched capacitors to match the low-frequency behavior of an active-RC filter. It includes capacitors C1, C2, C3, CA, and an operational amplifier A1.\n\nimage_name: (b)\ndescription: The block diagram labeled \"(b)\" depicts the equivalent signal-flow graph of a first-order switched-capacitor filter, providing a visual representation of the filter's mathematical model and signal processing function.\n\n1. **Main Components:**\n- **Adder Node:** This central component sums multiple input signals, represented by a circle with incoming arrows indicating the summation of various weighted signals.\n- **Gain Blocks:** Three gain blocks are depicted as arrows with labels indicating their gain values:\n  - **-C1(1 - z^-1):** This block represents the input signal weighted by -C1 with a delay factor of (1 - z^-1).\n  - **-C2:** This block represents another input signal weighted by -C2.\n  - **-C3:** This block represents a feedback path weighted by -C3.\n- **Integrator Block:** Represented by a block labeled \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), it models the integration operation in the z-domain, a characteristic of switched-capacitor filters.\n\n2. **Flow of Information or Control:**\n- The input signal \\( V_i(z) \\) enters the system and splits into two paths: one directly multiplied by \\(-C2\\) and the other by \\(-C1(1 - z^{-1})\\) before reaching the adder.\n- The adder's output is directed to the integrator block, which generates the output \\( V_o(z) \\).\n- A feedback loop exists where the output \\( V_o(z) \\) is multiplied by \\(-C3\\) and fed back into the adder, contributing to the integrator's input.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The labels \\(-C1(1 - z^{-1})\\), \\(-C2\\), and \\(-C3\\) indicate the weights and operations applied to the respective signals in the flow graph.\n- The integrator block is annotated with \\( \\frac{1}{C_A} \\frac{1}{1 - z^{-1}} \\), denoting its function as a discrete-time integrator in the z-domain.\n\n4. **Overall System Function:**\n- This system functions as a first-order switched-capacitor filter. The configuration of gain blocks, adder, and integrator modifies the input signal \\( V_i(z) \\) based on the capacitive ratios \\( C_1, C_2, C_3, \\) and \\( C_A \\). The feedback loop with \\(-C3\\) allows for dynamic adjustment of the filter's response, providing control over the frequency characteristics of the output signal \\( V_o(z) \\). The system effectively translates analog filter design into the digital domain using switched-capacitor techniques, preserving the desired low-frequency behavior.\n\nFig. 14.18 A first-order switched-capacitor filter: (a) circuit (no switch sharing), (b) equivalent signal-flow-graph.\nFrom this, the transfer function for this first-order filter is derived as\n\n$$\n\\begin{align*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} & =-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(1-z^{-1}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right)}{1-z^{-1}+\\frac{C_{3}}{C_{A}}}  \\tag{14.37}\\\\\n& =-\\frac{\\left(\\frac{C_{1}+C_{2}}{C_{A}}\\right) z-\\frac{C_{1}}{C_{A}}}{\\left(1+\\frac{C_{3}}{C_{A}}\\right) z-1}\n\\end{align*}\n$$\n\nThe pole of (14.37) is found by setting the denominator to zero, resulting in a pole location, \\( z_p \\), given by\n\n$$\n\\begin{equation*}\nz_{p}=\\frac{C_{A}}{C_{A}+C_{3}} \\tag{14.38}\n\\end{equation*}\n$$\n\nNote that for positive capacitance values, this pole is confined to the real axis between zero and one, ensuring the circuit's stability. In fact, with \\( C_{3}=0 \\), the circuit's pole is at \\( z=1 \\), effectively becoming a discrete-time integrator, as expected. The zero of (14.37) is determined by setting the numerator to zero, resulting in a zero location, \\( z_z \\), given by\n\n$$\n\\begin{equation*}\n\\mathrm{z}_{\\mathrm{z}}=\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{1}+\\mathrm{C}_{2}} \\tag{14.39}\n\\end{equation*}\n$$\n\nThus, for positive capacitance values, this zero location is also restricted to the real axis between zero and one. Additionally, the dc gain for this circuit is found by setting \\( z=1 \\), yielding\n\n$$\n\\begin{equation*}\n\\mathrm{H}(1)=\\frac{-\\mathrm{C}_{2}}{\\mathrm{C}_{3}} \\tag{14.40}\n\\end{equation*}\n$$\n\nRecall that in a fully differential implementation, effective negative capacitances can be realized for \\( \\mathrm{C}_{1}, \\mathrm{C}_{2} \\), and \\( C_{3} \\) by swapping the input wires. For instance, a zero at \\( z=-1 \\) can be achieved by setting\n\n$$\n\\begin{equation*}\n\\mathrm{C}_{1}=-0.5 \\mathrm{C}_{2} \\tag{14.41}\n\\end{equation*}\n$$\n\nIn other words, the capacitors representing \\( C_{1} \\) would be half the size of those representing \\( C_{2} \\), with the input wires interchanged into the \\( C_{1} \\) pair so that \\( -V_{i}(z) \\) is applied to that input branch.\n\n#### EXAMPLE 14.3\n\nDetermine the capacitance values required for a first-order switched-capacitor circuit such that its 3-dB point is at 10 kHz with a clock frequency of 100 kHz. Additionally, the filter should have zero gain at 50 kHz and a dc gain of unity. Assume \\( C_{A}=10 \\mathrm{pF} \\).\n\n#### Solution\n\nFirst, note that achieving zero gain at 50 kHz equates to placing a zero at -1. Using the bilinear transform \\( p=(z-1) /(z+1) \\) as described in Section 13.5.4, the zero at -1 maps to \\( \\Omega=\\infty \\). Furthermore, the frequency warping between the two domains, \\( \\Omega=\\tan (\\omega / 2) \\), maps the 3-dB frequency of 10 kHz (or \\( 0.2 \\pi \\mathrm{rad} / \\) sample) in the Z-domain to\n\n$$\n\\Omega=\\tan \\left(\\frac{0.2 \\pi}{2}\\right)=0.3249\n$$\n\nin the continuous-time domain. Thus, our specification simplifies to finding the pole location for a continuous-time filter with a 3-dB frequency of \\( 0.3249 \\mathrm{rad} / \\mathrm{s} \\) and a zero at \\( \\infty \\). Clearly, the required continuous-time pole, \\( p_p \\), is\n\n$$\n\\mathrm{p}_{\\mathrm{p}}=-0.3249\n$$\n\nThis pole maps back to a Z-domain pole, \\( z_p \\), of value\n\n$$\n\\mathrm{z}_{\\mathrm{p}}=\\frac{1+\\mathrm{p}_{\\mathrm{p}}}{1-\\mathrm{p}_{\\mathrm{p}}}=0.5095\n$$\n\nTherefore, the desired discrete-time transfer function, \\( H(z) \\), is\n\n$$\nH(z)=\\frac{k(z+1)}{z-0.5095}\n$$\n\nwhere k is determined by setting the dc gain to one (i.e., \\( \\mathrm{H}(1)=1 \\)), resulting in\n\n$$\nH(z)=\\frac{0.24525(z+1)}{z-0.5095}\n$$\n\nor equivalently,\n\n$$\n\\mathrm{H}(\\mathrm{z})=\\frac{0.4814 \\mathrm{z}+0.4814}{1.9627 \\mathrm{z}-1}\n$$\n\nEquating these coefficients with those of (14.37) (and assuming \\( \\mathrm{C}_{\\mathrm{A}}=10 \\mathrm{pF} \\)) yields\n\n$$\n\\begin{aligned}\n& \\mathrm{C}_{1}=4.814 \\mathrm{pF} \\\\\n& \\mathrm{C}_{2}=-9.628 \\mathrm{pF} \\\\\n& \\mathrm{C}_{3}=9.628 \\mathrm{pF}\n\\end{aligned}\n$$\n\nwhere a differential input can realize the negative capacitance.\n\nFor designs where the zero and pole frequencies are significantly lower than the clock frequency (unlike the previous example, which had a zero at one-half the clock frequency), it is not necessary to pre-warp the specifications using the bilinear transform. Instead, some approximations can be used to derive equations for the capacitor ratios given the desired zero and pole, both assumed to be real and positive. As in Example 14.2, using (14.37), we have\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{\\left(\\frac{C_{1}}{C_{A}}\\right)\\left(z^{1 / 2}-z^{-1 / 2}\\right)+\\left(\\frac{C_{2}}{C_{A}}\\right) z^{1 / 2}}{z^{1 / 2}-z^{-1 / 2}+\\frac{C_{3}}{C_{A}} z^{1 / 2}} \\tag{14.42}\n\\end{equation*}\n$$\n\nSubstituting (14.15) and (14.16) into (14.42) gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j \\frac{2 C_{1}+C_{2}}{C_{A}} \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{2}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)}{j\\left(2+\\frac{C_{3}}{C_{A}}\\right) \\sin \\left(\\frac{\\omega T}{2}\\right)+\\frac{C_{3}}{C_{A}} \\cos \\left(\\frac{\\omega T}{2}\\right)} \\tag{14.43}\n\\end{equation*}\n$$\n\nThis transfer function is exact. By making the approximation \\( \\omega T<<1 \\), (14.43) can be simplified to\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{j\\left(\\frac{C_{1}+C_{2} / 2}{C_{A}}\\right) \\omega T+\\frac{C_{2}}{C_{A}}}{j\\left(1+\\frac{C_{3}}{2 C_{A}}\\right) \\omega T+\\frac{C_{3}}{C_{A}}} \\tag{14.44}\n\\end{equation*}\n$$\n\nThe procedure just described is useful for finding a continuous-time transfer function that approximates a discrete-time transfer function. Setting the numerator of (14.44) to zero yields the following approximate equation for the zero frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{z}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{2} / \\mathrm{C}_{1}}{1+\\frac{\\mathrm{C}_{2}}{2 \\mathrm{C}_{1}}} \\tag{14.45}\n\\end{equation*}\n$$\n\nSimilarly, setting the denominator to zero gives the following approximate equation for the pole frequency:\n\n$$\n\\begin{equation*}\n\\mathrm{j} \\omega_{\\mathrm{p}} \\mathrm{~T}=\\frac{-\\mathrm{C}_{3} / \\mathrm{C}_{\\mathrm{A}}}{1+\\frac{\\mathrm{C}_{3}}{2 \\mathrm{C}_{\\mathrm{A}}}} \\tag{14.46}\n\\end{equation*}\n$$\n\n#### EXAMPLE 14.4\n\nFind the capacitance value \\( \\mathrm{C}_{3} \\) needed for a first-order low-pass switched-capacitor filter with \\( \\mathrm{C}_{1}=0 \\) and a pole at the 1/64th sampling frequency using the approximate equations. The low-frequency gain should be unity.\n\n#### Solution\n\nUsing (14.46) and solving for \\( C_{3} / C_{A} \\), we get\n\n$$\n\\begin{equation*}\n\\frac{C_{3}}{C_{A}}=\\frac{\\omega_{p} T}{1-\\omega_{p} T / 2}=\\frac{2 \\pi / 64}{1-2 \\pi / 128}=0.1032 \\tag{14.47}\n\\end{equation*}\n$$\n\nIf we choose \\( C_{A}=10 \\mathrm{pF} \\), then \\( C_{3}=1.032 \\mathrm{pF} \\). From (14.44) with \\( \\mathrm{C}_{1}=0 \\), we see that the low-frequency gain is \\( \\mathrm{C}_{2} / \\mathrm{C}_{3} \\). For unity gain, this means \\( \\mathrm{C}_{2}=1.032 \\mathrm{pF} \\) as well."
},
{
    "text": "While the circuits discussed so far have been depicted with single-ended signals, in most analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, thereby ensuring that any noise appearing as a common-mode signal on those lines does not affect the signal. Fully differential circuits should also be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (usually analog ground or midway between the power-supply voltages). Balanced circuits are more likely to experience noise as a common-mode signal due to their symmetry. Additionally, fully differential circuits offer the benefit that if each single-ended signal is symmetrically distorted around the common-mode voltage, the differential signal will exhibit only odd-order distortion terms, which are typically smaller. This distortion improvement can be observed in the block diagram shown in Fig. 14.20, where two identical nonlinear elements are assumed, and for simplicity, the common-mode voltage is taken as zero. If the nonlinearity is memoryless, the outputs can be expressed as a Taylor series:\n\nKey Point: Fully-differential filter implementations provide several advantages over single-ended versions: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which usually dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constants. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (usually smaller than second-order terms). Given these significant advantages, most modern switched-capacitor circuits employ fully differential structures.\n\nA fully differential version of the first-order filter is illustrated in Fig. 14.21. Note that this version essentially consists of two single-ended versions, which might suggest it would require twice the integrated area. However, the area penalty is not that substantial. Firstly, only one opamp is needed, though it does require additional common-mode feedback circuitry. Secondly, the input and output signal swings are now doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Therefore, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended version. Consequently, switch sizes can also be reduced to meet the same settling-time requirements. However, the fully differential circuit includes more switches and wiring, making it somewhat larger than its single-ended counterpart, though properly designed, it should be significantly less than twice the size. Moreover, the fully differential circuit offers enhanced common-mode noise rejection and better distortion performance.\n\nKey Point: Despite the additional overhead for wiring and common-mode feedback circuitry in fully-differential implementations, if designed correctly, this overhead should constitute only a small fraction of the overall circuit."
},
{
    "text": "While the circuits discussed thus far have all been illustrated with single-ended signals, in the majority of analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, so any noise appearing as a common-mode signal on these lines does not impact the signal. Additionally, fully differential circuits should be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (usually analog ground or midway between the power-supply voltages). Balanced circuits are more likely to experience noise as a common-mode signal due to their symmetry. Another advantage of fully differential circuits is that if each single-ended signal is symmetrically distorted around the common-mode voltage, the differential signal will exhibit only odd-order distortion terms, which are generally smaller. This distortion improvement can be observed in the block diagram in Fig. 14.20, where identical nonlinear elements are used, and for simplicity, the common-mode voltage is assumed to be zero. If the nonlinearity is memoryless, the outputs can be expressed as a Taylor series:\n\nKey Point: Fully-differential filter implementations offer several benefits over single-ended versions: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which typically dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constants. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (usually smaller than second-order terms). Given these significant advantages, most contemporary switched-capacitor circuits are implemented using fully differential structures.\n\nA fully differential version of the first-order filter is depicted in Fig. 14.21. It is essentially two single-ended versions, which might suggest a doubling of the integrated area requirement. However, the actual increase in area is not as substantial. Firstly, only one opamp is needed, though it does require additional common-mode feedback circuitry. Secondly, the input and output signal swings are doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Therefore, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended version. Consequently, switch sizes can also be reduced to meet the same settling-time requirements. However, the fully differential circuit involves more switches and wiring, making it somewhat larger than its single-ended counterpart, but if well-designed, it should be significantly less than twice the size. Moreover, the fully differential circuit excels in rejecting common-mode noise and offers superior distortion performance.\n\nKey Point: Despite the additional overhead for extra wiring and common-mode feedback circuitry in fully-differential implementations, a well-designed circuit should incur only a minor fraction of the overall overhead."
},
{
    "text": "While the circuits discussed thus far have all been depicted with single-ended signals, in most analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, so any noise appearing as a common-mode signal on those lines does not impact the signal. Fully differential circuits should also be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (usually analog ground or midway between the power-supply voltages). Balanced circuits are more likely to experience noise as a common-mode signal due to their symmetry. Additionally, fully differential circuits offer the benefit that if each single-ended signal is symmetrically distorted around the common-mode voltage, the differential signal will exhibit only odd-order distortion terms, which are typically smaller. This distortion improvement can be observed in the block diagram in Fig. 14.20, where two identical nonlinear elements are assumed, and the common-mode voltage is taken as zero. If the nonlinearity is memoryless, the outputs can be expressed as a Taylor series:\n\nKey Point: Fully-differential filter implementations provide several advantages over single-ended versions: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which often dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constants. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (usually smaller than the second-order term). Given these advantages, most modern switched-capacitor circuits are implemented using fully differential structures.\n\nA fully differential version of the first-order filter is illustrated in Fig. 14.21. Note that this version essentially consists of two single-ended versions, which might suggest it would require twice the integrated area. However, the area increase is not that significant. Firstly, only one opamp is needed, though it requires additional common-mode feedback circuitry. Secondly, the input and output signal swings are doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the peak-to-peak signal swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Therefore, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended version. Consequently, switch sizes can also be reduced to meet the same settling-time requirements. However, the fully differential circuit has more switches and wiring, making it somewhat larger than its single-ended counterpart, though properly designed, it should be significantly less than twice the size. Additionally, the fully differential circuit offers superior common-mode noise rejection and better distortion performance.\n\nKey Point: Despite the additional overhead for wiring and common-mode feedback circuitry in fully-differential implementations, if designed correctly, this overhead should constitute only a small fraction of the overall circuit."
},
{
    "text": "Although the circuits previously discussed have all utilized single-ended signals, in most analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, thereby ensuring that any noise appearing as a common-mode signal on these lines does not impact the signal. Additionally, fully differential circuits should be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage, typically analog ground or midway between the power-supply voltages. Balanced circuits increase the likelihood of noise occurring as a common-mode signal due to circuit symmetry. An added benefit of fully differential circuits is that if each single-ended signal experiences symmetrical distortion around the common-mode voltage, the differential signal will primarily exhibit odd-order distortion terms, which are generally smaller. This distortion improvement can be observed in the block diagram in Fig. 14.20, where identical nonlinear elements are assumed, and for simplicity, the common-mode voltage is set to zero. If the nonlinearity is memoryless, the outputs can be expressed using a Taylor series expansion:\n\nKey Point: Fully-differential filter implementations offer several advantages over single-ended versions: they facilitate sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which typically dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constants. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (usually smaller than second-order terms). Given these significant advantages, most contemporary switched-capacitor circuits employ fully differential structures.\n\nA fully differential version of the first-order filter is depicted in Fig. 14.21. It is important to note that this fully differential design essentially consists of two single-ended versions, which might suggest a doubling of the integrated area requirement. However, the actual increase in area is not as substantial. Firstly, only one opamp is needed, though it does require additional common-mode feedback circuitry. Secondly, the input and output signal swings are now doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Consequently, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential design can be half the size of those in the single-ended version. ${ }^{3}$ Smaller capacitors allow for reduced switch sizes to meet the same settling-time requirements. Nevertheless, the fully differential circuit involves more switches and wiring, making it somewhat larger than its single-ended counterpart, but if well-designed, it should be significantly less than twice the size. Furthermore, the fully differential circuit offers enhanced common-mode noise rejection and better distortion performance.\n\nKey Point: Despite the additional overhead for wiring and common-mode feedback circuitry in fully-differential implementations, a well-designed circuit should ensure that this overhead constitutes only a minor fraction of the overall circuit."
},
{
    "text": "While the circuits discussed thus far have all been illustrated with single-ended signals, in most analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, thereby ensuring that any noise appearing as a common-mode signal on those lines does not affect the signal. Fully differential circuits should also be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (usually analog ground or midway between the power-supply voltages). Balanced circuits increase the likelihood that noise will manifest as a common-mode signal due to the circuit's symmetry. Additionally, fully differential circuits offer the benefit that if each single-ended signal is symmetrically distorted around the common-mode voltage, the differential signal will exhibit only odd-order distortion terms, which are typically much smaller. This distortion improvement can be observed in the block diagram shown in Fig. 14.20, where two identical nonlinear elements are assumed, and for simplicity, the common-mode voltage is taken as zero. If the nonlinearity is memoryless, the outputs can be expressed as a Taylor series expansion:\n\nKey Point: Fully-differential filter implementations provide several advantages over their single-ended counterparts: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which usually dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constant terms. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (which are generally smaller than the second-order term). With these significant advantages, most contemporary switched-capacitor circuits are implemented using fully differential structures.\n\nA fully differential version of the first-order filter is depicted in Fig. 14.21. Note that this fully differential version essentially consists of two copies of the single-ended version, which might suggest it would require twice the integrated area. Fortunately, the increase in area is not as substantial. Firstly, only one opamp is needed, though it does require additional common-mode feedback circuitry. Secondly, the input and output signal swings are now doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak signal swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Thus, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended case. Consequently, smaller capacitors allow for reduced switch sizes to meet the same settling-time requirements. However, the fully differential circuit involves more switches and wiring, making it somewhat larger than its single-ended counterpart, but properly designed, it should be significantly less than twice the size. Furthermore, the fully differential circuit offers superior common-mode noise rejection and better distortion performance.\n\nKey Point: Although fully-differential circuit implementations entail additional overhead for extra wiring and common-mode feedback circuitry, if properly designed, this overhead should constitute a minor fraction of the overall circuit."
},
{
    "text": "While the circuits discussed thus far have exclusively featured single-ended signals, in the majority of analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, thereby ensuring that any noise appearing as a common-mode signal on these lines does not impact the signal. Fully differential circuits should also be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (usually analog ground or the midpoint between the power-supply voltages). Balanced circuits are more likely to experience noise as a common-mode signal due to their symmetry. Additionally, fully differential circuits offer the benefit that if each single-ended signal is symmetrically distorted around the common-mode voltage, the resulting differential signal will contain only odd-order distortion terms, which are typically much smaller. To illustrate this improvement in distortion, consider the block diagram in Fig. 14.20, where two identical nonlinear elements are assumed, and for simplicity, the common-mode voltage is set to zero. If the nonlinearity is memoryless, the outputs can be expressed using a Taylor series expansion:\n\nKey Point: Fully-differential filter implementations provide several advantages over single-ended versions: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which often dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constant terms. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (usually smaller than second-order terms). With these significant advantages, most contemporary switched-capacitor circuits are implemented using fully differential structures.\n\nA fully differential version of the first-order filter is depicted in Fig. 14.21. Note that the fully differential design essentially consists of two single-ended versions, which might suggest it would require twice the integrated area. However, the actual increase in area is not as substantial. Firstly, only one opamp is needed, albeit with additional common-mode feedback circuitry. Secondly, the input and output signal swings are now doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Consequently, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended version. ${ }^{3}$ Smaller capacitors allow for reduced switch sizes to meet the same settling-time requirements. However, the fully differential circuit includes more switches and wiring, making it somewhat larger than its single-ended counterpart, though, if well-designed, significantly less than twice the size. Additionally, the fully differential circuit offers superior common-mode noise rejection and better distortion performance.\n\nKey Point: Despite the additional overhead for wiring and common-mode feedback circuitry in fully-differential implementations, a well-designed circuit should ensure that this overhead constitutes only a minor fraction of the overall circuit."
},
{
    "text": "While the circuits shown thus far have all utilized single-ended signals, in most analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, ensuring that any noise appearing as a common-mode signal on those lines does not affect the signal. Fully differential circuits should also be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (typically analog ground or midway between the power-supply voltages). Balanced circuits are more likely to experience noise as a common-mode signal due to their symmetry. Additionally, fully differential circuits offer the benefit that if each single-ended signal is symmetrically distorted around the common-mode voltage, the differential signal will exhibit only odd-order distortion terms, which are usually smaller. This distortion improvement can be observed in the block diagram in Fig. 14.20, where identical nonlinear elements are used, and the common-mode voltage is assumed to be zero. If the nonlinearity is memoryless, the outputs can be expressed as a Taylor series expansion:\n\nKey Point: Fully-differential filter implementations provide several advantages over single-ended versions: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which typically dominate in single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constants. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (which are generally smaller than second-order terms). Given these advantages, most modern switched-capacitor circuits are implemented using fully differential structures.\n\nA fully differential version of the first-order filter is depicted in Fig. 14.21. Note that the fully differential design essentially consists of two copies of the single-ended version, which might suggest it would require twice the integrated area. However, the area penalty is not that significant. Firstly, only one opamp is needed, though it does require additional common-mode feedback circuitry. Secondly, the input and output signal swings are doubled in size. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak signal swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Thus, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended case. Consequently, smaller capacitors and potentially smaller switch sizes can be used to meet the same settling-time requirements. However, the fully differential circuit has more switches and wiring, making it somewhat larger than its single-ended counterpart, but if well-designed, it should be significantly less than twice the size. Furthermore, the fully differential circuit offers superior common-mode noise rejection and better distortion performance.\n\nKey Point: Despite the additional overhead for wiring and common-mode feedback circuitry in fully-differential implementations, a well-designed circuit should incur only a minor fraction of the overall overhead."
},
{
    "text": "While the circuits examined thus far have all been illustrated with single-ended signals, in most analog applications, it is preferable to maintain fully differential signals. Fully differential signals mean that the signal component is represented by the difference between two lines, so any noise appearing as a common-mode signal on these lines does not affect the signal. Fully differential circuits should also be balanced, meaning the differential signals operate symmetrically around a dc common-mode voltage (usually analog ground or midway between the power-supply voltages). Balanced circuits are more likely to experience noise as a common-mode signal due to their symmetry. Additionally, fully differential circuits offer the benefit that if each single-ended signal is symmetrically distorted around the common-mode voltage, the differential signal will contain only odd-order distortion terms (which are generally smaller). To understand this distortion improvement, consider the block diagram in Fig. 14.20, where two identical nonlinear elements are used, and for simplicity, the common-mode voltage is assumed to be zero. If the nonlinearity is memoryless, the outputs can be expressed as a Taylor series expansion:\n\nKey Point: Fully-differential filter implementations provide several advantages over single-ended versions: they enable sign inversion (i.e., a gain of -1) by simply swapping wires, reject common-mode noise, and eliminate even-order distortion terms, which typically dominate single-ended circuits.\n\n$$\n\\begin{equation*}\nv_{o}=k_{1} v_{i}+k_{2} v_{i}^{2}+k_{3} v_{i}^{3}+k_{4} v_{i}^{4}+\\cdots \\tag{14.48}\n\\end{equation*}\n$$\n\nHere, $\\mathrm{k}_{\\mathrm{i}}$ are constants. In this scenario, the differential output signal, $\\mathrm{v}_{\\text {diff }}$, comprises only the linear term, $2 \\mathrm{k}_{1} \\mathrm{v}_{1}$, and odd-order distortion terms (usually smaller than the second-order term). With these two significant advantages, most modern switched-capacitor circuits are implemented using fully differential structures.\n\nA fully differential version of the first-order filter is depicted in Fig. 14.21. Note that the fully differential version essentially consists of two single-ended versions, which might suggest it would require twice the integrated area. However, the increased area penalty is not as severe. Firstly, only one opamp is needed, though it does require additional common-mode feedback circuitry. Secondly, the input and output signal swings are now doubled. For instance, if single-ended signals are limited to $\\pm 1 \\mathrm{~V}$, the maximum peak-to-peak signal swing for single-ended signals is 2 V, whereas for differential signals, it is 4 V. Thus, to maintain the same dynamic range due to $(\\mathrm{kT}) / \\mathrm{C}$ noise, the capacitors in the fully differential version can be half the size of those in the single-ended case. ${ }^{3}$ Since smaller capacitors can be used, the switch sizes can also be reduced to meet the same settling-time requirements. However, the fully differential circuit has more switches and wiring, making it somewhat larger than its single-ended counterpart, though properly designed, it should be significantly less than twice the size. Furthermore, the fully differential circuit offers superior common-mode noise rejection and better distortion performance.\n\nKey Point: Despite the additional overhead for wiring and common-mode feedback circuitry in fully-differential circuit implementations, if properly designed, this overhead should constitute a minor fraction of the overall circuit."
},
{
    "text": "The direct-form continuous-time biquad structure can be derived by reformulating the general biquad transfer function, $\\mathrm{H}_{\\mathrm{a}}(\\mathrm{s})$, as follows:\n\n[^2]\\$\\$\n\n$$\n\\begin{equation*}\n\\mathrm{H}_{\\mathrm{a}}(\\mathrm{~s}) \\equiv \\frac{\\mathrm{V}_{\\text {out }}(\\mathrm{s})}{\\mathrm{V}_{\\text {in }}(\\mathrm{s})}=-\\frac{\\mathrm{k}_{2} \\mathrm{~s}^{2}+\\mathrm{k}_{1} \\mathrm{~s}+\\mathrm{k}_{0}}{\\mathrm{~s}^{2}+\\left(\\frac{\\omega_{0}}{\\mathrm{Q}}\\right) \\mathrm{s}+\\omega_{0}^{2}} \\tag{14.49}\n\\end{equation*}\n$$\n\n\\$\\$\n\nHere, $\\omega_{0}$ and Q denote the pole frequency and pole Q, respectively, while $\\mathrm{k}_{0}, \\mathrm{k}_{1}$, and $\\mathrm{k}_{2}$ are arbitrary coefficients determining the zeros of this biquad (i.e., the numerator's roots). By multiplying through by the denominators and dividing by $\\mathrm{s}^{2}$, (14.49) can be rewritten as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(s)=\\left[-k_{2}-\\frac{k_{1}}{s}\\right] V_{\\text {in }}(s)-\\frac{\\omega_{0}}{Q s} V_{\\text {out }}(s)-\\frac{k_{0}}{s^{2}} V_{\\text {in }}(s)-\\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text {out }}(s) \\tag{14.50}\n\\end{equation*}\n$$\n\nConsequently, (14.50) can be expressed as two integrator-based equations:\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s}) \\equiv-\\frac{1}{\\mathrm{~s}}\\left[\\frac{\\mathrm{~K}_{0}}{\\omega_{0}} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.51}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\mathrm{k}_{1}+\\mathrm{k}_{2} \\mathrm{~s}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\frac{\\omega_{0}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl}}(\\mathrm{~s})\\right] \\tag{14.52}\n\\end{equation*}\n$$\n\nThe signal-flow-graph depicting these two equations is presented in Fig. 14.22. By allowing the use of negative resistors, an active-RC realization of this general biquad signal-flow-graph is shown in Fig. 14.23 [Brackett, 1978]. For convenience, the integrating capacitors, $C_{A}$ and $C_{B}$, have been set to unity.\n\nA switched-capacitor biquad based on this active-RC circuit can be implemented as depicted in Fig. 14.24 [Martin, 1979]. In this circuit, all positive resistors are replaced with delay-free feed-in switched-capacitor stages, while the negative resistor is replaced with a delaying feed-in stage. The switched-capacitor circuit features redundant switches due to the absence of switch sharing.\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for realizing low-pass filters; the input capacitor $\\mathrm{K}_{2} \\mathrm{C}_{2}$ is the primary signal path for realizing bandpass filters; and the input capacitor $\\mathrm{K}_{3} \\mathrm{C}_{2}$ is the primary signal path for realizing high-pass filters.\n\nIt is worth to note that while this switched-capacitor filter is a natural outcome when using single-ended circuits, employing fully differential circuits could lead to various other circuits, some of which may exhibit undesirable performance characteristics. For instance, all positive resistors could be replaced with delay-free feed-in stages as before, but in addition, the negative resistor could also be replaced with a delay-free feed-in stage where the differential input wires are interchanged. Such a circuit would possess a delay-free loop around the two integrators and may exhibit excessive settling time behavior. As another example, all resistors might be replaced with delaying feed-in stages where positive resistors are realized by interchanging the input wires of those stages. In this case, settling time behavior would not be compromised as there would be two delays around the two-integrator loop, but coefficient sensitivity would be more pronounced for filters with high-Q poles. In essence, it is crucial for the two-integrator loop to have a single delay around the loop. This arrangement is referred to as using lossless discrete integrators (LDI) [Bruton, 1975].\n\nBy applying the approach outlined in Section 14.2.4, the signal-flow-graph for the biquad circuit depicted in Fig. 14.24 can be derived and is shown in Fig. 14.25. The transfer function, $H(z)$, for this signal-flow-graph is determined to be\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\left(\\mathrm{K}_{2}+\\mathrm{K}_{3}\\right) \\mathrm{z}^{2}+\\left(\\mathrm{K}_{1} \\mathrm{~K}_{5}-\\mathrm{K}_{2}-2 \\mathrm{~K}_{3}\\right) \\mathrm{z}+\\mathrm{K}_{3}}{\\left(1+\\mathrm{K}_{6}\\right) \\mathrm{Z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}-\\mathrm{K}_{6}-2\\right) \\mathrm{Z}+1} \\tag{14.53}\n\\end{equation*}\n$$\n\nThe system block diagram, labeled as Fig. 14.25, represents a signal-flow graph of a switched-capacitor circuit. This diagram is designed to implement a discrete-time biquad transfer function. Here's a breakdown of the diagram:\n\n1. **Main Components:**\n- **Summing Junctions:** There are two main summing junctions in the diagram. The first summing junction combines the input signal \\(V_i(z)\\) with feedback and feedforward paths.\n- **Delay Elements:** Two blocks labeled \\(\\frac{1}{1-z^{-1}}\\) represent integrators or unit delay elements, which are characteristic of digital filter implementations.\n- **Gain Blocks:** Multiple gain blocks with coefficients \\(-K_1\\), \\(-K_2\\), \\(-K_3(1-z^{-1})\\), \\(-K_4\\), \\(-K_5z^{-1}\\), and \\(-K_6\\) are present, controlling the amplification or attenuation of the signals.\n\n2. **Flow of Information or Control:**\n- The input signal \\(V_i(z)\\) enters the system and is affected by the gain \\(-K_1\\). This signal is then summed with other signals at the first summing junction.\n- The output of the first summing junction flows into the first delay element \\(\\frac{1}{1-z^{-1}}\\), creating an intermediate signal \\(V_1(z)\\).\n- \\(V_1(z)\\) is then multiplied by \\(-K_5z^{-1}\\) and fed into the second summing junction.\n- Feedback paths include signals multiplied by \\(-K_4\\) and \\(-K_6\\), which are routed back to the summing junctions.\n- A feedforward path from the input includes \\(-K_2\\) and \\(-K_3(1-z^{-1})\\), directly affecting the summing junctions.\n- The output \\(V_o(z)\\) is taken after the second delay element and summing junction.\n\n3. **Labels, Annotations, and Key Indicators:**\n- The diagram is annotated with gain values and signal labels such as \\(V_i(z)\\) for the input and \\(V_o(z)\\) for the output.\n- Intermediate signals like \\(V_1(z)\\) are clearly labeled to indicate their roles within the system.\n\n4. **Overall System Function:**\n- The primary function of this system is to implement a discrete-time biquad filter. The arrangement of summing junctions, gain elements, and delay blocks creates a specific transfer function \\(H(z)\\), which is defined by the provided equation. This function is used to achieve desired filtering characteristics in a digital signal processing application.\n\nUsing the approach presented in Section 14.2.4, the signal-flow-graph for the biquad circuit depicted in Fig. 14.24 can be derived and is shown in Fig. 14.25. The transfer function, $H(z)$, for this signal-flow-graph is determined to be\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\left(\\mathrm{K}_{2}+\\mathrm{K}_{3}\\right) \\mathrm{z}^{2}+\\left(\\mathrm{K}_{1} \\mathrm{~K}_{5}-\\mathrm{K}_{2}-2 \\mathrm{~K}_{3}\\right) \\mathrm{z}+\\mathrm{K}_{3}}{\\left(1+\\mathrm{K}_{6}\\right) \\mathrm{Z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}-\\mathrm{K}_{6}-2\\right) \\mathrm{Z}+1} \\tag{14.53}\n\\end{equation*}\n$$\n\nWhile the preceding relation is useful for analyzing the switched-capacitor circuit shown, this relation can also be employed during the design of a desired transfer function. Assuming the desired discrete-time biquad transfer function has been obtained using a digital-filter design program, and is given by\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{b_{2} z^{2}+b_{1} z+1} \\tag{14.54}\n\\end{equation*}\n$$\n\nwe can equate the individual coefficients of $z$ in (14.53) and (14.54), resulting in the following design equations:\n\n$$\n\\begin{gather*}\n\\mathrm{K}_{3}=\\mathrm{a}_{0}  \\tag{14.55}\\\\\n\\mathrm{~K}_{2}=\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.56}\\\\\n\\mathrm{~K}_{1} \\mathrm{~K}_{5}=\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.57}\\\\\n\\mathrm{~K}_{6}=\\mathrm{b}_{2}-1  \\tag{14.58}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5}=\\mathrm{b}_{1}+\\mathrm{b}_{2}+1 \\tag{14.59}\n\\end{gather*}\n$$\n\nThere is some flexibility in choosing the values of $\\mathrm{K}_{1}, \\mathrm{~K}_{4}$, and $\\mathrm{K}_{5}$. A single degree of freedom arises because specifying the overall transfer function, $\\mathrm{H}(\\mathrm{z})$, imposes no constraint on the magnitude of the signal at the internal node, $\\mathrm{V}_{1}(\\mathrm{z})$. Thus, one way to select appropriate capacitor values is to initially set $\\mathrm{K}_{5}=1$ and determine other initial component values, then find the signal levels that occur at nodes $\\mathrm{V}_{1}(\\mathrm{z})$ and $\\mathrm{V}_{\\mathrm{o}}(\\mathrm{z})$. Using this signal level information, perform dynamic range scaling to find the final component values that yield similar signal swings at both nodes. Alternatively, the time constants of the two discrete-time integrators can be set equal by choosing\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{\\mathrm{b}_{1}+\\mathrm{b}_{2}+1} \\tag{14.60}\n\\end{equation*}\n$$\n\nSuch a choice usually results in a near-optimal dynamically range-scaled circuit.\n\nIf the goal is to design the SC biquad such that its transfer function closely matches that of a continuous-time transfer function, the approach used in Example 14.2 can be adopted. Specifically, (14.53) can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\mathrm{K}_{1} \\mathrm{~K}_{5}+\\mathrm{K}_{2}\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right) \\mathrm{z}^{1 / 2}+\\mathrm{K}_{3}\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right)^{2}}{\\mathrm{~K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{6}\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right) \\mathrm{z}^{1 / 2}+\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right)^{2}} \\tag{14.61}\n\\end{equation*}\n$$\n\nFor convenience, we rewrite (14.15) and (14.16) here:\n\n$$\n\\begin{equation*}\nz^{1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)+j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.62}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\nz^{-1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)-j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.63}\n\\end{equation*}\n$$\n\nSubstituting these equations into (14.61) and rearranging gives\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{K_{1} K_{5}+j K_{2} \\sin (\\omega T)+\\left(4 K_{3}+2 K_{2}\\right) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)}{K_{4} K_{5}+j K_{6} \\sin (\\omega T)+\\left(4+2 K_{6}\\right) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)} \\tag{14.64}\n\\end{equation*}\n$$\n\nFor $\\omega \\mathrm{T}<<1$, we further have\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)} \\approx-\\frac{\\mathrm{K}_{1} \\mathrm{~K}_{5}+j \\mathrm{~K}_{2}(\\omega T)+\\left(\\mathrm{K}_{3}+\\mathrm{K}_{2} / 2\\right)(\\omega \\mathrm{T})^{2}}{\\mathrm{~K}_{4} \\mathrm{~K}_{5}+\\mathrm{j} \\mathrm{~K}_{6}(\\omega \\mathrm{~T})+\\left(1+\\mathrm{K}_{6} / 2\\right)(\\omega \\mathrm{T})^{2}} \\tag{14.65}\n\\end{equation*}\n$$\n\nThe coefficients of (14.65) can be matched to the desired coefficients of the continuous-time transfer function. A closer matching between transfer functions can be achieved if one selects capacitor ratios to align the real and imaginary parts of both the numerators and denominators of (14.64) with the desired continuous-time transfer function at the resonant frequency, as outlined in [Martin, 1980].\n\nFinally, an estimate of the largest to smallest capacitance ratio can be obtained by using the resistor approximation (14.5) for this switched-capacitor circuit. By comparing Fig. 14.23 and Fig. 14.24 and using (14.5), we observe the following approximations are valid for the feedback capacitor ratios, $\\mathrm{K}_{4}, \\mathrm{~K}_{5}$, and $\\mathrm{K}_{6}$ (the capacitor ratios that determine the pole locations).\n\n$$\n\\begin{gather*}\n\\mathrm{K}_{4} \\cong \\mathrm{~K}_{5} \\cong \\omega_{0} T  \\tag{14.66}\\\\\n\\mathrm{~K}_{6} \\cong \\frac{\\omega_{0} T}{\\mathrm{Q}} \\tag{14.67}\n\\end{gather*}\n$$\n\nHowever, the sampling rate, $1 / \\mathrm{T}$, is typically much larger than the approximated pole frequency, $\\omega_{0}$, leading to\n\n$$\n\\begin{equation*}\n\\omega_{0} \\mathrm{~T}<<1 \\tag{14.68}\n\\end{equation*}\n$$\n\nThus, the largest capacitors (those determining the pole locations) in the switched-capacitor biquad circuit of Fig. 14.24 are the integrating capacitors, $\\mathrm{"
},
{
    "text": "In the context provided, the text has been rephrased as follows:\n\n```\nAn expression for a direct-form continuous-time biquad structure can be derived by re-expressing the general biquad transfer function, \\( \\mathrm{H}_{\\mathrm{a}}(\\mathrm{s}) \\), in this manner:\n\n[^2]\\$\\$\n\n$$\n\\begin{equation*}\n\\mathrm{H}_{\\mathrm{a}}(\\mathrm{~s}) \\equiv \\frac{\\mathrm{V}_{\\text {out }}(\\mathrm{s})}{\\mathrm{V}_{\\text {in }}(\\mathrm{s})}=-\\frac{\\mathrm{k}_{2} \\mathrm{~s}^{2}+\\mathrm{k}_{1} \\mathrm{~s}+\\mathrm{k}_{0}}{\\mathrm{~s}^{2}+\\left(\\frac{\\omega_{0}}{\\mathrm{Q}}\\right) \\mathrm{s}+\\omega_{0}^{2}} \\tag{14.49}\n\\end{equation*}\n$$\n\n\\$\\$\n\nThe terms \\( \\omega_{0} \\) and Q denote the pole frequency and the pole Q factor, respectively, while \\( \\mathrm{k}_{0}, \\mathrm{k}_{1} \\), and \\( \\mathrm{k}_{2} \\) are arbitrary constants that determine the zeros of this biquad (i.e., the roots of the numerator). Upon multiplying through by the denominator and dividing by \\( \\mathrm{s}^{2} \\), the equation (14.49) can be rewritten as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(s)=\\left[-k_{2}-\\frac{k_{1}}{s}\\right] V_{\\text {in }}(s)-\\frac{\\omega_{0}}{Q s} V_{\\text {out }}(s)-\\frac{k_{0}}{s^{2}} V_{\\text {in }}(s)-\\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text {out }}(s) \\tag{14.50}\n\\end{equation*}\n$$\n\nConsequently, equation (14.50) can be expressed as two equations based on integrators. In particular,\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s}) \\equiv-\\frac{1}{\\mathrm{~s}}\\left[\\frac{\\mathrm{~K}_{0}}{\\omega_{0}} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.51}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\mathrm{k}_{1}+\\mathrm{k}_{2} \\mathrm{~s}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\frac{\\omega_{0}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl}}(\\mathrm{~s})\\right] \\tag{14.52}\n\\end{equation*}\n$$\n\nA signal-flow graph that describes the previous two equations is depicted in Figure 14.22. Enabling the use of negative resistors, an active-RC implementation of this general biquad signal-flow graph is presented in Figure 14.23 [Brackett, 1978]. It should be noted that for ease of analysis, the integrating capacitors, \\( C_{A} \\) and \\( C_{B} \\), have been set to unity.\n\nA switched-capacitor biquad based on this active-RC circuit can be realized as shown in Figure 14.24 [Martin, 1979]. In this realization, all positive resistors were replaced with delay-free feed-in switched-capacitor stages, and the negative resistor was replaced with a delaying feed-in stage. The switched-capacitor circuit contains redundant switches, as switch sharing has not yet been applied.\n\nThe input capacitor \\( \\mathrm{K}_{1} \\mathrm{C}_{1} \\) forms the primary signal path when realizing low-pass filters; the input capacitor \\( \\mathrm{K}_{2} \\mathrm{C}_{2} \\) constitutes the major signal path for bandpass filters; and the input capacitor \\( \\mathrm{K}_{3} \\mathrm{C}_{2} \\) is the key signal path for high-pass filters.\n\nBefore continuing, it is pertinent to observe that while this switched-capacitor filter naturally results from the use of single-ended circuits, the adoption of fully differential circuits might yield a multitude of other circuits, some of which might exhibit poor performance characteristics. For instance, all positive resistors could be substituted with delay-free feed-in stages, similar to before, but an additional delay-free feed-in stage could also replace the negative resistor. In this scenario, there might be an excessive settling time behavior around the loop that involves the two integrators. Alternatively, all resistors might be replaced with delaying feed-in stages, with positive resistors realized by swapping the input wires of these stages. In this case, the settling time behavior would not be significantly affected, as there would be two delays around the loop involving the two-integrator stage, but the coefficient sensitivity would likely be worse for filters with high-Q poles. In summary, it is crucial that the two-integrator loop has a single delay around it. This configuration is referred to as utilizing lossless discrete integrators (LDI) [Bruton, 1975].\n\nThe signal-flow graph for the biquad circuit shown in Figure 14.24, derived using the method outlined in Section 14.2.4, is presented in Figure 14.25. The transfer function \\( H(z) \\) for this signal-flow graph is determined to be\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\left(\\mathrm{K}_{2}+\\mathrm{K}_{3}\\right) \\mathrm{z}^{2}+\\left(\\mathrm{K}_{1} \\mathrm{~K}_{5}-\\mathrm{K}_{2}-2 \\mathrm{~K}_{3}\\right) \\mathrm{z}+\\mathrm{K}_{3}}{\\left(1+\\mathrm{K}_{6}\\right) \\mathrm{Z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}-\\mathrm{K}_{6}-2\\right) \\mathrm{Z}+1} \\tag{14.53}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.25\ndescription:\nThe block diagram labeled as Fig. 14.25 illustrates a signal-flow graph for a switched-capacitor circuit designed to implement a discrete-time biquad transfer function. This diagram includes summing junctions, delay elements, and gain blocks that control the amplification or attenuation of signals.\n\nFig. 14.25 A signal-flow graph for the switched-capacitor circuit depicted in Fig. 14.24.\n\nWhile the relationship presented earlier is useful for analyzing the switched-capacitor circuit depicted, it can also be employed in the design of a desired transfer function. Assuming a desired discrete-time biquad transfer function has been determined using a digital-filter design program and is expressed by\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{b_{2} z^{2}+b_{1} z+1} \\tag{14.54}\n\\end{equation*}\n$$\n\nthe individual coefficients of \\( z \\) in (14.53) and (14.54) can be equated, leading to the following design equations:\n\n$$\n\\begin{gather*}\n\\mathrm{K}_{3}=\\mathrm{a}_{0}  \\tag{14.55}\\\\\n\\mathrm{~K}_{2}=\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.56}\\\\\n\\mathrm{~K}_{1} \\mathrm{~K}_{5}=\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.57}\\\\\n\\mathrm{~K}_{6}=\\mathrm{b}_{2}-1  \\tag{14.58}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5}=\\mathrm{b}_{1}+\\mathrm{b}_{2}+1 \\tag{14.59}\n\\end{gather*}\n$$\n\nThere is some leeway in selecting the values of \\( \\mathrm{K}_{1}, \\mathrm{~K}_{4} \\), and \\( \\mathrm{K}_{5} \\). A degree of freedom arises due to the specification of the overall transfer function, \\( \\mathrm{H}(\\mathrm{z}) \\), which does not impose a constraint on the magnitude of the signal at the internal node, \\( \\mathrm{V}_{1}(\\mathrm{z}) \\). Consequently, an appropriate method to choose capacitor values is to initially set \\( \\mathrm{K}_{5}=1 \\), determine other initial component values, compute the signal levels at nodes \\( \\mathrm{V}_{1}(\\mathrm{z}) \\) and \\( \\mathrm{V}_{\\mathrm{o}}(\\mathrm{z}) \\), and subsequently use this signal level information to perform dynamic range scaling to determine the final component values that yield similar signal swings at both nodes. Alternatively, the time constants of the two discrete-time integrators can be made equal by selecting\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{\\mathrm{b}_{1}+\\mathrm{b}_{2}+1} \\tag{14.60}\n\\end{equation*}\n$$\n\nThis choice generally results in a circuit with an optimal dynamically scaled range.\n\nIf the intention is to design the SC biquad to match the transfer function of a continuous-time transfer function as closely as possible, the method employed in Example 14.2 can be followed. In particular, (14.53) can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\mathrm{K}_{1} \\mathrm{~K}_{5}+\\mathrm{K}_{2}\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right) \\mathrm{z}^{1 / 2}+\\mathrm{K}_{3}\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right)^{2}}{\\mathrm{~K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{6}\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right) \\mathrm{z}^{1 / 2}+\\left(\\mathrm{z}^{1 / 2}-\\mathrm{z}^{-1 / 2}\\right)^{2}} \\tag{14.61}\n\\end{equation*}\n$$\n\nFor the sake of convenience, equations (14.15) and (14.16) are restated here:\n\n$$\n\\begin{equation*}\nz^{1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)+j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.62}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\nz^{-1 / 2}=\\cos \\left(\\frac{\\omega T}{2}\\right)-j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.63}\n\\end{equation*}\n$$\n\nSubstituting these equations into (14.61) and reorganizing the terms results in\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)}=-\\frac{K_{1} K_{5}+j K_{2} \\sin (\\omega T)+\\left(4 K_{3}+2 K_{2}\\right) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)}{K_{4} K_{5}+j K_{6} \\sin (\\omega T)+\\left(4+2 K_{6}\\right) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)} \\tag{14.64}\n\\end{equation*}\n$$\n\nFor \\( \\omega \\mathrm{T}<<1 \\), the approximation\n\n$$\n\\begin{equation*}\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)} \\approx-\\frac{\\mathrm{K}_{1} \\mathrm{~K}_{5}+j \\mathrm{~K}_{2}(\\omega T)+\\left(\\mathrm{K}_{3}+\\mathrm{K}_{2} / 2\\right)(\\omega \\mathrm{T})^{2}}{\\mathrm{~K}_{4} \\mathrm{~K}_{5}+\\mathrm{j} \\mathrm{~K}_{6}(\\omega \\mathrm{~T})+\\left(1+\\mathrm{K}_{6} / 2\\right)(\\omega \\mathrm{T})^{2}} \\tag{14.65}\n\\end{equation*}\n$$\n\ncan be made.\n\nThe coefficients of (14.65) can be aligned with the desired coefficients of the continuous-time transfer function. Enhanced matching between the transfer functions can be achieved by selecting capacitor ratios to correspond to the real and imaginary parts of the numerators and denominators of (14.64) and the desired continuous-time transfer function at the resonant frequency, as detailed in [Martin, 1980].\n\nLastly, an estimate of the largest to smallest capacitance ratio can be determined by using the resistor approximation (14.5) for this switched-capacitor circuit. By comparing Figure 14.23 and Figure 14.24 and applying (14.5), the following approximations are valid for the feedback capacitor ratios \\( \\mathrm{K}_{4}, \\mathrm{~K}_{5} \\), and \\( \\mathrm{K}_{6} \\) (the capacitor ratios that determine the pole locations):\n\n$$\n\\begin{gather*}\n\\mathrm{K}_{4} \\cong \\mathrm{~K}_{5} \\cong \\omega_{0} T  \\tag{14.66}\\\\\n\\mathrm{~K}_{6} \\cong \\frac{\\omega_{0} T}{\\mathrm{Q}} \\tag{14.67}\n\\end{gather*}\n$$\n\nHowever, since the sampling rate, \\( 1 / \\mathrm{T} \\), is typically much larger than the approximated pole frequency, \\( \\omega_{0} \\), we have\n\n$$\n\\begin{equation*}\n\\omega_{0} \\mathrm{~T}<<1 \\tag{14.68}\n\\end{equation*}\n$$\n\nHence, the largest capacitors (those determining the pole locations) in the switched-capacitor biquad circuit of Figure 14.24 are the integrating capacitors, \\( \\mathrm{C}_{1} \\) and \\( \\mathrm{C}_{2} \\). Moreover, if \\( \\mathrm{Q}<1 \\), then the smallest capacitors are \\( \\mathrm{K}_{4} \\mathrm{C}_{1} \\) and \\( \\mathrm{K}_{5} \\mathrm{C}_{2} \\), leading to an approximate capacitance range of \\( 1 /\\left(\\omega_{0} T\\right) \\). However, if \\( \\mathrm{Q}>1 \\), then from (14.67), the smallest capacitor would be \\( \\mathrm{K}_{6} \\mathrm{C}_{2} \\), leading to an approximate capacitance range of \\( \\mathrm{Q} /\\left(\\omega_{0} \\mathrm{~T}\\right) \\).\n```"
},
{
    "text": "Image Descriptions: Textual descriptions of images linked within the provided context have been transformed into written format. You are requested to rephrase the content found in the [Context Provided] section, ensuring that the revised version retains the original meaning and length.\n\n---[Context Provided]---\nThe original text:\n```\nA direct-form continuous-time biquad structure can be obtained by rewriting the general biquad transfer function, $\\mathrm{H}_{\\mathrm{a}}(\\mathrm{s})$, as follows:\n\n[^2]\\$\\$\n\n$$\n\\begin{equation*}\n\\mathrm{H}_{\\mathrm{a}}(\\mathrm{~s}) \\equiv \\frac{\\mathrm{V}_{\\text {out }}(\\mathrm{s})}{\\mathrm{V}_{\\text {in }}(\\mathrm{s})}=-\\frac{\\mathrm{k}_{2} \\mathrm{~s}^{2}+\\mathrm{k}_{1} \\mathrm{~s}+\\mathrm{k}_{0}}{\\mathrm{~s}^{2}+\\left(\\frac{\\omega_{0}}{\\mathrm{Q}}\\right) \\mathrm{s}+\\omega_{0}^{2}} \\tag{14.49}\n\\end{equation*}\n$$\n\n\\$\\$\n\nHere, $\\omega_{0}$ and Q are the pole frequency and pole Q, respectively, whereas $\\mathrm{k}_{0}, \\mathrm{k}_{1}$, and $\\mathrm{k}_{2}$ are arbitrary coefficients that position this biquad's zeros, which are the roots of the numerator. Multiplying through by the denominators and dividing by $\\mathrm{s}^{2}$, (14.49) can be written as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(s)=\\left[-k_{2}-\\frac{k_{1}}{s}\\right] V_{\\text {in }}(s)-\\frac{\\omega_{0}}{Q s} V_{\\text {out }}(s)-\\frac{k_{0}}{s^{2}} V_{\\text {in }}(s)-\\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text {out }}(s) \\tag{14.50}\n\\end{equation*}\n$$\n\n\\$\\$\n\nLastly, (14.50) can be expressed in terms of two integrator-based equations. Specifically,\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s}) \\equiv-\\frac{1}{\\mathrm{~s}}\\left[\\frac{\\mathrm{~K}_{0}}{\\omega_{0}} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.51}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\mathrm{k}_{1}+\\mathrm{k}_{2} \\mathrm{~s}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\frac{\\omega_{0}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl}}(\\mathrm{~s})\\right] \\tag{14.52}\n\\end{equation*}\n$$\n\nA signal-flow graph depicting the aforementioned two equations is presented in Fig. 14.22.\nEnabling the use of negative resistors, an active-RC realization of the general biquad signal-flow graph is illustrated in Fig. 14.23 [Brackett, 1978]. Note that for ease of illustration, the integrating capacitors, $C_{A}$ and $C_{B}$, have been set to a value of one.\n\nA switched-capacitor biquad based on this active-RC circuit can be realized as depicted in Fig. 14.24 [Martin, 1979]. Here, all positive resistors were substituted with delay-free feed-in switched-capacitor stages, while the negative resistor was replaced with a delaying feed-in stage. The switched-capacitor circuit contains redundant switches due to the absence of switch sharing.\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ is the primary signal path when implementing low-pass filters; the input capacitor $\\mathrm{K}_{2} \\mathrm{C}_{2}$ is the major signal path for bandpass filters; and the input capacitor $\\mathrm{K}_{3} \\mathrm{C}_{2}$ is the primary signal path for high-pass filters.\n\nBefore moving on, it is important to note that although this switched-capacitor filter is a natural outcome when employing single-ended circuits, using fully differential circuits might lead to a variety of other circuit configurations, some of which may exhibit suboptimal performance characteristics. For instance, all positive resistors could be replaced with delay-free feed-in stages as previously described, but the negative resistor could also be replaced with a delay-free stage interchanging the differential input wires. This configuration would feature a delay-free loop around the two integrators, potentially resulting in excessive settling time behavior. Alternatively, all resistors might be replaced with delaying feed-in stages where positive resistors are realized by interchanging the input wires of these stages. In this scenario, settling time behavior would not be adversely affected as there would be two delays around the two-integrator loop, although coefficient sensitivity would be reduced for filters with high-Q poles. In summary, the critical factor is to ensure that the two-integrator loop contains a single delay around the loop, an arrangement known as using lossless discrete integrators (LDI) [Bruton, 1975].\n\nUsing the methodology outlined in Section 14.2.4, the signal-flow graph for the biquad circuit shown in Fig. 14.24 can be determined and is presented in Fig. 14.25. The transfer function, $H(z)$, for this signal-flow graph is calculated to be\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\left(\\mathrm{K}_{2}+\\mathrm{K}_{3}\\right) \\mathrm{z}^{2}+\\left(\\mathrm{K}_{1} \\mathrm{~K}_{5}-\\mathrm{K}_{2}-2 \\mathrm{~K}_{3}\\right) \\mathrm{z}+\\mathrm{K}_{3}}{\\left(1+\\mathrm{K}_{6}\\right) \\mathrm{Z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}-\\mathrm{K}_{6}-2\\right) \\mathrm{Z}+1} \\tag{14.53}\n\\end{equation*}\n```\n... (rest of the text omitted for brevity)"
},
{
    "text": "The conversion of image descriptions in the provided context has been transformed into corresponding textual narratives. The task at hand involves rewording the content within the [Context Provided] section while preserving its original intent and overall length. Below is the revised text.\n\n---\n\nA continuous-time biquad structure in the direct form can be derived by reexpressing the standard biquad transfer function, \\( \\mathrm{H}_{\\mathrm{a}}(\\mathrm{s}) \\), in the following manner:\n\n[^2]\\$\\$\n\n$$\n\\begin{equation*}\n\\mathrm{H}_{\\mathrm{a}}(\\mathrm{~s}) \\equiv \\frac{\\mathrm{V}_{\\text {out }}(\\mathrm{s})}{\\mathrm{V}_{\\text {in }}(\\mathrm{s})}=-\\frac{\\mathrm{k}_{2} \\mathrm{~s}^{2}+\\mathrm{k}_{1} \\mathrm{~s}+\\mathrm{k}_{0}}{\\mathrm{~s}^{2}+\\left(\\frac{\\omega_{0}}{\\mathrm{Q}}\\right) \\mathrm{s}+\\omega_{0}^{2}} \\tag{14.49}\n\\end{equation*}\n$$\n\n\\$\\$\n\nThe variables \\( \\omega_{0} \\) and \\( Q \\) denote the pole frequency and pole Q factor, respectively, while \\( \\mathrm{k}_{0}, \\mathrm{k}_{1} \\), and \\( \\mathrm{k}_{2} \\) are variables that position the zeros of this biquad, which are the roots of the numerator. By multiplying through by the denominator and dividing by \\( \\mathrm{s}^{2} \\), equation (14.49) can be rewritten as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(s)=\\left[-k_{2}-\\frac{k_{1}}{s}\\right] V_{\\text {in }}(s)-\\frac{\\omega_{0}}{Q s} V_{\\text {out }}(s)-\\frac{k_{0}}{s^{2}} V_{\\text {in }}(s)-\\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text {out }}(s) \\tag{14.50}\n\\end{equation*}\n$$\n\nEquation (14.50) can be represented as two integral-based equations, specifically\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s}) \\equiv-\\frac{1}{\\mathrm{~s}}\\left[\\frac{\\mathrm{~K}_{0}}{\\omega_{0}} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.51}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\mathrm{k}_{1}+\\mathrm{k}_{2} \\mathrm{~s}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\frac{\\omega_{0}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl}}(\\mathrm{~s})\\right] \\tag{14.52}\n\\end{equation*}\n$$\n\nA flowchart depicting the aforementioned two equations is presented in Fig. 14.22. By incorporating negative resistors, an active-RC implementation of the general biquad signal flow is illustrated in Fig. 14.23 [Brackett, 1978]. The integrating capacitors, \\( C_{A} \\) and \\( C_{B} \\), have been set to unity for convenience.\n\nA switched-capacitor biquad based on this active-RC design is depicted in Fig. 14.24 [Martin, 1979]. In this circuit, all positive resistors have been replaced with delay-free input stages, and the negative resistor has been replaced with a delay-based input stage. The switched-capacitor circuit features redundant switches due to the non-implementation of switch sharing.\n\nThe input capacitor \\( \\mathrm{K}_{1} \\mathrm{C}_{1} \\) serves as the primary signal path for implementing low-pass filters; the input capacitor \\( \\mathrm{K}_{2} \\mathrm{C}_{2} \\) acts as the primary signal path for bandpass filters; and the input capacitor \\( \\mathrm{K}_{3} \\mathrm{C}_{2} \\) is the major signal path for high-pass filters.\n\nIt is worth noting that although this switched-capacitor filter is a natural outcome when using single-ended circuits, employing fully differential circuits can lead to various other circuits with potentially poor performance attributes. For instance, all positive resistors could be substituted with delay-free input stages as previously described, and the negative resistor could also be replaced with a delay-free stage that interchanges the differential input wires. Such a circuit would feature a delay-free loop around the two integrators, which may exhibit excessive settling time. Alternatively, all resistors could be replaced with delay-based input stages, where positive resistors are achieved by exchanging the input wires of these stages. In this scenario, the settling time would not be compromised since there would be two delays around the two-integrator loop, although coefficient sensitivity could be poorer for filters with high-Q poles. In summary, the key is to ensure the two-integrator loop has a single delay around it, which is known as employing lossless discrete integrators (LDI) [Bruton, 1975].\n\nThe signal-flow diagram for the biquad circuit in Fig. 14.24, using the method presented in Section 14.2.4, is depicted in Fig. 14.25. The transfer function, \\( H(z) \\), for this diagram is given by\n\n$$\n\\begin{equation*}\n\\mathrm{H}(\\mathrm{z}) \\equiv \\frac{\\mathrm{V}_{0}(\\mathrm{z})}{\\mathrm{V}_{\\mathrm{i}}(\\mathrm{z})}=-\\frac{\\left(\\mathrm{K}_{2}+\\mathrm{K}_{3}\\right) \\mathrm{z}^{2}+\\left(\\mathrm{K}_{1} \\mathrm{~K}_{5}-\\mathrm{K}_{2}-2 \\mathrm{~K}_{3}\\right) \\mathrm{z}+\\mathrm{K}_{3}}{\\left(1+\\mathrm{K}_{6}\\right) \\mathrm{Z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}-\\mathrm{K}_{6}-2\\right) \\mathrm{Z}+1} \\tag{14.53}\n\\end{equation*}\n$$\n\n---\n\nThe revised text maintains the original meaning and length of the provided passage."
},
{
    "text": "A direct-form continuous-time biquad structure can be derived by modifying the general biquad transfer function, $\\mathrm{H}_{\\mathrm{a}}(\\mathrm{s})$, as follows:\n\n[^2]\\$\\$\n\n$$\n\\begin{equation*}\n\\mathrm{H}_{\\mathrm{a}}(\\mathrm{~s}) \\equiv \\frac{\\mathrm{V}_{\\text {out }}(\\mathrm{s})}{\\mathrm{V}_{\\text {in }}(\\mathrm{s})}=-\\frac{\\mathrm{k}_{2} \\mathrm{~s}^{2}+\\mathrm{k}_{1} \\mathrm{~s}+\\mathrm{k}_{0}}{\\mathrm{~s}^{2}+\\left(\\frac{\\omega_{0}}{\\mathrm{Q}}\\right) \\mathrm{s}+\\omega_{0}^{2}} \\tag{14.49}\n\\end{equation*}\n$$\n\n\\$\\$\n\nHere, $\\omega_{0}$ and Q represent the pole frequency and pole Q, respectively, while $\\mathrm{k}_{0}, \\mathrm{k}_{1}$, and $\\mathrm{k}_{2}$ are arbitrary coefficients determining the biquad's zeros. By multiplying through by the denominators and dividing by $\\mathrm{s}^{2}$, (14.49) can be rewritten as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(s)=\\left[-k_{2}-\\frac{k_{1}}{s}\\right] V_{\\text {in }}(s)-\\frac{\\omega_{0}}{Q s} V_{\\text {out }}(s)-\\frac{k_{0}}{s^{2}} V_{\\text {in }}(s)-\\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text {out }}(s) \\tag{14.50}\n\\end{equation*}\n$$\n\nSubsequently, (14.50) can be expressed as two integrator-based equations. Specifically,\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s}) \\equiv-\\frac{1}{\\mathrm{~s}}\\left[\\frac{\\mathrm{~K}_{0}}{\\omega_{0}} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.51}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\mathrm{k}_{1}+\\mathrm{k}_{2} \\mathrm{~s}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\frac{\\omega_{0}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl}}(\\mathrm{~s})\\right] \\tag{14.52}\n\\end{equation*}\n$$\n\nA signal-flow-graph depicting the aforementioned two equations is shown in Fig. 14.22. With the allowance of negative resistors, an active-RC realization of this general biquad signal-flow-graph is presented in Fig. 14.23 [Brackett, 1978]. For simplicity, the integrating capacitors, $C_{A}$ and $C_{B}$, have been set to unity.\n\nA switched-capacitor biquad, on this active-RC circuit can be implemented as shown in Fig. 14.24 [Martin, 1979]. In this circuit, all positive resistors have replaced with delay-free feed-in switched-capacitor stages, while the negative resistor is replaced with a delaying feed-in stage. The switched-capacitor circuit includes redundant switches, to the absence of switch sharing.\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low\nCertainly-pass filter; the input capacitor $\\mathrm{K}_{2} \\mathrm{C}_{2}$ is the primary signal path for bandpass filters; while\nthe designing preceding capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ is as the main signal conduit in the construction of low-pass filters, the input capacitor $\\mathrm{K}_{2} \\mathrm{C}_{2}$ takes on this role for designing bandpass filters."
},
{
    "text": "To obtain a direct-form continuous-time biquad structure, the general biquad transfer function, \\( H_{a}(s) \\), is re-expressed as follows:\n\n$$\nH_{a}(s) \\equiv \\frac{V_{\\text{out}}(s)}{V_{\\text{in}}(s)} = -\\frac{k_{2} s^{2} + k_{1} s + k_{0}}{s^{2} + \\left(\\frac{\\omega_{0}}{Q}\\right) s + \\omega_{0}^{2}} \\tag{14.49}\n$$\n\nIn this equation, \\( \\omega_{0} \\) and Q represent the pole frequency and pole Q, respectively, and \\( k_{0}, k_{1}, k_{2} \\) are coefficients determining the zeros of the biquad. By multiplying through by the denominators and dividing by \\( s^{2} \\), equation (14.49) can be rewritten as:\n\n$$\nV_{\\text{out}}(s) = \\left[-k_{2} - \\frac{k_{1}}{s}\\right] V_{\\text{in}}(s) - \\frac{\\omega_{0}}{Q s} V_{\\text{out}}(s) - \\frac{k_{0}}{s^{2}} V_{\\text{in}}(s) - \\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text{out}}(s) \\tag{14.50}\n$$\n\nEquation (14.50) can be further simplified into two integrator-based equations:\n\n$$\nV_{c1}(s) \\equiv -\\frac{1}{s}\\left[\\frac{K_{0}}{\\omega_{0}} V_{\\text{in}}(s) + \\omega_{0} V_{\\text{out}}(s)\\right] \\tag{14.51}\n$$\n\nand\n\n$$\nV_{\\text{out}}(s) = -\\frac{1}{s}\\left[(k_{1} + k_{2} s) V_{\\text{in}}(s) + \\frac{\\omega_{0}}{Q} V_{\\text{out}}(s) - \\omega_{0} V_{c1}(s)\\right] \\tag{14.52}\n$$\n\nA signal-flow graph illustrating these equations is depicted in Fig. 14.22. By incorporating negative resistors, an active-RC realization of this biquad signal-flow graph is presented in Fig. 14.23 [Brackett, 1978]. For simplicity, the integrating capacitors, \\( C_{A} \\) and \\( C_{B} \\), are set to unity.\n\nA switched-capacitor biquad based on this active-RC circuit is depicted in Fig. 14.24 [Martin, 1979]. In this circuit, all positive resistors are replaced with delay-free feed-in switched-capacitor stages, while the negative resistor is replaced with a delaying feed-in stage. The switched-capacitor circuit features redundant switches, as switch sharing has not been implemented.\n\nThe input capacitor \\( K_{1} C_{1} \\) serves as the primary signal path for low-pass filters; \\( K_{2} C_{2} \\) for bandpass filters; and \\( K_{3} C_{2} \\) for high-pass filters.\n\nIt is noteworthy that while this switched-capacitor filter is a natural outcome when using single-ended circuits, the adoption of fully differential circuits could yield various other configurations, some of which may exhibit inferior performance characteristics. For instance, all positive resistors could be substituted with delay-free feed-in stages, and the negative resistor could also be replaced with a delay-free feed-in stage where the differential input wires are swapped. This circuit would possess a delay-free loop around the two integrators and might exhibit excessively long settling times. As another example, all resistors could be replaced with delaying feed-in stages, where positive resistors are realized by swapping the input wires of those stages. In this scenario, settling time behavior would not be compromised due to the presence of two delays around the two-integrator loop, but coefficient sensitivity would be inferior for filters with high-Q poles. The crucial aspect is that the two-integrator loop should have a single delay around the loop, an arrangement known as using lossless discrete integrators (LDI) [Bruton, 1975].\n\nUtilizing the method outlined in Section 14.2.4, the signal-flow graph for the biquad circuit depicted in Fig. 14.24 can be derived and is shown in Fig. 14.25. The transfer function, \\( H(z) \\), for this signal-flow graph is given by:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{(K_{2} + K_{3}) z^{2} + (K_{1} K_{5} - K_{2} - 2 K_{3}) z + K_{3}}{(1 + K_{6}) z^{2} + (K_{4} K_{5} - K_{6} - 2) z + 1} \\tag{14.53}\n$$\n\nFig. 14.25 represents a signal-flow graph of a switched-capacitor circuit designed to implement a discrete-time biquad transfer function. The diagram includes summing junctions, delay elements, and gain blocks, all of which contribute to the filter's characteristics.\n\nWhile the above relation is valuable for analyzing the switched-capacitor circuit in Fig. 14.24, it can also be employed during the design phase of a desired transfer function. Assuming that a digital-filter design program has been utilized to obtain the desired discrete-time biquad transfer function, given by:\n\n$$\nH(z) = -\\frac{a_{2} z^{2} + a_{1} z + a_{0}}{b_{2} z^{2} + b_{1} z + 1} \\tag{14.54}\n$$\n\nwe can equate the individual coefficients of \\( z \\) in (14.53) and (14.54), yielding the following design equations:\n\n$$\n\\begin{gather*}\nK_{3} = a_{0}  \\tag{14.55}\\\\\nK_{2} = a_{2} - a_{0}  \\tag{14.56}\\\\\nK_{1} K_{5} = a_{0} + a_{1} + a_{2}  \\tag{14.57}\\\\\nK_{6} = b_{2} - 1  \\tag{14.58}\\\\\nK_{4} K_{5} = b_{1} + b_{2} + 1 \\tag{14.59}\n\\end{gather*}\n$$\n\nThere is some flexibility in selecting the values of \\( K_{1}, K_{4} \\), and \\( K_{5} \\). A single degree of freedom arises because specifying the overall transfer function, \\( H(z) \\), does not impose any constraints on the signal level at the internal node, \\( V_{1}(z) \\). Consequently, one approach to determining appropriate capacitor values is to initially set \\( K_{5} = 1 \\) and calculate other initial component values, then identify the signal levels that occur at nodes \\( V_{1}(z) \\) and \\( V_{o}(z) \\). Using this signal level information, dynamic range scaling can be performed to determine the final component values that yield similar signal swings at both nodes. Alternatively, the time constants of the two discrete-time integrators can be set equal by choosing:\n\n$$\nK_{4} = K_{5} = \\sqrt{b_{1} + b_{2} + 1} \\tag{14.60}\n$$\n\nThis choice typically results in a near-optimal dynamically range-scaled circuit.\n\nIf the goal is to design an SC biquad whose transfer function closely matches that of a continuous-time transfer function, the approach used in Example 14.2 can be employed. Specifically, equation (14.53) can be reformulated as:\n\n$$\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{K_{1} K_{5} + K_{2}(z^{1/2} - z^{-1/2}) z^{1/2} + K_{3}(z^{1/2} - z^{-1/2})^{2}}{K_{4} K_{5} + K_{6}(z^{1/2} - z^{-1/2}) z^{1/2} + (z^{1/2} - z^{-1/2})^{2}} \\tag{14.61}\n$$\n\nFor convenience, equations (14.15) and (14.16) are rewritten here:\n\n$$\nz^{1/2} = \\cos \\left(\\frac{\\omega T}{2}\\right) + j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.62}\n$$\n\nand\n\n$$\nz^{-1/2} = \\cos \\left(\\frac{\\omega T}{2}\\right) - j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.63}\n$$\n\nSubstituting these equations into (14.61) and rearranging yields:\n\n$$\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)} = -\\frac{K_{1} K_{5} + j K_{2} \\sin (\\omega T) + (4 K_{3} + 2 K_{2}) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)}{K_{4} K_{5} + j K_{6} \\sin (\\omega T) + (4 + 2 K_{6}) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)} \\tag{14.64}\n$$\n\nFor \\( \\omega T << 1 \\), we further have:\n\n$$\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)} \\approx -\\frac{K_{1} K_{5} + j K_{2}(\\omega T) + (K_{3} + K_{2} / 2)(\\omega T)^{2}}{K_{4} K_{5} + j K_{6}(\\omega T) + (1 + K_{6} / 2)(\\omega T)^{2}} \\tag{14.65}\n$$\n\nThe coefficients of (14.65) can be matched to the desired coefficients of the continuous-time transfer function. A closer matching between transfer functions can be achieved by selecting capacitor ratios that align the real and imaginary parts of both the numerators and denominators of (14.64) and the desired continuous-time transfer function at the resonant frequency, as described in [Martin, 1980].\n\nFinally, an estimate of the largest to smallest capacitance ratio can be made by applying the resistor approximation (14.5) for this switched-capacitor circuit. Comparing Fig. 14.23 and Fig. 14.24 and using (14.5), the following approximations hold for the feedback capacitor ratios, \\( K_{4}, K_{5} \\), and \\( K_{6} \\) (the capacitor ratios that dictate the pole locations):\n\n$$\n\\begin{gather*}\nK_{4} \\cong K_{5} \\cong \\omega_{0} T  \\tag{14.66}\\\\\nK_{6} \\cong \\frac{\\omega_{0} T}{Q} \\tag{14.67}\n\\end{gather*}\n$$\n\nHowever, the sampling rate, \\( 1 / T \\), is generally much greater than the approximated pole frequency, \\( \\omega_{0} \\), leading to:\n\n$$\n\\omega_{0} T << 1 \\tag{14.68}\n$$\n\nThus, the largest capacitors in the switched-capacitor biquad circuit of Fig. 14.24 are the integrating capacitors, \\( C_{1} \\) and \\( C_{2} \\). Additionally, if \\( Q < 1 \\), then the smallest capacitors are \\( K_{4} C_{1} \\) and \\( K_{5} C_{2} \\), resulting in an approximate capacitance spread of \\( 1 / (\\omega_{0} T) \\). However, if \\( Q > 1 \\), then from (14.67) the smallest capacitor would be \\( K_{6} C_{2} \\), resulting in an approximate capacitance spread of \\( Q / (\\omega_{0} T) \\)."
},
{
    "text": "To derive a direct-form continuous-time biquad structure, the general biquad transfer function, denoted as \\( H_{a}(s) \\), is re-expressed as:\n\n\\[\nH_{a}(s) = \\frac{V_{out}(s)}{V_{in}(s)} = -\\frac{k_{2}s^{2} + k_{1}s + k_{0}}{s^{2} + \\left(\\frac{\\omega_{0}}{Q}\\right)s + \\omega_{0}^{2}} \\tag{14.49}\n\\]\n\nHere, \\( \\omega_{0} \\) and \\( Q \\) denote the pole frequency and the pole Q, respectively. The coefficients \\( k_{0}, k_{1} \\), and \\( k_{2} \\) are the arbitrary constants that determine the zeros of the biquad, which are the roots of the numerator. By multiplying through by the denominators and dividing by \\( s^{2} \\), equation (14.49) can be rewritten as:\n\n\\[\nV_{out}(s) = \\left[-k_{2} - \\frac{k_{1}}{s}\\right]V_{in}(s) - \\frac{\\omega_{0}}{Qs}V_{out}(s) - \\frac{k_{0}}{s^{2}}V_{in}(s) - \\frac{\\omega_{0}^{2}}{s^{2}}V_{out}(s) \\tag{14.50}\n\\]\n\nThis leads to two integrator-based equations:\n\n\\[\nV_{c1}(s) = -\\frac{1}{s}\\left[\\frac{k_{0}}{\\omega_{0}}V_{in}(s) + \\omega_{0}V_{out}(s)\\right] \\tag{14.51}\n\\]\n\nand\n\n\\[\nV_{out}(s) = -\\frac{1}{s}\\left[(k_{1} + k_{2}s)V_{in}(s) + \\frac{\\omega_{0}}{Q}V_{out}(s) - \\omega_{0}V_{c1}(s)\\right] \\tag{14.52}\n\\]\n\nThese equations are depicted in a signal-flow-graph in Fig. 14.22. An active-RC realization of this biquad, using negative resistors, is shown in Fig. 14.23. For simplicity, the integrating capacitors \\( C_{A} \\) and \\( C_{B} \\) are set to unity.\n\nA switched-capacitor biquad based on the active-RC circuit is presented in Fig. 14.24. In this circuit, all positive resistors are replaced with delay-free feed-in switched-capacitor stages, while the negative resistor is replaced with a delaying feed-in stage. This switched-capacitor circuit includes redundant switches, as switch sharing has not been applied.\n\nThe input capacitor \\( K_{1}C_{1} \\) is the primary signal path for implementing low-pass filters, \\( K_{2}C_{2} \\) for bandpass filters, and \\( K_{3}C_{2} \\) for high-pass filters. It is important to note that while this switched-capacitor filter is a natural outcome of using single-ended circuits, the use of fully differential circuits could lead to several other circuit designs, some of which may exhibit poor performance. For instance, all positive resistors could be replaced with delay-free feed-in stages, and the negative resistor could also be replaced with a delay-free feed-in stage where the differential input wires are swapped. Such a circuit would feature a delay-free loop around the two integrators and potentially exhibit excessive settling time behavior. Another example is replacing all resistors with delaying feed-in stages, with positive resistors realized by swapping the input wires of those stages. This would result in two delays around the two-integrator loop, improving settling time behavior but worsening coefficient sensitivity for filters with high-Q poles. The key is to ensure that the two-integrator loop contains a single delay, which is referred to as using lossless discrete integrators (LDI).\n\nThe signal-flow-graph for the biquad circuit in Fig. 14.24 is presented in Fig. 14.25, and the transfer function \\( H(z) \\) for this signal-flow-graph is derived as:\n\n\\[\nH(z) = \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{(K_{2} + K_{3})z^{2} + (K_{1}K_{5} - K_{2} - 2K_{3})z + K_{3}}{(1 + K_{6})z^{2} + (K_{4}K_{5} - K_{6} - 2)z + 1} \\tag{14.53}\n\\]\n\nAssuming a desired discrete-time biquad transfer function is available, given by:\n\n\\[\nH(z) = -\\frac{a_{2}z^{2} + a_{1}z + a_{0}}{b_{2}z^{2} + b_{1}z + 1} \\tag{14.54}\n\\]\n\nthe coefficients of \\( z \\) in equations (14.53) and (14.54) can be equated to derive the design equations:\n\n\\[\n\\begin{align*}\nK_{3} &= a_{0} \\tag{14.55} \\\\\nK_{2} &= a_{2} - a_{0} \\tag{14.56} \\\\\nK_{1}K_{5} &= a_{0} + a_{1} + a_{2} \\tag{14.57} \\\\\nK_{6} &= b_{2} - 1 \\tag{14.58} \\\\\nK_{4}K_{5} &= b_{1} + b_{2} + 1 \\tag{14.59}\n\\end{align*}\n\\]\n\nThere is some flexibility in choosing the values of \\( K_{1}, K_{4} \\), and \\( K_{5} \\). A single degree of freedom arises because specifying the overall transfer function \\( H(z) \\) does not constrain the signal level at the internal node \\( V_{1}(z) \\). One approach to choosing appropriate capacitor values is to initially set \\( K_{5} = 1 \\) and determine other initial component values. Then, find the signal levels at nodes \\( V_{1}(z) \\) and \\( V_{o}(z) \\), and use this information to perform dynamic range scaling to find the final component values that yield similar signal swings at both nodes. Alternatively, the time constants of the two discrete-time integrators can be set equal by choosing:\n\n\\[\nK_{4} = K_{5} = \\sqrt{b_{1} + b_{2} + 1} \\tag{14.60}\n\\]\n\nThis choice often results in a near-optimal dynamically range-scaled circuit. If the goal is to design an SC biquad whose transfer function closely matches a continuous-time transfer function, the approach used in Example 14.2 can be employed. Specifically, equation (14.53) can be rewritten as:\n\n\\[\nH(z) = \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{K_{1}K_{5} + K_{2}(z^{1/2} - z^{-1/2})z^{1/2} + K_{3}(z^{1/2} - z^{-1/2})^{2}}{K_{4}K_{5} + K_{6}(z^{1/2} - z^{-1/2})z^{1/2} + (z^{1/2} - z^{-1/2})^{2}} \\tag{14.61}\n\\]\n\nUsing equations (14.15) and (14.16) for convenience, we have:\n\n\\[\nz^{1/2} = \\cos\\left(\\frac{\\omega T}{2}\\right) + j\\sin\\left(\\frac{\\omega T}{2}\\right) \\tag{14.62}\n\\]\n\nand\n\n\\[\nz^{-1/2} = \\cos\\left(\\frac{\\omega T}{2}\\right) - j\\sin\\left(\\frac{\\omega T}{2}\\right) \\tag{14.63}\n\\]\n\nSubstituting these into equation (14.61) and rearranging gives:\n\n\\[\nH(e^{j\\omega T}) = \\frac{V_{0}(e^{j\\omega T})}{V_{i}(e^{j\\omega T})} = -\\frac{K_{1}K_{5} + jK_{2}\\sin(\\omega T) + (4K_{3} + 2K_{2})\\sin^{2}(\\frac{\\omega T}{2})}{K_{4}K_{5} + jK_{6}\\sin(\\omega T) + (4 + 2K_{6})\\sin^{2}(\\frac{\\omega T}{2})} \\tag{14.64}\n\\]\n\nFor \\( \\omega T \\ll 1 \\), we further have:\n\n\\[\nH(e^{j\\omega T}) \\approx -\\frac{K_{1}K_{5} + jK_{2}(\\omega T) + (K_{3} + K_{2}/2)(\\omega T)^{2}}{K_{4}K_{5} + jK_{6}(\\omega T) + (1 + K_{6}/2)(\\omega T)^{2}} \\tag{14.65}\n\\]\n\nThe coefficients of equation (14.65) can be matched to the desired coefficients of the continuous-time transfer function. A closer matching between transfer functions can be achieved by choosing capacitor ratios to match the real and imaginary parts of both the numerators and denominators of equation (14.64) and the desired continuous-time transfer function at the resonant frequency, as outlined in Martin (1980).\n\nFinally, an estimate of the largest to smallest capacitance ratio can be made using the resistor approximation for this switched-capacitor circuit. By comparing Fig. 14.23 and Fig. 14.24 and using the resistor approximation, we find that the following approximations are valid for the feedback capacitor ratios, \\( K_{4}, K_{5} \\), and \\( K_{6} \\) (which determine the pole locations):\n\n\\[\n\\begin{align*}\nK_{4} &\\cong K_{5} \\cong \\omega_{0}T \\tag{14.66} \\\\\nK_{6} &\\cong \\frac{\\omega_{0}T}{Q} \\tag{14.67}\n\\end{align*}\n\\]\n\nHowever, the sampling rate \\( 1/T \\) is typically much larger than the approximated pole frequency \\( \\omega_{0} \\), leading to:\n\n\\[\n\\omega_{0}T \\ll 1 \\tag{14.68}\n\\]\n\nThus, the largest capacitors in the switched-capacitor biquad circuit of Fig. 14.24 are the integrating capacitors \\( C_{1} \\) and \\( C_{2} \\). Additionally, if \\( Q < 1 \\), the smallest capacitors are \\( K_{4}C_{1} \\) and \\( K_{5}C_{2} \\), resulting in an approximate capacitance spread of \\( 1/(\\omega_{0}T) \\). If \\( Q > 1 \\), then from equation (14.67), the smallest capacitor would be \\( K_{6}C_{2} \\), resulting in an approximate capacitance spread of \\( Q/(\\omega_{0}T) \\)."
},
{
    "text": "A direct-form continuous-time biquad structure can be derived by reformulating the general biquad transfer function, \\( H_{a}(s) \\), as shown below:\n\n\\[\nH_{a}(s) \\equiv \\frac{V_{out}(s)}{V_{in}(s)} = -\\frac{k_{2} s^{2} + k_{1} s + k_{0}}{s^{2} + \\left(\\frac{\\omega_{0}}{Q}\\right) s + \\omega_{0}^{2}} \\tag{14.49}\n\\]\n\nHere, \\( \\omega_{0} \\) and \\( Q \\) denote the pole frequency and pole Q, respectively, while \\( k_{0}, k_{1} \\), and \\( k_{2} \\) are coefficients that determine the zeros of the biquad (i.e., the roots of the numerator). By multiplying through by the denominators and dividing by \\( s^{2} \\), equation (14.49) can be rewritten as:\n\n\\[\nV_{out}(s) = \\left[-k_{2} - \\frac{k_{1}}{s}\\right] V_{in}(s) - \\frac{\\omega_{0}}{Q s} V_{out}(s) - \\frac{k_{0}}{s^{2}} V_{in}(s) - \\frac{\\omega_{0}^{2}}{s^{2}} V_{out}(s) \\tag{14.50}\n\\]\n\nEquation (14.50) can be expressed as two integrator-based equations:\n\n\\[\nV_{c1}(s) \\equiv -\\frac{1}{s}\\left[\\frac{K_{0}}{\\omega_{0}} V_{in}(s) + \\omega_{0} V_{out}(s)\\right] \\tag{14.51}\n\\]\n\nand\n\n\\[\nV_{out}(s) = -\\frac{1}{s}\\left[(k_{1} + k_{2} s) V_{in}(s) + \\frac{\\omega_{0}}{Q} V_{out}(s) - \\omega_{0} V_{c1}(s)\\right] \\tag{14.52}\n\\]\n\nThe signal-flow-graph depicting these equations is presented in Fig. 14.22. By allowing the use of negative resistors, an active-RC implementation of this general biquad signal-flow-graph is shown in Fig. 14.23 [Brackett, 1978]. For convenience, the integrating capacitors, \\( C_{A} \\) and \\( C_{B} \\), have been set to unity.\n\nA switched-capacitor biquad based on this active-RC circuit can be implemented as shown in Fig. 14.24 [Martin, 1979]. In this circuit, all positive resistors are replaced with delay-free feed-in switched-capacitor stages, while the negative resistor is replaced with a delaying feed-in stage. The switched-capacitor circuit has redundant switches, as switch sharing has not been applied.\n\nThe input capacitor \\( K_{1} C_{1} \\) is the primary signal path for low-pass filters; the input capacitor \\( K_{2} C_{2} \\) is the primary signal path for bandpass filters; and the input capacitor \\( K_{3} C_{2} \\) is the primary signal path for high-pass filters.\n\nIt is important to note that while this switched-capacitor filter is a natural outcome when using single-ended circuits, the use of fully differential circuits could lead to various other circuits, some of which may have inferior performance properties. For instance, all positive resistors could be replaced with delay-free feed-in stages, and the negative resistor could also be replaced with a delay-free feed-in stage where the differential input wires are interchanged. Such a circuit would have a delay-free loop around the two integrators and may exhibit excessive settling time behavior. As another example, all resistors might be replaced with delaying feed-in stages where positive resistors are realized by interchanging the input wires of those stages. In this case, settling time behavior would not be as severe since there would be two delays around the two-integrator loop, but coefficient sensitivity would be worse for filters with high-Q poles. In summary, it is crucial that the two-integrator loop have a single delay around the loop. Such an arrangement is known as using lossless discrete integrators (LDI) [Bruton, 1975].\n\nUsing the approach outlined in Section 14.2.4, the signal-flow-graph for the biquad circuit shown in Fig. 14.24 can be determined and is presented in Fig. 14.25. The transfer function, \\( H(z) \\), for this signal-flow-graph is found to be:\n\n\\[\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{(K_{2} + K_{3}) z^{2} + (K_{1} K_{5} - K_{2} - 2 K_{3}) z + K_{3}}{(1 + K_{6}) z^{2} + (K_{4} K_{5} - K_{6} - 2) z + 1} \\tag{14.53}\n\\]\n\nThe diagram in Fig. 14.22 represents a signal-flow-graph of a general continuous-time biquad filter. This filter is designed to process an input signal \\( V_{in}(s) \\) and produce an output signal \\( V_{out}(s) \\). The main components and flow of information in the diagram are as follows:\n\n1. **Main Components:**\n   - **Summing Junctions:** There are two summing junctions in the diagram. The first summing junction combines the input signal \\( V_{in}(s) \\) with a feedback signal scaled by \\( k_{0}/\\omega_{0} \\). The second summing junction combines signals including feedback components and the output of the first integrator.\n   - **Integrators (\\(-1/s\\)):** Two integrators are present, each represented by a block labeled \\(-1/s\\). These integrators process the signals by integrating over time, effectively serving as low-pass filters.\n   - **Feedback Paths:** Several feedback paths are present in the diagram, indicating a complex interaction between the components to achieve the desired filter characteristics.\n\n2. **Flow of Information or Control:**\n   - The input signal \\( V_{in}(s) \\) enters the first summing junction, where it is combined with a feedback signal scaled by \\( k_{0}/\\omega_{0} \\).\n   - The output of the first summing junction is then integrated by the first integrator \\(-1/s\\), producing an intermediate signal \\( V_{c1}(s) \\).\n   - This intermediate signal is fed back to the second summing junction and also contributes to the output signal \\( V_{out}(s) \\) after further processing.\n   - The second summing junction receives additional feedback signals scaled by \\( \\omega_{0} \\) and \\( \\omega_{0}/Q \\), which are combined with \\( V_{c1}(s) \\) and then integrated by the second integrator.\n   - The output of the second integrator contributes to the final output signal \\( V_{out}(s) \\).\n\n3. **Labels, Annotations, and Key Indicators:**\n   - The diagram includes labels such as \\( k_{0}/\\omega_{0} \\), \\( \\omega_{0} \\), \\( \\omega_{0}/Q \\), and \\( k_{1} + k_{2}s \\), which indicate scaling factors and feedback paths crucial for the filter's operation.\n   - The signal \\( V_{c1}(s) \\) is labeled at the output of the first integrator, indicating its role as an intermediate signal in the filter process.\n\n4. **Overall System Function:**\n   - The primary function of this system is to act as a continuous-time biquad filter, which can be configured to perform various filtering tasks such as low-pass, high-pass, band-pass, or band-stop filtering, depending on the values of the parameters like \\( k_{0} \\), \\( \\omega_{0} \\), \\( Q \\), \\( k_{1} \\), and \\( k_{2} \\). The arrangement of integrators and summing junctions, along with the feedback paths, allows for precise control over the filter's frequency response and quality factor \\( Q \\).\n\nThe diagram is a signal-flow-graph representation of a general continuous-time biquad filter. It illustrates the flow of signals through various summing junctions and integrators, with feedback and feedforward paths characterized by parameters such as \\( k_{0}/\\omega_{0} \\), \\( \\omega_{0} \\), \\( \\omega_{0}/Q \\), \\( k_{1} + k_{2}s \\), and \\( -\\omega_{0} \\). The input is \\( V_{in}(s) \\) and the output is \\( V_{out}(s) \\).\n\nThe circuit is an active-RC realization of a general continuous-time biquad filter. It includes two operational amplifiers, integrating capacitors, and various resistors to set the filter characteristics. The filter processes an input signal \\( V_{in}(s) \\) to produce an output \\( V_{out}(s) \\). The resistors define parameters such as cutoff frequency and quality factor.\n\nThe circuit is a low-Q switched-capacitor biquad filter. It is designed without switch sharing and includes two operational amplifiers, capacitors, and switches. The filter processes an input signal \\( V_{i}(z) \\) to produce an output \\( V_{o}(z) \\). The switches and capacitors are used to implement the filter's characteristics.\n\nBefore proceeding, it is worth mentioning that while this switched-capacitor filter is a natural result when using single-ended circuits, the use of fully differential circuits could result in quite a few other circuits, some of which could have poor performance properties. For example, all the positive resistors could be replaced with delay-free feed-in stages as before, but in addition, the negative resistor could also be replaced with a delay-free feed-in stage where the differential input wires are interchanged. Such a circuit would have a delay-free loop around the two integrators and may have an excessive settling time behavior. As another example, all resistors might be replaced with delaying feed-in stages where positive resistors are realized by interchanging the input wires of those stages. In this case, settling time behavior would not suffer as there would be two delays around the two-integrator loop, but coefficient sensitivity would be worse for filters having high-Q poles. In summary, what is important is that the two-integrator loop have a single delay around the loop. Such an arrangement is referred to as using lossless discrete integrators (LDI) [Bruton, 1975].\n\nUsing the approach presented in Section 14.2.4, the signal-flow-graph for the biquad circuit shown in Fig. 14.24 can be found and is shown in Fig. 14.25. The transfer function, \\( H(z) \\), for this signal-flow-graph is found to be given by:\n\n\\[\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{(K_{2} + K_{3}) z^{2} + (K_{1} K_{5} - K_{2} - 2 K_{3}) z + K_{3}}{(1 + K_{6}) z^{2} + (K_{4} K_{5} - K_{6} - 2) z + 1} \\tag{14.53}\n\\]\n\nThe system block diagram, labeled as Fig. 14.25, represents a signal-flow graph of a switched-capacitor circuit. This diagram is designed to implement a discrete-time biquad transfer function. Here's a breakdown of the diagram:\n\n1. **Main Components:**\n   - **Summing Junctions:** There are two main summing junctions in the diagram. The first summing junction combines the input signal \\( V_{i}(z) \\) with feedback and feedforward paths.\n   - **Delay Elements:** Two blocks labeled \\( \\frac{1}{1-z^{-1}} \\) represent integrators or unit delay elements, which are characteristic of digital filter implementations.\n   - **Gain Blocks:** Multiple gain blocks with coefficients \\( -K_{1} \\), \\( -K_{2} \\), \\( -K_{3}(1-z^{-1}) \\), \\( -K_{4} \\), \\( -K_{5}z^{-1} \\), and \\( -K_{6} \\) are present, controlling the amplification or attenuation of the signals.\n\n2. **Flow of Information or Control:**\n   - The input signal \\( V_{i}(z) \\) enters the system and is affected by the gain \\( -K_{1} \\). This signal is then summed with other signals at the first summing junction.\n   - The output of the first summing junction flows into the first delay element \\( \\frac{1}{1-z^{-1}} \\), creating an intermediate signal \\( V_{1}(z) \\).\n   - \\( V_{1}(z) \\) is then multiplied by \\( -K_{5}z^{-1} \\) and fed into the second summing junction.\n   - Feedback paths include signals multiplied by \\( -K_{4} \\) and \\( -K_{6} \\), which are routed back to the summing junctions.\n   - A feedforward path from the input includes \\( -K_{2} \\) and \\( -K_{3}(1-z^{-1}) \\), directly affecting the summing junctions.\n   - The output \\( V_{o}(z) \\) is taken after the second delay element and summing junction.\n\n3. **Labels, Annotations, and Key Indicators:**\n   - The diagram is annotated with gain values and signal labels such as \\( V_{i}(z) \\) for the input and \\( V_{o}(z) \\) for the output.\n   - Intermediate signals like \\( V_{1}(z) \\) are clearly labeled to indicate their roles within the system.\n\n4. **Overall System Function:**\n   - The primary function of this system is to implement a discrete-time biquad filter. The arrangement of summing junctions, gain elements, and delay blocks creates a specific transfer function \\( H(z) \\), which is defined by the provided equation. This function is used to achieve desired filtering characteristics in a digital signal processing application.\n\nWhile the preceding relation is useful for analyzing the switched-capacitor circuit shown, this relation can also be used during the design of a desired transfer function. Assuming the desired discrete-time biquad transfer function has been found using a digital-filter design program, and is given by:\n\n\\[\nH(z) = -\\frac{a_{2} z^{2} + a_{1} z + a_{0}}{b_{2} z^{2} + b_{1} z + 1} \\tag{14.54}\n\\]\n\nwe can equate the individual coefficients of \\( z \\) in (14.53) and (14.54), resulting in the following design equations:\n\n\\[\n\\begin{gather*}\nK_{3} = a_{0}  \\tag{14.55}\\\\\nK_{2} = a_{2} - a_{0}  \\tag{14.56}\\\\\nK_{1} K_{5} = a_{0} + a_{1} + a_{2}  \\tag{14.57}\\\\\nK_{6} = b_{2} - 1  \\tag{14.58}\\\\\nK_{4} K_{5} = b_{1} + b_{2} + 1 \\tag{14.59}\n\\end{gather*}\n\\]\n\nThere is some flexibility in choosing the values of \\( K_{1}, K_{4} \\), and \\( K_{5} \\). A single degree of freedom arises because specifying the overall transfer function, \\( H(z) \\), places no constraint on the size of the signal at the internal node, \\( V_{1}(z) \\). Thus, one way to choose appropriate capacitor values is to initially let \\( K_{5} = 1 \\) and determine other initial component values, find the signal levels that occur at nodes \\( V_{1}(z) \\) and \\( V_{o}(z) \\), then using that signal level information, perform dynamic range scaling to find the final component values that result in similar signal swings at both nodes. Alternatively, the time constants of the two discrete-time integrators can be set equal by choosing:\n\n\\[\nK_{4} = K_{5} = \\sqrt{b_{1} + b_{2} + 1} \\tag{14.60}\n\\]\n\nSuch a choice usually results in a near optimal dynamically range-scaled circuit.\n\nIf it is desired to design the SC biquad so that its transfer function matches that of a continuous-time transfer function as closely as possible, then the approach used in Example 14.2 can be taken. Specifically, (14.53) can be rewritten as:\n\n\\[\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)} = -\\frac{K_{1} K_{5} + K_{2}(z^{1/2} - z^{-1/2}) z^{1/2} + K_{3}(z^{1/2} - z^{-1/2})^{2}}{K_{4} K_{5} + K_{6}(z^{1/2} - z^{-1/2}) z^{1/2} + (z^{1/2} - z^{-1/2})^{2}} \\tag{14.61}\n\\]\n\nRewriting (14.15) and (14.16) here for convenience, we have:\n\n\\[\nz^{1/2} = \\cos \\left(\\frac{\\omega T}{2}\\right) + j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.62}\n\\]\n\nand\n\n\\[\nz^{-1/2} = \\cos \\left(\\frac{\\omega T}{2}\\right) - j \\sin \\left(\\frac{\\omega T}{2}\\right) \\tag{14.63}\n\\]\n\nSubstituting these equations into (14.61) and rearranging gives:\n\n\\[\nH\\left(e^{j \\omega T}\\right) \\equiv \\frac{V_{0}\\left(e^{j \\omega T}\\right)}{V_{i}\\left(e^{j \\omega T}\\right)} = -\\frac{K_{1} K_{5} + j K_{2} \\sin (\\omega T) + (4 K_{3} + 2 K_{2}) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)}{K_{4} K_{5} + j K_{6} \\sin (\\omega T) + (4 + 2 K_{6}) \\sin ^{2}\\left(\\frac{\\omega T}{2}\\right)} \\tag{14"
},
{
    "text": "The biquad transfer function $\\mathrm{H}_{\\mathrm{a}}(\\mathrm{s})$ can be transformed into a direct-form continuous-time structure by expressing it as:\n\n[^2]\\$\\$\n\n$$\n\\begin{equation*}\n\\mathrm{H}_{\\mathrm{a}}(\\mathrm{~s}) \\equiv \\frac{\\mathrm{V}_{\\text {out }}(\\mathrm{s})}{\\mathrm{V}_{\\text {in }}(\\mathrm{s})}=-\\frac{\\mathrm{k}_{2} \\mathrm{~s}^{2}+\\mathrm{k}_{1} \\mathrm{~s}+\\mathrm{k}_{0}}{\\mathrm{~s}^{2}+\\left(\\frac{\\omega_{0}}{\\mathrm{Q}}\\right) \\mathrm{s}+\\omega_{0}^{2}} \\tag{14.49}\n\\end{equation*}\n$$\n\n\\$\\$\n\nIn this equation, $\\omega_{0}$ and Q represent the pole frequency and the pole Q, respectively. The coefficients $\\mathrm{k}_{0}, \\mathrm{k}_{1}$, and $\\mathrm{k}_{2}$ determine the zeros of the biquad. By multiplying through by the denominators and dividing by $\\mathrm{s}^{2}$, equation (14.49) can be rewritten as:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(s)=\\left[-k_{2}-\\frac{k_{1}}{s}\\right] V_{\\text {in }}(s)-\\frac{\\omega_{0}}{Q s} V_{\\text {out }}(s)-\\frac{k_{0}}{s^{2}} V_{\\text {in }}(s)-\\frac{\\omega_{0}^{2}}{s^{2}} V_{\\text {out }}(s) \\tag{14.50}\n\\end{equation*}\n$$\n\nEquation (14.50) can be further expressed in terms of two integrator-based equations:\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s}) \\equiv-\\frac{1}{\\mathrm{~s}}\\left[\\frac{\\mathrm{~K}_{0}}{\\omega_{0}} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.51}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\mathrm{k}_{1}+\\mathrm{k}_{2} \\mathrm{~s}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\frac{\\omega_{0}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl}}(\\mathrm{~s})\\right] \\tag{14.52}\n\\end{equation*}\n$$\n\nThe signal-flow-graph depicting these equations is shown in Fig. 14.22. Utilizing negative resistors, an active-RC implementation of this biquad is presented in Fig. 14.23. The integrating capacitors, $C_{A}$ and $C_{B}$, are set to unity for simplicity.\n\nA switched-capacitor biquad, derived from the active-RC circuit, is illustrated in Fig. 14.24. Here, positive resistors are replaced with delay-free feed-in switched-capacitor stages, while the negative resistor is replaced with a delaying feed-in stage. The circuit features redundant switches, as switch sharing has not been applied.\n\nIn low-pass filter implementations, the input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ is the primary signal path. For bandpass filters, the input capacitor $\\mathrm{K}_{2} \\mathrm{C}_{2}$ is the primary signal path, and for high-pass filters, the input capacitor $\\mathrm{K}_{3} \\mathrm{C}_{2}$ is the primary signal path.\n\nBefore proceeding, it is noteworthy\nA direct-form continuous-time biquad structure can be achieved\nderived from the general biquad transfer function $\\\nrewriting the general biquad transfer function"
},
{
    "text": "The substantial high-capacitance spread observed in the preceding low-Q circuit, particularly when $\\mathrm{Q}>>1$, stemmed directly from the large damping resistance value of $Q / \\omega_{0}$ illustrated in Fig. 14.23. One effective method to achieve a high-Q switched-capacitor circuit without encountering such a significant capacitance spread is to eliminate this damping resistance in the continuous-time filter equivalent. This elimination can be achieved by reformulating (14.50) as follows:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 illustrates an alternative configuration for a general continuous-time biquad filter. This setup employs a mix of integrators, summing junctions, and feedback paths to execute its filtering tasks.\n\nCore Components:\n1. **Summing Junctions (+):**\n   - The diagram includes two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n   - The second junction combines the output from the first integrator with another feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n   - Two integrators are featured. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n   - The feedback paths incorporate coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are essential for adjusting the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n   - Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nInformation Flow:\n   - The input signal \\( V_{in}(s) \\) enters the system, undergoes processing at the first summing junction, integrating feedback and feedforward components.\n   - The output from the first junction is integrated, then fed to the second junction.\n   - The second junction blends this signal with additional feedback before further integration.\n   - The final output \\( V_{out}(s) \\) is derived post the second integrator.\n   - Feedback paths from output and intermediate stages adjust the input to the junctions, managing the system's response.\n\nLabels and Key Indicators:\n   - **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n   - **\\( s/Q \\):** Represents a damping coefficient, influencing stability and transient response.\n   - **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients for adjusting gain and frequency traits of the filter.\n\nSystem Function:\nThe system operates as a biquad filter, capable of executing second-order filtering functions like low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths allows precise control over frequency response and damping, making it ideal for continuous-time signal processing requiring active-RC implementations.\n\nFig. 14.26 An alternative realization for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit represents a continuous-time active-RC biquad filter, leveraging op-amps A1 and A2 for second-order filtering. It is designed for precise control over frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative realization of a general active-RC biquad filter.\n\nThe signal-flow graph for these equations is depicted in Fig. 14.26. Note that the damping path, represented by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be realized using a capacitor, as demonstrated in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the resultant high-Q switched-capacitor biquad circuit is presented in Fig. 14.28 [Martin, 1980].\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for realizing various functions are possible. For instance, a nondelayed switched capacitor from the input to the second integrator can realize an inverting bandpass function. Interchanging the phases of the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an additional period delay.\n\nUsing the signal-flow-graph method from Section 14.2.4, the transfer function for this circuit is determined as:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:The circuit is a high-Q switched-capacitor biquad filter without switch sharing, featuring two operational amplifiers, multiple switches, and capacitors arranged to achieve a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, dictating the timing of switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nBy matching the coefficients of (14.71) to those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nthe following equations are derived:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nSimilar to the low-Q biquad, there is flexibility in determining the coefficients due to one fewer equation than the number of coefficients. A reasonable initial choice might be:\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nSubsequently, all other ratios follow, providing a good dynamic range, though not necessarily optimal. Post-design, the biquad can be analyzed, and ratios adjusted to balance the maximum signal strength at the two opamp outputs.\n\n#### EXAMPLE 14.5\n\nThe following transfer function represents a bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is implemented using the high-Q biquad circuit. Compare this with the results from using the low-Q circuit, assuming $C_{1}=C_{2}=1$ in both scenarios.\n\n#### Solution\n\nFor the high-Q biquad circuit, utilizing (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, the capacitor values are:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, the smallest capacitor in this high-Q circuit is $K_{6} C_{1}$, resulting in a capacitance spread of about 11 to 1.\n\nFor the low-Q biquad circuit design, rewriting (14.79) as\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nfacilitates the application of equations (14.55) to (14.60). An extra zero at $\\mathbf{z}=0$ was added to avoid negative capacitances, which does not alter the magnitude response.\n\nAssuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, the ratios are:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is governed by $\\mathrm{K}_{6}$, primarily affecting the pole-Q factor's accuracy, resulting in a spread near 17. It is noteworthy that worse capacitance spreads may occur in this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nMany other biquadratic stages exist beyond the two presented here. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is detailed in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is phase equalizers, which often require feed-ins approximating negative resistors. Higher-order switched-capacitor filters can be created by cascading multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of passive doubly terminated LC ladder filters can be used. For detailed designs of high-order SC filters, readers are referred to [Gregorian, 1986]."
},
{
    "text": "The substantial high-capacitance spread observed in the prior low-Q circuit when $\\mathrm{Q}>>1$ stemmed directly from the presence of a significant damping resistance value of $Q / \\omega_{0}$, as illustrated in Fig. 14.23. A viable strategy to achieve a high-Q switched-capacitor circuit without such pronounced capacitance spread involves eliminating this damping resistance from the continuous-time filter counterpart. This elimination can be effectively realized by reformulating (14.50) as follows:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 showcases an alternative configuration for a general continuous-time biquad filter. This setup employs integrators, summing junctions, and feedback pathways to execute its filtering functions.\n\nCore Components:\n1. **Summing Junctions (+):**\n   - The diagram features two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n   - The second junction blends the output from the first integrator with another feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n   - Two integrators are incorporated. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n   - These paths include coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\), crucial for modifying the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n   - Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in feedforward paths from the input to the first summing junction.\n\nInformation Flow:\n- The input signal \\( V_{in}(s) \\) enters the system, processed by the first summing junction where it mixes with feedforward and feedback elements.\n- The output from the first junction is integrated, then routed to the second junction.\n- The second junction combines this signal with additional feedback before further integration.\n- The final output \\( V_{out}(s) \\) is derived after the second integrator.\n- Feedback paths from the output and intermediate stages adjust the input to the junctions, governing the system's response.\n\nLabels and Indicators:\n- **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n- **\\( s/Q \\):** Represents a damping coefficient, influencing stability and transient response.\n- **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients for adjusting gain and frequency traits.\n\nSystem Function:\nThis system acts as a biquad filter, capable of implementing second-order filters like low-pass, high-pass, band-pass, and band-stop. The arrangement of integrators, summing junctions, and feedback/feedforward paths allows precise control over frequency response and damping, making it ideal for continuous-time signal processing applications requiring active-RC implementations.\n\nFig. 14.26 An alternative configuration for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit is a continuous-time active-RC biquad filter, utilizing op-amps A1 and A2 for second-order filtering. It is designed for precise control over frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative configuration of a general active-RC biquad filter.\n\nThe signal-flow graph for these equations is depicted in Fig. 14.26. Note that the damping path, represented by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be realized using a capacitor, as shown in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the resultant high-Q switched-capacitor biquad circuit is illustrated in Fig. 14.28 [Martin, 1980].\n\nIn this setup, the input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ is the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for various functions are possible. For instance, a nondelayed switched capacitor from the input to the second integrator can realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an additional period delay.\n\nUsing the signal-flow-graph method from Section 14.2.4, the transfer function for this circuit is determined as:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:This circuit represents a high-Q switched-capacitor biquad filter without switch sharing, featuring two operational amplifiers, multiple switches, and capacitors arranged to achieve a specific transfer function. The switches are controlled by two clock phases, φ1 and φ2, dictating the timing of switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nyields the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there is some flexibility in determining the coefficients due to one fewer equation than the number of coefficients. A reasonable initial choice might be:\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nFollowing this, all other ratios are derived. This approach ensures a good dynamic range, though not necessarily optimal. After designing the biquad, it can be analyzed, and the ratios adjusted to balance the maximum signal strength at the two opamp outputs.\n\n#### EXAMPLE 14.5\n\nA bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10 is described by the following transfer function:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare these results with those from a low-Q circuit. Assume $C_{1}=C_{2}=1$ in both scenarios.\n\n#### Solution\n\nFor the high-Q biquad circuit, using (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, the capacitor values are:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nWith $C_{1}=C_{2}=1$, the smallest capacitor in this high-Q circuit is $K_{6} C_{1}$, resulting in a capacitance spread of about 11 to 1.\n\nFor the low-Q biquad circuit, rewriting (14.79) as\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nsimplifies applying equations (14.55) to (14.60). An extra zero at $\\mathbf{z}=0$ was added to avoid negative capacitances, which does not alter the magnitude response.\n\nAssuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, the ratios are:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is governed by $\\mathrm{K}_{6}$, primarily affecting the pole-Q factor's accuracy, resulting in a spread near 17. Note that worse capacitance spreads occur for this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nMany other biquadratic stages exist beyond the two presented. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is described in [Laker, 1994]. However, the authors note that for most filtering applications, the circuits in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is phase equalizers, which often require feed-ins approximating negative resistors. Higher-order switched-capacitor filters can be created by cascading multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques like signal-flow-graph simulations of passive doubly terminated LC ladder filters can be used. For detailed designs of high-order SC filters, refer to [Gregorian, 1986]."
},
{
    "text": "The extensive high-capacitance spread observed in the preceding low-Q circuit when $\\mathrm{Q}>>1$ was directly attributed to the substantial damping resistance value of $Q / \\omega_{0}$ illustrated in Fig. 14.23. A method to achieve a high-Q switched-capacitor circuit without such pronounced capacitance spread involves eliminating this damping resistance in the continuous-time filter counterpart. This elimination can be effectively achieved by reformulating (14.50) as follows:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 showcases an alternative configuration for a general continuous-time biquad filter. This setup employs a blend of integrators, summing junctions, and feedback paths to execute its filtering operations.\n\nPrincipal Components:\n1. **Summing Junctions (+):**\n   - The diagram features two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n   - The second junction combines the output from the first integrator with an additional feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n   - Two integrators are incorporated. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n   - The feedback paths encompass coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are pivotal for adjusting the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n   - Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nInformation Flow:\n- The input signal \\( V_{in}(s) \\) enters the system, undergoes processing at the first summing junction where it blends with feedforward and feedback elements.\n- The output from the first junction is integrated, and the resultant signal is then directed to the second junction.\n- The second junction amalgamates this signal with further feedback before it undergoes another integration.\n- The final output \\( V_{out}(s) \\) is derived post the second integrator.\n- Feedback paths from the output and intermediate stages adjust the inputs to the summing junctions, regulating the system's response.\n\nLabels and Key Indicators:\n- **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n- **\\( s/Q \\):** Represents a damping coefficient, influencing the system's stability and transient characteristics.\n- **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients that fine-tune the filter's gain and frequency attributes.\n\nSystem Function:\nThe system operates as a biquad filter, capable of executing second-order filtering functions like low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths facilitates precise manipulation of the filter's frequency response and damping traits. This setup is particularly advantageous in continuous-time signal processing applications necessitating active-RC implementations.\n\nFig. 14.26 An alternative configuration for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit exemplifies a continuous-time active-RC biquad filter, leveraging op-amps A1 and A2 to achieve second-order filtering. It is structured for meticulous control over frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative configuration for a general active-RC biquad filter.\n\nThe signal-flow-graph representation of these equations is depicted in Fig. 14.26. Notably, the damping path, characterized by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be actualized through a capacitor, as illustrated in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the resultant high-Q switched-capacitor biquad circuit is presented in Fig. 14.28 [Martin, 1980].\n\nIn this setup, the input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Additional configurations for realizing various functions exist. For instance, a nondelayed switched capacitor linking the input to the second integrator can realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an added period delay.\n\nUtilizing the signal-flow-graph methodology outlined in Section 14.2.4, the transfer function for this circuit is derived as:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:This circuit represents a high-Q switched-capacitor biquad filter without switch sharing. It comprises two operational amplifiers, multiple switches, and capacitors arranged to form a filter with a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, which dictate the timing of the switching actions.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nyields the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there is some flexibility in determining the coefficients due to having one fewer equation than the number of coefficients. A reasonable initial choice might be:\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nSubsequent coefficients follow from this. This approach ensures a good dynamic range, though not necessarily optimal. Post-design, the biquad can be analyzed, and ratios adjusted to balance the maximum signal strength at the two opamp outputs.\n\n#### EXAMPLE 14.5\n\nThe following transfer function characterizes a bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare these results with those from a low-Q circuit. Assume $C_{1}=C_{2}=1$ in both scenarios.\n\n#### Solution\n\nFor the high-Q biquad circuit, applying (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$ yields the following capacitor values:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, the smallest capacitor in this high-Q circuit is $K_{6} C_{1}$, resulting in a capacitance spread of around 11 to 1.\n\nFor the low-Q biquad circuit, first rewrite (14.79) as:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nThis reformulation simplifies the application of equations (14.55) to (14.60). Additionally, an extra zero at $\\mathbf{z}=0$ was introduced to avoid negative capacitances, which does not alter the magnitude response.\n\nUsing $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, we obtain the following ratios:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is governed by $\\mathrm{K}_{6}$, primarily influencing the pole-Q factor's accuracy, resulting in a spread close to 17. It is noteworthy that worse capacitance spreads may occur in this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (i.e., delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nNumerous other biquadratic stages exist beyond the two presented. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is detailed in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is phase equalizers, which often require feed-ins approximating negative resistors. To design higher-order switched-capacitor filters, one can cascade multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of the relationships between state variables of passive doubly terminated LC ladder filters can be employed. For detailed descriptions on designing high-order SC filters, refer to [Gregorian, 1986]."
},
{
    "text": "The extensive high-capacitance spread observed in the preceding low-Q circuit, particularly when $\\mathrm{Q}>>1$, stemmed directly from the substantial damping resistance value of $Q / \\omega_{0}$ depicted in Fig. 14.23. A viable approach to derive a high-Q switched-capacitor circuit that circumvents such a significant capacitance spread is to eliminate this damping resistance from the continuous-time filter counterpart. This elimination can be effectively achieved by reformulating (14.50) as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 illustrates an alternative configuration for a general continuous-time biquad filter. This setup employs a blend of integrators, summing junctions, and feedback paths to execute its filtering operations.\n\nCore Components:\n1. **Summing Junctions (+):**\n- The diagram features two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n- The second junction combines the output from the first integrator with an additional feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n- Two integrators are incorporated. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n- The feedback paths encompass coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are pivotal for adjusting the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n- Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nInformation Flow:\n- The input signal \\( V_{in}(s) \\) enters the system, undergoes processing at the first summing junction where it blends with feedforward and feedback elements.\n- The output from the first junction is integrated, and the resultant signal is then directed to the second junction.\n- The second junction merges this signal with further feedback before it undergoes another integration.\n- The final output \\( V_{out}(s) \\) is derived post the second integrator.\n- Feedback paths from the output and intermediate stages adjust the input to the summing junctions, governing the system's response.\n\nLabels and Key Indicators:\n- **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n- **\\( s/Q \\):** Represents a damping coefficient, influencing the system's stability and transient response.\n- **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients that fine-tune the filter's gain and frequency attributes.\n\nSystem Function:\nThe system operates as a biquad filter, capable of executing second-order filtering functions like low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths facilitates precise control over the filter's frequency response and damping traits. This setup is particularly beneficial in continuous-time signal processing applications requiring active-RC implementations.\n\nFig. 14.26 An alternative configuration for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit exemplifies a continuous-time active-RC biquad filter, leveraging op-amps A1 and A2 to achieve second-order filtering. It is structured for precise manipulation of frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative configuration of a general active-RC biquad filter.\n\nThe signal-flow-graph representation of these two equations is depicted in Fig. 14.26. Note that here, the damping path, characterized by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be realized via a capacitor, as demonstrated in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the resultant high-Q switched-capacitor biquad circuit is presented in Fig. 14.28 [Martin, 1980].\n\nIn this setup, the input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for realizing diverse functions are feasible. For instance, a nondelayed switched capacitor linking the input to the second integrator could realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an additional period delay.\n\nUtilizing the signal-flow-graph method outlined in Section 14.2.4, the transfer function for this circuit is determined as\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:This circuit represents a high-Q switched-capacitor biquad filter devoid of switch sharing. It comprises two operational amplifiers, multiple switches, and capacitors arranged to form a filter with a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, which dictate the timing of the switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nyields the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there exists some flexibility in determining the coefficients due to having one fewer equation than the number of coefficients. A reasonable initial choice might be\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nsubsequently followed by the determination of all other ratios. This approach ensures a good dynamic range, though not necessarily optimal. Post the biquad design, it can be analyzed, and the ratios adjusted to balance the maximum signal strength at the two opamp outputs.\n\n#### EXAMPLE 14.5\n\nThe transfer function below describes a bandpass filter with a peak gain of 5 around $f_{s} / 10$ and a $Q$ of approximately 10.\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare these results with those obtained using the low-Q circuit. Assume $C_{1}=C_{2}=1$ in both scenarios.\n\n#### Solution\n\nFor the high-Q biquad circuit, employing (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$ results in the following capacitor values:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, the smallest capacitor in this high-Q circuit is $K_{6} C_{1}$, leading to a capacitance spread of approximately 11 to 1.\n\nFor the low-Q biquad circuit design, we first rephrase (14.79) as\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nto simplify the application of equations (14.55) to (14.60). Additionally, an extra zero at $\\mathbf{z}=0$ was introduced to avoid negative capacitances, which does not alter the magnitude response.\n\nWe obtain the following ratios assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is dictated by $\\mathrm{K}_{6}$, primarily influencing the pole-Q factor's accuracy, resulting in a spread of nearly 17. It is noteworthy that worse capacitance spreads may occur for this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (i.e., delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nNumerous other biquadratic stages exist beyond the two presented here. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is detailed in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits depicted in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is for phase equalizers, where feed-ins approximating negative resistors are often required. To design higher-order switched-capacitor filters, one can cascade multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of the relationships between the state variables of passive doubly terminated LC ladder filters can be employed. For detailed descriptions on designing high-order SC filters, readers are referred to [Gregorian, 1986]."
},
{
    "text": "The extensive high-capacitance spread observed in the preceding low-Q circuit, particularly when $\\mathrm{Q}>>1$, was directly attributable to the substantial damping resistance value of $Q / \\omega_{0}$ illustrated in Fig. 14.23. A viable strategy to develop a high-Q switched-capacitor circuit that circumvents such a pronounced capacitance spread involves eliminating this damping resistance from the continuous-time filter equivalent. This elimination can be effectively achieved by reformulating (14.50) as follows:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 showcases an alternative implementation of a general continuous-time biquad filter. This system employs a blend of integrators, summing junctions, and feedback pathways to execute its filtering tasks.\n\nPrimary Components:\n1. **Summing Junctions (+):**\n   - The diagram features two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n   - The second junction combines the output from the first integrator with an additional feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n   - Two integrators are incorporated. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n   - The feedback paths encompass coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are pivotal for adjusting the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n   - Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nInformation Flow:\n   - The input signal \\( V_{in}(s) \\) enters the system, processed by the first summing junction where it integrates with feedforward and feedback elements.\n   - The output from the first junction is integrated, then routed to the second junction.\n   - The second junction blends this signal with further feedback before undergoing another integration.\n   - The final output \\( V_{out}(s) \\) is derived post the second integrator.\n   - Feedback paths from the output and intermediate stages adjust the input to the summing junctions, regulating the system's response.\n\nLabels and Indicators:\n   - **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n   - **\\( s/Q \\):** Represents a damping coefficient, influencing the system's stability and transient behavior.\n   - **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients for adjusting the filter's gain and frequency traits.\n\nSystem Function:\nThe system operates as a biquad filter, capable of executing second-order filtering functions like low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths permits precise manipulation of the filter's frequency response and damping properties, making it particularly advantageous in continuous-time signal processing applications requiring active-RC implementations.\n\nFig. 14.26 An alternative implementation for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit represents a continuous-time active-RC biquad filter, utilizing op-amps A1 and A2 for second-order filtering. It is structured for precise control over frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative implementation of a general active-RC biquad filter.\n\nThe signal-flow graph for these equations is depicted in Fig. 14.26. Note that the damping path, represented by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be realized via a capacitor, as demonstrated in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the resultant high-Q switched-capacitor biquad circuit is illustrated in Fig. 14.28 [Martin, 1980].\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for realizing diverse functions exist. For instance, a nondelayed switched capacitor from the input to the second integrator could realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an added period delay.\n\nUsing the signal-flow-graph method detailed in Section 14.2.4, the transfer function for this circuit is derived as:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:This circuit is a high-Q switched-capacitor biquad filter without switch sharing, featuring two operational amplifiers, multiple switches, and capacitors arranged to achieve a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, dictating the timing of switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nyields the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there is some flexibility in determining the coefficients due to having one fewer equation than the number of coefficients. A reasonable initial choice might be:\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nSubsequently, all other ratios follow. This approach ensures a good dynamic range, though not necessarily optimal. After designing the biquad, it can be analyzed, and the ratios adjusted to balance the maximum signal strength at the two op-amp outputs.\n\n#### EXAMPLE 14.5\n\nThe following transfer function represents a bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare these results to those obtained with the low-Q circuit. Assume $C_{1}=C_{2}=1$ in both scenarios.\n\n#### Solution\n\nFor the high-Q biquad circuit, employing (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$ results in the following capacitor values:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, the smallest capacitor in this high-Q circuit is $K_{6} C_{1}$, yielding a capacitance spread of around 11 to 1.\n\nFor the low-Q biquad circuit design, (14.79) is first rewritten as:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nto facilitate the application of equations (14.55) to (14.60). An extra zero at $\\mathbf{z}=0$ was added to avoid negative capacitances, which does not alter the magnitude response.\n\nAssuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, we obtain the following ratios:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is determined by $\\mathrm{K}_{6}$, primarily influencing the pole-Q factor's accuracy, resulting in a spread near 17. It is noteworthy that worse capacitance spreads may occur in this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (i.e., delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nBeyond the two biquad stages presented, numerous other stages exist. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is described in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is phase equalizers, which often require feed-ins approximating negative resistors. Higher-order switched-capacitor filters can be constructed by cascading multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of passive doubly terminated LC ladder filters can be employed. For detailed descriptions on designing high-order SC filters, readers are referred to [Gregorian, 1986]."
},
{
    "text": "The extensive high-capacitance spread observed in the prior low-Q circuit when $\\mathrm{Q}>>1$ was directly attributed to the substantial damping resistance value of $Q / \\omega_{0}$ illustrated in Fig. 14.23. A viable strategy to develop a high-Q switched-capacitor circuit devoid of such pronounced capacitance spread involves removing this damping resistance from its continuous-time filter equivalent. This removal can be effectively achieved by reformulating (14.50) as follows:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 illustrates an alternative configuration for a general continuous-time biquad filter. This setup employs a blend of integrators, summing junctions, and feedback paths to execute its filtering tasks.\n\nKey Components:\n1. **Summing Junctions (+):**\n   - The diagram features two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n   - The second junction combines the output from the first integrator with another feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n   - Two integrators are incorporated. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n   - The feedback paths involve coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are essential for modulating the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n   - Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nInformation Flow:\n   - The input signal \\( V_{in}(s) \\) enters the system, undergoes processing at the first summing junction where it blends with feedforward and feedback elements.\n   - The output from the first junction is integrated, and the resulting signal is then directed to the second junction.\n   - The second junction mixes this signal with additional feedback before further integration.\n   - The final output \\( V_{out}(s) \\) is derived post the second integrator.\n   - Feedback paths from the output and intermediate stages adjust the input to the junctions, governing the system's response.\n\nLabels and Indicators:\n   - **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n   - **\\( s/Q \\):** Represents a damping coefficient, influencing the system's stability and transient behavior.\n   - **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients that fine-tune the filter's gain and frequency traits.\n\nSystem Function:\nThis setup operates as a biquad filter, capable of executing second-order filtering functions like low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths permits precise manipulation of the filter's frequency response and damping properties. This setup is particularly beneficial in continuous-time signal processing applications requiring active-RC implementations.\n\nFig. 14.26 An alternative configuration for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit exemplifies a continuous-time active-RC biquad filter, leveraging op-amps A1 and A2 for second-order filtering. It is structured for precise management of frequency response and damping properties, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative configuration for a general active-RC biquad filter.\n\nThe signal-flow-graph representation of these equations is depicted in Fig. 14.26. Note that the damping path, characterized by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be actualized via a capacitor, as demonstrated in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the resultant high-Q switched-capacitor biquad circuit is presented in Fig. 14.28 [Martin, 1980].\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for realizing diverse functions exist. For instance, a nondelayed switched capacitor linking the input to the second integrator could realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an additional period delay.\n\nUtilizing the signal-flow-graph approach detailed in Section 14.2.4, the transfer function for this circuit is determined as follows:\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:This circuit represents a high-Q switched-capacitor biquad filter without switch sharing. It comprises two operational amplifiers, multiple switches, and capacitors arranged to form a filter with a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, which dictate the timing of switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nyields the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there exists some flexibility in determining the coefficients due to having one fewer equation than the number of coefficients. A reasonable initial choice might be\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nfrom which all other ratios follow. This provides a good dynamic range but may not be optimal. Post-design, the biquad can be analyzed, and ratios adjusted to balance the maximum signal strength at the two opamp outputs.\n\n#### EXAMPLE 14.5\n\nThe transfer function below describes a bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare these results with those obtained using the low-Q circuit. Assume $C_{1}=C_{2}=1$ in both scenarios.\n\n#### Solution\n\nFor the high-Q biquad circuit, applying (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$ results in the following capacitor values:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, in this high-Q circuit, the smallest capacitor is $K_{6} C_{1}$, yielding a capacitance spread of about 11 to 1.\n\nFor the low-Q biquad circuit design, first rewrite (14.79) as\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nto simplify applying equations (14.55) to (14.60). An extra zero at $\\mathbf{z}=0$ was added to avoid negative capacitances, which does not alter the magnitude response.\n\nAssuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, we obtain the following ratios:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is governed by $\\mathrm{K}_{6}$, primarily affecting the pole-Q factor's accuracy, resulting in a spread near 17. It should be noted that worse capacitance spreads occur for this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (i.e., delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nNumerous other biquadratic stages exist beyond the two presented. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is described in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is for phase equalizers, where feed-ins approximating negative resistors are often needed. To design higher-order switched-capacitor filters, one can cascade multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of passive doubly terminated LC ladder filters can be used. For detailed descriptions on designing high-order SC filters, refer to [Gregorian, 1986]."
},
{
    "text": "The extensive high-capacitance spread observed in the preceding low-Q circuit when $\\mathrm{Q}>>1$ was directly attributable to the substantial damping resistance value of $Q / \\omega_{0}$ illustrated in Fig. 14.23. A viable method to create a high-Q switched-capacitor circuit that avoids such a significant capacitance spread involves eliminating this damping resistance in the continuous-time filter equivalent. This elimination can be achieved by reformulating (14.50) as follows:\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 illustrates an alternative implementation of a general continuous-time biquad filter. This system employs a mix of integrators, summing junctions, and feedback paths to perform its filtering tasks.\n\nPrincipal Components:\n1. **Summing Junctions (+):**\n   - The diagram features two summing junctions. The first combines the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n   - The second merges the output of the first integrator with another feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n   - Two integrators are included. The first processes the output from the first summing junction, while the second handles the output from the second summing junction.\n\n3. **Feedback Paths:**\n   - The feedback paths incorporate coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are vital for adjusting the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n   - Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nInformation or Control Flow:\n- The input signal \\( V_{in}(s) \\) enters the system, processed by the first summing junction where it blends with feedforward and feedback elements.\n- The output from the first summing junction is integrated, and the resulting signal is sent to the second summing junction.\n- The second summing junction mixes this signal with additional feedback before integrating it again.\n- The final output \\( V_{out}(s) \\) is derived after the second integrator.\n- Feedback paths from the output and intermediate stages adjust the input to the summing junctions, controlling the system's response.\n\nLabels, Annotations, and Key Indicators:\n- **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n- **\\( s/Q \\):** Represents a damping coefficient, impacting the system's stability and transient response.\n- **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients for adjusting the filter's gain and frequency characteristics.\n\nOverall System Function:\nThe system acts as a biquad filter, capable of implementing second-order filtering functions like low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths allows precise control over the filter's frequency response and damping traits. This setup is particularly beneficial in continuous-time signal processing applications requiring active-RC implementations.\n\nFig. 14.26 An alternative implementation for a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit is a continuous-time active-RC biquad filter, utilizing op-amps A1 and A2 for second-order filtering. It is designed for precise control over frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative implementation of a general active-RC biquad filter.\n\nThe signal-flow graph representation of these two equations is depicted in Fig. 14.26. Note that here, the damping path, represented by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be realized using a capacitor, as demonstrated in Fig. 14.27.\n\nBy substituting resistors with appropriate switched-capacitor feed-in stages, the final high-Q switched-capacitor biquad circuit is presented in Fig. 14.28 [Martin, 1980].\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for realizing different functions are possible. For instance, a nondelayed switched capacitor from the input to the second integrator could realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an additional period delay.\n\nUsing the signal-flow-graph method described in Section 14.2.4, the transfer function for this circuit is determined as\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:The circuit is a high-Q switched-capacitor biquad filter without switch sharing. It comprises two operational amplifiers, multiple switches, and capacitors arranged to form a filter with a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, dictating the timing of switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nresults in the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there is some flexibility in determining the coefficients due to having one fewer equation than the number of coefficients. A reasonable initial choice might be\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nafter which all other ratios follow. This choice provides a good dynamic range but may not be optimal. After designing the biquad, it can be analyzed, and the ratios adjusted to balance the maximum signal strength at the two op-amp outputs.\n\n#### EXAMPLE 14.5\n\nThe following transfer function describes a bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare the results to those obtainable with the low-Q circuit. Assume $C_{1}=C_{2}=1$ in both cases.\n\n#### Solution\n\nFor the high-Q biquad circuit, utilizing (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$ yields the following capacitor values:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, in this high-Q circuit, the smallest capacitor is $K_{6} C_{1}$, resulting in a capacitance spread of about 11 to 1.\n\nFor the low-Q biquad circuit design, first rewrite (14.79) as\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nto simplify applying equations (14.55) to (14.60). Additionally, an extra zero at $\\mathbf{z}=0$ was added to avoid negative capacitances, which does not alter the magnitude response.\n\nAssuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$, we obtain the following ratios:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is determined by $\\mathrm{K}_{6}$, primarily affecting the pole-Q factor's accuracy, resulting in a spread near 17. It is noteworthy that worse capacitance spreads will occur for this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (i.e., delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nMany other biquadratic stages exist beyond the two presented here. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is described in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits in Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is for phase equalizers, where feed-ins approximating negative resistors are often needed. To design higher-order switched-capacitor filters, one can cascade multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of the relationships between state variables of passive doubly terminated LC ladder filters can be used. For detailed descriptions on designing high-order SC filters, refer to [Gregorian, 1986]."
},
{
    "text": "The extensive high-capacitance spread observed in the prior low-Q circuit when $\\mathrm{Q}>>1$ was directly attributed to the substantial damping resistance value of $Q / \\omega_{0}$ illustrated in Fig. 14.23. A method to develop a high-Q switched-capacitor circuit that avoids such a significant capacitance spread involves removing this damping resistance from the continuous-time filter equivalent. This elimination can be achieved by reformulating (14.50) as\n\n$$\n\\begin{equation*}\nV_{\\text {out }}(\\mathrm{s})=-\\frac{1}{\\mathrm{~s}}\\left[\\mathrm{k}_{2} \\mathrm{~s} \\mathrm{~V}_{\\text {in }}(\\mathrm{s})-\\omega_{0} \\mathrm{~V}_{\\mathrm{cl} 1}(\\mathrm{~s})\\right] \\tag{14.69}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{c} 1}(\\mathrm{~s})=-\\frac{1}{\\mathrm{~s}}\\left[\\left(\\frac{\\mathrm{k}_{0}}{\\omega_{0}}+\\frac{\\mathrm{k}_{1} \\mathrm{~s}}{\\omega_{0}}\\right) \\mathrm{V}_{\\text {in }}(\\mathrm{s})+\\omega_{0} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})+\\frac{\\mathrm{s}}{\\mathrm{Q}} \\mathrm{~V}_{\\text {out }}(\\mathrm{s})\\right] \\tag{14.70}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.26\ndescription:Fig. 14.26 illustrates an alternative implementation of a generic continuous-time biquad filter. This system employs a mix of integrators, summing junctions, and feedback paths to execute its filtering operation.\n\nMain Components:\n1. **Summing Junctions (+):**\n- The diagram features two summing junctions. The initial junction merges the input signal \\( V_{in}(s) \\) with feedback and feedforward elements.\n- The second junction combines the output from the first integrator with another feedback element.\n\n2. **Integrators (\\(1/s\\)):**\n- Two integrators are included. The first processes the output from the initial summing junction, while the second handles the output from the second junction.\n\n3. **Feedback Paths:**\n- The feedback paths incorporate coefficients \\( \\omega_0 \\), \\( s/Q \\), and \\( k_2 s \\). These paths are vital for adjusting the filter's damping and frequency response.\n\n4. **Feedforward Paths:**\n- Coefficients \\( k_0/\\omega_0 \\) and \\( (k_1 s)/\\omega_0 \\) are utilized in the feedforward paths from the input to the first summing junction.\n\nFlow of Information or Control:\n- The input signal \\( V_{in}(s) \\) enters the system and is processed by the first summing junction, where it is integrated with feedforward and feedback elements.\n- The output from the first junction is integrated, and the resulting signal is then directed to the second junction.\n- The second junction blends this signal with additional feedback before it undergoes further integration.\n- The final output \\( V_{out}(s) \\) is obtained after the second integrator.\n- Feedback paths from the output and intermediate stages adjust the input to the summing junctions, controlling the system's response.\n\nLabels, Annotations, and Key Indicators:\n- **\\( \\omega_0 \\):** Denotes a frequency coefficient in the feedback path.\n- **\\( s/Q \\):** Represents a damping coefficient, influencing the system's stability and transient response.\n- **\\( k_0/\\omega_0 \\), \\( (k_1 s)/\\omega_0 \\), \\( k_2 s \\):** Coefficients that modify the filter's gain and frequency characteristics.\n\nOverall System Function:\nThe system operates as a biquad filter, capable of implementing second-order filtering functions such as low-pass, high-pass, band-pass, and band-stop filters. The configuration of integrators, summing junctions, and feedback/feedforward paths allows precise control over the filter's frequency response and damping traits. This setup is particularly beneficial in continuous-time signal processing applications requiring active-RC implementations.\n\nFig. 14.26 An alternative implementation of a general continuous-time biquad filter.\nimage_name:Fig. 14.26\ndescription:This circuit is a continuous-time active-RC biquad filter, utilizing op-amps A1 and A2 to achieve second-order filtering. It is designed for precise control over frequency response and damping characteristics, incorporating resistors and capacitors to set the filter's frequency and quality factor (Q).\n\nFig. 14.27 An alternative implementation of a general active-RC biquad filter.\n\nThe signal-flow-graph representation of these two equations is depicted in Fig. 14.26. Note that here, the damping path, represented by the $\\mathrm{s} / \\mathrm{Q}$ coefficient, traverses the first integrator stage and can be realized using a capacitor, as shown in Fig. 14.27.\n\nBy replacing resistors with appropriate switched-capacitor feed-in stages, the final high-Q switched-capacitor biquad circuit is presented in Fig. 14.28 [Martin, 1980].\n\nThe input capacitor $\\mathrm{K}_{1} \\mathrm{C}_{1}$ serves as the primary signal path for low-pass filters, $\\mathrm{K}_{2} \\mathrm{C}_{1}$ for bandpass filters, and $\\mathrm{K}_{3} \\mathrm{C}_{2}$ for high-pass filters. Other configurations for realizing different functions are possible. For instance, a nondelayed switched capacitor from the input to the second integrator could realize an inverting bandpass function. Interchanging the phases on the input switches of such a capacitor would yield a noninverting bandpass function, albeit with an additional period delay.\n\nUsing the signal-flow-graph method outlined in Section 14.2.4, the transfer function for this circuit is determined as\n\n$$\n\\begin{equation*}\nH(z) \\equiv \\frac{V_{0}(z)}{V_{i}(z)}=-\\frac{K_{3} z^{2}+\\left(K_{1} K_{5}+K_{2} K_{5}-2 K_{3}\\right) \\mathrm{z}+\\left(\\mathrm{K}_{3}-\\mathrm{K}_{2} \\mathrm{~K}_{5}\\right)}{\\mathrm{z}^{2}+\\left(\\mathrm{K}_{4} \\mathrm{~K}_{5}+\\mathrm{K}_{5} \\mathrm{~K}_{6}-2\\right) \\mathrm{Z}+\\left(1-\\mathrm{K}_{5} \\mathrm{~K}_{6}\\right)} \\tag{14.71}\n\\end{equation*}\n$$\n\nimage_name:Fig. 14.28\ndescription:The circuit represents a high-Q switched-capacitor biquad filter without switch sharing. It comprises two operational amplifiers, multiple switches, and capacitors arranged to form a filter with a specific transfer function. The switches are governed by two clock phases, φ1 and φ2, which dictate the timing of the switching events.\n\nFig. 14.28 A high-Q switched-capacitor biquad filter (without switch sharing).\n\nAligning the coefficients of (14.71) with those of a discrete-time transfer function given by ${ }^{4}$\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{a_{2} z^{2}+a_{1} z+a_{0}}{z^{2}+b_{1} z+b_{0}} \\tag{14.72}\n\\end{equation*}\n$$\n\nresults in the following equations:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{1} \\mathrm{~K}_{5} & =\\mathrm{a}_{0}+\\mathrm{a}_{1}+\\mathrm{a}_{2}  \\tag{14.73}\\\\\n\\mathrm{~K}_{2} \\mathrm{~K}_{5} & =\\mathrm{a}_{2}-\\mathrm{a}_{0}  \\tag{14.74}\\\\\n\\mathrm{~K}_{3} & =\\mathrm{a}_{2}  \\tag{14.75}\\\\\n\\mathrm{~K}_{4} \\mathrm{~K}_{5} & =1+\\mathrm{b}_{0}+\\mathrm{b}_{1}  \\tag{14.76}\\\\\n\\mathrm{~K}_{5} \\mathrm{~K}_{6} & =1-\\mathrm{b}_{0} \\tag{14.77}\n\\end{align*}\n$$\n\nAs with the low-Q biquad, there is some flexibility in determining the coefficients due to having one fewer equation than the number of coefficients. A reasonable initial choice might be\n\n$$\n\\begin{equation*}\n\\mathrm{K}_{4}=\\mathrm{K}_{5}=\\sqrt{1+\\mathrm{b}_{0}+\\mathrm{b}_{1}} \\tag{14.78}\n\\end{equation*}\n$$\n\nafter which all other ratios are derived. This provides a good dynamic range but may not be optimal. After designing the biquad, it can be analyzed, and the ratios adjusted to equalize the maximum signal strength at the two opamp outputs.\n\n#### EXAMPLE 14.5\n\nThe following transfer function characterizes a bandpass filter with a peak gain of 5 near $f_{s} / 10$ and a $Q$ of approximately 10:\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.288(z-1)}{z^{2}-1.572 z+0.9429} \\tag{14.79}\n\\end{equation*}\n$$\n\nDetermine the largest to smallest capacitor ratio if this transfer function is realized using the high-Q biquad circuit. Compare these results to those obtained with the low-Q circuit. Assume $C_{1}=C_{2}=1$ in both cases.\n\n#### Solution\n\nFor the high-Q biquad circuit, applying (14.73) to (14.76) and assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$ yields the following capacitor values:\n\n$$\n\\begin{aligned}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6090 \\\\\n\\mathrm{~K}_{1} & =0 \\\\\n\\mathrm{~K}_{2} & =0.4729 \\\\\n\\mathrm{~K}_{3} & =0 \\\\\n\\mathrm{~K}_{6} & =0.0938\n\\end{aligned}\n$$\n\nGiven $C_{1}=C_{2}=1$, the smallest capacitor in this high-Q circuit is $K_{6} C_{1}$, resulting in a capacitance spread of about 11 to 1.\n\nFor the low-Q biquad circuit design, we first reexpress (14.79) as\n\n$$\n\\begin{equation*}\nH(z)=-\\frac{0.3054(z-1) z}{1.0606 z^{2}-1.667 z+1} \\tag{14.80}\n\\end{equation*}\n$$\n\nto simplify the application of equations (14.55) to (14.60). An extra zero at $\\mathbf{z}=0$ was added to avoid negative capacitances, which does not alter the magnitude response.\n\nWe obtain the following ratios assuming $\\mathrm{K}_{4}=\\mathrm{K}_{5}$:\n\n$$\n\\begin{align*}\n\\mathrm{K}_{4} & =\\mathrm{K}_{5}=0.6274  \\tag{14.81}\\\\\n\\mathrm{~K}_{1} & =0  \\tag{14.82}\\\\\n\\mathrm{~K}_{2} & =0.3054  \\tag{14.83}\\\\\n\\mathrm{~K}_{3} & =0  \\tag{14.84}\\\\\n\\mathrm{~K}_{6} & =0.0606 \\tag{14.85}\n\\end{align*}\n$$\n\nThus, the capacitance ratio for this circuit is determined by $\\mathrm{K}_{6}$, primarily affecting the accuracy of the pole-Q factor, resulting in a spread of nearly 17. It should be noted that worse capacitance spreads will occur for this low-Q circuit if the pole $Q$ is higher and/or the sampling frequency increases relative to the passband edge.\n\nKey Point: Various discrete-time biquads can be realized by altering the type (i.e., delayed, delay-free) and specific connections of switched-capacitor branches within a two-integrator loop. The choice of biquad depends on the desired pole and zero locations.\n\nMany other biquadratic stages exist beyond the two presented here. For instance, a general stage capable of realizing any $\\mathbf{z}$-transform is described in [Laker, 1994]. However, the authors have found that for most filtering applications, the circuits of either Fig. 14.24 or Fig. 14.28 (with switch sharing) are nearly optimal. The exception is for phase equalizers, where feed-ins approximating negative resistors are often needed. To create higher-order switched-capacitor filters, one can cascade multiple biquad and/or first-order stages. Alternatively, lower-sensitivity techniques such as signal-flow-graph simulations of the relationships between the state variables of passive doubly terminated LC ladder filters can be used. For detailed descriptions on designing high-order SC filters, readers are referred to [Gregorian, 1986]."
},
{
    "text": "As detailed in Chapter 10, comparators employing switches are prone to charge-injection errors. Fortunately, by deactivating certain switches first, the charge-injection errors of the entire circuit are attributed solely to those initial switches. This principle also applies to switched-capacitor circuits, where charge-injection effects can be minimized by slightly advancing some clock signals relative to the others. The determination of which clock signals to advance is best illustrated through the following example.\n\nConsider the first-order switched-capacitor filter depicted in Fig. 14.29, which utilizes switch sharing. Here, $\\phi_{1 \\mathrm{a}}$ and $\\phi_{2 \\mathrm{a}}$ are deliberately advanced compared to the other clock signals for specific reasons. Firstly, since $\\phi_{2 \\mathrm{a}}$ is consistently connected to ground and $\\phi_{1 \\mathrm{a}}$ to virtual ground, these switches only need to convey signals near the ground node (rather than rail-to-rail signals typical at opamp outputs). Consequently, these switches can be implemented using single n-channel transistors instead of full CMOS transmission gates. ${ }^{5} \\mathrm{~A}$ more critical reason for this clock configuration is that the charge injections from $Q_{3}$ and $Q_{4}$ are not signal-dependent, whereas those from $Q_{1}$ and $Q_{6}$ are. Specifically, as discussed in Chapter 10, the channel charge of an NMOS transistor in triode is expressed by\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\nHere, it is evident that the charge is influenced by both the gate-source voltage and the threshold voltage. When $Q_{3}$ and $Q_{4}$ are active, $V_{G S}=V_{D D}$, and since their source remains at zero volts, their threshold voltages remain constant. Therefore, the charge injected by $Q_{3}$ and $Q_{4}$ remains consistent across clock cycles, effectively acting as a dc offset. Unfortunately, the same cannot be said for $Q_{1}$ and $Q_{6}$. For instance, when $Q_{1}$ is on, its channel charge, derived from (14.86), is\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\nThus, a portion of the channel charge is linearly related to $V_{i}$. However, its source voltage stabilizes at $V_{i}$, causing the transistor's threshold voltage to vary nonlinearly (due to the bulk effect, assuming a fixed substrate voltage). Consequently, $Q_{C H 1}$ exhibits both linear and nonlinear dependencies on $V_{i}$, leading to gain errors and distortion if $Q_{1}$ were turned off prematurely. Lastly, while $Q_{2}$ and $Q_{5}$ would also inject constant charge from one cycle to the next, it is advisable to avoid any unnecessary charge injection, so these switches are not advanced.\n\nIn summary, to mitigate charge-injection effects in switched-capacitor circuits, design all switches connected to ground or virtual ground as n-channel switches and deactivate the switches near the virtual ground node of the opamps first. This approach minimizes distortion and gain errors while maintaining a low dc offset.\n\n#### EXAMPLE 14.6\n\nGiven an ideal opamp, estimate the dc offset at the output of the circuit in Fig. 14.29 due to channel-charge injection (忽略 overlap capacitance charge injection) when $C_{1}=0$ and $C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$. Assume $Q_{3}$ and $Q_{4}$ are n-channel devices with a threshold voltage of $V_{t n}=0.45 \\mathrm{~V}$, width of $W=5 \\mu \\mathrm{~m}$, length of $L=0.2 \\mu \\mathrm{~m}$, and $C_{o x}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$. The power supply is 1.8 V, and the circuit's \"ground\" node is at $V_{D D} / 2=0.9 \\mathrm{~V}$.\n\n#### Solution\n\nThe dc feedback around the opamp maintains the negative input at $V_{D D} / 2=0.9 \\mathrm{~V}$. From (14.86), the channel charge of $Q_{3}$ and $Q_{4}$ (when on) is calculated as\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\nAll dc feedback current is transferred through the switched capacitor $C_{3}$. Thus, the charge transferred through this capacitor must equal the charge injected by $Q_{3}$ and $Q_{4}$ (assuming the input is at zero volts and contributes no charge). The charge transfer into $C_{3}$ is given by\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\nIt is estimated that half the channel charges of $Q_{3}$ and $Q_{4}$ are injected into the virtual ground node. When $\\phi_{1 \\mathrm{a}}$ turns off, half of $Q_{4}$'s charge goes to the virtual ground, while the other half is placed at the node between $Q_{3}$ and $Q_{4}$. When $\\phi_{2 \\mathrm{a}}$ goes high, the second charge escapes to ground, but when $\\phi_{2 \\mathrm{a}}$ goes low, half of its charge remains between $Q_{3}$ and $Q_{4}$ and is transferred to the virtual ground when $\\phi_{1 \\mathrm{a}}$ goes high again. This leads to the charge equation\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\nUsing this to find $Q_{C_{3}}$, the output voltage from (14.89) is\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\nThus, the output dc offset is influenced by the capacitor sizes (particularly $C_{3}$), switch sizes, and power-supply voltage. If the opamp's dc input offset voltage were included, it would be multiplied by the circuit's dc gain, similar to an active-RC circuit.\n\nCharge-injection is particularly problematic at higher frequencies. At these frequencies, the time constant of the switch-on resistance and the capacitor being charged or discharged must be smaller, necessitating larger switches for a given capacitor size and thus increasing charge-injection. A simple formula can approximate the upper frequency limit for an SC circuit, considering a specified maximum voltage change due to charge injection. This formula accounts for switch channel charge only, ignoring overlap capacitance.\n\nKey Point: Charge injection is most severe at high switching speeds, where low switch on resistances require wide transistors and small capacitors.\n\nMost SC circuits have two series switches per capacitor. Assuming the sampling clock half-period must exceed five time constants for good settling, we have\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\nwhere T is the sampling period, $\\mathrm{R}_{\\mathrm{on}}$ is the on resistance of the n-channel switch, and C is the capacitor. This can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\nwhere $\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$ is the clock frequency. From Chapter 1 (1.108), we have\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\nUsing (14.87), the charge change due to channel charge only, when an n-channel switch is turned off, is approximated by\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\nFor a specified $|\\Delta \\mathrm{V}|_{\\max }$, (14.95) implies\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\nSubstituting (14.94) and (14.96) into (14.93) yields\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\na simple expression. Thus, the upper frequency limit due to charge injection in SC circuits is inversely proportional to $L^{2}$ and is roughly independent of capacitor size or power-supply voltage, assuming optimal switch sizes. As technology advances, higher switching frequencies become feasible. However, (14.97) excludes overlap capacitance, so it is an optimistic upper bound on the maximum clocking frequency.\n\nKey Point: Technological scaling allows smaller transistors to provide the same on resistance, thereby reducing charge injection or, for the same charge injection, enabling higher switching frequencies.\n\n#### EXAMPLE 14.7\n\nFor a maximum voltage change of 1 mV due to clock feedthrough, what are the maximum clocking frequencies considering only channel charge injection for technologies with minimum channel lengths of $0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$, and $0.18 \\mu \\mathrm{~m}$ from Table 1.5?\n\n#### Solution\n\nUsing (14.97) and carrier mobilities from Table 1.5, the maximum clocking frequencies are found to be less than $14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$, and 196 MHz, respectively, for the three technologies. This demonstrates a significant speed increase for SC circuits with technological advancements."
},
{
    "text": "As discussed in Chapter 10, comparators utilizing switches are prone to charge-injection errors. Fortunately, by deactivating certain switches first, the charge-injection errors of the entire circuit are attributed solely to those initial switches. This principle also applies to switched-capacitor circuits, allowing charge-injection effects to be minimized by slightly advancing some clock signals relative to the others. The selection of which clock signals to advance is best illustrated through an example.\n\nConsider the first-order switched-capacitor filter depicted in Fig. 14.29, which employs switch sharing. Here, $\\phi_{1 \\mathrm{a}}$ and $\\phi_{2 \\mathrm{a}}$ are purposely advanced compared to the other clock signals for specific reasons. Firstly, since $\\phi_{2 \\mathrm{a}}$ is always connected to ground and $\\phi_{1 \\mathrm{a}}$ to virtual ground, these switches only need to pass signals near the ground node (unlike rail-to-rail signals at opamp outputs). Consequently, these switches can be implemented using single n-channel transistors instead of full CMOS transmission gates. ${ }^{5} \\mathrm{~A}$ more critical reason for this clock configuration is that the charge injections from $Q_{3}$ and $Q_{4}$ are not signal-dependent, whereas those from $Q_{1}$ and $Q_{6}$ are. Specifically, as detailed in Chapter 10, the channel charge of an NMOS transistor in triode is given by\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\nHere, it is evident that the charge is influenced by both the gate-source voltage and the threshold voltage. When $Q_{3}$ and $Q_{4}$ are active, $V_{G S}=V_{D D}$, and since their source remains at zero volts, their threshold voltages remain constant. Thus, the charge injected by $Q_{3}$ and $Q_{4}$ remains consistent across clock cycles, effectively acting as a dc offset. Unfortunately, the same cannot be said for $Q_{1}$ and $Q_{6}$. For instance, when $Q_{1}$ is on, its channel charge, as per (14.86), is\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\nThus, a portion of the channel charge is linearly related to $V_{i}$. However, its source voltage stabilizes at $V_{i}$, causing the transistor's threshold voltage to change nonlinearly (due to the bulk effect, assuming a fixed substrate voltage). Consequently, $Q_{C H 1}$ exhibits both linear and nonlinear dependencies on $V_{i}$, leading to gain errors and distortion if $Q_{1}$ were turned off prematurely. Lastly, while $Q_{2}$ and $Q_{5}$ would inject constant charge from cycle to cycle, it is preferable to avoid any unnecessary charge injection, so these switches are not advanced.\n\nIn summary, to mitigate charge-injection effects in switched-capacitor circuits, all switches connected to ground or virtual ground should be realized as n-channel switches, and those near the virtual ground node of the opamps should be turned off first. This approach minimizes distortion and gain error while keeping dc offset low.\n\n#### EXAMPLE 14.6\n\nGiven an ideal opamp, estimate the dc offset at the output of the circuit in Fig. 14.29 due to channel-charge injection (ignoring overlap capacitance) when $C_{1}=0$ and $C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$. Assume $Q_{3}$ and $Q_{4}$ are n-channel devices with a threshold voltage of $V_{t n}=0.45 \\mathrm{~V}$, width of $W=5 \\mu \\mathrm{~m}$, length of $L=0.2 \\mu \\mathrm{~m}$, and $C_{o x}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$. The power supply is 1.8 V, and the circuit's \"ground\" node is at $V_{D D} / 2=0.9 \\mathrm{~V}$.\n\n#### Solution\n\nThe dc feedback around the opamp maintains its negative input at $V_{D D} / 2=0.9 \\mathrm{~V}$. From (14.86), the channel charge of $Q_{3}$ and $Q_{4}$ (when on) is calculated as\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\nAll dc feedback current is transferred through the switched capacitor $C_{3}$. Thus, the charge transferred through $C_{3}$ must equal the charge injected by $Q_{3}$ and $Q_{4}$ (assuming the input is at zero volts). The charge transfer into $C_{3}$ is given by\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\nIt is estimated that half the channel charges of $Q_{3}$ and $Q_{4}$ are injected into the virtual ground node. When $\\phi_{1 \\mathrm{a}}$ turns off, half of $Q_{4}$'s charge goes to the virtual ground, while the other half is placed at the node between $Q_{3}$ and $Q_{4}$. When $\\phi_{2 \\mathrm{a}}$ goes high, the second charge is grounded, but when $\\phi_{2 \\mathrm{a}}$ goes low, half of its charge remains between $Q_{3}$ and $Q_{4}$ and is transferred to the virtual ground when $\\phi_{1 \\mathrm{a}}$ goes high again. This leads to the charge equation\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\nUsing this to find $Q_{C_{3}}$, the output voltage from (14.89) is\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\nThus, the output dc offset is influenced by the capacitor sizes (particularly $C_{3}$), switch sizes, and power-supply voltage. If the opamp's dc input offset voltage were considered, it would be multiplied by the circuit's dc gain, similar to an active-RC circuit.\n\nCharge-injection is particularly problematic at higher frequencies. At these frequencies, the time constant of the switch-on resistance and the capacitor must be smaller, necessitating larger switches for a given capacitor size and thus increasing charge-injection. A simple formula can approximate the upper frequency limit for an SC circuit based on the maximum voltage change due to charge injection, considering only switch channel charge and ignoring overlap capacitance.\n\nKey Point: Charge injection is most severe at high switching speeds, where low switch on resistances require wide transistors and small capacitors.\n\nMost SC circuits have two series switches per capacitor. Assuming the sampling clock half-period must exceed five time constants for good settling, we have\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\nwhere T is the sampling period, $\\mathrm{R}_{\\mathrm{on}}$ is the on resistance of the n-channel switch, and C is the capacitor. This can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\nwhere $\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$ is the clock frequency. From Chapter 1 (1.108), we have\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\nUsing (14.87), the voltage change due to channel charge when an n-channel switch is turned off is approximated by\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\nFor a specified $|\\Delta \\mathrm{V}|_{\\max }$, (14.95) implies\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\nSubstituting (14.94) and (14.96) into (14.93) yields\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\na straightforward expression. Thus, the upper frequency limit due to charge injection in SC circuits is inversely proportional to $L^{2}$ and largely independent of capacitor size or power-supply voltage, assuming optimal switch sizes. As technology advances, higher switching frequencies become feasible. Note that (14.97) excludes overlap capacitance, making it an optimistic upper bound on the maximum clocking frequency.\n\nKey Point: Technological scaling allows smaller transistors to provide the same on resistance, thereby reducing charge injection or, for equivalent charge injection, enabling higher switching frequencies.\n\n#### EXAMPLE 14.7\n\nFor a maximum voltage change of 1 mV due to clock feedthrough, what are the maximum clocking frequencies considering only channel charge injection for technologies with minimum channel lengths of $0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$, and $0.18 \\mu \\mathrm{~m}$ from Table 1.5?\n\n#### Solution\n\nUsing (14.97) and carrier mobilities from Table 1.5, the maximum clocking frequencies are found to be less than $14.8 \\mathrm{MHz}$, $69 \\mathrm{MHz}$, and $196 \\mathrm{MHz}$ for the respective technologies. This demonstrates a significant speed increase for SC circuits with technological advancements."
},
{
    "text": "As detailed in Chapter 10, comparators employing switches are prone to charge-injection errors. However, by deactivating specific switches initially, the charge-injection errors of the entire circuit are attributable solely to those early-deactivated switches. This principle also applies to switched-capacitor circuits, where charge-injection effects can be minimized by slightly advancing certain clock signals relative to the others. The selection of which clock signals to advance is best illustrated through the following example.\n\nConsider the first-order switched-capacitor filter depicted in Fig. 14.29, which utilizes switch sharing. Here, $\\phi_{1 \\mathrm{a}}$ and $\\phi_{2 \\mathrm{a}}$ are purposely advanced compared to the other clock signals for specific reasons. Firstly, since $\\phi_{2 \\mathrm{a}}$ is consistently connected to ground and $\\phi_{1 \\mathrm{a}}$ to virtual ground, these switches only need to pass signals near the ground node (rather than rail-to-rail signals typical at opamp outputs). Consequently, these switches can be implemented using single n-channel transistors instead of full CMOS transmission gates. ${ }^{5} \\mathrm{~A}$ more critical reason for this clock arrangement is that the charge injections from $Q_{3}$ and $Q_{4}$ are not dependent on the signal, whereas those from $Q_{1}$ and $Q_{6}$ are. Specifically, as discussed in Chapter 10, the channel charge of an NMOS transistor in triode mode is given by\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\nThis indicates that the charge is influenced by both the gate-source voltage and the threshold voltage. When $Q_{3}$ and $Q_{4}$ are active, $V_{G S}=V_{D D}$, and since their source remains at zero volts, their threshold voltages remain constant. Thus, the charge injected by $Q_{3}$ and $Q_{4}$ remains consistent across clock cycles, effectively acting as a dc offset. Unfortunately, the same cannot be said for $Q_{1}$ and $Q_{6}$. For instance, when $Q_{1}$ is active, its channel charge, as per (14.86), is\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\nHere, a portion of the channel charge is linearly related to $V_{i}$. However, its source voltage stabilizes at $V_{i}$, causing the transistor's threshold voltage to vary non-linearly (due to the bulk effect, assuming a fixed substrate voltage). Consequently, $Q_{C H 1}$ exhibits both linear and nonlinear dependencies on $V_{i}$, potentially causing gain errors and distortion if $Q_{1}$ were deactivated early. Additionally, while $Q_{2}$ and $Q_{5}$ would inject a consistent charge from one cycle to the next, it is preferable to avoid any unnecessary charge injection, so these switches are also not advanced.\n\nIn summary, to mitigate charge-injection effects in switched-capacitor circuits, design all switches connected to ground or virtual ground as n-channel switches and deactivate the switches near the virtual ground node of the opamps first. This approach minimizes distortion and gain errors while keeping dc offset low.\n\n#### EXAMPLE 14.6\n\nGiven an ideal opamp, estimate the dc offset at the output of the circuit in Fig. 14.29 due to channel-charge injection (ignoring overlap capacitance) when $C_{1}=0$ and $C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$. Assume $Q_{3}$ and $Q_{4}$ are n-channel devices with a threshold voltage of $V_{\\mathrm{tn}}=0.45 \\mathrm{~V}$, width of $W=5 \\mu \\mathrm{~m}$, length of $L=0.2 \\mu \\mathrm{~m}$, and $C_{\\mathrm{ox}}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$. The power supply is 1.8 V, and the circuit's \"ground\" node is at $V_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$.\n\n#### Solution\n\nThe dc feedback around the opamp maintains the negative input at $V_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$. From (14.86), the channel charge of $Q_{3}$ and $Q_{4}$ (when active) is calculated as\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\nAll dc feedback current is transferred through the switched capacitor $C_{3}$. Thus, the charge transferred through this capacitor equals the charge injected by $Q_{3}$ and $Q_{4}$ (assuming the input is at zero volts). The charge transfer to $C_{3}$ is\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\nAssuming half the channel charges of $Q_{3}$ and $Q_{4}$ are injected into the virtual ground node, we reason as follows: When $\\phi_{1 \\mathrm{a}}$ deactivates, half of $Q_{4}$'s channel charge goes to virtual ground, while the other half is placed at the node between $Q_{3}$ and $Q_{4}$. When $\\phi_{2 \\mathrm{a}}$ activates, the second charge is grounded, but when $\\phi_{2 \\mathrm{a}}$ deactivates, half of its channel charge remains between $Q_{3}$ and $Q_{4}$ and is transferred to virtual ground when $\\phi_{1 \\mathrm{a}}$ reactivates. This leads to the charge equation\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\nUsing this to find $Q_{C_{3}}$, and hence the output voltage from (14.89),\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\nThus, the output dc offset is influenced by the capacitor sizes (particularly $C_{3}$), switch sizes, and power-supply voltage. Note that if the opamp's dc input offset voltage were considered, it would be multiplied by the circuit's dc gain, similar to an active-RC circuit.\n\nCharge-injection is particularly problematic at higher frequencies. At these frequencies, the time constant of the switch-on resistance and the capacitor must be smaller, necessitating larger switches for a given capacitor size and thus increasing charge-injection. A simple formula can approximate the upper frequency limit for an SC circuit, considering a specified maximum voltage change due to charge injection. This formula accounts for switch channel charge but ignores overlap capacitance.\n\nKey Point: Charge injection is most severe at high switching speeds, where low switch on resistances require wide transistors and small capacitors.\n\nMost SC circuits have two series switches per capacitor. Assuming the sampling clock half-period must exceed five time constants for adequate settling, we get\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\nwhere T is the sampling period, $\\mathrm{R}_{\\mathrm{on}}$ is the on resistance of the n-channel switch, and C is the capacitor. This can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\nwhere $\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$ is the clock frequency. From Chapter 1 (1.108), we have\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\nUsing (14.87), the voltage change due to channel charge when an n-channel switch is deactivated is approximated by\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\nFor a specified $|\\Delta \\mathrm{V}|_{\\max }$, (14.95) implies\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\nSubstituting (14.94) and (14.96) into (14.93) yields\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\na straightforward expression. Thus, the upper frequency limit for charge injection in SC circuits is inversely proportional to $L^{2}$ and is approximately independent of capacitor size or power-supply voltage, assuming optimal switch sizes. As technology advances, higher switching frequencies become feasible. Note that (14.97) omits overlap capacitance, so it provides an optimistic upper bound on the maximum clocking frequency.\n\nKey Point: Technological scaling allows smaller transistors to offer the same on resistance, thereby reducing charge injection or, for the same charge injection, enabling higher switching frequencies.\n\n#### EXAMPLE 14.7\n\nFor a maximum voltage change of 1 mV due to clock feedthrough, what are the maximum clocking frequencies considering only channel charge injection for technologies with minimum channel lengths of $0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$, and $0.18 \\mu \\mathrm{~m}$ from Table 1.5?\n\n#### Solution\n\nUsing (14.97) and carrier mobilities from Table 1.5, the maximum clocking frequencies are found to be less than $14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$, and 196 MHz for the respective technologies. This demonstrates a significant speed increase for SC circuits with advancing technology."
},
{
    "text": "As discussed in Chapter 10, comparators employing switches are prone to charge-injection errors. Fortunately, by deactivating certain switches first, the charge-injection errors of the entire circuit are attributed solely to those initial switches. This principle also applies to switched-capacitor circuits, where charge-injection effects can be minimized by slightly advancing some clock signals relative to the others. The determination of which clock signals to advance is best illustrated through an example.\n\nConsider the first-order switched-capacitor filter depicted in Fig. 14.29, which utilizes switch sharing. Here, $\\phi_{1 \\mathrm{a}}$ and $\\phi_{2 \\mathrm{a}}$ are intentionally advanced compared to the other clock signals for specific reasons. Firstly, since $\\phi_{2 \\mathrm{a}}$ is always connected to ground and $\\phi_{1 \\mathrm{a}}$ to virtual ground, these switches only need to pass signals near the ground node (rather than rail-to-rail signals typical at opamp outputs). Consequently, these switches can be implemented using single n-channel transistors instead of full CMOS transmission gates. ${ }^{5} \\mathrm{~A}$ more crucial reason for this clock arrangement is that the charge injections from $Q_{3}$ and $Q_{4}$ are not signal-dependent, whereas those from $Q_{1}$ and $Q_{6}$ are. Specifically, as detailed in Chapter 10, the channel charge of an NMOS transistor in triode is given by\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\nHere, it is evident that the charge is influenced by both the gate-source voltage and the threshold voltage. When $Q_{3}$ and $Q_{4}$ are active, $V_{G S}=V_{D D}$, and since their source remains at zero volts, their threshold voltages remain constant. Therefore, the charge injected by $Q_{3}$ and $Q_{4}$ remains consistent across clock cycles and can be treated as a dc offset. Unfortunately, the same cannot be said for $Q_{1}$ and $Q_{6}$. For instance, when $Q_{1}$ is on, its channel charge, as per (14.86), is\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\nThus, a portion of the channel charge is linearly related to $V_{i}$. However, its source voltage stabilizes at $V_{i}$, causing the transistor's threshold voltage to change nonlinearly (due to the bulk effect, assuming a fixed substrate voltage). Consequently, $Q_{C H 1}$ exhibits both linear and nonlinear relationships to $V_{i}$, potentially causing gain errors and distortion if $Q_{1}$ were turned off prematurely. Finally, while $Q_{2}$ and $Q_{5}$ would also inject constant charge from one cycle to the next, it is preferable to avoid any unnecessary charge injection, so these switches are not advanced.\n\nIn summary, to mitigate charge-injection effects in switched-capacitor circuits, all switches connected to ground or virtual ground should be implemented as n-channel switches, and the switches near the virtual ground node of the opamps should be turned off first. This approach minimizes distortion and gain errors while keeping dc offset low.\n\n#### EXAMPLE 14.6\n\nGiven an ideal opamp, estimate the dc offset in the output of the circuit in Fig. 14.29 due to channel-charge injection (ignoring overlap capacitance) when $C_{1}=0$ and $C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$. Assume $Q_{3}$ and $Q_{4}$ are n-channel devices with a threshold voltage of $V_{t n}=0.45 \\mathrm{~V}$, width of $W=5 \\mu \\mathrm{~m}$, length of $L=0.2 \\mu \\mathrm{~m}$, and $C_{o x}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$. The power supply is 1.8 V, and the circuit's \"ground\" node is at $V_{D D} / 2=0.9 \\mathrm{~V}$.\n\n#### Solution\n\nThe dc feedback around the opamp maintains the negative input at $V_{D D} / 2=0.9 \\mathrm{~V}$. From (14.86), the channel charge of $Q_{3}$ and $Q_{4}$ (when on) is calculated as\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\nAll dc feedback current is transferred through the switched capacitor $C_{3}$. Thus, the charge transferred through this capacitor equals the charge injected by $Q_{3}$ and $Q_{4}$ (assuming the input is at zero volts). The charge transfer into $C_{3}$ is\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\nAssuming half the channel charges of $Q_{3}$ and $Q_{4}$ are injected into the virtual ground node, we reason as follows: When $\\phi_{1 a}$ turns off, half of $Q_{4}$'s charge goes to the virtual ground, and the other half to the node between $Q_{3}$ and $Q_{4}$. When $\\phi_{2 a}$ goes high, the second charge escapes to ground, but when $\\phi_{2 a}$ goes low, half of its charge remains between $Q_{3}$ and $Q_{4}$ and is transferred to the virtual ground when $\\phi_{1 a}$ goes high again. This leads to the charge equation\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\nUsing this to find $Q_{C_{3}}$, the output voltage from (14.89) is\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\nThus, the output dc offset is influenced by the capacitor sizes (particularly $C_{3}$), switch sizes, and power-supply voltage. If the opamp's dc input offset voltage were included, it would be multiplied by the circuit's dc gain, similar to an active-RC circuit.\n\nCharge injection is particularly problematic at higher frequencies. At these frequencies, the time constant of the switch-on resistance and the capacitor must be smaller, necessitating larger switches for a given capacitor size and thus greater charge injection. A simple formula can approximate the upper frequency limit for an SC circuit, considering only switch channel charge and ignoring overlap capacitance.\n\nKey Point: Charge injection is most severe at high switching speeds, where low switch on resistances require wide transistors and small capacitors.\n\nMost SC circuits have two series switches per capacitor. Assuming the sampling clock half-period must exceed five time constants for good settling, we have\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\nwhere T is the sampling period, $\\mathrm{R}_{\\mathrm{on}}$ is the on resistance of the n-channel switch, and C is the capacitor. This can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\nwhere $\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$ is the clock frequency. From Chapter 1 (1.108), we have\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\nUsing (14.87), the charge change due to channel charge alone when an n-channel switch is turned off is\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\nFor a specified $|\\Delta \\mathrm{V}|_{\\max }$, (14.95) implies\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\nSubstituting (14.94) and (14.96) into (14.93) yields\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\na simple expression. Thus, the upper frequency limit due to charge injection in SC circuits is inversely proportional to $L^{2}$ and largely independent of capacitor size or power-supply voltage, assuming optimal switch sizes. As technology advances, higher switching frequencies become feasible. Note that (14.97) ignores overlap capacitance, making it an optimistic upper bound on the maximum clocking frequency.\n\nKey Point: Technological scaling allows smaller transistors to provide the same on resistance, reducing charge injection or, for the same injection, enabling higher switching frequencies.\n\n#### EXAMPLE 14.7\n\nFor a maximum voltage change of 1 mV due to clock feedthrough, what are the maximum clocking frequencies considering only channel charge injection for technologies with minimum channel lengths of $0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$, and $0.18 \\mu \\mathrm{~m}$ from Table 1.5?\n\n#### Solution\n\nUsing (14.97) and carrier mobilities from Table 1.5, the maximum clocking frequencies are found to be less than $14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$, and 196 MHz for the respective technologies. This demonstrates a significant speed increase for SC circuits with improving technology."
},
{
    "text": "As detailed in Chapter 10, comparators utilizing switches are prone to charge-injection errors.幸运的是，通过首先关闭某些开关，整个电路的充电注入错误仅由这些早期开关引起。同样的结果也适用于开关电容电路，因此通过使一些时钟信号相对于其余信号略微提前，可以最小化电荷注入效应。哪些时钟信号应该提前，通过以下示例可以最容易地解释。\n\n考虑图14.29中显示的一阶开关电容滤波器，其中使用了开关共享。在这里，$\\phi_{1 \\mathrm{a}}$和$\\phi_{2 a}$相对于其余时钟信号略微提前，原因如下。首先，由于$\\phi_{2 \\mathrm{a}}$始终连接到地，而$\\phi_{1 \\mathrm{a}}$始终连接到虚拟地，因此当这些开关接通时，它们只需要传递接近地节点的信号（而不是运算放大器输出处可能出现的全 rail-to-rail 信号）。因此，这两个开关可以使用单个n通道晶体管实现，而不是完整的CMOS传输门。${ }^{5} \\mathrm{~A}$第二个更重要的使用这种时钟安排的原因是，由于$Q_{3}$、$Q_{4}$的电荷注入不依赖于信号，而$Q_{1}$、$Q_{6}$的电荷注入依赖于信号。具体来说，我们在第10章中看到，NMOS晶体管在 triode 状态下的沟道电荷由下式给出：\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\n在这里，我们看到电荷与栅源电压以及阈值电压有关。当$\\mathrm{Q}_{3}$和$\\mathrm{Q}_{4}$接通时，$\\mathrm{V}_{\\mathrm{GS}}=\\mathrm{V}_{\\mathrm{DD}}$，由于它们的源极保持在零伏，它们的阈值电压也保持不变。因此，$\\mathrm{Q}_{3}$、$\\mathrm{Q}_{4}$注入的电荷量在每个时钟周期中都是相同的，可以被视为直流偏移。不幸的是，$\\mathbf{Q}_{1}$和$\\mathbf{Q}_{6}$的情况并非如此。例如，当$\\mathbf{Q}_{1}$接通时，其沟道电荷根据（14.86）计算为\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\n因此，沟道电荷的一部分与$\\mathrm{V}_{\\mathrm{i}}$线性相关。然而，其源电压稳定到$\\mathrm{V}_{\\mathrm{i}}$，因此晶体管的阈值电压以非线性关系变化（由于体效应，假设其衬底\n\nimage_name:Fig. 14.29\ndescription:这是一个一阶开关电容电路，具有减少电荷注入效应的时钟安排。开关Q3和Q4略微提前关闭，以最小化由于电荷注入引起的失真。电路使用电容C1、C2、C3和CA，以及运算放大器A1来处理输入信号Vi(z)并产生输出信号Vo(z)。\n\n图14.29 具有时钟安排的一阶开关电容电路，以减少电荷注入效应。$\\phi_{1 a}$和$\\phi_{2 a}$略微提前关闭$Q_{3}$和$Q_{4}$。\n\n关键点：为了最小化由于电荷注入引起的失真，连接到dc节点的开关（如地）应先于其他开关关闭。尽管仍然存在一些电荷注入，但它是信号独立的。\n设置为一个固定电压）。因此，$\\mathrm{Q}_{\\mathrm{CH} 1}$与$V_{i}$具有线性和非线性关系，如果$Q_{1}$提前关闭，会引起增益误差和失真。最后，虽然$Q_{2}$和$Q_{5}$也会在每个周期注入恒定电荷，但最好不要向电路中添加任何不必要的电荷，因此这些开关也不提前。\n\n总结来说，为了减少开关电容电路中的电荷注入效应，将所有连接到地或虚拟地的开关实现为仅n通道开关，并首先关闭运算放大器虚拟地节点附近的开关。这种方法将最小化失真和增益误差，同时保持直流偏移较低。\n\n#### 示例 14.6\n\n假设一个理想运算放大器，估计图14.29所示电路输出中的直流偏移量（忽略重叠电容电荷注入），当$C_{1}=0$且$C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$时。假设开关$Q_{3}$、$Q_{4}$为n通道器件，阈值电压为$\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$，宽度为$\\mathrm{W}=5 \\mu \\mathrm{~m}$，长度为$\\mathrm{L}=0.2 \\mu \\mathrm{~m}$，$\\mathrm{C}_{\\mathrm{ox}}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$。使用1.8 V的电源，电路的“地”节点位于$\\mathrm{V}_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$。\n\n#### 解答\n\n运算放大器周围的直流反馈将保持运算放大器的负输入端在$\\mathrm{V}_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$。根据（14.86），我们可以计算$\\mathrm{Q}_{3}$、$\\mathrm{Q}_{4}$（接通时）的沟道电荷量为\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\n所有直流反馈电流都是通过开关电容$C_{3}$传输的电荷。因此，通过该电容器的电荷必须等于$Q_{3}$、$Q_{4}$注入的电荷（假设输入为零伏，因此不贡献电荷）。$C_{3}$的电荷传输为\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\n现在，我们估计$Q_{3}$和$Q_{4}$的一半沟道电荷注入到虚拟地节点，理由如下。当$\\phi_{1 a}$关闭时，$Q_{4}$的一半沟道电荷进入虚拟地，而其另一半电荷放置在$Q_{3}$和$Q_{4}$之间的节点。当$\\phi_{2 a}$变高时，第二部分电荷逃逸到地，但当$\\phi_{2 a}$变低时，其一半沟道电荷留在$Q_{3}$和$Q_{4}$之间，并在$\\phi_{1 a}$再次变高时传递到虚拟地。因此，我们可以写出以下电荷方程，\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\n该方程可用于找到$Q_{\\mathrm{C}_{3}}$，从而根据（14.89）得出输出电压\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\n因此，我们看到这个输出直流偏移值受电容器大小（特别是$\\mathrm{C}_{3}$）以及开关尺寸和电源电压的影响。这里应该提到的是，如果将运算放大器的直流输入偏移电压包含在分析中，它将乘以电路的直流增益，类似于在主动-RC电路中发生的情况。\n\n电荷注入在较高频率下尤为麻烦。在较高频率下，开关导通电阻和被充电或放电电容的时间常数必须更小；这需要为给定尺寸的电容器使用更大的开关，从而增加电荷注入。可以推导出一个非常简单的公式，给出由于电荷注入引起的指定最大电压变化下的SC电路操作频率的近似上限。这个上限考虑了开关沟道电荷，忽略了由于重叠电容引起的电荷注入。\n\n关键点：电荷注入在高切换速度下最为问题，低开关导通电阻需要宽晶体管和小电容器。\n\n大多数SC电路每个电容器将有两个串联开关。如果假设为了良好稳定，采样时钟半周期必须大于五个时间常数，那么我们有\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\n其中T为采样周期，$\\mathrm{R}_{\\mathrm{on}}$为n通道开关的导通电阻，C为电容器。（14.92）可以重写为\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\n其中$\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$为时钟频率。回顾第1章的（1.108），我们有\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\n此外，使用（14.87），由于n通道开关断开引起的仅由沟道电荷引起的电荷变化近似为\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\n对于指定的$|\\Delta \\mathrm{V}|_{\\max }$，（14.95）意味着\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\n将（14.94）和（14.96）代入（14.93）得到\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\n一个非常简单的表达式。因此，SC电路电荷注入的上限频率与$L^{2}$成反比，并且大致独立于电容器尺寸或电源电压，假设开关尺寸选择最优；随着技术的改进，可以实现更高的切换频率。最后，（14.97）忽略了重叠电容，因此有些乐观，应被视为最大时钟频率的上限。\n\n关键点：技术缩放允许更小的晶体管提供相同的导通电阻，从而减少电荷注入，或者在相同的电荷注入下，实现更高的切换频率。\n\n#### 示例 14.7\n\n假设由于时钟馈通引起的最大电压变化为1 mV，考虑仅沟道电荷注入，对于表1.5中具有最小沟道长度为$0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$和$0.18 \\mu \\mathrm{~m}$的技术，最大时钟频率是多少？\n\n#### 解答\n\n使用（14.97）和从表1.5获得的载流子迁移率，得到$\\mathrm{f}_{\\mathrm{cl} \\text { }}$，对于三种不同技术必须分别小于$14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$和196 MHz。注意到随着技术改进，SC电路的速度显著提高。"
},
{
    "text": "As discussed in Chapter 10, comparators utilizing switches are prone to charge-injection errors.幸运的是，通过首先关闭某些开关，整个电路的充电注入错误仅由这些早期开关引起。同样的结果也适用于开关电容器电路，因此通过使某些时钟信号相对于其余信号略微提前，可以最小化充电注入效应。哪些时钟信号应该提前，通过以下示例可以最容易地解释。\n\n考虑图14.29中显示的一阶开关电容器滤波器，其中使用了开关共享。在这里，$\\phi_{1 \\mathrm{a}}$和$\\phi_{2 a}$相对于其余时钟信号略微提前，原因如下。首先，由于$\\phi_{2 \\mathrm{a}}$始终连接到地，而$\\phi_{1 \\mathrm{a}}$始终连接到虚拟地，因此当这些开关打开时，它们只需传递接近地节点的信号（而不是像运放输出那样可能出现的轨到轨信号）。因此，这两个开关可以使用单个n通道晶体管来实现，而不是完整的CMOS传输门。${ }^{5} \\mathrm{~A}$第二个、更重要的使用这种时钟安排的原因是，由于$Q_{3}, Q_{4}$引起的电荷注入不依赖于信号，而$Q_{1}, Q_{6}$的电荷注入则依赖于信号。具体来说，我们在第10章中看到，NMOS晶体管在 triode 状态下的通道电荷由下式给出：\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\n在这里，我们看到电荷与栅源电压以及阈值电压有关。当$\\mathrm{Q}_{3}$和$\\mathrm{Q}_{4}$导通时，$\\mathrm{V}_{\\mathrm{GS}}=\\mathrm{V}_{\\mathrm{DD}}$，由于它们的源极保持在零伏，它们的阈值电压也保持不变。因此，$\\mathrm{Q}_{3}, \\mathrm{Q}_{4}$注入的电荷量在每个时钟周期中都是相同的，可以被视为直流偏移。不幸的是，$\\mathbf{Q}_{1}$和$\\mathbf{Q}_{6}$却不能这样说。例如，当$\\mathbf{Q}_{1}$导通时，其通道电荷由（14.86）得出为\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\n因此，通道电荷的一部分与$\\mathrm{V}_{\\mathrm{i}}$线性相关。然而，其源电压稳定在$\\mathrm{V}_{\\mathrm{i}}$，因此晶体管的阈值电压以非线性关系变化（由于体效应，假设其衬底\nimage_name:Fig. 14.29\ndescription:这是一个一阶开关电容器电路，具有减少电荷注入效应的时钟安排。开关Q3和Q4略微提前关闭，以最小化由于电荷注入引起的失真。该电路使用电容器C1、C2、C3和CA以及运算放大器A1来处理输入信号Vi(z)并产生输出信号Vo(z)。\n\n图14.29 一阶开关电容器电路，具有减少电荷注入效应的时钟安排。$\\phi_{1 a}$和$\\phi_{2 a}$提前关闭$Q_{3}$和$Q_{4}$。\n\n关键点：为了最小化由于电荷注入引起的失真，连接到直流节点的开关（如地）应提前关闭。尽管仍然存在一些电荷注入，但它是信号独立的。\n设置为固定电压）。因此，$\\mathrm{Q}_{\\mathrm{CH} 1}$与$V_{i}$具有线性和非线性关系，如果$Q_{1}$提前关闭，将导致增益误差和失真。最后，尽管$Q_{2}$和$Q_{5}$也会在每个周期中注入恒定电荷，但最好不要向电路中添加任何不必要的电荷，因此这些开关也不提前。\n\n总之，为了减少开关电容器电路中的电荷注入效应，将所有连接到地或虚拟地的开关实现为仅n通道开关，并首先关闭靠近运放虚拟地节点的开关。这种方法将最小化失真和增益误差，同时保持直流偏移较低。\n\n#### 示例 14.6\n\n假设运放理想，估算图14.29所示电路输出中的直流偏移量，由于通道电荷注入（忽略重叠电容电荷注入），当$C_{1}=0$且$C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$时。假设开关$Q_{3}, Q_{4}$为n通道器件，阈值电压为$\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$，宽度为$\\mathrm{W}=5 \\mu \\mathrm{~m}$，长度为$\\mathrm{L}=0.2 \\mu \\mathrm{~m}$，$\\mathrm{C}_{\\mathrm{ox}}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$。使用1.8 V的电源，电路的“地”节点位于$\\mathrm{V}_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$。\n\n#### 解答\n\n运放周围的直流反馈将保持运放的负输入端在$\\mathrm{V}_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$。从（14.86）中，我们可以计算出$\\mathrm{Q}_{3}, \\mathrm{Q}_{4}$（导通时）的通道电荷量为\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\n所有直流反馈电流都是通过开关电容器$C_{3}$传输的电荷。因此，通过该电容器的电荷必须等于$Q_{3}, Q_{4}$注入的电荷（假设输入为零伏，因此不贡献电荷）。$C_{3}$中的电荷传输由下式给出\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\n现在，我们估算$Q_{3}$和$Q_{4}$的通道电荷的一半注入到虚拟地节点，理由如下。当$\\phi_{1 a}$关闭时，$Q_{4}$的通道电荷的一半进入虚拟地，而其电荷的一半放置在$Q_{3}$和$Q_{4}$之间的节点。当$\\phi_{2 a}$变高时，第二电荷逃逸到地，但当$\\phi_{2 a}$变低时，其通道电荷的一半留在$Q_{3}$和$Q_{4}$之间，并在$\\phi_{1 a}$再次变高时传递到虚拟地。因此，我们可以写出以下电荷方程，\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\n该方程可用于找到$Q_{\\mathrm{C}_{3}}$，从而根据（14.89）得出输出电压\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\n因此，我们看到这个输出直流偏移值受电容器大小（特别是$\\mathrm{C}_{3}$）以及开关尺寸和电源电压的影响。应当在此提及，如果运放的直流输入偏移电压包含在分析中，它将乘以电路的直流增益，类似于在有源-RC电路中发生的情况。\n\n电荷注入在较高频率下尤其麻烦。在较高频率下，开关导通电阻和被充电或放电电容的时间常数必须更小；这需要对于给定大小的电容器使用更大的开关，从而产生更大的电荷注入。可以推导出一个非常简单的公式，给出由于电荷注入导致的SC电路最大电压变化的近似上限频率。这个上限考虑了开关通道电荷，忽略了由于重叠电容引起的电荷注入。\n\n关键点：电荷注入在高速切换时最为问题，其中低开关导通电阻需要宽晶体管和小电容器。\n\n大多数SC电路每个电容器将有两个串联开关。如果假设为了良好稳定，采样时钟半周期必须大于五个时间常数，则我们有\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\n其中T为采样周期，$\\mathrm{R}_{\\mathrm{on}}$为n通道开关的导通电阻，C为电容器。（14.92）可以重写为\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\n其中$\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$为时钟频率。回顾第1章的（1.108），我们有\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\n此外，使用（14.87），由于关闭n通道开关引起的仅通道电荷导致的电荷变化近似为\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\n对于指定的$|\\Delta \\mathrm{V}|_{\\max }$，（14.95）意味着\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\n将（14.94）和（14.96）代入（14.93）得到\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\n一个非常简单的表达式。因此，SC电路电荷注入的上限频率与$L^{2}$成反比，并且大致独立于电容器大小或电源电压，假设开关尺寸选择最优；随着技术的进步，可以实现更高的切换频率。最后，（14.97）忽略了重叠电容，因此有些乐观，应视为最大时钟频率的上限。\n\n关键点：技术缩放允许更小的晶体管提供相同的导通电阻，从而减少电荷注入，或者在相同的电荷注入下，实现更高的切换频率。\n\n#### 示例 14.7\n\n假设由于时钟馈通引起的最大电压变化为1 mV，考虑仅通道电荷注入， technologies having minimum channel lengths of $0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$, and $0.18 \\mu \\mathrm{~m}$ in Table 1.5的最大时钟频率是多少？\n\n#### 解答\n\n使用（14.97）和表1.5中获得的载流子迁移率给出$\\mathrm{f}_{\\mathrm{cl} \\text { }}$，对于三种不同技术，必须分别小于$14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$和196 MHz。注意随着技术进步，SC电路的速度显著提高。"
},
{
    "text": "As observed in Chapter 10, comparators utilizing switches are prone to charge-injection errors.幸运的是，通过首先关闭某些开关，整个电路的电荷注入误差仅由这些早期开关引起。这一结果同样适用于开关电容电路，因此通过使某些时钟信号相对于其余信号略微提前，可以最小化电荷注入效应。哪些时钟信号应该提前，可以通过以下示例进行最简单的解释。\n\n考虑图14.29中显示的一阶开关电容滤波器，其中使用了开关共享。在这里，$\\phi_{1 \\mathrm{a}}$和$\\phi_{2 a}$相对于其余时钟信号略微提前，原因如下。首先，由于$\\phi_{2 \\mathrm{a}}$始终连接到地，而$\\phi_{1 \\mathrm{a}}$始终连接到虚拟地，当这些开关打开时，它们只需传递接近地节点的信号（而不是像运放输出那样可能出现的轨到轨信号）。因此，这两个开关可以使用单个n沟道晶体管实现，而不是完整的CMOS传输门。第二个更重要的使用这种时钟安排的原因是，由于$Q_{3}, Q_{4}$的电荷注入不依赖于信号，而$Q_{1}, Q_{6}$的电荷注入则依赖于信号。具体来说，我们在第10章中看到，NMOS晶体管在triode区的沟道电荷由下式给出：\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\n在这里，我们看到电荷与栅源电压以及阈值电压有关。当$\\mathrm{Q}_{3}$和$\\mathrm{Q}_{4}$导通时，$\\mathrm{V}_{\\mathrm{GS}}=\\mathrm{V}_{\\mathrm{DD}}$，由于它们的源极保持在零伏，它们的阈值电压也保持不变。因此，$\\mathrm{Q}_{3}, \\mathrm{Q}_{4}$注入的电荷量在每个时钟周期中都是相同的，可以被视为直流偏移。不幸的是，$\\mathbf{Q}_{1}$和$\\mathbf{Q}_{6}$却不能这样说。例如，当$\\mathbf{Q}_{1}$导通时，其沟道电荷由（14.86）式得出：\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\n因此，沟道电荷的一部分与$\\mathrm{V}_{\\mathrm{i}}$线性相关。然而，其源电压稳定到$\\mathrm{V}_{\\mathrm{i}}$，因此晶体管的阈值电压以非线性关系变化（由于体效应，假设其衬底固定电压）。结果，$\\mathrm{Q}_{\\mathrm{CH} 1}$与$V_{i}$具有线性和非线性关系，因此如果$Q_{1}$提前关闭，会导致增益误差和失真。最后，虽然$Q_{2}$和$Q_{5}$在每个周期中也会注入恒定电荷，但最好不要向电路中添加任何不必要的电荷，因此这些开关也不提前。\n\n总之，为了减少开关电容电路中的电荷注入效应，将所有连接到地或虚拟地的开关实现为仅n沟道开关，并首先关闭运放虚拟地节点附近的开关。这种方法将最小化失真和增益误差，同时保持直流偏移较低。\n\n#### 示例 14.6\n\n假设一个理想运放，估计图14.29所示电路输出中的直流偏移量（忽略重叠电容电荷注入），当$C_{1}=0$且$C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$时。假设开关$Q_{3}, Q_{4}$为n沟道器件，阈值电压$\\mathrm{V}_{\\mathrm{tn}}=0.45 \\mathrm{~V}$，宽度$\\mathrm{W}=5 \\mu \\mathrm{~m}$，长度$\\mathrm{L}=0.2 \\mu \\mathrm{~m}$，$\\mathrm{C}_{\\mathrm{ox}}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$。使用1.8 V的电源，电路的“地”节点位于$\\mathrm{V}_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$。\n\n#### 解答\n\n运放周围的直流反馈将保持运放的负输入端在$\\mathrm{V}_{\\mathrm{DD}} / 2=0.9 \\mathrm{~V}$。根据（14.86），我们可以计算出$\\mathrm{Q}_{3}, \\mathrm{Q}_{4}$（导通时）的沟道电荷量为\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\n所有直流反馈电流都是通过开关电容$C_{3}$传输的电荷。因此，通过这个电容器的电荷必须等于$Q_{3}, Q_{4}$注入的电荷（假设输入为零伏，因此不贡献电荷）。$C_{3}$的电荷传输由下式给出：\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\n现在，我们估计$Q_{3}$和$Q_{4}$的一半沟道电荷注入到虚拟地节点，理由如下。当$\\phi_{1 a}$关闭时，$Q_{4}$的一半沟道电荷进入虚拟地，而其一半电荷位于$Q_{3}$和$Q_{4}$之间的节点。当$\\phi_{2 a}$变高时，第二个电荷逃逸到地，但当$\\phi_{2 a}$变低时，其一半沟道电荷留在$Q_{3}$和$Q_{4}$之间，并在$\\phi_{1 a}$再次变高时传递到虚拟地。因此，我们可以写出以下电荷方程：\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\n该方程可用于求解$Q_{\\mathrm{C}_{3}}$，从而通过（14.89）得出输出电压：\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\n因此，我们看到这个输出直流偏移值受电容器大小（特别是$\\mathrm{C}_{3}$）、开关尺寸和电源电压的影响。需要注意的是，如果运放的直流输入偏移电压包含在分析中，它将乘以电路的直流增益，类似于在有源-RC电路中发生的情况。\n\n电荷注入在较高频率下尤其麻烦。在较高频率下，开关导通电阻和被充电或放电电容的时间常数必须更小；这需要对于给定大小的电容器使用更大的开关，从而产生更大的电荷注入。可以推导出一个非常简单的公式，给出SC电路在指定最大电压变化下的近似上限工作频率，该上限仅考虑开关沟道电荷，忽略由于重叠电容引起的电荷注入。\n\n关键点：电荷注入在高切换速度下最为问题，低开关导通电阻需要宽晶体管和小电容器。\n\n大多数SC电路每个电容器将有两个串联开关。如果假设为了良好稳定，采样时钟半周期必须大于五个时间常数，那么我们有：\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\n其中T为采样周期，$\\mathrm{R}_{\\mathrm{on}}$为n沟道开关的导通电阻，C为电容器。（14.92）式可以重写为：\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\n其中$\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$为时钟频率。回顾第1章的（1.108），我们有：\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\n此外，使用（14.87），由于关闭n沟道开关引起的仅由沟道电荷产生的电荷变化近似为：\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\n对于指定的$|\\Delta \\mathrm{V}|_{\\max }$，（14.95）意味着：\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\n将（14.94）和（14.96）代入（14.93）得到：\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\n一个非常简单的表达式。因此，SC电路电荷注入的上限频率与$L^{2}$成反比，并且近似独立于电容器大小或电源电压，假设开关尺寸选择最优；随着技术的进步，可以实现更高的切换频率。最后，（14.97）忽略了重叠电容，因此它有些乐观，应被视为最大时钟频率的上限。\n\n关键点：技术缩放允许更小的晶体管提供相同的导通电阻，从而减少电荷注入，或者在相同的电荷注入下，实现更高的切换频率。\n\n#### 示例 14.7\n\n假设由于时钟馈通引起的最大电压变化为1 mV，考虑仅沟道电荷注入，表1.5中所示技术的最小沟道长度为$0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$和$0.18 \\mu \\mathrm{~m}$时的最大时钟频率是多少？\n\n#### 解答\n\n使用（14.97）和表1.5中获得的载流子迁移率，得到$\\mathrm{f}_{\\mathrm{cl} \\text { }}$，必须分别小于$14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$和196 MHz，对于三种不同的技术。注意随着技术进步，SC电路的速度显著提高。"
},
{
    "text": "As detailed in Chapter 10, comparators utilizing switches are prone to charge-injection errors. However, by deactivating specific switches initially, the charge-injection errors of the entire circuit are attributed solely to those early-deactivated switches. This principle also applies to switched-capacitor circuits, where advancing certain clock signals relative to others can mitigate charge-injection effects. The selection of which clock signals to advance is best illustrated through an example.\n\nConsider the first-order switched-capacitor filter depicted in Fig. 14.29, which employs switch sharing. Here, $\\phi_{1 \\mathrm{a}}$ and $\\phi_{2 \\mathrm{a}}$ are slightly ahead of the other clock signals for specific reasons. Firstly, since $\\phi_{2 \\mathrm{a}}$ is always connected to ground and $\\phi_{1 \\mathrm{a}}$ to virtual ground, these switches only need to pass signals near the ground node, avoiding rail-to-rail signals typical at opamp outputs. Consequently, these switches can be implemented using single n-channel transistors instead of full CMOS transmission gates. ${ }^{5} \\mathrm{~A}$ more critical reason for this clock arrangement is that the charge injections from $Q_{3}$ and $Q_{4}$ are not signal-dependent, unlike those from $Q_{1}$ and $Q_{6}$. Specifically, as discussed in Chapter 10, the channel charge of an NMOS transistor in triode is given by\n\n$$\n\\begin{equation*}\nQ_{C H}=-W L C_{o x} V_{\\text {eff }}=-W L C_{o x}\\left(V_{G S}-V_{t}\\right) \\tag{14.86}\n\\end{equation*}\n$$\n\nThis indicates that the charge depends on the gate-source voltage and the threshold voltage. When $Q_{3}$ and $Q_{4}$ are active, $V_{G S}=V_{D D}$, and since their source remains at zero volts, their threshold voltages remain constant. Thus, the charge injected by $Q_{3}$ and $Q_{4}$ remains consistent across clock cycles, effectively acting as a dc offset. Unfortunately, this consistency does not apply to $Q_{1}$ and $Q_{6}$. For instance, when $Q_{1}$ is active, its channel charge, derived from (14.86), is\n\n$$\n\\begin{equation*}\nQ_{C H 1}=-W_{1} L_{1} C_{o x}\\left(V_{D D}-V_{i}-V_{t n}\\right) \\tag{14.87}\n\\end{equation*}\n$$\n\nHere, part of the channel charge is linearly related to $V_{i}$. However, its source voltage stabilizes at $V_{i}$, causing the transistor's threshold voltage to change nonlinearly (due to the bulk effect, assuming a fixed substrate voltage). Consequently, $Q_{C H 1}$ exhibits both linear and nonlinear relationships to $V_{i}$, potentially causing gain errors and distortion if $Q_{1}$ were deactivated early. Additionally, while $Q_{2}$ and $Q_{5}$ would inject consistent charge from cycle to cycle, it is preferable to avoid any unnecessary charge injection, so these switches are also not advanced.\n\nIn summary, to minimize charge-injection effects in switched-capacitor circuits, design all switches connected to ground or virtual ground as n-channel switches and deactivate the switches near the virtual ground node of the opamps first. This approach reduces distortion, gain error, and dc offset.\n\n#### EXAMPLE 14.6\n\nGiven an ideal opamp, estimate the dc offset in the output of the circuit in Fig. 14.29 due to channel-charge injection (ignoring overlap capacitance) when $C_{1}=0$ and $C_{2}=C_{A}=10 C_{3}=4 \\mathrm{pF}$. Assume $Q_{3}$ and $Q_{4}$ are n-channel devices with a threshold voltage of $V_{t n}=0.45 \\mathrm{~V}$, width of $W=5 \\mu \\mathrm{~m}$, length of $L=0.2 \\mu \\mathrm{~m}$, and $C_{o x}=8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}$. The power supply is 1.8 V, and the circuit's \"ground\" node is at $V_{D D} / 2=0.9 \\mathrm{~V}$.\n\n#### Solution\n\nThe dc feedback around the opamp maintains its negative input at $V_{D D} / 2=0.9 \\mathrm{~V}$. From (14.86), the channel charge of $Q_{3}$ and $Q_{4}$ (when active) is calculated as\n\n$$\n\\begin{equation*}\nQ_{\\mathrm{CH} 3}=Q_{\\mathrm{CH} 4}=-(5 \\mu \\mathrm{~m})(0.2 \\mu \\mathrm{~m})\\left(8.5 \\mathrm{fF} / \\mu \\mathrm{m}^{2}\\right)((1.8 \\mathrm{~V}-0.9 \\mathrm{~V})-0.45 \\mathrm{~V})=-3.8 \\mathrm{fC} \\tag{14.88}\n\\end{equation*}\n$$\n\nAll dc feedback current is transferred through the switched capacitor $C_{3}$. Thus, the charge transferred through $C_{3}$ equals the charge injected by $Q_{3}$ and $Q_{4}$ (assuming the input is at zero volts). The charge transfer into $C_{3}$ is\n\n$$\n\\begin{equation*}\nQ_{C_{3}}=-C_{3} v_{\\text {out }} \\tag{14.89}\n\\end{equation*}\n$$\n\nAssuming half the channel charges of $Q_{3}$ and $Q_{4}$ are injected into the virtual ground node, we derive the charge equation\n\n$$\n\\begin{equation*}\n\\frac{1}{2}\\left(Q_{\\mathrm{CH} 3}+Q_{C H 4}\\right)=Q_{C_{3}} \\tag{14.90}\n\\end{equation*}\n$$\n\nUsing this, we find $Q_{C_{3}}$ and hence the output voltage from (14.89)\n\n$$\n\\begin{equation*}\n\\mathrm{v}_{\\text {out }}=\\frac{3.8 \\mathrm{fC}}{0.4 \\mathrm{pF}}=9.5 \\mathrm{mV} \\tag{14.91}\n\\end{equation*}\n$$\n\nThis output dc offset depends on the capacitor sizes (particularly $C_{3}$), switch sizes, and power-supply voltage. Including the opamp's dc input offset voltage in the analysis would multiply it by the circuit's dc gain, similar to active-RC circuits.\n\nCharge-injection is particularly problematic at higher frequencies. At these frequencies, the time constant of the switch-on resistance and the capacitor being charged or discharged must be smaller, necessitating larger switches for a given capacitor size and thus increasing charge-injection. A simple formula can approximate the upper frequency limit for an SC circuit, considering only switch channel charge and ignoring overlap capacitance effects.\n\nKey Point: Charge injection is most severe at high switching speeds, where low switch on resistances require wide transistors and small capacitors.\n\nMost SC circuits have two series switches per capacitor. Assuming the sampling clock half-period must exceed five time constants for good settling, we get\n\n$$\n\\begin{equation*}\n\\frac{\\mathrm{T}}{2}>5 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C} \\tag{14.92}\n\\end{equation*}\n$$\n\nwhere T is the sampling period, $\\mathrm{R}_{\\mathrm{on}}$ is the on resistance of the n-channel switch, and C is the capacitor. This can be rewritten as\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{1}{10 \\mathrm{R}_{\\mathrm{on}} \\mathrm{C}} \\tag{14.93}\n\\end{equation*}\n$$\n\nwhere $\\mathrm{f}_{\\mathrm{clk}}=1 / \\mathrm{T}$ is the clock frequency. From Chapter 1 (1.108), we have\n\n$$\n\\begin{equation*}\n\\mathrm{R}_{\\mathrm{on}}=\\frac{1}{\\mu_{\\mathrm{n}} \\mathrm{C}_{\\mathrm{ox}} \\frac{\\mathrm{~W}}{\\mathrm{~L}} \\mathrm{~V}_{\\mathrm{eff}}} \\tag{14.94}\n\\end{equation*}\n$$\n\nUsing (14.87), the charge change due to channel charge only, when an n-channel switch is turned off, is approximated by\n\n$$\n\\begin{equation*}\n|\\Delta \\mathrm{V}|=\\frac{\\mathrm{Q}_{\\mathrm{CH}}}{2 \\mathrm{C}}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2 \\mathrm{C}} \\tag{14.95}\n\\end{equation*}\n$$\n\nFor a specified $|\\Delta \\mathrm{V}|_{\\max }$, (14.95) implies\n\n$$\n\\begin{equation*}\n\\mathrm{C}=\\frac{\\mathrm{WLC}_{\\mathrm{ox}} \\mathrm{~V}_{\\mathrm{eff}}}{2|\\Delta \\mathrm{~V}|_{\\max }} \\tag{14.96}\n\\end{equation*}\n$$\n\nSubstituting (14.94) and (14.96) into (14.93) yields\n\n$$\n\\begin{equation*}\n\\mathrm{f}_{\\mathrm{clk}}<\\frac{\\mu_{\\mathrm{n}}|\\Delta \\mathrm{~V}|_{\\max }}{5 \\mathrm{~L}^{2}} \\tag{14.97}\n\\end{equation*}\n$$\n\na simple expression. Thus, the upper frequency limit due to charge injection in SC circuits is inversely proportional to $L^{2}$ and is roughly independent of capacitor size or power-supply voltage, assuming optimal switch sizes. As technology advances, higher switching frequencies become feasible. However, (14.97) excludes overlap capacitance, making it an optimistic upper bound on the maximum clocking frequency.\n\nKey Point: Technological scaling allows smaller transistors to provide the same on resistance, reducing charge injection or, for the same charge injection, enabling higher switching frequencies.\n\n#### EXAMPLE 14.7\n\nFor a maximum voltage change of 1 mV due to clock feedthrough, what are the maximum clocking frequencies considering only channel charge injection for technologies with minimum channel lengths of $0.8 \\mu \\mathrm{~m}, 0.35 \\mu \\mathrm{~m}$, and $0.18 \\mu \\mathrm{~m}$ from Table 1.5?\n\n#### Solution\n\nUsing (14.97) and carrier mobilities from Table 1.5, the maximum clocking frequencies $\\mathrm{f}_{\\mathrm{clk}}$ are found to be less than $14.8 \\mathrm{MHz}, 69 \\mathrm{MHz}$, and 196 MHz, respectively, for the three technologies. This demonstrates a significant speed increase for SC circuits with advancing technology."
},
{
    "text": "The subsequent configuration consistently resets an integrating capacitor on each clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared on each $\\phi_{2}$, while during $\\phi_{1}$, the input voltage charges $C_{1}$ and the charging current simultaneously flows across $C_{2}$. Consequently, the change in charge across $C_{2}, \\Delta Q_{C 2}$, equals the change in charge across $C_{1}, \\Delta Q_{C 1}$, and thus, at the end of $\\phi_{1}$, the output voltage relates to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }}=-\\mathrm{C}_{1} / \\mathrm{C}_{2}$.\n\nAdditionally, this circuit stores any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit (during $\\phi_{1}$), the effects of the opamp's input-offset voltage are eliminated from the output voltage. The cancellation of the opamp's input-offset voltage is crucial for two reasons. First, if the offset voltage is not cancelled, it will also be amplified along with the input signal, which can be problematic. Second, and often more significantly, when the offset voltage is removed, $1 / \\mathrm{f}$ noise is also diminished. As discussed in Chapter $9$, $1 / \\mathrm{f}$ noise is substantial at low frequencies and can be a predominant noise source in many MOS circuits. However, when a circuit cancels dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can employ a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo illustrate this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., when it is being reset), as shown in Fig. 14.32(a). The input offset voltage's effect is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs. In this scenario, it is in series with the positive input, simplifying the analysis. During $\\phi_{2}$, the voltages across $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are both equal to the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit is configured as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n})=\\mathrm{V}_{\\text {in }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$ it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\text {out }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$. Therefore, we can write:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}}=C_{1}\\left[V_{C_{1}}(n)-\\left(-V_{\\text {off }}\\right)\\right]=C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}-1 / 2)-\\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nSince the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2}=\\Delta Q_{C 1}$, we have\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n})=-\\mathrm{V}_{\\mathrm{off}}-\\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nFinally, as one side of $\\mathrm{C}_{2}$ is connected to the virtual ground of the opamp, which is at $\\mathrm{V}_{\\text {off }}$, the output voltage is given by\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & =V_{\\text {off }}+V_{C_{2}}(n) \\\\\n& =V_{\\text {off }}+\\left(-V_{\\text {off }}-\\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right)  \\tag{14.102}\\\\\n& =-\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is independent of the opamp offset voltage.\n\nNote, however, that the output voltage is only valid during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. The challenge in realizing this waveform lies in the opamp's output needing to slew between $-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V each time the clock changes, necessitating a very high slew-rate opamp for proper operation.\n\nFinally, a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is determined by digital signals."
},
{
    "text": "The subsequent configuration repeatedly resets an integrating capacitor on each clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$ phase, while during $\\phi_{1}$, the input voltage charges $C_{1}$ and simultaneously drives a charging current through $C_{2}$. Consequently, the change in charge across $C_{2}$, denoted as $\\Delta Q_{C 2}$, equals the change in charge across $C_{1}$, $\\Delta Q_{C 1}$. Therefore, at the conclusion of $\\phi_{1}$, the output voltage relates to the input voltage by the expression $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }}=-\\mathrm{C}_{1} / \\mathrm{C}_{2}$.\n\nAdditionally, this circuit retains any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit during $\\phi_{1}$, the impact of the opamp's input-offset voltage is nullified from the output voltage. The removal of the opamp's input-offset voltage is crucial for two reasons. First, if the offset voltage is not canceled, it will also be amplified along with the input signal, potentially causing issues. Second, and often more significantly, when the offset voltage is eliminated, $1 / \\mathrm{f}$ noise is also diminished. As discussed in Chapter 9, $1 / \\mathrm{f}$ noise is prominent at low frequencies and can be a predominant noise source in many MOS circuits. However, when a circuit cancels dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering out the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can utilize a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo illustrate this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., during the reset phase) as shown in Fig. 14.32(a). The influence of the input offset voltage is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs. In this scenario, it is connected in series with the positive input, simplifying the analysis. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit configuration is as shown in Fig. 14.32(b). At the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n})=\\mathrm{V}_{\\text {in }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$, and for $\\mathrm{C}_{2}$, it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\text {out }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$. Therefore, we can express:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}}=C_{1}\\left[V_{C_{1}}(n)-\\left(-V_{\\text {off }}\\right)\\right]=C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}-1 / 2)-\\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2}=\\Delta Q_{C 1}$, we derive:\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n})=-\\mathrm{V}_{\\mathrm{off}}-\\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nUltimately, since one side of $\\mathrm{C}_{2}$ connects to the virtual ground of the opamp, which is at $\\mathrm{V}_{\\text {off }}$, the output voltage is:\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & =V_{\\text {off }}+V_{C_{2}}(n) \\\\\n& =V_{\\text {off }}+\\left(-V_{\\text {off }}-\\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right)  \\tag{14.102}\\\\\n& =-\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is unaffected by the opamp offset voltage. However, the output voltage is only valid during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as illustrated in Fig. 14.33. The challenge in achieving this waveform lies in the opamp's necessity to rapidly transition between $-\\left(\\frac{C_{1}}{C_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change, demanding a high slew-rate opamp for accurate operation.\n\nFinally, it should be noted that a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is controlled by digital signals."
},
{
    "text": "The subsequent configuration consistently resets an integrating capacitor on every clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$, while during $\\phi_{1}$, the input voltage charges $C_{1}$ and the charging current simultaneously flows through $C_{2}$. Consequently, the change in charge across $C_{2}$, $\\Delta Q_{C 2}$, equals the change in charge across $C_{1}$, $\\Delta Q_{C 1}$, and thus, at the end of $\\phi_{1}$, the output voltage relates to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }}=-\\mathrm{C}_{1} / \\mathrm{C}_{2}$.\n\nAdditionally, this circuit retains any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit (during $\\phi_{1}$), the effects of the opamp's input-offset voltage are neutralized from the output voltage. The cancellation of the opamp's input-offset voltage is crucial for two reasons. First, if the offset voltage is not neutralized, it will also be amplified along with the input signal, which can be problematic. Second (and often more significant), when the offset voltage is eliminated, $1 / \\mathrm{f}$ noise is also diminished. As discussed in Chapter $9$, $1 / \\mathrm{f}$ noise is prominent at low frequencies and can be a predominant noise source in many MOS circuits. However, when a circuit cancels dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise. It is important to note that although there is a high-pass response from the opamp's input terminals to the output voltage, the overall circuit response does not necessarily exhibit a high-pass characteristic.\n\nTo observe this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., when it is being reset) as illustrated in Fig. 14.32(a). The impact of the input offset voltage is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs. In this scenario, it is placed in series with the positive input, simplifying the analysis. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit is configured as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n})=\\mathrm{V}_{\\text {in }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$, it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\text {out }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$. Therefore, we can express:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}}=C_{1}\\left[V_{C_{1}}(n)-\\left(-V_{\\text {off }}\\right)\\right]=C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}-1 / 2)-\\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2}=\\Delta Q_{C 1}$, we obtain\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n})=-\\mathrm{V}_{\\mathrm{off}}-\\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nFinally, since one side of $\\mathrm{C}_{2}$ is connected to the virtual ground of the opamp, which is at $\\mathrm{V}_{\\text {off }}$, the output voltage is\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & =V_{\\text {off }}+V_{C_{2}}(n) \\\\\n& =V_{\\text {off }}+\\left(-V_{\\text {off }}-\\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right)  \\tag{14.102}\\\\\n& =-\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is unaffected by the opamp offset voltage.\nNote, however, that the output voltage is valid only during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. The challenge in achieving this waveform lies in the opamp's requirement to slew between $-\\left(\\frac{C_{1}}{C_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change. Clearly, such a waveform necessitates an opamp with a very high slew rate for proper functioning.\n\nFinally, it is worth noting that a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is determined by digital signals."
},
{
    "text": "The subsequent configuration repeatedly resets an integrating capacitor on each clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$ phase, while during $\\phi_{1}$, the input voltage charges $C_{1}$ and simultaneously drives the charging current through $C_{2}$. Consequently, the change in charge across $C_{2}$, $\\Delta Q_{C 2}$, matches the change in charge across $C_{1}$, $\\Delta Q_{C 1}$. Thus, at the conclusion of $\\phi_{1}$, the output voltage relates to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }}=-\\mathrm{C}_{1} / \\mathrm{C}_{2}$.\n\nAdditionally, this circuit retains any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit during $\\phi_{1}$, the impact of the opamp's input-offset voltage is nullified from the output voltage. The cancellation of the opamp's input-offset voltage is crucial for two reasons. Firstly, if the offset voltage is not neutralized, it will also be amplified along with the input signal, potentially causing issues. Secondly, and often more significantly, eliminating the offset voltage also reduces $1 / \\mathrm{f}$ noise. As discussed in Chapter 9, $1 / \\mathrm{f}$ noise is prominent at low frequencies and can be a predominant noise source in many MOS circuits. When a circuit eradicates dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can utilize a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo illustrate this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., during the reset phase) as shown in Fig. 14.32(a). The influence of the input offset voltage is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs, simplifying the analysis when connected to the positive input. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit is arranged as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n})=\\mathrm{V}_{\\text {in }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$, it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\text {out }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$. Therefore, we can express:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}}=C_{1}\\left[V_{C_{1}}(n)-\\left(-V_{\\text {off }}\\right)\\right]=C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}-1 / 2)-\\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2}=\\Delta Q_{C 1}$, we derive:\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n})=-\\mathrm{V}_{\\mathrm{off}}-\\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nUltimately, since one side of $\\mathrm{C}_{2}$ connects to the virtual ground of the opamp at $\\mathrm{V}_{\\text {off }}$, the output voltage is:\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & =V_{\\text {off }}+V_{C_{2}}(n) \\\\\n& =V_{\\text {off }}+\\left(-V_{\\text {off }}-\\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right)  \\tag{14.102}\\\\\n& =-\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is unaffected by the opamp offset voltage.\nHowever, the output voltage is only valid during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. The challenge in achieving this waveform lies in the opamp's need to rapidly transition between $-\\left(\\frac{C_{1}}{C_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change, demanding a high slew-rate opamp for proper functionality.\n\nFinally, a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is controlled by digital signals."
},
{
    "text": "The subsequent configuration repeatedly resets an integrating capacitor on every clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$ phase, while during $\\phi_{1}$, the input voltage charges $C_{1}$, and concurrently, the charging current flows through $C_{2}$. Consequently, the change in charge across $C_{2}$, $\\Delta Q_{C 2}$, equals the change in charge across $C_{1}$, $\\Delta Q_{C 1}$, leading to an output voltage related to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }} = -\\mathrm{C}_{1} / \\mathrm{C}_{2}$ at the end of $\\phi_{1}$.\n\nAdditionally, this circuit stores any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit during $\\phi_{1}$, the impact of the opamp's input-offset voltage is neutralized from the output voltage. The cancellation of the opamp's input-offset voltage is crucial for two reasons. Firstly, if the offset voltage is not neutralized, it will also be amplified along with the input signal, potentially causing issues. Secondly, and often more significantly, eliminating the offset voltage also reduces $1 / \\mathrm{f}$ noise. As discussed in Chapter 9, $1 / \\mathrm{f}$ noise is prominent at low frequencies and can be a dominant noise source in many MOS circuits. When a circuit cancels dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can utilize a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo illustrate this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., during the reset phase) as shown in Fig. 14.32(a). The input offset voltage is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs, simplifying the analysis when connected to the positive input. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit configuration is as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n}) = \\mathrm{V}_{\\text {in }}(\\mathrm{n}) - \\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$, it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}) = \\mathrm{V}_{\\text {out }}(\\mathrm{n}) - \\mathrm{V}_{\\text {off }}$. Thus, we can express:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}} = C_{1}\\left[V_{C_{1}}(n) - \\left(-V_{\\text {off }}\\right)\\right] = C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}) = \\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n} - 1 / 2) - \\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2} = \\Delta Q_{C 1}$, we derive:\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n}) = -\\mathrm{V}_{\\mathrm{off}} - \\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nFinally, since one side of $\\mathrm{C}_{2}$ connects to the virtual ground of the opamp at $\\mathrm{V}_{\\text {off }}$, the output voltage is:\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & = V_{\\text {off }} + V_{C_{2}}(n) \\\\\n& = V_{\\text {off }} + \\left(-V_{\\text {off }} - \\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right) \\tag{14.102}\\\\\n& = -\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is independent of the opamp offset voltage.\nNote, however, that the output voltage is valid only during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. The challenge in achieving this waveform lies in the opamp's need to slew between $-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change, necessitating a high slew-rate opamp for proper operation.\n\nFinally, a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is controlled by digital signals."
},
{
    "text": "The subsequent configuration consistently resets an integrating capacitor on every clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$, while during $\\phi_{1}$, the input voltage charges $C_{1}$ and simultaneously the charging current flows through $C_{2}$. Consequently, the change in charge across $C_{2}$, $\\Delta Q_{C 2}$, equals the change in charge across $C_{1}$, $\\Delta Q_{C 1}$, resulting in an output voltage related to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }}=-\\mathrm{C}_{1} / \\mathrm{C}_{2}$ at the end of $\\phi_{1}$.\n\nAdditionally, this circuit stores any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit during $\\phi_{1}$, the impact of the opamp's input-offset voltage is nullified from the output voltage. The cancellation of the opamp's input-offset voltage is crucial for two reasons. Firstly, if the offset voltage is not neutralized, it will also be amplified along with the input signal, potentially causing issues. Secondly, and often more significantly, eliminating the offset voltage also reduces $1 / \\mathrm{f}$ noise. As discussed in Chapter $9$, $1 / \\mathrm{f}$ noise is substantial at low frequencies and can dominate noise in many MOS circuits. When a circuit cancels dc offset voltages, it effectively introduces a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can employ a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo observe this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., during the reset phase) as illustrated in Fig. 14.32(a). The input offset voltage's effect is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs, simplifying the analysis when connected to the positive input. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit configuration is as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n})=\\mathrm{V}_{\\text {in }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$ it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\text {out }}(\\mathrm{n})-\\mathrm{V}_{\\text {off }}$. Thus, we can write:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}}=C_{1}\\left[V_{C_{1}}(n)-\\left(-V_{\\text {off }}\\right)\\right]=C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n})=\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}-1 / 2)-\\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2}=\\Delta Q_{C 1}$, we derive:\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n})=-\\mathrm{V}_{\\mathrm{off}}-\\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nFinally, since one side of $\\mathrm{C}_{2}$ connects to the opamp's virtual ground at $\\mathrm{V}_{\\text {off }}$, the output voltage is:\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & =V_{\\text {off }}+V_{C_{2}}(n) \\\\\n& =V_{\\text {off }}+\\left(-V_{\\text {off }}-\\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right)  \\tag{14.102}\\\\\n& =-\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is unaffected by the opamp offset voltage.\nNote, however, that the output voltage is valid only during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. Realizing this waveform is challenging because the opamp output must rapidly transition between $-\\left(\\frac{C_{1}}{C_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change, necessitating a high slew-rate opamp for proper operation.\n\nFinally, a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is controlled by digital signals."
},
{
    "text": "The subsequent configuration consistently resets an integrating capacitor on each clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$, while during $\\phi_{1}$, the input voltage charges $C_{1}$ and simultaneously the charging current flows through $C_{2}$. Consequently, the change in charge across $C_{2}$, $\\Delta Q_{C 2}$, equals the change in charge across $C_{1}$, $\\Delta Q_{C 1}$, resulting in the output voltage being related to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }} = -\\mathrm{C}_{1} / \\mathrm{C}_{2}$ at the end of $\\phi_{1}$.\n\nAdditionally, this circuit stores any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit (during $\\phi_{1}$), the impact of the opamp's input-offset voltage is eliminated from the output voltage. The cancellation of the opamp's input-offset voltage is crucial for two reasons. First, if the offset voltage is not cancelled, it will also be amplified along with the input signal, potentially causing issues. Second, and often more significantly, eliminating the offset voltage also reduces $1 / \\mathrm{f}$ noise. As discussed in Chapter 9, $1 / \\mathrm{f}$ noise is substantial at low frequencies and can be a predominant noise source in many MOS circuits. When a circuit cancels dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can utilize a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo illustrate this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., during the reset phase) as shown in Fig. 14.32(a). The input offset voltage's effect is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs, simplifying the analysis when connected to the positive input. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit configuration changes as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n}) = \\mathrm{V}_{\\text {in }}(\\mathrm{n}) - \\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$ it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}) = \\mathrm{V}_{\\text {out }}(\\mathrm{n}) - \\mathrm{V}_{\\text {off }}$. Thus, we can express:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}} = C_{1}\\left[V_{C_{1}}(n) - \\left(-V_{\\text {off }}\\right)\\right] = C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}) = \\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n} - 1 / 2) - \\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2} = \\Delta Q_{C 1}$, we obtain:\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n}) = -\\mathrm{V}_{\\text {off }} - \\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nFinally, since one side of $\\mathrm{C}_{2}$ is connected to the virtual ground of the opamp, which is at $\\mathrm{V}_{\\text {off }}$, the output voltage is:\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & = V_{\\text {off }} + V_{C_{2}}(n) \\\\\n& = V_{\\text {off }} + \\left(-V_{\\text {off }} - \\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right) \\tag{14.102}\\\\\n& = -\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nHence, the output voltage is independent of the opamp offset voltage. Note that the output voltage is only valid during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. The challenge in achieving this waveform lies in the opamp's necessity to rapidly slew between $-\\left(\\frac{C_{1}}{C_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change, demanding a high slew-rate opamp for proper functionality.\n\nFinally, a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is controlled by digital signals."
},
{
    "text": "The subsequent configuration consistently resets an integrating capacitor on each clock cycle, as depicted in Fig. 14.31 [Gregorian, 1981]. Here, the voltage across the integrating capacitor, $\\mathrm{C}_{2}$, is cleared during each $\\phi_{2}$, whereas during $\\phi_{1}$, the input voltage charges $C_{1}$, and concurrently, the charging current flows through $C_{2}$. Consequently, the change in charge across $C_{2}$, $\\Delta Q_{C 2}$, equals the change in charge across $C_{1}$, $\\Delta Q_{C 1}$, leading to the output voltage being related to the input voltage by $\\mathrm{V}_{\\text {out }} / \\mathrm{V}_{\\text {in }} = -\\mathrm{C}_{1} / \\mathrm{C}_{2}$ at the end of $\\phi_{1}$.\n\nAdditionally, this circuit stores any opamp input-offset voltage across the input and feedback capacitors. When the output is sampled by the subsequent circuit during $\\phi_{1}$, the effects of the opamp's input-offset voltage are nullified from the output voltage. The cancellation of the opamp's input-offset voltage is significant for two reasons. Firstly, if the offset voltage is not cancelled, it will also be amplified along with the input signal, potentially causing issues. Secondly, and often more critically, the elimination of the offset voltage reduces $1 / \\mathrm{f}$ noise. As discussed in Chapter 9, $1 / \\mathrm{f}$ noise is prominent at low frequencies and can be a dominant noise source in many MOS circuits. When a circuit cancels dc offset voltages, it effectively exhibits a high-pass response from the opamp's input terminals to the output voltage, thereby filtering and reducing the $1 / \\mathrm{f}$ noise.\n\nKey Point: Switched-capacitor circuits can utilize a reset phase to sample and cancel dc offset and very low-frequency (1/f) noise without impacting the circuit's overall dc gain.\n\nTo illustrate this offset cancellation, consider the gain circuit during $\\phi_{2}$ (i.e., during the reset phase) as shown in Fig. 14.32(a). The input offset voltage is modeled as a voltage source, $\\mathrm{V}_{\\text {off }}$, placed in series with one of the opamp inputs, simplifying the analysis when connected to the positive input. During $\\phi_{2}$, the voltages across both $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ equal the opamp offset voltage, $\\mathrm{V}_{\\text {off }}$. Subsequently, during $\\phi_{1}$, the circuit is configured as shown in Fig. 14.32(b), and at the end of $\\phi_{1}$, the voltage across $C_{1}$ is $\\mathrm{V}_{\\mathrm{C}_{1}}(\\mathrm{n}) = \\mathrm{V}_{\\text {in }}(\\mathrm{n}) - \\mathrm{V}_{\\text {off }}$, while for $\\mathrm{C}_{2}$, it is $\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}) = \\mathrm{V}_{\\text {out }}(\\mathrm{n}) - \\mathrm{V}_{\\text {off }}$. Thus, we can write:\n\n$$\n\\begin{equation*}\n\\Delta Q_{C_{1}} = C_{1}\\left[V_{C_{1}}(n) - \\left(-V_{\\text {off }}\\right)\\right] = C_{1} v_{\\text {in }}(n) \\tag{14.99}\n\\end{equation*}\n$$\n\nand\n\n$$\n\\begin{equation*}\n\\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n}) = \\mathrm{V}_{\\mathrm{C}_{2}}(\\mathrm{n} - 1 / 2) - \\frac{\\Delta \\mathrm{Q}_{\\mathrm{C}_{2}}}{\\mathrm{C}_{2}} \\tag{14.100}\n\\end{equation*}\n$$\n\nGiven that the voltage across $C_{2}$ one-half period earlier was $-V_{\\text {off }}$ and $\\Delta Q_{C 2} = \\Delta Q_{C 1}$, we have:\n\n$$\n\\begin{equation*}\nV_{\\mathrm{C}_{2}}(\\mathrm{n}) = -\\mathrm{V}_{\\text {off }} - \\frac{\\mathrm{C}_{1} \\mathrm{~V}_{\\mathrm{in}}(\\mathrm{n})}{\\mathrm{C}_{2}} \\tag{14.101}\n\\end{equation*}\n$$\n\nFinally, since one side of $\\mathrm{C}_{2}$ is connected to the virtual ground of the opamp at $\\mathrm{V}_{\\text {off }}$, the output voltage is:\n\n$$\n\\begin{align*}\nV_{\\text {out }}(n) & = V_{\\text {off }} + V_{C_{2}}(n) \\\\\n& = V_{\\text {off }} + \\left(-V_{\\text {off }} - \\frac{C_{1} v_{\\text {in }}(n)}{C_{2}}\\right) \\tag{14.102}\\\\\n& = -\\left(\\frac{C_{1}}{C_{2}}\\right) v_{\\text {in }}(n)\n\\end{align*}\n$$\n\nThus, the output voltage is independent of the opamp offset voltage. However, the output voltage is only valid during $\\phi_{1}$ and equals $\\mathrm{V}_{\\text {off }}$ during $\\phi_{2}$, as shown in Fig. 14.33. The challenge in achieving this waveform lies in the opamp's need to rapidly slew between $-\\left(\\frac{\\mathrm{C}_{1}}{\\mathrm{C}_{2}}\\right) \\mathrm{v}_{\\mathrm{in}}$ and a voltage near 0 V with each clock change, necessitating a high slew-rate opamp for proper functionality.\n\nFig. 14.33 depicts a time-domain waveform of the output voltage, \\( V_{out} \\), for a resettable gain circuit. The waveform features two phases, \\( \\phi_1 \\) and \\( \\phi_2 \\), repeating over time. During \\( \\phi_1 \\), the output voltage increases linearly, indicating active amplification. During \\( \\phi_2 \\), the voltage drops to \\( V_{off} \\), representing the reset period. The sharp transitions between these phases require a high slew-rate opamp.\n\nLastly, a programmable gain circuit can be easily implemented by substituting $C_{1}$ with a programmable capacitor array (PCA), where the capacitor size is controlled by digital signals."
},
{
    "text": "To obviate the necessity for the opamp output to slew to around 0 V during each clock period while still nullifying the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to link the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it will be evident that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors attributable to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (as opposed to the typical $1 / A$). This outcome frequently permits the use of single-stage opamps that are highly rapid.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] that provides continuous-time feedback during the non-overlapping clock periods when all the switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. This capacitor is typically small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or noninverting amplifier, depending on the clock phases of the input stage. In the inverting configuration, the output is a delay-free version of the input, whereas in the noninverting configuration, the output lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where the output voltage is seen to be independent of the offset voltage, akin to the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. It is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges neutralize each other, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To avoid the necessity of the opamp output slewing to around 0 V during each clock period while still compensating for the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to connect the opamp's output to the inverting input via a capacitor that has been previously charged to the output voltage during the reset phase. Consequently, we observe that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (as opposed to the typical $1 / A$). This often permits the use of single-stage opamps that are exceptionally fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ serves as an optional \"deglitching\" capacitor [Matsumoto, 1987], providing continuous-time feedback during the non-overlapping clock periods when all switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. Typically, this capacitor would be small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or non-inverting amplifier, depending on the clock phases of the input stage. In the inverting configuration, the output is a delay-free version of the input, whereas in the non-inverting configuration, the output lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where the output voltage is independent of the offset voltage, akin to the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. It is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each capacitor is grounded, their charges neutralize each other, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as depicted. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$, but it would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the circuit design ensures that the switches around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities caused by charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accommodates differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To remove the necessity for the opamp output to slew to around 0 V every clock cycle while still compensating for the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The core concept of this gain circuit is to connect the opamp's output to the inverting input during the reset phase using a capacitor that has been previously charged to the output voltage. Consequently, it becomes evident that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Moreover, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Additionally, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (instead of the typical $1 / A$). This outcome frequently permits the use of single-stage opamps that are highly fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] designed to provide continuous-time feedback during the non-overlapping clock periods when all switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any moment. This capacitor is typically small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either inverting or noninverting based on the clock phases of the input stage. While the inverting configuration produces an output that is a delay-free version of the input, the noninverting configuration results in an output that lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where it is evident that the output voltage is independent of the offset voltage, just like in the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. Before proceeding, it is noteworthy to consider the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges neutralize each other, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage as shown. It should be noted that even if the charges did not exactly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To obviate the necessity for the opamp output to slew to around 0 V during each clock period while still neutralizing the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to link the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it will be evident that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (instead of the typical $1 / A$). This often permits the use of single-stage opamps that are exceptionally fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] designed to provide continuous-time feedback during the non-overlapping clock periods when all switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. Typically, this capacitor would be small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or noninverting amplifier, depending on the clock phases of the input stage. In the inverting configuration, the output is a delay-free version of the input, whereas in the noninverting configuration, the output lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where it is evident that the output voltage is independent of the offset voltage, akin to the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. It is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges neutralize each other, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To avoid the necessity for the opamp output to slew to around 0 V during each clock period while still nullifying the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to link the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it becomes evident that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (as opposed to the typical $1 / A$). This outcome often permits the use of single-stage opamps that are exceptionally fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] designed to provide continuous-time feedback during the non-overlapping clock times when all switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. Typically, this capacitor would be small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or non-inverting amplifier, depending on the clock phases of the input stage. While the inverting configuration produces an output that is a delay-free version of the input, the non-inverting configuration results in an output that lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where it is evident that the output voltage is independent of the offset voltage, just like in the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. Before proceeding, it is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges cancel each other out, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nFinally, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches connected around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities caused by charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To obviate the necessity for the opamp output to slew to around 0 V during each clock period while still nullifying the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to link the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it will be evident that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Additionally, since the circuit is impervious to the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or for inputs that remain constant for at least two clock periods), the errors attributable to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (as opposed to the typical $1 / A$). Such a finding frequently permits the utilization of single-stage opamps that are exceptionally fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] used to furnish continuous-time feedback during the nonoverlap clock times when all the\nimage_name:Fig. 14.34\ndescription:The circuit is a switched-capacitor gain circuit with capacitive reset. It can function as an inverting or non-inverting amplifier based on the clock signals. The gain is determined by the ratio of capacitors C1 and C2, as indicated by the equation: Vout(n) = -(C1/C2) * Vin(n). The optional capacitor C4 is employed for deglitching during non-overlapping clock phases.\n\nFig. 14.34 A gain circuit employing capacitive reset ( $C_{4}$ is an optional deglitching capacitor). Depending on the input-stage clock signals, the gain can be either inverting (as depicted) or noninverting (input-stage clocks shown in parentheses).\n\n[^3]switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. This capacitor is typically small (around 0.5 pF or less).\n\nThis gain circuit can function as either inverting or noninverting based on the clock phases of the input stage. While the inverting configuration generates its output as an immediate version of the input, the output for the noninverting configuration lags the input signal by one-half clock cycle.\n\nTo comprehend the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent clock phase of $\\phi_{1}$ is shown in Fig. 14.35(b), where it is evident that the output voltage is unaffected by the offset voltage, just like in the resettable gain circuit. Moreover, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. Before proceeding, it is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) of Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges neutralize each other, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage as depicted. It should be noted that even if the two charges did not exactly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not impact the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches connected around the virtual grounds are disconnected slightly earlier than other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp that not only accepts differential inputs but also, to a first-order approximation, counteracts the clock feedthrough of the switches [Martin, 1982].\nimage_name:(a)\ndescription:\n[\nname: C1, type: Capacitor, value: C1, ports: {Np: InN(A1), Nn: GND}\nname: C2, type: Capacitor, value: C2, ports: {Np: InN(A1), Nn: GND}\nname: C3, type: Capacitor, value: C3, ports: {Np: Vout(n-1)+Voff, Nn: InN(A1)}\nname: A1, type: OpAmp, value: A1, ports: {InP: Voff, InN: InN(A1), OutP: Vout, OutN: Vout(n-1)+Voff}\nname: V_off, type: VoltageSource, value: V_off, ports: {Np: Voff, Nn: GND}\n]\nextrainfo:The circuit is a differential-to-single-ended gain stage using capacitive reset. The circuit reduces nonlinearities due to charge injection by disconnecting switches around virtual grounds slightly earlier than others. It also cancels clock feedthrough of the switches to a first-order approximation.\nimage_name:(b)\ndescription:\n[\nname: C1, type: Capacitor, value: C1, ports: {Np: Vin(n), Nn: InN(A1)}\nname: C2, type: Capacitor, value: C2, ports: {Np: Vout(n), Nn: InN(A1)}\nname: C3, type: Capacitor, value: C3, ports: {Np: Vout(n), Nn: GND}\nname: A1, type: OpAmp, value: A1, ports: {InP: Voff, InN: InN(A1), OutP: Vout(n)}\nname: Voff, type: VoltageSource, value: Voff, ports: {Np: Voff, Nn: GND}\n]\nextrainfo:The circuit is a differential-to-single-ended gain stage using capacitive reset. It includes a switched-capacitor circuit that aids in canceling clock feedthrough and reducing nonlinearities. The output voltage is given by Vout(n) = -(C1/C2) * Vin(n).\n\nFig. 14.35 Capacitive-reset gain circuit. (a) During reset $\\left(\\phi_{2}\\right)$ when the output stays near the previous output level. (b) During valid output ( $\\phi_{1}$ ) when no offset error is present.\nimage_name:Fig. 14.36\ndescription:The circuit is a differential-to-single-ended gain stage using capacitive reset. It includes a switched-capacitor circuit that aids in canceling clock feedthrough and reducing nonlinearities. The output voltage is given by Vout = (C1/C2) * (Vin+ - Vin-). The circuit employs correlated double sampling (CDS) to minimize errors due to finite offset voltages, 1/f noise, and finite opamp gain.\n\nFig. 14.36 A differential-to-single-ended gain circuit using capacitive reset."
},
{
    "text": "To avoid the necessity of the opamp output slewing to around 0 V during each clock period while still compensating for the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to connect the opamp's output to the inverting input via a capacitor that has been previously charged to the output voltage during the reset phase. Consequently, it can be observed that a characteristic of this gain circuit is that the opamp's output only needs to change by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (instead of the typical $1 / A$). This often permits the use of single-stage opamps that are highly fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] used to provide continuous-time feedback during the non-overlapping clock periods when all the switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. This capacitor is typically small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or noninverting amplifier, depending on the clock phases of the input stage. In the inverting configuration, the output is a delay-free version of the input, whereas in the noninverting configuration, the output lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is evident that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where the output voltage is independent of the offset voltage, akin to the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. It is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each capacitor is grounded, their charges neutralize each other, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To remove the necessity for the opamp output to slew to around 0 V during each clock period while still counteracting the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to link the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it becomes evident that a characteristic of this gain circuit is that the opamp's output only needs to vary by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (instead of the typical $1 / A$). This outcome often permits the use of single-stage opamps that are exceptionally fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ serves as an optional \"deglitching\" capacitor [Matsumoto, 1987], providing continuous-time feedback during the non-overlapping clock times when all switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. Typically, this capacitor would be small (approximately 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or noninverting amplifier, depending on the clock phases of the input stage. In the inverting configuration, the output is a delay-free version of the input, whereas in the noninverting configuration, the output lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similar to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where the output voltage is independent of the offset voltage, akin to the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. It is noteworthy to observe the behavior of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), grounding one side of each capacitor results in their charges canceling each other out, thereby preventing any charge from being transferred to $\\mathrm{C}_{3}$. Thus, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$, but it would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. The depicted circuit indicates that the switches around the virtual grounds are disconnected slightly earlier than other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To avoid the necessity of the opamp output slewing to around 0 V every clock period while still compensating for the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to connect the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it will be evident that a characteristic of this gain circuit is that the opamp's output only needs to change by the opamp's offset voltage between clock phases. Additionally, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Furthermore, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (instead of the typical $1 / A$). This often permits the use of single-stage opamps that are exceptionally fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] used to provide continuous-time feedback during the non-overlapping clock times when all switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. This capacitor is typically small (about 0.5 pF or less).\n\nThis gain circuit can function as either an inverting or noninverting amplifier, depending on the clock phases of the input stage. While the inverting configuration produces an output that is a delay-free version of the input, the noninverting configuration results in an output that is one-half clock cycle behind the input signal.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent $\\phi_{1}$ clock phase is shown in Fig. 14.35(b), where it is evident that the output voltage is independent of the offset voltage, just like in the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. Before proceeding, it is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges cancel each other out, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the two charges did not exactly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches connected around the virtual grounds are disconnected slightly earlier than the other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982]."
},
{
    "text": "To avoid the necessity of the opamp's output slewing to around 0 V every clock period while still nullifying the opamp's offset voltage, a capacitive-reset gain circuit can be employed. The fundamental concept of this gain circuit is to connect the opamp's output to the inverting input during the reset phase via a capacitor that has been previously charged to the output voltage. Consequently, it becomes evident that a characteristic of this gain circuit is that the opamp's output only needs to change by the opamp's offset voltage between clock phases. Moreover, since the circuit is unaffected by the opamp's input offset voltage, it also diminishes the impact of the opamp's 1/f noise. Additionally, it can be demonstrated (refer to [Martin, 1987]) that for low-frequency inputs (or inputs that remain constant for at least two clock periods), the errors due to the finite gain, A, of the opamp are proportional to $1 / A^{2}$ (instead of the typical $1 / A$). This outcome often permits the use of single-stage opamps that are highly fast.\n\nThe capacitive-reset gain circuit is depicted in Fig. 14.34. Capacitor $\\mathrm{C}_{4}$ is an optional \"deglitching\" capacitor [Matsumoto, 1987] used to provide continuous-time feedback during the non-overlapping clock times when all the\nimage_name:Fig. 14.34\ndescription:A switched-capacitor gain circuit with capacitive reset that can function as an inverting or non-inverting amplifier based on clock signals. The gain is determined by the ratio of capacitors C1 and C2, as per the equation: Vout(n) = -(C1/C2) * Vin(n). The optional capacitor C4 is used for deglitching during non-overlapping clock phases.\n\nFig. 14.34 A gain circuit utilizing capacitive reset ( $C_{4}$ is an optional deglitching capacitor). Depending on the input-stage clock signals, the gain can be either inverting (as illustrated) or noninverting (input-stage clocks shown in parentheses).\n\n[^3]switches are open. This deglitching method is effective and should be utilized in nearly all switched-capacitor circuits that would otherwise lack a feedback connection at any point in time. This capacitor is typically small (approximately 0.5 pF or less).\n\nThis gain circuit can operate in either inverting or noninverting mode based on the clock phases of the input stage. While the inverting configuration produces an output that is a delay-free version of the input, the noninverting configuration results in an output that lags the input signal by one-half clock cycle.\n\nTo understand the operation of this capacitive-reset gain circuit, consider the inverting configuration during the reset phase of $\\phi_{2}$, as illustrated in Fig. 14.35(a). It is assumed that capacitor $\\mathrm{C}_{3}$ was charged to the output voltage during the preceding $\\phi_{1}$ clock phase. Here, it is observed that capacitors $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are charged to the opamp's input-offset voltage, $\\mathrm{V}_{\\mathrm{off}}$, similarly to the resettable gain circuit in Fig. 14.31. The subsequent clock phase of $\\phi_{1}$ is shown in Fig. 14.35(b), where it is evident that the output voltage is independent of the offset voltage, just like in the resettable gain circuit. Additionally, during $\\phi_{1}$, capacitor $\\mathrm{C}_{3}$ is charged to the output voltage. Before proceeding, it is noteworthy to consider the fate of the charges on $C_{1}$ and $C_{2}$ when transitioning from phase $\\phi_{1}$ to $\\phi_{2}$ (i.e., from circuit (b) to (a) in Fig. 14.35). Since the charges on $\\mathrm{C}_{1}$ and $\\mathrm{C}_{2}$ are equal (recall that the charge on $\\mathrm{C}_{2}$ was acquired during the charging of $C_{1}$), when one side of each of $C_{1}$ and $C_{2}$ is grounded, their charges cancel each other out, and no charge is transferred to $\\mathrm{C}_{3}$. Therefore, in the circuit of Fig. 14.35(a), the voltage on $\\mathrm{C}_{3}$ remains equal to the previous output voltage, as shown. It should be noted that even if the charges did not perfectly cancel, it would only cause the output voltage to deviate slightly further from the previous output voltage during $\\phi_{2}$ but would not affect the output voltage during $\\phi_{1}$.\n\nLastly, this capacitive-reset gain circuit can also implement a differential-to-single-ended gain stage, as shown in Fig. 14.36. Note that the depicted circuit indicates that the switches around the virtual grounds are disconnected slightly earlier than other switches to mitigate nonlinearities due to charge injection. This circuit incorporates a switched-capacitor circuit connected to the positive input of the opamp, which not only accepts differential inputs but also, to a first-order approximation, cancels the clock feedthrough of the switches [Martin, 1982].\nimage_name:(a)\ndescription:\n[\nname: C1, type: Capacitor, value: C1, ports: {Np: InN(A1), Nn: GND}\nname: C2, type: Capacitor, value: C2, ports: {Np: InN(A1), Nn: GND}\nname: C3, type: Capacitor, value: C3, ports: {Np: Vout(n-1)+Voff, Nn: InN(A1)}\nname: A1, type: OpAmp, value: A1, ports: {InP: Voff, InN: InN(A1), OutP: Vout, OutN: Vout(n-1)+Voff}\nname: V_off, type: VoltageSource, value: V_off, ports: {Np: Voff, Nn: GND}\n]\nextrainfo:The circuit is a differential-to-single-ended gain stage using capacitive reset. The circuit reduces nonlinearities due to charge injection by disconnecting switches around virtual grounds slightly sooner than others. It also cancels clock feedthrough of the switches to a first-order approximation.\nimage_name:(b)\ndescription:\n[\nname: C1, type: Capacitor, value: C1, ports: {Np: Vin(n), Nn: InN(A1)}\nname: C2, type: Capacitor, value: C2, ports: {Np: Vout(n), Nn: InN(A1)}\nname: C3, type: Capacitor, value: C3, ports: {Np: Vout(n), Nn: GND}\nname: A1, type: OpAmp, value: A1, ports: {InP: Voff, InN: InN(A1), OutP: Vout(n)}\nname: Voff, type: VoltageSource, value: Voff, ports: {Np: Voff, Nn: GND}\n]\nextrainfo:The circuit is a differential-to-single-ended gain stage using capacitive reset. It includes a switched-capacitor circuit that helps cancel clock feedthrough and reduce nonlinearities. The output voltage is given by Vout(n) = -(C1/C2) * Vin(n).\n\nFig. 14.35 Capacitive-reset gain circuit. (a) During reset $\\left(\\phi_{2}\\right)$ when the output stays near the previous output level. (b) During valid output ( $\\phi_{1}$ ) when no offset error is present.\nimage_name:Fig. 14.36\ndescription:The circuit is a differential-to-single-ended gain stage using capacitive reset. It includes a switched-capacitor circuit that helps cancel clock feedthrough and reduce nonlinearities. The output voltage is given by Vout = (C1/C2) * (Vin+ - Vin-). The circuit uses correlated double sampling (CDS) to minimize errors due to finite offset voltages, 1/f noise, and finite opamp gain.\n\nFig. 14.36 A differential-to-single-ended gain circuit using capacitive reset."
}
]