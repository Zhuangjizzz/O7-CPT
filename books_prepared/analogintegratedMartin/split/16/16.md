# 16 Nyquist-Rate D/A Converters

In this chapter, a variety of methods are discussed for realizing integrated Nyquist-rate digital-to-analog converters (DAC). Nyquist-rate D/A converters can be roughly categorized into four main types: decoder-based, binaryweighted, thermometer-code, and hybrid. Oversampling D/A converters are discussed separately in Chapter 18 due to their importance and because they are best described using many signal processing concepts.

## 16.1 DECODER-BASED CONVERTERS

Perhaps the most straightforward approach for realizing an N-bit D/A converter is to create $2^{\mathrm{N}}$ reference signals and pass the appropriate signal to the output, depending on the digital input word. We refer to such D/A converters as decoder-based converters.

### 16.1.1 Resistor-String Converters

Key Point: Decoder-based D/A converters operate by creating a set of analog reference levels and selecting one by turning on appropriate switches selected by an input digital code.

One of the first integrated MOS 8 -bit D/A converters was based on selecting one tap of a segmented resistor string by a switch network [Hamad√©, 1978]. ${ }^{1}$ The switch network was connected in a tree-like decoder, as in the 3-bit D/A converter shown in Fig. 16.1. Notice that there will be one, and only one, low-impedance path between the resistor string and the input of the buffer, and that path is determined by the digital input word, $\mathrm{B}_{\text {in }}$. In a CMOS implementation, transmission gates might be used rather than n -channel switches. However, when only n -channel pass transistors are used, the transistor-tree decoder can be laid out quite compactly since no contacts are required in the tree. Also, an n-channel-only approach is not much different in speed than a CMOS transmission-gate implementation; a transmission-gate approach has extra drain and source capacitance to ground, but this extra capacitance is offset by the reduced switch resistance, which is due to the parallel combination of $p$-channel and n -channel transistors. In addition, a transmission-gate implementation can operate closer to the positive voltage supply.

With a resistor-string approach, if we assume the buffer's offset voltage does not depend on its input voltage, the $\mathrm{D} / \mathrm{A}$ converter has guaranteed monotonicity since any tap on the resistor string must have a lower voltage than its upper, neighbor tap. Also, the accuracy of this D/A depends on the matching precision of R in the resistor string. Although this resistor-matching precision depends on the type of resistors used, the use of polysilicon resistors can result in up to approximately 10 bits of accuracy.

The delay through the switch network is the major limitation on speed. However, in a multiplying D/A, the delay through the resistor string would also be a major source of delay since $\mathrm{V}_{\text {ref }}$ would become a second input signal. A useful technique for estimating the settling-time behavior in RC type circuits (i.e., circuits that have only real-axis poles) is the zero-value time-constant approach described in Section 4.2.4 [Sedra, 1991].

[^0]![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-024.jpg?height=1023&width=1243&top_left_y=178&top_left_x=253)

Fig. 16.1 Resistor-string 3-bit D/A converter with a transmission-gate, tree-like decoder.

Specifically, the dominant high-frequency time constant is estimated as the sum of the individual time constants due to each of the capacitances when all other capacitances are set to zero (i.e., replaced with open circuits). To find the individual time constant for a given capacitance, independent voltage sources are replaced with ground (independent current sources are opened), and the resistance seen by that capacitor is determined.

#### EXAMPLE 16.1

Show that an estimate of the time constant for a network of $n$ resistors, each of size $R$ in series, with capacitive loading $C$ at each node (see Fig. 16.2), is given by $\tau=R C\left(n^{2} / 2\right)$. How much settling time is required for the output to settle to 0.1 percent of its final value?

#### Solution

The zero-value time-constant due to the first capacitor on the left is simply RC. The second capacitor from the left has an individual time constant of 2 RC and so on. Thus, the dominant high-frequency time constant, $\tau$, is estimated as

$$
\tau \cong R C(1+2+\cdots+n)
$$

The sum from 1 to $n$ can be shown to be equal to $n(n+1) / 2$ and, thus, for a large $n$, the dominant time constant
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-025.jpg?height=376&width=1210&top_left_y=173&top_left_x=290)

Fig. 16.2 Estimating the time constant for n resistors and capacitors in series.
can be estimated by

$$
\tau \cong \operatorname{RC}\left(\frac{\mathrm{n}^{2}}{2}\right)
$$

Using this time constant to estimate the output voltage charging behavior, we have

$$
\mathrm{V}_{\text {out }} \cong\left(1-\mathrm{e}^{-(t / \tau)}\right) \mathrm{V}_{\mathrm{p}}
$$

Thus, for $\mathrm{V}_{\text {out }}$ to equal $0.999 \mathrm{~V}_{\mathrm{p}}$, we find that a time of about $7 \tau$ is needed.

In a higher-speed implementation, logic can be used for the decoder, and a single bus is connected to a single resistor-string node, as shown in Fig. 16.3. This approach takes more area for the decoder and also results in a large capacitive loading on the single bus because the $2^{\mathrm{N}}$ transistors' junctions are connected to the bus. However, if the digital decoder is pipelined, the $\mathrm{D} / \mathrm{A}$ can be moderately fast.

### 16.1.2 Folded Resistor-String Converters

To reduce the amount of digital decoding and large capacitive loading, a folded resistor-string $D / A$ can be used, as shown in Fig. 16.4 [Abrial, 1988]. This approach makes the decoding very similar to that for a digital memory, which reduces the total decoding area. To convert a digital input in this 4 -bit example, the most significant bits, $\left\{b_{1}, b_{2}\right\}$, determine the single word line to be selected (all others will remain low). This operation connects a block of four adjacent resistor nodes to the four-bit lines. One of these bit lines is then connected to the output buffer by the bit-line decoder. Notice that the total number of transistor junctions on the output line is now $2 \sqrt{2^{\mathrm{N}}}$ because a set of transistors is connected directly to the output line and another set is connected to the chosen bit line. Thus, for a 10-bit converter, this approach would have a capacitive load of 64 junctions, as opposed to 1,024 junctions when we use the digital-decoding approach shown in Fig. 16.3. Unfortunately, the increase in speed is not equal to this large ratio since, when a word line goes high, all the bit lines must be pulled to new voltage levels - not just the one bit line connected to the output buffer.

### 16.1.3 Multiple Resistor-String Converters

In this variation, a second tapped resistor string is connected between buffers whose inputs are two adjacent nodes of the first resistor string, as shown in Fig. 16.5 [Holloway, 1984]. In the shown 6-bit example, the three
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-026.jpg?height=1010&width=976&top_left_y=180&top_left_x=393)

Fig. 16.3 Resistor-string 3-bit D/A converter with digital decoding.

MSBs determine which two adjacent nodes of the first resistor string are connected to the two intermediate buffers. The second resistor string linearly interpolates between the two adjacent voltages from the first resistor string. Finally, the output is determined by the lower LSBs where extra logic must take into account that sometimes the top intermediate buffer has the higher voltage, whereas at other times it has the lower voltage. This approach requires only $2 \times 2^{\mathrm{N} / 2}$ resistors, making it suitable for higher-resolution, low-power applications. This approach also has guaranteed monotonicity, assuming the opamps have matched, voltage-insensitive offset voltages. However, the opamps must be fast and low noise, which can be achieved using a BiCMOS process. Another point to note here is that, since the second resistor string is used to decode only the lower-order bits, the matching requirements of the second resistor string are not nearly as severe as those for the first string.

#### EXAMPLE 16.2

Assume that the first resistor string of a 10 -bit, multiple-R-string, D/A converter must match to 0.1 percent, and that the first string realizes the top 4 bits. What is the matching requirement of the second resistor string, which realizes the lower 6 bits?

#### Solution

Errors in the first resistor string correspond directly to errors in the overall D/A output. However, since the second resistor string forms the lower LSB bits ( 6 bits, in this case), errors in the matching of these resistors
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-027.jpg?height=1142&width=1264&top_left_y=180&top_left_x=272)

Fig. 16.4 A 4-bit folded resistor-string D/A converter.
cause an error only in the LSB portion of the output voltage. As a result, the second resistor string need match only to

$$
\begin{equation*}
2^{4} \times 0.1 \%=1.6 \% \tag{16.1}
\end{equation*}
$$

### 16.1.4 Signed Outputs

In applications where negative output voltages are required, the bottom of the resistor string can be connected to $-\mathrm{V}_{\text {ref }}$. This requires a negative power supply, and the circuit needed to realize a dual power supply with exactly matched voltages is nontrivial since any error in matching will result in an offset error. Many papers on D/A converters assume that $-\mathrm{V}_{\text {ret }}$ is available but do not explain how it was obtained. If it is obtained off chip, the cost is significantly higher. One possibility is to use a switched-capacitor gain amplifier, as shown in Fig. 16.6, where a negative output can be realized by changing the clock phases of the input switches so an inverting amplifier is realized [Martin, 1987]. Another possibility is to sense the center tap of the resistor string and adjust $-\mathrm{V}_{\text {ref }}$ to get the center tap voltage equal to zero volts.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-028.jpg?height=1167&width=1216&top_left_y=186&top_left_x=280)

Fig. 16.5 Multiple R-string 6-bit D/A converter.

## 16.2 BINARY-SCALED CONVERTERS

Key Point: Binary-scaled D/A converters combine binary-weighted circuit quantities (currents, resistors, capacitors, etc.) under digital control to realize an analog quantity. Such techniques are generally hardware-efficient, but can be subject to significant nonlinearities.

The most popular approach for realizing at least some portion of D/A converters is to combine an appropriate set of signals that are all related in a binary fashion. This binary array of signals might be currents (in resistor or current approaches), but binary-weighted arrays of charge are also commonly used. In this section, resistor approaches are first discussed, followed by charge redistribution and current mode. Monotonicity is not guaranteed under such schemes since totally disparate sets of components are used to translate neighboring digital code words into analog voltages or currents, and large DNL is generally observed when large portions of the binary-weighted array are switched on and off. For example, this mismatch effect is usually the largest in a binary-array converter when the MSB is changed, resulting in the largest DNL at this location.

### 16.2.1 Binary-Weighted Resistor Converters

Binary-weighted resistor converters are popular for a bipolar technology so that bipolar differential pairs can be used for current switches. The basic architecture for a 4-bit converter is shown in Fig. 16.7.

If $b_{i}$ is a 1 , then the current to the $i$ th resistor comes from the virtual ground of the opamp; otherwise, it comes from ground. Therefore, we have

$$
\begin{align*}
V_{\text {out }} & =-R_{F} V_{\text {ref }}\left(-\frac{b_{1}}{2 R}-\frac{b_{2}}{4 R}-\frac{b_{3}}{8 R}-\ldots\right) \\
& =\left(\frac{R_{F}}{R} V_{\text {ref }}\right) B_{\text {in }} \tag{16.2}
\end{align*}
$$

where

$$
\begin{equation*}
B_{i n}=b_{1} 2^{-1}+b_{2} 2^{-2}+b_{3} 2^{-3}+\cdots \tag{16.3}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-029.jpg?height=567&width=1261&top_left_y=819&top_left_x=276)

Fig. 16.6 Using an SC gain amplifier to realize a signed output from a unipolar (positive) D/A converter output: $b_{1}$ high causes a negative output.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-029.jpg?height=501&width=1160&top_left_y=1546&top_left_x=299)

Fig. 16.7 Binary-weighted 4-bit resistor D/A converter.

Although this approach does not require many resistors or switches, it does have some disadvantages. The resistor and current ratios are on the order of $2^{\mathrm{N}}$, which may be large, depending on N . This large current ratio requires that the switches also be scaled so that equal voltage drops appear across them for widely varying current levels. Also, monotonicity is not guaranteed. Finally, this approach is prone to glitches for high-speed operation, as discussed on page 633.

### 16.2.2 Reduced-Resistance-Ratio Ladders

To reduce the large resistor ratios in a binary-weighted array, signals in portions of the array can be scaled by introducing a series resistor, as shown in Fig. 16.8. Here, note that the voltage node, $\mathrm{V}_{\mathrm{A}}$, is equal to one-fourth the reference voltage, $\mathrm{V}_{\text {ref }}$, as a result of inserting the series resistor of value $3 R$. Also note that an additional $4 R$ resistor was added (to ground) such that resistance seen to the right of the $3 R$ resistor equals R. Straightforward analysis shows that this converter has the same relationship to the binary digital signals as in the previous binary-weighted case, but with one-fourth the resistance ratio. Note, however, the current ratio has remained unchanged. Finally, note that, by repeating this procedure recursively to a binary-weighted ladder, one arrives at a structure commonly referred to as an $R$-2R ladder, described next.

### 16.2.3 R-2R-Based Converters

A very popular architecture for D/A converters uses R-2R ladders. These ladders are useful for realizing binaryweighted currents with a small number of components and with a resistance ratio of only 2 , independent of the number of bits, N .

Consider the R-2R ladder network shown in Fig. 16.9. Analysis gives

$$
\begin{gather*}
R_{4}^{\prime}=2 R \\
R_{4}=2 R \| 2 R=R  \tag{16.4}\\
R_{3}^{\prime}=R+R_{4}=2 R \\
R_{3}=2 R \| R_{3}^{\prime}=R
\end{gather*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-030.jpg?height=513&width=1273&top_left_y=1547&top_left_x=277)

Fig. 16.8 Reduced-resistance-ratio 4-bit D/A converter.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-031.jpg?height=332&width=937&top_left_y=181&top_left_x=429)

Fig. 16.9 R-2R resistance ladder.
and so on. Thus, $\mathbf{R}_{\mathbf{i}}^{\prime}=2 \mathrm{R}$ for all i . This result gives the following current relationships:

$$
\begin{equation*}
I_{1}=\frac{V_{\text {ref }}}{2 R} \tag{16.5}
\end{equation*}
$$

Also, the voltage at node 2 is one-half the voltage at node 1 , giving

$$
\begin{equation*}
I_{2}=\frac{V_{\text {ref }}}{4 R} \tag{16.6}
\end{equation*}
$$

At node 3, the voltage divides in half once again, therefore

$$
\begin{equation*}
I_{3}=\frac{V_{\text {ref }}}{8 R} \tag{16.7}
\end{equation*}
$$

and so on.
Thus, the R-2R ladder can be used to obtain binary-weighted currents while using only a single-size resistor. (The resistors of size $2 R$ are made out of two resistors of size R , to improve matching properties.) As a result, this R-2R approach usually gives both a smaller size and a better accuracy than a binary-sized approach.

A 4-bit D/A converter that uses an R-2R ladder is shown in Fig. 16.10. For this R-2R-based circuit, we see that

Key Point: $R$-2R ladder D/A converters produce binary-weighted currents without the need for a complete array of binary-weighted resistors. Instead, only 2:1 component ratios are needed, a significant savings for high-resolution converters.

$$
\begin{equation*}
I_{r}=V_{\text {ref }} /(2 R) \tag{16.8}
\end{equation*}
$$

and

$$
\begin{equation*}
V_{\text {out }}=R_{F} \sum_{i=1}^{N} \frac{b_{i} I_{r}}{2^{i-1}}=V_{\text {ref }}\left(\frac{R_{F}}{R}\right) \sum_{i=1}^{N} \frac{b_{i}}{2^{i}} \tag{16.9}
\end{equation*}
$$

However, as already mentioned, although the resistance ratio has been reduced, the current ratio through the switches is still large, and thus the switch sizes are usually scaled in size to accommodate the widely varying current levels. One approach to reduce this current ratio is shown in Fig. 16.11, where equal currents flow through all the switches. However, this configuration is typically slower since the internal nodes of the R-2R ladder now exhibit some voltage swings (as opposed to the configuration in Fig. 16.10 where internal nodes all remain at fixed voltages).
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-032.jpg?height=549&width=1366&top_left_y=198&top_left_x=214)

Fig. 16.10 4-bit R-2R based D/A converter.

### 16.2.4 Charge-Redistribution Switched-Capacitor Converters

Key Point: Charge-redistribution switchedcapacitor D/A converters sample a fixed reference voltage onto a binary-weighted capacitor array whose effective capacitance is determined by the input digital code. The sampled charge is then applied to a switched-capacitor gain stage to produce the analog output voltage.

The basic idea here is to simply replace the input capacitor of an SC gain amplifier by a programmable capacitor array (PCA) of binary-weighted capacitors, as shown in Fig. 16.12. As in the SC gain amplifier, the shown circuit is insensitive to opamp inputoffset voltage, 1/f noise, and finite-amplifier gain. Also, an additional sign bit can be realized by interchanging the clock phases (shown in parentheses) for the input switches.

It should be mentioned here that, as in the SC gain amplifier, carefully generated clock waveforms are required to minimize the voltage dependency of clock feed-through, and a deglitching capacitor should be used. Also, the digital codes should be changed only when the input side of the capacitors are connected to ground, and thus the switching time is dependent on the sign bit, which requires some extra digital complexity.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-032.jpg?height=481&width=907&top_left_y=1561&top_left_x=437)

Fig. 16.11 R-2R ladder D/A converter with equal currents through the switches.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-033.jpg?height=583&width=1252&top_left_y=179&top_left_x=267)

Fig. 16.12 Binary-array charge-redistribution D/A converter.

### 16.2.5 Current-Mode Converters

Current-mode D/A converters are very similar to resistor-based converters, but are intended for higher-speed applications. The basic idea is to switch currents to either the output or to ground, as shown in Fig. 16.13. Here, the output current is converted to a voltage through the use of $R_{F}$, and the upper portion of each current source always remains at ground potential. Implementations of current-mode D/A converters are more fully discussed in Section 16.3, where thermometer codes are introduced.

### 16.2.6 Glitches

Glitches are a major limitation during high-speed operation for converters that have digital logic, $\left\{\mathrm{b}_{1}, \mathrm{~b}_{2}, \ldots, \mathrm{~b}_{\mathrm{N}}\right\}$, directly related to switching signals. Glitches are mainly the result of different delays occurring when switching different signals. For example, when the digital input code changes from $0111 \ldots 1$ to $1000 \ldots 0$, all of the $\mathrm{N}-1$ LSBs turn off and the MSB turns on. However, it is possible that the currents due to the LSB switches will turn off slightly before the MSB current, causing the current to temporarily fall to zero. Alternatively, if the LSB switches
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-033.jpg?height=428&width=1161&top_left_y=1603&top_left_x=303)

Fig. 16.13 Binary-weighted current-mode D/A converter.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-034.jpg?height=520&width=1080&top_left_y=174&top_left_x=346)

Fig. 16.14 Glitches. $\mathrm{I}_{1}$ represents the MSB current, and $\mathrm{I}_{2}$ represents the sum of the $\mathrm{N}-1 \mathrm{LSB}$ currents. Here, the MSB current turns off slightly early, causing a glitch of zero current.
turn off slightly after the MSB current, the current will temporarily go to its maximum value. In either case, a glitch occurs at the output unless these two delays are exactly matched, which is highly unlikely since the branches have different currents. This glitch phenomenon is illustrated in Fig. 16.14.

The glitch disturbance can be reduced by limiting the bandwidth (by placing a capacitor across the resistor $R_{f}$ in Fig. 16.14), but this approach slows down the circuit. Another approach is to use a sample and hold on the output signal. Finally, the most popular way to reduce glitches is to modify some or all of the digital word from a binary code to a thermometer code, as discussed next.

## 16.3 THERMOMETER-CODE CONVERTERS

Key Point: Thermometer-code converters employ an array of $2 \mathrm{~N}-1$ unitary equallysized signal quantities. A digital thermometer code selects the appropriate number of these unitary signal quantities, summing them to produce the analog output with guaranteed monotonicity and better static linearity than binary-weighted converters.

Another method for realizing a $\mathrm{D} / \mathrm{A}$ converter is to digitally recode the input value to a thermometer-code equivalent. A thermometer code differs from a binary one in that a thermometer code has $2^{\mathrm{N}}-1$ digital inputs to represent $2^{\mathrm{N}}$ different digital values. Clearly, a thermometer code is not a minimal representation since a binary code requires only N digital inputs to represent $2^{\mathrm{N}}$ input values. However, as we will see, a thermometer-based converter does have advantages over its binary counterpart, such as low DNL errors, guaranteed monotonicity, and reduced glitching noise.

Typically, in a thermometer-code representation, the number of 1 s represents the decimal value. For example, with a 3-bit binary input, the decimal value 4 is binary coded as 100 while its thermometer equivalent is 0001111. The codes for the remaining values in this 3-bit example are shown in Table 16.1.

One method to realize a $\mathrm{D} / \mathrm{A}$ converter with the use of a thermometer-code input is to build $2^{\mathrm{N}}-1$ equal-sized resistors and switches attached to the virtual ground of an opamp, as shown in Fig. 16.15. Note that monotonicity is guaranteed here since, when the binary input changes to the next higher number, one more digital value in the thermometer code goes high, causing additional current to be drawn out of the virtual ground and forces the opamp output to go some amount higher (never lower). This is not necessarily the case for a binary-array D/A converter since mismatches between elements may cause the output to go lower even though the digital input value is increased.

Table 16.1 Thermometer-code representations for 3-bit binary values.

| Decimal | Binary |  |  | Thermometer Code |  |  |  |  |  |  |
| :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
|  | $b_{1}$ | $b_{2}$ | $b_{3}$ | $d_{1}$ | $\mathrm{d}_{2}$ | $d_{3}$ | $d_{4}$ | $d_{5}$ | $d_{6}$ | $\mathrm{d}_{7}$ |
| 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 1 | 0 | 0 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 1 |
| 2 | 0 | 1 | 0 | 0 | 0 | 0 | 0 | 0 | 1 | 1 |
| 3 | 0 | 1 | 1 | 0 | 0 | 0 | 0 | 1 | 1 | 1 |
| 4 | 1 | 0 | 0 | 0 | 0 | 0 | 1 | 1 | 1 | 1 |
| 5 | 1 | 0 | 1 | 0 | 0 | 1 | 1 | 1 | 1 | 1 |
| 6 | I | 1 | 0 | 0 | 1 | 1 | 1 | Âà∞ | 1 | 1 |
| 7 | 1 | 1 | 1 |  | 1 | 1 | Âà∞ | Âà∞ | 1 | 1 |

Perhaps more importantly, a D/A converter based on a thermometer code greatly minimizes glitches, as compared to binary-array approaches, since banks of resistors are never exchanged at slightly different times when the output should change by only 1 LSB. It should also be mentioned here that latches can be used in the binary-to-thermometer code conversion such that no glitches occur in the digital thermometer-code words and pipelining can be also used to maintain a high throughput speed.

It is also of interest to note that the use of a thermometer code does not increase the size of the analog circuitry compared to a binary-weighted approach. In a 3-bit binary-weighted approach, the resistor values of $R, 2 R$, and $4 R$ are needed for a total resistance of $7 R$. This total value is the same as for the 3 -bit thermom-eter-code approach shown in Fig. 16.15, and since resistors are created on an integrated circuit using area that is proportional to their size, each approach requires the same area (ignoring interconnect). The same argument can be used to show that the total area required by the transistor switches is the same since transistors are usually size-scaled in binary-weighted designs to account for the various current densities. All transistor switches in a thermometer-code approach are of equal sizes since they all pass equal currents. Finally, it should be mentioned that a thermometer-code charge-redistribution D/A can also be realized, as shown in Fig. 16.16.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-035.jpg?height=620&width=1243&top_left_y=1457&top_left_x=269)

Fig. 16.15 A 3-bit thermometer-based D/A converter.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-036.jpg?height=1348&width=1399&top_left_y=180&top_left_x=175)

Fig. 16.16 Thermometer-code charge-redistribution D/A converter.

### 16.3.1 Thermometer-Code Current-Mode D/A Converters

A thermometer-code-based current-mode D/A converter, shown in Fig. 16.17, has been the basis for a variety of designs (see, for example, [Miki, 1986; Chi, 1986; and Letham, 1987]). Here, thermometer-code decoders are used for both the row and column decoders, resulting in inherent monotonicity and good DNL errors. Current is switched to the output when both row and column lines for a cell are high. Also, in high-speed applications, the output feeds directly into an off-chip $50-\Omega$ or $75-\Omega$ resistor, rather than an output opamp. Note that cascode current sources are used here to reduce current-source variation due to voltage changes in the output signal, $\mathrm{V}_{\text {out }}$.

Note the need here for precisely timed edges of $\mathrm{d}_{\mathrm{i}}$ and $\overline{\mathrm{d}}_{\mathrm{i}}$. If both logic levels are high simultaneously, $\mathrm{V}_{\text {out }}$ is shorted to ground. If both logic levels are low at the same time, the drain of $Q_{3}$ is pulled low and the circuit
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-037.jpg?height=1113&width=1239&top_left_y=188&top_left_x=271)

Fig. 16.17 Thermometer-code current-mode D/A converter. $\mathrm{Q}_{1}$ and $\mathrm{Q}_{2}$ form the current switch, whereas $\mathrm{Q}_{3}$ and $\mathrm{Q}_{4}$ implement a cascode current source.
takes longer to respond. To avoid the use of two logic driving levels, the gate of $Q_{2}$ should be connected to a dc bias voltage, as described in the next approach.

### 16.3.2 Single-Supply Positive-Output Converters

The architecture for a fast single-supply positive-output D/A (often used in video RAMs, which are known as RAMDACs) is shown in Fig. 16.18 [Colles, 1988]. Here, a matched feedback loop is used to set up accurate known current-source biasing. (Note that the opamp input connections appear reversed but are correct due to signal inversion by $\mathrm{Q}_{4}$.) Also, to maintain accurate current matching that is independent of $\mathrm{V}_{\text {out }}$, one side of each differential current-steering pair is connected to $\mathrm{V}_{\text {bias }}$, rather than to the inversion of the bit signal. For example, when the current is steered to the output through $\mathrm{Q}_{2}$, the drain-source voltage across the current source, $\mathrm{Q}_{3}$, remains mostly constant if $\mathrm{V}_{\text {out }}$ stays near zero, such that $\mathrm{Q}_{2}$ remains in the active region. Thus, $\mathrm{Q}_{2}$ and $\mathrm{Q}_{3}$ effectively form a cascode current source when they drive current to the output.

To maximize speed in this converter, the voltage swing at the common connections of the current switches (for example, $Q_{1}, Q_{2}$, and $Q_{3}$ ) should be small. To keep this swing small, this common connection should be at a voltage where the output transistors are just turned off when the current is steered to ground. It should also be noted that when
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-038.jpg?height=624&width=1291&top_left_y=186&top_left_x=144)

Fig. 16.18 A single-supply positive-output D/A converter.
a switch is turning on or off, the switching feedthrough from the digital input connected to the grounding transistor (for example, $\mathbf{Q}_{1}$ ) actually enhances the switching. Finally, note that this design does not use two logic driving signals, $\mathrm{d}_{\mathrm{i}}$ and $\overline{\mathrm{d}}_{\mathrm{i}}$, and can therefore be clocked at the maximum rate without the need for precisely timed edges.

### 16.3.3 Dynamically Matched Current Sources

The use of dynamic techniques with current switching is a method for realizing very well-matched current sources (up to 16-bit accuracy) for audio-frequency D/A converters [Schouwenaars, 1988].

This approach was used to design a 16-bit audio-frequency D/A converter, where the 6 MSB were realized using a thermometer code. Since the accuracy requirements are reduced for the remaining bits, a binary array was used in their implementation. The basic idea for realizing 63 accurately matched current sources for the 6 MSBs is illustrated in Fig. 16.19. Here, we want to set all the currents $\mathrm{I}_{\mathrm{di}}$ to the same precise value, independent of transistor mismatches and charge injection. To accomplish this high degree of matching, each current source $\mathrm{I}_{\mathrm{di}}$ is periodically calibrated with the use of a single reference current source, $\mathrm{I}_{\mathrm{ref}}$, through the use of the shift register. In other words, once calibration is accomplished on $\mathrm{I}_{\mathrm{d} 1}$, the same current source, $\mathrm{I}_{\mathrm{ref}}$, is used to set the next current source, $\mathrm{I}_{\mathrm{d} 2}$, to the same value as $\mathrm{I}_{\mathrm{d} 1}$, and so on. Before proceeding to see how this calibration is accomplished, it is worth mentioning that the values of $\mathrm{I}_{\mathrm{di}}$ need not precisely equal $\mathrm{I}_{\mathrm{ref}}$ but do need to accurately match each other. Therefore, any common errors in the calibration stage are not a problem. Also, note that 64 current sources are calibrated, even though only 63 are required for the 6 MSB . This extra current source is needed so that the D/A converter can continuously operate, even when one of the current sources is being calibrated.

The method for calibrating and using one of the current sources is shown in Fig. 16.20, for $\mathrm{I}_{\mathrm{dl}}$. During calibration, the current source is connected to the reference current $I_{r e f}$, while $Q_{1}$ is configured in a diode-connected mode. This places whatever voltage is necessary across the parasitic $C_{g s}$ so that $I_{d 1}$ equals $I_{r e f}$. When $S_{1}$ is opened, $I_{d 1}$ remains nearly equal to $I_{r e t}$, assuming the drain-source voltage of $Q_{1}$ doesn't change and the clock feedthrough and charge injection of $S_{1}$ are small. During regular system use, the gate voltage (and therefore current) is determined by the voltage stored on the parasitic capacitance, $C_{g s}$.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-039.jpg?height=821&width=1237&top_left_y=197&top_left_x=281)

Fig. 16.19 Dynamically matching current sources for 6 MSB.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-039.jpg?height=606&width=590&top_left_y=1234&top_left_x=253)

Calibration
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-039.jpg?height=613&width=590&top_left_y=1230&top_left_x=945)

Regular usage

Fig. 16.20 Dynamically setting a current source, $\mathrm{I}_{\mathrm{d} 1}$.

Key Point: Selecting and summing current signals can provide high-speed $D / A$ conversion. Output-impedance enhancement techniques may be needed to ensure the currents remain constat with respect to variations in output voltage. Calibration may also be used to ensure matching.

A major limitation in matching the 64 current sources is due to the differences in clock feedthrough and charge injection of the switches $\mathrm{S}_{\mathrm{i}}$. Since mismatches will always exist between different switches, the best way to keep all current sources equal is to minimize the total amount of clock feedthrough and charge injection. These nonideal effects can be minimized by having the capacitance $\mathrm{C}_{\mathrm{gs}}$ and bias voltage $\mathrm{V}_{\mathrm{GS}}$ large. ( A large $\mathrm{V}_{\mathrm{Gs}}$ voltage implies that any voltage difference will cause a smaller percentage current deviation.) To accomplish these requirements, the current source $0.9 \mathrm{I}_{\text {ref }}$ was added in parallel to $\mathrm{Q}_{1}$, so that $\mathrm{Q}_{1}$ needs only to source a current near $0.1 \mathrm{I}_{\mathrm{ref}}$. With such an arrangement, a large, low-transconductance device can be used (a $\mathrm{W} / \mathrm{L}=1 / 8 \mathrm{might}$ be used).

Finally, each current source must be recalibrated before the leakage currents (on the order of $10 \mathrm{pA} / \mu \mathrm{m}^{2}$ of junction area) on $\mathrm{C}_{\mathrm{gs}}$ cause the current source to deviate by 0.5 LSB . Fortunately, having a large $\mathrm{C}_{\mathrm{GS}}$ and $\mathrm{V}_{\mathrm{GS}}$ has the added benefit of extending this calibration interval (every 1.7 ms in [Schouwenaars, 1988]).

Many other additional details are described in [Schouwenaars, 1988]. For example, during calibration, a p -channel-input common-gate amplifier is added to the diode-connected loop. This is typically done in dynamic switched-current circuits to control the drain-source voltage of $Q_{1}$ (i.e., to keep it constant independent of the actual current and to keep it matched to its value during regular use) and to speed up the circuit by decreasing the effect of parasitic capacitances on the large $I_{\text {ref }}$ bus. Also, dummy switches are connected to $S_{1}$ to help minimize clock feedthrough by partially cancelling the charge injected.

## 16.4 HYBRID CONVERTERS

Key Point: A hybrid converter combines different D/A architectures to realize different portions of the converter design.

Combining the techniques discussed in Sections 16.1-16.3 for realizing different portions of a D/A converter results in hybrid designs. Hybrid designs are an extremely popular approach for designing converters because they combine the advantages of different approaches. For example, it is quite common to use a thermometer-code approach for the top few MSBs while using a binary-scaled technique for the lower LSBs. In this way, glitching is significantly reduced and accuracy is high for the MSB where it is needed most. However, in the LSBs where glitching and accuracy requirements are much reduced, valuable circuit area is saved with a binary-scaled approach. This section discusses some useful hybrid designs.

### 16.4.1 Resistor-Capacitor Hybrid Converters

It is possible to combine tapped resistor strings with switched-capacitor techniques in a number of different ways. In one approach, an SC binary-weighted D/A converter has its capacitors connected to adjacent nodes of a resistorstring D/A converter, as shown in Fig. 16.21 [Yang, 1989]. Here, the top 7 bits determine which pair of voltages across a single resistor is passed on to the 8 -bit capacitor array. For example, if the top 7 bits are 0000001, then switches $S_{1}$ and $S_{2}$ would be closed, while the other $S_{i}$ switches would remain open. The capacitor array then performs an 8 -bit interpolation between the pair of voltages by connecting the capacitors associated with a 1 to the higher voltage and the capacitors associated with a 0 to the lower voltage. This approach gives guaranteed monotonicity, assuming the capacitor array is accurate to only 8 bits. The converter in [Yang, 1989] has 15-bit monotonicity, without trimming, and 100-kHz sampling frequencies for a very-low-power $10-\mathrm{mW}$ realization.

### 16.4.2 Segmented Converters

The segmented D/A converter is a popular example of a hybrid converter [Schoeff, 1979; Grebene, 1984; Schouwenaars, 1988]. A 6-bit segmented D/A converter is shown in Fig. 16.22. In this approach, the two MSB currents are
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-041.jpg?height=1558&width=1409&top_left_y=212&top_left_x=186)

Fig. 16.21 One example of a 15-bit resistor-capacitor hybrid D/A converter.
obtained in one segment from three equal current sources using thermometer coding. High bits are switched to the output, whereas low bits are switched to ground. As discussed in Section 16.3, the use of a thermometer code for the MSB currents greatly minimizes glitches. For the four LSBs, one additional current source from the MSB segment is diverted where it is divided into binary-weighted currents, which are also switched to either ground or the output. Although this four-LSB segment is not guaranteed to be monotonic, its accuracy requirements are very relaxed, since it is used only for the LSBs.
![](https://cdn.mathpix.com/cropped/2024_11_07_e169e965a17846596f50g-042.jpg?height=1081&width=1438&top_left_y=181&top_left_x=176)

Fig. 16.22 A 6-bit segmented D/A converter.

## 16.5 KEY POINTS

- Decoder-based D/A converters operate by creating a set of analog reference levels and selecting one by turning on appropriate switches selected by an input digital code. [p. 623]
- Binary-scaled D/A converters combine binary-weighted circuit quantities (currents, resistors, capacitors, etc.) under digital control to realize an analog quantity. Such techniques are generally hardware-efficient, but can be subject to significant nonlinearities. [p. 628]
- R-2R ladder D/A converters produce binary-weighted currents without the need for a complete array of binaryweighted resistors. Instead, only 2:1 component ratios are needed, a significant savings for high-resolution converters. [p. 631]
- Charge-redistribution switched-capacitor D/A converters sample a fixed reference voltage onto a binaryweighted capacitor array whose effective capacitance is determined by the input digital code. The sampled charge is then applied to a switched-capacitor gain stage to produce the analog output voltage. [p. 632]
- Thermometer-code converters employ an array of $2 \mathrm{~N}-1$ unitary equally-sized signal quantities. A digital thermometer code selects the appropriate number of these unitary signal quantities, summing them to produce the analog output with guaranteed monotonicity and better static linearity than binary-weighted converters. [p. 634]
- Selecting and summing current signals can provide high-speed D/A conversion. Output-impedance enhancement techniques may be needed to ensure the currents remain constat with respect to variations in output voltage. Calibration may also be used to ensure matching. [p. 640]
- A hybrid converter combines different D/A architectures to realize different portions of the converter design. [p. 640]
