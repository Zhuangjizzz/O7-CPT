# 7. Biasing, References, and Regulators

Although often ignored during the course of first-pass analog design, a critical factor in determining a circuit's overall performance is the quality of the dc voltage and current sources. This chapter covers the design of circuits used to establish those dc voltages or currents. They are, themselves, sophisticated analog circuits usually employing feedback.

## 7.1 ANALOG INTEGRATED CIRCUIT BIASING

In an analog integrated circuit, many subcircuits work together to generate all of the various dc voltages and currents. These include bias circuits, reference circuits, and regulators. A bias circuit generates the dc voltages required to keep transistors near some desired operating point; of course, as transistor parameters change, either from chip to chip or with changes in temperature, so must the bias voltages. A reference circuit generates a voltage and/or current of a known fixed absolute value (for example, one volt). Finally, a regulator circuit improves the quality of a dc voltage or current, usually decreasing the noise. Fig. 7.1 shows how these circuits may work together to support the analog circuits on a large mixed analog-digital chip.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-002.jpg?height=599&width=1271&top_left_y=1303&top_left_x=248)

Fig. 7.1 A large mixed analog-digital integrated circuit emphasizing the role of biasing, references, and regulators.

### 7.1.1 Bias Circuits

Generally, the objective of a bias circuit is to ensure that the dc operating points of the transistors in an analog circuit remain within a desired range. Unlike a reference circuit, this means that the dc outputs of a bias circuit may adjust to process and temperature variations. Several approaches may be taken towards biasing. One is to ensure that circuits are biased to permit constant voltage swings; another is to ensure that constant currents are maintained; yet another is to try to ensure constant gain is maintained. These are

Key Point: A bias circuit generates the dc voltages required to keep transistors near some desired operating point; as transistor parameters change, either from chip to chip or with changes in temperature, so must the bias voltages.
illustrated in the following example.

#### EXAMPLE 7.1

Consider the simple NMOS differential pair in Fig. 7.2 biased, nominally, with $\mathrm{V}_{\text {eff, } 1}=200 \mathrm{mV}$ and $V_{t n}=450 \mathrm{mV}$. With a $10 \%$ decrease in both $\mu_{n} C_{o x}$ and $R$, and a $10 \%$ increase in $V_{t n}$, how must $V_{b}$ change to ensure: a) a constant drain current in the matched differential pair devices $Q_{2,3}$; b) a constant voltage drop across the resistors R ; c) a constant gain.

#### Solution

Assume all MOSFETs are in active mode and obeying a simple square-law voltage-current relationship. Before the $10 \%$ changes, $\mathrm{V}_{\mathrm{b}}=\mathrm{V}_{\mathrm{tn}}+\mathrm{V}_{\text {eff, } 1}=650 \mathrm{mV}$.
a) The drain currents of $Q_{2,3}$ are one-half the drain current in $Q_{1}$,

$$
\mathrm{I}_{\mathrm{D} 1}=\frac{1}{2} \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}\left(\frac{\mathrm{~W}}{\mathrm{~L}}\right)\left(\mathrm{V}_{\mathrm{b}}-\mathrm{V}_{\mathrm{tn}}\right)^{2}
$$

Hence, to maintain a constant drain current the gate voltage $\mathrm{V}_{\mathrm{b}}$ will have to increase 45 mV along with $\mathrm{V}_{\mathrm{tn}}$. In addition, the effective gate-source voltage $\mathrm{V}_{\text {eff, } 1}=\mathrm{V}_{\mathrm{b}}-\mathrm{V}_{\mathrm{tn}}$ must change in inverse proportion to changes in $\sqrt{\mu_{n} C_{o x}}$. However, $R$ has only secondary effects on drain current, so little if any change is required in $V_{b}$ in response to small changes in $R$. Therefore,

$$
\mathrm{V}_{\mathrm{b}}=\mathrm{V}_{\mathrm{tn}}+\mathrm{V}_{\mathrm{eff}, 1}=1.1(450 \mathrm{mV})+(200 \mathrm{mV}) /(\sqrt{0.9})=706 \mathrm{mV}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-003.jpg?height=538&width=613&top_left_y=1553&top_left_x=566)

Fig. 7.2 NMOS differential pair biased by a simple current source.
b) The voltage drop across $R$ is given by $I_{D 1} R / 2$. In addition to the dependencies described in part (a) above, keeping the voltage drop constant will require the drain current, and hence $\left(V_{b}-V_{t n}\right)$, to change in inverse proportion to changes in R. Therefore,

$$
\mathrm{V}_{\mathrm{b}}=1.1(450 \mathrm{mV})+(200 \mathrm{mV}) /(0.9 \sqrt{0.9})=729 \mathrm{mV}
$$

c) The small-signal gain of the differential pair is $g_{m 2} R$ where it may be shown that

$$
g_{m 2} \propto \mu_{n} C_{o x}\left(V_{b}-V_{t n}\right)
$$

Hence, as in parts (a) and (b), keeping the gain constant demands that $\mathrm{V}_{\mathrm{b}}$ change in direct proportion to any changes in $\mathrm{V}_{\mathrm{tn}}$. Moreover, $\mathrm{V}_{\text {eff, } 1}=\mathrm{V}_{\mathrm{b}}-\mathrm{V}_{\mathrm{tn}}$ must change in inverse proportion to changes in $\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}$ and R . Therefore,

$$
V_{b}=1.1(450 \mathrm{mV})+(200 \mathrm{mV}) /(0.9 \cdot 0.9)=742 \mathrm{mV}
$$

Example 7.1 illustrates the challenge of designing a good bias circuit which must somehow monitor multiple device parameters and automatically adjust multiple analog voltages to achieve a desired effect.

Since bias circuits only support other analog circuits by providing their dc voltages, their area and power consumption represents an overhead cost that a designer will want to minimize. Hence, one bias circuit is usually shared by several subcircuits. An important practical consideration is, therefore, how to distribute the bias circuit outputs without subjecting them to noise and inaccuracies due to component mismatches across the chip.

Most (or all) of a bias circuit's outputs will be the gate (or base) voltages used to bias current sources. When distributing these bias voltages, any devices that are required to operate as a current mirror should be placed within the same subcircuit in close physical proximity to one another to ensure good matching between those devices.

For example, consider the common scenario depicted in Fig. 7.3: a reference current, $\mathrm{I}_{\mathrm{b}}$, is available at one location on an integrated circuit and must be replicated at the drain of NMOS device $Q_{2}$ located at a great distance across the chip. Two methods for generating the gate voltage of $Q_{2}$ are shown. In Fig. 7.3(a), a simple NMOS current mirror is used and the mirror devices are separated by a long wire. In this scheme, the long wire carries zero current and it is hence referred to as "voltage-mode" bias distribution. Inevitable differences between the threshold voltages of $Q_{1}$ and $Q_{2}$, and even the ground potentials at their source and body terminals lead to considerable uncertainty in the resulting current $\mathrm{I}_{\mathrm{c}}$.

In Fig. 7.3(b), PMOS current mirror $Q_{3 / 4}$ is introduced to generate an intermediate current $I_{d}$ that is transmitted across the chip. Unlike Fig. 7.3(a), here the long wire carries a non-zero current making this a "currentmode" approach to bias distribution. It is preferred since both pairs of current mirror devices are co-located, so that their currents may be well-matched. Naturally, the simple current mirrors in Fig. 7.3 may be replaced by high output impedance variants to improve their accuracy, but the basic advantage of current-mode bias distribution remains. Current-mode distribution may consume more power and area than voltage-mode distribution due to the additional devices and bias current required. However, these minor disadvantages are ameliorated by recognizing that $Q_{1}$ and $Q_{3}$ in Fig. $7.3(b)$ can be made quite small and the current $I_{d}$ reduced so that the added power and area are minimal. ${ }^{1}$

Also note that Fig. 7.3(b) includes decoupling capacitors at the gates of all transistors. These are important to filter noise at those nodes and may be implemented as MOS capacitors. The decoupling capacitor is connected to

[^0]![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-005.jpg?height=892&width=1133&top_left_y=168&top_left_x=347)

Fig. 7.3 Two approaches to bias distribution: (a) voltage-mode (not recommended); (b) current-mode.
the positive supply, not ground, because its purpose is to maintain a constant gate-source voltage on $Q_{3}$ and $Q_{4}$. Hence, it is desirable for that gate voltage to track any noise on the positive supply, thereby maintaining a constant bias current $I_{d}$.

### 7.1.2 Reference Circuits

Known absolute values of voltage or current are most useful at the interface between integrated circuits, or between an integrated circuit and some other discrete component. For example, two integrated circuits may be required to interface with a signal swing of one volt. A reference voltage or current may sometimes be derived from the supply voltage, but the supply is not always controlled with sufficient accuracy in which case a ref-

Key Point: A reference circuit generates a voltage and/or current of a known fixed absolute value.
erence voltage or current must be produced by an integrated reference circuit. Unfortunately, although dimensionless quantities may be accurately controlled on integrated circuits (e.g., ratios of device sizes), there are very few dimensioned quantities that do not vary significantly from one integrated circuit to another, or with variations in temperature.

#### EXAMPLE 7.2

Transistor $Q_{1}$ in Fig. 7.4 has an aspect ratio of $W / L=10, \mu_{n} C_{0 x}=190 \mu \mathrm{~A} / \mathrm{V}^{2}$ and $\mathrm{V}_{\mathrm{tn}}=0.45 \mathrm{~V}$. Resistor $R=20 \mathrm{k} \Omega$ and $V_{D D}=1.5 \mathrm{~V}$. How much will $V_{o}$ change if the value of $\mu_{n} C_{o x}$ decreases by $30 \%, R$ decreases by $10 \%, \mathrm{~V}_{\mathrm{tn}}$ increases by 30 mV , and $\mathrm{V}_{\mathrm{DD}}$ increases by 100 mV ?
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-006.jpg?height=398&width=375&top_left_y=198&top_left_x=696)

Fig. 7.4 A simple circuit to establish a dc voltage at $V_{0}$.

#### Solution

Assuming a square-law model for $\mathrm{Q}_{1}$ and neglecting its finite output impedance to get an approximate answer, $\mathrm{V}_{\circ}$ may be found by solving the following equation.

$$
\begin{equation*}
\frac{V_{D D}-V_{0}}{R}=\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{o}-V_{t n}\right)^{2} \tag{7.1}
\end{equation*}
$$

Equation (7.1) is a quadratic in $V_{0}$ that has only one valid solution with $V_{0}>V_{t n}$.

$$
\begin{equation*}
\mathrm{V}_{\mathrm{o}}=\mathrm{V}_{\mathrm{tn}}+\frac{1}{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{~W} / \mathrm{L}) \mathrm{R}}\left[\sqrt{2\left(\mathrm{~V}_{\mathrm{DD}}-\mathrm{V}_{\mathrm{tn}}\right) \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{~W} / \mathrm{L}) \mathrm{R}+1}-1\right] \tag{7.2}
\end{equation*}
$$

Substituting the nominal values given above into (7.2) yields $\mathrm{V}_{0}=660 \mathrm{mV}$. Making the prescribed changes to the circuit parameters results in $\mathrm{V}_{\mathrm{o}}=747 \mathrm{mV}$. This represents an increase of $13 \%$ under variations that are quite typical.

The most widely used quantity for generating a reference of high accuracy in integrated circuits (on the order of $1 \%$ or better) has proven to be the bandgap of silicon. It is a constant whose value does not change with variations in temperature, dopant concentrations, or device dimensions. Circuits that produce a voltage proportional to the bandgap of silicon are described in Section 7.3.

### 7.1.3 Regulator Circuits

Key Point: A regulator circuit improves the quality of a dc voltage or current, usually decreasing the noise.

A regulator's main purpose is to produce a voltage which has low noise and from which some current may be drawn. They are common, for example, when a critical analog circuit must operate from the same supply voltage as other circuits. As shown in Fig. 7.5, the other circuits introduce significant noise onto the common supply, but a regulator can maintain a quiet supply for the critical circuitry. Digital circuits in particular are major sources of power supply noise, so regulators are common in mixed analog-digital systems.

The general approach is to use a feedback amplifier operating under the noisy supply to generate a quiet dc voltage that supplies the critical circuit. Hence, the regulated voltage is generally lower than the regulator's supply voltage. Important specifications are the immunity of the regulator's output to variations in supply voltage and in the load current.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-007.jpg?height=558&width=1483&top_left_y=178&top_left_x=156)

Fig. 7.5 A regulator maintains a quiet supply voltage for a critical analog circuit within a larger system having a noisy supply voltage.

## 7.2 ESTABLISHING CONSTANT TRANSCONDUCTANCE

### 7.2.1 Basic Constant-Transconductance Circuit

We have seen that transistor transconductances are perhaps the most important parameters in analog amplifiers that must be stabilized. This stabilization can be achieved by using a circuit approach first proposed in [Steininger, 1990] in which transistor transconductances are matched to the conductance of a resistor. As a result, to a firstorder effect, the transistor transconductances are independent of power-supply voltage as well as process and temperature variations.

The bias circuit is shown in Fig. 7.6. First it is assumed that $(\mathrm{W} / \mathrm{L})_{10}=(\mathrm{W} / \mathrm{L})_{11}$. This equality results in both sides of the circuit having the same current due to the current-mirror pair $Q_{10}, Q_{11}$. As a result, we also must have $I_{D 15}=I_{D 13}$. Now, around the loop consisting of $Q_{13}, Q_{15}$, and $R_{B}$, we have

$$
\begin{equation*}
\mathrm{V}_{\mathrm{GS} 13}=\mathrm{V}_{\mathrm{GS} 15}+\mathrm{I}_{\mathrm{D} 15} \mathrm{R}_{\mathrm{B}} \tag{7.3}
\end{equation*}
$$

and recalling that $\mathrm{V}_{\text {effi }}=\mathrm{V}_{\mathrm{GSi}}-\mathrm{V}_{\mathrm{t}}$, we can subtract the threshold voltage, $V_{t}$, from both sides, resulting in

$$
\begin{equation*}
\mathrm{V}_{\mathrm{eff} 13}=\mathrm{V}_{\mathrm{eff} 15}+\mathrm{I}_{\mathrm{D} 15} \mathrm{R}_{\mathrm{B}} \tag{7.4}
\end{equation*}
$$

This equation can also be written as

$$
\begin{equation*}
\sqrt{\frac{2 \mathrm{I}_{\mathrm{D} 13}}{\mu_{\mathrm{n}} \mathrm{C}_{\text {ox }}(\mathrm{W} / \mathrm{L})_{13}}}=\sqrt{\frac{2 \mathrm{I}_{\mathrm{D} 15}}{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{~W} / \mathrm{L})_{15}}}+\mathrm{I}_{\mathrm{D} 15} \mathrm{R}_{\mathrm{B}} \tag{7.5}
\end{equation*}
$$

and since $I_{D 13}=I_{D 15}$, we can also write

$$
\begin{equation*}
\sqrt{\frac{2 \mathrm{I}_{\mathrm{D} 13}}{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{~W} / \mathrm{L})_{13}}}=\sqrt{\frac{2 \mathrm{I}_{\mathrm{D} 13}}{\mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{~W} / \mathrm{L})_{15}}}+\mathrm{I}_{\mathrm{D} 13} \mathrm{R}_{\mathrm{B}} \tag{7.6}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-007.jpg?height=629&width=412&top_left_y=1329&top_left_x=1207)

Fig. 7.6 A bias circuit that gives very predictable and stable transistor transconductances, especially for n-channel devices.

Rearranging, we obtain

$$
\begin{equation*}
\frac{2}{\sqrt{2 \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{~W} / \mathrm{L})_{13} \mathrm{I}_{\mathrm{D} 13}}}\left[1-\sqrt{\frac{\mathrm{W} / \mathrm{L}_{13}}{\mathrm{~W} / \mathrm{L}_{15}}}\right]=\mathrm{R}_{\mathrm{B}} \tag{7.7}
\end{equation*}
$$

and recalling that $\mathrm{g}_{\mathrm{m} 13}=\sqrt{2 \mu_{\mathrm{n}} \mathrm{C}_{\mathrm{ox}}(\mathrm{W} / \mathrm{L})_{13} \mathrm{I}_{\mathrm{D} 13}}$ results in the important relationship

$$
\begin{equation*}
\mathrm{g}_{\mathrm{m} 13}=\frac{2\left[1-\sqrt{\frac{(\mathrm{W} / \mathrm{L})_{13}}{(\mathrm{~W} / \mathrm{L})_{15}}}\right]}{\mathrm{R}_{\mathrm{B}}} \tag{7.8}
\end{equation*}
$$

Key Point: A constant-transconductance bias circuit produces a small-signal transconductance that is a fixed fraction of a resistor value, independent of process, temperature, or supply variations.

Thus, the transconductance of $Q_{13}$ is determined by $R_{B}$ and geometric ratios only, independent of power-supply voltages, process parameters, temperature, or any other parameters with large variability. For the special case of $(W / L)_{15}=4(W / L)_{13}$, we have simply

$$
\begin{equation*}
g_{m 13}=\frac{1}{R_{B}} \tag{7.9}
\end{equation*}
$$

Not only is $\mathrm{g}_{\mathrm{m} 13}$ stabilized, but all other transconductances are also stabilized since all transistor currents are derived from the same biasing network, and, therefore, the ratios of the currents are mainly dependent on geometry. For example, for all n-channel transistors,

$$
\begin{equation*}
g_{\mathrm{mi}}=\sqrt{\frac{(\mathrm{W} / \mathrm{L})_{\mathrm{i}} \mathrm{I}_{\mathrm{Di}}}{(\mathrm{~W} / \mathrm{L})_{13} \mathrm{I}_{\mathrm{D} 13}}} \times \mathrm{g}_{\mathrm{m} 13} \tag{7.10}
\end{equation*}
$$

and for all p -channel transistors

$$
\begin{equation*}
g_{m i}=\sqrt{\frac{\mu_{\mathrm{p}}}{\mu_{\mathrm{n}}(W / W / L)_{13} I_{D} I_{D 13}}} \times g_{m 13} \tag{7.11}
\end{equation*}
$$

Key Point: The constant-transconductance bias circuit ensures a constant transconductance in all transistors of the same type as $Q_{13}$. However, the transconductance of transistors of the opposite type will vary.

Since $g_{m 13}$ is an n-channel device, the additional term $\sqrt{\mu_{\mathrm{p}} / \mu_{\mathrm{n}}}$ appears in (7.11) modifying the transconductance of all p-channel devices. This, unfortunately, exhibits large variations from chip-to-chip and small variations with temperature.

The circuit in Fig. 7.6 forms a positive feedback loop, and stability is a significant concern. Transistor $Q_{11}$ acts as a common-source amplifier for any small signals appearing at its gate, having diode-connected $\mathrm{Q}_{13}$ as a load. The resulting signal then appears at the gate of $Q_{15}$, another common-source stage
stor. As long as $R_{B}$ is large enough, this second stage will have a gain much less with $R_{B}$ serving as a degeneration resistor. As long as $R_{B}$ is large enough, this second stage will have a gain much less than unity, ensuring stability of the loop. However, at high frequencies any parasitic capacitance across $R_{B}$ will reduce its impedance and tend to make the circuit unstable [Nicolson, 2004]. If $R_{B}$ is to be a precision off-chip resistor, the parasitic capacitances will be large including the chip pad and board. Therefore, it is usually necessary to implement at least part of the resistance $R_{B}$ on-chip. Unfortunately, on-chip resistances are relatively poorly controlled.

The preceding analysis has ignored many second-order effects such as the transistor output impedance and the body effect. The body effect will modify the equation slightly, but the relationship will still depend primarily on geometry alone. The major limitation is due to the transistor output impedance. Both effects can be mitigated using the modified circuit shown in Fig. 7.7. Here, the pair $Q_{14,15}$ is implemented with PMOS devices which in most CMOS processes permits connection to an independent body terminal. Connecting the source and body of $\mathrm{Q}_{15}$ together eliminates the body effect. Furthermore, an amplifier is used to maintain equal voltages at the transistor drain terminals, thus reducing the effect of finite transistor output impedance. Another advantage of the amplifier is that it reduces the impedance at the drain of $\mathrm{Q}_{15}$, which will reduce the gain around the positive feedback loop $Q_{12-15}$ and improve stability. The negative feedback loop comprising the amplifier and common-source transistors $Q_{12,13}$ may be stabilized by proper sizing of compensation capacitor $C_{C}$.

Unfortunately, both Fig. 7.6 and Fig. 7.7 have a second stable state where all the currents are zero. To guarantee this condition doesn't happen, it is necessary to add a start-up circuit that only affects the operation if all the currents are zero at start up.

A fundamental limitation of constant-transconductance biasing is that at high temperatures, the currents and effective gate-source voltages increase substantially to compensate for decreasing carrier mobility and keep the transconductances stable. This limits signal swings which is particularly problematic under low supply voltages. Since the carrier mobility is proportional to $\mathrm{T}^{-3 / 2}$, this corresponds to a 27 -percent reduction from room temperature ( 300 K ) to $100^{\circ} \mathrm{C}$ ( 373 K ). Thus, the effective gate-source voltages increase by 27 percent to keep the transistor transconductance unchanged since

$$
\begin{equation*}
g_{m i}=\mu_{i} C_{o x}\left(\frac{W}{L}\right)_{i} V_{\text {eff-i }} \tag{7.12}
\end{equation*}
$$

As long as the effective gate-source voltages have not initially been designed to be too large, this limitation is tolerable in most applications. ${ }^{2}$ A typical value for effective gate-source voltages might be 0.2 V to 0.25 V at room temperature.

### 7.2.2 Improved Constant-Transconductance Circuits

It is possible to incorporate wide-swing current mirrors into the constant-transconductance bias circuit described above. This modification greatly minimizes most of the detrimental second-order imperfections caused by the finite-output impedance of the transistors, without greatly restricting signal swings. The complete circuit is shown in Fig. 7.8 [McLaren, 2001]. This circuit is a modification of the circuit described in Fig. 7.6, and has both wide-swing current mirrors and a start-up circuit.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-009.jpg?height=702&width=433&top_left_y=158&top_left_x=1240)

Fig. 7.7 A modified bias circuit for giving predictable and stable transistor transconductances.

Key Point: Many bias circuits require auxiliary start-up circuits to prevent them from resting in a zerocurrent state indefinitely.

A constant-transconductance bias is provided by transistors $Q_{12-15}$, so that $g_{m 14}=1 / R_{B}$ as in Fig. 7.7. The resulting current is then mirrored to $Q_{1}$ and used to the generate the PMOS gate bias voltage $\mathrm{V}_{\text {bias-p }}$. Notice that the current density $I_{D} /(W / L)$ of $Q_{13}$ is five times greater than that of $Q_{4}$. Hence, the gate voltage of $Q_{13}$ is suitable for use as the PMOS cascode bias $\bigvee_{\text {casc-p }}$ Similarly, $Q_{3,4,6,7}$ form a wide-swing PMOS cascode current mirror that directs current into $Q_{5}$ with five times greater current density than in $Q_{1}$, so that the gate voltage $V_{G s}$ is a suitable NMOS cascode bias $\mathrm{V}_{\text {casc-n }}$.

An example of a start-up circuit is also shown on the right side of Fig. 7.8. In the event that all currents in the bias loop are zero, $Q_{9}$ will be off. Since $Q_{8}$ operates as a high-impedance load that is always on, the gates of $Q_{10,11}$ will be pulled low. These transistors then will inject currents into the bias loop, which will start up the circuit. Once the loop starts up, $Q_{9}$ will turn on, sourcing all of the current for $Q_{8}$, pulling the gates of $Q_{10,11}$ high, and thereby turning them off so they no longer affect the bias loop. This circuit is only one example of a start-up loop, and there are many other variations. For example, sometimes the n -channel transistor, $\mathrm{Q}_{8}$, is replaced by an actual resistor (perhaps realized using a well resistor).

It is of interest to note that the bias circuit shown consists of four different loops-the main loop with positive feedback, the start-up loop that eventually gets disabled, and the two loops used for establishing the bias voltages for the cascode transistors. These latter two loops also constitute positive feedback but with very little gain. Finally, note that the opamp included in the constant- $g_{m}$ bias loop may itself be biased by the loop.

[^1]![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-010.jpg?height=722&width=1211&top_left_y=194&top_left_x=159)

SPICE! Simulate this circuit with the provided netlist.

Fig. 7.8 A constant-transconductance bias circuit having wide-swing cascode current mirrors. Shown next to each device are reasonable choices for the device widths normalized to the width of $Q_{1}$ assuming equal gate lengths.

## 7.3 ESTABLISHING CONSTANT VOLTAGES AND CURRENTS

An important analog building block, especially in data acquisition systems, is a voltage reference. Ideally, this block will supply a fixed dc voltage of known amplitude that does not change with temperature. This can be combined with an accurate resistance to provide a stable dc current, if needed. There have been a number of approaches that have been taken to realize voltage references in integrated circuits. These include,

1. Making use of a zener diode that breaks down at a known voltage when reverse biased.
2. Making use of the difference in the threshold voltage between an enhancement transistor and a depletion transistor.
3. Cancelling the negative temperature dependence of a pn junction with a positive temperature dependence from a PTAT (proportional-to-absolute-temperature) circuit.
The first approach is no longer popular because the breakdown voltage of a zener diode is typically larger than the power supplies of modern integrated circuits. The second approach cannot be used when depletion transistors are not available, as is often the case. In addition, although it can be used to make quite stable references, the actual value of the reference is difficult to determine accurately because of the process sensitivity of the difference between the threshold voltage of an enhancement device and a depletion device. For these reasons, the first two approaches are not covered here. Rather, the last approach, which is currently the most popular for both bipolar and CMOS technologies, will be discussed. Voltage references based on the last approach are commonly called "bandgap" voltage references for reasons that will become apparent shortly.

### 7.3.1 Bandgap Voltage Reference Basics

As just mentioned, a bandgap voltage reference is based on subtracting the voltage of a forward-biased diode (or base-emitter junction) having a negative temperature coefficient from a voltage proportional to absolute temperature
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-011.jpg?height=389&width=844&top_left_y=178&top_left_x=496)

Fig. 7.9 A simplified circuit of a bandgap voltage reference.
(PTAT). As we shall see, this PTAT voltage is realized by amplifying the voltage difference of two forward-biased base-emitter (or diode) junctions. A bandgap voltage reference system is shown symbolically in Fig. 7.9.

A forward-biased base-emitter junction of a bipolar transistor ${ }^{3}$ has an I-V relationship given by

$$
\begin{equation*}
\mathrm{I}_{\mathrm{C}}=\mathrm{I}_{\mathrm{S}} \mathrm{e}^{\mathrm{qV} \mathrm{~V}_{\mathrm{BE}} / \mathrm{kT}} \tag{7.13}
\end{equation*}
$$

where $I_{S}$ is the transistor scale current and, although not shown, has a strong dependence on temperature.
Writing the base-emitter voltage as a function of collector current and temperature, it can be shown that [Brugler, 1967; Tsividis, 1980]

$$
\begin{equation*}
V_{B E}=V_{G 0}\left(1-\frac{T}{T_{0}}\right)+V_{B E 0} \frac{T}{T_{0}}+\frac{m k T}{q} \ln \left(\frac{T_{0}}{T}\right)+\frac{k T}{q} \ln \left(\frac{J_{C}}{J_{C 0}}\right) \tag{7.14}
\end{equation*}
$$

Here, $\mathrm{V}_{\mathrm{G} 0}$ is the bandgap voltage of silicon extrapolated to 0 K (approximately 1.206 V ), k is Boltzmann's constant, and m is a temperature constant approximately equal to 2.3 . Also, $\mathrm{J}_{\mathrm{c}}$ and T are the collector current density and temperature, respectively, while the subscript 0 designates an appropriate quantity at a reference temperature, $T_{0}$. Specifically, $J_{C 0}$ is the collector current density at the reference temperature, $T_{0}$, whereas $J_{C}$ is the collector current density at the true temperature, T . Also, $\mathrm{V}_{\mathrm{BE} 0}$ is the junction voltage at the reference temperature, $\mathrm{T}_{0}$, whereas $\mathrm{V}_{\mathrm{BE}}$ is the base-emitter junction voltage at the true temperature, T . Note that the junction current is related to the junction current density according to the relationship

$$
\begin{equation*}
\mathrm{I}_{\mathrm{C}}=\mathrm{A}_{\mathrm{E}} \mathrm{~J}_{\mathrm{C}} \tag{7.15}
\end{equation*}
$$

where $A_{E}$ is the effective area of the base-emitter junction. For $\mathrm{I}_{\mathrm{C}}$ constant, $\mathrm{V}_{\mathrm{BE}}$ will have approximately a $-2 \mathrm{mV} /{ }^{\circ} \mathrm{K}$ temperature dependence around room temperature. This negative temperature dependence is cancelled by a PTAT temperature dependence of the amplified difference of two base-emitter junctions biased at fixed but different current densities. Using (7.14), it is seen that if there are two base-emitter junctions biased at currents $J_{2}$ and $J_{1}$, then the difference in their junction voltages is given by

Key Point: An integrated voltage reference is made by adding the forward bias voltage of a pn junction to the difference in the forward voltages of two pn junctions biased at different current densities. Before adding them, these voltages are scaled so that their respective positive and negative temperature coefficients cancel precisely.

$$
\begin{equation*}
\Delta \mathrm{V}_{\mathrm{BE}}=\mathrm{V}_{2}-\mathrm{V}_{1}=\frac{\mathrm{kT}}{\mathrm{q}} \ln \left(\frac{\mathrm{~J}_{2}}{\mathrm{~J}_{1}}\right) \tag{7.16}
\end{equation*}
$$

Thus, the difference in the junction voltages is proportional to absolute temperature. This proportionality is quite accurate and holds even when the collector currents are temperature dependent, as long as their ratio remains fixed.

[^2]
#### EXAMPLE 7.3

Assume two transistors are biased at a current-density ratio of $10: 1$ at $\mathrm{T}=300 \mathrm{~K}$. What is the difference in their base-emitter voltages and what is its temperature dependence?

#### Solution

Using (7.16), we have

$$
\begin{equation*}
\Delta \mathrm{V}_{\mathrm{BE}}=\frac{\mathrm{kT}}{\mathrm{q}} \ln \left(\frac{\mathrm{~J}_{2}}{\mathrm{~J}_{1}}\right)=\frac{1.38 \times 10^{-23}(300)}{1.602 \times 10^{-19}} \ln (10)=59.5 \mathrm{mV} \tag{7.17}
\end{equation*}
$$

Since this voltage is proportional to absolute temperature, after a 1 K temperature increase, the voltage difference will be

$$
\begin{equation*}
\Delta \mathrm{V}_{\mathrm{BE}}=59.5 \mathrm{mV} \frac{301}{300}=59.7 \mathrm{mV} \tag{7.18}
\end{equation*}
$$

Thus, the voltage dependence is $59.5 \mathrm{mV} / 300 \mathrm{~K}$ or $0.198 \mathrm{mV} / \mathrm{K}$. Since the temperature dependence of a single $\mathrm{V}_{\mathrm{BE}}$ is $-2 \mathrm{mV} / \mathrm{K}$, if it is desired to cancel the temperature dependence of a single $\mathrm{V}_{\mathrm{BE}}$, then $\Delta \mathrm{V}_{\mathrm{BE}}$ should be amplified by about a factor of 10 , as explained next.

It will be seen shortly that when realizing a bandgap voltage reference, although the output voltage is temperature independent, the junction currents turn out to be proportional to absolute temperature (assuming the resistors used are temperature independent). Thus, to simplify derivations, we will first assume the junction currents are proportional to absolute temperature. Later, it will be verified that this proportionality relationship is true when circuit realizations are described. We therefore first assume

$$
\begin{equation*}
\frac{J_{i}}{J_{i 0}}=\frac{T}{T_{0}} \tag{7.19}
\end{equation*}
$$

where $J_{i}$ is the current density of the collector current of the $i^{\text {th }}$ transistor, whereas $J_{i 0}$ is the same current density at the reference temperature.

Now, assume that the difference between two base-emitter voltages is multiplied by a factor of K and added to the base-emitter voltage of the junction with the larger current density. Using (7.16) and (7.19) along with (7.14), we have

$$
\begin{align*}
\mathrm{V}_{\text {ref }} & =\mathrm{V}_{\mathrm{BE} 2}+\mathrm{K} \Delta \mathrm{~V}_{\mathrm{BE}} \\
& =\mathrm{V}_{\mathrm{G} 0}+\frac{\mathrm{T}}{\mathrm{~T}_{0}}\left(\mathrm{~V}_{\mathrm{BE}-2-2}-\mathrm{V}_{\mathrm{G} 0}\right)+(\mathrm{m}-1) \frac{\mathrm{kT}}{\mathrm{q}} \ln \left(\frac{\mathrm{~T}_{0}}{\mathrm{~T}}\right)+\mathrm{K} \frac{\mathrm{kT}}{\mathrm{q}} \ln \left(\frac{\mathrm{~J}_{2}}{\mathrm{~J}_{1}}\right) \tag{7.20}
\end{align*}
$$

Equation (7.20) is the fundamental equation giving the relationship between the output voltage of a bandgap voltage reference and temperature. Here, $\mathrm{V}_{\mathrm{BE0-2}}$ is the base-emitter junction voltage of the second transistor at temperature $\mathrm{T}_{0}$. If we want zero temperature dependence at a particular temperature, we can differentiate (7.20) with respect to temperature and set the derivative to zero at the desired reference temperature. From (7.20), we have

$$
\begin{equation*}
\frac{\partial \mathrm{V}_{\text {ref }}}{\partial \mathrm{T}}=\frac{1}{\mathrm{~T}_{0}}\left(\mathrm{~V}_{\mathrm{BE} 0-2}-\mathrm{V}_{\mathrm{G} 0}\right)+\mathrm{K} \frac{\mathrm{k}}{\mathrm{q}} \ln \left(\frac{\mathrm{~J}_{2}}{\mathrm{~J}_{1}}\right)+(\mathrm{m}-1) \frac{\mathrm{k}}{\mathrm{q}}\left[\ln \left(\frac{\mathrm{~T}_{0}}{\mathrm{~T}}\right)-1\right] \tag{7.21}
\end{equation*}
$$

Setting (7.21) equal to zero at $\mathrm{T}=\mathrm{T}_{0}$, we see that for zero temperature dependence at the reference temperature, we need

$$
\begin{equation*}
V_{B E 0-2}+K \frac{k T_{0}}{q} \ln \left(\frac{J_{2}}{J_{1}}\right)=V_{G 0}+(m-1) \frac{k T_{0}}{q} \tag{7.22}
\end{equation*}
$$

The left side of (7.22) is the output voltage $\mathrm{V}_{\text {ref }}$ at $\mathrm{T}=\mathrm{T}_{0}$ from (7.20). Thus for zero temperature dependence at $\mathrm{T}=\mathrm{T}_{0}$, we need

$$
\begin{equation*}
V_{\text {ref- } 0}=V_{G 0}+(m-1) \frac{\mathrm{kT}_{0}}{q} \tag{7.23}
\end{equation*}
$$

For the special case of $\mathrm{T}_{0}=300{ }^{\circ} \mathrm{K}$ and $\mathrm{m}=2.3$, (7.23) implies that

$$
\begin{equation*}
V_{\text {ref-0 }}=1.24 \mathrm{~V} \tag{7.24}
\end{equation*}
$$

for zero temperature dependence. Notice that this value is independent of the current densities chosen. Thus, if a larger current density is chosen, then K must be taken appropriately smaller to achieve the correct reference output voltage. In precision integrated voltage references, this correct output voltage is achieved by trimming at the time the wafer is being tested. From (7.22), the required value for K is

$$
\begin{equation*}
K=\frac{V_{\mathrm{G} 0}+(m-1) \frac{k T_{0}}{q}-V_{B E 0-2}}{\frac{k T_{0}}{q} \ln \left(\frac{J_{2}}{J_{1}}\right)}=\frac{1.24-V_{B E 0-2}}{0.0258 \ln \left(\frac{J_{2}}{J_{1}}\right)} \tag{7.25}
\end{equation*}
$$

at $300{ }^{\circ} \mathrm{K}$.
The reason for the name of the bandgap voltage should now be apparent. Specifically, for zero temperature dependence, the output of a bandgap voltage reference is given by the bandgap voltage plus a small correction term to account for second-order effects.

The output voltage of the reference for temperatures different from the reference is found after backsubstituting (7.22) and (7.23) into (7.20). After some manipulations, the result is

$$
\begin{equation*}
V_{\text {ref }}=V_{G 0}+(m-1) \frac{k T}{q}\left[1+\ln \left(\frac{T_{0}}{T}\right)\right] \tag{7.26}
\end{equation*}
$$

and

$$
\begin{equation*}
\frac{\partial V_{\text {ref }}}{\partial T}=(m-1) \frac{k}{q} \ln \left(\frac{T_{0}}{T}\right) \tag{7.27}
\end{equation*}
$$

These equations can be used to estimate the temperature dependence at temperatures different from the reference temperature. In the next section, a practical bipolar realization of a bandgap reference will be described.

#### EXAMPLE 7.4

Estimate the temperature dependence at $0^{\circ} \mathrm{C}$ for a bandgap voltage reference that was designed to have zero temperature dependence at $20^{\circ} \mathrm{C}$. Present the result as $\mathrm{ppm} / \mathrm{K}$.

#### Solution

Recalling that $0^{\circ} \mathrm{K}$ corresponds to $-273^{\circ} \mathrm{C}$, we can write $\mathrm{T}_{0}=293 \mathrm{~K}$ and $\mathrm{T}=273 \mathrm{~K}$. Substituting these values into (7.27), we have

$$
\begin{equation*}
\frac{\partial \mathrm{V}_{\mathrm{ref}}}{\partial \mathrm{~T}}=(2.3-1) \frac{1.38 \times 10^{-23}}{1.6 \times 10^{-19}} \ln \left(\frac{293}{273}\right)=8 \mu \mathrm{~V} / \mathrm{K} \tag{7.28}
\end{equation*}
$$

For a reference voltage of 1.24 V , a dependency of $8 \mu \mathrm{~V} / \mathrm{K}$ results in

$$
\begin{equation*}
\frac{8 \mu \mathrm{~V} /{ }^{\circ} \mathrm{K}}{1.24 \mathrm{~V}}=6.5 \times 10^{-6} \text { parts } /{ }^{\circ} \mathrm{K}=6.5 \mathrm{ppm} / \mathrm{K} \tag{7.29}
\end{equation*}
$$

where ppm represents parts per million. It should be mentioned here that practical effects result in voltage references with typically 4 to 10 times larger values than this small amount of temperature dependency. It should also be noted that the ideal first-order temperature dependence of this bandgap voltage circuit is $0 \mathrm{ppm} / \mathrm{K}$ at the reference temperature of $20^{\circ} \mathrm{C}$.

### 7.3.2 Circuits for Bandgap References

#### Bipolar Bandgap References

A voltage reference originally proposed in [Brokaw, 1974] has been the basis for many bipolar bandgap references. A simplified schematic of the circuit is shown in Fig. 7.10. The amplifier in the feedback loop keeps the collector voltages of $Q_{1}$ and $Q_{2}$ equal. Since $R_{3}=R_{4}$, this guarantees that both transistors have the same collector currents and collector-emitter voltages. Also, notice that the emitter area of $Q_{1}$ has been taken eight times larger than the emitter area of $Q_{2}$. Therefore, $Q_{2}$ has eight times the current density of $Q_{1}$, resulting in

$$
\begin{equation*}
\frac{J_{2}}{J_{1}}=8 \tag{7.30}
\end{equation*}
$$

We have for the circuit

$$
\begin{equation*}
V_{\text {ref }}=V_{B E 2}+V_{R 1} \tag{7.31}
\end{equation*}
$$

Also

$$
\begin{align*}
V_{\mathrm{R} 1} & =\mathrm{I}_{\mathrm{R} 1} \mathrm{R}_{1} \\
& =2 \mathrm{I}_{\mathrm{R}_{2}} \mathrm{R}_{1} \tag{7.32}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-014.jpg?height=668&width=734&top_left_y=1447&top_left_x=523)

Fig. 7.10 A simplified schematic of a bipolar bandgap voltage reference.

But

$$
\begin{equation*}
\mathrm{I}_{\mathrm{R} 2}=\frac{\mathrm{V}_{\mathrm{R} 2}}{\mathrm{R}_{2}}=\frac{\mathrm{V}_{\mathrm{BE} 2}-\mathrm{V}_{\mathrm{BE} 1}}{\mathrm{R}_{2}}=\frac{\Delta \mathrm{V}_{\mathrm{BE}}}{\mathrm{R}_{2}} \tag{7.33}
\end{equation*}
$$

Substituting (7.32) and (7.33) into (7.31) gives

$$
\begin{equation*}
\mathrm{V}_{\mathrm{ref}}=\mathrm{V}_{\mathrm{BE} 2}+\frac{2 \mathrm{R}_{1}}{\mathrm{R}_{2}} \Delta \mathrm{~V}_{\mathrm{BE}} \tag{7.34}
\end{equation*}
$$

which is of the form desired to realize a bandgap reference. It is immediately recognizable that

$$
\begin{equation*}
\mathrm{K}=\frac{2 \mathrm{R}_{1}}{\mathrm{R}_{2}} \tag{7.35}
\end{equation*}
$$

Assuming $\mathrm{V}_{\mathrm{BE2}-0}=0.65 \mathrm{~V}$, from (7.25)

$$
\begin{equation*}
\frac{\mathrm{R}_{1}}{\mathrm{R}_{2}}=\frac{1}{2} \times \frac{1.24-0.65}{0.0258 \times \ln (8)}=5.5 \tag{7.36}
\end{equation*}
$$

In an integrated implementation, $R_{1}$ or $R_{2}$ would be trimmed while monitoring $V_{\text {ref }}$ to force it equal to the desired reference voltage. Furthermore, the optimum value for this voltage might be determined empirically during the prototype phase of the design cycle.

Notice also, from (7.16) and (7.33), we have

$$
\begin{equation*}
I_{E 1}=I_{E 2}=I_{R 2}=\frac{\Delta V_{B E}}{R_{2}}=\frac{\frac{k T}{q} \ln \left(\frac{J_{2}}{J_{1}}\right)}{R_{2}} \tag{7.37}
\end{equation*}
$$

implying that all currents are proportional to absolute temperature (assuming that resistor $\mathrm{R}_{2}$ is temperature independent). Thus, as assumed earlier, all currents are indeed PTAT. It is worth mentioning here that PTAT currents are often used to bias many bipolar circuits, as they result in transistor transconductances being independent of temperature. This constant transconductance has the desirable feature that circuit speed is relatively independent of temperature, but, unfortunately, has the undesirable feature that the circuit power dissipation goes up considerably at high temperatures, which makes it more difficult to dissipate the heat.

In applications where it is desirable to have reference voltages larger than 1.24 V , a modified bandgap reference as shown in Fig. 7.11 can be used. It is not difficult to show that the output voltage is now given by

$$
\begin{equation*}
V_{\text {ref-0 }}=\left(1+\frac{\mathrm{R}_{4}}{\mathrm{R}_{5}}\right)\left[\mathrm{V}_{\mathrm{G} 0}+(\mathrm{m}-1) \frac{\mathrm{k} T_{0}}{\mathrm{q}}\right] \cong\left(1+\frac{\mathrm{R}_{4}}{\mathrm{R}_{5}}\right) 1.24 \mathrm{~V} \tag{7.38}
\end{equation*}
$$

Resistor $R_{3}$ has been added to cancel the effects of the finite base currents going through $R_{4}$ and should be chosen according to the formula in the figure. The interested reader is referred to [Brokaw, 1974] for additional details concerning this realization.

#### CMOS Bandgap References

The most popular method for realizing CMOS voltage references also makes use of a bandgap voltage reference despite the fact that independent bipolar transistors are not available. These CMOS circuits rely on using what are commonly called well transistors. These devices are vertical bipolar transistors that use wells as their bases and the substrate as their collectors. In an n well process (a common modern process), these vertical bipolar transistors are

Key Point: The implementation of bandgap references in a CMOS process makes use of bipolar transistors formed using doped well regions in the silicon substrate.
pnp types with their collectors connected to ground, as shown in Fig. 7.12(a). In a p-well process, they would be npn transistors with their collectors connected to the positive power supply, as
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-016.jpg?height=583&width=896&top_left_y=181&top_left_x=470)

Fig. 7.11 A bipolar bandgap with output voltages greater than 1.24 V .
shown in Fig. 7.12(b). These transistors have reasonable current gains, but their main limitation is the series base resistance, which can be high due to the large lateral dimensions between the base contact and the effective emitter region. To minimize errors due to this base resistance, the maximum collector currents through the transistors are usually constrained to be less than 0.1 mA . It is possible to use these transistors to implement bandgap voltage references using configurations similar to those shown in Fig. 7.13(a) for n-well processes [Kujik, 1973] or Fig. 7.13(b) for p-well processes [Ye, 1982].

With respect to the n-well implementation of Fig. 7.13(a), we have

$$
\begin{equation*}
V_{\text {ref }}=V_{E B 1}+V_{R 1} \tag{7.39}
\end{equation*}
$$

Also, assuming the opamp has large gain and that its input terminals are at the same voltage, then

$$
\begin{equation*}
V_{R 2}=V_{E B 1}-V_{E B 2}=\Delta V_{E B} \tag{7.40}
\end{equation*}
$$

Now, since the current through $R_{3}$ is the same as the current through $R_{2}$, we have

$$
\begin{equation*}
\mathrm{V}_{\mathrm{R} 3}=\frac{\mathrm{R}_{3}}{\mathrm{R}_{2}} \mathrm{~V}_{\mathrm{R} 2}=\frac{\mathrm{R}_{3}}{\mathrm{R}_{2}} \Delta \mathrm{~V}_{\mathrm{EB}} \tag{7.41}
\end{equation*}
$$

using (7.40). The opamp feedback also makes the voltage across $R_{1}$ equal to the voltage across $R_{3}$. Using this fact and substituting (7.41) into (7.39) results in

$$
\begin{equation*}
V_{\text {ref }}=V_{E B 1}+\frac{R_{3}}{R_{2}} \Delta V_{E B} \tag{7.42}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-016.jpg?height=348&width=1037&top_left_y=1748&top_left_x=374)

Fig. 7.12 Vertical CMOS well transistors realized in (a) an n-well process and (b) a p-well process.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-017.jpg?height=497&width=560&top_left_y=144&top_left_x=309)
(a)
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-017.jpg?height=537&width=613&top_left_y=140&top_left_x=853)

Fig. 7.13 Bandgap voltage references implemented with well transistors in (a) an n-well CMOS process, and (b) a p-well CMOS process.
which is in the required form to realize a bandgap reference. In integrated realizations of this reference, the bipolar transistors are often taken the same size, and the different current-densities are realized by taking $\mathrm{R}_{3}$ greater than $R_{1}$, which causes $I_{1}$ to be larger than $I_{2}$. In this case, we would have

$$
\begin{equation*}
\frac{J_{1}}{J_{2}}=\frac{R_{3}}{R_{1}} \tag{7.43}
\end{equation*}
$$

since $R_{1}$ and $R_{3}$ have the same voltage across them. Also, recalling from (7.16) that

$$
\begin{equation*}
\Delta \mathrm{V}_{\mathrm{EB}}=\mathrm{V}_{\mathrm{EB} 1}-\mathrm{V}_{\mathrm{EB} 2}=\frac{\mathrm{kT}}{\mathrm{q}} \ln \left(\frac{\mathrm{~J}_{1}}{\mathrm{~J}_{2}}\right) \tag{7.44}
\end{equation*}
$$

and using (7.43) in (7.42) gives

$$
\begin{equation*}
V_{\text {ref }}=V_{E B 1}+\frac{R_{3}}{R_{2}} \frac{k T}{q} \ln \left(\frac{R_{3}}{R_{1}}\right) \tag{7.45}
\end{equation*}
$$

It is immediately recognizable that

$$
\begin{equation*}
\mathrm{K}=\frac{\mathrm{R}_{3}}{\mathrm{R}_{2}} \tag{7.46}
\end{equation*}
$$

#### EXAMPLE 7.5

Find the resistances of a bandgap voltage reference based on Fig. $7.13(a)$, where $I_{1}=80 \mu \mathrm{~A}, I_{2}=8 \mu \mathrm{~A}$, and $\mathrm{V}_{\mathrm{EB} 1-0}=0.65 \mathrm{~V}$ at $\mathrm{T}=300 \mathrm{~K}$.

#### Solution

Recalling from (7.24) that

$$
\begin{equation*}
V_{\text {ref-0 }}=1.24 \mathrm{~V} \tag{7.47}
\end{equation*}
$$

therefore, from (7.39), we require

$$
\begin{equation*}
\mathrm{V}_{\mathrm{R} 1}=\mathrm{V}_{\text {ref- }-0}-\mathrm{V}_{\mathrm{EB} 1-0}=0.59 \mathrm{~V} \tag{7.48}
\end{equation*}
$$

Also, since $\mathrm{V}_{\mathrm{R} 3}=\mathrm{V}_{\mathrm{R} 1}$, we have

$$
\begin{equation*}
\mathrm{R}_{3}=\frac{\mathrm{V}_{\mathrm{R} 3}}{\mathrm{I}_{2}}=\frac{0.59 \mathrm{~V}}{8 \mu \mathrm{~A}}=73.8 \mathrm{k} \Omega \tag{7.49}
\end{equation*}
$$

and

$$
\begin{equation*}
\mathrm{R}_{1}=\mathrm{R}_{3} \frac{\mathrm{I}_{2}}{\mathrm{I}_{1}}=7.38 \mathrm{k} \Omega \tag{7.50}
\end{equation*}
$$

Now, recalling from (7.26) that

$$
\begin{equation*}
\mathrm{K}=\frac{1.24-0.65 \mathrm{~V}}{0.0258 \times \ln (10)}=9.93 \tag{7.51}
\end{equation*}
$$

therefore

$$
\begin{equation*}
\mathrm{R}_{2}=\frac{\mathrm{R}_{3}}{\mathrm{~K}}=7.43 \mathrm{k} \Omega \tag{7.52}
\end{equation*}
$$

It is of interest to note here that using (7.44) and noting that $J_{1} / J_{2}=I_{1} / I_{2}$ (since the sizes of $Q_{1}$ and $Q_{2}$ are assumed to be the same), we find that

$$
\begin{equation*}
\Delta \mathrm{V}_{\mathrm{EB}}=\frac{\mathrm{kT}_{0}}{\mathrm{q}} \ln \left(\frac{\mathrm{I}_{1}}{\mathrm{I}_{2}}\right)=59 \mathrm{mV} \tag{7.53}
\end{equation*}
$$

gives the temperature dependence value of $0.198 \mathrm{mV} / \mathrm{K}$, as found in Example 7.3, which requires approximately a gain of 10 to cancel temperature dependency (actually 9.93 in this case).

The design equations for a voltage reference that is suitable for p -well processes and shown in Fig. 7.13(b) are essentially identical to those just given for the n -well reference.

In CMOS realizations of the references just described, the large value resistors are often realized by well resistors. Unfortunately, these resistors have a temperature dependence approximately given by [Michejda, 1984]

$$
\begin{equation*}
\mathrm{R}(\mathrm{~T})=\mathrm{R}_{0} \frac{\mathrm{~T}^{\eta}}{\mathrm{T}_{0}^{\eta}} \tag{7.54}
\end{equation*}
$$

where $\eta=2.2$. The errors caused by this temperature dependence can be eliminated by offsetting $\mathrm{V}_{\text {ref-0 }}$ slightly positive from the value given by (7.23) to

$$
\begin{equation*}
V_{\text {ref-0 }}=V_{G 0}+(m+\eta-1) \frac{k T_{0}}{q} \tag{7.55}
\end{equation*}
$$

Assuming the effects of the temperature coefficient of the resistors have been minimized, the next major source of error is often due to the input-offset voltage of the opamp [Michejda, 1984]. This results in an error term in the equation for $\Delta \mathrm{V}_{\mathrm{BE}}$ that is roughly equal to K times the input-offset voltage of the opamp. For example, a 1 mV offset error that is temperature independent causes a temperature coefficient (TC), error approximately given by [Song, 1983]

$$
\begin{equation*}
\mathrm{TC}_{\text {error }} \cong 26 \mathrm{ppm} /{ }^{\circ} \mathrm{C} \tag{7.56}
\end{equation*}
$$

One means of eliminating this source of error is to use switched-capacitor (SC) amplifiers that have input-offset compensation circuits [Song, 1983]. One possible SC-based voltage reference is shown in Fig. 7.14, where it makes use of an amplifier described in [Martin, 1987]. The amplifier shown results in a circuit having its output
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-019.jpg?height=718&width=954&top_left_y=143&top_left_x=418)

Fig. 7.14 An SC-based voltage reference that is insensitive to opamp input-offset voltages.
valid at all times and is less sensitive to finite opamp gain. A detailed explanation of how the amplifier shown in Fig. 7.14 operates is deferred until Chapter 14, where switched-capacitor circuits are discussed.

Assuming errors due to the input-offset voltage of the opamp have been minimized, there is still an inherent temperature dependence of the bandgap voltage reference, as we saw in (7.27). In addition, a further temperature dependence occurs because $\mathrm{V}_{\mathrm{G} 0}$ varies slightly with temperature (which has been ignored in the above analysis). Together, these two error sources limit the best achievable temperature coefficient to about $25 \mathrm{ppm} /{ }^{\circ} \mathrm{K}$. Minimizing these second-order effects is beyond the scope of this book, but the interested reader is referred to [Palmer, 1981; Meijer, 1982; Song, 1983] to see examples of how errors due to second-order effects have been minimized.

An alternative realization of a CMOS bandgap reference was reported in [Degrauwe, 1985], where lateral npn well transistors were used. Also, in [Tzanateas, 1979] a voltage reference was reported that was based on a realized PTAT voltage from the difference of the source-gate voltages of two MOS transistors biased in weak inversion. The interested reader can consult the references for details on these circuits.

### 7.3.3 Low-Voltage Bandgap Reference

A problem with the bandgap circuits described so far is that they are not compatible with supply voltages of 1.5 V or less. The fundamental problem is that all these circuits produce, in series, the inverse-PTAT voltage across a pn-junction and a PTAT voltage scaled to provide temperatureindependence. Together, these voltages exceed 1 V making it impossible to use these circuits with a 1-V supply. The solution is to instead sum currents: one inverse-PTAT and one PTAT, passing them through a resistor to form a temperature-insensitive reference voltage below 1 V .

A low-voltage bandgap circuit based on this idea is shown in Fig. 7.15 [Banba, 1999]. The feedback loop formed by the amplifier and current mirror $Q_{1} / Q_{2}$ ensures that the voltages at the drains of $Q_{1}$ and $Q_{2}$ are very well matched and equal to the forward voltage drop across diode $\mathrm{D}_{1}, \mathrm{~V}_{\mathrm{BE}, 1}$, which is inversely proportional to absolute temperature.

Key Point: Connecting PTAT and IPTAT voltages in series to produce a precision reference results in a voltage larger than the bandgap of silicon. To produce a bandgap reference under a lower supply voltage, it is necessary to first convert the PTAT and IPTAT quantities into currents, and then sum them by shunting.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-020.jpg?height=563&width=1156&top_left_y=182&top_left_x=246)

Fig. 7.15 A low-voltage bandgap circuit [Banba, 1999].
The voltage across $R_{b}$ is equal to the difference between the forward bias voltages of $D_{1}$ and $D_{2}, \Delta V_{B E}$, and is therefore PTAT. The current mirror and matched resistors $\mathrm{R}_{\mathrm{a}}$ ensure that the current through the diodes differs by the factor M , and that the diode current densities differ by a factor $M N$.

$$
\begin{equation*}
\Delta V_{B E}=\frac{k T}{q} \ln (\mathrm{MN}) \tag{7.57}
\end{equation*}
$$

The inverse PTAT $V_{B E, 1}$ and PTAT $\Delta V_{B E}$ are converted into the currents $I_{2 a}$ and $I_{2 b}$ by the resistors $R_{a}$ and $R_{b}$, respectively.

$$
\begin{align*}
\mathrm{I}_{2 \mathrm{a}} & =\frac{\mathrm{V}_{\mathrm{BE}, 1}}{\mathrm{R}_{\mathrm{a}}}  \tag{7.58}\\
\mathrm{I}_{2 \mathrm{~b}} & =\frac{\Delta \mathrm{V}_{\mathrm{BE}}}{\mathrm{R}_{\mathrm{b}}} \tag{7.59}
\end{align*}
$$

These two currents are summed at the drain of $Q_{2}$ and mirrored to device $Q_{3}$. The resulting current then passes back through resistor $R$ to yield the reference output.

$$
\begin{equation*}
\mathrm{V}_{\mathrm{ref}}=\mathrm{KI}_{2} \mathrm{R}=\mathrm{V}_{\mathrm{BE}, 1}\left(\frac{\mathrm{KR}}{\mathrm{R}_{\mathrm{a}}}\right)+\frac{\mathrm{kT}}{\mathrm{q}} \ln (\mathrm{MN})\left(\frac{\mathrm{KR}}{\mathrm{R}_{\mathrm{b}}}\right) \tag{7.60}
\end{equation*}
$$

The values $M, N, R_{a}$, and $R_{b}$ are chosen to ensure that the inverse temperature coefficient of the first term is precisely cancelled by the positive temperature coefficient of the second term. Notice that nowhere are there DC voltages exceeding $\mathrm{V}_{\mathrm{BE}}$, so this circuit has been used with supply voltages as low as 0.8 V . The values of K and R can be chosen to scale the actual value of the reference potential at $V_{\text {ref }}$, while the values of $N, R_{a}$ and $R_{b}$ are chosen to cancel the negative and positive temperature coefficients of the first and second terms in (7.60). Opamp offset and mismatch in the current mirror devices, diodes, and resistors are all sources of error.

### 7.3.4 Current Reference

Once a bandgap voltage has been established, it can be used in combination with a resistor to provide a reference current. The basic approach is illustrated in Fig. 7.16. Feedback is used to generate the PMOS gate voltage that results in a voltage drop of precisely $\mathrm{V}_{\text {ref }}$ across a resistor R . This gate voltage can then be used to generate a scaled copy of the resulting current, $\mathrm{I}_{\mathrm{ref}}=\mathrm{MV}_{\text {ref }} / \mathrm{R}$. If $R$ is an on-chip resistor, the reference current will vary
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-021.jpg?height=439&width=744&top_left_y=164&top_left_x=564)

Fig. 7.16 Obtaining a reference current from a voltage reference.
with the value of on-chip resistors. This may be desirable if the current is passing through another on-chip resistor matched to $R$, in which case the resulting voltage drop will be stable. If, however, an absolute current reference is required, a precision resistor may be realized either off-chip or by trimming $R$ and somehow compensating for its temperature variations.

## 7.4 VOLTAGE REGULATION

A voltage regulator produces a low-noise dc voltage from which some current can be drawn. Its primary use is to provide a quiet supply voltage to an analog circuit, particularly in environments when a noisy supply voltage will otherwise limit performance.

A basic voltage regulator is shown in Fig. 7.17. It accepts as input a reference voltage, $\mathrm{V}_{\text {ref }}$, and produces as output $\mathrm{V}_{\text {reg }}$. It is essentially a unity-gain feedback buffer. The amplifier provides gain in the loop which ensures $\mathrm{V}_{\text {reg }} \cong \mathrm{V}_{\text {ref }}$ while $\mathrm{Q}_{1}$, called the pass transistor, sources the load current. The reference input may be derived from a bandgap circuit, if it is to remain fixed over process and temperature variations. Variable-output regulators have a fixed reference voltage and incorporate a resistive voltage divider in the feedback

Key Point: A voltage regulator comprises a feedback loop that keeps an output voltage equal to a reference voltage by controlling the flow of current to the output through a passtransistor.
loop which is adjusted to effect change in the output voltage.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-021.jpg?height=629&width=951&top_left_y=1494&top_left_x=431)

Fig. 7.17 A basic voltage regulator.

### 7.4.1 Regulator Specifications

#### Power Supply Rejection

A regulator's ability to maintain a quiet voltage at $\bigvee_{\text {reg }}$ in the presence of noise on $V_{D D}$ is measured by superimposing a small signal onto $\mathrm{V}_{\mathrm{DD}}$ and measuring the resulting variations in $\mathrm{V}_{\text {reg }}$. The ratio of the two small signals $v_{d d}$ and $v_{\text {reg }}$ is its power supply rejection ratio which is usually expressed in decibels and is frequency-dependent.

$$
\begin{equation*}
\operatorname{PSRR}(\omega)=20 \log _{10}\left|\mathrm{~V}_{\mathrm{dd}} / \mathrm{v}_{\mathrm{reg}}\right| \mathrm{dB} \tag{7.61}
\end{equation*}
$$

Evaluated at dc, the inverse of supply rejection may be referred to as the line regulation.
Clearly the supply rejection of the reference generator and the opamp play important roles in the supply rejection of a regulator. For example, since $\mathrm{V}_{\text {reg }}$ will track $\mathrm{V}_{\text {ret }}$ within the feedback loop's bandwidth, low frequency supply rejection is often determined by the supply rejection of the reference generator.

#### Output Impedance

Variations in the current drawn by the regulator's load, $\mathrm{i}_{\mathrm{L}}$, will generally cause variations in $\mathrm{V}_{\text {reg }}$. If the changes are small, they are related by the regulator's small-signal output impedance, $Z_{\text {out }}$. At high frequencies, this will be determined by the impedance of the load capacitance, $1 / \mathrm{j} \omega \mathrm{C}_{\mathrm{L}}$. At low frequencies, it is determined by the impedance of the pass transistor $1 / \mathrm{g}_{\mathrm{m}, 1}$ divided by the opamp gain.

#### Dropout Voltage

An important specification of analog integrated circuit regulators is the maximum regulated voltage that can be maintained under a given global supply voltage, or equivalently the minimum voltage drop between the global supply and the regulated voltage, $\mathrm{V}_{\mathrm{DD}}-\mathrm{V}_{\text {reg }}$, called the dropout voltage, $\mathrm{V}_{\mathrm{DO}}$. Notice that the dc power dissipation in the transistor $Q_{1}$ is

$$
\begin{equation*}
P_{1}=\left(V_{D D}-V_{r e g}\right) i_{L} \tag{7.62}
\end{equation*}
$$

This power is not being delivered to the load, so it is a major inefficiency in the system. A lower limit on this power is imposed by the dropout voltage,

$$
\begin{equation*}
P_{1, \text { min }}=V_{D O} i_{L} \tag{7.63}
\end{equation*}
$$

motivating one to operate with $\left(V_{D D}-V_{\text {reg }}\right)$ near $V_{D O}$ and to minimize $V_{D O}$.
Looking at Fig. 7.17, clearly a voltage of $\mathrm{V}_{\text {eff, } 1}$ must be maintained between the drain and source of $Q_{1}$, otherwise the transconductance of $Q_{1}$ will drop, causing a decrease in loop gain and in the accuracy with which $\bigvee_{\text {reg }}$ tracks $\mathrm{V}_{\text {ref }}$. A more important consideration in determining the dropout voltage, however, is that $\mathrm{V}_{\text {reg }}$ must be below $\mathrm{V}_{1}$ by at least $\mathrm{V}_{\mathrm{GS}, 1}$. If the opamp is operated under the same supply voltage as $\mathrm{Q}_{1}$, and assuming the opamp output must be at least $\mathrm{V}_{\text {eff }}$ below $\mathrm{V}_{\mathrm{DD}}$ to prevent some device there from entering triode, the dropout voltage is at least $2 \mathrm{~V}_{\text {eff }}+\mathrm{V}_{\mathrm{tn}, 1}$. This quantity is not too large if native NMOS devices (having $\mathrm{V}_{\mathrm{tn}} \approx 0$ ) are available. Alternatively, in some cases the opamp is operated from a higher supply voltage.

### 7.4.2 Feedback Analysis

The open loop analysis of the voltage regulator with NMOS pass device in Fig. 7.17 is very similar to that of a basic source follower. Assuming a single-stage opamp with transconductance $G_{m a}$ and output resistance $R_{0 a}$, the loop is broken at the opamp's input and a test signal is injected, $v_{t}$. The resulting small-signal equivalent circuit is shown in Fig. 7.18. The regulator load is modeled by the small-signal resistance $R_{L}$ and combined with $r_{\text {ds1 }}$ and $1 / g_{s 1}$ to form $R_{L}{ }^{\prime}$. Applying the results from Chapter 4, the open-loop response is
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-023.jpg?height=469&width=1499&top_left_y=218&top_left_x=125)

Fig. 7.18 The open-loop small-signal schematic of a voltage regulator with NMOS pass device.

$$
\begin{equation*}
L(s)=\left(\frac{G_{m a} R_{o a} R_{L^{\prime}}}{R_{L^{\prime}}+1 / g_{m 1}}\right) \frac{\left(1+\frac{s C_{g s 1}}{g_{m 1}}\right)}{\left(1+\frac{s}{\omega_{0} Q}+\frac{s^{2}}{\omega_{0}^{2}}\right)} \tag{7.64}
\end{equation*}
$$

where

$$
\begin{gather*}
\omega_{0}=\sqrt{\frac{\left(1 / R_{o a}\right)\left(g_{m 1}+1 / R_{L}^{\prime}\right)}{C_{g s 1} C_{L}+C_{1}\left(C_{g s 1}+C_{L}\right)}}  \tag{7.65}\\
Q=\frac{\sqrt{\left(1 / R_{o a}\right)\left(g_{m 1}+1 / R_{L}\right)\left[C_{g s 1} C_{L}+C_{1}\left(C_{g s 1}+C_{\mathrm{L}}\right)\right]}}{C_{\mathrm{L}} / R_{o a}+C_{1}\left(g_{m 1}+1 / R_{o a}\right)+C_{g s 1} / R_{\mathrm{L}}^{\prime}} \tag{7.66}
\end{gather*}
$$

Assuming the loop is dominant-pole compensated, then Q 1 and the denominator (7.64) may be factored into two first-order terms.

$$
\begin{equation*}
L(s)=\left(\frac{G_{m a} R_{o a} R_{L}^{\prime}}{R_{L^{\prime}}^{\prime}+1 / g_{m 1}}\right) \frac{\left(1+\frac{s}{\omega_{z}}\right)}{\left(1+\frac{s}{\omega_{\mathrm{p} 1}}\right)\left(1+\frac{s}{\omega_{\mathrm{p} 2}}\right)} \tag{7.67}
\end{equation*}
$$

Hence, there are poles at

$$
\begin{align*}
& -\omega_{p 1}=-\omega_{0} Q=-\frac{\left(1 / R_{o a}\right)\left(g_{m 1}+1 / R_{L^{\prime}}\right)}{C_{\mathrm{L}} / R_{o a}+C_{1}\left(g_{m 1}+1 / R_{o a}\right)+C_{g s 1} / R_{L^{\prime}}}  \tag{7.68}\\
& -\omega_{\mathrm{p} 2}=-\frac{\omega_{0}}{\mathrm{Q}}=-\frac{\mathrm{C}_{\mathrm{L}} / \mathrm{R}_{\mathrm{oa}}+\mathrm{C}_{1}\left(\mathrm{~g}_{\mathrm{m} 1}+1 / \mathrm{R}_{\mathrm{oa}}\right)+\mathrm{C}_{\mathrm{g} 1} / \mathrm{R}_{\mathrm{L}}{ }^{\prime}}{\mathrm{C}_{\mathrm{gs} 1} \mathrm{C}_{\mathrm{L}}+\mathrm{C}_{1}\left(\mathrm{C}_{\mathrm{gs} 1}+\mathrm{C}_{\mathrm{L}}\right)} \tag{7.69}
\end{align*}
$$

and there is a zero due to the feedforward signal path through $\mathrm{C}_{\mathrm{gs} 1}$

$$
\begin{equation*}
-\omega_{z}=-g_{m 1} / C_{g s 1} \tag{7.70}
\end{equation*}
$$

There are two different ways to compensate the loop. If $\mathrm{C}_{1}$ is made large by including an additional compensation capacitor between $V_{1}$ and ground, $\mathrm{C}_{1} \mathrm{~g}_{\mathrm{m} 1}$ becomes the dominant term in the denominator of (7.68) and in the numerator of (7.69). As a result, the dominant pole $\omega_{\mathrm{p} 1} \approx 1 / R_{o \mathrm{a}} C_{1}$ is associated with the time constant at
$v_{1}$ and $\omega_{\mathrm{p} 2} \approx \mathrm{~g}_{\mathrm{m} 1} / C_{\mathrm{L}}$ is associated with the time constant at $\mathrm{v}_{\mathrm{reg}}$. In this case, a capacitor is still required at the output $C_{L}$ to filter high frequency noise on $v_{\text {reg }}$. Alternatively, $C_{L}$ can be made very large and $R_{o a}$ decreased so that $C_{L} / R_{o a}$ is a dominant term in both (7.68) and (7.69). In this case, the two poles change roles so that $\omega_{p 1}$ is the output pole and $\omega_{\mathrm{p} 2}$ is the pole at $\mathrm{v}_{1}$. This generally requires a larger compensation capacitor and/or higher power consumption in the opamp, but it provides a large capacitance at the output where it also improves supply rejection and output impedance at medium-to-high frequencies. Generally, $\omega_{z}$ will be at a much higher frequency than the poles and have little effect on stability.

### 7.4.3 Low Dropout Regulators

When the regulated output must be at a voltage only $200-400 \mathrm{mV}$ below $\mathrm{V}_{\mathrm{DD}}$, and especially when native (near-zero- $V_{t}$ ) NMOS devices are unavailable, it is necessary to utilize a PMOS device for $Q_{1}$ as shown in Fig. 7.19. In this case, the gate voltage $\mathrm{V}_{1}$ is well below $\mathrm{V}_{\mathrm{DD}}$ so the dropout voltage is only limited by $\mathrm{V}_{\text {eff, } 1}$. This is commonly referred to as a low dropout ( $L D O$ ) voltage regulator and is popular when power efficiency is critical. Notice that the polarity of the opamp's input terminals has been reversed because there is now negative small-signal gain from $V_{1}$ to $V_{\text {reg }}$. Although the resistance seen looking into $Q_{1}$ is increased compared with Fig. 7.17 from $1 / g_{m, 1}$ to $r_{d s, 1}$, the loop gain is also increased by roughly a factor $g_{m, 1} r_{d s, 1}$ so the regulator's closed-loop output resistance is roughly the same.

Key Point: Whereas an NMOS pass-transistor provides superior supply rejection, unless native NMOS devices are available, a PMOS pass-transistor permits a lower dropout voltage and, hence, better efficiency.

A significant drawback of PMOS devices is their reduced power supply rejection. With respect to small signals at $\mathrm{V}_{\mathrm{DD}}, \mathrm{Q}_{1}$ behaves like a commongate amplifier having considerable gain. At low frequencies, the feedback loop tracks and cancels the resulting variations in $\mathrm{V}_{\text {reg }}$, and at high frequencies the variations are filtered by $\mathrm{C}_{\mathrm{L}}$, but there is generally a mid-band frequency range where it is difficult to provide good supply rejection using a LDO.

The feedback analysis of a LDO is similar to that of a two-stage opamp, where the opamp in Fig. 7.19 is presumed to have only a single stage and the common-source pass transistor $Q_{1}$ provides the second gain stage. Neglecting $\mathrm{C}_{\mathrm{gd}}$, there are clearly two poles in the open loop response corresponding to the two nodes in the system.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-024.jpg?height=638&width=1017&top_left_y=1478&top_left_x=377)

Fig. 7.19 A low dropout (LDO) voltage regulator.

$$
\begin{equation*}
\mathrm{L}(\mathrm{~s})=\frac{\mathrm{G}_{\mathrm{ma}} \mathrm{R}_{\mathrm{oa}} \mathrm{~g}_{\mathrm{m} 1} \mathrm{R}_{\mathrm{L}^{\prime}}}{\left(1+\frac{\mathrm{s}}{\omega_{\mathrm{pa}}}\right)\left(1+\frac{\mathrm{s}}{\omega_{\mathrm{pL}}}\right)} \tag{7.71}
\end{equation*}
$$

The pole at the amplifier output (gate of $Q_{1}$ ) is

$$
\begin{equation*}
\omega_{\mathrm{pa}}=\frac{1}{\mathrm{R}_{\mathrm{oa}} \mathrm{C}_{\mathrm{l}^{\prime}}} \tag{7.72}
\end{equation*}
$$

where $\mathrm{C}_{1}{ }^{\prime}=\mathrm{C}_{1}+\mathrm{C}_{\mathrm{gs} 1}$, and the output pole is

$$
\begin{equation*}
\omega_{\mathrm{pL}}=\frac{1}{\mathrm{R}_{\mathrm{L}} \mathrm{C}_{\mathrm{L}}} \tag{7.73}
\end{equation*}
$$

Again, either pole can be made dominant to compensate the loop. A dominant output pole, $\omega_{\mathrm{pL}}$  $\omega_{\mathrm{pa}}$, requires high power consumption in the opamp to keep $R_{o a}$ low, but has the advantage of providing a low output impedance at medium frequencies which improves the supply rejection. This is particularly important in LDOs since the PMOS pass transistor tends to amplify supply noise as described above.

Key Point: Compensation of a voltage regulator presents a difficult decision: either make the output pole dominant, resulting in high power consumption in the feedback amplifier, or make the pass-transistor gate node dominant, in which case supply rejection is worse.

#### EXAMPLE 7.6

What is the supply rejection of the basic voltage regulator shown in Fig. 7.20?

#### Solution

A small-signal equivalent circuit is shown in Fig. 7.21 with a small-signal source shown at $\mathrm{V}_{\mathrm{DD}}$. With the loop open, the response from $V_{D D}$ to $V_{\text {reg }}$ is simply that of a common-gate amplifier loaded by $R_{L}| |\left(1 / s C_{L}\right)$.

$$
\begin{equation*}
\mathrm{H}_{\mathrm{CG}}(\mathrm{~s})=\left(\frac{\mathrm{R}_{\mathrm{L}}}{\mathrm{r}_{\mathrm{ds} 1}+\mathrm{R}_{\mathrm{L}}}\right) \frac{1}{1+s \mathrm{R}_{\mathrm{L}} \mathrm{C}_{\mathrm{L}}} \tag{7.74}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-025.jpg?height=479&width=1374&top_left_y=1603&top_left_x=178)

Fig. 7.20 The open-loop small-signal schematic of a LDO voltage regulator with a PMOS pass device.
![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-026.jpg?height=408&width=1430&top_left_y=182&top_left_x=178)

Fig. 7.21 The small-signal schematic of a basic voltage regulator.

With the loop closed, this first-order lowpass response is shaped by $1 /(1+\mathrm{L}(\mathrm{s}))$. The resulting frequency response from small signals on the supply voltage to small signals at the regulator output is the inverse of the power supply rejection

$$
\begin{equation*}
\frac{v_{\mathrm{reg}}}{v_{\mathrm{dd}}}(s)=\operatorname{PSRR}^{-1}(s)=\frac{H_{\mathrm{CG}}(s)}{1+\mathrm{L}(\mathrm{~s})} \tag{7.75}
\end{equation*}
$$

The responses are plotted in Fig. 7.22 for two cases: where the load pole $\omega_{\mathrm{pL}}$ is dominant, Fig. 7.22(c), and where the opamp output pole $\omega_{\mathrm{pa}}$ is dominant, Fig. $7.22(d)$. In both cases, the dc rejection (line regulation) is given by

$$
\begin{equation*}
\operatorname{PSRR}^{-1}(s)=\left(\frac{R_{L}}{r_{d s 1}+R_{L}}\right) \frac{1}{G_{m a} R_{o a} g_{m 1} R_{L}} \tag{7.76}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_11_07_2f1e461c896d7a95b701g-026.jpg?height=741&width=1472&top_left_y=1310&top_left_x=191)

Fig. 7.22 The power supply rejection of a LDO regulator: (a) open loop supply rejection;
(b) closed-loop shaping frequency response; (c) $|\operatorname{PSRR}(\omega)|=\left|\mathrm{H}_{\mathrm{CG}}(\omega)\right| /|1+\mathrm{L}(\omega)|$ with $\omega_{\mathrm{pL}}<\omega_{\mathrm{pa}}$;
(d) $|\operatorname{PSRR}(\omega)|=\left|\mathrm{H}_{\mathrm{CG}}(\omega)\right| /|1+\mathrm{L}(\omega)|$ with $\omega_{\mathrm{pa}}<\omega_{\mathrm{pL}}$.

As the loop gain increases beyond its dominant pole frequency $\omega_{\mathrm{pl}}$, the supply rejection worsens. In the first case, this occurs at the same frequency as the output pole begins to filter out the supply noise, so the supply rejection remains high. In the second case, the opamp pole $\omega_{\mathrm{pa}}$ occurs first at frequencies where the load capacitor is still unable to provide filtering of supply-induced noise, so the supply rejection worsens until the load pole kicks in. Unfortunately, for stability the poles $\omega_{\mathrm{pa}}$ and $\omega_{\mathrm{pL}}$ must be widely spaced, so the deterioration is significant. This usually occurs at frequencies in the range of 100 's of MHz where supply noise due to digital circuitry can be very high, and is therefore a major challenge.

## 7.5 SUMMARY OF KEY POINTS

- A bias circuit generates the dc voltages required to keep transistors near some desired operating point; as transistor parameters change, either from chip to chip or with changes in temperature, so must the bias voltages. [p. 303]
- A reference circuit generates a voltage and/or current of a known fixed absolute value. [p. 305]
- A regulator circuit improves the quality of a dc voltage or current, usually decreasing the noise. [p. 306]
- A constant-transconductance bias circuit produces a small-signal transconductance that is a fixed fraction of a resistor value, independent of process, temperature, or supply variations. [p. 308]
- The constant-transconductance bias circuit ensures a constant transconductance in all transistors of the same type as $\mathrm{Q}_{13}$. However, the transconductance of transistors of the opposite type will vary. [p. 308]
- Many bias circuits require auxiliary start-up circuits to prevent them from resting in a zero-current state indefinitely. [p. 309]
- An integrated voltage reference is made by adding the forward bias voltage of a pn junction to the difference in the forward voltages of two pn junctions biased at different current densities. Before adding them, these voltages are scaled so that their respective positive and negative temperature coefficients cancel precisely. [p. 311]
- The implementation of bandgap references in a CMOS process makes use of bipolar transistors formed using doped well regions in the silicon substrate. [p. 315]
- Connecting PTAT and IPTAT voltages in series to produce a precision reference results in a voltage larger than the bandgap of silicon. To produce a bandgap reference under a lower supply voltage, it is necessary to first convert the PTAT and IPTAT quantities into currents, and then sum them by shunting. [p. 319]
- A voltage regulator comprises a feedback loop that keeps an output voltage equal to a reference voltage by controlling the flow of current to the output through a pass-transistor. [p. 321]
- Whereas an NMOS pass-transistor provides superior supply rejection, unless native NMOS devices are available, a PMOS pass-transistor permits a lower dropout voltage and, hence, better efficiency. [p. 324]
- Compensation of a voltage regulator presents a difficult decision: either make the output pole dominant, resulting in high power consumption in the feedback amplifier, or make the pass-transistor gate node dominant, in which case supply rejection is worse. [p. 325]
