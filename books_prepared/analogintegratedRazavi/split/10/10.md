# CHAPTER 10 Stability and Frequency Compensation

Negative feedback finds wide application in the processing of analog signals. As described in Chapter 8, feedback suppresses the effect of the variations of the open-loop characteristics. Feedback systems, however, suffer from potential instability; that is, they may oscillate.

In this chapter, we deal with the stability and frequency compensation of linear feedback systems to the extent necessary to understand the design issues of analog feedback circuits. Beginning with a review of stability criteria and the concept of phase margin, we study frequency compensation, introducing various techniques suited to different op amp topologies. We also analyze the impact of frequency compensation on the slew rate of two-stage op amps. The chapter ends with a study of Nyquist's stability criterion.

## 10.1 ■ General Considerations

Let us consider the negative-feedback system shown in Fig. 10.1(a), where $\beta$ is assumed constant. Writing the closed-loop transfer function as

$$
\begin{equation*}
\frac{Y}{X}(s)=\frac{H(s)}{1+\beta H(s)} \tag{10.1}
\end{equation*}
$$

we note that if $\beta H\left(s=j \omega_{1}\right)=-1$ at $\omega_{1} \neq 0$, then the closed-loop "gain" goes to infinity, and the circuit can amplify its own noise until it eventually begins to oscillate. In other words, if the loop gain at $\omega_{1}, \beta H\left(j \omega_{1}\right)$, is equal to -1 , then the circuit may oscillate at frequency $\omega_{1}$. This condition can be expressed as

$$
\begin{align*}
& \left|\beta H\left(j \omega_{1}\right)\right|=1  \tag{10.2}\\
& \angle \beta H\left(j \omega_{1}\right)=-180^{\circ} \tag{10.3}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-410.jpg?height=346&width=1264&top_left_y=2032&top_left_x=522)

Figure 10.1 (a) Basic negative-feedback system, and (b) phase shift around the loop at $\omega_{1}$.
which are called "Barkhausen's Criteria." Note that (1) these equations relate only to the loop gain (more precisely, the loop transmission) ${ }^{1}$ and are independent of where the input and output are located, and (2) the total phase shift around the loop at $\omega_{1}$ is $360^{\circ}$ because negative feedback itself introduces $180^{\circ}$ of phase shift [Fig. 10.1(b)]. The $360^{\circ}$ phase shift is necessary for oscillation since the feedback signal must add in phase to the original noise to allow oscillation buildup. By the same token, a loop gain of unity (or greater) is also required to enable growth of the oscillation amplitude. These oscillation requirements are studied further in Chapter 15. The key point here is that the loop transmission, which can often be found from the open-loop system, reveals the stability of the closed-loop system.

In summary, a negative-feedback system may oscillate at $\omega_{1}$ if (1) the phase shift around the loop at this frequency is so great that the feedback becomes positive and (2) the loop gain is still enough to allow signal buildup. Illustrated in Fig. 10.2(a), the situation can be viewed as excessive loop gain at the frequency at which the phase shift reaches $-180^{\circ}$ or, equivalently, excessive phase at the frequency at which the loop gain drops to unity. Thus, to avoid instability, we must minimize the total phase shift so that if $|\beta H|=1$, then $\angle \beta H$ is still more positive than $-180^{\circ}$ [Fig. 10.2(b)]. In this chapter, we assume that $\beta$ is less than or equal to unity and does not depend on the frequency.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-411.jpg?height=678&width=1465&top_left_y=1042&top_left_x=356)

Figure 10.2 Bode plots of loop transmission for (a) unstable and (b) stable systems.

The frequencies at which the magnitude and phase of the loop gain are equal to unity and $-180^{\circ}$, respectively, play a critical role in the stability and are called the "gain crossover frequency" and the "phase crossover frequency," respectively. In a stable system, the gain crossover must occur well before the phase crossover. For the sake of brevity, we denote the gain crossover by GX and the phase crossover by PX. It is helpful to note that the gain crossover frequency is the same as the unity-gain bandwidth of the loop transmission.

#### Example 10.1

Explain whether the system depicted in Fig. 10.2(a) becomes more or less stable if the feedback is weakened, i.e., if $\beta$ is reduced.

#### Solution

As illustrated in Fig. 10.3, a lower $\beta$ shifts the plot of $20 \log |\beta H(\omega)|$ down and the GX to the left. Since $\angle \beta H(\omega)$ does not change, the system becomes more stable. After all, if we apply no feedback around an op amp, the circuit has no tendency to oscillate. Thus, the worst-case stability corresponds to $\beta=1$, i.e, unity-gain feedback. For this reason, we often analyze the magnitude and phase plots for $\beta H=H$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-412.jpg?height=515&width=630&top_left_y=650&top_left_x=569)

Figure 10.3

Before studying more specific cases, let us review a few basic rules for constructing Bode plots. A Bode plot illustrates the asymptotic behavior of the magnitude and phase of a complex function according to the magnitude of the poles and zeros. The following two rules are used. (1) The slope of the magnitude plot changes by $+20 \mathrm{~dB} / \mathrm{dec}$ at every zero frequency and by $-20 \mathrm{~dB} / \mathrm{dec}$ at every pole frequency. (2) For a pole (zero) frequency of $\omega_{m}$, the phase begins to fall (rise) at approximately $0.1 \omega_{m}$, experiences a change of $-45^{\circ}\left(+45^{\circ}\right)$ at $\omega_{m}$, and approaches a change of $-90^{\circ}\left(+90^{\circ}\right)$ at approximately $10 \omega_{m}$. The key point here is that the phase is much more significantly affected by high-frequency poles and zeros than the magnitude is.

It is also instructive to plot the location of the poles of a closed-loop system on a complex plane. Expressing each pole frequency as $s_{p}=j \omega_{p}+\sigma_{p}$ and noting that the impulse response of the system includes a term $\exp \left(j \omega_{p}+\sigma_{p}\right) t$, we observe that if $s_{p}$ falls in the right half plane (RHP), i.e., if $\sigma_{p}>0$, then the system oscillates because its time-domain response exhibits a growing exponential [Fig. 10.4(a)]. Even if $\sigma_{p}=0$, the system sustains oscillations [Fig. 10.4(b)]. Conversely, if the poles lie in the left half plane (LHP), all time-domain exponential terms decay to zero [Fig. 10.4(c)]. ${ }^{2}$ In practice, we plot the location of the poles as the loop gain varies, thereby revealing how close to oscillation the system may come. Such a plot is called a "root locus."

We now study a feedback system incorporating a one-pole forward amplifier. Assuming $H(s)=$ $A_{0} /\left(1+s / \omega_{0}\right)$, we have from $(10.1)$

$$
\begin{equation*}
\frac{Y}{X}(s)=\frac{\frac{A_{0}}{1+\beta A_{0}}}{1+\frac{s}{\omega_{0}\left(1+\beta A_{0}\right)}} \tag{10.4}
\end{equation*}
$$

[^69]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-413.jpg?height=771&width=1454&top_left_y=364&top_left_x=358)

Figure 10.4 Time-domain response of a system versus the position of poles: (a) unstable with growing amplitude; (b) unstable with constant-amplitude oscillation; (c) stable.

In order to analyze the stability behavior, we plot $|\beta H(s=j \omega)|$ and $\angle \beta H(s=j \omega)$ (Fig. 10.5), observing that a single pole cannot contribute a phase shift greater than $90^{\circ}$ and the system is unconditionally stable for all nonnegative values of $\beta$. Note that $\angle \beta H$ is independent of $\beta$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-413.jpg?height=552&width=713&top_left_y=1490&top_left_x=456)

Figure 10.5 Bode plots of loop transmission for a one-pole system.

#### Example 10.2

Construct the root locus for a one-pole system.

#### Solution

Equation (10.4) implies that the closed-loop system has a pole $s_{p}=-\omega_{0}\left(1+\beta A_{0}\right)$, i.e., a real-valued pole in the left half plane that moves away from the origin as the loop gain increases (Fig. 10.6).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-414.jpg?height=300&width=443&top_left_y=378&top_left_x=663)

Figure 10.6

## 10.2 ■ Multipole Systems

Our study of op amps in Chapter 9 indicates that such circuits generally contain multiple poles. In twostage op amps, for example, each gain stage introduces a "dominant" pole. It is therefore important to study a feedback system whose core amplifier exhibits more than one pole.

Let us consider a two-pole system first. For stability considerations, we plot $|\beta H|$ and $\angle \beta H$ as a function of the frequency. Shown in Fig. 10.7, the magnitude begins to drop at $20 \mathrm{~dB} / \mathrm{dec}$ at $\omega=\omega_{p 1}$ and at $40 \mathrm{~dB} / \mathrm{dec}$ at $\omega=\omega_{p 2}$. Also, the phase begins to change at $\omega=0.1 \omega_{p 1}$, reaches $-45^{\circ}$ at $\omega=\omega_{p 1}$ and $-90^{\circ}$ at $\omega=10 \omega_{p 1}$, begins to change again at $\omega=0.1 \omega_{p 2}$ (if $0.1 \omega_{p 2}>10 \omega_{p 1}$ ), reaches $-135^{\circ}$ at $\omega=\omega_{p 2}$, and asymptotically approaches $-180^{\circ}$. The system is therefore stable because $|\beta H|$ drops to below unity at a frequency where $\angle \beta H<-180^{\circ}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-414.jpg?height=612&width=707&top_left_y=1405&top_left_x=528)

Figure 10.7 Bode plots of loop transmission for a two-pole system.

What happens if the feedback is made "weaker"? To reduce the amount of feedback, we decrease $\beta$, obtaining the gray magnitude plot in Fig. 10.7. As the feedback becomes weaker, the gain crossover point moves toward the origin while the phase crossover point remains constant, resulting in a more stable system. The stability is obtained at the cost of weaker feedback.

#### Example 10.3

Construct the root locus for a two-pole system.

#### Solution

Writing the open-loop transfer function as

$$
\begin{equation*}
H(s)=\frac{A_{0}}{\left(1+\frac{s}{\omega_{p 1}}\right)\left(1+\frac{s}{\omega_{p 2}}\right)} \tag{10.5}
\end{equation*}
$$

we have

$$
\begin{align*}
\frac{Y}{X}(s) & =\frac{A_{0}}{\left(1+\frac{s}{\omega_{p 1}}\right)\left(1+\frac{s}{\omega_{p 2}}\right)+\beta A_{0}}  \tag{10.6}\\
& =\frac{A_{0} \omega_{p 1} \omega_{p 2}}{s^{2}+\left(\omega_{p 1}+\omega_{p 2}\right) s+\left(1+\beta A_{0}\right) \omega_{p 1} \omega_{p 2}} \tag{10.7}
\end{align*}
$$

Thus, the closed-loop poles are given by

$$
\begin{equation*}
s_{1,2}=\frac{-\left(\omega_{p 1}+\omega_{p 2}\right) \pm \sqrt{\left(\omega_{p 1}+\omega_{p 2}\right)^{2}-4\left(1+\beta A_{0}\right) \omega_{p 1} \omega_{p 2}}}{2} \tag{10.8}
\end{equation*}
$$

As expected, for $\beta=0, s_{1,2}=-\omega_{p 1},-\omega_{p 2}$. As $\beta$ increases, the term under the square root drops, taking on a value of zero for

$$
\begin{equation*}
\beta_{1}=\frac{1}{A_{0}} \frac{\left(\omega_{p 1}-\omega_{p 2}\right)^{2}}{4 \omega_{p 1} \omega_{p 2}} \tag{10.9}
\end{equation*}
$$

As shown in Fig. 10.8, the poles begin at $-\omega_{p 1}$ and $-\omega_{p 2}$, move toward each other, coincide for $\beta=\beta_{1}$, and become complex for $\beta>\beta_{1}$. The closed-loop system does not become unstable because the poles do not reach the $j \omega$ axis.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-415.jpg?height=331&width=695&top_left_y=1511&top_left_x=465)

Figure 10.8

The foregoing calculations point to the complexity of the algebra required to construct a root locus for higher-order systems. For this reason, many root locus techniques have been devised so as to minimize such computations.

We now study a three-pole system. Shown in Fig. 10.9(a) are the Bode plots of the magnitude and phase of the loop gain. The third pole gives rise to additional phase shift, possibly moving the phase crossover to frequencies lower than the gain crossover and leading to oscillation.

Since the third pole also decreases the magnitude of the loop gain at a greater rate, the reader may wonder why the gain crossover does not move as much as the phase crossover does. As mentioned before, the phase begins to change at approximately one-tenth of the pole frequency, whereas the magnitude begins to drop only near the pole frequency. For this reason, additional poles (and zeros) affect the phase to a much greater extent than they do the magnitude.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-416.jpg?height=716&width=1447&top_left_y=374&top_left_x=426)

Figure 10.9 (a) Bode plots of loop transmission for a three-pole system and (b) closed-loop response.

As with a two-pole system, if the feedback factor in Fig. 10.9 decreases, the circuit becomes more stable because the gain crossover moves toward the origin while the phase crossover remains constant. For this reason, a feedback amplifier designed for a higher closed-loop gain tends to be more stable (why?).

It is important not to confuse the $\beta H$ plots with the closed-loop frequency response, $Y / X$. As an example, consider a system with the loop response shown in Fig. 10.9(b), where the gain and phase crossover frequencies coincide. The closed-loop response, $|Y / X|$, exhibits infinite gain at $\omega_{0}$, predicting oscillation at this frequency.

## 10.3 ■ Phase Margin

We have seen that to ensure stability, $|\beta H|$ must drop to unity before $\angle \beta H$ crosses $-180^{\circ}$. We may naturally ask: How far should PX be from GX? Let us first consider a "marginal" case where, as depicted in Fig. 10.10(a), GX is only slightly below PX; for example, at GX, the phase equals $-175^{\circ}$. How does the closed-loop system respond in this case? Noting that at GX, $\beta H\left(j \omega_{1}\right)=1 \times \exp \left(-j 175^{\circ}\right)$, we have for the closed-loop system

$$
\begin{align*}
\frac{Y}{X}\left(j \omega_{1}\right) & =\frac{H\left(j \omega_{1}\right)}{1+\beta H\left(j \omega_{1}\right)}  \tag{10.10}\\
& =\frac{\frac{1}{\beta} \exp \left(-j 175^{\circ}\right)}{1+\exp \left(-j 175^{\circ}\right)}  \tag{10.11}\\
& =\frac{1}{\beta} \cdot \frac{-0.9962-j 0.0872}{0.0038-j 0.0872} \tag{10.12}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-417.jpg?height=954&width=1179&top_left_y=361&top_left_x=493)

Figure 10.10 Closed-loop frequency and time response for (a) small and (b) large margin between gain and phase crossover points.
and hence

$$
\begin{align*}
\left|\frac{Y}{X}\left(j \omega_{1}\right)\right| & =\frac{1}{\beta} \cdot \frac{1}{0.0872}  \tag{10.13}\\
& \approx \frac{11.5}{\beta} \tag{10.14}
\end{align*}
$$

Since at low frequencies, $|Y / X| \approx 1 / \beta$, the closed-loop frequency response exhibits a sharp peak in the vicinity of $\omega=\omega_{1}$. In other words, the closed-loop system is near oscillation, and its step response, $y(t)$, exhibits a very underdamped behavior. This point also reveals that a second-order system may suffer from ringing although it is stable.

Now suppose, as shown in Fig. 10.10(b), GX precedes PX by a greater margin. Then, we expect a relatively "well-behaved" closed-loop response in both the frequency domain and the time domain. It is therefore plausible to conclude that the greater the spacing between GX and PX (while GX remains below PX ), the more stable the feedback system. Alternatively, the phase of $\beta H$ at the gain crossover frequency can serve as a measure of stability: the smaller $|\angle \beta H|$ at this point, the more stable the system.

This observation leads us to the concept of "phase margin" (PM), defined as PM $=180^{\circ}+\angle \beta H(\omega=$ $\omega_{1}$ ), where $\omega_{1}$ is the gain crossover frequency. We see that stability calls for a positive and large PM.

#### Example 10.4

A two-pole feedback system is designed such that $\left|\beta H\left(\omega_{p 2}\right)\right|=1$ and $\left|\omega_{p 1}\right| \ll\left|\omega_{p 2}\right|$ (Fig. 10.11). How much is the phase margin?
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-418.jpg?height=546&width=678&top_left_y=373&top_left_x=548)

Figure 10.11

#### Solution

Since $\angle \beta H$ reaches $-135^{\circ}$ at $\omega=\omega_{p 2}$, the phase margin is equal to $45^{\circ}$. The key point to remember is that, if the loop gain drops to unity at a frequency above the second pole, the phase margin is less than $45^{\circ}$. As explained below, since $\mathrm{PM}=45^{\circ}$ is typically inadequate, we say that the ultimate unity-gain bandwidth cannot exceed the second pole of the open-loop op amp if a well-behaved time response is desired.

The above example suggests that for a phase margin greater than $45^{\circ}$, the gain crossover frequency must lie between the first pole and the second (in the absence of zeros). That is, the unity-gain bandwidth cannot exceed the second pole frequency.

How much phase margin is adequate? It is instructive to examine the closed-loop frequency response for different phase margins [1]. For $\mathrm{PM}=45^{\circ}$, at the gain crossover frequency $\angle \beta H\left(\omega_{1}\right)=-135^{\circ}$ and $\left|\beta H\left(\omega_{1}\right)\right|=1$ (Fig. 10.12), yielding

$$
\begin{align*}
\frac{Y}{X} & =\frac{H\left(j \omega_{1}\right)}{1+1 \times \exp \left(-j 135^{\circ}\right)}  \tag{10.15}\\
& =\frac{H\left(j \omega_{1}\right)}{0.29-0.71 j} \tag{10.16}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-418.jpg?height=696&width=527&top_left_y=1742&top_left_x=621)

Figure 10.12 Closed-loop frequency response for $45^{\circ}$ phase margin.

It follows that

$$
\begin{align*}
\left|\frac{Y}{X}\right| & =\frac{1}{\beta} \cdot \frac{1}{|0.29-0.71 j|}  \tag{10.17}\\
& \approx \frac{1.3}{\beta} \tag{10.18}
\end{align*}
$$

Consequently, the frequency response of the feedback system suffers from a $30 \%$ peak at $\omega=\omega_{1}$.
It can be shown that for $\mathrm{PM}=60^{\circ}, Y\left(j \omega_{1}\right) / X\left(j \omega_{1}\right)=1 / \beta$, suggesting a negligible frequency peaking. This typically means that the step response of the feedback system exhibits little ringing, providing a fast settling. For greater phase margins, the system is more stable, but the time response slows down (Fig. 10.13). Thus, $\mathrm{PM}=60^{\circ}$ is typically considered the optimum value.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-419.jpg?height=306&width=1342&top_left_y=981&top_left_x=414)

Figure 10.13 Closed-loop time response for $45^{\circ}, 60^{\circ}$, and $90^{\circ}$ phase margins.

The concept of phase margin is well suited to the design of circuits that process small signals. In practice, the large-signal step response of feedback amplifiers does not follow the illustration of Fig. 10.13. This is not only due to slewing but also because of the nonlinear behavior resulting from large excursions in the bias voltages and currents of the amplifier. Such excursions in fact cause the pole and zero frequencies to vary during the transient, leading to a complicated time response. Thus, for large-signal applications, time-domain simulations of the closed-loop system prove more relevant and useful than small-signal ac computations of the open-loop amplifier.

As an example of a feedback circuit exhibiting a reasonable phase margin but poor settling behavior, consider the unity-gain amplifier of Fig. 10.14, where the aspect ratio of all transistors is equal to $50 \mu \mathrm{~m} /$ $0.6 \mu \mathrm{~m}$. With the choice of the device dimensions, bias currents, and capacitor values shown here, SPICE yields a phase margin of approximately $65^{\circ}$ and a unity-gain frequency of 150 MHz . The large-signal step response, however, suffers from significant ringing.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-419.jpg?height=466&width=1135&top_left_y=1926&top_left_x=518)

Figure 10.14 Unity-gain buffer.

## 10.4 ■ Basic Frequency Compensation

Typical op amp circuits contain many poles. In a folded-cascode topology, for example, both the folding node and the output node contribute poles. For this reason, op amps must usually be "compensated," that is, their open-loop transfer function must be modified such that the closed-loop circuit is stable and the time response is well behaved.

The need for compensation arises because $|\beta H|$ does not drop to unity well before $\angle \beta H$ reaches $-180^{\circ}$. We then postulate that stability can be achieved by (1) minimizing the overall phase shift, thus pushing the phase crossover out [Fig. 10.15(a)]; or (2) dropping the gain with frequency, thereby pushing the gain crossover in [Fig. 10.15(b)]. The first approach requires that we attempt to minimize the number of poles in the signal path by proper design. Since each additional stage contributes at least one pole, this means that the number of stages must be minimized, a remedy that yields low voltage gain and/or limited output swings (Chapter 9). The second approach, on the other hand, retains the low-frequency gain and the output swings, but it reduces the bandwidth by forcing the gain to fall at lower frequencies.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-420.jpg?height=621&width=615&top_left_y=1010&top_left_x=505)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-420.jpg?height=616&width=650&top_left_y=1010&top_left_x=1145)
(b)

Figure 10.15 Frequency compensation by (a) moving PX out and (b) pushing GX in.

In practice, we first try to design an op amp so as to minimize the number of poles while meeting other requirements. Since the resulting circuit may still suffer from insufficient phase margin, we then compensate the op amp, i.e., modify the design so as to move the gain crossover toward the origin. These efforts proceed with the $\beta$ value chosen according to the final design requirements. For example, a closed-loop gain of 4 in some cases translates to $\beta \approx 0.25$ if the loop gain is large. ${ }^{3}$ In other words, we need not compensate the circuit for $\beta=1$ if the closed-loop gain is always higher.

Let us apply the above concepts to the telescopic-cascode op amp shown in Fig. 10.16, where a PMOS current mirror performs differential to single-ended conversion. We identify a number of poles in the signal paths: path 1 contains a high-frequency pole at the source of $M_{3}$, a mirror pole at node $A$, and another high-frequency pole at the source of $M_{7}$, whereas path 2 contains a high-frequency pole at the source of $M_{4}$. The two paths share a pole at the output.

It is instructive to estimate the relative position of these poles. Since the output resistance of the op amp is much higher than the small-signal resistances seen at the other nodes in the circuit, we expect

[^70]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-421.jpg?height=656&width=624&top_left_y=367&top_left_x=495)

Figure 10.16 Telescopic op amp with single-ended output.
that, even with a moderate load capacitance, the output pole, $\omega_{p, \text { out }}$, is the closest to the origin. Called the "dominant pole," $\omega_{p, \text { out }}$ usually sets the open-loop 3-dB bandwidth.

We also surmise that the first "nondominant pole," i.e., the closest pole to the origin after the dominant pole, arises at node $A$. This is because the total capacitance at this node, roughly equal to $C_{G S 5}+C_{G S 6}+$ $C_{D B 5}+2 C_{G D 6}+C_{D B 3}+C_{G D 3}$, is typically quite a lot larger than that at nodes $X, Y$, and $N$, and the small-signal resistance of $M_{5}$, approximately $1 / g_{m 5}$, is also relatively large.

Which node yields the next nondominant pole: $N$ or $X$ (and $Y$ )? Recall from Chapter 9 that, to obtain a low overdrive and consume a reasonable voltage headroom, the PMOS devices in the op amp are typically wider than the NMOS transistors. Comparing $M_{4}$ and $M_{7}$ and neglecting body effect, we note that since $g_{m}=2 I_{D} /\left|V_{G S}-V_{T H}\right|$, if the two transistors are designed to have the same overdrive, they also exhibit the same transconductance. However, from square-law characteristics, we have $W_{4} / W_{7}=\mu_{p} / \mu_{n}$, which is about $1 / 2$ to $1 / 3$. Thus, nodes $N$ and $X$ (or $Y$ ) see roughly equal small-signal resistances to ground, but node $N$ suffers from much more capacitance. It is therefore plausible to assume that node $N$ contributes the next nondominant pole. Figure 10.17 illustrates the results, denoting the capacitance at nodes $A, N$, and $X$ by $C_{A}, C_{N}$, and $C_{X}$, respectively. The poles at nodes $X$ and $Y$ are nearly equal, and their corresponding terms in the transfer functions of path 1 and path 2 can be factored out. Thus, they count as one pole rather than two.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-421.jpg?height=297&width=725&top_left_y=1861&top_left_x=720)

Figure 10.17 Pole locations for the op amp of Fig. 10.16.

With the position of the poles roughly determined, we can construct the magnitude and phase plots for $\beta H$, using $\beta=1$ for the worst case. Shown in Fig. 10.18, such characteristics indicate that the mirror pole typically limits the phase margin because its phase contribution occurs at lower frequencies than that of other nondominant poles.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-422.jpg?height=619&width=768&top_left_y=368&top_left_x=770)

Figure 10.18 Bode plots of loop transmission for op amp of Fig. 10.16.
Recall from Chapter 6 that differential pairs using active current mirrors exhibit a left-half-plane zero located at twice the mirror pole frequency. The circuit of Fig. 10.16 contains such a zero as well. Located at $2 \omega_{p, A}$, the zero impacts both the magnitude and phase characteristics. The analysis is left to the reader.

Compensation Procedure How should we compensate the telescopic-cascode op amp? Recall that our ultimate goal is to ensure a loop gain sufficiently less than unity at the phase crossover frequency. Let us assume that the number and location of the nondominant poles and hence the phase plot at frequencies higher than roughly $10 \omega_{p, \text { out }}$, remain constant. We begin with the original response shown in Fig. 10.19, which has a negative phase margin. We must force the loop gain to drop such that the gain crossover point moves toward the origin. To accomplish this, we simply lower the frequency of the dominant pole, $\omega_{p 1}$, by increasing the load capacitance. The key point is that the phase contribution of the dominant pole in the vicinity of the gain or phase crossover point is close to $90^{\circ}$ and relatively independent of the location of the pole. That is, as illustrated in Fig. 10.19, translating the dominant pole toward the origin affects the magnitude plot, but not the critical part of the phase plot. If $\omega_{p 1}$ is lowered sufficiently, the PM reaches an acceptable value, but at the cost of bandwidth.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-422.jpg?height=527&width=627&top_left_y=1712&top_left_x=571)

Figure 10.19 Translating the dominant pole toward the origin.

In order to determine how much the dominant pole must be shifted down as well as arrive at an important conclusion, let us assume that (1) the second nondominant pole ( $\omega_{p, N}$ ) in Fig. 10.16 is much higher than the mirror pole so that the phase shift at $\omega=\omega_{p, A}$ is equal to $-135^{\circ}$, and (2) a phase
margin of $45^{\circ}$ (which is usually inadequate) is necessary. To compensate the circuit, we begin from $\angle \beta H(\omega)=-180^{\circ}+\mathrm{PM}=-135^{\circ}$ and identify the corresponding gain crossover frequency, in this case, $\omega_{p, A}$ (Fig. 10.20). Since the dominant pole must drop the gain to unity at $\omega_{p, A}$ with a slope of $20 \mathrm{~dB} / \mathrm{dec}$, we draw a straight line from $\omega_{p, A}$ toward the origin with such a slope, thus obtaining the new magnitude of the dominant pole, $\omega_{p, \text { out }}^{\prime}$. Therefore, the load capacitance must be increased by a factor of $\omega_{p, \text { out }} / \omega_{p, \text { out }}^{\prime}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-423.jpg?height=509&width=779&top_left_y=664&top_left_x=690)

Figure 10.20 Translating the dominant pole toward the origin for $45^{\circ}$ phase margin.
From the new magnitude plot, we note that the unity-gain bandwidth of the compensated (open-loop) op amp is equal to the frequency of the first nondominant pole (of course with a phase margin of $45^{\circ}$ ). This is a fundamental result, indicating that to achieve a wide bandwidth in a feedback system employing a multipole op amp, the first nondominant pole must be as far as possible. For this reason, the mirror pole proves undesirable.

We should also mention that although $\omega_{p, \text { out }}=\left(R_{\text {out }} C_{L}\right)^{-1}$, increasing $R_{\text {out }}$ does not compensate the op amp. As shown in Fig. 10.21, a higher $R_{\text {out }}$ results in a greater low-frequency loop gain, only affecting the low-frequency portion of the characteristics. Also, moving one of the nondominant poles toward the origin does not improve the phase margin. (Why?)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-423.jpg?height=556&width=636&top_left_y=1654&top_left_x=497)

Figure 10.21 Bode plots of loop gain for higher output resistance.

In summary, frequency compensation moves the dominant pole of the open-loop amplifier to sufficiently low values so that the unity-gain bandwidth is well below the phase crossover frequency. Also, the compensated bandwidth cannot exceed the first nondominant pole frequency since a phase margin of greater than $45^{\circ}$ is typically required.

#### Example 10.5

An op amp is compensated to have a phase margin of $60^{\circ}$ with unity-gain feedback. By what factor can the compensation be relaxed if the circuit is to operate with a feedback factor of $\beta<1$ [Fig. 10.22(a)]?
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-424.jpg?height=607&width=1345&top_left_y=541&top_left_x=479)

Figure 10.22

#### Solution

As illustrated in Fig. 10.22(b), the original compensation identifies the frequency at which $\angle \beta H=-120^{\circ}$, draws a line from this frequency at a slope of $20 \mathrm{~dB} / \mathrm{dec}$ toward the vertical axis, and hence moves the dominant pole from $\omega_{p 1}$ to $\omega_{p 1}^{\prime}$. With a feedback factor of $\beta$, the uncompensated magnitude response is shifted down by $-20 \log \beta$, requiring a dominant pole at $\omega_{p 1}^{\prime \prime}$. To obtain this value, we equate the slope of the line $C D$ to $20 \mathrm{~dB} / \mathrm{dec}$ :

$$
\begin{equation*}
\frac{-20 \log \beta}{\log \omega_{p 1}^{\prime \prime}-\log \omega_{p 1}^{\prime}}=20 \tag{10.19}
\end{equation*}
$$

and hence $\omega_{p 1}^{\prime \prime}=\omega_{p 1}^{\prime} / \beta$. That is, the compensation capacitor can be reduced by approximately a factor of $1 / \beta$. This, of course, does not mean that the new feedback circuit settles faster; the weaker feedback translates to a proportionally smaller extension of the bandwidth. In fact, we can write the closed-loop - $3-\mathrm{dB}$ bandwidths as $\left(1+A_{0}\right) \omega_{p 1}^{\prime} \approx A_{0} \omega_{p 1}^{\prime}$ for the original op amp and $\left(1+\beta A_{0}\right) \omega_{p 1}^{\prime \prime} \approx \beta A_{0} \omega_{p 1}^{\prime \prime} \approx A_{0} \omega_{p 1}^{\prime}$ for the newly-compensated counterpart, concluding that the closed-loop speed remains roughly the same.

A related question that we address in Problem 10.23 is the following: If an op amp is compensated to have $\mathrm{PM}=60^{\circ}$ with unity-gain feedback, by how much does its PM increase if the feedback factor is reduced to $\beta<1$ ?

Now consider the fully differential telescopic cascode depicted in Fig. 10.23. In addition to achieving various useful properties of differential operation, this topology avoids the mirror pole, thereby exhibiting stable behavior for a greater bandwidth. In fact, we can identify one dominant pole at each output node and only one nondominant pole arising from node $X$ (or $Y$ ). This suggests that fully differential telescopiccascode circuits are stable and do not need compensation.

But how about the pole at node $N$ (or $K$ ) in Fig. 10.23? Considering one of the PMOS cascodes as shown in Fig. 10.24(a), we may think that the capacitance at node $N, C_{N}=C_{G S 5}+C_{S B 5}+C_{G D 7}+C_{D B 7}$, shunts the output resistance of $M_{7}$ at high frequencies, thereby dropping the output impedance of the cascode. To quantify this effect, we first determine $Z_{\text {out }}$ in Fig. 10.24(a):

$$
\begin{equation*}
Z_{\text {out }}=\left(1+g_{m 5} r_{O 5}\right) Z_{N}+r_{O 5} \tag{10.20}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-425.jpg?height=650&width=469&top_left_y=376&top_left_x=558)

Figure 10.23 Fully differential telescopic op amp.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-425.jpg?height=316&width=328&top_left_y=1111&top_left_x=683)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-425.jpg?height=411&width=388&top_left_y=1098&top_left_x=1098)
(b)

Figure 10.24 Effect of device capacitance at internal node of a cascode current source.
where body effect is neglected and $Z_{N}=r_{O 7} \|\left(C_{N} s\right)^{-1}$. Assuming the first term is much greater than the second, we have

$$
\begin{equation*}
Z_{\text {out }} \approx\left(1+g_{m 5} r_{O 5}\right) \frac{r_{O 7}}{r_{O 7} C_{N} s+1} \tag{10.21}
\end{equation*}
$$

Now, as illustrated in Fig. 10.24(b), we take the output load capacitance into account:

$$
\begin{align*}
Z_{\text {out }} \| \frac{1}{C_{L} s} & =\frac{\left(1+g_{m 5} r_{O 5}\right) \frac{r_{O 7}}{r_{O 7} C_{N} s+1} \cdot \frac{1}{C_{L} s}}{\left(1+g_{m 5} r_{O 5}\right) \frac{r_{O 7}}{r_{O 7} C_{N} s+1}+\frac{1}{C_{L} s}}  \tag{10.22}\\
& =\frac{\left(1+g_{m 5} r_{O 5}\right) r_{O 7}}{\left[\left(1+g_{m 5} r_{O 5}\right) r_{O 7} C_{L}+r_{O 7} C_{N}\right] s+1} \tag{10.23}
\end{align*}
$$

Thus, the parallel combination of $Z_{\text {out }}$ and the load capacitance still contains a single pole corresponding to a time constant $\left(1+g_{m 5} r_{O 5}\right) r_{O 7} C_{L}+r_{O 7} C_{N}$. Note that $\left(1+g_{m 5} r_{O 5}\right) r_{O 7} C_{L}$ is simply due to the lowfrequency output resistance of the cascode. In other words, the overall time constant equals the "output" time constant plus $r_{O 7} C_{N}$. The key point in this calculation is that the pole in the PMOS cascode (at node $N$ ) is merged with the output pole, thus creating no additional pole. It merely lowers the dominant pole
by a slight amount. For this reason, we loosely say that the signal does not "see" the pole in the cascode current sources. ${ }^{4}$

Comparison of the circuits shown in Figs. 10.16 and 10.23 now reveals that the fully differential configuration avoids both the mirror pole and the pole at node $N$. With the approximation made in (10.23), the circuit of Fig. 10.23 contains only one nondominant pole located at relatively high frequencies owing to the high transconductance of the NMOS transistors. This is a remarkable advantage of fully differential cascode op amps.

We have thus far observed that nondominant poles give rise to instability, requiring frequency compensation. Is it possible to cancel one or more of these poles by introducing zeros in the transfer function? For example, following the analysis of Fig. 6.41, we surmise that if a low-gain but fast path is placed in parallel with the main amplifier, a zero is created that can be positioned atop the first nondominant pole. However, cancellation of a pole by a zero in the presence of mismatches leads to long settling components in the step response of the closed-loop circuit. This effect is studied in Problem 10.19.

## 10.5 ■ Compensation of Two-Stage Op Amps

Our study of op amps in Chapter 9 indicates that two-stage topologies may prove inevitable if the output voltage swing must be maximized. This is especially true in today's low-voltage op amps. Thus, the stability and compensation of such op amps is of interest.

Consider the circuit shown in Fig. 10.25. We identify three poles: a pole at $X$ (or $Y$ ), another at $E$ (or $F$ ), and a third at $A$ (or $B$ ). From our foregoing discussions, we know that the pole at $X$ lies at relatively high frequencies. But how about the other two? Since node $E$ exhibits a high small-signal resistance, even the capacitances of $M_{3}, M_{5}$, and $M_{9}$ can create a pole relatively close to the origin. At node $A$, the small-signal resistance is lower, but $C_{L}$ may be large. Consequently, we say that the circuit contains two dominant poles.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-426.jpg?height=569&width=983&top_left_y=1493&top_left_x=663)

Figure 10.25 Two-stage op amp.
From these observations, we can construct the magnitude and phase plots shown in Fig. 10.26. Here, $\omega_{p, E}$ is assumed more dominant, but the relative positions of $\omega_{p, E}$ and $\omega_{p, A}$ depend on the design and the load capacitance. Note that, since the poles at $E$ and $A$ are relatively close to the origin, the phase

[^71]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-427.jpg?height=598&width=725&top_left_y=370&top_left_x=453)

Figure 10.26 Bode plots of loop gain of two-stage op amp.
approaches $-180^{\circ}$ well below the third pole. In other words, the phase margin may be close to zero even before the third pole contributes significant phase shift.

Let us now investigate the frequency compensation of two-stage op amps. In Fig. 10.26, one of the dominant poles must be moved toward the origin so as to place the gain crossover well below the phase crossover. However, recall from Sec. 10.4 that the unity-gain bandwidth after compensation cannot exceed the frequency of the second pole of the open-loop system for $\mathrm{PM}>45^{\circ}$. Thus, if in Fig. 10.26 the magnitude of $\omega_{p, E}$ is to be reduced, the available bandwidth is limited to approximately $\omega_{p, A}$, a low value. Furthermore, the very small magnitude of the new dominant pole translates to a large compensation capacitor.

Fortunately, a more efficient method of compensation can be applied to the circuit of Fig. 10.25. To arrive at this method, we note that, as illustrated in Fig. 10.27(a), the first stage exhibits a high output impedance, $R_{\text {out1 }}$, and the second stage provides a moderate gain, $A_{v 2}$, thereby creating a suitable environment for Miller multiplication of capacitors. Shown in Fig. 10.27(b), the idea is to create a large capacitance at node $E$, equal to $\left(1+A_{v 2}\right) C_{C}$, moving the corresponding pole to $R_{\text {out } 1}^{-1}\left[C_{E}+\left(1+A_{v 2}\right) C_{C}\right]^{-1}$, where $C_{E}$ denotes the capacitance at node $E$ before $C_{C}$ is added. As a result, a low-frequency pole can be established with a moderate capacitor value, saving considerable chip area. This technique is called "Miller compensation."
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-427.jpg?height=363&width=933&top_left_y=1805&top_left_x=616)

Figure 10.27 Miller compensation of a two-stage op amp.

In addition to lowering the required capacitor value, Miller compensation entails a very important property: it moves the output pole away from the origin. Illustrated in Fig. 10.28, this effect is called "pole splitting." To understand the underlying principle, we simplify the output stage of Fig. 10.25 as in Fig. 10.29 , where $R_{S}$ denotes the output resistance of the first stage and $R_{L}=r_{O 9} \| r_{O 11}$. From our
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-428.jpg?height=228&width=1221&top_left_y=368&top_left_x=544)

Figure 10.28 Pole splitting as a result of Miller compensation.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-428.jpg?height=360&width=535&top_left_y=693&top_left_x=594)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-428.jpg?height=345&width=500&top_left_y=703&top_left_x=1203)
(b)

Figure 10.29 (a) Simplified circuit of a two-stage op amp, and (b) a rough model at high frequencies.
analysis in Chapter 6, we note that this compensated circuit contains two poles:

$$
\begin{align*}
& \omega_{p 1}^{\prime} \approx \frac{1}{R_{S}\left[\left(1+g_{m 9} R_{L}\right)\left(C_{C}+C_{G D 9}\right)+C_{E}\right]+R_{L}\left(C_{C}+C_{G D 9}+C_{L}\right)}  \tag{10.24}\\
& \omega_{p 2}^{\prime} \approx \frac{R_{S}\left[\left(1+g_{m 9} R_{L}\right)\left(C_{C}+C_{G D 9}\right)+C_{E}\right]+R_{L}\left(C_{C}+C_{G D 9}+C_{L}\right)}{\left.R_{S} R_{L}\left[\left(C_{C}+C_{G D 9}\right) C_{E}+\left(C_{C}+C_{G D 9}\right) C_{L}+C_{E} C_{L}\right)\right]} \tag{10.25}
\end{align*}
$$

These expressions are based on the assumption that $\left|\omega_{p 1}^{\prime}\right| \ll\left|\omega_{p 2}^{\prime}\right|$. Before compensation, however, $\omega_{p 1}$ and $\omega_{p 2}$ are of the same order of magnitude. For $C_{C}=0$ and relatively large $C_{L}$, we may approximate the magnitude of the output pole as $\omega_{p 2} \approx 1 /\left(R_{L} C_{L}\right)$.

To compare the magnitudes of $\omega_{p 2}^{\prime}$ before and after compensation, we consider a typical case: $C_{C}+$ $C_{G D 9} \gg C_{E}$, reducing (10.25) to $\omega_{p 2}^{\prime} \approx g_{m 9} /\left(C_{E}+C_{L}\right)$. Noting that typically $C_{E} \ll C_{L}$, we conclude that Miller compensation increases the magnitude of the output pole by roughly a factor of $g_{m 9} R_{L}$, a relatively large value. Intuitively, this is because at high frequencies, $C_{C}$ provides a low impedance between the gate and drain of $M_{9}$, reducing the resistance seen by $C_{L}$ from $R_{L}$ to roughly $R_{S}\left\|g_{m 9}^{-1}\right\| R_{L} \approx$ $g_{m 9}^{-1}\left[\right.$ Fig. 10.29(b)]. From another perspective, $C_{C}$ provides feedback around the second stage by sensing the output voltage; as a result, the output resistance falls and the second pole moves to higher frequencies. ${ }^{5}$

In summary, Miller compensation moves the interstage pole toward the origin and the output pole away from the origin, allowing a much greater bandwidth than that obtained by merely connecting the compensation capacitor from one node to ground. In practice, the choice of the compensation capacitor for proper phase margin requires some iteration because both poles move. The following example gives a rough estimate.

#### Example 10.6

The two-stage op amp of Fig. 10.25 incorporates Miller compensation to reach a phase margin of $45^{\circ}$. Estimate the compensation capacitor value.

[^72]
#### Solution

After frequency compensation, the dominant pole moves down to approximately $\left(g_{m 9} R_{L} C_{C} R_{S}\right)^{-1}$, where $R_{S}$ denotes the output resistance of the first stage, and the second pole moves up to roughly $g_{m 9} / C_{L}$. For a phase margin of $45^{\circ}$, the loop gain must drop to unity at the second pole. With a low-frequency loop gain of $\beta g_{m 1} R_{S} g_{m 9} R_{L}$, we consider the postcompensation plot in Fig. 10.30 (on linear axes) and write

$$
\begin{equation*}
|\beta H(\omega)| \approx \frac{\beta g_{m 1} R_{S} g_{m 9} R_{L}}{\sqrt{1+\omega^{2} / \omega_{p 1}^{, 2}}} \tag{10.26}
\end{equation*}
$$

where the effect of $\omega_{p 2}^{\prime}$ on the magnitude is neglected. At $\omega=\omega_{p 2}^{\prime}$, the second term under the square root dominates, and

$$
\begin{equation*}
\frac{\beta g_{m 1} R_{S} g_{m 9} R_{L}}{\omega_{p 2}^{\prime} / \omega_{p 1}^{\prime}}=1 \tag{10.27}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-429.jpg?height=363&width=685&top_left_y=981&top_left_x=470)

Figure 10.30
Substituting for the pole frequencies and assuming that $\beta=1$, we obtain

$$
\begin{equation*}
C_{C}=\frac{g_{m 1}}{g_{m 9}} C_{L} \tag{10.28}
\end{equation*}
$$

Note that $g_{m 1}$ and $g_{m 9}$ are the transconductances of the two stages. The reader can prove that, if the effect of $\omega_{p 2}^{\prime}$ is included, then $C_{C}=\left[g_{m 1} /\left(\sqrt{2} g_{m 9}\right)\right] C_{L}$. Of course, $C_{C}$ must generally be greater than this value so as to establish a higher phase margin, but this estimate serves as a reasonable starting point in the design.

This result assumes that $\beta=1$; in practice, most op amps are configured for a closed-loop gain of 2 or higher, thus requiring a smaller $C_{C}$.

Our study of stability and compensation has thus far neglected the effect of zeros of the transfer function. While in cascode topologies, the zeros are far from the origin, in two-stage op amps incorporating Miller compensation, a nearby zero appears in the circuit. Recall from Chapter 6 that the circuit of Fig. 10.29 contains a right-half-plane zero at $\omega_{z}=g_{m 9} /\left(C_{C}+C_{G D 9}\right)$. This is because $C_{C}+C_{G D 9}$ forms a "feedforward" signal path from the input to the output. What is the effect of such a zero? The numerator of the transfer function reads $\left(1-s / \omega_{z}\right)$, yielding a phase of $-\tan ^{-1}\left(\omega / \omega_{z}\right)$, a negative value because $\omega_{z}$ is positive. In other words, as with poles in the left half plane, a zero in the right half plane contributes additional negative phase shift, thus moving the phase crossover toward the origin. Furthermore, from Bode approximations, the zero slows down the drop of the magnitude, thereby pushing the gain crossover away from the origin. As a result, the stability degrades considerably.

To better understand the foregoing discussion, let us construct the Bode plots for a third-order system containing a dominant pole $\omega_{p 1}$, two nondominant poles $\omega_{p 2}$ and $\omega_{p 3}$, and a zero in the right half plane $\omega_{z}$. For two-stage op amps, typically $\left|\omega_{p 1}\right|<\left|\omega_{z}\right|<\left|\omega_{p 2}\right|$. As shown in Fig. 10.31, the zero introduces significant phase shift while preventing the gain from falling sufficiently.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-430.jpg?height=613&width=719&top_left_y=371&top_left_x=795)

Figure 10.31 Effect of right-half-plane zero.

#### Example 10.7

Noting that the Miller compensation in Fig. 10.29(a) yields $\omega_{p 2} \approx g_{m 9} / C_{L}$ and $\omega_{z} \approx g_{m 9} / C_{C}$, a student decides to choose $C_{C}=C_{L}$, aiming to cancel the second pole by the zero. Explain what happens.

#### Solution

Recall that the zero is located in the right half plane and the poles in the left half plane. The compensated loop transmission can therefore be expressed as

$$
\begin{equation*}
\beta H(s)=\frac{\beta A_{0}\left(1-\frac{s}{\omega_{z}}\right)}{\left(1+\frac{s}{\omega_{p 1}}\right)\left(1+\frac{s}{\omega_{p 2}}\right)} \tag{10.29}
\end{equation*}
$$

We recognize that the zero does not cancel the pole and still affects $|\beta H|$ and $\angle \beta H$.

The right-half-plane zero in two-stage CMOS op amps, given by $g_{m} /\left(C_{C}+C_{G D}\right)$, is a serious issue because $g_{m}$ is relatively small and $C_{C}$ is chosen large enough to position the dominant pole properly. Various techniques for eliminating or moving the zero have been invented. Illustrated in Fig. 10.32, places a resistor in series with the compensation capacitor, thereby modifying the zero frequency. The output stage now exhibits three poles, but for moderate values of $R_{z}$, the third pole is located at high frequencies and the first two poles are close to the values calculated with $R_{z}=0$. Moreover, it can be
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-430.jpg?height=351&width=587&top_left_y=2067&top_left_x=588)

Figure 10.32 Addition of $R_{z}$ to move the right-half-plane zero.
shown (Problem 10.8) that the zero frequency is given by

$$
\begin{equation*}
\omega_{z} \approx \frac{1}{C_{C}\left(g_{m 9}^{-1}-R_{z}\right)} \tag{10.30}
\end{equation*}
$$

Thus, if $R_{z} \geq g_{m 9}^{-1}$, then $\omega_{z} \leq 0$. While $R_{z}=g_{m 9}^{-1}$ seems a natural choice, in practice we may even move the zero well into the left half plane so as to cancel the first nondominant pole. This occurs if

$$
\begin{equation*}
\frac{1}{C_{C}\left(g_{m 9}^{-1}-R_{z}\right)}=\frac{-g_{m 9}}{C_{L}+C_{E}} \tag{10.31}
\end{equation*}
$$

that is

$$
\begin{align*}
R_{z} & =\frac{C_{L}+C_{E}+C_{C}}{g_{m 9} C_{C}}  \tag{10.32}\\
& \approx \frac{C_{L}+C_{C}}{g_{m 9} C_{C}} \tag{10.33}
\end{align*}
$$

because $C_{E}$ is typically much less than $C_{L}+C_{C}$.
The possibility of canceling the nondominant pole makes this technique attractive, but in reality two important drawbacks must be considered. First, it is difficult to guarantee the relationship given by (10.33), especially if $C_{L}$ is unknown or variable. Mismatch between the pole and zero frequencies leads to the "doublet problem" (Problem 10.19). For example, as explained in Chapter 13, the load capacitance seen by an op amp may vary from one part of the period to another in switched-capacitor circuits, necessitating a corresponding change in $R_{z}$ and complicating the design. The second drawback relates to the actual implementation of $R_{z}$. Typically realized by a MOS transistor in the triode region (Fig. 10.33), $R_{z}$ changes substantially as output voltage excursions are coupled through $C_{C}$ to node $X$, thereby degrading the large-signal settling response.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-431.jpg?height=357&width=395&top_left_y=1630&top_left_x=618)
name:
value:
node: is

Figure 10.33 Effect of large output swings on $R_{z}$.

Generating $V_{b}$ in Fig. 10.33 is not straightforward because $R_{Z}$ must remain equal to $\left(1+C_{L} / C_{C}\right) / g_{m 9}$ despite process and temperature variations. A common approach is illustrated in Fig. 10.34 [2], where diode-connected devices $M_{13}$ and $M_{14}$ are placed in series. If $I_{1}$ is chosen with respect to $I_{D 9}$ such that $V_{G S 13}=V_{G S 9}$, then $V_{G S 15}=V_{G S 14}$. Since $g_{m 14}=\mu_{p} C_{o x}(W / L)_{14}\left(V_{G S 14}-V_{T H 14}\right)$ and $R_{o n 15}=$ $\left[\mu_{p} C_{o x}(W / L)_{15}\left(V_{G S 15}-V_{T H 15}\right)\right]^{-1}$, we have $R_{o n 15}=g_{m 14}^{-1}(W / L)_{14} /(W / L)_{15}$. For pole-zero cancellation to occur,

$$
\begin{equation*}
g_{m 14}^{-1} \frac{(W / L)_{14}}{(W / L)_{15}}=g_{m 9}^{-1}\left(1+\frac{C_{L}}{C_{C}}\right) \tag{10.34}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-432.jpg?height=404&width=600&top_left_y=378&top_left_x=584)

Figure 10.34 Generation of $V_{b}$ for proper temperature and process tracking.
and hence

$$
\begin{equation*}
(W / L)_{15}=\sqrt{(W / L)_{14}(W / L)_{9}} \sqrt{\frac{I_{D 9}}{I_{D 14}}} \frac{C_{C}}{C_{C}+C_{L}} \tag{10.35}
\end{equation*}
$$

If $C_{L}$ is constant, (10.35) can be established with reasonable accuracy because it contains only the ratio of quantities.

Another method of guaranteeing Eq. (10.33) is to use a simple resistor for $R_{Z}$ and define $g_{m 9}$ with respect to a resistor that closely matches $R_{Z}$ [3]. Depicted in Fig. 10.35, this technique incorporates $M_{b 1}-M_{b 4}$ along with $R_{S}$ to generate $I_{b} \propto R_{S}^{-2}$. (This circuit is studied in detail in Chapter 12.) Thus, $g_{m 9} \propto \sqrt{I_{D 9}} \propto \sqrt{I_{D 11}} \propto R_{S}^{-1}$. Proper ratioing of $R_{Z}$ and $R_{S}$ therefore ensures that (10.33) is valid even with temperature and process variations.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-432.jpg?height=431&width=713&top_left_y=1401&top_left_x=525)

Figure 10.35 Method of defining $g_{m 9}$ with respect to $R_{S}$.

The principal drawback of the two methods described above is that they assume square-law characteristics for all of the transistors. As described in Chapter 17, short-channel MOSFETs may substantially deviate from the square-law regime, creating errors in the foregoing calculations. In particular, transistor $M_{9}$ is typically a short-channel device because it appears in the signal path and its raw speed is critical.

An attribute of two-stage op amps that makes them inferior to "one-stage" op amps is the susceptibility to the load capacitance. Since Miller compensation establishes the dominant pole at the output of the first stage, a higher load capacitance presented to the second stage moves the second pole toward the origin, degrading the phase margin. By contrast, in one-stage op amps, a higher load capacitance brings the dominant pole closer to the origin, improving the phase margin (albeit making the feedback system more overdamped). Illustrated in Fig. 10.36 is the step response of a unity-gain feedback amplifier employing a one-stage or a two-stage op amp, suggesting that the response approaches an oscillatory behavior if the load capacitance seen by the two-stage op amp increases.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-433.jpg?height=564&width=1081&top_left_y=378&top_left_x=545)

Figure 10.36 Effect of increased load capacitance on step response of one- and two-stage op amps.

## 10.6 ■ Slewing in Two-Stage Op Amps

It is instructive to study the slewing characteristics of two-stage op amps. Before delving into the details, let us consider the simple circuit shown in Fig. 10.37(a), where $I_{i n}$ is a current step given by $I_{S S} u(t)$ and $C_{F}$ has a zero initial condition. If $A$ is large, node $X$ is a virtual ground and the voltage across $C_{F}$ is approximately equal to $V_{o u t}$. Receiving a constant current equal to $I_{S S}, C_{F}$ generates an output voltage given by

$$
\begin{equation*}
V_{\text {out }}(t) \approx \frac{I_{S S}}{C_{F}} t \tag{10.36}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-433.jpg?height=406&width=1417&top_left_y=1589&top_left_x=377)

Figure 10.37 (a) Simplified circuit for slew study, (b) realization of (a), and (c) output waveform during slewing.
We now consider the implementation depicted in Fig. $10.37(\mathrm{~b})^{6}$ and write $V_{\text {out }} / r_{O}+g_{m} V_{X}+I_{\text {in }}=I_{1}$ and $C_{F} d\left(V_{\text {out }}-V_{X}\right) / d t=I_{i n}$. Substituting for $V_{X}$ from the former equation in the latter, we have

$$
\begin{equation*}
C_{F}\left(1+\frac{1}{g_{m} r_{O}}\right) \frac{d V_{\text {out }}}{d t}=I_{\text {in }}-\frac{C_{F}}{g_{m}} \frac{d I_{\text {in }}}{d t} \tag{10.37}
\end{equation*}
$$

[^73]We consider the terms on the right-hand side as two inputs and apply superposition, obtaining

$$
\begin{equation*}
V_{\text {out }}(t)=\frac{I_{S S}}{C_{F}\left(1+\frac{1}{g_{m} r_{O}}\right)} t u(t)-\frac{I_{S S}}{g_{m}+\frac{1}{r_{O}}} u(t) \tag{10.38}
\end{equation*}
$$

(This voltage, of course, rides on top of a bias value.) As illustrated in Fig. 10.37(c), $V_{\text {out }}$ initially jumps to $-I_{S S} /\left(g_{m}+r_{O}^{-1}\right)$ and subsequently ramps up with a slope equal to $I_{S S} /\left[C_{F}\left(1+g_{m}^{-1} r_{O}^{-1}\right)\right]$. It is interesting to note that (1) at $t=0^{+}, C_{F}$ acts as a short circuit, allowing $I_{i n}$ to flow through $\left(1 / g_{m}\right) \| r_{O}$ and creating a downward step at the output; (2) the slope of the ramp suggests an equivalent capacitance of $C_{F}\left(1+g_{m}^{-1} r_{O}^{-1}\right)$, revealing the Miller effect of $C_{F}$ at the output; and (3) Eq. (10.38) does not depend on $I_{1}$ because this current simply serves as the bias current of $M_{\text {out }}$. We approximate the output voltage as $V_{\text {out }}(t) \approx\left(I_{S S} / C_{F}\right) t u(t)$.

Let us return to a two-stage op amp and suppose that in Fig. 10.38(a), $V_{i n}$ experiences a large positive step at $t=0$, turning off $M_{2}, M_{4}$, and $M_{3}$. The circuit can then be simplified to that in Fig. 10.38(b), revealing that $C_{C}$ is charged by a constant current $I_{S S}$ if parasitic capacitances at node $X$ are negligible. Recognizing that the gain of the output stage makes node $X$ a virtual ground, we write $V_{\text {out }}(t) \approx$ $\left(I_{S S} t / C_{C}\right) u(t)$. Thus, the positive slew rate ${ }^{7}$ equals $I_{S S} / C_{C}$. Note that during slewing, $M_{5}$ must provide two currents: $I_{S S}$ and $I_{1}$. If $M_{5}$ is not wide enough to sustain $I_{S S}+I_{1}$ in saturation, then $V_{X}$ drops significantly, possibly driving $M_{1}$ into the triode region.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-434.jpg?height=759&width=1264&top_left_y=1280&top_left_x=528)

Figure 10.38 (a) Simple two-stage op amp, (b) simplified circuit during positive slewing, and (c) simplified circuit during negative slewing.

For the negative slew rate, we simplify the circuit as shown in Fig. 10.38(c). Here $I_{1}$ must support both $I_{S S}$ and $I_{D 5}$. For example, if $I_{1}=I_{S S}$, then $V_{X}$ rises so as to turn off $M_{5}$. If $I_{1}<I_{S S}$, then $M_{3}$ enters the triode region and the slew rate is given by $I_{D 3} / C_{C}$.

[^74]
#### Example 10.8

Op amps typically drive a heavy load capacitance. Repeat the slew rate analysis if the circuit of Fig. 10.37(b) sees a load capacitance of $C_{L}$. For simplicity, neglect channel-length modulation.

#### Solution

We consider two cases: $I_{i n}$ flows into or out of node $X$. With $\lambda=0$, the steady-state gain from $V_{X}$ to $V_{\text {out }}$ is infinite, forcing $X$ to be a virtual ground node. In the first case [Fig. 10.39(a)], $I_{i n}=I_{S S u}(t)$ flows through $C_{F}$, generating a ramp voltage across it. Since $V_{X}$ is constant, the voltage at the right terminal of $C_{F}, V_{\text {out }}$, must fall at a rate of $I_{S S} / C_{F}$. This also means that $C_{L}$ is discharged at the same rate, requiring that the transistor draw three currents: $I_{1}, I_{S S}$, and $C_{L} d V_{\text {out }} / d t=\left(C_{L} / C_{F}\right) I_{S S}$. Thus, so long as $M_{\text {out }}$ remains in saturation, the output slew rate is approximately equal to $I_{S S} / C_{F}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-435.jpg?height=434&width=1471&top_left_y=834&top_left_x=353)

Figure 10.39
Now, let us study the second case [Fig. 10.39(b)]. If $X$ is a virtual ground, $V_{\text {out }}$ must rise at a rate of $I_{S S} / C_{F}$, and $C_{L}$ must also receive a current of $C_{L} d V_{\text {out }} / d t=\left(C_{L} / C_{F}\right) I_{S S}$. We observe that, if $I_{1}>I_{S S}\left(C_{L} / C_{F}\right)+I_{S S}$, then $M_{\text {out }}$ remains on, $V_{X}$ varies little, and the output slew rate is equal to $I_{S S} / C_{F}$. On the other hand, if $I_{1}<$ $\left(1+C_{L} / C_{F}\right) I_{S S}, M_{\text {out }}$ turns off, the difference between $I_{1}$ and $I_{S S}$ charges $C_{L}$ [Fig. 10.39(c)], and the slew rate is given by $\left(I_{1}-I_{S S}\right) / C_{L}$, a low value.

Two-Stage Class-AB Op Amps The two-stage class-AB op amp studied in Chapter 9 can incorporate Miller compensation as well. Recall, however, that the current mirrors in the signal path contribute an additional pole, degrading the phase margin. For this reason, two-stage class-AB op amps are typically slower than their class-A counterparts.

We wish to compute the slew rate of two-stage class-AB op amps. Let us redraw the circuit of Fig. 10.39(b) for this op amp topology (Fig. 10.40). In this case, too, the slew rate is equal to ( $\left.I_{1}-I_{S S}\right) / C_{L}$ if $M_{\text {out }}$ turns off, but, by virtue of class-AB operation, $I_{1}$ itself can be quite large. The current mirror action yields $I_{1}=\left(W_{p 1} / W_{p 2}\right) \alpha I_{i n}$ and hence a slew rate of $\left[\alpha\left(W_{p 1} / W_{p 2}\right)-1\right] I_{S S} / C_{L}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-435.jpg?height=441&width=555&top_left_y=1973&top_left_x=541)

Figure 10.40 Simplified class-AB op amp.

## 10.7 ■ Other Compensation Techniques

The difficulty in compensating two-stage CMOS op amps arises from the feedforward path formed by the compensation capacitor [Fig. 10.41(a)]. If $C_{C}$ could conduct current from the output node to node $X$ but not vice versa, then the zero would move to a very high frequency. As shown in Fig. 10.41(b), this can be accomplished by inserting a source follower in series with the capacitor. Since the gate-source capacitance of $M_{2}$ is typically much less than $C_{C}$, we expect the right-half-plane zero to occur at high frequencies. Assuming that $\gamma=\lambda=0$ for the source follower, neglecting some of the device capacitances, and simplifying the circuit as shown in Fig. 10.42, we can write $-g_{m 1} V_{1}=V_{\text {out }}\left(R_{L}^{-1}+C_{L} s\right)$, and hence

$$
\begin{equation*}
V_{1}=\frac{-V_{\text {out }}}{g_{m 1} R_{L}}\left(1+R_{L} C_{L} s\right) \tag{10.39}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-436.jpg?height=424&width=1135&top_left_y=925&top_left_x=552)

Figure 10.41 (a) Two-stage op amp with right-half-plane zero due to $C_{C}$; (b) addition of a source follower to remove the zero.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-436.jpg?height=372&width=676&top_left_y=1462&top_left_x=546)

Figure 10.42 Simplified equivalent circuit of Fig. 10.41(b).

We also have

$$
\begin{equation*}
\frac{V_{\text {out }}-V_{1}}{\frac{1}{g_{m 2}}+\frac{1}{C_{C} s}}+I_{\text {in }}=\frac{V_{1}}{R_{S}} \tag{10.40}
\end{equation*}
$$

Substituting for $V_{1}$ from (10.39) yields

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{-g_{m 1} R_{L} R_{S}\left(g_{m 2}+C_{C} s\right)}{R_{L} C_{L} C_{C}\left(1+g_{m 2} R_{S}\right) s^{2}+\left[\left(1+g_{m 1} g_{m 2} R_{L} R_{S}\right) C_{C}+g_{m 2} R_{L} C_{L}\right] s+g_{m 2}} \tag{10.41}
\end{equation*}
$$

Thus, the circuit contains a zero in the left half plane, which can be chosen to cancel one of the poles. The zero can also be derived as illustrated in Fig. 6.18.

We can also compute the magnitudes of the two poles, assuming that they are widely separated. Since typically $1+g_{m 2} R_{S} \gg 1$ and $\left(1+g_{m 1} g_{m 2} R_{L} R_{S}\right) C_{C} \gg g_{m 2} R_{L} C_{L}$, we have

$$
\begin{align*}
\omega_{p 1} & \approx \frac{g_{m 2}}{g_{m 1} g_{m 2} R_{L} R_{S} C_{C}}  \tag{10.42}\\
& \approx \frac{1}{g_{m 1} R_{L} R_{S} C_{C}} \tag{10.43}
\end{align*}
$$

and

$$
\begin{align*}
\omega_{p 2} & \approx \frac{g_{m 1} g_{m 2} R_{L} R_{S} C_{C}}{R_{L} C_{L} C_{C} g_{m 2} R_{S}}  \tag{10.44}\\
& \approx \frac{g_{m 1}}{C_{L}} \tag{10.45}
\end{align*}
$$

Thus, the new values of $\omega_{p 1}$ and $\omega_{p 2}$ are similar to those obtained by simple Miller approximation. For example, the output pole has moved from $\left(R_{L} C_{L}\right)^{-1}$ to $g_{m 1} / C_{L}$.

The primary issue in the circuit of Fig. 10.41(b) is that the source follower limits the lower end of the output voltage to $V_{G S 2}+V_{I 2}$, where $V_{I 2}$ is the voltage required across $I_{2}$. For this reason, it is desirable to utilize the compensation capacitor to isolate the dc levels in the active feedback stage from that at the output. Such a topology is depicted in Fig. 10.43, where $C_{C}$ and the common-gate stage $M_{2}$ convert the output voltage swing to a current, returning the result to the gate of $M_{1}$ [4]. If $V_{1}$ changes by $\Delta V$ and $V_{\text {out }}$ by $A_{v} \Delta V$, then the current through the capacitor is nearly equal to $A_{v} \Delta V C_{C} s$ because $1 / g_{m 2}$ can be relatively small. Thus, a change $\Delta V$ at the gate of $M_{1}$ creates a current change of $A_{v} \Delta V C_{C} s$, providing a capacitor multiplication factor equal to $A_{v}$.

Assuming that $\lambda=\gamma=0$ for the common-gate stage, we redraw the circuit of Fig. 10.43 in Fig. 10.44, where we have

$$
\begin{equation*}
V_{\text {out }}+\frac{g_{m 2} V_{2}}{C_{C} s}=-V_{2} \tag{10.46}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-437.jpg?height=423&width=741&top_left_y=1643&top_left_x=422)

Figure 10.43 Compensation technique using a common-gate stage.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-437.jpg?height=343&width=699&top_left_y=2091&top_left_x=466)

Figure 10.44 Simplified equivalent circuit of Fig. 10.43.
and hence

$$
\begin{equation*}
V_{2}=-V_{\text {out }} \frac{C_{C} s}{C_{C} s+g_{m 2}} \tag{10.47}
\end{equation*}
$$

Also,

$$
\begin{equation*}
g_{m 1} V_{1}+V_{\text {out }}\left(\frac{1}{R_{L}}+C_{L} s\right)=g_{m 2} V_{2} \tag{10.48}
\end{equation*}
$$

and $I_{i n}=V_{1} / R_{S}+g_{m 2} V_{2}$. Solving these equations, we obtain

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{-g_{m 1} R_{S} R_{L}\left(g_{m 2}+C_{C} s\right)}{R_{L} C_{L} C_{C} S^{2}+\left[\left(1+g_{m 1} R_{S}\right) g_{m 2} R_{L} C_{C}+C_{C}+g_{m 2} R_{L} C_{L}\right] s+g_{m 2}} \tag{10.49}
\end{equation*}
$$

As with the circuit of Fig. 10.41(b), this topology contains a zero in the left half plane. Using similar approximations, we compute the poles as

$$
\begin{align*}
& \omega_{p 1} \approx \frac{1}{g_{m 1} R_{L} R_{S} C_{C}}  \tag{10.50}\\
& \omega_{p 2} \approx \frac{g_{m 2} R_{s} g_{m 1}}{C_{L}} \tag{10.51}
\end{align*}
$$

Interestingly, the second pole has considerably risen in magnitude - by a factor of $g_{m 2} R_{S}$ with respect to that of the circuit of Fig. 10.41. This is because at very high frequencies, the feedback loop consisting of $M_{2}$ and $R_{S}$ in Fig. 10.43 lowers the output resistance by the same factor. Of course, if the capacitance at the gate of $M_{1}$ is taken into account, pole splitting is less pronounced. Nevertheless, this technique can potentially provide a high bandwidth in two-stage op amps.

The op amp of Fig. 10.43 entails important slewing issues. For positive slewing at the output, the simplified circuit of Fig. 10.45(a) suggests that $M_{2}$ and hence $I_{1}$ must support $I_{S S}$, requiring that $I_{1} \geq$ $I_{S S}+I_{D 1}$. If $I_{1}$ is less, then $V_{P}$ drops, turning $M_{1}$ off, and if $I_{1}<I_{S S}, M_{0}$ and its tail current source must enter the triode region, yielding a slew rate equal to $I_{1} / C_{C}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-438.jpg?height=561&width=1171&top_left_y=1646&top_left_x=569)

Figure 10.45 Circuit of Fig. 10.43 during (a) positive and (b) negative slewing.
For negative slewing, $I_{2}$ must support both $I_{S S}$ and $I_{D 2}$ [Fig. 10.45(b)]. As $I_{S S}$ flows into node $P, V_{P}$ tends to rise, increasing $I_{D 1}$. Thus, $M_{1}$ absorbs the current produced by $I_{3}$ through $C_{C}$, turning off $M_{2}$ and opposing the increase in $V_{P}$. We can therefore consider $P$ a virtual ground node. This means that,
for equal positive and negative slew rates, $I_{3}$ (and hence $I_{2}$ ) must be as large as $I_{S S}$, raising the power dissipation.

Op amps using a cascode topology as their first stage can incorporate a variant of the technique illustrated in Fig. 10.43. Shown in Fig. 10.46(a), this approach places the compensation capacitor between the source of the cascode devices and the output nodes. Using the simplified model of Fig. 10.46(b) and the method of Fig. 6.18, the reader can prove that the zero appears at $\left(g_{m 4} R_{e q}\right)\left(g_{m 9} / C_{C}\right)$, a much greater magnitude than $g_{m 9} / C_{C}$. If other capacitances are neglected, it can also be proved that the dominant pole is located at approximately $\left(R_{e q} g_{m 9} R_{L} C_{C}\right)^{-1}$, as if $C_{C}$ were connected to the gate of $M_{9}$ rather the source of $M_{4}$. The first nondominant pole is given by $g_{m 4} g_{m 9} R_{e q} / C_{L}$, an effect similar to that described by Eq. (10.51). In reality, the capacitance at $X$ may create a significant pole because the resistance seen at this node is quite large. The analysis of the slew rate is left as an exercise for the reader. (One can also insert a resistor in series with each $C_{C}$ to move the zero frequency.)

It is possible to combine two compensation techniques. As shown in Fig. 10.46(a), both $C_{C}$ and $C_{C}^{\prime}$ provide greater flexibility in the design.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-439.jpg?height=633&width=1462&top_left_y=967&top_left_x=360)

Figure 10.46 (a) Alternative method of compensating two-stage op amps; (b) simplified equivalent circuit of (a).

## 10.8 - Nyquist's Stability Criterion ${ }^{8}$

### 10.8.1 Motivation

Our analysis of stability in negative-feedback systems has drawn upon Bode's view of the loop transmission, namely, the magnitude and phase plots as a function of frequency, but only for $s=j \omega$. To understand the shortcomings of this approach. let us consider the loop transmission plots shown in Fig. 10.47, where $\beta=1$ and $|H|$ is equal to 3 at the phase crossover frequency, $\omega_{0}$. Our previous studies suggest that such a feedback system is unstable because it has a negative phase margin. However, if we write the closed-loop transfer function as $Y / X=H(s) /[1+H(s)]$ and assume that $s=j \omega_{0}$, then we have

$$
\begin{align*}
\frac{Y}{X}\left(j \omega_{0}\right) & =\frac{-3}{1-3}  \tag{10.52}\\
& =\frac{3}{2} \tag{10.53}
\end{align*}
$$

[^75]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-440.jpg?height=548&width=1269&top_left_y=369&top_left_x=520)

Figure 10.47 Unstable system Bode plots.

Since the closed-loop gain is less than infinity at $\omega_{0}$, the circuit cannot oscillate at this frequency. In fact, for no value of $s=j \omega$ in Fig. 10.47 can we find the condition $Y / X=\infty$. For example, at $\omega_{u}$, we have $Y / X=\exp (j \theta) /[1+\exp (j \theta)]<\infty$ if $\theta \neq x \times 180^{\circ}$.

Should we conclude that this system does not oscillate?! This difficulty arises because Bode plots confine $s$ to imaginary values, i.e., they predict the behavior with only simple sinusoids. Indeed, this study shows that no simple sinusoid can circulate around the loop indefinitely. This, however, does not preclude other unstable waveforms. For example, suppose $s$ is equal to $\sigma_{1}+j \omega_{1}$ with $\sigma_{1}>0$, representing a growing sinusoid. It is possible that in the system of Fig. 10.47, $H\left(s=\sigma_{1}+j \omega_{1}\right)=-1$; that is, $Y / X$ goes to infinity for a growing sinusoid, allowing such a waveform to survive. Whether or not $s=\sigma_{1}+j \omega_{1}$ exists is predicted by Nyquist's theorem but not by Bode plots.

We can exploit Nyquist's stability analysis, for it provides greater insight and, more important, tackles complex circuits more clearly. For a loop transmission $\beta H(s)$, this analysis predicts how many zeros $1+\beta H(s)$ has in the right half plane (RHP) or on the $j \omega$ axis. If it has none, then the closed-loop system is stable.

Nyquist's method, however, is less intuitive and demands additional background in complex number theory. The reader should study this section patiently. We remind the reader that the poles and zeros of a transfer function can be shown on the complex $s$ plane (Fig. 10.48).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-440.jpg?height=388&width=1052&top_left_y=1724&top_left_x=594)

### 10.8.2 Basic Concepts

在笛卡尔坐标上绘画 环路增益的幅度和相位 VS频率
Bode's approach to stability analysis plots the magnitude and phase of the loop gain versus frequency in Cartesian coordinates. We can also plot these two parameters in polar coordinates, in which every point is defined by an angle, $\theta$, and a radius, $r$, rather than by $x$ and $y$ [Fig. 10.49(a)]. As the frequency varies, so do $\angle H$ and $|H|$, creating a "contour" in these coordinates [Fig. 10.49(b)]. The horizontal and vertical axes in Fig. 10.49(a) also carry a meaning: the projections of the vector on the two are expressed as
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-440.jpg?height=115&width=446&top_left_y=2426&top_left_x=532)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-441.jpg?height=359&width=954&top_left_y=366&top_left_x=611)

Figure 10.49 (a) One value of $H(s)$ shown in polar coordinates, and (b) contour of $H(s)$ as the frequency varies.
$|H| \cos (\angle H)$ and $|H| \sin (\angle H)$, respectively, with the former being the real part of $H$ and the latter, the imaginary part. We thus denote the two axes by $\operatorname{Re}\{H\}$ and $\operatorname{Im}\{H\}$, respectively. We call the polar plot of $H(s)$ the " $H$ contour." We initially assume that $s=j \omega$, but later allow it to become complex.

As an example, let us plot $H(s)=A_{0} /\left(1+s / \omega_{p}\right)$ in polar coordinates if $s$ is replaced with $j \omega$ and $\omega$ varies from 0 to $+\infty$. The phase, $-\tan ^{-1}\left(\omega / \omega_{p}\right)$, begins at zero and approaches $-90^{\circ}$ while the magnitude, $A_{0} / \sqrt{1+\omega^{2} / \omega_{p}^{2}}$, varies from $A_{0}$ to zero. Figure 10.50 sketches both the Bode plots and the polar plot, highlighting the corresponding points at $\omega=0(M)$ and $\omega=\infty(N)$. The reader may wonder how we know that the polar plot is a semicircle. It is possible to prove this by calculating $\operatorname{Im}\{H\}$ and $\operatorname{Re}\{H\}$, but, as seen later, we do not have any interest in the actual shape. The beauty of Nyquist's method is that it primarily considers $\omega=0$ and $\omega= \pm \infty$, avoiding the need for lengthy algebra.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-441.jpg?height=512&width=1155&top_left_y=1260&top_left_x=502)

Figure 10.50 Bode and polar plots of $H$ as $s=j \omega$ goes from zero to infinity.
This simple example readily demonstrates various decisions that we must make while plotting the $H$ contour: (1) the contour begins at $\left(A_{0}, 0\right)$ for $\omega=0$ and travels to the left because it must eventually reach the origin for $\omega=\infty$; (2) the contour falls below the horizontal axis because $\angle H$ is negative; and (3) the contour approaches the origin at an angle of $-90^{\circ}$.

Since calculating $|H|$ and $\angle H$ is generally cumbersome, we wish to construct polar plots by considering only the poles and zeros of the transfer function. To understand the objective, consider the complex $s$ plane for the above example, where the pole is real and equal to $-\omega_{p}$ (Fig. 10.51). As $\omega$ goes from 0 to $+\infty$, we begin at the origin and travel upward on the $j \omega$ axis. ${ }^{9}$ Can we construct the polar plot of $H$ by examining what happens in the $s$ plane?

Let us first see whether $\angle H$ can be directly computed in the $s$ plane. To this end, we consider one value for $s$ and denote it by $s_{1}=\sigma_{1}+j \omega_{1}$, a complex value. Shown in Fig. 10.52 for a one-pole system,

[^76]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-442.jpg?height=277&width=334&top_left_y=378&top_left_x=720)

Figure 10.51 The $s$ plane with one pole.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-442.jpg?height=377&width=435&top_left_y=707&top_left_x=661)

Figure 10.52 Phase shift produced by a pole at frequency $s_{1}$.
the $s$ plane can yield a value for $\angle H\left(s=s_{1}\right)$. Since

$$
\begin{align*}
H\left(s_{1}\right) & =\frac{A_{0}}{1+\frac{\sigma_{1}+j \omega_{1}}{\omega_{p}}}  \tag{10.54}\\
& =\frac{A_{0} \omega_{p}}{\sigma_{1}+\omega_{p}+j \omega_{1}} \tag{10.55}
\end{align*}
$$

we have

$$
\begin{equation*}
\angle H\left(s_{1}\right)=-\tan ^{-1} \frac{\omega_{1}}{\sigma_{1}+\omega_{p}} \tag{10.56}
\end{equation*}
$$

Thus, the angle $\theta$ in Fig. 10.52 is equal to $-\angle H\left(s_{1}\right)$. That is, to determine $\angle H\left(s_{1}\right)$ in the $s$ plane, we draw a vector from the pole to $s_{1}$, measure the angle of this vector with respect to the positive $\sigma$ axis, and multiply the result by -1 . For the phase contributed by a zero, the procedure is the same, except that the result is not multiplied by -1 . If $H$ contains multiple poles and zeros, then their phase contributions simply add algebraically.

It is possible to calculate $|H|$ from the $s$ plane as well, ${ }^{10}$ but, fortunately, the exact knowledge of $|H|$ is not necessary in Nyquist's approach.

### 10.8.3 Construction of Polar Plots

In this section, we study examples of plotting $H(s)$ in polar coordinates so as to prepare ourselves for Nyquist's stability criterion.

General First-Order System Suppose $H(s)=A_{0}\left(1+s / \omega_{z}\right) /\left(1+s / \omega_{p}\right)$ and $\omega_{p}>\omega_{z}$. We first plot $H$ for $s=j \omega$ as $\omega$ varies from 0 to $+\infty$. At $\omega=0,|H(s)|=A_{0}$. Also, as shown in Fig. 10.53(a), the vectors going from the pole and the zero to $s=0$ contribute equal and opposite angles, yielding

[^77]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-443.jpg?height=971&width=1643&top_left_y=356&top_left_x=344)

Figure 10.53 (a) Phase shifts contributed by a pole and a zero at $s=0$, (b) phase shifts at $s=j \omega_{1}$, (c) contour of $H$ as $s$ goes from zero to $j \omega_{1}$, (d) phase shifts as $s \rightarrow j \infty$, (e) correct contour of $H$, (f) corresponding Bode plots, and ( g ) complete $H$ contour.
$\angle H(0)=0$. Now, if $s$ rises to $j \omega_{1}$ [Fig. 10.53(b)], the angle contributed by the zero, $\theta_{z}$, is greater than that contributed by the pole, $\theta_{p}$. That is, $\angle H=\theta_{z}-\theta_{p}$ remains positive. We have thus far constructed the $H$ contour shown in Fig. 10.53(c). The reader may wonder whether $\left|H\left(j \omega_{1}\right)\right|$ is greater or less than $A_{0}$, but we do not concern ourselves at this point.

What happens as $s$ goes toward $+j \infty$ ? As depicted in Fig. 10.53(d), the angles arising from the zero and the pole approach $90^{\circ}$, producing a net value of 0 for $\angle H$. The magnitude of $H$, on the other hand, approaches $A_{0} \omega_{p} / \omega_{z}>A_{0}$. This means that the $H$ contour returns to the $\sigma$ axis, but at a more positive real value. Our guess in Fig. 10.53(c) is therefore not quite correct and must be revised to that in Fig. 10.53(e). For completeness, we also show the Bode plots in Fig. 10.53(f).

It is necessary to repeat this procedure as $s=j \omega$ goes from 0 to $-j \infty$. Since the $s$ plane contents are always symmetric with respect to the $\sigma$ axis for a physical system (due to conjugate symmetry of the poles and zeros), the polar plot is also symmetric, emerging as shown in Fig. 10.53(g).

What if $\omega_{p}<\omega_{z}$ ? As shown in Fig. 10.54(a), the net angle is now negative as $s$ travels upward on the $j \omega$ axis. Moreover, since $|H(j \omega=0)|=A_{0}$ and $|H(j \omega=+j \infty)|=A_{0} \omega_{p} / \omega_{z}<A_{0}$, the $H$ contour begins from $A_{0}$ on the real axis, rotates downward, and shrinks in magnitude [Fig. 10.54(b)]. For $s=0$ to $-j \infty$, this plot is reflected around the real axis in a manner similar to that in Fig. 10.53(g). The Bode plots are also constructed in Fig. 10.54(c) to highlight the correspondences.

We have mostly confined the $s$ values in $H(s)$ to the $j \omega$ axis. In general, however, $s$ can travel on an arbitrary path (contour) in the $s$ plane, assuming complex, real, or imaginary values. It is therefore beneficial to consider the behavior of the foregoing first-order system in such a case. For example, suppose $s$ travels clockwise on a closed contour in the right half plane [Fig. 10.55(a)]. How does $H(s)=A_{0}\left(1+s / \omega_{z}\right) /\left(1+s / \omega_{p}\right)$ behave if $\omega_{p}>\omega_{z}$ ? At point $M, s$ is real and equal to $\sigma_{M}$, yielding
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-444.jpg?height=527&width=1477&top_left_y=368&top_left_x=416)

Figure 10.54 System with $\omega_{p}<\omega_{z}$, (b) contour of $H$, and (c) corresponding Bode plots.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-444.jpg?height=802&width=1379&top_left_y=983&top_left_x=450)

Figure 10.55 (a) $s$ contour excluding pole and zero, (b) possible trajectories for $H$, (c) actual $H$ contour, and (d) $H$ contour if $-\omega_{z}<-\omega_{p}$.
$H(s)=A_{0}\left(1+\sigma_{M} / \omega_{z}\right) /\left(1+\sigma_{M} / \omega_{p}\right)$, a real point in the polar plot of $H$ [Fig. 10.55(b)]. As $s$ departs from $M$, the net angle becomes more positive because the zero contributes more phase than the pole does, but we do not know whether the $H$ contour rises to the left or to the right. We therefore continue the $s$ contour to point $N$, noting that the angle returns to zero and $H(s)=A_{0}\left(1+\sigma_{N} / \omega_{z}\right) /\left(1+\sigma_{N} / \omega_{p}\right)$, which is greater than $H\left(s=\sigma_{M}\right)$ if $\omega_{p}>\omega_{z}$. Thus, the $H$ contour must rise to the right, i.e., rotate clockwise. Figure 10.55(c) depicts the complete plot as $s$ traverses clockwise the contour in the $s$ plane from $M$ to $N$ and from $N$ back to $M$. For the case of $\omega_{p}<\omega_{z}, H$ rotates counterclockwise [Fig. 10.55(d)] because $H\left(\sigma_{N}\right)<H\left(\sigma_{M}\right)$. The reader is encouraged to repeat this analysis for $H(s)=A_{0} /\left(1+s / \omega_{p}\right)$.

Let us consider another $s$ contour that encloses the pole and the zero of the transfer function. As illustrated in Fig. 10.56(a), we begin at point $M$ and observe a net angle of zero and $H\left(\sigma_{M}\right)=A_{0}(1+$ $\left.\sigma_{M} / \omega_{z}\right) /\left(1+\sigma_{M} / \omega_{p}\right)$. Since $\sigma_{M}$ is more negative than $-\omega_{z}$ and $-\omega_{p}, H\left(\sigma_{M}\right)>0$, yielding a point on
the real axis for the polar plot of $H$ [Fig. 10.56(b)]. As we travel clockwise on the $s$ contour, say to point $s_{1}$, the net angle becomes positive (why?), eventually returning to zero as we reach point $N$. Since $\sigma_{N}$ is less negative than $-\omega_{z}$ and $-\omega_{p}, H\left(\sigma_{N}\right)>0$. The reader can prove that $H\left(\sigma_{N}\right)>H\left(\sigma_{M}\right)$. If we now continue on the $s$ contour from $N$ toward $M$, the polar plot of $H$ becomes negative and returns to zero. It is important to note that the $H$ contour does not enclose the origin. We say that $H$ does not "encircle" the origin. The $s$ contours in both Figs. 10.55(a) and 10.56(a) lead to $H$ contours that do not encircle the origin. The significance of this point becomes clear later.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-445.jpg?height=417&width=1057&top_left_y=687&top_left_x=554)

Figure 10.56 (a) $s$ contour enclosing pole and zero, and (b) $H$ contour.

What happens if the first-order system has no zero? As shown in Fig. 10.57(a), $\angle H$ is equal to $-180^{\circ}$ at point $M$, reaching $-90^{\circ}$ at $s_{1}$ and zero at $N$. Also, $H\left(\sigma_{M}\right)=A_{0} /\left(1+\sigma_{M} / \omega_{p}\right)<0$ and $H\left(\sigma_{N}\right)>0$ [Fig. 10.57(b)]. We thus observe that $H(s)$ encircles the origin in this case, and that the encirclement is in the counterclockwise direction. Similarly, if the system has only one zero and no pole, a clockwise $s$ contour containing the zero maps to an $H$ contour that encircles the origin in the clockwise direction [Fig. 10.57(c)]. We hereafter assume that the $s$ contours are symmetric around the $\sigma$ axis, obtaining polar plots that are symmetric around the real axis.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-445.jpg?height=845&width=1132&top_left_y=1544&top_left_x=519)

Figure 10.57 (a) System with one pole, (b) $H$ contour, and (c) $s$ and $H$ contours if system has only one zero.

We now study a first-order system that has both a zero and a pole while the $s$ contour encircles only the pole. We note from Fig. 10.58(a) that the polar plot of $H(s)$ assumes a positive value at $M$, as it did in Fig. 10.56(b). As $s$ begins from point $M$ and traverses the contour clockwise, $\angle H$ becomes more positive, reaching $180^{\circ}$ at point $N$ [Fig. 10.58(b)]. (It is helpful as a crosscheck to show that $H\left(\sigma_{N}\right)<0$.) Thus, the $H$ contour encircles the origin counterclockwise in a manner similar to that in Fig. 10.57(b). The reader can repeat this exercise with an $s$ contour enclosing only the zero and prove that the plot of $H(s)$ encircles the origin clockwise.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-446.jpg?height=454&width=1081&top_left_y=689&top_left_x=611)

Figure 10.58 (a) $s$ contour enclosing only one pole, and (b) $H$ contour.
Second-Order System Consider $H(s)=A_{0}\left[\left(1+s / \omega_{p 1}\right)\left(1+s / \omega_{p 2}\right)\right]^{-1}$ and assume that $s$ travels upward on the $j \omega$ axis [Fig. 10.59(a)]. We recognize that $|H(s)|$ begins at $A_{0}$ and falls as $s \rightarrow+j \infty$. Also, $\angle H(s)$ begins at 0 and becomes more negative, reaching $-90^{\circ}$ and, asymptotically, $-180^{\circ}$. As depicted in Fig. 10.59(b), the $H$ contour begins at $A_{0}$, rotates clockwise, crosses the $j \omega$ axis when
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-446.jpg?height=902&width=1290&top_left_y=1444&top_left_x=498)

Figure 10.59 (a) Two-pole system, (b) $H$ contour as $s$ travels up on the $j \omega$ axis, (c) $s$ contour chosen to enclose both poles, and (d) corresponding $H$ contour.
$\angle H=-90^{\circ}$, enters the third quadrant, and eventually returns to the origin at a $180^{\circ}$ angle. For $s=0$ to $-j \infty$, this plot is reflected around the real axis.

What if the contour of $s$ encloses both poles? From Fig. 10.59(c), we note that $\angle H=-360^{\circ}$ at $M$ and $H\left(\sigma_{M}\right)>0$. As we travel clockwise on the $s$ contour to some point $s_{1}$, the angle becomes less negative, e.g., equal to $-320^{\circ}=+40^{\circ}$. Thus, the $H$ contour rotates counterclockwise [Fig. 10.59(d)]. At some point, $s_{2}$, the net angle is around $-270^{\circ}=+90^{\circ}$, and at some other point, $s_{3}$, we have $\angle H\left(s_{3}\right)=-180^{\circ}$. As $s$ approaches point $N, H(s)$ reaches a real, positive value. The other symmetric half is shown in gray for clarity. We observe that the polar plot encircles the origin twice in the counterclockwise direction if the $s$ contour encircles two poles in the clockwise direction.

### 10.8.4 Cauchy's Principle

From the foregoing studies, we postulate that, if the $s$ contour encircles $P$ poles and $Z$ zeros of $H(s)$ in the clockwise direction, then the polar plot of $H(s)$ encircles the origin $Z-P$ times in the same direction. This is known as "Cauchy's Principle of Argument." For example, if the $s$ contour encircles clockwise three zeros and no poles, then the $H$ contour encircles the origin $3-0=3$ times clockwise. As seen earlier, the $H$ contour is constructed primarily from the angles contributed by the poles and zeros, with little need for the exact knowledge of $|H|$.

We have thus far assumed that we know the locations of the poles and zeros of a transfer function and we construct the polar plot to see how many times it encircles the origin. One can embark on a different task: suppose we know that an $s$ contour contains $P$ poles but do not know the number of zeros within the contour. If we still manage to draw the polar plot of the transfer function and find that it encircles the origin clockwise $N$ times, we can conclude that the number of zeros within the $s$ contour is equal to $Z=N+P$. This is the key to Nyquist's stability theorem.

### 10.8.5 Nyquist's Method

Having studied the foregoing concepts patiently, the reader is now ready to learn Nyquist's stability analysis. A negative-feedback system whose closed-loop transfer function is given by

$$
\begin{equation*}
\frac{Y}{X}(s)=\frac{H(s)}{1+\beta H(s)} \tag{10.57}
\end{equation*}
$$

becomes unstable if it has any poles on the $j \omega$ axis or in the right half plane, both of which we call herein the "critical region." In other words, if $1+\beta H(s)$ has any zeros in this critical region, then the system is unstable.

How do we determine whether $1+\beta H(s)$ has any zeros in the critical region? Let us construct an $s$ contour containing this region (Fig. 10.60). From Cauchy's principle, we know that the polar plot of
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-447.jpg?height=420&width=1120&top_left_y=1946&top_left_x=511)

Figure 10.60 Critical region in the $s$ plane and the corresponding $H$ contour.
$1+\beta H(s)$ encircles the origin $Z-P$ times, where $Z$ and $P$ respectively denote the number of zeros and poles that $1+\beta H(s)$ contains within the $s$ contour. We thus proceed as follows: (1) independently determine $P$, (2) draw the polar plot of $1+\beta H(s)$ as $s$ traverses the contour shown in Fig. 10.60, (3) determine the number of times, $N$, that $1+\beta H(s)$ encircles the origin clockwise, and (4) find $P+N$ as the number of zeros that $1+\beta H(s)$ has in the critical region.

We must recognize a point that simplifies our task. The poles of $1+\beta H(s)$ are in fact the same as the poles of $H(s)$. If the open-loop system is stable (as is the case in most of our circuits), then $H(s)$ has no poles in the critical region and $N=Z$. Unless otherwise stated, we assume this to be true.

Before studying examples of the above procedure, we make one change that leads us to Nyquist's theorem: if the polar plot of $1+\beta H(s)$ encircles the origin, then the polar plot of $\beta H(s)$ encircles the point $(-1,0)$ (Fig. 10.61) because the latter is obtained by shifting the former to the left by one unit. Nyquist's theorem articulates this result as for a closed-loop system, $H(s) /[1+\beta H(s)]$, to be stable, the polar plot of $\beta H(s)$ must not encircle the point $(-1,0)$ clockwise as $s$ traverses a contour around the critical region clockwise.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-448.jpg?height=417&width=1172&top_left_y=980&top_left_x=568)

Figure 10.61 Polar plots of $1+\beta H(s)$ and $\beta H(s)$.
In applying Nyquist's theorem, we must choose the $s$ contour so as to minimize the mathematical labor. One possibility is depicted in Fig. 10.62: we begin at the origin, travel on the $j \omega$ axis to $+j \infty$, go around the RHP on a very large radius, continue to $j \omega=-j \infty$, and return to the origin on the $j \omega$ axis. The reader may wonder what exactly happens now that the contour does not enclose the $j \omega$ axis. If $1+\beta H(s)$ has any zeros on this axis, then the polar plot of $\beta H(s)$ goes through the point $(-1,0)$ rather than encircle it. [Recall from Bode plots that $1+\beta H\left(j \omega_{1}\right)=0$ translates to $\left|\beta H\left(j \omega_{1}\right)\right|=1$ and $\angle H\left(j \omega_{1}\right)=180^{\circ}$.] Since the $s$ contour is symmetric around the $\sigma$ axis, we construct the $\beta H$ contour only as $s$ goes from the origin to $M$ and $N$, and simply reflect the result around the real axis to complete the task.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-448.jpg?height=385&width=446&top_left_y=1869&top_left_x=661)

Figure 10.62 Simple contour enclosing the $j \omega$ axis and RHP.

#### Example 10.9

Study the closed-loop stability if $H(s)=A_{0} /\left(1+s / \omega_{p 1}\right)$.

#### Solution

For the $s$ contour shown in Fig. 10.63(a), $\beta H(s)$ begins at $\beta A_{0}$ for $s=0$. As $s=j \omega$ moves upward, the phase becomes more negative. At $+j \infty$, the phase goes to $-90^{\circ}$ and the magnitude drops to zero, i.e., the polar plot reaches the origin at an angle of $-90^{\circ}$ [Fig. 10.63(b)]. What happens as $s$ enters the right half plane? Traveling in the RHP at a very long radius, $s$ keeps $\beta H(s)$ at zero. That is, the entire RHP contour from $M$ to $N$ maps to the origin. We reflect this polar plot around the real axis to obtain the complete $\beta H$ contour. Since the contour does not encircle $(-1,0)$, the closed-loop system is always stable.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-449.jpg?height=385&width=550&top_left_y=686&top_left_x=434)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-449.jpg?height=389&width=667&top_left_y=684&top_left_x=1056)
(b)

Figure 10.63 (a) $s$ contour for a one-pole system, and (b) $\beta H$ contour.

#### Example 10.10

Study the closed-loop stability if $H(s)=A_{0} /\left[\left(1+s / \omega_{p 1}\right)\left(1+s / \omega_{p 2}\right)\right]$.

#### Solution

At $s=0, \beta H(s)=\beta A_{0}$. As $s=j \omega$ moves upward, the two poles contribute negative phase (Fig. 10.64). At $s=+j \infty$, the phase goes to $-180^{\circ}$ and the magnitude falls to zero, i.e., the polar plot reaches the origin at an angle of $180^{\circ}$. The $\beta H$ contour remains at the origin as $s$ traverses the RHP at a very long radius from $M$ to $N$. Since the contour does not encircle $(-1,0)$, the closed-loop system is stable for any value of the feedback factor, $\beta$. The reader is encouraged to repeat this exercise for increasingly larger values of $\omega_{p 2}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-449.jpg?height=392&width=590&top_left_y=1702&top_left_x=437)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-449.jpg?height=386&width=690&top_left_y=1705&top_left_x=1033)
(b)

Figure $10.64 s$ plane and $\beta H$ contours for a two-pole system.

#### Example 10.11

Study the closed-loop stability if $H(s)=A_{0} /\left[\left(1+s / \omega_{p 1}\right)\left(1+s / \omega_{p 2}\right)\left(1+s / \omega_{p 3}\right)\right]$.

#### Solution

The polar plot of $\beta H(s)$ begins at $\beta A_{0}$ and rotates clockwise, reaching an angle of $-270^{\circ}=+90^{\circ}$ and a magnitude of zero at $s=+j \infty$ [Fig. 10.65(a)]. The reflection of this half around the real axis completes the plot, revealing that the $\beta H$ contour can encircle $(-1,0)$ depending on the location of the intersection point, $Q$. At this point, $\angle \beta H=-180^{\circ}$, i.e., $\tan ^{-1}\left(\omega_{Q} / \omega_{p 1}\right)+\tan ^{-1}\left(\omega_{Q} / \omega_{p 2}\right)+\tan ^{-1}\left(\omega_{Q} / \omega_{p 3}\right)=180^{\circ}$. With the pole values known, one can compute $\omega_{Q}$ and hence $\left|\beta H\left(s=j \omega_{Q}\right)\right|$ so as to determine whether point $Q$ is to the right or to the left of $(-1,0)$. The corresponding calculation on Bode plots is illustrated in Fig. 10.65(b).

What happens to the $\beta H$ contour in Fig. 10.65(a) if different values of $\beta$ are chosen? Since the radius at every point on the plot is proportional to $\beta$, the contour contracts as $\beta$ decreases and expands as $\beta$ increases. Illustrated in Fig. 10.65(c), this trend confirms that a higher feedback factor can make a three-pole system unstable.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-450.jpg?height=1055&width=1433&top_left_y=779&top_left_x=435)

Figure 10.65 (a) $s$ and $H$ contours for three-pole system, (b) corresponding Bode plots, and (c) $H$ contour for different values of $\beta$.

In some cases, it may not be straightforward to determine how many times the $\beta H$ contour encircles $(-1,0)$ clockwise. The general procedure for counting the number of encirclements is as follows: (1) draw a straight line from $(-1,0)$ to infinity in any direction, (2) count the number of times the contour crosses this line in clockwise and counterclockwise directions, and (3) subtract the latter from the former.

### 10.8.6 Systems with Poles at Origin 在原点由极点的系统

Some open-loop systems contain one or more poles at the origin. For example, the integrator shown in Fig. 10.66 has the following transfer function:

$$
\begin{equation*}
H(s)=\frac{-1}{R_{1} C_{1} s} \tag{10.58}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-451.jpg?height=279&width=509&top_left_y=337&top_left_x=561)

Figure 10.66 Integrator.
if the op amp is ideal. When such systems are placed in a negative-feedback loop, their Nyquist stability analysis must choose a slightly different $s$ contour. We begin with a one-pole system as depicted in Fig. 10.67(a) and seek a contour that does not go through the origin so as to avoid an infinite value for $\beta H(s)$. Rather than begin at $(0,0)$, we travel on an infinitesimally small circle around it given by $\epsilon \exp (j \phi)$ until we reach the $j \omega$ axis and then move upward. The key point here is that $\epsilon$ is very small, simplifying the calculations.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-451.jpg?height=500&width=1219&top_left_y=1002&top_left_x=473)

Figure 10.67 (a) $s$ plane contour bypassing pole at origin, and (b) corresponding $\beta H$ contour.

If $H(s)=A_{0} / s$ and we choose $s=\epsilon \exp (j \phi)$, then $\beta H(s)=\beta\left(A_{0} / \epsilon\right) \exp (-j \phi)$. At $\phi=0, s=\epsilon$, and $\beta H$ is real and very large [Fig. 10.67(b)]. As $s$ traverses the circle, $\phi$ rotates toward $+90^{\circ}$ and $\beta\left(A_{0} / \epsilon\right) \exp (-j \phi)$ remains at a very large radius, approaching $-90^{\circ}$. This behavior is indicated by a dashed curve in Fig. 10.67(b) to emphasize the large radius. Now, $s$ travels upward on the $j \omega$ axis, still retaining a phase of $-90^{\circ}$ (due to the pole at the origin), while $|\beta H|$ falls, i.e., $\beta H$ goes toward the origin at an angle of $-90^{\circ}$ and remains at $(0,0)$ as $s$ enters the RHP (not shown in the $s$ plane). The other half of the contour is obtained if $s$ begins from the RHP (not shown), arrives at $-j \infty$, travels toward the origin on the $j \omega$ axis, and traverses the circle $\epsilon \exp (j \phi)$ from $\phi=-90^{\circ}$ to $\phi=0$. Note that the polar plot of $\beta H$ does not encircle $(-1,0)$.

#### Example 10.12

Analyze the closed-loop stability of $H(s)=A_{0}\left(1+s / \omega_{z}\right) / s$. The zero can be created, for example, by inserting a resistor in series with $C_{1}$ in Fig. 10.66.

#### Solution

With $s=\epsilon \exp (j \phi)$ in Fig. 10.68(a), $\beta H(s) \approx \beta\left(A_{0} / \epsilon\right) \exp (-j \phi)$ because $\epsilon$ is small. Shown in Fig. 10.68(b) is the $\beta H$ contour. Even at $\phi=90^{\circ}$, the zero contributes negligible phase because the circle's radius is very small. As we travel upward on the $j \omega$ axis, the zero begins to add positive phase, and $\beta H(s)=\beta A_{0}\left(1+s / \omega_{z}\right) / s$ approaches a real value equal to $\beta A_{0} / \omega_{z}$ at $s=+j \infty$. In contrast to the case illustrated in Fig. 10.67, this contour is deflected away from the origin by the zero.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-452.jpg?height=538&width=1209&top_left_y=363&top_left_x=544)

Figure 10.68

#### Example 10.13

A negative-feedback loop employs two ideal integrators, i.e., $H(s)=A_{0} / s^{2}$. Study the closed-loop stability of the system.

#### Solution

We begin with $s=\epsilon \exp (j \phi), \phi=0$, and hence $\beta H=\beta A_{0} / \epsilon^{2}$ (Fig. 10.69). As $\phi$ goes to $+45^{\circ}$ (point $N$ ), $\beta H(s)=\beta\left(A_{0} / \epsilon^{2}\right) \exp (-2 j \phi)$ rotates by $-90^{\circ}$, still at a very large radius. For $\phi=+90^{\circ}$ (point $\left.P\right), \beta H(s)$ returns to the real axis. Now, as $s=+j \omega$ travels upward, the angle remains unchanged, but the magnitude, $\beta|H(j \omega)|=\beta A_{0} / \omega^{2}$, falls. That is, $\beta H$ continues on the real axis toward the origin, passing through $(-1,0)$ at $\omega=\sqrt{\beta A_{0}}$. The closed-loop system therefore contains two poles on the $j \omega$ axis because it crosses $(-1,0)$ twice. After all, we can write $H(s) /[1+\beta H(s)]=A_{0} /\left(s^{2}+\beta A_{0}\right)$, observing two imaginary poles at $\pm j \sqrt{\beta A_{0}}$. Thus, a two-pole system can oscillate if it has two poles at the origin.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-452.jpg?height=560&width=1347&top_left_y=1578&top_left_x=475)

Figure 10.69

#### Example 10.14

Repeat the previous example if a zero is added to one of the integrators, i.e., $H(s)=A_{0}\left(1+s / \omega_{z}\right) / s^{2}$.

#### Solution

With $s=\epsilon \exp (j \phi)$ and $\phi=0$, we have $\beta H \approx \beta A_{0} / \epsilon^{2}$. The behavior of $\beta H$ is similar to that in the previous example up to point $P$ (Fig. 10.70). As $s=+j \omega$ travels upward, the zero begins to contribute appreciable phase and $|\beta H(j \omega)|=\beta A_{0} \sqrt{1+\omega^{2} / \omega_{z}^{2}} / \omega^{2}$ continues to fall. As $s \rightarrow+j \infty, \angle \beta H$ approaches $-90^{\circ}$, suggesting that the $\beta H$ contour must reach the origin at an angle of $-90^{\circ}$. As shown in Fig. 10.70, the zero ensures that $\beta H$ does not cross or encircle $(-1,0)$, stabilizing the closed-loop system.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-453.jpg?height=558&width=1253&top_left_y=657&top_left_x=453)

Figure 10.70

The foregoing example sheds light on a common paradox that the Bode plots of the two-integrator system conjure up, especially in the context of phase-locked loops (Chapter 16). As shown in Fig. 10.71, it appears that the above closed-loop system is capable of oscillation at a frequency $\omega_{1}$, at which $|\beta H|$ is greater than unity and $\angle \beta H=-180^{\circ}$. But we observe from the Nyquist plot in Fig. 10.70 or from $\beta H\left(j \omega_{1}\right)=-\beta A_{0}\left(1+j \omega_{1} / \omega_{z}\right) / \omega_{1}^{2}$ that, owing to the zero, the phase of $\beta H$ never reaches exactly $180^{\circ}$. That is, at point $P$ in Fig. 10.70, the infinitesimal phase contributed by the zero causes $|\angle \beta H|$ to be less than $180^{\circ}$. Similarly, even though the approximate Bode plots of Fig. 10.71 suggest a phase of $180^{\circ}$ for $\omega_{1} \ll \omega_{z}$, in reality this amount of phase occurs only at $\omega=0$. The story, however, does not end here. The next section provides a more fundamental understanding.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-453.jpg?height=629&width=664&top_left_y=1793&top_left_x=478)

Figure 10.71 Bode plots of a system with two poles at origin and one zero.

### 10.8.7 Systems with Multiple $180^{\circ}$ Crossings

Consider a system whose loop transmission has three poles and two zeros as shown in Fig. 10.72(a). Illustrated in Fig. 10.72(b), the Bode plots reveal that the phase crosses $-180^{\circ}$ twice while the gain remains higher than unity. Is this system stable when placed in a negative-feedback loop?

```
波特图显示:相位曲线2次跨
过了-18\mp@subsup{0}{}{\circ},然而增益却依然
高于单位增益
```

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-454.jpg?height=704&width=690&top_left_y=630&top_left_x=427)
(c)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-454.jpg?height=408&width=690&top_left_y=1381&top_left_x=430)
(d)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-454.jpg?height=562&width=684&top_left_y=597&top_left_x=1194)
(b)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-454.jpg?height=418&width=696&top_left_y=1373&top_left_x=1168)
(e)

Figure 10.72 (a) System with three poles and two zeros, (b) Bode plots, (c) $\beta H$ contour, (d) case where $C$ is to the left of $(-1,0)$, and (e) case where $C$ is to the right of $(-1,0)$.

In the absence of the zeros, the $\beta H$ contour crosses $-180^{\circ}$ and approaches the origin at an angle of $-270^{\circ}$ [Fig. 10.65(a)]. We now construct the Nyquist plot as follows. As we begin from the origin in Fig. 10.72(a) and travel up on the $j \omega$ axis, the phase starts at zero and the $\beta H$ contour at point $A$ in Fig. 10.72(c). Due to the higher number of poles, $\angle \beta H$ becomes negative, reaching $-180^{\circ}$ (point $B$ ) for some value of $j \omega$. As $\omega$ increases further, $\angle \beta H$ becomes more negative, but, due to the contribution of the zeros, it deflects, forcing the $\beta H$ contour to return to the real axis (point $C$ ). The phase then becomes more positive and, for $\omega \rightarrow \infty$, approaches $-90^{\circ}$ (point $D$ ). Drawing the other symmetric half, we distinguish between two cases.

1. Point $C$ is to the left of $(-1,0)$ [Fig. 10.72(d)]; if we draw a line from $(-1,0)$ to infinity, it crosses the contour twice (at $P$ and $Q$ ), but the contour has opposite directions at these two points. The
closed-loop system therefore has no poles in the RHP. Since both $B$ and $C$ are to the right of $(-1,0)$, this case corresponds to the Bode plots of Fig. 10.72(b).
2. Point $(-1,0)$ lies between $C$ and $B$ [Fig. 10.72(e)]. In this case, the system is unstable.

We summarize the above results as follows. If $\angle \beta H$ crosses $180^{\circ}$ an even (odd) number of times while $|\beta H|>1$, then the system is stable (unstable).
