# CHAPTER 16 Phase-Locked Loops

The concept of phase locking was invented in the 1930s and swiftly found wide usage in electronics and communication. While the basic phase-locked loop has remained nearly the same since then, its implementation in different technologies and for different applications continues to challenge designers. A PLL serving the task of clock generation in a microprocessor appears quite similar to a frequency synthesizer used in a cellphone, but the actual circuits are designed quite differently.

This chapter deals with the analysis and design of PLLs, with particular attention to implementations in VLSI technologies. A thorough study of PLLs would require an entire book by itself, but our objective here is to lay the foundation for more advanced work. Beginning with a simple PLL architecture, we study the phenomenon of phase locking and analyze the behavior of PLLs in the time and frequency domains. We then address the problem of lock acquisition and describe charge-pump PLLs (CPPLLs) and their nonidealities. Finally, we examine jitter in PLLs, study delay-locked loops (DLLs), and present a number of PLL applications.

## 16.1 ■ Simple PLL

A PLL is a feedback system that compares the output phase with the input phase. The comparison is performed by a "phase comparator" or "phase detector" (PD). It is therefore beneficial to define the PD rigorously.

### 16.1.1 Phase Detector

A phase detector is a circuit whose average output, $\overline{V_{\text {out }}}$, is linearly proportional to the phase difference, $\Delta \phi$, between its two inputs (Fig. 16.1). In the ideal case, the relationship between $\overline{V_{\text {out }}}$ and $\Delta \phi$ is linear, crossing the origin for $\Delta \phi=0$. Called the "gain" of the PD, the slope of the line, $K_{P D}$, is expressed in V/rad.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-651.jpg?height=246&width=1017&top_left_y=2128&top_left_x=574)

Figure 16.1 Definition of phase detector.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-652.jpg?height=343&width=1127&top_left_y=368&top_left_x=590)

Figure 16.2 Exclusive OR gate as phase detector.

A familiar example of a phase detector is the exclusive OR (XOR) gate. As shown in Fig. 16.2, as the phase difference between the inputs varies, so does the width of the output pulses, thereby providing a dc level proportional to $\Delta \phi$. While the XOR circuit produces error pulses on both rising and falling edges, other types of PD may respond only to positive or negative transitions.

#### Example 16.1

If the output swing of the XOR in Fig. 16.2 is $V_{0}$ volts, what is the gain of the circuit as a phase detector? Plot the input-output characteristic of the PD.

#### Solution

If the phase difference increases from zero to $\Delta \phi$ radians, the area under each pulse increases by $V_{0} \cdot \Delta \phi$. Since each period contains two pulses, the average value rises by $2\left[V_{0} \cdot \Delta \phi /(2 \pi)\right]$, yielding a gain of $V_{0} / \pi$. Note that the gain is independent of the input frequency.

To construct the input-output characteristic, we examine the circuit's response to various input phase differences. As illustrated in Fig. 16.3, the average output voltage rises to $\left[V_{0} / \pi\right] \times \pi / 2=V_{0} / 2$ for $\Delta \phi=\pi / 2$ and $V_{0}$ for
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-652.jpg?height=868&width=1322&top_left_y=1501&top_left_x=493)

Figure 16.3
$\Delta \phi=\pi$. For $\Delta \phi>\pi$, the average begins to drop, falling to $V_{0} / 2$ for $\Delta \phi=3 \pi / 2$ and zero for $\Delta \phi=2 \pi$. The characteristic is therefore periodic, exhibiting both negative and positive gains.

### 16.1.2 Basic PLL Topology

To arrive at the concept of phase locking, let us consider the problem of aligning the output phase of a VCO with the phase of a reference clock. (The reader is encouraged to review the VCO mathematical model in the previous chapter.) As illustrated in Fig. 16.4(a), the rising edges of $V_{\text {out }}$ are "skewed" by $\Delta t$ seconds with respect to $V_{C K}$, and we wish to eliminate this error. Assuming that the VCO has a single control input, $V_{\text {cont }}$, we note that to vary the phase, we must vary the frequency and allow the integration $\phi=\int\left(\omega_{0}+K_{V C O} V_{c o n t}\right) d t$ to take place. For example, suppose that, as shown in Fig. 16.4(b), the VCO frequency is stepped to a higher value at $t=t_{1}$. The circuit then accumulates phase faster, gradually decreasing the phase error. At $t=t_{2}$, the phase error drops to zero and, if $V_{c o n t}$ returns to its original value, $V_{V C O}$ and $V_{C K}$ remain aligned. Interestingly, the alignment can be accomplished by stepping the VCO frequency to a lower value for a certain time interval as well (Problem 16.2). Thus, phase alignment can be achieved only by a (temporary) frequency change.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-653.jpg?height=618&width=1173&top_left_y=1075&top_left_x=499)

Figure 16.4 (a) Two waveforms with a skew; (b) change of VCO frequency to eliminate the skew.
The foregoing experiment suggests that the output phase of a VCO can be aligned with the phase of a reference if (1) the frequency of the VCO is changed momentarily, and (2) a means of comparing the two phases, i.e., a phase detector, is used to determine when the VCO and the reference signals are aligned. The task of aligning the output phase of the VCO with the phase of the reference is called "phase locking."

From the above observations, we surmise that a PLL simply consists of a PD and a VCO in a feedback loop [Fig. 16.5(a)]. The PD compares the phases of $V_{\text {out }}$ and $V_{\text {in }}$, generating an error that varies the VCO frequency until the phases are aligned, i.e., the loop is locked. This topology, however, must be modified
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-653.jpg?height=191&width=1311&top_left_y=2167&top_left_x=430)
(a)
(b)

Figure 16.5 (a) Feedback loop comparing input and output phases; (b) simple PLL.
because (1) as exemplified by the waveforms of Fig. 16.2, the PD output, $V_{P D}$, consists of a dc component (desirable) and high-frequency components (undesirable), and (2) as mentioned in Chapter 15, the control voltage of the oscillator must remain quiet in the steady state, i.e., the PD output must be filtered. We therefore interpose a low-pass filter (LPF) between the PD and the VCO [Fig. 16.5(b)], suppressing the high-frequency components of the PD output and presenting the dc level to the oscillator. This forms the basic PLL topology. For now, we assume that the LPF has a gain of unity at low frequencies (e.g., as in a first-order RC section).

It is important to bear in mind that the feedback loop of Fig. 16.5(b) compares the phases of the input and output. Unlike the feedback topologies studied in the previous chapters, PLLs typically require no knowledge of voltages or currents in their feedback operation. If the loop gain is large enough, the difference between the input phase, $\phi_{i n}$, and the output phase, $\phi_{\text {out }}$, falls to a small value in the steady state, providing phase alignment.

For subsequent analyses of PLLs, we must define the phase-lock condition carefully. If the loop of Fig. 16.5(b) is locked, we postulate that $\phi_{\text {out }}-\phi_{\text {in }}$ is constant and preferably small. We therefore define the loop to be locked if $\phi_{\text {out }}-\phi_{\text {in }}$ does not change with time. An important corollary of this definition is that

$$
\begin{equation*}
\frac{d \phi_{\text {out }}}{d t}-\frac{d \phi_{\text {in }}}{d t}=0 \tag{16.1}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\omega_{\text {out }}=\omega_{\text {in }} \tag{16.2}
\end{equation*}
$$

This is a unique property of PLLs and will be revisited more closely later.
In summary, when locked, a PLL produces an output that has a small phase error with respect to the input but exactly the same frequency. The reader may then wonder why a PLL is used at all. A short piece of wire would seem to perform the task even better! We answer this question in Sec. 16.5.

#### Example 16.2

Implement a simple PLL in CMOS technology.

#### Solution

Figure 16.6 illustrates an implementation utilizing an XOR gate as the phase detector. The VCO is configured as a negative- $G_{m}$ LC oscillator whose frequency is tuned by varactor diodes.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-654.jpg?height=440&width=759&top_left_y=1859&top_left_x=772)

Figure 16.6

PLL Waveforms in Locked Condition In order to familiarize ourselves with the behavior of PLLs, we begin with the simplest case: the circuit is locked and we wish to examine the waveforms at each point around the loop. As illustrated in Fig. 16.7(a), $V_{\text {in }}$ and $V_{\text {out }}$ exhibit a small phase difference but equal frequencies. The PD therefore generates pulses as wide as the skew between the input and the output, ${ }^{1}$ and the low-pass filter extracts the dc component of $V_{P D}$, applying the result to the VCO. We assume that the LPF has a gain of unity at low frequencies. The small pulses in $V_{L P F}$ are called "ripple."
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-655.jpg?height=463&width=851&top_left_y=779&top_left_x=364)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-655.jpg?height=615&width=529&top_left_y=660&top_left_x=1283)
(b)

Figure 16.7 (a) Waveforms in a PLL in locked condition; (b) calculation of phase error.
In the waveforms of Fig. 16.7(a), two quantities are unknown: $\phi_{0}$ and the dc level of $V_{\text {cont }}$. To determine these values, we construct the VCO and PD characteristics [Fig. 16.7(b)]. If the input and output frequencies are equal to $\omega_{1}$, then the required oscillator control voltage is unique and equal to $V_{1}$. This voltage must be produced by the phase detector, demanding a phase error determined by the PD characteristic. More specifically, since $\omega_{\text {out }}=\omega_{0}+K_{V C O} V_{\text {cont }}$ and $\overline{V_{P D}}=K_{P D} \Delta \phi$, we can write

$$
\begin{equation*}
V_{1}=\frac{\omega_{1}-\omega_{0}}{K_{V C O}} \tag{16.3}
\end{equation*}
$$

and

$$
\begin{align*}
\phi_{0} & =\frac{V_{1}}{K_{P D}}  \tag{16.4}\\
& =\frac{\omega_{1}-\omega_{0}}{K_{P D} K_{V C O}} \tag{16.5}
\end{align*}
$$

Equation (16.5) reveals two important points: (1) as the input frequency of the PLL varies, so does the phase error; and (2) to minimize the phase error, $K_{P D} K_{V C O}$ must be maximized.

#### Example 16.3

A PLL incorporates a VCO and a PD having the characteristics shown in Fig. 16.8. Explain what happens as the input frequency varies in the locked condition.

[^115]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-656.jpg?height=394&width=1003&top_left_y=366&top_left_x=653)

Figure 16.8

#### Solution

The PD characteristic is relatively linear near the origin but exhibits a small-signal gain of zero if the phase difference equals $\pm \pi / 2$, at which point the average output is equal to $\pm V_{0}$. Now suppose the input frequency increases from $\omega_{0}$, requiring a greater control voltage. If the frequency is high enough $\left(=\omega_{x}\right)$ to dictate $V_{c o n t}=V_{0}$, then the PD must operate at the peak of its characteristic. However, the PD gain drops to zero here and the feedback loop fails. Thus, the circuit cannot lock if the input frequency reaches $\omega_{X}$.

With the basic understanding of PLLs developed thus far, we now return to Eq. (16.2). The exact equality of the input and output frequencies of a PLL in the locked condition is a critical attribute. The significance of this property can be seen from two observations. First, in many applications, even a very small (deterministic) frequency error may prove unacceptable. For example, if a data stream is to be processed synchronously by a clocked system, even a slight difference between the data rate and the clock frequency results in a "drift," creating errors (Fig. 16.9). Second, the equality would not exist if the PLL compared the input and output frequencies rather than phases. As illustrated in Fig. 16.10(a), a loop employing a frequency detector (FD) would suffer from a finite difference between $\omega_{\text {in }}$ and $\omega_{\text {out }}$ due to various mismatches and other nonidealities. This can be understood by an analogy with the unity-gain feedback circuit of Fig. 16.10(b). Even if the op amp's open-loop gain is infinity, the input-referred offset voltage leads to a finite error between $V_{i n}$ and $V_{\text {out }}$.
Small Transients in Locked Condition Let us now analyze the response of a PLL in the locked condition to small phase or frequency transients at the input.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-656.jpg?height=256&width=1117&top_left_y=1784&top_left_x=590)

Figure 16.9 Drift of data with respect to clock in the presence of small frequency error.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-656.jpg?height=228&width=1175&top_left_y=2154&top_left_x=567)

Figure 16.10 (a) Frequency-locked loop; (b) unity-gain feedback amplifier.

Consider a PLL in the locked condition and assume that the input and output waveforms can be expressed as

$$
\begin{align*}
V_{\text {in }}(t) & =V_{A} \cos \omega_{1} t  \tag{16.6}\\
V_{\text {out }}(t) & =V_{B} \cos \left(\omega_{1} t+\phi_{0}\right) \tag{16.7}
\end{align*}
$$

where higher harmonics are neglected and $\phi_{0}$ is the static phase error. Suppose, as shown in Fig. 16.11, the input experiences a phase step of $\phi_{1}$ at $t=t_{1}$, i.e., $\phi_{i n}=\omega_{1} t+\phi_{1} u\left(t-t_{1}\right) .^{2}$ The phase step manifests itself as a rising edge in $V_{i n}$ that occurs earlier (or later) than the periodicity would dictate. Alternatively, we can say that the phase step results in a shorter (or longer) period just before $t_{1}$. Since the output of the LPF does not change instantaneously, the VCO initially continues to oscillate at $\omega_{1}$. The growing phase difference between the input and the output then creates wide pulses at the output of the PD, forcing $V_{L P F}$ to rise gradually. As a result, the VCO frequency begins to change, attempting to minimize the phase error. Note that the loop is not locked during the transient because the phase error varies with time.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-657.jpg?height=859&width=1336&top_left_y=1052&top_left_x=417)

Figure 16.11 Response of a PLL to a phase step.

What happens after the VCO frequency begins to change? If the loop is to return to lock, $\omega_{\text {out }}$ must eventually go back to $\omega_{1}$, requiring that $V_{L P F}$ and hence $\phi_{\text {out }}-\phi_{i n}$ also return to their original values. Since $\phi_{\text {in }}$ has changed by $\phi_{1}$, the variation in the VCO frequency is such that the area under $\omega_{\text {out }}$ provides an additional phase of $\phi_{1}$ in $\phi_{\text {out }}$ :

$$
\begin{equation*}
\int_{t 1}^{\infty} \omega_{\text {out }} d t=\phi_{1} \tag{16.8}
\end{equation*}
$$

[^116]Thus, when the loop settles, the output becomes equal to

$$
\begin{equation*}
V_{\text {out }}(t)=V_{B} \cos \left[\omega_{1} t+\phi_{0}+\phi_{1} u\left(t-t_{1}\right)\right] \tag{16.9}
\end{equation*}
$$

Consequently, as shown in Fig. 16.11, $\phi_{\text {out }}$ gradually "catches up" with $\phi_{i n}$.
It is important to make two observations. (1) After the loop returns to lock, all of the parameters (except for the total input and output phases) assume their original values. That is, $\phi_{\text {in }}-\phi_{\text {out }}, V_{L P F}$, and the VCO frequency remain unchanged-an expected result because these three parameters bear a one-to-one relationship and the input frequency has stayed the same. (2) The control voltage of the oscillator can serve as a suitable test point in the analysis of PLLs. While it is difficult to measure the time variations of phase and frequency in Fig. 16.11, $V_{\text {cont }}\left(=V_{L P F}\right)$ can be readily monitored in simulations and measurements.

The reader may wonder whether an input phase step always gives rise to the response shown in Fig. 16.11. For example, is it possible for $V_{L P F}$ to ring before settling to its final value? Such behavior is indeed possible and will be quantified in Sec. 16.1.3.

Let us now examine the response of PLLs to a small input frequency step $\Delta \omega$ at $t=t_{1}$ (Fig. 16.12). As with the case of a phase step, the VCO continues to oscillate at $\omega_{1}$ immediately after $t_{1}$. Thus, the PD generates increasingly wider pulses, and $V_{L P F}$ rises with time. As $\omega_{\text {out }}$ approaches $\omega_{1}+\Delta \omega$, the width of the pulses generated by the PD decreases, eventually settling to a value that produces a dc component equal to $\left(\omega_{1}+\Delta \omega-\omega_{0}\right) / K_{V C O}$. In contrast to the case of a phase step, the response of a PLL to a frequency step entails a permanent change in both the control voltage and the phase error. If the input frequency is varied slowly, $\omega_{\text {out }}$ simply "tracks" $\omega_{\text {in }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-658.jpg?height=748&width=1333&top_left_y=1294&top_left_x=485)

Figure 16.12 Response of a PLL to a small frequency step.
The exact settling behavior of PLLs depends on the various loop parameters and will be studied in Sec. 16.1.3. But, to arrive at an important observation, we consider the phase step response depicted in Fig. 16.13, where $V_{\text {cont }}$ rings before settling to its final value. Consider the state of the loop at $t=t_{2}$. At this point, the output frequency is equal to its final value (because $V_{\text {cont }}$ is equal to its final value), but the loop continues the transient because the phase error deviates from the required value. Similarly, at $t=t_{3}$, the phase error is equal to its final value, but the output frequency is not. In other words, for the loop to settle, both the phase and the frequency must settle to their proper values.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-659.jpg?height=432&width=1161&top_left_y=364&top_left_x=502)

Figure 16.13 Example of phase step response.

#### Example 16.4

In the PLL shown in Fig. 16.14, an external voltage $V_{e x}$ is added to the output of the low-pass filter. ${ }^{3}$ (a) Determine the phase error and $V_{L P F}$ if the loop is locked and $V_{e x}=V_{1}$. (b) Suppose $V_{e x}$ steps from $V_{1}$ to $V_{2}$ at $t=t_{1}$. How does the loop respond?
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-659.jpg?height=854&width=1285&top_left_y=1141&top_left_x=437)

Figure 16.14

#### Solution

(a) If the loop is locked, $\omega_{\text {out }}=\omega_{\text {in }}$ and $V_{\text {cont }}=\left(\omega_{\text {in }}-\omega_{0}\right) / K_{V C O}$. Thus, $V_{L P F}=\left(\omega_{\text {in }}-\omega_{0}\right) / K_{V C O}-V_{1}$ and $\Delta \phi=V_{L P F} / K_{P D}=\left(\omega_{i n}-\omega_{0}\right) /\left(K_{P D} K_{V C O}\right)-V_{1} / K_{P D}$.
(b) When $V_{e x}$ steps from $V_{1}$ to $V_{2}, V_{c o n t}$ immediately goes from $\left(\omega_{i n}-\omega_{0}\right) / K_{V C O}$ to $\left(\omega_{i n}-\omega_{0}\right) / K_{V C O}+\left(V_{2}-V_{1}\right)$, changing the VCO frequency to $\omega_{\text {in }}-K_{V C O}\left(V_{1}-V_{2}\right)$. Since $V_{L P F}$ cannot change instantaneously, the PD begins to

[^117]generate increasingly wider pulses, raising $V_{L P F}$ and increasing $\omega_{\text {out }}$. When the loop returns to lock, $\omega_{\text {out }}$ becomes equal to $\omega_{i n}$ and $V_{L P F}=\left(\omega_{i n}-\omega_{0}\right) / K_{V C O}-V_{2}$. The phase error also changes to $\left(\omega_{i n}-\omega_{0}\right) /\left(K_{P D} K_{V C O}\right)-$ $V_{2} / K_{P D}$. Note that the area under $\omega_{\text {out }}$ during the transient is equal to the change in the output phase and hence the change in the phase error:
\$\$

$$
\begin{equation*}
\int_{t 1}^{\infty} \omega_{\text {out }} d t=\frac{V_{1}-V_{2}}{K_{P D}} \tag{16.10}
\end{equation*}
$$

\$\$

From our study thus far, we conclude that phase-locked loops are "dynamic" systems, i.e., their response depends on the past values of the input and output. This is to be expected because the low-pass filter and the VCO introduce poles (and possibly zeros) in the loop transfer function. Moreover, we note that, so long as the input and the output remain perfectly periodic (i.e., $\phi_{\text {in }}=\omega_{\text {in }} t$ and $\phi_{\text {out }}=\omega_{\text {in }} t+\phi_{0}$ ), the loop operates in the steady state, exhibiting no transient. Thus, the PLL responds only to variations in the excess phase of the input or output. For example, in Fig. 16.11, $\phi_{\text {in }}=\omega_{1} t+\phi_{1} u\left(t-t_{1}\right)$, and in Fig. 16.12, $\phi_{i n}=\omega_{1} t+\Delta \omega \cdot t u\left(t-t_{1}\right)$.

### 16.1.3 Dynamics of Simple PLL

With the qualitative analysis of PLLs in the previous section, we can now study their transient behavior more rigorously. Assuming that the loop is initially locked, we treat the PLL as a feedback system but recognize that the output quantity in this analysis must be the (excess) phase of the VCO because the "error amplifier" can only compare phases. Our objective is to determine the transfer function $\Phi_{\text {out }}(s) / \Phi_{\text {in }}(s)$ for both open-loop and closed-loop systems and subsequently study the time-domain response. Note that the dimensions change from phase to voltage through the PD and from voltage to phase through the VCO.

What does $\Phi_{\text {out }}(s) / \Phi_{\text {in }}(s)$ signify? An analogy with more familiar transfer functions proves useful here. A circuit having a transfer function $V_{\text {out }}(s) / V_{\text {in }}(s)=1 /\left(1+s / \omega_{0}\right)$ is considered a low-pass filter because if $V_{\text {in }}$ varies rapidly, $V_{\text {out }}$ cannot fully track the input variations. Similarly, $\Phi_{\text {out }}(s) / \Phi_{\text {in }}(s)$ reveals how the output phase tracks the input phase if the latter changes slowly or rapidly.

To visualize the variation of the excess phase with time, consider the waveforms in Fig. 16.15. The period varies slowly in Fig. 16.15(a) and rapidly in Fig. 16.15(b). Thus, $y_{2}(t)$ experiences faster phase variations than does $y_{1}(t)$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-660.jpg?height=372&width=1023&top_left_y=1712&top_left_x=640)

Figure 16.15 Slow and fast variation of the excess phase.
Let us construct a linear model of the PLL, assuming a first-order low-pass filter for simplicity. The PD output contains a dc component equal to $K_{P D}\left(\phi_{\text {out }}-\phi_{i n}\right)$ as well as high-frequency components. Since the latter are suppressed by the LPF, we simply model the PD by a subtractor whose output is "amplified" by $K_{P D}$. Illustrated in Fig. 16.16, the overall PLL model consists of the phase subtractor, the LPF transfer function $1 /\left(1+s / \omega_{L P F}\right)$, where $\omega_{L P F}$ denotes the $-3-\mathrm{dB}$ bandwidth, and the VCO transfer function $K_{V C O} / s$ (Chapter 15). Here, $\Phi_{\text {in }}$ and $\Phi_{\text {out }}$ denote the excess phases of the input and
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-661.jpg?height=268&width=967&top_left_y=377&top_left_x=599)

Figure 16.16 Linear model of type I PLL.
output waveforms, respectively. For example, if the total input phase experiences a step change, $\phi_{1} u(t)$, then $\Phi_{i n}(s)=\phi_{1} / s$.

The open-loop transfer function is given by

$$
\begin{align*}
\left.H(s)\right|_{\text {open }} & =\left.\frac{\Phi_{\text {out }}}{\Phi_{\text {in }}}(s)\right|_{\text {open }}  \tag{16.11}\\
& =K_{P D} \cdot \frac{1}{1+\frac{s}{\omega_{L P F}}} \cdot \frac{K_{V C O}}{s} \tag{16.12}
\end{align*}
$$

revealing one pole at $s=-\omega_{L P F}$ and another at $s=0$. Note that the loop gain is equal to $\left.H(s)\right|_{\text {open }}$ because of the unity feedback factor. Since the loop gain contains a pole at the origin, the system is called "type I."

Before computing the closed-loop transfer function, let us make an important observation. What is the loop gain if $s$ is very small, i.e., if the input excess phase varies very slowly? Owing to the pole at the origin, the loop gain goes to infinity as $s$ approaches zero, a point of contrast to the feedback circuits studied in Chapters 8 and 10. Thus, the phase-locked loop (under closed-loop, locked condition) ensures that the change in $\phi_{\text {out }}$ is exactly equal to the change in $\phi_{\text {in }}$ as $s$ goes to zero. This result predicts two interesting properties of PLLs. First, if the input excess phase varies very slowly, the output excess phase "tracks" it. (After all, $\phi_{\text {out }}$ is "locked" to $\phi_{\text {in }}$.) Second, if the transients in $\phi_{i n}$ have decayed (another case corresponding to $s \rightarrow 0$ ), then the change in $\phi_{\text {out }}$ is precisely equal to the change in $\phi_{i n}$. This is indeed true in the example depicted in Fig. 16.11.

From (16.12), we can write the closed-loop transfer function as

$$
\begin{equation*}
\left.H(s)\right|_{\text {closed }}=\frac{K_{P D} K_{V C O}}{\frac{s^{2}}{\omega_{L P F}}+s+K_{P D} K_{V C O}} \tag{16.13}
\end{equation*}
$$

For the sake of brevity, we hereafter denote $\left.H(s)\right|_{\text {closed }}$ simply by $H(s)$ or $\Phi_{\text {out }} / \Phi_{\text {in }}$. As expected, if $s \rightarrow 0, H(s) \rightarrow 1$ because of the infinite loop gain.

In order to analyze $H(s)$ further, we derive a relationship that allows a more intuitive understanding of the system. Recall from Chapter 15 that the instantaneous frequency of a waveform is equal to the time derivative of the phase: $\omega=d \phi / d t$. Since the frequency and the phase are related by a linear operator, the transfer function of (16.13) applies to variations in the input and output frequencies as well:

$$
\begin{equation*}
\frac{\omega_{\text {out }}}{\omega_{\text {in }}}(s)=\frac{K_{P D} K_{V C O}}{\frac{s^{2}}{\omega_{L P F}}+s+K_{P D} K_{V C O}} \tag{16.14}
\end{equation*}
$$

For example, this result predicts that if $\omega_{\text {in }}$ changes very slowly $(s \rightarrow 0)$, then $\omega_{\text {out }}$ tracks $\omega_{\text {in }}$, again an expected result because the loop is assumed locked. Equation (16.14) also indicates that if $\omega_{\text {in }}$ changes
abruptly, but the system is given enough time to settle ( $s \rightarrow 0$ ), then the change in $\omega_{\text {out }}$ equals that in $\omega_{\text {in }}$ (as illustrated in the example of Fig. 16.12).

The above observation aids the analysis in two directions. First, some transient responses of the closedloop system may be simpler to visualize in terms of changes in the frequency quantities rather than the phase quantities. Second, since a change in $\omega_{\text {out }}$ must be accompanied by a change in $V_{\text {cont }}$, we have

$$
\begin{equation*}
H(s)=K_{V C O} \cdot \frac{V_{\text {cont }}}{\omega_{\text {in }}}(s) \tag{16.15}
\end{equation*}
$$

That is, monitoring the response of $V_{\text {cont }}$ to variations in $\omega_{\text {in }}$ indeed yields the response of the closed-loop system.

The second-order transfer function of (16.13) suggests that the step response of the type I system can be overdamped, critically damped, or underdamped. To derive the condition for each case, we rewrite the denominator in a familiar form used in control theory, $s^{2}+2 \zeta \omega_{n} s+\omega_{n}^{2}$, where $\zeta$ is the "damping factor" and $\omega_{n}$ is the "natural frequency." That is

$$
\begin{equation*}
H(s)=\frac{\omega_{n}^{2}}{s^{2}+2 \zeta \omega_{n} s+\omega_{n}^{2}} \tag{16.16}
\end{equation*}
$$

where

$$
\begin{array}{r}
\omega_{n}=\sqrt{\omega_{L P F} K_{P D} K_{V C O}} \\
\zeta=\frac{1}{2} \sqrt{\frac{\omega_{L P F}}{K_{P D} K_{V C O}}} \tag{16.18}
\end{array}
$$

The two poles of the closed-loop system are given by

$$
\begin{align*}
s_{1,2} & =-\zeta \omega_{n} \pm \sqrt{\left(\zeta^{2}-1\right) \omega_{n}^{2}}  \tag{16.19}\\
& =\left(-\zeta \pm \sqrt{\left.\zeta^{2}-1\right)} \omega_{n}\right. \tag{16.20}
\end{align*}
$$

Thus, if $\zeta>1$, both poles are real, the system is overdamped, and the transient response contains two exponentials with time constants $1 / s_{1}$ and $1 / s_{2}$. On the other hand, if $\zeta<1$, the poles are complex and the response to an input frequency step $\omega_{i n}=\Delta \omega u(t)$ is equal to

$$
\begin{align*}
\omega_{\text {out }}(t) & =\left\{1-e^{-\zeta \omega_{n} t}\left[\cos \left(\omega_{n} \sqrt{1-\zeta^{2}} t\right)+\frac{\zeta}{\sqrt{1-\zeta^{2}}} \sin \left(\omega_{n} \sqrt{1-\zeta^{2}} t\right)\right]\right\} \Delta \omega u(t)  \tag{16.21}\\
& =\left[1-\frac{1}{\sqrt{1-\zeta^{2}}} e^{-\zeta \omega_{n} t} \sin \left(\omega_{n} \sqrt{1-\zeta^{2}} t+\theta\right)\right] \Delta \omega u(t) \tag{16.22}
\end{align*}
$$

where $\omega_{\text {out }}$ denotes the change in the output frequency and $\theta=\sin ^{-1} \sqrt{1-\zeta^{2}}$. Thus, as shown in Fig. 16.17, the step response contains a sinusoidal component with a frequency $\omega_{n} \sqrt{1-\zeta^{2}}$ that decays with a time constant $\left(\zeta \omega_{n}\right)^{-1}$. Note that the system exhibits the same response if a phase step is applied to the input and the output phase is observed.

The settling speed of PLLs is of great concern in most applications. Equation (16.22) indicates that the exponential decay determines how fast the output approaches its final value, implying that $\zeta \omega_{n}$ must be maximized. For the type I PLL under study here, (16.17) and (16.18) yield

$$
\begin{equation*}
\zeta \omega_{n}=\frac{1}{2} \omega_{L P F} \tag{16.23}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-663.jpg?height=446&width=593&top_left_y=368&top_left_x=516)

Figure 16.17 Underdamped response of PLL to a frequency step.

This result reveals a critical trade-off between the settling speed and the ripple on the VCO control line: the lower the $\omega_{L P F}$, the greater the suppression of the high-frequency components produced by the PD, but the longer the settling time constant.

#### Example 16.5

A cellular telephone incorporates a $900-\mathrm{MHz}$ phase-locked loop to generate the carrier frequencies. If $\omega_{L P F}=$ $2 \pi \times(20 \mathrm{kHz})$ and the output frequency is to be changed from 901 MHz to 901.2 MHz , how long does the PLL output frequency take to settle within 100 Hz of its final value?

#### Solution

Since the step size is 200 kHz , we have

$$
\begin{equation*}
\left[1-e^{-\zeta \omega_{n} t_{s}} \sin \left(\omega_{n} \sqrt{1-\zeta^{2}} t_{s}+\theta\right)\right] \times 200 \mathrm{kHz}=200 \mathrm{kHz}-100 \mathrm{~Hz} \tag{16.24}
\end{equation*}
$$

Thus,

$$
\begin{equation*}
e^{-\zeta \omega_{n} t_{s}} \sin \left(\omega_{n} \sqrt{1-\zeta^{2}} t_{s}+\theta\right)=\frac{100 \mathrm{~Hz}}{200 \mathrm{kHz}} \tag{16.25}
\end{equation*}
$$

In the worst case, the sinusoid is equal to unity and

$$
\begin{equation*}
e^{-\zeta \omega_{n} t_{s}}=0.0005 \tag{16.26}
\end{equation*}
$$

That is

$$
\begin{align*}
t_{s} & =\frac{7.6}{\zeta \omega_{n}}  \tag{16.27}\\
& =\frac{15.2}{\omega_{L P F}}  \tag{16.28}\\
& =0.12 \mathrm{~ms} \tag{16.29}
\end{align*}
$$

In addition to the product $\zeta \omega_{n}$, the value of $\zeta$ itself is also important. Illustrated in Fig. 16.18 for several values of $\zeta$ and a constant $\omega_{n}$, the step response exhibits severe ringing for $\zeta<0.5$. In view of process and temperature variation of the loop parameters, $\zeta$ is usually chosen to be greater than $\sqrt{2} / 2$ or even 1 to avoid excessive ringing. ${ }^{4}$

[^118]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-664.jpg?height=449&width=722&top_left_y=373&top_left_x=793)

Figure 16.18 Underdamped response of a second-order system for various values of $\zeta$.
The choice of $\zeta$ entails other trade-offs as well. First, (16.18) implies that as $\omega_{L P F}$ is reduced to minimize the ripple on the control voltage, the stability degrades. Second, (16.5) and (16.18) indicate that both the phase error and $\zeta$ are inversely proportional to $K_{P D} K_{V C O}$; lowering the phase error inevitably makes the system less stable. In summary, the type I PLL suffers from trade-offs among the settling speed, the ripple on the control voltage (i.e., the quality of the output signal), the phase error, and the stability.

The stability behavior of PLLs can also be analyzed graphically, providing more insight. Recall from Chapter 10 that the Bode plots of the magnitude and phase of the loop gain readily yield the phase margin. Let us utilize (16.12) to construct such plots. As shown in Fig. 16.19, the loop gain begins from infinity at $\omega=0$ and falls at a rate of $20 \mathrm{~dB} / \mathrm{dec}$ for $\omega<\omega_{L P F}$ and at a rate of $40 \mathrm{~dB} / \mathrm{dec}$ thereafter. The phase begins at $-90^{\circ}$ and asymptotically reaches $-180^{\circ}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-664.jpg?height=601&width=791&top_left_y=1353&top_left_x=756)

Figure 16.19 Bode plots of type I PLL.
What happens if a higher $K_{P D} K_{V C O}$ is chosen so as to minimize $\phi_{o u t}-\phi_{\text {in }}$ ? Since the entire gain plot in Fig. 16.19 is shifted up, the gain crossover moves to the right, thus degrading the phase margin. This is consistent with the dependence of $\zeta$ upon $K_{P D} K_{V C O}$.

As observed thus far, $K_{P D} K_{V C O}$ affects many important parameters of PLLs. This quantity is sometimes called the loop gain (even though it is not dimensionless) because of the resemblance of $\Delta \phi=\left(\omega_{\text {out }}-\omega_{0}\right) /\left(K_{P D} K_{V C O}\right)$ to the error equation in a feedback system.

The stability behavior of type I PLLs can also be analyzed by the locus of their poles in the complex plane as the parameter $K_{P D} K_{V C O}$ varies (Fig. 16.20). With $K_{P D} K_{V C O}=0$, the loop is open, $\zeta=\infty$, and the two poles are given by $s_{1}=-\omega_{L P F}$ and $s_{2}=0$. As $K_{P D} K_{V C O}$ increases (i.e., the feedback becomes
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-665.jpg?height=383&width=495&top_left_y=377&top_left_x=565)

Figure 16.20 Root locus of type IPLL.
stronger), $\zeta$ drops and the two poles, given by $s_{1,2}=\left(-\zeta \pm \sqrt{\zeta^{2}-1}\right) \omega_{n}$, move toward each other on the real axis. For $\zeta=1$ (i.e., $\left.K_{P D} K_{V C O}=\omega_{L P F} / 4\right), s_{1}=s_{2}=-\zeta \omega_{n}=-\omega_{L P F} / 2$. As $K_{P D} K_{V C O}$ increases further, the two poles become complex, with a real part equal to $-\zeta \omega_{n}=-\omega_{L P F} / 2$, moving in parallel with the $j \omega$ axis.

We recognize from Fig. 16.20 that, as $s_{1}$ and $s_{2}$ move away from the real axis, the system becomes less stable. In fact, the reader can prove that $\cos \psi=\zeta$ (Problem 16.8), concluding that as $\psi$ approaches $90^{\circ}, \zeta$ drops to zero.

Another transfer function that reveals the settling behavior of PLLs is that of the error at the output of the phase subtractor in Fig. 16.16. Defined as $H_{e}(s)=\left(\phi_{\text {in }}-\phi_{\text {out }}\right) / \phi_{i n}$, this transfer function can be obtained by noting that $\phi_{\text {out }} / \phi_{\text {in }}=H(s)$ and, from (16.13),

$$
\begin{align*}
H_{e}(s) & =1-H(s)  \tag{16.30}\\
& =\frac{s^{2}+2 \zeta \omega_{n} s}{s^{2}+2 \zeta \omega_{n} s+\omega_{n}} \tag{16.31}
\end{align*}
$$

As expected, $H_{e}(s) \rightarrow 0$ if $s \rightarrow 0$ because the output tracks the input when the input varies very slowly or the transient has settled.

#### Example 16.6

Suppose a type I PLL experiences a frequency step $\Delta \omega$ at $t=0$. Calculate the change in the phase error.

#### Solution

The Laplace transform of the frequency step equals $\Delta \omega / s$. Since $H_{e}(s)$ relates the phase error to the input phase, we write $\Phi_{i n}(s)=(\Delta \omega / s) / s=\Delta \omega / s^{2}$. Thus, the Laplace transform of the phase error is

$$
\begin{align*}
\Phi_{e}(s) & =H_{e}(s) \cdot \frac{\Delta \omega}{s^{2}}  \tag{16.32}\\
& =\frac{s^{2}+2 \zeta \omega_{n} s}{s^{2}+2 \zeta \omega_{n} s+\omega_{n}^{2}} \cdot \frac{\Delta \omega}{s^{2}} \tag{16.33}
\end{align*}
$$

From the final value theorem,

$$
\begin{align*}
\phi_{e}(t=\infty) & =\lim _{s \rightarrow 0} s \Phi_{e}(s)  \tag{16.34}\\
& =\frac{2 \zeta}{\omega_{n}} \Delta \omega  \tag{16.35}\\
& =\frac{\Delta \omega}{K_{P D} K_{V C O}} \tag{16.36}
\end{align*}
$$

which agrees with (16.5).

## 16.2 ■ Charge-Pump PLLs

While type I PLLs have been realized widely in discrete form, their shortcomings often prohibit usage in high-performance integrated circuits. In addition to the trade-offs among $\zeta, \omega_{L P F}$, and the phase error, type I PLLs suffer from another critical drawback: limited acquisition range.

### 16.2.2 Phase/Frequency Detector

For periodic signals, it is possible to merge the two loops of Fig. 16.21 by devising a circuit that can detect both phase and frequency differences. Called a phase/frequency detector (PFD) and illustrated conceptually in Fig. 16.22, the circuit employs sequential logic to create three states and respond to the rising (or falling) edges of the two inputs. If initially $Q_{A}=Q_{B}=0$, then a rising transition on $A$ leads to $Q_{A}=1, Q_{B}=0$. The circuit remains in this state until $B$ goes high, at which point $Q_{A}$ returns to zero. In other words, if a rising edge on $A$ is followed by a rising edge on $B$, then $Q_{A}$ goes high and returns to low. The behavior is similar for the $B$ input.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-667.jpg?height=710&width=1276&top_left_y=753&top_left_x=447)

Figure 16.22 Conceptual operation of a PFD.
In Fig. 16.22(a), the two inputs have equal frequencies, but $A$ leads $B$. The output $Q_{A}$ continues to produce pulses whose width is proportional to $\phi_{A}-\phi_{B}$ while $Q_{B}$ remains at zero. In Fig. 16.22(b), $A$ has a higher frequency than $B$, and $Q_{A}$ generates pulses while $Q_{B}$ does not. By symmetry, if $A$ lags $B$ or has a lower frequency than $B$, then $Q_{B}$ produces pulses and $Q_{A}$ remains quiet. Thus, the dc contents of $Q_{A}$ and $Q_{B}$ provide information about $\phi_{A}-\phi_{B}$ or $\omega_{A}-\omega_{B}$. The outputs $Q_{A}$ and $Q_{B}$ are called the "UP" and "DOWN" pulses, respectively.

#### Example 16.7

Explain whether a master-slave D flipflop can operate as a phase detector or a frequency detector. Assume that the flipflop provides differential outputs.

#### Solution

As shown in Fig. 16.23(a), we first apply inputs having equal frequencies and a finite phase difference, assuming that the output changes on the rising edge of the clock input. If $A$ leads $B$, then $V_{\text {out }}$ remains at a logical ONE indefinitely because the flipflop continues to sample the high levels of $A$. Conversely, if $A$ lags $B$, then $V_{\text {out }}$ remains low. Plotted in Fig. 16.23(b), the input-output characteristic of the circuit displays a very high gain at $\Delta \phi=$ $0, \pm \pi, \cdots$ and a zero gain at other values of $\Delta \phi$. The D flipflop is sometimes called a "bang-bang" phase detector to emphasize that the average value of $V_{\text {out }}$ jumps from $-V_{1}$ to $+V_{1}$ as $\Delta \phi$ varies from slightly below zero to slightly above zero.

Now let us assume unequal frequencies for $A$ and $B$. If the flipflop is to behave as a frequency detector, then the average value of $V_{\text {out }}$ must exhibit different polarities for $\omega_{A}>\omega_{B}$ and $\omega_{A}<\omega_{B}$. However, as illustrated in Fig. 16.23(c), the average value is zero in both cases.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-668.jpg?height=986&width=1351&top_left_y=363&top_left_x=424)

Figure 16.23 (a) D flipflop as a phase detector; (b) input-output characteristic; (c) response of D flipflop to unequal input frequencies.

The circuit of Fig. 16.22 can be realized in various forms. Figure 16.24(a) shows a simple implementation consisting of two edge-triggered, resettable D flipflops with their D inputs tied to a logical ONE.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-668.jpg?height=572&width=1508&top_left_y=1816&top_left_x=389)

Figure 16.24 (a) Implementation of PFD; (b) implementation of D flipflop.

The inputs of interest, $A$ and $B$, serve as the clocks of the flipflops. If $Q_{A}=Q_{B}=0$ and $A$ goes high, $Q_{A}$ rises. If this event is followed by a rising transition on $B, Q_{B}$ goes high and the AND gate resets both flipflops. In other words, $Q_{A}$ and $Q_{B}$ are simultaneously high for a short time, but the difference between their average values still represents the input phase or frequency difference correctly. Each flipflop can be implemented as shown in Fig. 16.24(b), where two RS latches are cross-coupled. Latch 1 and Latch 2 respond to the rising edges of $C K$ and Reset, respectively.

#### Example 16.8

Determine the width of the narrow reset pulses that appear in the $Q_{B}$ waveform in Fig. 16.24(a).

#### Solution

Figure 16.25(a) illustrates the overall PFD at the gate level. If the circuit begins with $A=1, Q_{A}=1$, and $Q_{B}=0$, a rising edge on $B$ forces $\overline{Q_{B}}$ to go low and, one gate delay later, $Q_{B}$ to go high. As shown in Fig. 16.25(b), this transition propagates to Reset, $\bar{E}$ and $\bar{F}, E$ and $F$, and finally to $Q_{A}$ and $Q_{B}$. Thus, the width of the pulse on $Q_{B}$ is approximately equal to 5 gate delays. ${ }^{8}$
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-669.jpg?height=492&width=621&top_left_y=1046&top_left_x=525)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-669.jpg?height=503&width=418&top_left_y=1029&top_left_x=1215)
(b)

Figure 16.25

It is instructive to plot the input-output characteristic of the above PFD. Defining the output as the difference between the average values of $Q_{A}$ and $Q_{B}$ when $\omega_{A}=\omega_{B}$ and neglecting the effect of the narrow reset pulses, we note that the output varies symmetrically as $|\Delta \phi|$ begins from zero (Fig. 16.26). For $\Delta \phi= \pm 360^{\circ}, V_{\text {out }}$ reaches its extrema and subsequently changes sign. The slope of the characteristic can be viewed as the gain.

How is the PFD of Fig. 16.24(a) utilized in a phase-locked loop? Since the difference between the average values of $Q_{A}$ and $Q_{B}$ is of interest, the two outputs can be low-pass filtered and sensed differentially (Fig. 16.27). A PLL employing such a topology always locks, but, due to the finite "loop gain," $K_{P F D} K_{V C O}$, it suffers from a finite phase error.

### 16.2.3 Charge Pump

In order to avoid the finite phase error present in type I PLLs, we wish to raise the loop gain to infinity, perhaps by means of an integrator. As our first step, we interpose a "charge pump" (CP) between the PFD

[^120]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-670.jpg?height=311&width=742&top_left_y=381&top_left_x=780)

Figure 16.26 Input-output characteristic of the three-state PFD.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-670.jpg?height=483&width=782&top_left_y=844&top_left_x=760)

Figure 16.27 PFD followed by low-pass filters.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-670.jpg?height=575&width=1264&top_left_y=1464&top_left_x=519)

Figure 16.28 PFD with charge pump.
and the loop filter. A charge pump consists of two switched current sources that pump charge into or out of the loop filter according to two logical inputs. Figure 16.28 illustrates a charge pump driven by a PFD and driving a capacitor. The circuit has three states. If $Q_{A}=Q_{B}=0$, then $S_{1}$ and $S_{2}$ are off and $V_{\text {out }}$ remains constant. If $Q_{A}$ is high and $Q_{B}$ is low, then $I_{1}$ charges $C_{P}$. Conversely, if $Q_{A}$ is low and $Q_{B}$ is high, then $I_{2}$ discharges $C_{P}$. Thus, if, for example, $A$ leads $B$, then $Q_{A}$ continues to produce pulses and $V_{\text {out }}$ rises steadily. Called UP and DOWN currents, respectively, $I_{1}$ and $I_{2}$ are nominally equal.

#### Example 16.9

What is the effect of the narrow pulses that appear in the $Q_{B}$ waveform in Fig. 16.28?

#### Solution

Since $Q_{A}$ and $Q_{B}$ are simultaneously high for a finite period (approximately 5 gate delays from Example 16.8), the current supplied by the charge pump to $C_{P}$ is affected. In fact, if $I_{1}=I_{2}$, the current through $S_{1}$ simply flows through $S_{2}$ during the narrow reset pulse, leaving no current to charge $C_{P}$. As shown in Fig. 16.29, $V_{\text {out }}$ remains constant after $Q_{B}$ goes high.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-671.jpg?height=515&width=833&top_left_y=747&top_left_x=666)

Figure 16.29

The PFD/CP/LPF cascade shown in Fig. 16.28 has an interesting property. If $A$, say, leads $B$ by a finite amount, $Q_{A}$ produces pulses indefinitely, allowing the charge pump to inject $I_{1}$ into $C_{P}$ and forcing $V_{\text {out }}$ to rise steadily. In other words, for a finite input error, the output eventually goes to $+\infty$ or $-\infty$, i.e., the "gain" of the circuit is infinity. In this cascade, the PFD converts the input phase error to a pulse width on $Q_{A}$ or $Q_{B}$, the charge pump translates this pulse width to charge, and the capacitor accumulates this charge.

### 16.2.4 Basic Charge-Pump PLL

Let us now construct a PLL using the circuit of Fig. 16.28. Shown in Fig. 16.30 and called a charge-pump PLL, such an implementation senses the transitions at the input and output, detects phase or frequency differences, and activates the charge pump accordingly. When the loop is turned on, $\omega_{\text {out }}$ may be far from $\omega_{\text {in }}$, and the PFD and the charge pump adjust the control voltage such that $\omega_{\text {out }}$ approaches $\omega_{\text {in }}$. When the input and output frequencies are sufficiently close, the PFD operates as a phase detector, performing phase lock. The loop locks when the phase difference drops to zero and the charge pump remains relatively idle.

As observed above, the gain of the PFD/CP/LPF combination is infinite, i.e., a nonzero (deterministic) difference between $\phi_{\text {in }}$ and $\phi_{\text {out }}$ leads to indefinite charge buildup on $C_{P}$. What is the consequence of this attribute in a charge-pump PLL? When the loop of Fig. 16.30 is locked, $V_{\text {cont }}$ is finite. Therefore, the input phase error must be exactly zero. ${ }^{9}$ This is in contrast to the behavior of the type I PLL, in which the phase error is finite and a function of the output frequency.

[^121]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-672.jpg?height=524&width=848&top_left_y=384&top_left_x=724)

Figure 16.30 Simple charge-pump PLL.
To gain more insight into the operation of the PLL shown in Fig. 16.30, let us ignore the narrow reset pulses on $Q_{A}$ and $Q_{B}$ and assume that after $\phi_{\text {out }}-\phi_{\text {in }}$ drops to zero, the PFD simply produces $Q_{A}=Q_{B}=0$. The charge pump thus remains idle, and $C_{P}$ sustains a constant control voltage. Does this mean that the PFD and the CP are no longer needed?! If $V_{\text {cont }}$ remains constant for a long time, the VCO frequency and phase begin to drift. In particular, the noise sources in the VCO create random variations in the oscillation frequency that can result in a large accumulation of phase error. The PFD then detects the phase difference, producing a corrective pulse on $Q_{A}$ or $Q_{B}$ that adjusts the VCO frequency through the charge pump and the filter. This is why we stated earlier that the PLL responds only to the excess phase of waveforms. We also note that, since in Fig. 16.30 phase comparison is performed in every cycle, the VCO phase and frequency cannot drift substantially.

Dynamics of CPPLL In order to quantify the behavior of charge-pump PLLs, we develop a linear model for the combination of the PFD, the charge pump, and the low-pass filter, thereby obtaining the transfer function. We raise two questions: (1) Is the PFD/CP/LPF combination in Fig. 16.28 a linear system? (2) If so, how can its transfer function be computed?

To answer the first question, we test the system for linearity. For example, as illustrated in Fig. 16.31(a), we double the input phase difference and see if $V_{\text {out }}$ exactly doubles. Interestingly, the flat sections of $V_{\text {out }}$ double, but not the ramp sections. After all, the current charging or discharging $C_{P}$ is constant, yielding a constant slope for the ramp-an effect similar to slewing in op amps. Thus, the system is not linear in the strict sense. To overcome this quandary, we approximate the output waveform by a ramp [Fig. 16.31(b)], arriving at a linear relationship between $V_{\text {out }}$ and $\Delta \phi$. In a sense, we approximate a discrete-time system by a continuous-time model.

To answer the second question, we recall that the transfer function is the Laplace transform of the impulse response, requiring that we apply a phase difference impulse and compute $V_{\text {out }}$ in the time domain. Since a phase difference impulse is difficult to visualize, we apply a phase difference step, obtain $V_{\text {out }}$, and differentiate the result with respect to time.

Let us assume that the input period is $T_{i n}$ and the charge pump provides a current of $\pm I_{P}$ to the capacitor. As shown in Fig. 16.32, we begin with a zero phase difference and, at $t=0$, step the phase of $B$ by $\phi_{0}$, i.e., $\Delta \phi=\phi_{0} u(t)$. As a result, $Q_{A}$ or $Q_{B}$ continues to produce pulses that are $\phi_{0} T_{i n} /(2 \pi)$ seconds wide, raising the output voltage by $\left(I_{P} / C_{P}\right) \phi_{0} T_{i n} /(2 \pi)$ in every period. ${ }^{10}$ Approximated by a ramp, $V_{\text {out }}$ thus exhibits a slope of $\left(I_{P} / C_{P}\right) \phi_{0} /(2 \pi)$ and can be expressed as

$$
\begin{equation*}
V_{\text {out }}(t)=\frac{I_{P}}{2 \pi C_{P}} t \cdot \phi_{0} u(t) \tag{16.37}
\end{equation*}
$$

[^122]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-673.jpg?height=786&width=1302&top_left_y=356&top_left_x=440)

Figure 16.31 (a) Test of linearity of PFD/CP/LPF combination; (b) ramp approximation of the response.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-673.jpg?height=538&width=813&top_left_y=1247&top_left_x=673)

Figure 16.32 Step response of PFD/CP/LPF combination.

The impulse response is therefore given by

$$
\begin{equation*}
h(t)=\frac{I_{P}}{2 \pi C_{P}} u(t) \tag{16.38}
\end{equation*}
$$

yielding the transfer function

$$
\begin{equation*}
\frac{V_{\text {out }}}{\Delta \phi}(s)=\frac{I_{P}}{2 \pi C_{P}} \cdot \frac{1}{s} \tag{16.39}
\end{equation*}
$$

Consequently, the PFD/CP/LPF combination contains a pole at the origin, a point of contrast to the $\mathrm{PD} / \mathrm{LPF}$ circuit used in the type I PLL. In analogy with the expression $K_{V C O} / s$, we call $I_{P} /\left(2 \pi C_{P}\right)$ the "gain" of the PFD and denote it by $K_{P F D}$.

#### Example 16.10

Suppose the output quantity of interest in the circuit of Fig. 16.28 is the current injected by the charge pump into the capacitor. Determine the transfer function from $\Delta \phi$ to this current, $I_{\text {out }}$.

#### Solution

Since $V_{\text {out }}(s)=I_{\text {out }} /\left(C_{P} s\right)$, we have

$$
\begin{equation*}
\frac{I_{\text {out }}}{\Delta \phi}(s)=\frac{I_{P}}{2 \pi} \tag{16.40}
\end{equation*}
$$

Let us now construct a linear model of charge-pump PLLs. Shown in Fig. 16.33, the model gives an open-loop transfer function

$$
\begin{equation*}
\left.\frac{\Phi_{\text {out }}}{\Phi_{\text {in }}}(s)\right|_{\mathrm{open}}=\frac{I_{P}}{2 \pi C_{P}} \frac{K_{V C O}}{s^{2}} \tag{16.41}
\end{equation*}
$$

Since the loop gain has two poles at the origin, this topology is called a "type II" PLL. The closed-loop transfer function, denoted by $H(s)$ for the sake of brevity, is thus equal to

$$
\begin{equation*}
H(s)=\frac{\frac{I_{P} K_{V C O}}{2 \pi C_{P}}}{s^{2}+\frac{I_{P} K_{V C O}}{2 \pi C_{P}}} \tag{16.42}
\end{equation*}
$$

This result is alarming because the closed-loop system contains two imaginary poles at $s_{1,2}=$ $\pm j \sqrt{I_{P} K_{V C O} /\left(2 \pi C_{P}\right)}$ and is therefore unstable. The instability arises because the loop gain has only two poles at the origin (i.e., two ideal integrators). As shown in Fig. 16.34(a), each integrator contributes a constant phase shift of $90^{\circ}$, allowing the system to oscillate at the gain crossover frequency.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-674.jpg?height=274&width=805&top_left_y=1563&top_left_x=752)

Figure 16.33 Linear model of simple charge-pump PLL.
In order to stabilize the system, we must modify the phase characteristic such that the phase shift is less than $180^{\circ}$ at the gain crossover. As shown in Fig. 16.34(b), this is accomplished by introducing a zero in the loop gain, i.e., by adding a resistor in series with the loop filter capacitor (Fig. 16.35). Using the result of Example 16.10, the reader can prove (Problem 16.11) that the PFD/CP/LPF now has a transfer function

$$
\begin{equation*}
\frac{V_{\text {out }}}{\Delta \phi}(s)=\frac{I_{P}}{2 \pi}\left(R_{P}+\frac{1}{C_{P} S}\right) \tag{16.43}
\end{equation*}
$$

It follows that the PLL open-loop transfer function is equal to

$$
\begin{equation*}
\left.\frac{\Phi_{\text {out }}}{\Phi_{\text {in }}}(s)\right|_{\text {open }}=\frac{I_{P}}{2 \pi}\left(R_{P}+\frac{1}{C_{P} s}\right) \frac{K_{V C O}}{s} \tag{16.44}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-675.jpg?height=665&width=1224&top_left_y=368&top_left_x=476)

Figure 16.34 (a) Loop gain characteristics of simple charge-pump PLL; (b) addition of zero.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-675.jpg?height=532&width=828&top_left_y=1118&top_left_x=668)

Figure 16.35 Addition of zero to charge-pump PLL.
and hence

$$
\begin{equation*}
H(s)=\frac{\frac{I_{P} K_{V C O}}{2 \pi C_{P}}\left(R_{P} C_{P} s+1\right)}{s^{2}+\frac{I_{P}}{2 \pi} K_{V C O} R_{P} s+\frac{I_{P}}{2 \pi C_{P}} K_{V C O}} \tag{16.45}
\end{equation*}
$$

The closed-loop system contains a zero at $s_{z}=-1 /\left(R_{P} C_{P}\right)$. Using the same notation as that for the type I PLL, we have

$$
\begin{align*}
\omega_{n} & =\sqrt{\frac{I_{P} K_{V C O}}{2 \pi C_{P}}}  \tag{16.46}\\
\zeta & =\frac{R_{P}}{2} \sqrt{\frac{I_{P} C_{P} K_{V C O}}{2 \pi}} \tag{16.47}
\end{align*}
$$

As expected, if $R_{P}=0$, then $\zeta=0$. With complex poles, the decay time constant is given by $1 /\left(\zeta \omega_{n}\right)=$ $4 \pi /\left(R_{P} I_{P} K_{V C O}\right)$.

Stability Issues The stability behavior of type II PLLs is quite different from that of type I PLLs. We begin the analysis with the Bode plots of the loop gain (the loop transmission) [Eq. (16.44)]. Shown in Fig. 16.36, these plots suggest that if $I_{P} K_{V C O}$ decreases, the gain crossover frequency moves toward the origin, degrading the phase margin. Predicted by (16.47), this trend is in sharp contrast to that expressed by (16.18) and illustrated in Fig. 16.19.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-676.jpg?height=604&width=633&top_left_y=617&top_left_x=568)

Figure 16.36 Stability degradation of charge-pump PLL as $I_{P} K_{V C O}$ decreases.

It is also possible to construct the root locus of the closed-loop system in the complex plane. For $I_{P} K_{V C O}=0$ (e.g., $I_{P}=0$ ), the loop is open and both poles lie at the origin. For $I_{P} K_{V C O}>0$, we have $s_{1,2}=-\zeta \omega_{n} \pm \omega_{n} \sqrt{\zeta^{2}-1}$, and, since $\zeta \propto \sqrt{I_{P} K_{V C O}}$, the poles are complex if $I_{P} K_{V C O}$ is small. The reader can prove (Problem 16.14) that as $I_{P} K_{V C O}$ increases, $s_{1}$ and $s_{2}$ move on a circle centered at $\sigma=-1 /\left(R_{P} C_{P}\right)$ with a radius $1 /\left(R_{P} C_{P}\right)$ (Fig. 16.37). The poles return to the real axis at $\zeta=1$, assuming a value of $-2 /\left(R_{P} C_{P}\right)$. For $\zeta>1$, the poles remain real, one approaching $-1 /\left(R_{P} C_{P}\right)$ and the other going to $-\infty$ as $I_{P} K_{V C O} \rightarrow+\infty$. Since for complex $s_{1}$ and $s_{2}, \zeta=\cos \psi$, we observe that as $I_{P} K_{V C O}$ exceeds zero, the system becomes more stable.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-676.jpg?height=391&width=659&top_left_y=1625&top_left_x=549)

Figure 16.37 Root locus of type II PLL.

#### Example 16.11

A student considers the Bode plots in Fig. 16.36 and observes that at $\omega_{1}$, the loop gain exceeds unity and the phase shift is $-180^{\circ}$. The student then reasons that the PLL must oscillate at this frequency! Explain the flaw in this reasoning.

#### Solution

The phase shift is in fact slightly less than zero unless $\omega_{1}=0$. As explained using Nyquist's approach in Chapter 10, a system containing two integrators and one zero does not oscillate.

The compensated type II PLL of Fig. 16.35 suffers from a critical drawback. Since the charge pump drives the series combination of $R_{P}$ and $C_{P}$, each time a current is injected into the loop filter, the control voltage experiences a large jump. Even in the locked condition, the mismatches between $I_{1}$ and $I_{2}$ and the charge injection and clock feedthrough of $S_{1}$ and $S_{2}$ introduce voltage jumps in $V_{\text {cont }}$. The resulting ripple severely disturbs the VCO, corrupting the output phase. To relax this issue, a second capacitor is usually added in parallel with $R_{P}$ and $C_{P}$ (Fig. 16.38), suppressing the initial step. The loop filter now is of second order, yielding a third-order PLL and creating stability difficulties [4]. Nonetheless, if $C_{2}$ is about one-fifth to one-tenth of $C_{P}$, the closed-loop time and frequency responses remain relatively unchanged.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-677.jpg?height=530&width=885&top_left_y=780&top_left_x=640)

Figure 16.38 Addition of $C_{2}$ to reduce ripple on the control line.
Equation (16.47) implies that the loop becomes more stable as $R_{P}$ increases. In reality, as $R_{P}$ becomes very large, the stability degrades again. This effect is not predicted by the foregoing derivations because we have approximated the discrete-time system by a continuous-time loop. A more accurate analysis is given in [2], but simulations are often necessary to determine the stability bounds of CPPLLs.

## 16.3 ■ Nonideal Effects in PLLs

### 16.3.1 PFD/CP Nonidealities

Several imperfections in the PFD/CP circuit lead to high ripple on the control voltage even when the loop is locked. As mentioned earlier, the ripple modulates the VCO frequency, producing a waveform that is no longer periodic. In this section, we study these nonidealities.

The PFD implementation of Fig. 16.24(a) generates narrow, coincident pulses on both $Q_{A}$ and $Q_{B}$ even when the input phase difference is zero. As illustrated in Fig. 16.39, if $A$ and $B$ rise simultaneously, so do $Q_{A}$ and $Q_{B}$, thereby activating the reset. That is, even when the PLL is locked, $Q_{A}$ and $Q_{B}$ simultaneously turn on the charge pump for a finite period $T_{P} \approx 5 T_{D}$, where $T_{D}$ denotes the gate delay (Example 16.8).

What are the consequences of the reset pulses on $Q_{A}$ and $Q_{B}$ ? To understand why these pulses are desirable, we consider a hypothetical PFD that produces no pulses for a zero input phase difference [Fig. 16.40(a)]. How does such a PFD respond to a small phase error? As shown in Fig. 16.40(b), the circuit generates very narrow pulses on $Q_{A}$ or $Q_{B}$. However, owing to the finite rise time and fall time resulting from the capacitance seen at these nodes, the pulse may not find enough time to reach a logical high level fail to turn on the charge pump switches. In other words, if the input phase difference, $\Delta \phi$, falls below a certain value $\phi_{0}$, then the output voltage of the PFD/CP/LPF combination is no longer a
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-678.jpg?height=443&width=619&top_left_y=367&top_left_x=569)

Figure 16.39 Coincident pulses generated by PFD with zero phase difference.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-678.jpg?height=426&width=1299&top_left_y=887&top_left_x=502)

Figure 16.40 Output waveforms of a hypothetical PD with (a) zero input phase difference, and (b) a small input phase difference.
function of $\Delta \phi$. Since, as depicted in Fig. 16.41, for $|\Delta \phi|<\phi_{0}$ the charge pump injects no current, Eq. (16.41) implies that the loop gain drops to zero and the output phase is not locked. We say that the PFD/CP circuit suffers from a dead zone equal to $\pm \phi_{0}$ around $\Delta \phi=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-678.jpg?height=352&width=624&top_left_y=1627&top_left_x=572)

Figure 16.41 Dead zone in the chargepump current.

The dead zone is highly undesirable because it allows the VCO to accumulate as much random phase error as $\phi_{0}$ with respect to the input while receiving no corrective feedback. Thus, as illustrated in Fig. 16.42, the zero crossing points of the VCO output experience substantial random variations, an effect called "jitter."

Interestingly, the coincident pulses on $Q_{A}$ and $Q_{B}$ can eliminate the dead zone. This is because, for $\Delta \phi=0$, the pulses always turn on the charge pump if they are sufficiently wide. Consequently, as shown in Fig. 16.43, an infinitesimal increment in the phase difference results in a proportional increase in the net current produced by the charge pump. In other words, the dead zone vanishes if $T_{P}$ is long enough to allow $Q_{A}$ and $Q_{B}$ to reach a valid logical level and turn on the switches in the charge pump.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-679.jpg?height=291&width=1011&top_left_y=377&top_left_x=574)

Figure 16.42 Jitter resulting from the dead zone.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-679.jpg?height=357&width=1245&top_left_y=778&top_left_x=457)

Figure 16.43 Response of actual PD to a small input phase difference.

While eliminating the dead zone, the reset pulses on $Q_{A}$ and $Q_{B}$ introduce other difficulties. Let us first implement the charge pump using MOS transistors [Fig. 16.44(a)]. Here, $M_{1}$ and $M_{2}$ operate as current sources and $M_{3}$ and $M_{4}$ as switches. The output $Q_{A}$ is inverted so that when it goes high, $M_{4}$ turns on.

The first issue in the circuit of Fig. 16.44(a) stems from the delay difference between $\overline{Q_{A}}$ and $Q_{B}$ in turning on their respective switches. As shown in Fig. 16.44(b), the net current injected by the charge pump into the loop filter jumps to $+I_{P}$ and $-I_{P}$, disturbing the oscillator control voltage periodically even if the loop is locked. To suppress this effect, a complementary pass gate can be interposed between $Q_{B}$ and the gate of $M_{3}$, equalizing the delays [Fig. 16.44(c)].

The second issue in the CP of Fig. 16.44(c) relates to the mismatch between the drain currents of $M_{1}$ and $M_{2}$. As depicted in Fig. 16.45(a), even with perfect alignment of the UP and DOWN pulses, the net current produced by the charge pump is nonzero, changing $V_{\text {cont }}$ by a constant increment at each phase comparison instant. How does the PLL respond to this error? For the loop to remain locked, the average value of the control voltage must remain constant. The PLL therefore creates a phase error between the input and the output such that the net current injected by the CP in every cycle is zero [Fig. 16.45(b)]. The relationship between the current mismatch and the phase error is determined in Problem 16.12. It is important to note that (1) the control voltage still experiences a periodic ripple; (2) owing to the low output impedance of short-channel MOSFETs, the current mismatch varies with the output voltage (i.e., with the VCO frequency); and (3) the clock feedthrough and charge injection mismatch between $M_{3}$ and $M_{4}$ further increase both the phase error and the ripple.

The third issue in the circuit of Fig. 16.44(c) originates from the finite capacitance seen at the drains of the current sources. Suppose, as illustrated in Fig. 16.46(a), $S_{1}$ and $S_{2}$ are off, allowing $M_{1}$ to discharge $X$ to ground and $M_{2}$ to charge $Y$ to $V_{D D}$. At the next phase comparison instant, both $S_{1}$ and $S_{2}$ turn on, $V_{X}$ rises, $V_{Y}$ falls, and $V_{X} \approx V_{Y} \approx V_{\text {cont }}$ if the voltage drop across $S_{1}$ and $S_{2}$ is neglected [Fig. 16.46(b)]. If the phase error is zero and $I_{D 1}=\left|I_{D 2}\right|$, does $V_{\text {cont }}$ remain constant after the switches turn on? Even if $C_{X}=C_{Y}$, the change in $V_{X}$ is not equal to that in $V_{Y}$. For example, if $V_{\text {cont }}$ is relatively high, $V_{X}$ changes by a large amount and $V_{Y}$ by a small amount. The difference between the two changes must therefore be supplied by $C_{P}$, leading to a jump in $V_{\text {cont }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-680.jpg?height=1140&width=1270&top_left_y=366&top_left_x=519)

Figure 16.44 (a) Implementation of charge pump; (b) effect of skew between $\overline{Q_{A}}$ and $Q_{B}$; (c) suppression of skew by a pass gate.

The above charge-sharing phenomenon can be suppressed by "bootstrapping." Illustrated in Fig. 16.47 [3], the idea is to "pin" $V_{X}$ and $V_{Y}$ to $V_{c o n t}$ after phase comparison is finished. When $S_{1}$ and $S_{2}$ turn off, $S_{3}$ and $S_{4}$ turn on, allowing the unity-gain amplifier to hold nodes $X$ and $Y$ at a potential equal to $V_{\text {cont }}$. Note that the amplifier need not provide much current because $I_{1} \approx I_{2}$. At the next phase comparison instant, $S_{1}$ and $S_{2}$ turn on, $S_{3}$ and $S_{4}$ turn off, and $V_{X}$ and $V_{Y}$ begin with a value equal to $V_{c o n t}$. Thus, no charge sharing occurs between $C_{P}$ and the capacitances at $X$ and $Y$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-680.jpg?height=489&width=509&top_left_y=1897&top_left_x=595)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-680.jpg?height=478&width=510&top_left_y=1900&top_left_x=1192)
(b)

Figure 16.45 Effect of UP and DOWN current mismatch.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-681.jpg?height=444&width=463&top_left_y=381&top_left_x=412)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-681.jpg?height=450&width=469&top_left_y=381&top_left_x=931)
(b)

Figure 16.46 Charge sharing between $C_{P}$ and capacitances at $X$ and $Y$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-681.jpg?height=558&width=411&top_left_y=1007&top_left_x=610)

Figure 16.47 Bootstrapping $X$ and $Y$ to minimize charge sharing.

### 16.3.2 Jitter in PLLs

The response of phase-locked loops to jitter is of extreme importance in most applications. We first describe the concepts of jitter and the rate of change of jitter.

As shown in Fig. 16.48, a strictly periodic waveform, $x_{1}(t)$, contains zero crossings that are evenly spaced in time. Now consider the nearly periodic signal $x_{2}(t)$, whose period experiences small changes, displacing the zero crossings from their ideal points. We say that the latter waveform suffers from jitter. ${ }^{11}$ Plotting the total phase, $\phi_{t o t}$, and the excess phase, $\phi_{e x}$, of the two waveforms, we observe that jitter manifests itself as variation of the excess phase with time. In fact, ignoring the harmonics above the fundamental, we can write $x_{1}(t)=A \cos \omega t$ and $x_{2}(t)=A \cos \left[\omega t+\phi_{n}(t)\right]$, where $\phi_{n}(t)$ models the variation of the period. ${ }^{12}$

The rate at which the jitter varies is also important. Consider the two jittery waveforms depicted in Fig. 16.49. The first signal, $y_{1}(t)$, experiences "slow jitter" because its instantaneous frequency varies slowly from one period to the next. The second signal, $y_{2}(t)$, experiences "fast jitter." The rate of change is also evident from the excess phase plots of the two waveforms.

[^123]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-682.jpg?height=670&width=946&top_left_y=383&top_left_x=681)

Figure 16.48 Ideal and jittery waveforms.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-682.jpg?height=425&width=1012&top_left_y=1149&top_left_x=647)

Figure 16.49 Illustration of slow and fast jitter.

Two jitter phenomena in phase-locked loops are of great interest: (1) the input exhibits jitter, and (2) the VCO produces jitter. Let us study each case, assuming that the input and output waveforms are expressed as $x_{\text {in }}(t)=A \cos \left[\omega t+\phi_{\text {in }}(t)\right]$ and $x_{\text {out }}(t)=A \cos \left[\omega t+\phi_{\text {out }}(t)\right]$.

The transfer functions derived for type I and type II PLLs have a low-pass characteristic, suggesting that if $\phi_{\text {in }}(t)$ varies rapidly, then $\phi_{\text {out }}(t)$ does not fully track the variations. In other words, slow jitter at the input propagates to the output unattenuated, but fast jitter does not. We say the PLL low-pass filters $\phi_{i n}(t)$.

Now suppose the input is strictly periodic, but the VCO suffers from jitter. Viewing jitter as random phase variations, we construct the model depicted in Fig. 16.50, where the input excess phase is set to zero
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-682.jpg?height=288&width=1116&top_left_y=2087&top_left_x=593)

Figure 16.50 Effect of VCO jitter.
[i.e., $x_{i n}(t)=A \cos \omega t$ ] and a random component $\Phi_{V C O}$ is added to the output of the VCO to represent its jitter. The reader can show that the transfer function from $\Phi_{V C O}$ to $\Phi_{\text {out }}$ for a type II PLL is equal to

$$
\begin{equation*}
\frac{\Phi_{\text {out }}}{\Phi_{V C O}}(s)=\frac{s^{2}}{s^{2}+2 \zeta \omega_{n} s+\omega_{n}^{2}} \tag{16.48}
\end{equation*}
$$

Interestingly, the characteristic has a high-pass nature, indicating that slow jitter components generated by the VCO are suppressed, but fast jitter components are not. This can be understood with the aid of Fig. 16.50: if $\phi_{V C O}(t)$ changes slowly (e.g., the oscillation period drifts with temperature), then the comparison with $\phi_{i n}=0$ (i.e., a perfectly periodic signal) generates a slowly-varying error that propagates through the LPF and adjusts the VCO frequency, thereby counteracting the change in $\phi_{V C O}$. On the other hand, if $\phi_{V C O}$ varies rapidly (e.g., high-frequency noise modulates the oscillation period), then the error produced by the phase detector is heavily attenuated by the poles in the loop, failing to correct for the change.

Figure 16.51 conceptually summarizes the response of PLLs to input jitter and VCO jitter. Depending on the application and the environment, one or both sources may be significant, requiring an optimum choice of the loop bandwidth.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-683.jpg?height=342&width=1241&top_left_y=1075&top_left_x=462)

Figure 16.51 Transfer functions of jitter from input and VCO to the output.

## 16.4 ■ Delay-Locked Loops

A variant of PLLs that finds usage in many applications is the "delay-locked loop." To arrive at the concept, let us begin with an example. Suppose an application requires four clock phases with a precise spacing of $\Delta T=1$ ns between consecutive edges [Fig. 16.52(a)]. How should these phases be generated? We can use a two-stage differential ring oscillator ${ }^{13}$ to produce the four phases, but how do we guarantee that $\Delta T=1 \mathrm{~ns}$ despite process and temperature variations? This requires that the oscillator be locked to a $250-\mathrm{MHz}$ reference so that the output period is exactly equal to 4 ns [Fig. 16.52(b)].

An alternative approach to generating the clock phases of Fig. 16.52(a) is to apply the input clock to four delay stages in a cascade. Illustrated in Fig. 16.53(a), this technique nonetheless does not produce a well-defined edge spacing because the delay of each stage varies with process and temperature. Now consider the circuit shown in Fig. 16.53(b), where the phase difference between $C K_{i n}$ and $C K_{4}$ is sensed by a phase detector, a proportional average voltage, $V_{\text {cont }}$, is generated, and the delay of the stages is adjusted with negative feedback. For a large loop gain, the phase difference between $C K_{i n}$ and $C K_{4}$ is small; that is, the four stages delay the clock by almost exactly one period, thereby establishing precise edge spacing. ${ }^{14}$ This topology is called a delay-locked loop to emphasize that it incorporates a voltagecontrolled delay line (VCDL) rather than a VCO. In practice, a charge pump is interposed between the PD

[^124]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-684.jpg?height=538&width=1463&top_left_y=363&top_left_x=417)

Figure 16.52 (a) Clock phases with edge-to-edge delay of 1 ns ; (b) use of a phase-locked ring oscillator to generate the clock phases.
and the LPF to achieve an infinite loop gain. Each delay stage may be based on one of the ring oscillator stages described in Chapter 15.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-684.jpg?height=477&width=1482&top_left_y=1128&top_left_x=419)

Figure 16.53 (a) Generation of clock edges by delay stages; (b) simple delay-locked loop.
The reader may wonder about the advantages of DLLs over PLLs. First, delay lines are generally less susceptible to noise than are oscillators because corrupted zero crossings of a waveform disappear at the end of a delay line, whereas they are recirculated in an oscillator, thereby experiencing more corruption. Second, in the VCDL of Fig. 16.53(b), a change in the control voltage immediately changes the delay; that is, the transfer function $\Phi_{\text {out }}(s) / V_{\text {cont }}(s)$ is simply equal to the gain of the VCDL, $K_{V C D L}$. Thus, the feedback system of Fig. 16.53(b) has the same order as the LPF, and its stability and settling issues are more relaxed than those of a PLL.

#### Example 16.12

Explain qualitatively what type of transfer function the DLL of Fig. 16.54 has.

#### Solution

Suppose the input exhibits slow phase fluctuations. Then, the phase error sees a high gain through the PD/CP/LPF combination, and the delay of the line is adjusted so as to minimize this error. That is, $\phi_{\text {out }}$ tracks $\phi_{\text {in }}$, and the gain is about unity. Now, suppose the input exhibits very fast phase changes. The feedback loop thus has little gain, providing little correction at the control of the delay line; i.e., $V_{\text {cont }}$ remains relatively constant. As a result, the input phase variations directly propagate to the output, yielding a gain of about unity. We conclude that the DLL exhibits an all-pass response, but that for moderately fast phase fluctuations, the response may have a dip or a peak.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-685.jpg?height=383&width=1092&top_left_y=363&top_left_x=539)

Figure 16.54

The principal drawback of DLLs is that they cannot generate a variable output frequency. This issue becomes clearer when we study the frequency synthesis capabilities of PLLs in Sec. 16.5.1. DLLs may also suffer from locked delay ambiguity. That is, if the total delay of the four stages in Fig. 16.53(b) can vary from below $T_{i n}$ to above $2 T_{i n}$, then the loop may lock with a $C K_{i n}$-to- $C K_{4}$ delay equal to either $T_{i n}$ or $2 T_{i n}$. This ambiguity proves detrimental if the DLL must provide precisely-spaced clock edges because the edge-to-edge delay may settle to $2 T_{i n} / 4$ rather than $T_{i n} / 4$. In such cases, additional circuitry is necessary to avoid the ambiguity. Also, mismatches between the delay stages and their load capacitances introduce error in the edge spacing, requiring large devices and careful layout.

## 16.5 ■ Applications

After nearly 90 years since its invention, phase locking continues to find new applications in electronics, communication, and instrumentation. Examples include memories, microprocessors, hard disk drive electronics, RF and wireless transceivers, and optical fiber receivers.

The reader may recall from Sec. 16.1.2 that a PLL appears no more useful than a short piece of wire because both guarantee a small phase difference between the input and the output. In this section, we present a number of applications that demonstrate the versatility of phase locking. The concepts described below have been the topic of numerous books and papers, e.g., [6, 7].

### 16.5.1 Frequency Multiplication and Synthesis

Frequency Multiplication A PLL can be modified such that it multiplies its input frequency by a factor of $M$. To arrive at the implementation, we exploit an analogy with voltage multiplication. As depicted in Fig. 16.55(a), a feedback system amplifies the input voltage by a factor of $M$ if the output voltage is divided by $M$ [i.e., if $\left.R_{2} /\left(R_{1}+R_{2}\right)=1 / M\right]$ and the result is compared with the input. Thus, as shown in Fig. 16.55(b), if the output frequency of a PLL is divided by $M$ and applied to the phase detector, we have $f_{\text {out }}=M f_{\text {in }}$. From another point of view, since $f_{D}=f_{\text {out }} / M$ and $f_{D}$ and $f_{\text {in }}$ must be equal in the
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-685.jpg?height=288&width=391&top_left_y=2044&top_left_x=456)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-685.jpg?height=234&width=814&top_left_y=2088&top_left_x=902)
(b)

Figure 16.55 (a) Voltage amplification and (b) frequency multiplication.
locked condition, the PLL multiplies $f_{i n}$ by $M$. The $\div M$ circuit is realized as a counter that produces one output pulse for every $M$ input pulses.

As with voltage division in Fig. 16.55(a), the feedback divider in the loop of Fig. 16.55(b) alters the system characteristics. Using (16.44), we rewrite (16.45) as

$$
\begin{align*}
H(s) & =\frac{\frac{I_{P}}{2 \pi}\left(R_{P}+\frac{1}{C_{P} s}\right) \frac{K_{V C O}}{s}}{1+\frac{1}{M} \frac{I_{P}}{2 \pi}\left(R_{P}+\frac{1}{C_{P} s}\right) \frac{K_{V C O}}{s}}  \tag{16.49}\\
& =\frac{\frac{I_{P} K_{V C O}}{2 \pi C_{P}}\left(R_{P} C_{P} s+1\right)}{s^{2}+\frac{I_{P}}{2 \pi} \frac{K_{V C O}}{M} R_{P} s+\frac{I_{P}}{2 \pi C_{P}} \frac{K_{V C O}}{M}} \tag{16.50}
\end{align*}
$$

Note that $H(s) \rightarrow M$ as $s \rightarrow 0$, i.e., phase or frequency changes at the input result in an $M$-fold change in the corresponding output quantity. Comparing the denominators of (16.45) and (16.50), we observe that frequency division in the loop manifests itself as division of $K_{V C O}$ by $M$. In other words, as far as the poles of the closed-loop system are concerned, we can assume that the oscillator and the divider form a VCO with an equivalent gain of $K_{V C O} / M$. This is, of course, to be expected because, for the VCO/divider cascade shown in Fig. 16.56, we have

$$
\begin{align*}
\omega_{\text {out }} & =\frac{\omega_{0}+K_{V C O} V_{\text {cont }}}{M}  \tag{16.51}\\
& =\frac{\omega_{0}}{M}+\frac{K_{V C O}}{M} V_{c o n t} \tag{16.52}
\end{align*}
$$

Thus, the combination cannot be distinguished from a VCO having an intercept frequency of $\omega_{0} / M$ and a gain of $K_{V C O} / M$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-686.jpg?height=142&width=742&top_left_y=1537&top_left_x=783)

Figure 16.56 Equivalency of VCO/divider combination to a single VCO.
The foregoing discussion suggests that (16.46) and (16.47) can be respectively rewritten as

$$
\begin{align*}
\omega_{n} & =\sqrt{\frac{I_{P}}{2 \pi C_{P}} \frac{K_{V C O}}{M}}  \tag{16.53}\\
\zeta & =\frac{R_{P}}{2} \sqrt{\frac{I_{P} C_{P}}{2 \pi} \frac{K_{V C O}}{M}} \tag{16.54}
\end{align*}
$$

Also, the decay time constant is modified to $\left(\zeta \omega_{n}\right)^{-1}=4 \pi M /\left(R_{P} I_{P} K_{V C O}\right)$. It follows that inserting a divider in a type II loop degrades both the stability and the settling speed, requiring a proportional increase in the charge-pump current.

The frequency-multiplying loop of Fig. 16.55(b) exhibits two interesting properties. First, unlike the voltage amplifier of Fig. 16.55(a), the PLL provides a multiplication factor exactly equal to $M$, a unique attribute resulting from phase locking. Second, the output frequency can be varied by changing the divide ratio $M$, an extremely useful property in synthesizing frequencies. Note that DLLs cannot perform such synthesis.

Frequency Synthesis Some systems require a periodic waveform whose frequency (1) must be very accurate (e.g., exhibit an error less than 10 ppm ), and (2) can be varied in very fine steps (e.g., in steps of 30 kHz from 900 MHz to 925 MHz ). Commonly encountered in wireless transceivers, such requirements can be met through frequency multiplication by PLLs.

Figure 16.57 shows the architecture of a phase-locked frequency synthesizer. The channel control input is a digital word that defines the value of $M$. Since $f_{\text {out }}=M f_{R E F}$, the relative accuracy of $f_{\text {out }}$ is equal to that of $f_{R E F}$. For this reason, $f_{R E F}$ is derived from a stable, low-noise crystal oscillator. Note that $f_{\text {out }}$ varies in steps equal to $f_{R E F}$ if $M$ changes by one each time.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-687.jpg?height=357&width=831&top_left_y=766&top_left_x=664)

Figure 16.57 Frequency synthesizer.

CMOS frequency synthesizers achieving gigahertz output frequencies have been reported. Issues such as noise, sidebands, settling speed, frequency range, and power dissipation continue to challenge synthesizer designers.

### 16.5.2 Skew Reduction

The earliest usage of phase locking in digital systems was for skew reduction. Suppose a synchronous pair of data and clock lines enter a large digital chip, as shown in Fig. 16.58. Since the clock typically drives a large number of transistors and long interconnects, it is first applied to a large buffer. Thus, the clock distributed on the chip may suffer from substantial skew, $\Delta T$, with respect to the data, an undesirable effect because it reduces the timing budget for on-chip operations.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-687.jpg?height=342&width=1175&top_left_y=1747&top_left_x=498)

Figure 16.58 Skew between data and buffered clock.

Now consider the circuit shown in Fig. 16.59, where $C K_{\text {in }}$ is applied to an on-chip PLL and the buffer is placed inside the loop. Since the PLL guarantees a nominally-zero phase difference between $C K_{i n}$ and $C K_{B}$, the skew is eliminated. From another point of view, the constant phase shift introduced by the buffer is divided by the infinite loop gain of the feedback system. Note that the VCO output, $V_{V C O}$, may not be aligned with $C K_{i n}$, a nonetheless unimportant issue because $V_{V C O}$ is not used.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-688.jpg?height=216&width=1066&top_left_y=380&top_left_x=621)

Figure 16.59 Use of a PLL to eliminate skew.

#### Example 16.13

Construct the voltage-domain counterpart of the loop shown in Fig. 16.59.

#### Solution

The buffer creates a constant phase shift in the signal generated by the VCO. The voltage-domain counterpart therefore assumes the topology shown in Fig. 16.60. We have

$$
\begin{equation*}
\left(V_{\text {in }}-V_{\text {out }}\right) A+V_{M}=V_{\text {out }} \tag{16.55}
\end{equation*}
$$

and hence

$$
\begin{equation*}
V_{\text {out }}=\frac{A V_{\text {in }}+V_{M}}{1+A} \tag{16.56}
\end{equation*}
$$

As $A \rightarrow \infty, V_{\text {out }} \rightarrow V_{\text {in }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-688.jpg?height=245&width=529&top_left_y=1261&top_left_x=617)

Figure 16.60

We should note that the skew can be suppressed by a delay-locked loop as well. In fact, if frequency multiplication is not required, DLLs are preferred because they are less susceptible to noise.

### 16.5.3 Jitter Reduction

Recall from Sec. 16.3.2 that PLLs suppress fast jitter components at the input. For example, if a 1-GHz jittery signal is applied to a PLL having a bandwidth of 10 MHz , then input jitter components that vary faster than 10 MHz are attenuated. In a sense, the phase-locked loop operates as a narrowband filter centered around 1 GHz with a total bandwidth of 20 MHz . This is another important and useful property of PLLs.

Many applications must deal with jittery waveforms. Random binary signals experience jitter because of (1) crosstalk on the chip and in the package (Chapter 19), (2) package parasitics (Chapter 19), (3) additive electronic noise of devices, etc. Such waveforms are typically "retimed" by a low-noise clock so as to reduce the jitter. Illustrated in Fig. 16.61(a), the idea is to resample the midpoint of each bit by a D flipflop that is driven by the clock. However, in many applications, the clock may not be available independently. For example, an optical fiber carries only the random data stream, providing no separate clock waveform at the receive end. The circuit of Fig. 16.61(a) is therefore modified as shown in Fig. 16.61(b), where a "clock recovery circuit" (CRC) produces the clock from the data. Employing phase locking with a relatively narrow loop bandwidth, the circuit minimizes the effect of the input jitter on the recovered clock.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-689.jpg?height=260&width=845&top_left_y=361&top_left_x=660)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-689.jpg?height=245&width=799&top_left_y=699&top_left_x=683)
(b)

Figure 16.61 (a) Retiming data with D flipflop driven by a low-noise clock; (b) use of a phase-locked clock recovery circuit to generate the clock.
