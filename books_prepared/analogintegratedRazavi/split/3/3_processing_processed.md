# CHAPTER 3 Single-Stage Amplifiers

Amplification is an essential function in most analog (and many digital) circuits. We amplify an analog or digital signal because it may be too small to drive a load, overcome the noise of a subsequent stage, or provide logical levels to a digital circuit. Amplification also plays a critical role in feedback systems (Chapter 8).

In this chapter, we study the low-frequency behavior of single-stage CMOS amplifiers. Analyzing both the large-signal and the small-signal characteristics of each circuit, we develop intuitive techniques and models that prove useful in understanding more complex systems. An important part of a designer's job is to use proper approximations so as to create a simple mental picture of a complicated circuit. The intuition thus gained makes it possible to formulate the behavior of most circuits by inspection rather than by lengthy calculations.

Following a brief review of basic concepts, we describe in this chapter four types of amplifiers: common-source and common-gate topologies, source followers, and cascode configurations. In each case, we begin with a simple model and gradually add second-order phenomena such as channel-length modulation and body effect.

## 3.1 ■ Applications

Do you carry an amplifier? In all likelihood, yes. Your mobile phone, laptop, and digital camera all incorporate various types of amplifiers. The receiver in your phone must sense and amplify small signals received by the antenna, thus requiring a "low-noise" amplifier (LNA) at the front end (Fig. 3.1). As the signal travels down the receive chain, it must be further amplified by additional stages so as to reach an acceptably high level. This proves difficult because, in addition to the small desired signal, the antenna picks up other strong signals ("interferers") that are transmitted by various other users in the same vicinity. Your phone's transmitter, too, employs amplifiers: to amplify the signal generated by the microphone and, eventually, the signal delivered to the antenna. The "power amplifier" (PA) necessary for such delivery draws the most energy from the battery and still presents interesting challenges.

## 3.2 ■ General Considerations

An ideal amplifier generates an output, $y(t)$, that is a linear replica of the input, $x(t)$ :

$$
\begin{equation*}
y(t)=\alpha_{1} x(t) \tag{3.1}
\end{equation*}
$$

image_name:Desired Signal
description:The graph labeled "Desired Signal" is a frequency-domain representation illustrating two distinct signals. The x-axis represents frequency, denoted as \( f \), while the y-axis is not explicitly labeled but typically represents signal amplitude or power.

1. **Type of Graph and Function:**
- This is a frequency spectrum graph, commonly used to show the presence of signals at different frequencies.

2. **Axes Labels and Units:**
- The x-axis is labeled \( f \) for frequency. The y-axis is not labeled, but it typically represents amplitude or power.
- The scale is linear, as is common in such diagrams.

3. **Overall Behavior and Trends:**
- The graph shows two distinct peaks. The first peak, labeled "Desired Signal," is shorter and appears at a lower frequency. The second peak, labeled "Interferer," is taller and occurs at a higher frequency.
- The desired signal is narrower, indicating a specific frequency range, while the interferer is broader, suggesting it covers a wider frequency band.

4. **Key Features and Technical Details:**
- The desired signal is the target frequency that the system aims to receive or process.
- The interferer represents unwanted noise or signals that can disrupt or interfere with the desired signal.
- The graph visually emphasizes the distinction between the desired signal and potential interference, which is crucial for designing filters or amplifiers to isolate the desired signal.

5. **Annotations and Specific Data Points:**
- The graph is annotated with labels "Desired Signal" and "Interferer" to distinguish between the two signals.
- No specific numerical values or markers are provided for frequencies or amplitudes, but the visual representation clearly differentiates the two signal types.
image_name:Figure 3.1 General RF transceiver
description:The diagram labeled "Figure 3.1 General RF transceiver" illustrates the main components of a radio frequency (RF) transceiver system, which includes both receiving and transmitting sections.

1. **Main Components:**
- **Antenna:** Captures incoming RF signals and transmits outgoing signals.
- **Receiver Section:**
- **LNA (Low Noise Amplifier):** Amplifies the weak incoming signals received by the antenna while adding minimal noise, ensuring the signal quality is preserved.
- **Downconverter:** Converts the amplified high-frequency signal to a lower intermediate frequency (IF) for easier processing.
- **Amplifying Stages:** Further amplify the downconverted signal to levels suitable for demodulation and processing.
- **Transmitter Section:**
- **PA (Power Amplifier):** Amplifies the signal to be transmitted to a higher power level suitable for transmission over the air.
- **Upconverter:** Converts the signal from a lower frequency to the desired RF frequency for transmission.
- **Microphone (Mike):** Captures audio input that is processed and transmitted.

2. **Flow of Information or Control:**
- The signal flow in the receiver section begins at the antenna, which captures RF signals. The signals are then fed into the LNA, where they are amplified. The amplified signals proceed to the downconverter, which shifts them to a lower frequency before passing through additional amplifying stages for further amplification.
- In the transmitter section, the audio signal from the microphone is processed and then upconverted to a higher frequency. The upconverted signal is amplified by the PA before being transmitted via the antenna.

3. **Labels, Annotations, and Key Indicators:**
- The diagram includes labels such as "Desired Signal" and "Interferer," indicating the frequency spectrum of interest and potential noise or interference.
- Key components like LNA, PA, downconverter, and upconverter are clearly labeled, providing a clear understanding of their roles in the system.

4. **Overall System Function:**
- The primary function of this RF transceiver is to receive, process, and transmit RF signals. The receiver section ensures that incoming signals are amplified and converted to a manageable frequency for further processing, while the transmitter section prepares and amplifies outgoing signals for transmission. This arrangement allows for efficient communication by optimizing signal quality and power levels at each stage of the process.

Figure 3.1 General RF transceiver.
where $\alpha_{1}$ denotes the gain. Since the output signal is in fact superimposed on a bias (dc operating) point, $\alpha_{0}$, we can write the overall output as $y(t)=\alpha_{0}+\alpha_{1} x(t)$. In this case, the input-output (large-signal) characteristic of the circuit is a straight line [Fig. 3.2(a)]. However, as the signal excursions become larger and the bias point of the transistor(s) is disturbed substantially, the gain (the slope of the characteristic) begins to vary [Fig. 3.2(b)]. We approximate this nonlinear characteristic by a polynomial:

$$
\begin{equation*}
y(t)=\alpha_{0}+\alpha_{1} x(t)+\alpha_{2} x^{2}(t)+\cdots+\alpha_{n} x^{n}(t) \tag{3.2}
\end{equation*}
$$

A nonlinear amplifier distorts the signal of interest or creates unwanted interactions among several signals that may coexist at the input. We return to the problem of nonlinearity in Chapter 14.
image_name:(a)
description:The graph labeled "(a)" is a linear input-output characteristic of a system, likely representing a linear amplifier. This graph is a simple line plot on a two-dimensional Cartesian coordinate system.

1. **Type of Graph and Function:**
- The graph is a linear plot showing the relationship between input and output, typically used to represent linear systems.

2. **Axes Labels and Units:**
- The horizontal axis (x-axis) represents the input variable, denoted as \(x\).
- The vertical axis (y-axis) represents the output variable, denoted as \(y\).
- No specific units are provided for either axis, indicating a general representation of input-output behavior.

3. **Overall Behavior and Trends:**
- The graph shows a straight line with a positive slope, indicating a direct proportionality between the input and output.
- The line starts from the point \(\alpha_0\) on the y-axis, which represents the y-intercept of the line.
- The slope of the line is constant and denoted as \(\alpha_1\), indicating a consistent gain throughout the input range.

4. **Key Features and Technical Details:**
- The slope \(\alpha_1\) is a key feature as it represents the gain of the amplifier.
- The intercept \(\alpha_0\) indicates the output when the input is zero, often representing a bias or offset.
- This linearity suggests ideal, undistorted amplification with no saturation or clipping.

5. **Annotations and Specific Data Points:**
- There is a dashed line indicating the slope \(\alpha_1\), emphasizing the gain characteristic of the linear system.
- No specific numerical values are given, maintaining a general depiction of linear behavior.
image_name:(b)
description:The graph labeled (b) depicts the input-output characteristic of a nonlinear system. This is a typical representation of how a nonlinear amplifier behaves when the input signal is applied.

1. **Type of Graph and Function:**
- The graph is a plot of the output signal \( y \) versus the input signal \( x \), illustrating the nonlinear relationship between them.

2. **Axes Labels and Units:**
- The horizontal axis (\( x \)) represents the input signal.
- The vertical axis (\( y \)) represents the output signal.
- No specific units or scales are provided, but it is assumed to be linear based on typical practice in such diagrams.

3. **Overall Behavior and Trends:**
- The graph shows a curve that starts with a gentle slope, increases more sharply in the middle region, and then flattens out again as \( x \) increases. This indicates a saturation effect where the output no longer increases significantly despite increases in the input.
- The nonlinear behavior is characterized by a bending curve, suggesting that the gain of the system varies with the input level.

4. **Key Features and Technical Details:**
- The curve initially rises slowly, indicating lower gain at lower input levels.
- As the input increases to a certain range, the slope becomes steeper, showing higher gain.
- Beyond a certain point (around \( x_2 \)), the curve flattens, indicating saturation where further increases in input do not result in proportional increases in output.

5. **Annotations and Specific Data Points:**
- Two vertical dashed lines are marked at \( x_1 \) and \( x_2 \), possibly indicating important transition points or thresholds in the input signal where the behavior of the system changes significantly.
- No numerical values or specific data points are provided, but these lines suggest regions of interest in the analysis of the system's performance.

Figure 3.2 Input-output characteristic of a (a) linear and (b) nonlinear system.
What aspects of the performance of an amplifier are important? In addition to gain and speed, such parameters as power dissipation, supply voltage, linearity, noise, or maximum voltage swings may be important. Furthermore, the input and output impedances determine how the circuit interacts with the preceding and subsequent stages. In practice, most of these parameters trade with each other, making the design a multidimensional optimization problem. Illustrated in the "analog design octagon" of Fig. 3.3, such trade-offs present many challenges in the design of high-performance amplifiers, requiring intuition and experience to arrive at an acceptable compromise.

Table 3.1 gives a preview of the amplifier topologies studied in this chapter, indicating the much wider use of the common-source (CS) stage than other circuit configurations. For these amplifiers, we must (1) set up proper bias conditions so that each transistor provides the necessary transconductance and output resistance with certain quiescent currents and voltages, and (2) analyze the circuit's behavior as the input and output signals cause small or large departures from the bias input (small-signal and large-signal analyses, respectively). We deal with the latter task here and defer the former to Chapter 5.
image_name:Figure 3.3 Analog design octagon
description:The diagram titled "Figure 3.3 Analog design octagon" represents a conceptual framework for understanding the trade-offs involved in analog design. It is structured as an octagon, with each vertex representing a critical aspect of analog circuit performance. The components and their relationships are as follows:

1. **Noise**: Positioned at the top left of the octagon, noise represents the unwanted variations in the signal. It is directly linked with linearity, indicating a trade-off between maintaining signal purity and minimizing distortion.

2. **Linearity**: Located opposite noise, linearity is crucial for ensuring that the output signal is a linear function of the input. This is essential for reducing distortion in amplifiers and other analog circuits.

3. **Gain**: Found on the top right, gain refers to the amplification factor of the circuit. It is directly related to supply voltage, suggesting that changes in supply voltage can affect the gain characteristics.

4. **Supply Voltage**: Positioned next to gain, supply voltage is a critical factor that influences the power and performance of the circuit.

5. **Voltage Swings**: Located at the bottom right, voltage swings represent the range of output voltage that the circuit can handle without distortion.

6. **Speed**: Found at the bottom, speed refers to the circuit's ability to handle high-frequency signals. It is connected to voltage swings, indicating that larger swings can affect the speed.

7. **Input/Output Impedance**: Positioned at the bottom left, this factor affects how the circuit interfaces with other components. It is linked to speed, suggesting a balance between impedance and speed.

8. **Power Dissipation**: Located above input/output impedance, power dissipation is crucial for managing the thermal aspects of the circuit. It is connected to noise, indicating that power efficiency can influence noise levels.

The dashed lines within the octagon represent the complex interdependencies between these factors, highlighting the compromises that designers must make. For example, improving one aspect like speed might negatively impact another like power dissipation or noise.

Overall, the octagon serves as a visual tool for designers to understand and navigate the trade-offs inherent in analog circuit design, ensuring that the final product meets the desired specifications and performance criteria.

Figure 3.3 Analog design octagon.

Table 3.1 Amplifier categories.

| Common-Source Stage | Source Follower | Common-Gate Stage | Cascode |
| :---: | :---: | :---: | :---: |
| With Resistive Load | With Resistive Bias | With Resistive Load | Telescopic |
| With Diode-Connected Load | With Current-Source Bias | With Current-Source Load | Folded |
| With Current-Source Load |  |  |  |
| With Active Load |  |  |  |
| With Source Degeneration |  |  |  |

## 3.3 ■ Common-Source Stage

### 3.3.1 Common-Source Stage with Resistive Load

By virtue of its transconductance, a MOSFET converts changes in its gate-source voltage to a small-signal drain current, which can pass through a resistor to generate an output voltage. Shown in Fig. 3.4(a), the common-source stage performs such an operation. ${ }^{1}$ We study both the large-signal and the small-signal behavior of the circuit. Note that the input impedance of the circuit is very high at low frequencies.

If the input voltage increases from zero, $M_{1}$ is off and $V_{\text {out }}=V_{D D}$ [Fig. 3.4(b)]. As $V_{\text {in }}$ approaches $V_{T H}, M_{1}$ begins to turn on, drawing current from $R_{D}$ and lowering $V_{\text {out }}$. Transistor $M_{1}$ turns on in saturation regardless of the values of $V_{D D}$ and $R_{D}$ (why?), and we have

$$
\begin{equation*}
V_{\text {out }}=V_{D D}-R_{D} \frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{\text {in }}-V_{T H}\right)^{2} \tag{3.3}
\end{equation*}
$$

where channel-length modulation is neglected. With further increase in $V_{i n}, V_{o u t}$ drops more, and the transistor continues to operate in saturation until $V_{\text {in }}$ exceeds $V_{\text {out }}$ by $V_{T H}$ [point $A$ in Fig. 3.4(b)]. At this point,

$$
\begin{equation*}
V_{i n 1}-V_{T H}=V_{D D}-R_{D} \frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{i n 1}-V_{T H}\right)^{2} \tag{3.4}
\end{equation*}
$$

from which $V_{i n 1}-V_{T H}$ and hence $V_{\text {out }}$ can be calculated.
For $V_{i n}>V_{i n 1}, M_{1}$ is in the triode region:

$$
\begin{equation*}
V_{\text {out }}=V_{D D}-R_{D} \frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left[2\left(V_{\text {in }}-V_{T H}\right) V_{\text {out }}-V_{\text {out }}^{2}\right] \tag{3.5}
\end{equation*}
$$

image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
]
extrainfo:The circuit is a common-source amplifier with an NMOS transistor M1. The resistor RD is connected between VDD and the drain of M1, and the input voltage Vin is applied to the gate of M1. The output voltage Vout is taken from the drain of M1.
image_name:(b)
description:The graph labeled as (b) is an input-output characteristic graph for a common-source amplifier stage with a MOSFET, as depicted in the circuit schematic. This type of graph typically shows the relationship between the input voltage (V_in) and the output voltage (V_out) of the circuit.

1. **Type of Graph and Function:**
- This is an input-output characteristic curve for a MOSFET amplifier, specifically a common-source amplifier stage.

2. **Axes Labels and Units:**
- The x-axis represents the input voltage (V_in), typically in volts.
- The y-axis represents the output voltage (V_out), also in volts.
- Both axes likely use a linear scale, though specific units are not visible in the provided image.

3. **Overall Behavior and Trends:**
- The graph likely shows a region where the output voltage changes linearly with the input voltage, indicating the active region of the MOSFET operation.
- Beyond certain threshold voltages, the MOSFET may enter saturation or cutoff, causing the output voltage to level off or change more dramatically.

4. **Key Features and Technical Details:**
- The graph would typically exhibit a threshold point where the MOSFET begins to conduct significantly, corresponding to the threshold voltage (V_TH).
- The slope of the linear region would indicate the gain of the amplifier.
- Important points such as maximum output voltage and saturation regions would be marked if visible.

5. **Annotations and Specific Data Points:**
- The graph may include annotations like V_TH, maximum output voltage, or saturation region, though specific markers are not visible in the image provided.
- Numerical values for key data points like gain or threshold voltage are essential for detailed analysis but are not visible here.
image_name:(c)
description:
[
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
name: Ron, type: Resistor, value: Ron, ports: {N1: Vin, N2: GND}
]
extrainfo:The circuit is a common-source amplifier with an NMOS transistor M1. The input voltage Vin controls the output voltage Vout by modulating the current through the transistor. The resistor RD acts as the load, and VDD is the supply voltage.

image_name:(d)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: Vout, Nn: P}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
]
extrainfo:This circuit represents a small-signal model for the saturation region of a common-source amplifier. The voltage source Vin provides the input signal, while V1 is an additional voltage source influencing the current source gmV1. The resistor RD is connected to the output node Vout, which is the output of the amplifier.

Figure 3.4 (a) Common-source stage, (b) input-output characteristic, (c) equivalent circuit in the deep triode region, and (d) small-signal model for the saturation region.

If $V_{\text {in }}$ is high enough to drive $M_{1}$ into the deep triode region, $V_{o u t} \ll 2\left(V_{i n}-V_{T H}\right)$, and, from the equivalent circuit of Fig. 3.4(c),

$$
\begin{align*}
V_{\text {out }} & =V_{D D} \frac{R_{\text {on }}}{R_{o n}+R_{D}}  \tag{3.6}\\
& =\frac{V_{D D}}{1+\mu_{n} C_{o x} \frac{W}{L} R_{D}\left(V_{i n}-V_{T H}\right)} \tag{3.7}
\end{align*}
$$

Since the transconductance drops in the triode region, we usually ensure that $V_{\text {out }}>V_{\text {in }}-V_{T H}$, and hence the current operates to the left of point $A$ in Fig. 3.4(b). Using (3.3) as the input-output characteristic and viewing its slope as the small-signal gain, we have

$$
\begin{align*}
A_{v} & =\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}  \tag{3.8}\\
& =-R_{D} \mu_{n} C_{o x} \frac{W}{L}\left(V_{i n}-V_{T H}\right)  \tag{3.9}\\
& =-g_{m} R_{D} \tag{3.10}
\end{align*}
$$

This result can be directly derived from the observation that $M_{1}$ converts an input voltage change $\Delta V_{\text {in }}$ to a drain current change $g_{m} \Delta V_{i n}$, and hence an output voltage change $-g_{m} R_{D} \Delta V_{i n}$. The small-signal model of Fig. 3.4(d) yields the same result: $V_{\text {out }}=-g_{m} V_{1} R_{D}=-g_{m} V_{i n} R_{D}$. Note that, as mentioned in Chapter $2, V_{\text {in }}, V_{1}$, and $V_{\text {out }}$ in this figure denote small-signal quantities.

Even though derived for small-signal operation, the equation $A_{v}=-g_{m} R_{D}$ predicts certain effects if the circuit senses a large signal swing. Since $g_{m}$ itself varies with the input signal according to
$g_{m}=\mu_{n} C_{o x}(W / L)\left(V_{G S}-V_{T H}\right)$, the gain of the circuit changes substantially if the signal is large. In other words, if the gain of the circuit varies significantly with the signal swing, then the circuit operates in the large-signal mode. The dependence of the gain upon the signal level leads to nonlinearity (Chapter 14), usually an undesirable effect.

A key result here is that to minimize the nonlinearity, the gain equation must be a weak function of signal-dependent parameters such as $g_{m}$. We present several examples of this concept in this chapter and in Chapter 14.

#### Example 3.1

Sketch the drain current and transconductance of $M_{1}$ in Fig. 3.4(a) as a function of the input voltage.

#### Solution

The drain current becomes significant for $V_{i n}>V_{T H}$, eventually approaching $V_{D D} / R_{D}$ if $R_{o n 1} \ll R_{D}$ [Fig. 3.5(a)]. Since in saturation, $g_{m}=\mu_{n} C_{o x}(W / L)\left(V_{i n}-\right.$ $V_{T H}$ ), the transconductance begins to rise for $V_{i n}>V_{T H}$. In the triode region, $g_{m}=\mu_{n} C_{o x}(W / L) V_{D S}$, falling as $V_{i n}$ exceeds $V_{i n 1}$ [Fig. 3.5(b)]. Starting with Eq. (3.5), the reader can show that

$$
\begin{equation*}
A_{v}=\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}=\frac{-\mu_{n} C_{o x}(W / L) R_{D} V_{\text {out }}}{1+\mu_{n} C_{o x}(W / L) R_{D}\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right)} \tag{3.11}
\end{equation*}
$$

which reaches a maximum if $V_{\text {out }}=V_{\text {in }}-V_{T H}($ point $A)$.
image_name:(a)
description:1. **Type of Graph and Function:**
The graph is a plot of the drain current ($I_D$) versus the input voltage ($V_{in}$) for a MOSFET transistor, typically used to illustrate the transfer characteristics in the saturation region.

2. **Axes Labels and Units:**
- The x-axis represents the input voltage ($V_{in}$) in volts.
- The y-axis represents the drain current ($I_D$) in amperes.
- A horizontal dashed line marks the level $\frac{V_{DD}}{R_D}$, indicating the maximum possible current through the drain resistor.

3. **Overall Behavior and Trends:**
- The graph shows a threshold behavior typical of MOSFETs. Initially, as $V_{in}$ increases from zero, $I_D$ remains near zero until $V_{in}$ reaches the threshold voltage ($V_{TH}$).
- Beyond $V_{TH}$, $I_D$ increases rapidly, indicating the transistor entering saturation.
- The curve then flattens as $V_{in}$ increases further, approaching the maximum current level determined by $\frac{V_{DD}}{R_D}$, indicating the transistor is fully on.

4. **Key Features and Technical Details:**
- The threshold voltage ($V_{TH}$) is a critical point where the drain current begins to increase significantly.
- The saturation region is characterized by the steep increase in $I_D$.
- The flat region represents the current limiting by $R_D$ and $V_{DD}$, showing the maximum current capability of the circuit.

5. **Annotations and Specific Data Points:**
- The threshold voltage ($V_{TH}$) is marked on the x-axis as the point where the curve begins to rise.
- The dashed line at $\frac{V_{DD}}{R_D}$ on the y-axis indicates the maximum current level achievable in this configuration.

image_name:(b)
description:The graph labeled "(a)" is a plot representing the transconductance ($g_m$) of a device as a function of the input voltage ($V_{in}$). The x-axis is labeled as $V_{in}$, indicating the input voltage, and the y-axis is labeled as $g_m$, representing the transconductance. Both axes are likely in linear scale, although specific units are not provided.

The graph starts at the threshold voltage ($V_{TH}$), where the transconductance begins to rise from zero. This point marks the onset of conduction in the device. As the input voltage increases beyond $V_{TH}$, the transconductance $g_m$ increases sharply, reaching a peak at a point marked as $V_{in1}$. This peak is labeled as point 'A' on the graph, indicating the maximum transconductance the device can achieve.

Beyond $V_{in1}$, the transconductance begins to decrease, suggesting a region of reduced efficiency or saturation in the device's operation. The curve exhibits a bell-shaped trend, highlighting a peak transconductance at a specific input voltage, surrounded by regions of lower transconductance on either side.

Annotations include the marking of $V_{TH}$ on the x-axis, indicating the threshold voltage, and a dashed vertical line at $V_{in1}$, marking the input voltage at which the maximum transconductance occurs. This graph is typical for analyzing the performance characteristics of semiconductor devices, particularly in the context of their amplification capabilities.

#### Nanometer Design Notes

How does the CS stage behave in nanometer technologies? The figure plots the simulated input-output characteristic for $W / L=2 \mu \mathrm{~m} / 40 \mathrm{~nm}$, $R_{D}=2 \mathrm{k} \Omega$, and $V_{D D}=1 \mathrm{~V}$. We observe that the circuit provides a gain of about 3 in the input range of 0.4 V to 0.6 V . The output swing is limited to about $0.3 \mathrm{~V}-0.8$ V for the gain not to drop significantly.
image_name:Figure 3.5
description:The graph in Figure 3.5 is a plot of the input-output characteristic of a common-source (CS) stage in nanometer technology. The x-axis represents the input voltage, \( V_{in} \), in volts (V), ranging from 0 to 1 V. The y-axis represents the output voltage, \( V_{out} \), also in volts (V), ranging from 0 to 1 V.

The graph shows a nonlinear relationship between \( V_{in} \) and \( V_{out} \). At low input voltages (below approximately 0.4 V), the output voltage remains high, close to the supply voltage of 1 V. As the input voltage increases from 0.4 V to 0.6 V, the output voltage decreases sharply, indicating a region of high gain where the CS stage amplifies the input signal significantly. Beyond 0.6 V, the output voltage levels off, approaching a minimum value around 0.3 V as the input voltage reaches 1 V.

This behavior reflects the operating regions of the transistor in the CS stage: saturation at low \( V_{in} \), a transition region of high gain, and eventually triode operation as \( V_{in} \) increases. The gain is noted to be about 3 in the input range of 0.4 V to 0.6 V, and the output swing is limited to about 0.3 V to 0.8 V to maintain significant gain.

#### Example 3.2

A CS stage is driven by a sinusoid, $V_{i n}=V_{1} \cos \omega_{1} t+V_{0}$, where $V_{0}$ is the bias value and $V_{1}$ is large enough to drive the transistor into the off and triode regions. Sketch the $g_{m}$ of the transistor as a function of time.

#### Solution

Let us first sketch the output voltage (Fig. 3.6), noting that when $V_{\text {in }}=V_{1}+V_{0}, V_{\text {out }}$ is low, $M_{1}$ is in the triode region, and $g_{m}$ assumes a small value. As $V_{\text {in }}$ falls and $V_{\text {out }}$ and $g_{m}$ rise, $M_{1}$ enters saturation at $t=t_{1}$ (when $V_{\text {in }}-V_{\text {out }}=$ $V_{T H}$ ) and $g_{m}$ reaches its maximum (why?). As $V_{i n}$ falls further, so do $I_{D}$ and $g_{m}$. At $t=t_{2}, g_{m}$ reaches zero.

We observe that (a) since the voltage gain is approximately equal to $-g_{m} R_{D}$, it experiences the same variation as the $g_{m}$, and (b) $g_{m}$ varies periodically. ${ }^{2}$

image_name:Figure 3.6
description:The graph in Figure 3.6 illustrates three separate time-domain waveforms associated with a common-source amplifier circuit. Each waveform is plotted against the same horizontal time axis (t), which is linear.

1. **Top Graph (Vin)**:
- **Type**: Time-domain waveform.
- **Axes Labels**: The vertical axis represents the input voltage \(V_{in}\), with significant levels marked as \(V_1 + V_0\) and \(V_0\).
- **Behavior and Trends**: The waveform shows a sinusoidal pattern, oscillating between \(V_1 + V_0\) and below \(V_0\). This indicates a periodic input voltage with a peak-to-peak variation.

2. **Middle Graph (Vout)**:
- **Type**: Time-domain waveform.
- **Axes Labels**: The vertical axis represents the output voltage \(V_{out}\).
- **Behavior and Trends**: The waveform also follows a sinusoidal pattern, but with an inverted phase compared to \(V_{in}\), reflecting the negative voltage gain of the common-source amplifier. It reaches peaks and troughs at similar times as \(V_{in}\), but the amplitude and phase are altered.
- **Key Features**: The waveform crosses the zero line at points corresponding to \(t_1\) and \(t_2\), which are marked with vertical dashed lines.

3. **Bottom Graph (gm)**:
- **Type**: Time-domain waveform.
- **Axes Labels**: The vertical axis represents the transconductance \(g_m\).
- **Behavior and Trends**: The waveform is periodic, showing peaks and valleys. \(g_m\) reaches a maximum at \(t_1\) and decreases to zero at \(t_2\), indicating the points where the transistor enters and exits saturation respectively.
- **Key Features**: The periodic variation of \(g_m\) suggests a correlation with the sinusoidal nature of \(V_{in}\) and \(V_{out}\), impacting the voltage gain as described in the context.

Overall, the graph demonstrates the relationship between input voltage, output voltage, and transconductance in a common-source amplifier, highlighting the phase inversion and periodic behavior of these parameters.

How do we maximize the voltage gain of a common-source stage? Writing (3.10) as

$$
\begin{equation*}
A_{v}=-\sqrt{2 \mu_{n} C_{o x} \frac{W}{L} I_{D}} \frac{V_{R D}}{I_{D}} \tag{3.12}
\end{equation*}
$$

where $V_{R D}$ denotes the voltage drop across $R_{D}$, we have

$$
\begin{equation*}
A_{v}=-\sqrt{2 \mu_{n} C_{o x} \frac{W}{L}} \frac{V_{R D}}{\sqrt{I_{D}}} \tag{3.13}
\end{equation*}
$$

Thus, the magnitude of $A_{v}$ can be increased by increasing $W / L$ or $V_{R D}$ or decreasing $I_{D}$ if other parameters are constant. It is important to understand the trade-offs resulting from this equation. A larger device size leads to greater device capacitances, and a higher $V_{R D}$ limits the maximum voltage swings. For example, if $V_{D D}-V_{R D}=V_{i n}-V_{T H}$, then $M_{1}$ is at the edge of the triode region, allowing only very small swings at the output (and input). If $V_{R D}$ remains constant and $I_{D}$ is reduced, then $R_{D}$ must increase, thereby leading to a greater time constant at the output node. In other words, as noted in the analog design octagon, the circuit exhibits trade-offs between gain, bandwidth, and voltage swings. Lower supply voltages further tighten these trade-offs.

For large values of $R_{D}$, the effect of channel-length modulation in $M_{1}$ becomes significant. Modifying (3.3) to include this effect,

$$
\begin{equation*}
V_{\text {out }}=V_{D D}-R_{D} \frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{\text {in }}-V_{T H}\right)^{2}\left(1+\lambda V_{\text {out }}\right) \tag{3.14}
\end{equation*}
$$

we have

$$
\begin{align*}
\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}= & -R_{D} \mu_{n} C_{\text {ox }} \frac{W}{L}\left(V_{\text {in }}-V_{T H}\right)\left(1+\lambda V_{\text {out }}\right) \\
& -R_{D} \frac{1}{2} \mu_{n} C_{\text {ox }} \frac{W}{L}\left(V_{\text {in }}-V_{T H}\right)^{2} \lambda \frac{\partial V_{\text {out }}}{\partial V_{\text {in }}} \tag{3.15}
\end{align*}
$$

We recognize that $(1 / 2) \mu_{n} C_{o x}(W / L)\left(V_{i n}-V_{T H}\right)^{2} \lambda=1 / r_{O}$ and

$$
\begin{equation*}
A_{v}=-R_{D} g_{m}-\frac{R_{D}}{r_{O}} A_{v} \tag{3.16}
\end{equation*}
$$

Thus,

$$
\begin{equation*}
A_{v}=-g_{m} \frac{r_{O} R_{D}}{r_{O}+R_{D}} \tag{3.17}
\end{equation*}
$$

The small-signal model of Fig. 3.7 gives the same result with much less effort. That is, since $g_{m} V_{1}\left(r_{O} \| R_{D}\right)=-V_{\text {out }}$ and $V_{1}=V_{\text {in }}$, we have $V_{\text {out }} / V_{\text {in }}=-g_{m}\left(r_{O} \| R_{D}\right)$.
image_name:Figure 3.7 Small-signal model of CS stage including the transistor output resistance.
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: Vout, Nn: GND}
name: ro, type: Resistor, value: ro, ports: {N1: Vout, N2: GND}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
]
extrainfo:This is a small-signal model of a common-source amplifier stage including the transistor output resistance. The voltage gain is determined by the transconductance and the parallel combination of the output resistance and the drain resistor.

#### Example 3.3

Assuming that $M_{1}$ in Fig. 3.8 is biased in saturation, calculate the small-signal voltage gain of the circuit.
image_name:Figure 3.8
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: Vout}
]
extrainfo:This circuit is a common-source amplifier stage with an NMOS transistor (M1) and a current source (I1) as the load. The input voltage is applied to the gate of the NMOS, and the output is taken from the drain. The current source provides a high impedance load, maximizing the voltage gain.

#### Solution

Since $I_{1}$ introduces an infinite impedance $\left(R_{D}=\infty\right)$, the gain is limited by the output resistance of $M_{1}$ :

$$
\begin{equation*}
A_{v}=-g_{m} r_{O} \tag{3.18}
\end{equation*}
$$

Called the "intrinsic gain" of a transistor, this quantity represents the maximum voltage gain that can be achieved using a single device. In today's CMOS technology, $g_{m} r_{O}$ of short-channel devices is between roughly 5 and 10. We usually assume $1 / g_{m} \ll r_{O}$.

In Fig. 3.8, Kirchhoff's current law (KCL) requires that $I_{D 1}=I_{1}$. Then, how can $V_{i n}$ change the current of $M_{1}$ if $I_{1}$ is constant? Writing the total drain current of $M_{1}$ as

$$
\begin{align*}
I_{D 1} & =\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{\text {in }}-V_{T H}\right)^{2}\left(1+\lambda V_{o u t}\right)  \tag{3.19}\\
& =I_{1} \tag{3.20}
\end{align*}
$$

we note that $V_{\text {in }}$ appears in the square term and $V_{\text {out }}$ in the linear term. As $V_{\text {in }}$ increases, $V_{\text {out }}$ must decrease such that the product remains constant. We may nevertheless say " $I_{D 1}$ increases as $V_{i n}$ increases." This statement simply refers to the quadratic part of the equation.

An important conclusion here is that, to maximize the voltage gain, we must maximize the (smallsignal) load impedance. Why can we not replace the load with an open circuit? This is because the circuit still needs a path from $V_{D D}$ to ground for the bias current of $M_{1}$.

#### Example 3.4

It is possible to use the bulk (back gate) of a MOSFET as the terminal controlling the channel. Shown in Fig. 3.9 is an example. Determine the voltage gain if $\lambda=0$.

image_name:Figure 3.9
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
]
extrainfo:The circuit is a common-source (CS) stage with a resistor load (RD) and an NMOS transistor (M1). The output is taken from the drain of M1, and the input is applied to the gate. The circuit is powered by a voltage source VDD.

#### Solution

From the small-signal MOS model developed in Chapter 2, we recall that the drain current is given by $g_{m b} V_{i n}$. Thus, $A_{v}=-g_{m b} R_{D}$.

### 3.3.2 CS Stage with Diode-Connected Load

In some CMOS technologies, it is difficult to fabricate resistors with tightlycontrolled values or a reasonable physical size (Chapter 19). Consequently, it is desirable to replace $R_{D}$ in Fig. 3.4(a) with a MOS transistor.

A MOSFET can operate as a small-signal resistor if its gate and drain are shorted [Fig. 3.10(a)]. Called a "diode-connected" device in analogy with its bipolar counterpart, this configuration exhibits small-signal behavior similar to that of two-terminal resistor. Note that the transistor is always in saturation because the drain and the gate have the same potential. Using the small-signal equivalent shown in Fig. 3.10(b) to obtain the impedance of the device, we write $V_{1}=V_{X}$ and $I_{X}=V_{X} / r_{O}+g_{m} V_{X}$. That is, the impedance of the diode is simply equal to $V_{X} / I_{X}=\left(1 / g_{m}\right) \| r_{O} \approx 1 / g_{m}$. If body effect exists, we can use the circuit in Fig. 3.11 to write $V_{1}=-V_{X}, V_{b s}=-V_{X}$, and

$$
\begin{equation*}
\left(g_{m}+g_{m b}\right) V_{X}+\frac{V_{X}}{r_{O}}=I_{X} \tag{3.21}
\end{equation*}
$$

image_name:Figure 3.10 (a)
description:
[
name: M1, type: NMOS, ports: {S: s1, D: g1d1, G: g1d1}
name: M2, type: PMOS, ports: {S: s1, D: g2d2, G: g2d2}
]
extrainfo:The diagram shows diode-connected NMOS and PMOS devices. M1 is connected with its gate and drain tied together. M2 is similarly connected with its gate and drain tied together.
image_name:Figure 3.10 (b)
description:
[
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: X1, Nn: X2}
name: ro, type: Resistor, value: ro, ports: {N1: X1, N2: X2}
name: V1, type: VoltageSource, value: V1, ports: {Np: X1, Nn: X2}
name: VX, type: VoltageSource, value: VX, ports: {Np: X1, Nn: X2}
]
extrainfo:The circuit represents a small-signal equivalent of a diode-connected device, including a voltage-controlled current source, a resistor, and two voltage sources.

image_name:Figure 3.11 (a)(b)
description:
[
name: M1, type: NMOS, ports: {S: Vx, D: VDD, G: VDD}
name: Vx, type: VoltageSource, value: Vx, ports: {Np: Vx, Nn: GND}
'name': 'V1', 'type': 'VoltageSource', 'value': 'V1', 'ports': {'Np': 'Vx', 'Nn': 'GND'
'name': 'gmV1', 'type': 'VoltageControlledCurrentSource', 'ports': {'Np': 'GND', 'Nn': 'Vx'
'name': 'ro', 'type': 'Resistor', 'value': 'ro', 'ports': {'N1': 'Vx', 'N2': 'GND'
'name': 'gmbVbs', 'type': 'VoltageControlledCurrentSource', 'ports': {'Np': 'GND', 'Nn': 'Vx'
'name': 'Vx', 'type': 'VoltageSource', 'value': 'Vx', 'ports': {'Np': 'Vx', 'Nn': 'GND'
]
extrainfo:The circuit represents a small-signal equivalent of a diode-connected device, including a voltage-controlled current source, a resistor, and two voltage sources. It is used to analyze the equivalent resistance of a diode-connected MOSFET.

Figure 3.11 (a) Arrangement for measuring the equivalent resistance of a diode-connected MOSFET; (b) small-signal equivalent circuit.

It follows that

$$
\begin{align*}
\frac{V_{X}}{I_{X}} & =\frac{1}{g_{m}+g_{m b}+r_{O}^{-1}}  \tag{3.22}\\
& =\frac{1}{g_{m}+g_{m b}} \| r_{O}  \tag{3.23}\\
& \approx \frac{1}{g_{m}+g_{m b}} \tag{3.24}
\end{align*}
$$

In the general case, $V_{X} / I_{X}=\left(1 / g_{m}\right)\left\|r_{O}\right\|\left(1 / g_{m b}\right)$. Interestingly, the impedance seen at the source of $M_{1}$ is lower when body effect is included. Intuitive explanation of this effect is left as an exercise for the reader.

From a large-signal point of view, a diode-connected device acts as a "square-root" operator if its current is considered the input and its $V_{G S}$ or $V_{G S}-V_{T H}$ the output (why?). We return to this point later.

#### Example 3.5

Consider the circuit shown in Fig. 3.12(a). In some cases, we are interested in the impedance seen looking into the source, $R_{X}$. Determine $R_{X}$ if $\lambda=0$.
image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: S1, D: Vout, G: Vin}
name: ZL, type: Inductor, value: ZL, ports: {N1: VDD, N2: Vout}
]
extrainfo:The circuit is a common-source amplifier with an NMOS transistor M1. The inductor ZL is connected between VDD and the output node Vout. The resistor Rx is connected from the output node Vout to ground. The input voltage is applied to the gate of the NMOS, and the output is taken at Vout.

image_name:Figure 3.12(b)
description:
[
name: V1, type: VoltageSource, value: V1, ports: {Np: GND, Nn: Vx}
name: Vx, type: VoltageSource, value: Vx, ports: {Np: Vx, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: X2, Nn: Vx}
name: gmbVbs, type: VoltageControlledCurrentSource, ports: {Np: X2, Nn: Vxj}
name: ZL, type: Resistor, value: ZL, ports: {N1: X2, N2: GND}
]
extrainfo:The circuit is a small-signal model used to determine the impedance seen at the source with lambda=0. It includes voltage sources V1 and Vx, and current sources gmV1 and gmbVbs, along with a resistor ZL. The circuit is analyzed by setting all independent sources to zero and applying a test voltage source.

Figure 3.12 Impedance seen at the source with $\lambda=0$.

#### Solution

To determine $R_{X}$, we set all independent sources to zero, draw the small-signal model, and apply a voltage source as shown in Fig. 3.12(b). Since $V_{1}=-V_{X}$ and $V_{b s}=-V_{X}$, we have

$$
\begin{equation*}
\left(g_{m}+g_{m b}\right) V_{X}=I_{X} \tag{3.25}
\end{equation*}
$$

and

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{1}{g_{m}+g_{m b}} \tag{3.26}
\end{equation*}
$$

This result should not be surprising: the topologies in Fig. 3.12(a) and Fig. 3.11(a) are similar except that the drain of $M_{1}$ in Fig. 3.12(b) is not at ac ground. This difference does not manifest itself if $\lambda=0$. We sometimes say, "looking into the source of a MOSFET, we see $1 / g_{m}$," assuming implicitly that $\lambda=\gamma=0$.

We now study a common-source stage with a diode-connected load (Fig. 3.13). With negligible channel-length modulation, (3.24) can be substituted in (3.10) for the load impedance, yielding

$$
\begin{align*}
A_{v} & =-g_{m 1} \frac{1}{g_{m 2}+g_{m b 2}}  \tag{3.27}\\
& =-\frac{g_{m 1}}{g_{m 2}} \frac{1}{1+\eta} \tag{3.28}
\end{align*}
$$

where $\eta=g_{m b 2} / g_{m 2}$. Expressing $g_{m 1}$ and $g_{m 2}$ in terms of device dimensions and bias currents, we have

$$
\begin{equation*}
A_{v}=-\frac{\sqrt{2 \mu_{n} C_{o x}(W / L)_{1} I_{D 1}}}{\sqrt{2 \mu_{n} C_{o x}(W / L)_{2} I_{D 2}}} \frac{1}{1+\eta} \tag{3.29}
\end{equation*}
$$

and, since $I_{D 1}=I_{D 2}$,

$$
\begin{equation*}
A_{v}=-\sqrt{\frac{(W / L)_{1}}{(W / L)_{2}}} \frac{1}{1+\eta} \tag{3.30}
\end{equation*}
$$

This equation reveals an interesting property: if the variation of $\eta$ with the output voltage is neglected, the gain is independent of the bias currents and voltages (so long as $M_{1}$ stays in saturation). In other words, as the input and output signal levels vary, the gain remains relatively constant, indicating that the input-output characteristic is relatively linear.
image_name:Figure 3.13 CS stage with diode-connected load
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: NMOS, ports: {S: Vout, D: VDD, G: VDD}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
]
extrainfo:The circuit is a common-source (CS) stage with a diode-connected NMOS load (M2). The input voltage is applied to the gate of M1, and the output is taken from the drain of M1. M2 is connected in a diode configuration, providing a load for M1.

The linear behavior of the circuit can also be confirmed by large-signal analysis. Neglecting channellength modulation for simplicity, we have in Fig. 3.13

$$
\begin{equation*}
\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{1}\left(V_{i n}-V_{T H 1}\right)^{2}=\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{2}\left(V_{D D}-V_{o u t}-V_{T H 2}\right)^{2} \tag{3.31}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\sqrt{\left(\frac{W}{L}\right)_{1}}\left(V_{i n}-V_{T H 1}\right)=\sqrt{\left(\frac{W}{L}\right)_{2}}\left(V_{D D}-V_{\text {out }}-V_{T H 2}\right) \tag{3.32}
\end{equation*}
$$

Thus, if the variation of $V_{T H 2}$ with $V_{\text {out }}$ is small, the circuit exhibits a linear input-output characteristic. In essence, the squaring function performed by $M_{1}$ (from the input voltage to its drain current) and the square root function performed by $M_{2}$ (from its drain current to its overdrive) act as $f^{-1}(f(x))=x$.

The small-signal gain can also be computed by differentiating both sides with respect to $V_{i n}$ :

$$
\begin{equation*}
\sqrt{\left(\frac{W}{L}\right)_{1}}=\sqrt{\left(\frac{W}{L}\right)_{2}}\left(-\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}-\frac{\partial V_{T H 2}}{\partial V_{i n}}\right) \tag{3.33}
\end{equation*}
$$

which, upon application of the chain rule $\partial V_{T H 2} / \partial V_{\text {in }}=\left(\partial V_{T H 2} / \partial V_{\text {out }}\right)\left(\partial V_{\text {out }} / \partial V_{\text {in }}\right)=\eta\left(\partial V_{\text {out }} / \partial V_{\text {in }}\right)$, reduces to

$$
\begin{equation*}
\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}=-\sqrt{\frac{(W / L)_{1}}{(W / L)_{2}}} \frac{1}{1+\eta} \tag{3.34}
\end{equation*}
$$

It is instructive to study the overall large-signal characteristic of the circuit as well. But let us first consider the circuit shown in Fig. 3.14(a). What is the final value of $V_{\text {out }}$ if $I_{1}$ drops to zero? As $I_{1}$ decreases, so does the overdrive of $M_{2}$. Thus, for small $I_{1}, V_{G S 2} \approx V_{T H 2}$ and $V_{\text {out }} \approx V_{D D}-V_{T H 2}$. In reality, the subthreshold conduction in $M_{2}$ eventually brings $V_{\text {out }}$ to $V_{D D}$ if $I_{D}$ approaches zero, but at very low current levels, the finite capacitance at the output node slows down the change from $V_{D D}-V_{T H 2}$ to $V_{D D}$. This is illustrated in the time-domain waveforms of Fig. 3.14(b). For this reason, in circuits that have frequent switching activity, we assume that $V_{\text {out }}$ remains around $V_{D D}-V_{T H 2}$ when $I_{1}$ falls to small values.
image_name:(a)
description:
[
name: M2, type: NMOS, ports: {S: Vout, D: VDD, G: VDD}
name: I1, type: CurrentSource, value: I1, ports: {Np: Vout, Nn: GND}
name: Cp, type: Capacitor, value: Cp, ports: {Np: Vout, Nn: GND}
]
extrainfo:The circuit is a simple configuration with an NMOS transistor M2 connected in a diode configuration with its gate and drain tied together. It is biased by a current source I1 and has a capacitive load Cp at the output node Vout. The circuit is powered by VDD.

image_name:Figure 3.14 (b)
description:The graph in Figure 3.14 (b) consists of two plots stacked vertically, representing the behavior of a diode-connected NMOS transistor circuit with a stepped bias current.

1. **Type of Graph and Function:**
- The top plot is a time-domain waveform representing the bias current $I_1$ as a function of time $t$.
- The bottom plot shows the output voltage $V_{out}$ as a function of time $t$.

2. **Axes Labels and Units:**
- Both plots have the horizontal axis labeled as time $t$, with no specific units provided, suggesting a qualitative analysis.
- The vertical axis of the top plot is labeled as $I_1$, representing the current.
- The vertical axis of the bottom plot is labeled as $V_{out}$, with reference lines for $V_{DD}$ and $V_{DD} - V_{TH2}$, indicating voltage levels.

3. **Overall Behavior and Trends:**
- The top plot shows a step function for the current $I_1$. Initially, the current is zero, then it steps up to a constant value, and later returns to zero.
- In the bottom plot, $V_{out}$ starts at a lower level, rises sharply after the current step, and asymptotically approaches $V_{DD}$.

4. **Key Features and Technical Details:**
- The step in the current $I_1$ causes a corresponding change in $V_{out}$. Initially, $V_{out}$ is at $V_{DD} - V_{TH2}$, indicating the diode-connected NMOS is in saturation.
- As $I_1$ steps up, $V_{out}$ rises rapidly and then levels off near $V_{DD}$, showing the charging behavior of the capacitive load $C_p$.

5. **Annotations and Specific Data Points:**
- Reference lines for $V_{DD}$ and $V_{DD} - V_{TH2}$ are marked on the voltage plot, illustrating key voltage levels.
- The sharp transition in $V_{out}$ corresponds to the step change in $I_1$, highlighting the circuit's response to the stepped bias current.

Figure 3.14 (a) Diode-connected device with stepped bias current; (b) variation of source voltage versus time.
Now we return to the circuit of Fig. 3.13. Plotted in Fig. 3.15 versus $V_{i n}$, the output voltage equals $V_{D D}-V_{T H 2}$ if $V_{i n}<V_{T H 1}$. For $V_{i n}>V_{T H 1}$, Eq. (3.32) holds and $V_{\text {out }}$ follows an approximately straight line. As $V_{\text {in }}$ exceeds $V_{\text {out }}+V_{T H 1}$ (beyond point $A$ ), $M_{1}$ enters the triode region, and the characteristic becomes nonlinear.

image_name:Figure 3.15 Input-output characteristic of a CS stage with diode-connected load.
description:The graph in Figure 3.15 is a plot of the input-output characteristic of a common-source (CS) stage with a diode-connected load. This is a voltage transfer characteristic graph.

1. **Type of Graph and Function:**
- This is a voltage transfer characteristic graph, showing the relationship between input voltage ($V_{in}$) and output voltage ($V_{out}$).

2. **Axes Labels and Units:**
- The x-axis represents the input voltage ($V_{in}$) and the y-axis represents the output voltage ($V_{out}$). Both axes are typically in volts.
- The graph uses a linear scale.

3. **Overall Behavior and Trends:**
- For input voltages less than $V_{TH1}$, the output voltage remains constant at $V_{DD} - V_{TH2}$.
- As $V_{in}$ surpasses $V_{TH1}$, the output voltage begins to decrease linearly.
- Beyond point A, where $V_{in}$ exceeds $V_{out} + V_{TH1}$, the behavior becomes nonlinear due to $M_1$ entering the triode region.

4. **Key Features and Technical Details:**
- The graph shows a distinct change in behavior at $V_{TH1}$.
- Point A marks the transition where nonlinearity begins to occur.
- The initial flat region indicates the saturation region of the MOSFET, followed by a linear region, and then a nonlinear region.

5. **Annotations and Specific Data Points:**
- The graph is annotated with $V_{TH1}$ and $V_{DD} - V_{TH2}$, indicating the threshold voltage and the initial output voltage level, respectively.
- Point A is labeled to indicate the beginning of the nonlinear region.

The diode-connected load of Fig. 3.13 can be implemented with a PMOS device as well. Shown in Fig. 3.16, the circuit is free from body effect, providing a small-signal voltage gain equal to

$$
\begin{equation*}
A_{v}=-\sqrt{\frac{\mu_{n}(W / L)_{1}}{\mu_{p}(W / L)_{2}}} \tag{3.35}
\end{equation*}
$$

where channel-length modulation is neglected.
image_name:Figure 3.16 CS stage with diodeconnected PMOS device
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vout}
]
extrainfo:The circuit is a common-source (CS) stage with a diode-connected PMOS load. The PMOS transistor M2 is diode-connected, meaning its gate and drain are connected together. This configuration provides a load for the NMOS transistor M1. The input voltage Vin is applied to the gate of M1, and the output voltage Vout is taken from the drain of M1, which is also the drain of M2.

Figure 3.16 CS stage with diodeconnected PMOS device.

Equations (3.30) and (3.35) indicate that the gain of a common-source stage with diode-connected load is a relatively weak function of the device dimensions. For example, to achieve a gain of 5 , $\mu_{n}(W / L)_{1} /\left[\mu_{p}(W / L)_{2}\right]=25$, implying that, with $\mu_{n} \approx 2 \mu_{p}$, we must have $(W / L)_{1} \approx 12.5(W / L)_{2}$. In a sense, a high gain requires a "strong" input device and a "weak" load device. In addition to disproportionately wide or long transistors (and hence a large input or load capacitance), a high gain translates to another important limitation: reduction in allowable voltage swings. Specifically, since in Fig. 3.16, $I_{D 1}=\left|I_{D 2}\right|$,

$$
\begin{equation*}
\mu_{n}\left(\frac{W}{L}\right)_{1}\left(V_{G S 1}-V_{T H 1}\right)^{2}=\mu_{p}\left(\frac{W}{L}\right)_{2}\left(V_{G S 2}-V_{T H 2}\right)^{2} \tag{3.36}
\end{equation*}
$$

if $\lambda=0$, revealing that

#### Nanometer Design Notes

Let us design and simulate a CS stage with a diode-connected PMOS load in $40-\mathrm{nm}$ technology. We select $W / L=$ $5 \mu \mathrm{~m} / 40 \mathrm{~nm}$ for the NMOS device and $1 \mu \mathrm{~m} / 40 \mathrm{~nm}$ for the PMOS device. The large-signal I-V characteristic is shown in the figure. We observe that the circuit provides a small-signal gain of about 1.5 for an input range of roughly 0.4 V to 0.5 V . (In this dc sweep, $V_{\text {out }}$ can reach $V_{D D}$ when the input transistor is off.)
image_name:large-signal I-V characteristic
description:The graph is a large-signal I-V characteristic plot, typically used to illustrate the relationship between input and output voltages in a transistor circuit. The x-axis represents the input voltage ($V_{in}$) in volts, ranging from 0 to 1 V. The y-axis represents the output voltage ($V_{out}$) in volts, also ranging from 0 to 1 V. Both axes use a linear scale.

The graph displays a curve that starts at the top-left corner, indicating a high output voltage when the input voltage is near 0 V. As the input voltage increases, the output voltage decreases sharply. This behavior is indicative of a diode-connected PMOS load, where the output voltage drops as the input voltage increases, typical in a common-source amplifier configuration.

Key features of the graph include:
- A steep decline in $V_{out}$ as $V_{in}$ approaches 0.4 V, suggesting a strong inversion region.
- A more gradual slope between 0.4 V and 0.5 V, which corresponds to the small-signal gain region mentioned in the context, where the gain is about 1.5.
- Beyond 0.5 V, the output voltage continues to decrease but at a slower rate, indicating the saturation of the transistor.

The graph does not have specific annotations, but the critical region of interest is around the input voltage range of 0.4 V to 0.5 V, where the circuit provides the specified gain. The output voltage can reach close to 1 V when the input transistor is off, aligning with $V_{DD}$ as mentioned in the context.

$$
\begin{equation*}
\frac{\left|V_{G S 2}-V_{T H 2}\right|}{V_{G S 1}-V_{T H 1}}=A_{v} \tag{3.37}
\end{equation*}
$$

In the above example, the overdrive voltage of $M_{2}$ must be 5 times that of $M_{1}$. For example, with $V_{G S 1}-V_{T H 1}=100 \mathrm{mV}$ and $\left|V_{T H 2}\right|=0.3 \mathrm{~V}$, we have $\left|V_{G S 2}\right|=0.8 \mathrm{~V}$, severely limiting the output swing. This is another example of the trade-offs suggested by the analog design octagon. Note that, with diode-connected loads, the swing is constrained by both the required overdrive voltage and the threshold voltage. That is, even with a small overdrive, the output level cannot exceed $V_{D D}-\left|V_{T H}\right|$.

An interesting paradox arises here if we write $g_{m}=\mu C_{o x}(W / L)$ $V_{G S}-V_{T H} \mid$. The voltage gain of the circuit is then given by

$$
\begin{align*}
\left|A_{v}\right| & =\frac{g_{m 1}}{g_{m 2}}  \tag{3.38}\\
& =\frac{\mu_{n} C_{o x}(W / L)_{1}\left(V_{G S 1}-V_{T H 1}\right)}{\mu_{p} C_{o x}(W / L)_{2}\left|V_{G S 2}-V_{T H 2}\right|} \tag{3.39}
\end{align*}
$$

Equation (3.39) implies that $A_{v}$ is inversely proportional to $\left|V_{G S 2}-V_{T H 2}\right|$. It is left for the reader to resolve the seemingly opposite trends suggested by (3.37) and (3.39).

#### Example 3.6

In the circuit of Fig. 3.17, $M_{1}$ is biased in saturation with a drain current equal to $I_{1}$. The current source $I_{S}=0.75 I_{1}$ is added to the circuit. How is (3.37) modified for this case? Assume $\lambda=0$.
image_name:Figure 3.17
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vout}
name: IS, type: CurrentSource, value: IS, ports: {Np: VDD, Nn: Vout}
]
extrainfo:The circuit is a typical cascode amplifier with NMOS M1 and PMOS M2. The current source IS is connected between VDD and Vout, and another current source I1 is connected between Vout and ground. The input is applied at Vin and the output is taken from Vout.

#### Solution

Since $\left|I_{D 2}\right|=I_{1} / 4$, we have

$$
\begin{align*}
A_{v} & =-\frac{g_{m 1}}{g_{m 2}}  \tag{3.40}\\
& =-\sqrt{\frac{4 \mu_{n}(W / L)_{1}}{\mu_{p}(W / L)_{2}}} \tag{3.41}
\end{align*}
$$

Moreover,

$$
\begin{equation*}
\mu_{n}\left(\frac{W}{L}\right)_{1}\left(V_{G S 1}-V_{T H 1}\right)^{2}=4 \mu_{p}\left(\frac{W}{L}\right)_{2}\left(V_{G S 2}-V_{T H 2}\right)^{2} \tag{3.42}
\end{equation*}
$$

yielding

$$
\begin{equation*}
\frac{\left|V_{G S 2}-V_{T H 2}\right|}{V_{G S 1}-V_{T H 1}}=\frac{A_{v}}{4} \tag{3.43}
\end{equation*}
$$

Thus, for a gain of 5, the overdrive of $M_{2}$ need be only 1.25 times that of $M_{1}$. Alternatively, for a given overdrive voltage, this circuit achieves a gain four times that of the stage in Fig. 3.16. Intuitively, this is because for a given $\left|V_{G S 2}-V_{T H 2}\right|$, if the current decreases by a factor of 4 , then $(W / L)_{2}$ must decrease proportionally, and $g_{m 2}=\sqrt{2 \mu_{p} C_{o x}(W / L)_{2} I_{D 2}}$ is lowered by the same factor.

#### Example 3.7

A student attempts to calculate the voltage gain in the previous example by differentiating both sides of (3.42). Does this approach give a correct result? Why?

#### Solution

Since $V_{G S 2}=V_{\text {out }}-V_{D D}$, differentiation and multiplication by $C_{o x}$ yield

$$
\begin{equation*}
\mu_{n} C_{o x}\left(\frac{W}{L}\right)_{1}\left(V_{\text {in }}-V_{T H 1}\right)^{2}=4 \mu_{p} C_{o x}\left(\frac{W}{L}\right)_{2}\left(V_{\text {out }}-V_{D D}-V_{T H 2}\right) \frac{\partial V_{\text {out }}}{\partial V_{\text {in }}} \tag{3.44}
\end{equation*}
$$

It follows that $\partial V_{\text {out }} / \partial V_{\text {in }}=-g_{m 1} /\left(4 g_{m 2}\right)$. This incorrect result arises because (3.42) is valid for only one value of $V_{i n}$. As $V_{i n}$ is perturbed by the signal, $I_{1}$ departs from $4\left|I_{D 2}\right|$ and (3.42) cannot be differentiated.

In today's CMOS technology, channel-length modulation is quite significant and, more important, the behavior of transistors notably departs from the square law. Thus, the gain of the stage in Fig. 3.13 must be expressed as

$$
\begin{equation*}
A_{v}=-g_{m 1}\left(\frac{1}{g_{m 2}}\left\|r_{O 1}\right\| r_{O 2}\right) \tag{3.45}
\end{equation*}
$$

where $g_{m 1}$ and $g_{m 2}$ must be obtained as described in Chapter 17 .

### 3.3.3 CS Stage with Current-Source Load

In applications requiring a large voltage gain in a single stage, the relationship $A_{v}=-g_{m} R_{D}$ suggests that we should increase the load impedance of the CS stage. With a resistor or diode-connected load, however, increasing the load resistance translates to a large dc drop across the load, thereby limiting the output voltage swing.

A more practical approach is to replace the load with a device that does not obey Ohm's law, e.g., a current source. Described briefly in Example 3.3, the resulting circuit is shown in Fig. 3.18, where both transistors operate in saturation. Since the total impedance seen at the output node is equal to $r_{O 1} \| r_{O 2}$, the gain is given by is

$$
\begin{equation*}
A_{v}=-g_{m 1}\left(r_{O 1} \| r_{O 2}\right) \tag{3.46}
\end{equation*}
$$

The key point here is that the output impedance and the minimum required $\left|V_{D S}\right|$ of $M_{2}$ are less strongly coupled than the value and voltage drop of a resistor; the former need not satisfy Ohm's law, but the latter must. The voltage $\left|V_{D S 2, \text { min }}\right|=\left|V_{G S 2}-V_{T H 2}\right|$ can be reduced to less than a hundred millivolts by simply increasing the width of $M_{2}$. If $r_{O 2}$ is not sufficiently high, the length and width of $M_{2}$ can be increased to achieve a smaller $\lambda$ while maintaining the same overdrive voltage. The penalty is the larger capacitance introduced by $M_{2}$ at the output node.
image_name:Figure 3.18 CS stage with current-source load
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vb}
]
extrainfo:The circuit is a common-source (CS) stage with a current-source load. The PMOS M2 acts as a load for the NMOS M1, providing a high output impedance. The bias voltage Vb is used to set the operating point of M2. The voltage-controlled current source g_m2V2 and resistor r_o2 model the output characteristics of M2.
We should remark that the output bias voltage of the circuit in Fig. 3.18 is not well-defined. Thus, the stage is reliably biased only if a feedback loop forces $V_{\text {out }}$ to a known value (Chapter 8). The large-signal analysis of the circuit is left as an exercise for the reader.

As explained in Chapter 2, the output impedance of MOSFETs at a given drain current can be scaled by changing the channel length, i.e., to the first order, $\lambda \propto 1 / L$, and hence $r_{O} \propto L / I_{D}$. Since the gain of the stage shown in Fig. 3.18 is proportional to $r_{O 1} \| r_{O 2}$, we may surmise that longer transistors yield a higher voltage gain.

Let us consider $M_{1}$ and $M_{2}$ separately. If $L_{1}$ is scaled up by a factor of $\alpha(>1)$, then $W_{1}$ may need to be scaled proportionally as well. This is because, for a given drain current, $V_{G S 1}-V_{T H 1} \propto 1 / \sqrt{(W / L)_{1}}$, i.e., if $W_{1}$ is not scaled, the overdrive voltage increases, limiting the output voltage swing. Also, since $g_{m 1} \propto \sqrt{(W / L)_{1}}$, scaling up only $L_{1}$ lowers $g_{m 1}$.

In applications where these issues are unimportant, $W_{1}$ can remain constant while $L_{1}$ increases. Thus, the intrinsic gain of $M_{1}$ can be written as

$$
\begin{equation*}
g_{m 1} r_{O 1}=\sqrt{2\left(\frac{W}{L}\right)_{1} \mu_{n} C_{o x} I_{D}} \frac{1}{\lambda I_{D}} \tag{3.47}
\end{equation*}
$$

indicating that the gain increases with $L$ because $\lambda$ depends more strongly on $L$ than $g_{m}$ does. Also, note that $g_{m} r_{O}$ decreases as $I_{D}$ increases.

Increasing $L_{2}$ while keeping $W_{2}$ constant increases $r_{O 2}$ and hence the voltage gain, but at the cost of a higher $\left|V_{D S 2, \min }\right|$, which is required to maintain $M_{2}$ in saturation.

#### Example 3.8

Compare the maximum output voltage swings of CS stages with resistive and current-source loads.

#### Solution

For the resistively-loaded stage [Fig. 3.19(a)], the maximum output voltage is near $V_{D D}$ (when $V_{i n}$ falls to about $\left.V_{T H 1}\right)$. The minimum is the value that places $M_{1}$ at the edge of the triode region, $V_{i n}-V_{T H 1}$.
image_name:Figure 3.19(a)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
]
extrainfo:The circuit diagram (a) shows a common-source (CS) stage with a resistive load. The NMOS transistor M1 is used to amplify the input signal Vin, and the resistor RD provides a load for the output. The maximum output voltage swing is near VDD, and the minimum is determined by the threshold voltage VTH1. The output voltage is labeled as Vout.
image_name:Figure 3.19(b)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vb}
]
extrainfo:The circuit diagram (b) shows a CS stage with a current-source load. M1 is an NMOS transistor with its source connected to ground, the drain connected to the output node Vout, and the gate connected to the input node Vin. M2 is a PMOS transistor with its source connected to VDD, the drain connected to Vout, and the gate connected to a bias voltage Vb. The resistor RD is connected between VDD and Vout. This configuration allows for a maximum output voltage swing determined by VDD and the threshold voltages of the transistors.

Figure 3.19 Output swing in CS stage with (a) resistive load and (b) current-source load.
For the stage with a current-source load [Fig. 3.19(b)], the maximum output voltage is that which places $M_{2}$ at the edge of the triode region, $V_{D D}-\left|V_{G S 2}-V_{T H 2}\right|$. Thus, the latter actually provides smaller swings than the former, but can always achieve a higher gain if $L_{1}$ and $L_{2}$ are increased.

### 3.3.4 CS Stage with Active Load

In the amplifier topology of Fig. 3.19(b), the PMOS device serves as a constant current source. Is it possible for $M_{2}$ to operate as an amplifying device? Yes; we can apply the input signal to the gate of $M_{2}$ as well [Fig. 3.20(a)], converting it to an "active" load. The reader may recognize this topology as a CMOS inverter. Suppose both transistors are in saturation and $V_{i n}$ rises by $\Delta V_{0}$. Two changes now occur: (a) $I_{D 1}$ increases, pulling $V_{\text {out }}$ lower, and (b) $M_{2}$ injects less current into the output node, allowing $V_{\text {out }}$ to drop. The two changes thus enhance each other, leading to a greater voltage gain. Equivalently, as seen in Fig. 3.20(b), the two transistors operate in parallel and collapse into one as illustrated in Fig. 3.20(c). It follows that $-\left(g_{m 1}+g_{m 2}\right) V_{i n}\left(r_{O 1} \| r_{O 2}\right)=V_{\text {out }}$, and hence

$$
\begin{equation*}
A_{v}=-\left(g_{m 1}+g_{m 2}\right)\left(r_{O 1} \| r_{O 2}\right) \tag{3.48}
\end{equation*}
$$

Compared to the amplifier of Fig. 3.19(b), this circuit exhibits the same output resistance, $r_{O 1} \| r_{O 2}$, but a higher transconductance. This topology is also called a "complementary CS stage."

The amplifier of Fig. 3.20(a) must deal with two critical issues. First, the bias current of the two transistors is a strong function of PVT. In particular, since $V_{G S 1}+\left|V_{G S 2}\right|=V_{D D}$, variations in $V_{D D}$ or the threshold voltages directly translate to changes in the drain currents. Second, the circuit amplifies
image_name:(a)
description:
[
name: Vin, type: VoltageSource, ports: {Np: Vin, Nn: GND}
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vin}
]
extrainfo:The circuit is a complementary CS stage with an NMOS M1 and a PMOS M2. It provides a high transconductance and the same output resistance, ro1 || ro2, with Vout as the output node.
image_name:(b)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: gm1V1, type: VoltageControlledCurrentSource, value: gm1V1, ports: {Np: Vout, Nn: GND}
name: gm2V2, type: VoltageControlledCurrentSource, value: gm2V2, ports: {Np: Vout, Nn: GND}
name: ro1, type: Resistor, value: ro1, ports: {N1: Vout, N2: GND}
name: ro2, type: Resistor, value: ro2, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit diagram (b) illustrates a small-signal model with voltage-controlled current sources gm1V1 and gm2V2, and resistors ro1 and ro2 connected to the output node Vout.
image_name:(c)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: (gm1+gm2)Vin, type: VoltageControlledCurrentSource, value: (gm1+gm2)Vin, ports: {Np: Vout, Nn: GND}
name: ro1||ro2, type: Resistor, value: ro1||ro2, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit diagram (c) represents a simplified model of a complementary CS stage amplifier. It includes a voltage source Vin, a voltage-controlled current source (gm1+gm2)Vin, and two parallel resistors ro1 and ro2 connected from Vout to ground.

Figure 3.20 (a) CS stage with active load, (b) small-signal model, and (c) simplified model.
supply voltage variations ("supply noise")! To understand this point, consider the arrangement depicted in Fig. 3.21, where $V_{B}$ is a bias voltage to place $M_{1}$ and $M_{2}$ in saturation. In Problem 3.31, we prove that the small-signal gain from $V_{D D}$ to $V_{\text {out }}$ is given by

#### Nanometer Design Notes

With minimum channel lengths, the CS stage with current-source load provides a low gain. For example, if $(W / L)$ NMOS $=5 \mu \mathrm{~m} / 40 \mathrm{~nm}$ and $(W / L)$ PMOS $=10 \mu \mathrm{~m} / 40 \mathrm{~nm}$, we obtain the input-output characteristic shown in the figure, where the maximum gain is about 2.5 ! If we plot the slope, we also see the useful output voltage range to be about 0.7 V with $V_{D D}=1 \mathrm{~V}$. Outside this range, the gain drops considerably.
image_name:input-output characteristic
description:The graph is an input-output characteristic plot, displaying the relationship between the input voltage \( V_{in} \) and the output voltage \( V_{out} \) of a common-source (CS) stage with a current-source load.

1. **Type of Graph and Function:**
- This is a voltage transfer characteristic graph.

2. **Axes Labels and Units:**
- The x-axis represents the input voltage \( V_{in} \) in volts (V), ranging from 0 to 1 V.
- The y-axis represents the output voltage \( V_{out} \) in volts (V), also ranging from 0 to 1 V.
- The graph uses a linear scale for both axes.

3. **Overall Behavior and Trends:**
- The graph shows a non-linear relationship between \( V_{in} \) and \( V_{out} \).
- As \( V_{in} \) increases from 0 to approximately 0.3 V, \( V_{out} \) remains relatively constant near its maximum value close to 1 V.
- Between approximately 0.3 V and 0.6 V of \( V_{in} \), \( V_{out} \) decreases sharply, indicating the region of maximum gain.
- Beyond 0.6 V of \( V_{in} \), \( V_{out} \) levels off and approaches a minimum value close to 0 V.

4. **Key Features and Technical Details:**
- The maximum gain occurs in the steepest part of the curve, around \( V_{in} = 0.3 \) to 0.6 V, where the slope is steepest.
- The useful output voltage range is about 0.7 V, as mentioned in the context, which corresponds to the linear region of the graph.
- Outside this range, the gain drops significantly, as evidenced by the flattening of the curve at both low and high \( V_{in} \) values.

5. **Annotations and Specific Data Points:**
- The graph does not have specific numerical annotations, but the context indicates that the maximum gain is about 2.5 within the useful range.
- Important data points include the transition region between 0.3 V and 0.6 V of \( V_{in} \), where the output voltage changes most rapidly.

image_name:A_v vs V_in
description:1. **Type of Graph and Function:**
- The graph is a plot of voltage gain \( A_v \) versus input voltage \( V_{in} \). It appears to be a linear plot.

2. **Axes Labels and Units:**
- The x-axis represents the input voltage \( V_{in} \) in volts (V), ranging from 0 to 1 V.
- The y-axis represents the voltage gain \( A_v \), with values ranging from 0 to -3.
- The graph uses a linear scale for both axes.

3. **Overall Behavior and Trends:**
- The graph shows a downward trend in gain as \( V_{in} \) increases from 0 to about 0.4 V, reaching a minimum gain of approximately -3 at around 0.5 V.
- Beyond this point, the gain increases as \( V_{in} \) continues to rise, returning to around 0 at \( V_{in} = 1 \) V.
- The shape of the curve resembles a parabolic dip centered around \( V_{in} = 0.5 \) V.

4. **Key Features and Technical Details:**
- The minimum gain occurs near \( V_{in} = 0.5 \) V, where \( A_v \) is approximately -3.
- The gain is highest at both ends of the \( V_{in} \) range, being close to 0 at \( V_{in} = 0 \) V and \( V_{in} = 1 \) V.
- The transition region, where the gain changes most rapidly, is between 0.3 V and 0.6 V of \( V_{in} \).

5. **Annotations and Specific Data Points:**
- There are no specific numerical annotations on the graph, but the context suggests that the critical region for gain variation is between 0.3 V and 0.6 V of \( V_{in} \).
- The maximum gain within the useful range is about 2.5, although this is not directly visible on the graph.

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{D D}} & =\frac{g_{m 2} r_{O 2}+1}{r_{O 2}+r_{O 1}} r_{O 1}  \tag{3.49}\\
& =\left(g_{m 2}+\frac{1}{r_{O 2}}\right)\left(r_{O 1} \| r_{O 2}\right) \tag{3.50}
\end{align*}
$$

about half of the $A_{v}$ found above. These issues are addressed in Chapter 5.
image_name:Figure 3.21 Arrangement for studying supply sensitivity of CS stage with active load
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: VB}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: VB}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
]
extrainfo:The circuit is a common-source amplifier with an active load. M1 is the NMOS transistor and M2 is the PMOS transistor. The gate of both transistors is connected to a bias voltage VB. The output is taken from the drain of M1 and M2, labeled as Vout. The circuit is powered by a voltage source VDD.

### 3.3.5 CS Stage with Triode Load

A MOS device operating in the deep triode region behaves as a resistor and can therefore serve as the load in a CS stage. Illustrated in Fig. 3.22, such a circuit biases the gate of $M_{2}$ at a sufficiently low level, ensuring that the load is in the deep triode region for all output voltage swings. Since

$$
\begin{equation*}
R_{o n 2}=\frac{1}{\mu_{p} C_{o x}(W / L)_{2}\left(V_{D D}-V_{b}-\left|V_{T H P}\right|\right)} \tag{3.51}
\end{equation*}
$$

the voltage gain can be readily calculated.
The principal drawback of this circuit stems from the dependence of $R_{o n 2}$ upon $\mu_{p} C_{o x}, V_{b}$, and $V_{T H P}$. Since $\mu_{p} C_{o x}$ and $V_{T H P}$ vary with process and temperature, and since generating a precise value for $V_{b}$ requires additional complexity, this circuit is difficult to use. Triode loads, however, consume less voltage headroom than do diode-connected devices because in Fig. 3.22, $V_{\text {out }, \max }=V_{D D}$, whereas in Fig. 3.16, $V_{\text {out }, \max } \approx V_{D D}-\left|V_{T H P}\right|$.
image_name:Figure 3.22 CS stage with triode load
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vb}
name: Ron2, type: Resistor, value: Ron2, ports: {N1: VDD, N2: Vout}
]
extrainfo:The circuit diagram shows a CS stage with a triode load. It includes an NMOS transistor M1 and a PMOS transistor M2. M2 is configured as a triode load, and the circuit also includes a resistor Ron2 connected between VDD and Vout. The configuration allows for maximum output voltage close to VDD.

Among the five CS variants studied above, those employing resistive, current-source, or active loads find wider usage than the other two.
image_name:Figure 3.23 CS stage with source degeneration.(a)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: M1, type: NMOS, ports: {S: s1, D: Vout, G: Vin}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: RS, type: Resistor, value: RS, ports: {N1: s1, N2: GND}
]
extrainfo:The circuit diagram (a) shows a common-source (CS) stage with source degeneration using an NMOS transistor M1. The source degeneration is provided by resistor RS, which helps to linearize the circuit by reducing the gain. The NMOS transistor M1 is connected to a load resistor RD, and the output is taken from the drain of M1. The circuit is powered by VDD, and the input voltage is Vin.
image_name:Figure 3.23 CS stage with source degeneration.(b)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: RS, type: Resistor, value: RS, ports: {N1: s1, N2: GND}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: GND, Nn: ID}
]
extrainfo:The circuit is a common-source (CS) stage with source degeneration, using an NMOS transistor M1. The source degeneration is provided by the resistor RS. The voltage-controlled current source gmV1 models the transconductance of the NMOS. The input voltage Vin is applied to the gate of M1, and the output is taken from the drain (Vout).

### 3.3.6 CS Stage with Source Degeneration

In some applications, the nonlinear dependence of the drain current upon the overdrive voltage introduces excessive nonlinearity, making it desirable to "soften" the device characteristics. In Sec. 3.3.2, we noted the linear behavior of a CS stage using a diode-connected load, which allows "postcorrection" of the nonlinearity. Alternatively, as depicted in Fig. 3.23(a), this can be accomplished by placing a "degeneration" resistor in series with the source terminal so as to make the input device more linear. Let us neglect channel-length modulation and body effect. Here, as $V_{i n}$ increases, so do $I_{D}$ and the voltage drop across $R_{S}$. That is, a fraction of the change in $V_{i n}$ appears across the resistor rather than as the gate-source overdrive, thus leading to a smoother variation of $I_{D}$. From another perspective, we intend to make the gain equation a weaker function of $g_{m}$. Since $V_{\text {out }}=V_{D D}-I_{D} R_{D}$, the nonlinearity of the circuit arises from the nonlinear dependence of $I_{D}$ upon $V_{i n}$. We note that $\partial V_{\text {out }} / \partial V_{i n}=-\left(\partial I_{D} / \partial V_{i n}\right) R_{D}$, and define the equivalent transconductance of the circuit as $G_{m}=\partial I_{D} / \partial V_{i n} .{ }^{3}$ Now, assuming that $I_{D}=f\left(V_{G S}\right)$, we write

$$
\begin{align*}
G_{m} & =\frac{\partial I_{D}}{\partial V_{i n}}  \tag{3.52}\\
& =\frac{\partial f}{\partial V_{G S}} \frac{\partial V_{G S}}{\partial V_{i n}} \tag{3.53}
\end{align*}
$$

[^12]Since $V_{G S}=V_{i n}-I_{D} R_{S}$, we have $\partial V_{G S} / \partial V_{i n}=1-R_{S} \partial I_{D} / \partial V_{i n}$, obtaining

$$
\begin{equation*}
G_{m}=\left(1-R_{S} \frac{\partial I_{D}}{\partial V_{i n}}\right) \frac{\partial f}{\partial V_{G S}} \tag{3.54}
\end{equation*}
$$

But, $\partial f / \partial V_{G S}$ is the transconductance of $M_{1}$, and

$$
\begin{equation*}
G_{m}=\frac{g_{m}}{1+g_{m} R_{S}} \tag{3.55}
\end{equation*}
$$

The small-signal voltage gain is thus equal to

$$
\begin{align*}
A_{v} & =-G_{m} R_{D}  \tag{3.56}\\
& =\frac{-g_{m} R_{D}}{1+g_{m} R_{S}} \tag{3.57}
\end{align*}
$$

The same result can be derived using the small-signal model of Fig. 3.23(b) by writing a KVL, $V_{i n}=$ $V_{1}+I_{D} R_{S}$, and noting that $I_{D}=g_{m} V_{1}$. Equation (3.55) implies that as $R_{S}$ increases, $G_{m}$ becomes a weaker function of $g_{m}$ and hence the drain current. In fact, for $R_{S} \gg 1 / g_{m}$, we have $G_{m} \approx 1 / R_{S}$, i.e., $\Delta I_{D} \approx \Delta V_{i n} / R_{S}$, concluding that most of the change in $V_{i n}$ appears across $R_{S}$. We say that the drain current is a "linearized" function of the input voltage. In Problem 3.30, we examine this effect from a different perspective. The linearization is obtained at the cost of lower gain [and higher noise (Chapter 7)].

For our subsequent calculations, it is useful to determine $G_{m}$ in the presence of body effect and channel-length modulation. With the aid of the equivalent circuit shown in Fig. 3.24, we recognize that the current through $R_{S}$ equals $I_{\text {out }}$ and, therefore, $V_{\text {in }}=V_{1}+I_{\text {out }} R_{S}$. Summing the currents at node $X$, we have

$$
\begin{align*}
I_{\text {out }} & =g_{m} V_{1}-g_{m b} V_{X}-\frac{I_{\text {out }} R_{S}}{r_{O}}  \tag{3.58}\\
& =g_{m}\left(V_{\text {in }}-I_{\text {out }} R_{S}\right)+g_{m b}\left(-I_{\text {out }} R_{S}\right)-\frac{I_{\text {out }} R_{S}}{r_{O}} \tag{3.59}
\end{align*}
$$

It follows that

$$
\begin{align*}
G_{m} & =\frac{I_{\text {out }}}{V_{\text {in }}}  \tag{3.60}\\
& =\frac{g_{m} r_{O}}{R_{S}+\left[1+\left(g_{m}+g_{m b}\right) R_{S}\right] r_{O}} \tag{3.61}
\end{align*}
$$

image_name:Figure 3.24 Small-signal equivalent circuit of a degenerated CS stage
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: V1, type: VoltageSource, value: V1, ports: {Np: V1, Nn: X}
name: Rs, type: Resistor, value: Rs, ports: {N1: X, N2: GND}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: GND, Nn: X}
name: ro, type: Resistor, value: ro, ports: {N1: X, N2: X}
name: gmbVbs, type: VoltageControlledCurrentSource, value: gmbVbs, ports: {Np: GND, Nn: X}
]
extrainfo:The circuit is a small-signal equivalent of a degenerated common-source stage. It includes a voltage source Vin, a resistor Rs, and two voltage-controlled current sources representing transconductance gm and body effect gmb.

Figure 3.24 Small-signal equivalent circuit of a degenerated CS stage.

Let us now examine the large-signal behavior of the CS stage with $R_{S}=0$ and $R_{S} \neq 0$. For $R_{S}=0$, our derivations in Chapter 2 indicate that $I_{D}$ and $g_{m}$ vary as shown in Fig. 3.25(a). For $R_{S} \neq 0$, the turn-on behavior is similar to that in Fig. 3.25(a) because, at low current levels, $1 / g_{m} \gg R_{S}$, and hence $G_{m} \approx g_{m}\left[\right.$ Fig. 3.25(b)]. As the overdrive and therefore $g_{m}$ increase, the effect of degeneration, $1+g_{m} R_{S}$ in (3.55), becomes more significant. For large values of $V_{i n}$ (if $M_{1}$ is still saturated), $I_{D}$ is approximately a linear function of $V_{i n}$ and $G_{m}$ approaches $1 / R_{S}$.
image_name:(a)
description:The graph in Fig. 3.25(a) consists of two separate plots, each illustrating a different relationship involving the input voltage, \( V_{in} \), for a common-source (CS) device without source degeneration.

1. **Left Plot - Drain Current \( I_D \) vs. Input Voltage \( V_{in} \):**
- **Type of Graph:** This is a current-voltage characteristic curve.
- **Axes Labels and Units:** The x-axis represents the input voltage \( V_{in} \) and the y-axis represents the drain current \( I_D \). Units are not specified but are typically in volts for \( V_{in} \) and amperes for \( I_D \).
- **Overall Behavior and Trends:** The graph shows a threshold-like behavior starting at a voltage \( V_{TH} \). Below \( V_{TH} \), the drain current \( I_D \) is negligible. As \( V_{in} \) exceeds \( V_{TH} \), \( I_D \) begins to increase, initially in a nonlinear fashion, indicating the device is turning on. Beyond this, the current increases more linearly with \( V_{in} \).
- **Key Features and Technical Details:** The threshold voltage \( V_{TH} \) marks the point where the device begins to conduct significantly.

2. **Right Plot - Transconductance \( g_m \) vs. Input Voltage \( V_{in} \):**
- **Type of Graph:** This is a transconductance-voltage characteristic curve.
- **Axes Labels and Units:** The x-axis represents the input voltage \( V_{in} \), and the y-axis represents the transconductance \( g_m \). Units for \( g_m \) are typically siemens.
- **Overall Behavior and Trends:** The plot shows \( g_m \) starting from zero at \( V_{TH} \) and increasing linearly with \( V_{in} \) as the input voltage increases beyond \( V_{TH} \).
- **Key Features and Technical Details:** The linear increase in \( g_m \) indicates that the device's ability to conduct increases steadily with increasing \( V_{in} \) past the threshold voltage.

These graphs illustrate the basic turn-on characteristics of a CS device without source degeneration, showing how both the drain current and transconductance respond to changes in input voltage.

image_name:(b)
description:The graph labeled (b) consists of two plots, each demonstrating the effect of source degeneration on a common-source (CS) device. The left plot shows the drain current ($I_D$) as a function of the input voltage ($V_{in}$), while the right plot displays the transconductance ($G_m$) versus the same input voltage.

Left Plot: Drain Current ($I_D$ vs. $V_{in}$)
- **Axes Labels and Units:**
- The horizontal axis represents the input voltage ($V_{in}$).
- The vertical axis represents the drain current ($I_D$).
- **Overall Behavior and Trends:**
- The plot begins at the threshold voltage ($V_{TH}$), which is marked on the horizontal axis.
- Initially, the curve rises slowly, indicating a sub-threshold region.
- Beyond $V_{TH}$, the curve becomes linear, showing a direct proportionality between $I_D$ and $V_{in}$.
- **Key Features and Technical Details:**
- The slope of the linear region is indicated as $1/R_S$, highlighting the impact of source degeneration resistance on the drain current.

Right Plot: Transconductance ($G_m$ vs. $V_{in}$)
- **Axes Labels and Units:**
- The horizontal axis represents the input voltage ($V_{in}$).
- The vertical axis represents the transconductance ($G_m$).
- **Overall Behavior and Trends:**
- The transconductance is initially flat near zero for $V_{in}$ values below $V_{TH}$, indicating minimal transconductance.
- As $V_{in}$ increases beyond $V_{TH}$, $G_m$ rises steeply and then levels off, approaching a maximum value.
- **Key Features and Technical Details:**
- The maximum transconductance value is marked as $1/R_S$, showing the limiting effect of source degeneration on $G_m$.

Annotations and Specific Data Points:
- Both plots mark the threshold voltage ($V_{TH}$) as a critical point where the behavior of the device changes.
- The slope in the linear region of the $I_D$ plot and the maximum value of $G_m$ are both related to the source degeneration resistance ($R_S$), emphasizing its role in the device's performance.

Figure 3.25 Drain current and transconductance of a CS device (a) without and (b) with source degeneration.

#### Example 3.9

Plot the small-signal voltage gain of the circuit in Fig. 3.23 as a function of the input bias voltage, $V_{i n}$.

#### Solution

Using the results derived above for the equivalent transconductance of $M_{1}$ and $R_{S}$, we arrive at the plot shown in Fig. 3.26. For $V_{i n}$ slightly greater than $V_{T H}, 1 / g_{m} \gg R_{S}$ and $A_{v} \approx-g_{m} R_{D}$. As $V_{i n}$ increases, degeneration becomes more significant and $A_{v}=-g_{m} R_{D} /\left(1+g_{m} R_{S}\right)$. For large values of $V_{i n}, G_{m} \approx 1 / R_{S}$ and $A_{v}=-R_{D} / R_{S}$. However, if $V_{\text {in }}>V_{\text {out }}+V_{T H}$, that is, if $R_{D} I_{D}>V_{T H}+V_{D D}-V_{i n}, M_{1}$ enters the triode region and $A_{v}$ drops.
image_name:Figure 3.26
description:The graph in Figure 3.26 is a plot depicting the voltage gain \( |A_v| \) as a function of the input voltage \( V_{in} \). The x-axis represents the input voltage \( V_{in} \), while the y-axis represents the magnitude of the voltage gain \( |A_v| \). The graph is plotted on a linear scale for both axes.

**Overall Behavior and Trends:**
- The graph starts at a low gain level when \( V_{in} \) is slightly greater than the threshold voltage \( V_{TH} \).
- Initially, as \( V_{in} \) increases, the gain \( |A_v| \) rises sharply, indicating a region where the gain is approximately \( g_m R_D \), reflecting the transconductance \( g_m \) and the drain resistance \( R_D \).
- As \( V_{in} \) continues to increase, the rate of increase in gain diminishes, transitioning into a more gradual slope.
- Eventually, the gain approaches a maximum value of \( R_D / R_S \), where \( R_S \) is the source resistance. This indicates that the system is entering a region dominated by source degeneration.

**Key Features and Technical Details:**
- The graph shows a clear transition from a region with a steep gain increase to a saturation region where the gain levels off.
- The point \( V_{TH} \) marks the threshold voltage beyond which the gain begins to rise.
- The maximum gain \( R_D / R_S \) is shown as a dashed line parallel to the x-axis, indicating the asymptotic behavior of the gain as \( V_{in} \) becomes large.

**Annotations and Specific Data Points:**
- The threshold voltage \( V_{TH} \) is a critical point on the x-axis where the gain starts to increase.
- The annotation \( g_m R_D \) marks the initial gain slope region, showing the dependence on transconductance and drain resistance.
- The dashed line at \( R_D / R_S \) serves as a reference for the maximum achievable gain in this configuration.

Equation (3.57) can be rewritten as

$$
\begin{equation*}
A_{v}=-\frac{R_{D}}{\frac{1}{g_{m}}+R_{S}} \tag{3.62}
\end{equation*}
$$

This result allows formulating the gain by inspection. First, let us examine the denominator of (3.62). The expression is equal to the series combination of the inverse transconductance of the device and the explicit resistance seen from the source to ground. We call the denominator "the resistance seen in the source path" because if, as shown in Fig. 3.27, we disconnect the bottom terminal of $R_{S}$ from ground and calculate the resistance seen "looking up" (while setting the input to zero), we obtain $R_{S}+1 / g_{m}$.

image_name:Figure 3.27 Resistance seen in the source path
description:
[
name: M, type: NMOS, ports: {S: S1, D: LOAD, G: Vin}
name: Rs, type: Resistor, value: Rs, ports: {N1: S1, N2: GND}
]
extrainfo:The circuit is a simple NMOS amplifier with a resistor Rs connected to the source. The resistance seen in the source path is Rs + 1/gm, where gm is the transconductance of the NMOS transistor. The load is connected to the drain of the NMOS transistor.

Noting that the numerator of (3.62) is the resistance seen at the drain, we view the magnitude of the gain as the resistance seen at the drain node divided by the total resistance in the source path. This method greatly simplifies the analysis of more complex circuits.

#### Example 3.10

Assuming $\lambda=\gamma=0$, calculate the small-signal gain of the circuit shown in Fig. 3.28(a).
image_name:Figure 3.28(a)
description:
[
name: M1, type: NMOS, ports: {S: s1s2, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: s1s2, D: GND, G: s1s2}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
]
extrainfo:The circuit is a common-source amplifier with an NMOS transistor M1 and a diode-connected PMOS transistor M2. The resistor RD is connected between VDD and Vout. M2 is used for source degeneration, which increases the output resistance and stabilizes the gain.
image_name:Figure 3.28(b)
description:
[
name: M1, type: NMOS, ports: {S: s1s2, D: Vout, G: Vin}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: VDD}
name: 1/gm2, type: Resistor, value: 1/gm2, ports: {N1: s1s2, N2: GND}
]
extrainfo:The circuit in Figure 3.28(b) shows a simplified small-signal model with M2 replaced by a resistor of value 1/gm2. M1 is an NMOS transistor with its source connected to node s1s2, drain to Vout, and gate to Vin. The resistor RD is connected between Vout and VDD. The configuration is used to calculate small-signal gain.

#### Solution

Noting that $M_{2}$ is a diode-connected device and simplifying the circuit to that shown in Fig. 3.28(b), we use the above rule to write

$$
\begin{equation*}
A_{v}=-\frac{R_{D}}{\frac{1}{g_{m 1}}+\frac{1}{g_{m 2}}} \tag{3.63}
\end{equation*}
$$

Output Resistance Another important consequence of source degeneration is the increase in the output resistance of the stage. We calculate the output resistance first with the aid of the equivalent circuit shown in Fig. 3.29, where the load resistor, $R_{D}$, is excluded for now. Note that body effect is also included to
image_name:Figure 3.29
description:
[
name: Rs, type: Resistor, value: Rs, ports: {N1: P, N2: GND}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: P, Nn: Vx}
name: ro, type: Resistor, value: ro, ports: {N1: P, N2: Vx}
name: gmbVbs, type: VoltageControlledCurrentSource, value: gmbVbs, ports: {Np: P, Nn: Vx}
name: Vx, type: VoltageSource, value: Vx, ports: {Np: Vx, Nn: GND}
]
extrainfo:The circuit is used to calculate the output resistance of a degenerated common-source stage, including the body effect.
Figure 3.29 Equivalent circuit for calculating the output resistance of a degenerated CS stage.
arrive at a general result. Since the current through $R_{S}$ is equal to $I_{X}, V_{1}=-I_{X} R_{S}$, and the current flowing through $r_{O}$ is given by $I_{X}-\left(g_{m}+g_{m b}\right) V_{1}=I_{X}+\left(g_{m}+g_{m b}\right) R_{S} I_{X}$. Adding the voltage drops across $r_{O}$ and $R_{S}$, we obtain

$$
\begin{equation*}
r_{O}\left[I_{X}+\left(g_{m}+g_{m b}\right) R_{S} I_{X}\right]+I_{X} R_{S}=V_{X} \tag{3.64}
\end{equation*}
$$

It follows that

$$
\begin{align*}
R_{\text {out }} & =\left[1+\left(g_{m}+g_{m b}\right) R_{S}\right] r_{O}+R_{S}  \tag{3.65}\\
& =\left[1+\left(g_{m}+g_{m b}\right) r_{O}\right] R_{S}+r_{O} \tag{3.66}
\end{align*}
$$

Equation (3.65) indicates that $r_{O}$ is "boosted" by a factor of $1+\left(g_{m}+g_{m b}\right) R_{S}$ and then added to $R_{S}$. As an alternative perspective, Eq. (3.66) suggests that $R_{S}$ is boosted by a factor of $1+\left(g_{m}+g_{m b}\right) r_{O}$ (a value close to the transistor's intrinsic gain) and then added to $r_{O}$. Both views prove useful in analyzing circuits. Note that the overall output resistance is equal to the parallel combination of $R_{\text {out }}$ and $R_{D}$. If $\left(g_{m}+g_{m b}\right) r_{O} \gg 1$, we have

$$
\begin{align*}
R_{\text {out }} & \approx\left(g_{m}+g_{m b}\right) r_{O} R_{S}+r_{O}  \tag{3.67}\\
& =\left[1+\left(g_{m}+g_{m b}\right) R_{S}\right] r_{O} \tag{3.68}
\end{align*}
$$

To gain more insight, let us consider the circuit of Fig. 3.29 with $R_{S}=0$ and $R_{S}>0$. If $R_{S}=0$, then $g_{m} V_{1}=g_{m b} V_{b s}=0$ and $I_{X}=V_{X} / r_{O}$. On the other hand, if $R_{S}>0$, we have $I_{X} R_{S}>0$ and $V_{1}<0$, obtaining negative $g_{m} V_{1}$ and $g_{m b} V_{b s}$. Thus, the current supplied by $V_{X}$ is less than $V_{X} / r_{O}$, and hence the output impedance is greater than $r_{O}$.

The relationship in (3.65) can also be derived by inspection. As shown in Fig. 3.30(a), we apply a voltage to the output node, change its value by $\Delta V$, and measure the resulting change, $\Delta I$, in the output current. Since the current through $R_{S}$ must change by $\Delta I$ (why?), we first compute the voltage change across $R_{S}$. To this end, we draw the circuit as shown in Fig. 3.30(b) and note that the resistance seen looking into the source of $M_{1}$ is equal to $1 /\left(g_{m}+g_{m b}\right)$ [Eq. (3.24)], thus arriving at the equivalent circuit in Fig. 3.30(c). The voltage change across $R_{S}$ is therefore equal to

$$
\begin{equation*}
\Delta V_{R S}=\Delta V \frac{\frac{1}{g_{m}+g_{m b}} \| R_{S}}{\frac{1}{g_{m}+g_{m b}} \| R_{S}+r_{O}} \tag{3.69}
\end{equation*}
$$

image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: S1, D: deltaV, G: Vin}
name: ro, type: Resistor, value: ro, ports: {N1: deltaV, N2: S1}
name: RS, type: Resistor, value: RS, ports: {N1: S1, N2: GND}
]
extrainfo:The circuit shows a change in drain current in response to a change in applied voltage to the drain. It includes an NMOS transistor M1 with a resistor ro connected between the drain and source, and another resistor RS connected to ground. The voltage change across RS and the corresponding current change are analyzed.
image_name:(b)
description:
[
name: M1, type: NMOS, ports: {S: S1, D: ΔV, G: GND}
name: ro, type: Resistor, value: ro, ports: {N1: ΔV, N2: S1}
name: RS, type: Resistor, value: RS, ports: {N1: S1, N2: GND}
]
extrainfo:The circuit in diagram (b) is an equivalent circuit model for analyzing the voltage change across RS due to a change in applied voltage to the drain of M1. It shows the NMOS transistor M1 with its source connected to node S1, drain connected to the node labeled ΔV, and gate also connected to ΔV. The resistor ro is connected between ΔV and S1, while RS is connected between S1 and ground.
image_name:(c)
description:
[
name: ro, type: Resistor, value: ro, ports: {N1: ΔV, N2: S1}
name: RS, type: Resistor, value: RS, ports: {N1: S1, N2: GND}
name: 1/(gm+gmb), type: Resistor, value: 1/(gm+gmb), ports: {N1: GND, N2: S1}
]
extrainfo:The circuit is a small-signal model showing the voltage change across RS due to a change in drain current. It includes an NMOS transistor M1, a resistor ro connected between Vo and S1, and a resistor RS connected between S1 and ground. The equivalent resistance looking into the source of M1 is 1/(gm+gmb).
Figure 3.30 (a) Change in drain current in response to change in applied voltage to drain; (b) equivalent of (a); (c) small-signal model.

The change in the current is

$$
\begin{align*}
\Delta I & =\frac{\Delta V_{R S}}{R_{S}}  \tag{3.70}\\
& =\Delta V \frac{1}{\left[1+\left(g_{m}+g_{m b}\right)\right] R_{S} r_{O}+R_{S}} \tag{3.71}
\end{align*}
$$

that is,

$$
\begin{equation*}
\frac{\Delta V}{\Delta I}=\left[1+\left(g_{m}+g_{m b}\right) R_{S}\right] r_{O}+R_{S} \tag{3.72}
\end{equation*}
$$

With the foregoing developments, we can now compute the gain of a degenerated CS stage in the general case, taking into account both body effect and channel-length modulation. In the equivalent circuit depicted in Fig. 3.31, the current through $R_{S}$ must equal that through $R_{D}$, i.e., $-V_{\text {out }} / R_{D}$. Thus, the source voltage with respect to ground (and the bulk) is equal to $-V_{\text {out }} R_{S} / R_{D}$, yielding $V_{1}=V_{\text {in }}+V_{\text {out }} R_{S} / R_{D}$. The current flowing through $r_{O}$ from top to bottom can therefore be written as

$$
\begin{align*}
I_{r o} & =-\frac{V_{\text {out }}}{R_{D}}-\left(g_{m} V_{1}+g_{m b} V_{\text {bs }}\right)  \tag{3.73}\\
& =-\frac{V_{\text {out }}}{R_{D}}-\left[g_{m}\left(V_{\text {in }}+V_{\text {out }} \frac{R_{S}}{R_{D}}\right)+g_{m b} V_{\text {out }} \frac{R_{S}}{R_{D}}\right] \tag{3.74}
\end{align*}
$$

image_name:Figure 3.31 Small-signal model of degenerated CS stage with finite output resistance
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: V1, type: VoltageSource, value: V1, ports: {Np: Vin, Nn: P}
name: RS, type: Resistor, value: RS, ports: {N1: P, N2: GND}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: Vout, Nn: P}
name: ro, type: Resistor, value: ro, ports: {N1: Vout, N2: P}
name: gmbVbs, type: VoltageControlledCurrentSource, ports: {Np: Vout, Nn: P}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit is a small-signal model of a degenerated common-source stage with finite output resistance. It includes a voltage source Vin, a resistor RS, and controlled current sources gmV1 and gmbVbs connected to node P. The output is taken across resistor RD.

Figure 3.31 Small-signal model of degenerated CS stage with finite output resistance.
Since the voltage drops across $r_{O}$ and $R_{S}$ must add up to $V_{\text {out }}$, we have

$$
\begin{align*}
V_{\text {out }} & =I_{\text {ro }} r_{O}-\frac{V_{\text {out }}}{R_{D}} R_{S}  \tag{3.75}\\
& =-\frac{V_{\text {out }}}{R_{D}} r_{O}-\left[g_{m}\left(V_{\text {in }}+V_{\text {out }} \frac{R_{S}}{R_{D}}\right)+g_{m b} V_{\text {out }} \frac{R_{S}}{R_{D}}\right] r_{O}-V_{\text {out }} \frac{R_{S}}{R_{D}} \tag{3.76}
\end{align*}
$$

It follows that

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{-g_{m} r_{O} R_{D}}{R_{D}+R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}} \tag{3.77}
\end{equation*}
$$

To gain more insight into this result, we recognize that the last three terms in the denominator, namely, $R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}$, represent the output resistance of a MOS device degenerated by a resistor $R_{S}$, as originally derived in (3.66). Let us now rewrite (3.77) as

$$
\begin{align*}
A_{v} & =\frac{-g_{m} r_{O} R_{D}\left[R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}\right]}{R_{D}+R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}} \cdot \frac{1}{R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}}  \tag{3.78}\\
& =-\frac{g_{m} r_{O}}{R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}} \cdot \frac{R_{D}\left[R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}\right]}{R_{D}+R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}} \tag{3.79}
\end{align*}
$$

The two fractions in (3.79) represent two important parameters of the circuit: the first is identical to that in (3.61), i.e., the equivalent transconductance of a degenerated MOSFET; and the second denotes the parallel combination of $R_{D}$ and $R_{S}+r_{O}+\left(g_{m}+g_{m b}\right) R_{S} r_{O}$, i.e., the overall output resistance of the circuit.

The above discussion suggests that in some circuits, it may be easier to calculate the voltage gain by exploiting the following lemma. We recall that the output port of a linear circuit can be represented by a Norton equivalent [Fig. 3.32(a)].

Lemma In a linear circuit, the voltage gain is equal to $-G_{m} R_{\text {out }}$, where $G_{m}$ denotes the transconductance of the circuit when the output is shorted to ground [Fig. 3.32(b)] and $R_{\text {out }}$ represents the output resistance of the circuit when the input voltage is set to zero [Fig. 3.32(c)].
image_name:(a)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: Vout, type: VoltageSource, value: Vout, ports: {Np: Vout, Nn: GND}
name: Rout, type: Resistor, value: Rout, ports: {N1: Vout, N2: GND}
name: Iout, type: CurrentSource, value: Iout, ports: {Np: GND, Nn: Vout}
]
extrainfo:The circuit diagram (a) represents a Norton equivalent of a linear circuit. The voltage gain is calculated as -Gm * Rout, where Gm is the transconductance and Rout is the output resistance. The diagram includes a voltage source Vin, a current source Iout, and a resistor Rout connected at the output.
image_name:(b)
description:
[
name: Vin, type: VoltageSource, ports: {Np: Vin, Nn: GND}
name: Iout, type: CurrentSource, ports: {Np: GND, Nn: Vout}
name: Rout, type: Resistor, value: Rout, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit diagram (b) represents the calculation of transconductance Gm by shorting the output to ground and measuring the short-circuit current Iout. The output voltage Vout is across the resistor Rout.
image_name:(c)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: Rout, type: Resistor, value: Rout, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit diagram (c) is used for calculating the output resistance (Rout) of the circuit by setting the input voltage to zero and observing the resistance at the output.

Figure 3.32 (a) Norton equivalent of a linear circuit; (b) $G_{m}$ calculation; and (c) $R_{\text {out }}$ calculation.

The lemma can be proved by noting that the output voltage in Fig. 3.32(a) is equal to $-I_{\text {out }} R_{\text {out }}$, and $I_{\text {out }}$ can be obtained by measuring the short-circuit current at the output. Defining $G_{m}=I_{\text {out }} / V_{\text {in }}$, we have $V_{\text {out }}=-G_{m} V_{\text {in }} R_{\text {out }}$. This lemma proves useful if $G_{m}$ and $R_{\text {out }}$ can be determined by inspection. Note the direction of $I_{\text {out }}$.

#### Example 3.11

Calculate the voltage gain of the circuit shown in Fig. 3.33. Assume that $I_{0}$ is ideal.
image_name:Figure 3.33
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: Io, type: CurrentSource, value: Io, ports: {Np: VDD, Nn: Vout}
name: Rs, type: Resistor, value: Rs, ports: {N1: GND, N2: Vin}
]
extrainfo:The circuit is an NMOS amplifier with a current source Io connected between VDD and the drain of the NMOS (M1). A resistor Rs is connected between the source of M1 and ground. The input voltage Vin is applied to the gate of M1, and the output voltage Vout is taken from the drain of M1.

Figure 3.33

#### Solution

The transconductance and output resistance of the stage are given by Eqs. (3.61) and (3.66), respectively. Thus,

$$
\begin{align*}
A_{v} & =-\frac{g_{m} r_{O}}{R_{S}+\left[1+\left(g_{m}+g_{m b}\right) R_{S}\right] r_{O}}\left\{\left[1+\left(g_{m}+g_{m b}\right) r_{O}\right] R_{S}+r_{O}\right\}  \tag{3.80}\\
& =-g_{m} r_{O} \tag{3.81}
\end{align*}
$$

Interestingly, the voltage gain is equal to the intrinsic gain of the transistor and independent of $R_{S}$. This is because, if $I_{0}$ is ideal, the current through $R_{S}$ cannot change, and hence the small-signal voltage drop across $R_{S}$ is zero-as if $R_{S}$ were zero itself.

## 3.4 ■ Source Follower

Our analysis of the common-source stage indicates that, to achieve a high voltage gain with limited supply voltage, the load impedance must be as large as possible. If such a stage is to drive a low-impedance load, then a "buffer" must be placed after the amplifier so as to drive the load with negligible reduction in gain. The source follower (also called the "common-drain" stage) can operate as a voltage buffer.
image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: Vout, D: VDD, G: Vin}
name: RS, type: Resistor, value: RS, ports: {N1: Vout, N2: GND}
]
extrainfo:The source follower circuit in Figure 3.34(a) uses an NMOS transistor M1 to buffer the input voltage Vin to the output Vout. The resistor RS is connected between Vout and ground, providing a path for the output current. The circuit acts as a voltage buffer, presenting high input impedance at the gate of M1 and driving the load at the source.
image_name:(b)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1, G: Vin}
name: RS, type: Resistor, value: RS, ports: {N1: Vout, N2: GND}
name: M2, type: NMOS, ports: {S: Vout, D: VDD, G: d1}
]
extrainfo:The circuit diagram (b) shows a gain stage followed by a buffer. M1 acts as the gain stage, while M2 serves as the buffer to drive low resistance loads without degrading the voltage gain. The source follower configuration allows the output voltage to closely follow the input voltage.
image_name:(c)
description:The graph in Figure 3.34(c) is a plot depicting the input-output characteristic of a source follower circuit, specifically showing how the output voltage \( V_{out} \) relates to the input voltage \( V_{in} \).

1. **Type of Graph and Function:**
- This is a linear plot showing the relationship between input and output voltages in a source follower circuit.

2. **Axes Labels and Units:**
- The x-axis represents the input voltage \( V_{in} \), while the y-axis represents the output voltage \( V_{out} \).
- Both axes are likely measured in volts (V), although specific units are not marked on the graph.

3. **Overall Behavior and Trends:**
- The graph shows a linear region where \( V_{out} \) closely follows \( V_{in} \) but is offset by a threshold voltage \( V_{TH} \).
- Initially, as \( V_{in} \) increases from zero, \( V_{out} \) remains at zero until \( V_{in} \) reaches the threshold voltage \( V_{TH} \).
- Beyond \( V_{TH} \), \( V_{out} \) increases linearly with \( V_{in} \), maintaining a constant voltage difference \( V_{GS} \) between the two.

4. **Key Features and Technical Details:**
- The threshold voltage \( V_{TH} \) is a critical point on the x-axis where the output begins to follow the input.
- The linear region indicates the operational range of the source follower where it acts as a buffer, providing a near-unity gain (\( V_{out} = V_{in} - V_{GS} \)).
- The dashed line represents the ideal case where \( V_{out} = V_{in} \), showing the deviation due to \( V_{GS} \).

5. **Annotations and Specific Data Points:**
- The graph includes annotations for \( V_{TH} \) and \( V_{GS} \), indicating the threshold voltage and gate-source voltage, respectively.
- The slope of the linear portion of the graph is slightly less than 1, illustrating the voltage drop across the device.

This graph effectively illustrates the behavior of the source follower as a voltage buffer, highlighting its ability to drive loads while maintaining input-output linearity above a certain threshold voltage.

Figure 3.34 (a) Source follower, (b) example of its role as a buffer, and (c) its input-output characteristic.

Illustrated in Fig. 3.34(a), the source follower senses the signal at the gate, while presenting a high input impedance, and drives the load at the source, allowing the source potential to "follow" the gate voltage. Figure 3.34(b) depicts how the circuit can be used to drive a low resistance without degrading the voltage gain of a CS stage. Beginning with the large-signal behavior of the source follower, we note that for $V_{\text {in }}<V_{T H}, M_{1}$ is off and $V_{\text {out }}=0$. As $V_{\text {in }}$ exceeds $V_{T H}, M_{1}$ turns on in saturation (why?) and $I_{D 1}$ flows through $R_{S}$ [Fig. 3.34(c)]. As $V_{i n}$ increases further, $V_{o u t}$ follows the input with a difference (level shift) equal to $V_{G S}$. We can express the input-output characteristic as

$$
\begin{equation*}
\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right)^{2} R_{S}=V_{\text {out }} \tag{3.82}
\end{equation*}
$$

where channel-length modulation is neglected. Let us calculate the small-signal gain of the circuit by differentiating both sides of (3.82) with respect to $V_{i n}$ :

$$
\begin{equation*}
\frac{1}{2} \mu_{n} C_{\text {ox }} \frac{W}{L} 2\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right)\left(1-\frac{\partial V_{T H}}{\partial V_{\text {in }}}-\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}\right) R_{S}=\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}} \tag{3.83}
\end{equation*}
$$

Since $\partial V_{T H} / \partial V_{\text {in }}=\left(\partial V_{T H} / \partial V_{S B}\right)\left(\partial V_{S B} / \partial V_{\text {in }}\right)=\eta \partial V_{\text {out }} / \partial V_{\text {in }}$,

$$
\begin{equation*}
\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}=\frac{\mu_{n} C_{\text {ox }} \frac{W}{L}\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right) R_{S}}{1+\mu_{n} C_{\text {ox }} \frac{W}{L}\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right) R_{S}(1+\eta)} \tag{3.84}
\end{equation*}
$$

Also, note that

$$
\begin{equation*}
g_{m}=\mu_{n} C_{o x} \frac{W}{L}\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right) \tag{3.85}
\end{equation*}
$$

Consequently,

$$
\begin{equation*}
A_{v}=\frac{g_{m} R_{S}}{1+\left(g_{m}+g_{m b}\right) R_{S}} \tag{3.86}
\end{equation*}
$$

The same result is more easily obtained with the aid of a small-signal equivalent circuit. From Fig. 3.35, we have $V_{\text {in }}-V_{1}=V_{\text {out }}, V_{\text {bs }}=-V_{\text {out }}$, and $g_{m} V_{1}-g_{m b} V_{\text {out }}=V_{\text {out }} / R_{S}$. Thus, $V_{\text {out }} / V_{\text {in }}=g_{m} R_{S} /[1+$ $\left.\left(g_{m}+g_{m b}\right) R_{S}\right]$.
image_name:Figure 3.35
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: V1, type: VoltageSource, value: V1, ports: {Np: Vout, Nn: Vin}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: Vout, Nn: GND}
name: gmbVbs, type: VoltageControlledCurrentSource, ports: {Np: Vout, Nn: GND}
name: RS, type: Resistor, value: RS, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit diagram represents a small-signal equivalent circuit of a source follower. It includes a voltage source Vin, a resistor RS connected to ground, and two voltage-controlled current sources, gmV1 and gmbVbs, both connected to Vout and ground.

Figure 3.35 Small-signal equivalent circuit of source follower.

Sketched in Fig. 3.36 vs. $V_{i n}$, the voltage gain begins from zero for $V_{i n} \approx V_{T H}$ (that is, $g_{m} \approx 0$ ) and monotonically increases. As the drain current and $g_{m}$ increase, $A_{v}$ approaches $g_{m} /\left(g_{m}+g_{m b}\right)=1 /(1+\eta)$. Since $\eta$ itself slowly decreases with $V_{\text {out }}, A_{v}$ would eventually become equal to unity, but for typical allowable source-bulk voltages, $\eta$ remains greater than roughly 0.2 .
image_name:Figure 3.36 Voltage gain of source follower versus input voltage
description:The graph depicted is a plot of the voltage gain \( A_v \) of a source follower versus the input voltage \( V_{in} \). It is a typical linear plot with \( A_v \) on the vertical axis and \( V_{in} \) on the horizontal axis. The voltage gain \( A_v \) is dimensionless, while the input voltage \( V_{in} \) is measured in volts, although specific units are not marked on the axes.

Overall Behavior and Trends:
The graph shows a curve that starts at the threshold voltage \( V_{TH} \) on the \( V_{in} \) axis. At this point, the voltage gain \( A_v \) begins from zero. As \( V_{in} \) increases, the voltage gain \( A_v \) rises monotonically. The curve approaches an asymptotic value given by the expression \( \frac{1}{1+\eta} \), where \( \eta \) is a parameter that decreases slowly with increasing \( V_{out} \).

Key Features and Technical Details:
- The curve starts at \( V_{TH} \) on the horizontal axis, indicating the threshold voltage where the gain begins to rise.
- The gain \( A_v \) approaches a maximum value of \( \frac{1}{1+\eta} \) as \( V_{in} \) increases, but does not reach unity due to the presence of \( \eta \).
- The graph suggests that for typical source-bulk voltages, \( \eta \) remains greater than approximately 0.2, preventing \( A_v \) from reaching 1.
- A dotted line is shown at \( A_v = 1.0 \) to indicate the unity gain level, which is not achieved.

Annotations and Specific Data Points:
- The threshold voltage \( V_{TH} \) is a critical value where the gain begins to increase.
- The asymptotic gain value of \( \frac{1}{1+\eta} \) is marked on the graph, representing the maximum gain achieved as \( V_{in} \) becomes large.
- The graph does not show any peaks, valleys, or inflection points, as it is a smooth monotonic increase towards the asymptotic value.

Figure 3.36 Voltage gain of source follower versus input voltage.

An important result of (3.86) is that even if $R_{S}=\infty$, the voltage gain of a source follower is not equal to one (unless body effect is removed as explained later). We return to this point later. Note that $M_{1}$ in Fig. 3.34(a) remains in saturation if $V_{i n}$ does not exceed $V_{D D}+V_{T H}$.

In the source follower of Fig. 3.34(a), the drain current of $M_{1}$ heavily depends on the input dc level. For example, if $V_{i n}$ changes from 0.7 V to $1 \mathrm{~V}, I_{D}$ may increase by a factor of 2 , and hence $V_{G S}-V_{T H}$ by $\sqrt{2}$. Even if $V_{T H}$ is relatively constant, the increase in $V_{G S}$ means that $V_{\text {out }}\left(=V_{i n}-V_{G S}\right)$ does not follow $V_{i n}$ faithfully, thereby incurring nonlinearity. To alleviate this issue, the resistor can be replaced by a constant current source as shown in Fig. 3.37(a). The current source itself is implemented as an NMOS transistor operating in the saturation region [Fig. 3.37(b)].
image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: Vout, D: VDD, G: Vin}
name: I1, type: CurrentSource, value: I1, ports: {Np: Vout, Nn: GND}
]
extrainfo:The circuit in diagram (a) is a source follower with an NMOS transistor M1 and a current source I1. The input voltage Vin is applied to the gate of M1, and the output voltage Vout is taken from the source of M1. The current source I1 is connected between Vout and ground, providing a constant current to the circuit.
image_name:(b)
description:
[
name: M1, type: NMOS, ports: {S: Vout, D: VDD, G: Vin}
name: I1, type: CurrentSource, value: I1, ports: {Np: Vout, Nn: GND}
name: M2, type: NMOS, ports: {S: GND, D: Vout, G: Vb}
]
extrainfo:The circuit is a source follower configuration using an NMOS transistor M1 with a current source I1 replaced by another NMOS transistor M2 as a current source. M1 is used for voltage buffering, and M2 provides a constant current bias.

Figure 3.37 Source follower using (a) an ideal current source, and (b) an NMOS transistor as a current source.

Example 3.12
Suppose that in the source follower of Fig. 3.37(a), $(W / L)_{1}=20 / 0.5, I_{1}=200 \mu \mathrm{~A}, V_{T H 0}=0.6 \mathrm{~V}, 2 \Phi_{F}=0.7 \mathrm{~V}$, $V_{D D}=1.2 \mathrm{~V}, \mu_{n} C_{o x}=50 \mu \mathrm{~A} / \mathrm{V}^{2}$, and $\gamma=0.4 \mathrm{~V}^{1 / 2}$.
(a) Calculate $V_{\text {out }}$ for $V_{\text {in }}=1.2 \mathrm{~V}$.
(b) If $I_{1}$ is implemented as $M_{2}$ in Fig. 3.37 (b), find the minimum value of $(W / L)_{2}$ for which $M_{2}$ remains saturated when $V_{i n}=1.2 \mathrm{~V}$.

#### Solution

(a) Since the threshold voltage of $M_{1}$ depends on $V_{\text {out }}$, we perform a simple iteration. Noting that

$$
\begin{equation*}
\left(V_{\text {in }}-V_{T H}-V_{\text {out }}\right)^{2}=\frac{2 I_{D}}{\mu_{n} C_{o x}\left(\frac{W}{L}\right)_{1}} \tag{3.87}
\end{equation*}
$$

we first assume that $V_{T H} \approx 0.6 \mathrm{~V}$, obtaining $V_{\text {out }}=0.153 \mathrm{~V}$. Now we calculate a new $V_{T H}$ as

$$
\begin{align*}
V_{T H} & =V_{T H 0}+\gamma\left(\sqrt{2 \Phi_{F}+V_{S B}}-\sqrt{2 \Phi_{F}}\right)  \tag{3.88}\\
& =0.635 \mathrm{~V} \tag{3.89}
\end{align*}
$$

This indicates that $V_{\text {out }}$ is approximately 35 mV less than that calculated above, i.e., $V_{\text {out }} \approx 0.118 \mathrm{~V}$.
(b) Since the drain-source voltage of $M_{2}$ is equal to 0.118 V , the device is saturated only if $\left(V_{G S}-V_{T H}\right)_{2} \leq 0.118 \mathrm{~V}$. With $I_{D}=200 \mu \mathrm{~A}$, this gives $(W / L)_{2} \geq 287 / 0.5$. Note the substantial drain junction and overlap capacitance contributed by $M_{2}$ to the output node.

#### Example 3.13

Explain intuitively why the gain of the source follower in Fig. 3.37(a) is equal to unity if $I_{1}$ is ideal and $\lambda=\gamma=0$.

#### Solution

In this case, the drain current of $M_{1}$ remains exactly constant, and so does $V_{G S 1}$. Since $V_{\text {out }}=V_{\text {in }}-V_{G S 1}$, we observe that a change in $V_{\text {in }}$ must equally appear in $V_{\text {out }}$. Alternatively, as shown in Fig. 3.38, we can say that the small-signal drain current cannot flow through any path and must be zero, yielding $V_{1}=0$ and $V_{\text {out }}=V_{\text {in }}$.
image_name:Fig. 3.38
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: GND, Nn: Vout}
]
extrainfo:The circuit is a basic voltage follower with a voltage-controlled current source gmV1 connected between Vout and ground. Vin is the input voltage source connected to Vout.

To gain a better understanding of source followers, let us calculate the small-signal output resistance of the circuit in Fig. 3.39(a). Using the equivalent circuit of Fig. 3.39(b) and noting that $V_{X}=-V_{b s}$, we write

$$
\begin{equation*}
I_{X}-g_{m} V_{X}-g_{m b} V_{X}=0 \tag{3.90}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
R_{o u t}=\frac{1}{g_{m}+g_{m b}} \tag{3.91}
\end{equation*}
$$

image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: S1, D: VDD, G: ac(GND)}
name: I1, type: CurrentSource, value: I1, ports: {Np: S1, Nn: GND}
]
extrainfo:The circuit is a source follower configuration with NMOS M1, where the output is taken across Rout. The input is an AC signal connected to the gate of M1. The current source I1 is connected to the source of M1, providing biasing.
image_name:(b)
description:The circuit represents a small-signal model for calculating the output impedance of a source follower. The NMOS transistor M1 is connected with its source at Vx, drain at GND, and gate at V1. The current source Ix and voltage source Vx are used for small-signal analysis.
image_name:(c)
description:The circuit is a source follower with an NMOS transistor M1. The output resistance is calculated considering the body effect, which decreases the output resistance.
Figure 3.39 Calculation of the output impedance of a source follower.

This result should not come as a surprise: the circuit in Fig. 3.39(b) is similar to that in Fig. 3.11(b). Interestingly, body effect decreases the output resistance of source followers. To understand why, suppose that in Fig. 3.39(c), $V_{X}$ decreases by $\Delta V$ so that the drain current increases. With no body effect, only the gate-source voltage of $M_{1}$ would increase by $\Delta V$. With body effect, on the other hand, the threshold voltage of the device decreases as well. Thus, in $\left(V_{G S}-V_{T H}\right)^{2}$, the first term increases and the second decreases, resulting in a greater change in the drain current and hence a lower output impedance.

The above phenomenon can also be studied with the aid of the small-signal model shown in Fig. 3.40(a). It is important to note that the magnitude of the current source $g_{m b} V_{b s}=g_{m b} V_{X}$ is linearly proportional to the voltage across it (because the current source and the voltage source are in parallel). Such a behavior is that of a simple resistor equal to $1 / g_{m b}$, yielding the small-signal model shown in Fig. 3.40(b). The equivalent resistor simply appears in parallel with the output, thereby lowering the overall output resistance. Since without $1 / g_{m b}$, the output resistance equals $1 / g_{m}$, we conclude that

$$
\begin{align*}
R_{\text {out }} & =\frac{1}{g_{m}} \| \frac{1}{g_{m b}}  \tag{3.92}\\
& =\frac{1}{g_{m}+g_{m b}} \tag{3.93}
\end{align*}
$$

Modeling the effect of $g_{m b}$ by a resistor—which is valid only for source followers-also helps explain the less-than-unity voltage gain implied by (3.86) for $R_{S}=\infty$. As shown in the Thevenin equivalent
image_name:Figure 3.40(a)
description:
[
name: Vx, type: VoltageSource, value: Vx, ports: {Np: Vx, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: GND, Nn: Vx}
name: gmbVx, type: VoltageControlledCurrentSource, value: gmbVx, ports: {Np: Vx, Nn: GND}
]
extrainfo:The circuit in Figure 3.40 illustrates a source follower including the body effect. It shows the use of voltage-controlled current sources to model the transconductance and body effect, and a resistor representing the reciprocal of the body transconductance. The voltage sources V1 and Vx, along with the current source Ix, provide the necessary biasing and input signals.
image_name:Figure 3.49(b)
description:
[
name: Vx, type: VoltageSource, value: Vx, ports: {Np: GND, Nn: Vx}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: GND, Nn: Vx}
name: 1/gmb, type: Resistor, value: 1/gmb, ports: {N1: Vx, N2: GND}
]
extrainfo:The circuit in Figure 3.41 represents a source follower including the body effect, modeled using a Thevenin equivalent. It includes a voltage source V1, a voltage source Vx, two voltage-controlled current sources gmV1 and gmbVx, a current source Ix, and a resistor with value 1/gmb. The circuit demonstrates the effects of body effect on the source follower's voltage gain.
Figure 3.40 Source follower including body effect.

image_name:Figure 3.41
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: GND, Nn: Vout}
name: 1/gmb, type: Resistor, value: 1/gmb, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit in Figure 3.40 represents a source follower including the body effect, modeled using a Thevenin equivalent. It includes a voltage source Vin, a voltage source V1, a voltage-controlled current source gmV1, and resistors with values 1/gm and 1/gmb. The circuit demonstrates the effects of body effect on the source follower's voltage gain.
Figure 3.41 Representation of intrinsic source follower by a Thevenin equivalent.
of Fig. 3.41,

$$
\begin{align*}
A_{v} & =\frac{\frac{1}{g_{m b}}}{\frac{1}{g_{m}}+\frac{1}{g_{m b}}}  \tag{3.94}\\
& =\frac{g_{m}}{g_{m}+g_{m b}} \tag{3.95}
\end{align*}
$$

For completeness, we also study a source follower with a finite load resistance and channel-length modulation [Fig. 3.42(a)]. Noting that $1 / g_{m b}, r_{O 1}, r_{O 2}$, and $R_{L}$ are in parallel, we can reduce the circuit to that shown in Fig. 3.42(c), where $R_{e q}=\left(1 / g_{m b}\right)\left\|r_{O 1}\right\| r_{O 2} \| R_{L}$. It follows that

$$
\begin{equation*}
A_{v}=\frac{R_{e q}}{R_{e q}+\frac{1}{g_{m}}} \tag{3.96}
\end{equation*}
$$

image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: Vout, D: VDD, G: Vin}
name: M2, type: NMOS, ports: {S: GND, D: Vout, G: Vb}
name: RL, type: Resistor, value: RL, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit is a source follower with two NMOS transistors, M1 and M2, and a load resistor RL. M1 is connected to the input voltage Vin, and M2 is controlled by a bias voltage Vb. The output voltage Vout is taken across the load resistor RL.

image_name:(b)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: 1/gmb, type: Resistor, value: 1/gmb, ports: {N1: Vout, N2: GND}
name: gmV1, type: VoltageControlCurrentSource, value: gmV1, ports: {Np: Vout, Nn: Vout}
name: ro1, type: Resistor, value: ro1, ports: {N1: Vout, N2: GND}
name: ro2, type: Resistor, value: ro2, ports: {N1: Vout, N2: GND}
name: RL, type: Resistor, value: RL, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit diagram represents a small-signal equivalent model with multiple resistors and a current source connected to the output node Vout. The input is driven by a voltage source Vin.

image_name:(c)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: Req, type: Resistor, value: Req, ports: {N1: Vout, N2: GND}
name: gmV1, type: VoltageControlledCurrentSource, ports: {Np: GND, Nn: Vout}
]
extrainfo:The circuit is a small-signal equivalent model with a voltage source Vin driving the input. The output node Vout is connected to a resistor Req and a voltage-controlled current source gmV1. The current source is controlled by the voltage at V1.

Figure 3.42 (a) Source follower driving load resistance; (b) small-signal equivalent circuit; (c) simplified model.

#### Example 3.14

Calculate the voltage gain of the circuit shown in Fig. 3.43.

#### Solution

The impedance seen looking into the source of $M_{2}$ (a diode-connected device) is equal to $\left[1 /\left(g_{m 2}+g_{m b 2}\right)\right] \| r_{O 2}$. The impedance appears in parallel with $1 / g_{m b 1}$ and $r_{O 1}$. Thus,

$$
\begin{equation*}
A_{v}=\frac{\frac{1}{g_{m 2}+g_{m b 2}}\left\|r_{O 2}\right\| r_{O 1} \| \frac{1}{g_{m b 1}}}{\frac{1}{g_{m 2}+g_{m b 2}}\left\|r_{O 2}\right\| r_{O 1} \| \frac{1}{g_{m b 1}}+\frac{1}{g_{m 1}}} \tag{3.97}
\end{equation*}
$$

image_name:Figure 3.43
description:
[
name: M1, type: NMOS, ports: {S: Vout, D: VDD, G: Vin}
name: M2, type: PMOS, ports: {S: Vout, D: GND, G: GND}
]
extrainfo:The circuit is a source follower configuration with an NMOS transistor M1 and a PMOS transistor M2. M1 is driven by the input voltage Vin, and M2 is diode-connected, providing feedback to stabilize the output voltage Vout. The circuit provides high input impedance and moderate output impedance.

Source followers exhibit a high input impedance and a moderate output impedance, but at the cost of two drawbacks: nonlinearity and voltage headroom limitation. We consider these issues in detail.

As mentioned in relation to Fig. 3.34(a), even if a source follower is biased by an ideal current source, its input-output characteristic displays some nonlinearity due to the nonlinear dependence of $V_{T H}$ upon the source potential. In submicron technologies, $r_{O}$ of the transistor also changes substantially with $V_{D S}$, thus introducing additional variation in the small-signal gain of the circuit (Chapter 14). For this reason, typical source followers suffer from significant nonlinearity.

The nonlinearity due to body effect can be eliminated if the bulk is tied to the source. This is usually possible only for PFETs because all NFETs share the same substrate. Figure 3.44 shows a PMOS source follower employing two separate $n$-wells so as to eliminate the body effect of $M_{1}$. The lower mobility of PFETs, however, yields a higher output impedance in this case than that available in an NMOS counterpart.
image_name:(a)
description:
[
name: M1, type: PMOS, ports: {S: Vout, D: GND, G: Vin, B: GND}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vb, B: VDD}
]
extrainfo:This circuit is a PMOS source follower designed to eliminate the body effect by using separate n-wells for M1 and M2. The layout in (b) shows the n-well contacts and connections for Vb, Vin, Vout, and GND.
image_name:(b)
description:The image labeled (b) is a layout diagram of a PMOS source follower circuit designed to eliminate the body effect by using two separate n-wells. This layout is part of a schematic representation, showing how the components are physically realized on a silicon chip.

1. **Identification of Components and Structure:**
- The layout consists of two transistors, as indicated by the two separate n-wells.
- Each n-well is associated with a PMOS transistor, labeled as having connections for the source, gate, and drain.
- The n-wells are specifically designed to isolate the body of each PMOS transistor from the substrate, thereby eliminating the body effect.

2. **Connections and Interactions:**
- The diagram shows connections for the input voltage \( V_{in} \), bias voltage \( V_{b} \), output voltage \( V_{out} \), and the power supply \( V_{DD} \).
- The layout indicates that \( V_{in} \) is connected to the gate of the first PMOS transistor, and \( V_{b} \) is connected to the gate of the second PMOS transistor.
- The output \( V_{out} \) is taken from the drain of the second PMOS transistor.
- The n-well contacts are shown, which connect the n-wells to the appropriate voltages, ensuring that each transistor's body is tied to its source.

3. **Labels, Annotations, and Key Features:**
- The diagram includes labels for each voltage connection, such as \( V_{DD} \), \( V_{b} \), \( V_{in} \), and \( V_{out} \).
- "n-well Contacts" are annotated to show where the n-wells are connected to ensure proper functioning and elimination of the body effect.
- The ground (GND) connection is clearly marked, indicating the reference potential for the circuit.

This layout is a critical part of ensuring that the PMOS source follower operates without the nonlinearity introduced by the body effect, optimizing the circuit's performance.

Figure 3.44 (a) PMOS source follower with no body effect; (b) corresponding layout showing separate $n$-wells.
Source followers also shift the dc level of the signal by $V_{G S}$, thereby consuming voltage headroom and limiting the voltage swings. To understand this point, consider the example illustrated in Fig. 3.45, a cascade of a common-source stage and a source follower. Without the source follower, the minimum allowable value of $V_{X}$ would be equal to $V_{G S 1}-V_{T H 1}$ (for $M_{1}$ to remain in saturation). With the source follower, on the other hand, $V_{X}$ must be greater than $V_{G S 2}+\left(V_{G S 3}-V_{T H 3}\right)$ so that $M_{3}$ is saturated. For comparable overdrive voltages in $M_{1}$ and $M_{3}$, this means the allowable swing at $X$ is reduced by $V_{G S 2}$, a substantial amount.

It is also instructive to compare the gain of source followers and common-source stages when the load impedance is relatively low. A practical example is the need to drive an external $50-\Omega$ termination in a
image_name:Figure 3.45
description:
[
name: M1, type: NMOS, ports: {S: GND, D: X, G: Vin}
name: M2, type: NMOS, ports: {S: Vout, D: VDD, G: X}
name: M3, type: NMOS, ports: {S: GND, D: Vout, G: Vb}
name: ID, type: CurrentSource, value: ID, ports: {Np: VDD, Nn: X}
]
extrainfo:The circuit in Figure 3.45 is a cascade of a source follower and a common-source stage. It involves three NMOS transistors and a current source. The node X is an intermediate node connecting the source of M2 and the drain of M1. The output is taken from the drain of M2 and the drain of M3, labeled as Vout. The circuit is powered by VDD.

image_name:Figure 3.46(a)
description:
[
name: M1, type: NMOS, ports: {S: Vout, D: VDD, G: Vin}
name: RL, type: Resistor, value: RL, ports: {N1: Vout, N2: Vout}
name: I1, type: CurrentSource, ports: {Np: Vout, Nn: GND}
]
extrainfo:The circuit diagram (a) is a source follower configuration used to drive a load resistor RL. It includes an NMOS transistor M1, a load resistor RL, and a current source I1. The output voltage Vout is taken across the load resistor RL.
image_name:Figure 3.46(b)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: Vout, G: Vin}
name: RL, type: Resistor, value: RL, ports: {N1: VDD, N2: Vout}
]
extrainfo:The circuit is a common-source stage with an NMOS transistor (M1) driving a load resistor (RL). The input is applied to the gate of M1, and the output is taken from the drain of M1. The source of M1 is grounded.

Figure 3.46 (a) Source follower and (b) CS stage driving a load resistance.
high-frequency environment. As shown in Fig. 3.46(a), the load can be driven by a source follower with an overall voltage gain of

$$
\begin{align*}
\left.\frac{V_{\text {out }}}{V_{\text {in }}}\right|_{S F} & \approx \frac{R_{L}}{R_{L}+1 / g_{m 1}}  \tag{3.98}\\
& \approx \frac{g_{m 1} R_{L}}{1+g_{m 1} R_{L}} \tag{3.99}
\end{align*}
$$

On the other hand, as depicted in Fig. 3.46(b), the load can be included as part of a common-source stage, providing a gain of

$$
\begin{equation*}
\left.\frac{V_{\text {out }}}{V_{\text {in }}}\right|_{C S} \approx-g_{m 1} R_{L} \tag{3.100}
\end{equation*}
$$

The key difference between these two topologies is the achievable voltage gain for a given bias current. For example, if $1 / g_{m 1} \approx R_{L}$, then the source follower exhibits a gain of at most 0.5 , whereas the commonsource stage provides a gain close to unity. Thus, source followers are not necessarily efficient drivers.

The drawbacks of source followers, namely, nonlinearity due to body effect and voltage headroom consumption due to level shift, limit the use of this topology. As a general rule, we avoid the use of source followers unless they become absolutely necessary. One application of source followers is in performing voltage-level shift, as illustrated by the following example.

#### Example 3.15

(a) In the circuit of Fig. 3.47(a), calculate the voltage gain if $C_{1}$ acts as an ac short at the frequency of interest. What is the maximum dc level of the input signal for which $M_{1}$ remains saturated?
(b) To accommodate an input dc level close to $V_{D D}$, the circuit is modified as shown in Fig. 3.47(b). What relationship between the gate-source voltages of $M_{2}$ and $M_{3}$ guarantees that $M_{1}$ is saturated?
image_name:Fig. 3.47(a)
description:
[
name: M1, type: NMOS, ports: {S: S1, D: Vout, G: Vin}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vout}
name: I1, type: CurrentSource, value: I1, ports: {Np: S1, Nn: GND}
name: C1, type: Capacitor, value: C1, ports: {Np: S1, Nn: GND}
]
extrainfo:The circuit in Fig. 3.47(a) is a basic amplifier configuration with an NMOS transistor (M1) and a PMOS transistor (M2). The input voltage (Vin) is applied to the gate of M1, and the output voltage (Vout) is taken from the drain of M1. The PMOS transistor M2 acts as a load for the NMOS transistor M1. The current source I1 provides biasing for the NMOS transistor. Capacitor C1 is used for AC coupling, ensuring that the AC signal is transferred without affecting the DC biasing.
image_name:Fig. 3.47(b)
description:
[
name: M1, type: NMOS, ports: {S: S1, D: Vout, G: X}
name: M2, type: PMOS, ports: {S: VDD, D: Vout, G: Vout}
name: I1, type: CurrentSource, value: I1, ports: {Np: S1, Nn: GND}
name: C1, type: Capacitor, value: C1, ports: {Np: S1, Nn: GND}
name: M3, type: NMOS, ports: {S: X, D: VDD, G: Vin}
name: I2, type: CurrentSource, value: I2, ports: {Np: X, Nn: GND}
]
extrainfo:The circuit in Fig. 3.47(b) is a modified version to accommodate an input DC level close to VDD. It includes NMOS transistors M1 and M3, PMOS transistor M2, current sources I1 and I2, and a capacitor C1. The configuration ensures M1 remains in saturation by controlling the gate-source voltages of M2 and M3.

#### Solution

(a) Noting that the source of $M_{1}$ is at ac ground, we write the gain as

$$
\begin{equation*}
A_{v}=-g_{m 1}\left[r_{O 1}\left\|r_{O 2}\right\|\left(1 / g_{m 2}\right)\right] \tag{3.101}
\end{equation*}
$$

Since $V_{\text {out }}=V_{D D}-\left|V_{G S 2}\right|$, the maximum allowable dc level of $V_{\text {in }}$ is equal to $V_{D D}-\left|V_{G S 2}\right|+V_{T H 1}$.
(b) If $V_{i n}=V_{D D}$, then $V_{X}=V_{D D}-V_{G S 3}$. For $M_{1}$ to be saturated when $V_{i n}=V_{D D}$, we must have $V_{D D}-$ $V_{G S 3}-V_{T H 1} \leq V_{D D}-\left|V_{G S 2}\right|$, and hence $V_{G S 3}+V_{T H 1} \geq\left|V_{G S 2}\right|$.

As explained in Chapter 7, source followers also introduce substantial noise. For this reason, the circuit of Fig. 3.47(b) is ill-suited to low-noise applications.

## 3.5 ■ Common-Gate Stage

In common-source amplifiers and source followers, the input signal is applied to the gate of a MOSFET. It is also possible to apply the signal to the source terminal. Shown in Fig. 3.48(a), a common-gate (CG) stage senses the input at the source and produces the output at the drain. The gate is connected to a dc voltage to establish proper operating conditions. Note that the bias current of $M_{1}$ flows through the input signal source. Alternatively, as depicted in Fig. 3.48(b), $M_{1}$ can be biased by a constant current source, with the signal capacitively coupled to the circuit.
image_name:Figure 3.48 (a)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: M1, type: NMOS, ports: {S: Vin, D: Vout, G: Vb}
]
extrainfo:The circuit is a common-gate (CG) stage with the input applied at the source and the output taken from the drain. The gate is connected to a bias voltage Vb. The resistor RD is connected between VDD and the output node Vout.

image_name:Figure 3.48 (b)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: M1, type: NMOS, ports: {S: S1, D: Vout, G: Vb}
name: I1, type: CurrentSource, value: I1, ports: {Np: S1, Nn: GND}
name: C1, type: Capacitor, value: C1, ports: {Np: Vin, Nn: S1}
]
extrainfo:The circuit is a common-gate (CG) stage with capacitive coupling at the input. The input is applied at the source of the NMOS transistor M1, and the output is taken from the drain. The gate is connected to a bias voltage Vb. The resistor RD is connected between VDD and the output node Vout, and a current source I1 is connected between the source and ground.

Figure 3.48 (a) Common-gate stage with direct coupling at input; (b) CG stage with capacitive coupling at input.

image_name:Figure 3.49 Common-gate input-output characteristic
description:The graph in Figure 3.49 is a plot of the input-output characteristic of a common-gate (CG) stage. It is a voltage transfer characteristic graph, displaying the relationship between the input voltage \( V_{in} \) on the x-axis and the output voltage \( V_{out} \) on the y-axis.

1. **Type of Graph and Function:**
- The graph is a voltage transfer characteristic curve for a common-gate amplifier.

2. **Axes Labels and Units:**
- The x-axis represents the input voltage \( V_{in} \), with critical points marked as \( V_b - V_{TH} \).
- The y-axis represents the output voltage \( V_{out} \), with the maximum value marked as \( V_{DD} \).

3. **Overall Behavior and Trends:**
- The graph shows a piecewise linear behavior with three distinct regions:
- **Triode Region:** For \( V_{in} < V_b - V_{TH} \), the transistor \( M_1 \) is in the triode region, and \( V_{out} \) decreases linearly with \( V_{in} \).
- **Saturation Region:** As \( V_{in} \) increases past \( V_b - V_{TH} \), \( M_1 \) enters saturation, and the slope of the curve decreases, indicating a slower rate of change in \( V_{out} \).
- **Cutoff Region:** For high \( V_{in} \), the transistor \( M_1 \) turns off, and \( V_{out} \) approaches \( V_{DD} \), becoming constant.

4. **Key Features and Technical Details:**
- The transition between regions is smooth, with no abrupt changes, indicating a gradual shift in operation modes.
- The graph highlights the threshold voltage \( V_b - V_{TH} \) as a critical point where the behavior of the transistor changes.

5. **Annotations and Specific Data Points:**
- The graph is annotated with the regions of operation: "\( M_1 \) in Triode Region," "\( M_1 \) in Saturation," and "\( M_1 \) off."
- The maximum output voltage \( V_{DD} \) is labeled, showing the saturation level of the output when the transistor is off.

Figure 3.49 Common-gate inputoutput characteristic.

We first study the large-signal behavior of the circuit in Fig. 3.48(a). For simplicity, let us assume that $V_{i n}$ decreases from a large positive value. Also, $\lambda=0$. For $V_{i n} \geq V_{b}-V_{T H}, M_{1}$ is off and $V_{\text {out }}=V_{D D}$. For lower values of $V_{i n}$, we can write

$$
\begin{equation*}
I_{D}=\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{b}-V_{i n}-V_{T H}\right)^{2} \tag{3.102}
\end{equation*}
$$

if $M_{1}$ is in saturation. As $V_{\text {in }}$ decreases, so does $V_{\text {out }}$, eventually driving $M_{1}$ into the triode region if

$$
\begin{equation*}
V_{D D}-\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{b}-V_{i n}-V_{T H}\right)^{2} R_{D}=V_{b}-V_{T H} \tag{3.103}
\end{equation*}
$$

The input-output characteristic is shown in Fig. 3.49, illustrating a case in which $M_{1}$ enters the triode region as $V_{i n}$ decreases. In the region where $M_{1}$ is saturated, we can express the output voltage as

$$
\begin{equation*}
V_{\text {out }}=V_{D D}-\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{b}-V_{\text {in }}-V_{T H}\right)^{2} R_{D} \tag{3.104}
\end{equation*}
$$

obtaining a small-signal gain of

$$
\begin{equation*}
\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}}=-\mu_{n} C_{\text {ox }} \frac{W}{L}\left(V_{b}-V_{\text {in }}-V_{T H}\right)\left(-1-\frac{\partial V_{T H}}{\partial V_{\text {in }}}\right) R_{D} \tag{3.105}
\end{equation*}
$$

Since $\partial V_{T H} / \partial V_{i n}=\partial V_{T H} / \partial V_{S B}=\eta$, we have

$$
\begin{align*}
\frac{\partial V_{\text {out }}}{\partial V_{\text {in }}} & =\mu_{n} C_{o x} \frac{W}{L} R_{D}\left(V_{b}-V_{\text {in }}-V_{T H}\right)(1+\eta)  \tag{3.106}\\
& =g_{m}(1+\eta) R_{D} \tag{3.107}
\end{align*}
$$

Note that the gain is positive. Interestingly, body effect increases the equivalent transconductance of the stage.

For a given bias current and supply voltage (i.e., a given power budget), how do we maximize the voltage gain of a CG stage? We can increase $g_{m}$ by widening the input device, eventually reaching subthreshold operation $\left[g_{m} \approx I_{D} /\left(\xi V_{T}\right)\right.$ (why?), and/or we can increase $R_{D}$ and, inevitably, the dc drop across it. We must bear in mind that the minimum allowable level of $V_{\text {out }}$ in Fig. 3.48(b) is equal to $V_{G S}-V_{T H}+V_{I 1}$, where $V_{I 1}$ denotes the minimum voltage required by $I_{1}$.

#### Example 3.16

(a) Is it possible for $M_{1}$ in Fig. 3.48(a) to remain in saturation for the entire range of $V_{i n}$ from 0 to $V_{D D}$ ?
(b) Is it possible for $M_{1}$ to remain in the triode region for the entire range of $V_{i n}$ from 0 to $V_{D D}$ ?

#### Solution

(a) Yes, it is possible. To so guarantee, we choose $V_{D D}-R_{D} I_{D}>V_{b}-V_{T H}$, where $I_{D}$ denotes the drain current at $V_{\text {in }}=0$.
(b) Yes, it is possible. If $V_{b}>V_{D D}+V_{T H}$, then $M_{1}$ turns on at the edge of the triode region at $V_{i n}=V_{D D}-V_{T H}$ and goes deeper as $V_{i n}$ falls. Of course, this choice of $V_{b}$ is neither practical nor desirable.

The input impedance of the circuit is also important. We note that for $\lambda=0$, the impedance seen at the source of $M_{1}$ in Fig. 3.48(a) is the same as that at the source of $M_{1}$ in Fig. 3.39, namely, $1 /\left(g_{m}+g_{m b}\right)=$ $1 /\left[g_{m}(1+\eta)\right]$. Thus, the body effect decreases the input impedance of the common-gate stage. The relatively low input impedance of the common-gate stage proves useful in some applications.

#### Example 3.17

In Fig. 3.50, transistor $M_{1}$ senses $\Delta V$ and delivers a proportional current to a $50-\Omega$ transmission line. The other end of the line is terminated by a $50-\Omega$ resistor in Fig. 3.50(a) and a common-gate stage in Fig. 3.50(b). Assume $\lambda=\gamma=0$.
(a) Calculate $V_{\text {out }} / V_{\text {in }}$ at low frequencies for both arrangements.
(b) What condition is necessary to minimize wave reflection at node $X$ ?
image_name:Figure 3.50(a)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1, G: g1}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: d1}
]
extrainfo:The circuit diagram (a) consists of an NMOS transistor M1 sensing a voltage change ΔV and delivering a proportional current to a 50-Ω transmission line. The other end of the line is terminated by a 50-Ω resistor RD. The output voltage swing is equal to -gm1ΔVxRD.
image_name:Figure 3.50(b)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1, G: g1}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: d2}
name: M2, type: NMOS, ports: {S: X, D: d2, G: Vb}
name: I1, type: CurrentSource, value: I1, ports: {Np: X, Nn: GND}
]
extrainfo:The circuit diagram (b) shows a configuration with two NMOS transistors M1 and M2. M1 senses a voltage change and drives a current through a transmission line terminated with a common-gate stage. The circuit includes a current source I1 connected to node X, and a resistor RD connected between VDD and node d1. The output is taken from node d1. The condition for minimizing wave reflection at node X is that the resistance at the source of M2 equals 50 Ohms.

#### Solution

(a) For small signals applied to the gate of $M_{1}$, the drain current experiences a change equal to $g_{m 1} \Delta V_{X}$. This current is drawn from $R_{D}$ in Fig. 3.50(a) and $M_{2}$ in Fig. 3.50(b), producing an output voltage swing equal to $-g_{m 1} \Delta V_{X} R_{D}$. Thus, $A_{v}=-g_{m 1} R_{D}$ for both cases.
(b) To minimize reflection at node $X$, the resistance seen at the source of $M_{2}$ must equal $50 \Omega$ and the reactance must be small. Thus, $1 /\left(g_{m 2}+g_{m b 2}\right)=50 \Omega$, which can be ensured by proper sizing and biasing of $M_{2}$. To minimize the capacitances of the transistor, it is desirable to use a small device biased at a large current. (Recall that $g_{m}=\sqrt{2 \mu_{n} C_{o x}(W / L) I_{D}}$.) In addition to higher power dissipation, this remedy also requires a large $V_{G S}$ for $M_{2}$.

The key point in this example is that, while the overall voltage gain in both arrangements equals $-g_{m 1} R_{D}$, the value of $R_{D}$ in Fig. 3.50(b) can be much greater than $50 \Omega$ without introducing reflections at point $X$. Thus, the common-gate circuit can provide a higher voltage gain than that in Fig. 3.50(a).

Now let us study the common-gate topology in a more general case, taking into account both the output impedance of the transistor and the impedance of the signal source. Depicted in Fig. 3.51(a), the circuit can be analyzed with the aid of its equivalent shown in Fig. 3.51(b). Noting that the current flowing
image_name:(a)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: RS, type: Resistor, value: RS, ports: {N1: Vin, N2: X}
name: M1, type: NMOS, ports: {S: X, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: ro, type: Resistor, value: ro, ports: {N1: Vout, N2: X}
]
extrainfo:The circuit is a common-gate NMOS amplifier where the input is applied to the source and the output is taken from the drain. The transistor M1 is biased with a voltage Vb. The resistors RD and ro model the output resistance of the transistor and the load, respectively. The source resistor RS is used for input signal coupling.

image_name:(b)
description:
[
name: RS, type: Resistor, value: RS, ports: {N1: X, N2: Vin}
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: Vout, Nn: X}
name: rO, type: Resistor, value: rO, ports: {N1: Vout, N2: X}
name: gmbVbs, type: VoltageControlledCurrentSource, value: gmbVbs, ports: {Np: Vout, Nn: X}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit is a small-signal equivalent of a common-gate NMOS amplifier. It includes a voltage source V1 for biasing, a resistor RS for input coupling, and resistors RD and rO modeling output resistance. The current sources gmV1 and gmbVbs represent transconductance effects.

Figure 3.51 (a) CG stage with finite transistor output resistance; (b) small-signal equivalent circuit.
through $R_{S}$ is equal to $-V_{\text {out }} / R_{D}$, we have

$$
\begin{equation*}
V_{1}-\frac{V_{\text {out }}}{R_{D}} R_{S}+V_{\text {in }}=0 \tag{3.108}
\end{equation*}
$$

Moreover, since the current through $r_{O}$ is equal to $-V_{\text {out }} / R_{D}-g_{m} V_{1}-g_{m b} V_{1}$, we can write

$$
\begin{equation*}
r_{O}\left(\frac{-V_{\text {out }}}{R_{D}}-g_{m} V_{1}-g_{m b} V_{1}\right)-\frac{V_{\text {out }}}{R_{D}} R_{S}+V_{\text {in }}=V_{\text {out }} \tag{3.109}
\end{equation*}
$$

Upon substitution for $V_{1}$ from (3.108), (3.109) reduces to

$$
\begin{equation*}
r_{O}\left[\frac{-V_{\text {out }}}{R_{D}}-\left(g_{m}+g_{m b}\right)\left(V_{\text {out }} \frac{R_{S}}{R_{D}}-V_{\text {in }}\right)\right]-\frac{V_{\text {out }} R_{S}}{R_{D}}+V_{\text {in }}=V_{\text {out }} \tag{3.110}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{\left(g_{m}+g_{m b}\right) r_{O}+1}{r_{O}+\left(g_{m}+g_{m b}\right) r_{O} R_{S}+R_{S}+R_{D}} R_{D} \tag{3.111}
\end{equation*}
$$

Note the similarity between (3.111) and (3.77). The gain of the common-gate stage is slightly higher due to body effect.

#### Example 3.18

Calculate the voltage gain of the circuit shown in Fig. 3.52(a) if $\lambda \neq 0$ and $\gamma \neq 0$.

#### Solution

We first find the Thevenin equivalent of $M_{1}$ and $V_{i n}$. As shown in Fig. 3.52(b), $M_{1}$ operates as a source follower, the equivalent Thevenin voltage is given by

$$
\begin{equation*}
V_{i n, e q}=\frac{r_{O 1} \| \frac{1}{g_{m b 1}}}{r_{O 1} \| \frac{1}{g_{m b 1}}+\frac{1}{g_{m 1}}} V_{i n} \tag{3.112}
\end{equation*}
$$

image_name:(a)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: M1, type: PMOS, ports: {S: s1s2, D: GND, G: Vin}
name: M2, type: NMOS, ports: {S: s1s2, D: VDD, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
]
extrainfo:The circuit is a source follower configuration using NMOS M1 and PMOS M2. The output voltage is taken across RD, and the input voltage is applied to the gate of M1.
image_name:(b)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: ro1, type: Resistor, value: ro1, ports: {N1: s1, N2: GND}
name: M1, type: PMOS, ports: {S: s1, D: GND, G: Vin}
]
extrainfo:The circuit is a source follower configuration with M1 as the NMOS transistor and M2 as the PMOS transistor. The Thevenin equivalent circuit is shown with Vin,eq and Req.
image_name:(c)
description:
[
name: Vin,eq, type: VoltageSource, value: Vin,eq, ports: {Np: Vin,eq, Nn: GND}
name: Req, type: Resistor, value: Req, ports: {N1: Vin,eq, N2: s2}
name: M2, type: NMOS, ports: {S: s2, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: VDD}
]
extrainfo:The circuit diagram represents a simplified model using Thevenin equivalents, focusing on the analysis of voltage gain with consideration of body effect and channel length modulation. The voltage source Vin,eq is connected to the gate of NMOS M2 through resistor Req.

and the equivalent Thevenin resistance is

$$
\begin{equation*}
R_{e q}=r_{O 1}\left\|\frac{1}{g_{m b 1}}\right\| \frac{1}{g_{m 1}} \tag{3.113}
\end{equation*}
$$

Redrawing the circuit as in Fig. 3.52(c), we use (3.111) to write

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{\left(g_{m 2}+g_{m b 2}\right) r_{O 2}+1}{r_{O 2}+\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{O 2}\right]\left(r_{O 1}\left\|\frac{1}{g_{m b 1}}\right\| \frac{1}{g_{m 1}}\right)+R_{D}} R_{D} \frac{r_{O 1} \| \frac{1}{g_{m b 1}}}{r_{O 1} \| \frac{1}{g_{m b 1}}+\frac{1}{g_{m 1}}} \tag{3.114}
\end{equation*}
$$

This example demonstrates the ease with which a circuit can be analyzed by inspection-while relying on previously-derived results-rather than by blindly writing KVLs and KCLs.

The input and output impedances of the common-gate topology are also of interest. To obtain the impedance seen at the source [Fig. 3.53(a)], we use the equivalent circuit in Fig. 3.53(b). Since $V_{1}=-V_{X}$ and the current through $r_{O}$ is equal to $I_{X}+g_{m} V_{1}+g_{m b} V_{1}=I_{X}-\left(g_{m}+g_{m b}\right) V_{X}$, we can add up the voltages across $r_{O}$ and $R_{D}$ and equate the result to

$$
\begin{equation*}
R_{D} I_{X}+r_{O}\left[I_{X}-\left(g_{m}+g_{m b}\right) V_{X}\right]=V_{X} \tag{3.115}
\end{equation*}
$$

image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: s1, D: d1, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: d1, N2: VDD}
name: ro, type: Resistor, value: ro, ports: {N1: d1, N2: s1}
]
extrainfo:The circuit is a common-gate amplifier configuration with an NMOS transistor M1. The input is applied at the source, and the output is taken from the drain. Resistors RD and ro are connected in parallel with the drain, and the source is grounded through Rin. The circuit includes current sources gmV1 and gmbVbs representing the transconductance and body effect, respectively.
image_name:(b)
description:
[
name: RD, type: Resistor, value: RD, ports: {N1: d1, N2: GND}
name: ro, type: Resistor, value: ro, ports: {N1: d1, N2: Vx}
name: gmV1, type: VoltageControlledCurrentSource, value: gmV1, ports: {Np: Vx, Nn: d1}
name: gmbVbs, type: VoltageControlledCurrentSource, value: gmbVbs, ports: {Np: Vx, Nn: d1}
name: Vx, type: VoltageSource, value: Vx, ports: {Np: Vx, Nn: GND}
]
extrainfo:The circuit represents a small-signal equivalent of a common-gate amplifier stage, showing the input impedance seen at the source terminal.
Figure 3.53 (a) Input resistance of a CG stage; (b) small-signal equivalent circuit.

Thus,

$$
\begin{align*}
\frac{V_{X}}{I_{X}} & =\frac{R_{D}+r_{O}}{1+\left(g_{m}+g_{m b}\right) r_{O}}  \tag{3.116}\\
& \approx \frac{R_{D}}{\left(g_{m}+g_{m b}\right) r_{O}}+\frac{1}{g_{m}+g_{m b}} \tag{3.117}
\end{align*}
$$

if $\left(g_{m}+g_{m b}\right) r_{O} \gg 1$. This result reveals that the drain impedance is divided by $\left(g_{m}+g_{m b}\right) r_{O}$ when seen at the source. This is particularly important in short-channel devices because of their low intrinsic gain. Two special cases of (3.116) are worth studying. First, suppose $R_{D}=0$. Then,

$$
\begin{align*}
\frac{V_{X}}{I_{X}} & =\frac{r_{O}}{1+\left(g_{m}+g_{m b}\right) r_{O}}  \tag{3.118}\\
& =\frac{1}{\frac{1}{r_{O}}+g_{m}+g_{m b}} \tag{3.119}
\end{align*}
$$

which is simply the impedance seen at the source of a source follower, a predictable result because if $R_{D}=0$, the circuit configuration is the same as in Fig. 3.39(a).

Second, let us replace $R_{D}$ with an ideal current source. Equation (3.117) predicts that the input impedance approaches infinity. While somewhat surprising, this result can be explained with the aid of Fig. 3.54. Since the total current through the transistor is fixed and equal to $I_{1}$, a change in the source potential cannot change the device current, and hence $I_{X}=0$. In other words, the input impedance of a common-gate stage is relatively low only if the load impedance connected to the drain is small.
image_name:Figure 3.54
description:
[
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: d1}
name: M1, type: NMOS, ports: {S: Vx, D: d1, G: Vb}
name: r_o, type: Resistor, value: r_o, ports: {N1: d1, N2: Vx}
]
extrainfo:The circuit is a common-gate stage with a current-source load. It includes a current source I1, an NMOS transistor M1, and a resistor r_o. The input impedance is impacted by the load impedance at the drain.
Figure 3.54 Input resistance of a CG stage with ideal current-source load.

#### Example 3.19

Calculate the voltage gain of a common-gate stage with a current-source load [Fig. 3.55(a)].

#### Solution

Letting $R_{D}$ approach infinity in (3.111), we have

$$
\begin{equation*}
A_{v}=\left(g_{m}+g_{m b}\right) r_{O}+1 \tag{3.120}
\end{equation*}
$$

Interestingly, the gain does not depend on $R_{S}$. From our foregoing discussion, we recognize that if $R_{D} \rightarrow \infty$, so does the impedance seen at the source of $M_{1}$, and the small-signal voltage at node $X$ becomes equal to $V_{i n}$. We can therefore simplify the circuit as shown in Fig. 3.55(b), readily arriving at (3.120).
image_name:Figure 3.55 (a)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: RS, type: Resistor, value: RS, ports: {N1: Vin, N2: X}
name: M1, type: NMOS, ports: {S: X, D: Vout, G: Vb}
name: ro, type: Resistor, value: ro, ports: {N1: Vout, N2: X}
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: Vout}
]
extrainfo:The circuit is a common-source amplifier with source degeneration. The NMOS transistor M1 is biased with a current source I1. The output is taken across the drain of M1, and the source is connected to ground through a resistor RS.
image_name:Figure 3.55 (b)
description:
[
name: Vin, type: VoltageSource, value: Vin, ports: {Np: Vin, Nn: GND}
name: M1, type: NMOS, ports: {S: X, D: Vout, G: Vb}
name: ro, type: Resistor, value: ro, ports: {N1: Vout, N2: X}
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: Vout}
]
extrainfo:The NMOS transistor M1 has its source connected to node X, drain to Vout, and gate to Vb. The current source I1 is connected from VDD to Vout, and the resistor ro is connected between Vout and X. The input voltage source Vin is connected to node X through RS.

Our analysis of the degenerated CS stage and the CG stage gives another interesting insight. As illustrated in Fig. 3.56, we loosely say that a transistor transforms its source resistance $u p$ and its drain resistance down (when seen at the appropriate terminal).
image_name:Figure 3.56
description:
[
name: M1, type: NMOS, ports: {S: s1, D: LOAD, G: GND}
name: RS, type: Resistor, value: RS, ports: {N1: s1, N2: GND}
]
extrainfo:The circuit illustrates impedance transformation by a MOSFET in a common-gate configuration. The output impedance is expressed as a function of RS, ro, and RD.
image_name:Figure 3.56
description:
[
name: M1, type: NMOS, ports: {S: s1, D: d1, G: GND}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: d1}
name: ro, type: Resistor, value: ro, ports: {N1: d1, N2: s1}
]
extrainfo:The circuit illustrates impedance transformation by a MOSFET. The NMOS transistor M1 is degenerated by RS and connected to a resistor ro at the drain. The output impedance is represented by the expression \( \frac{R_D + r_o}{1 + (g_m + g_{mb})r_o} \).

Figure 3.56 Impedance transformation by a MOSFET.
In order to calculate the output impedance of the common-gate stage, we use the circuit in Fig. 3.57. We note that the result is similar to that in Fig. 3.29, and hence

$$
\begin{equation*}
R_{\text {out }}=\left\{\left[1+\left(g_{m}+g_{m b}\right) r_{O}\right] R_{S}+r_{O}\right\} \| R_{D} \tag{3.121}
\end{equation*}
$$

image_name:Figure 3.57 Calculation of output resistance of a CG stage
description:
[
name: M1, type: NMOS, ports: {S: S1, D: VX, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: VX}
name: rO, type: Resistor, value: rO, ports: {N1: VX, N2: S1}
name: RS, type: Resistor, value: RS, ports: {N1: S1, N2: GND}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
name: VX, type: VoltageSource, value: VX, ports: {Np: VX, Nn: GND}
]
extrainfo:The circuit represents a common-gate stage with M1 as the NMOS transistor. The output impedance is calculated using the given expression. The circuit also includes resistors RD, rO, and RS, and voltage sources VDD and VX.

#### Example 3.20

As seen in Example 3.17, the input signal of a common-gate stage may be a current rather than a voltage. Shown in Fig. 3.58 is such an arrangement. Calculate $V_{\text {out }} / I_{\text {in }}$ and the output impedance of the circuit if the input current source exhibits an output impedance equal to $R_{P}$.
image_name:Figure 3.58
description:
[
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: RP, type: Resistor, value: RP, ports: {N1: P, N2: GND}
name: M1, type: NMOS, ports: {S: P, D: Vout, G: Vb}
name: Iin, type: CurrentSource, value: Iin, ports: {Np: P, Nn: GND}
]
extrainfo:The circuit is a common-gate amplifier stage with an NMOS transistor. It includes a current source Iin, resistors RD and RP, and a voltage node Vb for biasing the gate of the NMOS. The output is taken at Vout, which is connected to the drain of M1 and RD.

#### Solution

To find $V_{\text {out }} / I_{\text {in }}$, we replace $I_{\text {in }}$ and $R_{P}$ with a Thevenin equivalent and use (3.111) to write

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{\left(g_{m}+g_{m b}\right) r_{O}+1}{r_{O}+\left(g_{m}+g_{m b}\right) r_{O} R_{P}+R_{P}+R_{D}} R_{D} R_{P} \tag{3.122}
\end{equation*}
$$

The output impedance is simply equal to

$$
\begin{equation*}
R_{\text {out }}=\left\{\left[1+\left(g_{m}+g_{m b}\right) r_{O}\right] R_{P}+r_{O}\right\} \| R_{D} \tag{3.123}
\end{equation*}
$$

## 3.6 ■ Cascode Stage

As mentioned in Example 3.17, the input signal of a common-gate stage may be a current. We also know that a transistor in a common-source arrangement converts a voltage signal to a current signal. The cascade of a CS stage and a CG stage is called a "cascode" ${ }^{4}$ topology, providing many useful properties. Figure 3.59 shows the basic configuration: $M_{1}$ generates a small-signal drain current proportional to the small-signal input voltage, $V_{i n}$, and $M_{2}$ simply routes the current to $R_{D}$. We call $M_{1}$ the input device and $M_{2}$ the cascode device. Note that in this example, $M_{1}$ and $M_{2}$ carry equal bias and signal currents. As we describe the attributes of the circuit in this section, many advantages of the cascode topology over a simple common-source stage become evident. This circuit is also known as the "telescopic" cascode.
image_name:Figure 3.59 Cascode stage
description:
[
name: M1, type: NMOS, ports: {S: GND, D: X, G: Vin}
name: M2, type: NMOS, ports: {S: X, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: VDD, type: VoltageSource, value: VDD, ports: {Np: VDD, Nn: GND}
]
extrainfo:This is a telescopic cascode stage with M1 as the input device and M2 as the cascode device. The circuit provides high output impedance and improved gain.

Before delving into our analysis, it is instructive to explore the circuit qualitatively. We wish to know what happens if the value of $V_{i n}$ or $V_{b}$ changes by a small amount. Assume that both transistors are in saturation and $\lambda=\gamma=0$. If $V_{i n}$ rises by $\Delta V$, then $I_{D 1}$ increases by $g_{m 1} \Delta V$. This change in current flows through the impedance seen at $X$, i.e., the impedance seen at the source of $M_{2}$, which is equal to $1 / g_{m 2}$. Thus, $V_{X}$ falls by an amount given by $g_{m 1} \Delta V \cdot\left(1 / g_{m 2}\right)$ [Fig. 3.60(a)]. The change in $I_{D 1}$ also flows through $R_{D}$, producing a drop of $g_{m 1} \Delta V R_{D}$ in $V_{\text {out }}$ — just as in a simple CS stage.
image_name:Figure 3.60(a)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: X, G: Vin}
name: M2, type: NMOS, ports: {S: X, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: VDD}
]
extrainfo:The circuit is a cascode stage with NMOS transistors M1 and M2, where M1 senses a signal at its gate, and M2 acts as a cascode device. The resistor RD is connected between the output node Vout and the supply voltage VDD. A current source I1 is connected between node X and ground.
image_name:Figure 3.60(b)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: X, G: Vb}
name: M2, type: NMOS, ports: {S: X, D: Vout, G: deltaV}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: VDD}
name: I1, type: CurrentSource, value: I1, ports: {Np: X, Nn: GND}
]
extrainfo:This circuit is a cascode amplifier with a fixed input voltage Vin and a variable bias voltage Vb. The current source I1 is used to simplify the analysis by replacing M1. The circuit operates as a source follower with M2 sensing the input at its gate, affecting the output at node X.

Figure 3.60 Cascode stage sensing a signal at the gate of (a) an input device and (b) a cascode device.
Now, consider the case where $V_{i n}$ is fixed and $V_{b}$ increases by $\Delta V$. Since $V_{G S 1}$ is constant and $r_{O 1}=\infty$, we simplify the circuit as shown in Fig. 3.60(b). How do $V_{X}$ and $V_{\text {out }}$ change here? As far as node $X$ is concerned, $M_{2}$ operates as a source follower because it senses an input, $\Delta V$, at its gate and generates an output at $X$. With $\lambda=\gamma=0$, the small-signal voltage gain of the follower is equal to unity, regardless of the value of $R_{D}$ (why?). Thus, $V_{X}$ rises by $\Delta V$. On the other hand, $V_{\text {out }}$ does not change because $I_{D 2}$ is equal to $I_{D 1}$ and hence remains constant. We say that the voltage gain from $V_{b}$ to $V_{o u t}$ is zero in this case.

Let us now study the bias conditions of the cascode, still assuming that $\lambda=\gamma=0$. For $M_{1}$ to operate in saturation, we must have $V_{X} \geq V_{i n}-V_{T H 1}$. If $M_{1}$ and $M_{2}$ are both in saturation, $M_{2}$ operates as a source follower and $V_{X}$ is determined primarily by $V_{b}: V_{X}=V_{b}-V_{G S 2}$. Thus, $V_{b}-V_{G S 2} \geq V_{i n}-V_{T H 1}$, and hence $V_{b}>V_{i n}+V_{G S 2}-V_{T H 1}$ (Fig. 3.61). For $M_{2}$ to be saturated, $V_{\text {out }} \geq V_{b}-V_{T H 2}$; that is,

$$
\begin{align*}
V_{\text {out }} & \geq V_{\text {in }}-V_{T H 1}+V_{G S 2}-V_{T H 2}  \tag{3.124}\\
& =\left(V_{G S 1}-V_{T H 1}\right)+\left(V_{G S 2}-V_{T H 2}\right) \tag{3.125}
\end{align*}
$$

image_name:Figure 3.61 Allowable voltages in cascode stage.
description:
[
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: M1, type: NMOS, ports: {S: GND, D: X, G: Vin}
name: M2, type: NMOS, ports: {S: X, D: Vout, G: Vb}
]
extrainfo:The circuit is a cascode amplifier with M1 and M2 NMOS transistors. M2 is stacked on top of M1 to improve output impedance and gain. The circuit operates with the condition that both transistors must be in saturation for optimal performance.

if $V_{b}$ is chosen to place $M_{1}$ at the edge of saturation. Consequently, the minimum output level for which both transistors operate in saturation is equal to the overdrive voltage of $M_{1}$ plus that of $M_{2}$. In other words, addition of $M_{2}$ to the circuit reduces the output voltage swing by at least the overdrive voltage of $M_{2}$. We say that $M_{2}$ is "stacked" on top of $M_{1}$. We also loosely say that the minimum output voltage is equal to two overdrives or $2 V_{D, s a t}$.

We now analyze the large-signal behavior of the cascode stage shown in Fig. 3.59 as $V_{\text {in }}$ goes from zero to $V_{D D}$. For $V_{\text {in }} \leq V_{T H 1}, M_{1}$ and $M_{2}$ are off, $V_{o u t}=V_{D D}$, and $V_{X} \approx V_{b}-V_{T H 2}$ (if subthreshold conduction is neglected) (Fig. 3.62). As $V_{\text {in }}$ exceeds $V_{T H 1}, M_{1}$ begins to draw current, and $V_{\text {out }}$ drops. Since $I_{D 2}$ increases, $V_{G S 2}$ must increase as well, causing $V_{X}$ to fall. As $V_{i n}$ assumes sufficiently large values, two effects can occur: (1) $V_{X}$ drops below $V_{i n}$ by $V_{T H 1}$, forcing $M_{1}$ into the triode region; (2) $V_{o u t}$ drops below $V_{b}$ by $V_{T H 2}$, driving $M_{2}$ into the triode region. Depending on the device dimensions and the values of $R_{D}$ and $V_{b}$, one effect may occur before the other. For example, if $V_{b}$ is relatively low, $M_{1}$ may enter the triode region first. Note that if $M_{2}$ goes into the deep triode region, $V_{X}$ and $V_{\text {out }}$ become nearly equal.
image_name:Figure 3.62 Input-output characteristic of a cascode stage.
description:The graph in Figure 3.62 is a plot of the input-output characteristic of a cascode stage, showing two curves labeled $V_{out}$ and $V_X$. The horizontal axis represents the input voltage $V_{in}$, while the vertical axis represents the output voltages $V_{out}$ and $V_X$. The units for these axes are in volts, and the scale appears to be linear.

**Type of Graph and Function:**
This is a voltage transfer characteristic graph, depicting the relationship between input voltage and output voltages in a cascode amplifier configuration.

**Axes Labels and Units:**
- **Horizontal Axis:** Labeled as $V_{in}$ (input voltage) in volts.
- **Vertical Axis:** Labeled with $V_{out}$ and $V_X$ (output voltages) in volts.

**Overall Behavior and Trends:**
- The graph shows two distinct curves. Both $V_{out}$ and $V_X$ start at a high value when $V_{in}$ is low, and gradually decrease as $V_{in}$ increases.
- The curve for $V_{out}$ begins at $V_{DD}$, indicating the maximum output voltage when the input is at its minimum.
- $V_X$ starts below $V_{out}$ and follows a similar downward trend.
- Both curves exhibit a smooth, continuous decrease, with $V_{out}$ remaining consistently above $V_X$.

**Key Features and Technical Details:**
- The graph shows a threshold point labeled $V_{TH1}$ on the horizontal axis, indicating a significant change in the behavior of the curves.
- Another critical voltage level is marked as $V_b - V_{TH2}$ on the vertical axis, which is associated with the behavior of $M_2$ entering the triode region.
- As $V_{in}$ increases past $V_{TH1}$, both $V_{out}$ and $V_X$ decrease more rapidly, suggesting the transition of the transistors into different operational regions.

**Annotations and Specific Data Points:**
- The dotted line at $V_{TH1}$ suggests a transition point for $M_1$ entering the triode region.
- The graph indicates that when $V_{in}$ is sufficiently high, $V_{out}$ and $V_X$ approach nearly equal values, hinting at the potential for $M_2$ to enter the deep triode region.

### characteristic of a cascode stage.
Let us now consider the small-signal characteristics of a cascode stage, assuming that both transistors operate in saturation. If $\lambda=0$, the voltage gain is equal to that of a common-source stage because the drain current produced by the input device must flow through the cascode device. Illustrated in the equivalent circuit of Fig. 3.63, this result is independent of the transconductance and body effect of $M_{2}$. It can also be verified using $A_{v}=-G_{m} R_{\text {out }}$.
image_name:Figure 3.63 Small-signal equivalent circuit of cascode stage
description:
[
name: V1, type: VoltageSource, value: V1, ports: {Np: Vin, Nn: GND}
name: gm1V1, type: VoltageControlledCurrentSource, ports: {Np: X1, Nn: GND}
name: gm2V2, type: VoltageControlledCurrentSource, ports: {Np: Vout, Nn: X1}
name: gmbVbs, type: VoltageControlledCurrentSource, ports: {Np: Vout, Nn: X1}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
]
extrainfo:The circuit is a small-signal equivalent of a cascode stage with voltage sources V1 and V2, and controlled current sources gm1V1, gm2V2, and gmbVbs. The output is taken across RD, which is connected to the ground.

#### Example 3.21

Calculate the voltage gain of the circuit shown in Fig. 3.64 if $\lambda=0$.

#### Solution

The small-signal drain current of $M_{1}, g_{m 1} V_{i n}$, is divided between $R_{P}$ and the impedance seen looking into the source of $M_{2}, 1 /\left(g_{m 2}+g_{m b 2}\right)$. Thus, the current flowing through $M_{2}$ is

$$
\begin{equation*}
I_{D 2}=g_{m 1} V_{i n} \frac{\left(g_{m 2}+g_{m b 2}\right) R_{P}}{1+\left(g_{m 2}+g_{m b 2}\right) R_{P}} \tag{3.126}
\end{equation*}
$$

image_name:Figure 3.64
description:
[
name: M2, type: NMOS, ports: {S: d1s2, D: Vout, G: Vb}
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: Vin}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
name: RP, type: Resistor, value: RP, ports: {N1: d1s2, N2: GND}
]
extrainfo:The circuit is a cascode amplifier with high output impedance, consisting of two NMOS transistors M1 and M2. M1 is connected to the input voltage Vin, and M2 is controlled by a bias voltage Vb. The resistors RD and RP set the output and feedback characteristics.

The voltage gain is therefore given by

$$
\begin{equation*}
A_{v}=-\frac{g_{m 1}\left(g_{m 2}+g_{m b 2}\right) R_{P} R_{D}}{1+\left(g_{m 2}+g_{m b 2}\right) R_{P}} \tag{3.127}
\end{equation*}
$$

image_name:Figure 3.65 Calculation of output resistance of cascode stage.
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: GND}
name: M2, type: NMOS, ports: {S: d1s2, D: Load, G: GND}
]
extrainfo:The circuit is a cascode amplifier with two NMOS transistors, M1 and M2, and a resistor rO1. M1 and M2 are configured to increase the output impedance. The node d1s2 connects the drain of M1 and the source of M2, while rO1 is connected to the source of M2 and ground.

Output Resistance An important property of the cascode structure is its high output impedance. As illustrated in Fig. 3.65, for calculation of $R_{\text {out }}$, the circuit can be viewed as a common-source stage with a degeneration resistor equal to $r_{O 1}$. Thus, from (3.66),

$$
\begin{equation*}
R_{o u t}=\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{O 2}\right] r_{O 1}+r_{O 2} \tag{3.128}
\end{equation*}
$$

Assuming $g_{m} r_{O} \gg 1$, we have $R_{\text {out }} \approx\left(g_{m 2}+g_{m b 2}\right) r_{O 2} r_{O 1}$. That is, $M_{2}$ boosts the output impedance of $M_{1}$ by a factor of $\left(g_{m 2}+g_{m b 2}\right) r_{O 2}$. As shown in Fig. 3.66, cascoding can be extended to three or more stacked devices to achieve a higher output impedance, but the required additional voltage
image_name:Figure 3.66 Triple cascode
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1s2, D: d2s3, G: Vb1}
name: M3, type: NMOS, ports: {S: d2s3, D: Rout, G: Vb2}
]
extrainfo:The circuit is a triple cascode configuration using NMOS transistors M1, M2, and M3. It aims to increase the output impedance by stacking transistors. The gates of M2 and M3 are connected to bias voltages Vb1 and Vb2, respectively. The input is connected to Vin and the output is connected to the load through Rout.

#### Nanometer Design Notes

With a limited voltage headroom, nanometer cascode current sources are only moderately better than single transistors. The figure shows the I-V characteristic of an NMOS current source before and after cascoding (gray and black curves, respectively). Here, $W / L=5 \mu \mathrm{~m} / 40 \mathrm{~nm}$ for both devices. We observe that for $V_{X}<0.2 \mathrm{~V}$, the cascode has only a slightly higher output impedance.
image_name:Figure 3.66 Triple cascode
description:The graph in Figure 3.66 is an I-V characteristic plot of an NMOS current source, showing the relationship between the drain current (I_X) and the drain-source voltage (V_X). The x-axis represents the voltage V_X in volts, ranging from 0 to 1 V. The y-axis represents the current I_X in milliamperes (mA), ranging from 0 to 1 mA. The graph is plotted on a linear scale with gridlines to aid in reading the values.

There are two curves shown on the graph: a gray curve representing a single NMOS transistor and a black curve representing a cascoded NMOS configuration. The gray curve exhibits a steeper rise initially and continues to increase linearly, suggesting a lower output impedance. In contrast, the black curve, which represents the cascoded configuration, shows a more gradual increase in current with voltage, indicating a higher output impedance.

For V_X values less than 0.2 V, the cascoded configuration (black curve) has only a slightly higher output impedance than the single transistor (gray curve), as indicated by the small separation between the curves. Beyond this point, the difference becomes more pronounced, with the cascoded configuration maintaining a relatively constant current level compared to the single transistor.

The key feature of this graph is the demonstration of how cascoding affects the output impedance of the NMOS current source, with the cascoded configuration providing improved performance in terms of maintaining a constant current over a wider range of voltages.

headroom makes such configurations less attractive. For example, the minimum output voltage of a triple cascode is equal to the sum of three overdrive voltages.

To appreciate the utility of a high output impedance, recall from the lemma in Sec. 3.3.3 that the voltage gain can be written as $-G_{m} R_{\text {out }}$. Since $G_{m}$ is typically determined by the transconductance of a transistor, e.g., $M_{1}$ in Fig. 3.59, and hence bears trade-offs with the bias current and device capacitances, it is desirable to increase the voltage gain by maximizing $R_{\text {out }}$. Shown in Fig. 3.67 is an example. If both $M_{1}$ and $M_{2}$ operate in saturation, then $G_{m} \approx g_{m 1}$ and $R_{\text {out }} \approx\left(g_{m 2}+g_{m b 2}\right) r_{O 2} r_{O 1}$, yielding $A_{v}=\left(g_{m 2}+g_{m b 2}\right) r_{O 2} g_{m 1} r_{O 1}$. Thus, the maximum voltage gain is roughly equal to the square of the intrinsic gain of the transistors.

#### Example 3.22

Calculate the exact voltage gain of the circuit shown in Fig. 3.67.
image_name:Figure 3.67 Cascode stage with current-source load.
description:
[
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: Vout}
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1s2, D: Vout, G: Vb}
]
extrainfo:The circuit is a cascode stage with a current-source load, designed to maximize output resistance and voltage gain. The current source I1 provides biasing from VDD to the node d1s2, which is the drain of M1 and the source of M2. M1 and M2 are NMOS transistors, with M1's gate driven by Vin and M2's gate driven by Vb. The output is taken at Vout.

#### Solution

The actual $G_{m}$ of the stage is slightly less than $g_{m 1}$ because a fraction of the small-signal current produced by $M_{1}$ is shunted to ground by $r_{O 1}$. As depicted in Fig. 3.68(a), we short the output node to ac ground and recognize that the impedance seen looking into the source of $M_{2}$ is equal to $\left[1 /\left(g_{m 2}+g_{m b 2}\right)\right] \mid r_{O 2}$. Thus,

$$
\begin{equation*}
I_{\text {out }}=g_{m 1} V_{\text {in }} \frac{r_{O 1}}{r_{O 1}+\frac{1}{g_{m 2}+g_{m b 2}} \| r_{O 2}} \tag{3.129}
\end{equation*}
$$

image_name:Figure 3.68(a)
description:
[
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: GND}
name: M2, type: NMOS, ports: {S: d1s2, D: GND, G: Vb}
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: Vin}
name: ro2, type: Resistor, value: ro2, ports: {N1: d1s2, N2: GND}
name: ro1, type: Resistor, value: ro1, ports: {N1: d1s2, N2: GND}
]
extrainfo:The circuit is a cascode amplifier with two NMOS transistors M1 and M2, and resistors ro1 and ro2, biased by a current source I1. The input is at Vin and the output is at Iout.
image_name:Figure 3.68(b)
description:
[
name: M2, type: NMOS, ports: {S: s2, D: Vout, G: Vb}
name: rO2, type: Resistor, value: rO2, ports: {N1: Vout, N2: s2}
name: rO1, type: Resistor, value: rO1, ports: {N1: s2, N2: X}
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: Vout}
]
extrainfo:The circuit is a simplified small-signal model focusing on the output stage. It includes a current source (I1), two resistors (rO1 and rO2), and an NMOS transistor (M2). The output voltage Vout is derived from the interaction of these components.

It follows that the overall transconductance is equal to

$$
\begin{equation*}
G_{m}=\frac{g_{m 1} r_{O 1}\left[r_{O 2}\left(g_{m 2}+g_{m b 2}\right)+1\right]}{r_{O 1} r_{O 2}\left(g_{m 2}+g_{m b 2}\right)+r_{O 1}+r_{O 2}} \tag{3.130}
\end{equation*}
$$

and hence the voltage gain is given by

$$
\begin{align*}
\left|A_{v}\right| & =G_{m} R_{\text {out }}  \tag{3.131}\\
& =g_{m 1} r_{O 1}\left[\left(g_{m 2}+g_{m b 2}\right) r_{O 2}+1\right] \tag{3.132}
\end{align*}
$$

If we had assumed that $G_{m} \approx g_{m 1}$, then $\left|A_{v}\right| \approx g_{m 1}\left\{\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{O 2}\right] r_{O 1}+r_{O 2}\right\}$.
Another approach to calculating the voltage gain is to replace $V_{i n}$ and $M_{1}$ by a Thevenin equivalent, reducing the circuit to a common-gate stage. Illustrated in Fig. 3.68(b), this method in conjunction with (3.111) gives the same result as (3.132).

It is also interesting to compare the increase in the output impedance due to cascoding with that due to increasing the length of the input transistor for a given bias current (Fig. 3.69). Suppose, for example, that the length of the input transistor of a CS stage is quadrupled while the width remains constant. Then, since $I_{D}=(1 / 2) \mu_{n} C_{o x}(W / L)\left(V_{G S}-V_{T H}\right)^{2}$, the overdrive voltage is doubled, and the transistor consumes the same amount of voltage headroom as does a cascode stage. That is, the circuits of Figs. 3.69(b) and (c) impose equal voltage swing constraints.
image_name:(a)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: LOAD, G: Vin}
]
extrainfo:The circuit diagram (a) shows a common-source (CS) amplifier stage with an NMOS transistor M1. The transistor has a width-to-length ratio of W/L and is biased with a current ID. The input is applied at Vin, and the output is taken at the node labeled LOAD. The source of M1 is connected to ground.
image_name:(b)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: LOAD, G: Vin}
]
extrainfo:The circuit diagram (b) features a common-source NMOS transistor (M1) with quadrupled channel length (4L) to increase the output impedance. The input is connected to Vin, the drain is connected to the load, and the source is grounded. The configuration is designed to double the overdrive voltage while maintaining the same bias current, similar to a cascode stage.
image_name:(c)
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1s2, D: LOAD, G: Vb2}
]
extrainfo:The circuit in diagram (c) is a cascode amplifier configuration with two NMOS transistors M1 and M2. The source of M1 is connected to ground, its gate to Vin, and its drain to the source of M2. The gate of M2 is connected to Vb2, and its drain is connected to the load. This configuration increases the output impedance and improves the voltage swing constraints.

Figure 3.69 Increasing output impedance by increasing the device length or cascoding.
Now consider the output impedance achieved in each case. Since

$$
\begin{equation*}
g_{m} r_{O}=\sqrt{2 \mu_{n} C_{o x} \frac{W}{L} I_{D}} \frac{1}{\lambda I_{D}} \tag{3.133}
\end{equation*}
$$

and $\lambda \propto 1 / L$, quadrupling $L$ only doubles the value of $g_{m} r_{O}$ while cascoding results in an output impedance of roughly $g_{m} r_{O}^{2}$. Note that the transconductance of $M_{1}$ in Fig. 3.69(b) is half that in Fig. 3.69(c), degrading the performance. In other words, for a given voltage headroom, the cascode structure provides a higher output impedance.

A cascode structure need not operate as an amplifier. Another popular application of this topology is in building constant current sources. The high output impedance yields a current source closer to the ideal, but at the cost of voltage headroom. For example, current source $I_{1}$ in Fig. 3.67 can be implemented as a PMOS cascode (Fig. 3.70), exhibiting an impedance equal to $\left[1+\left(g_{m 3}+g_{m b 3}\right) r_{O 3}\right] r_{O 4}+r_{O 3}$.

We calculate the voltage gain with the aid of the lemma illustrated in Fig. 3.32. Writing $G_{m} \approx g_{m 1}$, we note that $R_{\text {out }}$ is now equal to the parallel combination of the NMOS cascode output impedance and the PMOS cascode output impedance:

$$
\begin{equation*}
R_{\text {out }}=\left\{\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{O 2}\right] r_{O 1}+r_{O 2}\right\} \|\left\{\left[1+\left(g_{m 3}+g_{m b 3}\right) r_{O 3}\right] r_{O 4}+r_{O 3}\right\} \tag{3.134}
\end{equation*}
$$

image_name:Figure 3.70 NMOS cascode amplifier with PMOS cascode load.
description:
[
name: M1, type: NMOS, ports: {S: GND, D: d1s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1s2, D: Vout, G: Vb1}
name: M3, type: PMOS, ports: {S: VDD, D: s3d4, G: Vb2}
name: M4, type: PMOS, ports: {S: s3d4, D: Vout, G: Vb3}
]
extrainfo:The circuit is a cascode amplifier with an NMOS input stage and a PMOS cascode current source load. It is designed to enhance output impedance and voltage gain.

The gain is given by $\left|A_{v}\right| \approx g_{m 1} R_{\text {out }}$. For typical values, we approximate the voltage gain as

$$
\begin{equation*}
\left|A_{v}\right| \approx g_{m 1}\left[\left(g_{m 2} r_{O 2} r_{O 1}\right) \|\left(g_{m 3} r_{O 3} r_{O 4}\right)\right] \tag{3.135}
\end{equation*}
$$

#### Example 3.23

How much voltage swing can the cascode amplifier of Fig. 3.70 support at the output?

#### Solution

Recall from Fig. 3.61 that $V_{b 1}$ can be chosen low enough to place $M_{1}$ at the edge of saturation, $V_{b 1}=V_{G S 2}+$ $\left(V_{G S 1}-V_{T H 1}\right)$, allowing a minimum value of $\left(V_{G S 2}-V_{T H 2}\right)+\left(V_{G S 1}-V_{T H 1}\right)$ for $V_{\text {out }}$. Similarly, $V_{b 2}$ can be chosen high enough to bias $M_{4}$ at the edge of saturation: $V_{b 2}+\left|V_{G S 3}\right|=V_{D D}-\left|V_{G S 4}-V_{T H 4}\right|$. This choice allows a maximum value of $V_{D D}-\left|V_{G S 4}-V_{T H 4}\right|-\left|V_{G S 3}-V_{T H 3}\right|$ for $V_{\text {out }}$. Thus, the total allowable voltage swing at the output is equal to
$V_{\text {out }, \text { max }}-V_{\text {out }, \text { min }}=V_{D D}-\left(V_{G S 1}-V_{T H 1}\right)-\left(V_{G S 2}-V_{T H 2}\right)-\left|V_{G S 3}-V_{T H 3}\right|-\left|V_{G S 4}-V_{T H 4}\right|$

We loosely say that the output swing is equal to $V_{D D}$ minus four overdrives or $4 V_{D, \text { sat }}$.

We should caution the reader that the dc value at the output of the cascode amplifier shown in Fig. 3.70 is poorly defined because two possibly unequal high-impedance current sources are placed in series. (What happens if two unequal ideal current sources appear in series?) For this reason, the circuit must be biased in a negative-feedback loop.

Poor Man's Cascode A "minimalist" cascode current source omits the bias voltage necessary for the cascode device. Shown in Fig. 3.71, this "poor man's cascode" places $M_{2}$ in the triode region because $V_{G S 1}>V_{T H 1}$ and $V_{D S 2}=V_{G S 2}-V_{G S 1}<V_{G S 2}-V_{T H 2}$. In fact, if $M_{1}$ and $M_{2}$ have identical dimensions, it can be proved that the structure is equivalent to a single transistor having twice the length—not really a cascode.
image_name:Figure 3.71 Poor man's cascode
description:
[
name: M1, type: NMOS, ports: {S: s1d2, D: d1, G: g1g2}
name: M2, type: NMOS, ports: {S: s2, D: s1d2, G: g1g2}
]
extrainfo:The circuit is a 'poor man's cascode' configuration with M1 and M2 as NMOS transistors. M1 is in the triode region and M2 is in saturation, resembling a single transistor with increased length.

In modern CMOS technologies, however, transistors with different threshold voltages are available, allowing $M_{2}$ to operate in saturation if $M_{1}$ has a lower threshold than $M_{2}$. For example, if $V_{T H 2}-V_{T H 1}=$ 150 mV and if $V_{G S 1}-V_{T H 1}<100 \mathrm{mV}$, then $M_{2}$ is saturated and the circuit acts as a true cascode.

Shielding Property Recall from Fig. 3.30 that the high output impedance arises from the fact that if the output-node voltage is changed by $\Delta V$, the resulting change at the source of the cascode device is much less. In a sense, the cascode transistor "shields" the input device from voltage variations at the output. The shielding property of cascodes proves useful in many circuits.

#### Example 3.24

Two identical NMOS transistors are used as constant current sources in a system [Fig. 3.72(a)]. However, due to the internal circuitry of the system, $V_{X}$ is higher than $V_{Y}$ by $\Delta V$.
(a) Calculate the resulting difference between $I_{D 1}$ and $I_{D 2}$ if $\lambda \neq 0$.
(b) Add cascode devices to $M_{1}$ and $M_{2}$ and repeat part (a).
image_name:Fig. 3.72(a)
description:The circuit contains two NMOS transistors, M1 and M2, used as constant current sources. They are both connected to ground at their sources, with gates connected to a bias voltage Vb. The drains of M1 and M2 are connected to nodes X and Y respectively, which are inputs to an analog system.
image_name:Fig. 3.72(b)
description:The circuit in Fig. 3.72(b) shows a cascode configuration with NMOS transistors M1 and M2 acting as the primary current sources, and M3 and M4 as cascode devices to improve output impedance. The cascode transistors help mitigate the effects of voltage variations at nodes X and Y on the drain currents I_D1 and I_D2.

#### Solution

(a) We have

$$
\begin{align*}
I_{D 1}-I_{D 2} & =\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{b}-V_{T H}\right)^{2}\left(\lambda V_{D S 1}-\lambda V_{D S 2}\right)  \tag{3.137}\\
& =\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{b}-V_{T H}\right)^{2}(\lambda \Delta V) \tag{3.138}
\end{align*}
$$

(b) As shown in Fig. 3.72(b), cascoding reduces the effect of $V_{X}$ and $V_{Y}$ upon $I_{D 1}$ and $I_{D 2}$, respectively. As depicted in Fig. 3.30 and implied by Eq. (3.69), a difference $\Delta V$ between $V_{X}$ and $V_{Y}$ translates to a difference $\Delta V_{P Q}$ between $P$ and $Q$ equal to

$$
\begin{align*}
\Delta V_{P Q} & =\Delta V \frac{r_{O 1}}{\left[1+\left(g_{m 3}+g_{m b 3}\right) r_{O 3}\right] r_{O 1}+r_{O 3}}  \tag{3.139}\\
& \approx \frac{\Delta V}{\left(g_{m 3}+g_{m b 3}\right) r_{O 3}} \tag{3.140}
\end{align*}
$$

Thus,

$$
\begin{equation*}
I_{D 1}-I_{D 2}=\frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(V_{b}-V_{T H}\right)^{2} \frac{\lambda \Delta V}{\left(g_{m 3}+g_{m b 3}\right) r_{O 3}} \tag{3.141}
\end{equation*}
$$

In other words, cascoding reduces the mismatch between $I_{D 1}$ and $I_{D 2}$ by a factor of $\left(g_{m 3}+g_{m b 3}\right) r_{O 3}$.

The shielding property of cascodes diminishes if the cascode device enters the triode region. To understand why, let us consider the circuit in Fig. 3.73, assuming that $V_{X}$ decreases from a large positive value. As $V_{X}$ falls below $V_{b 2}-V_{T H 2}, M_{2}$ enters the triode region and requires a greater gate-source overdrive so as to sustain the current drawn by $M_{1}$. We can write

$$
\begin{equation*}
I_{D 2}=\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{2}\left[2\left(V_{b 2}-V_{P}-V_{T H 2}\right)\left(V_{X}-V_{P}\right)-\left(V_{X}-V_{P}\right)^{2}\right] \tag{3.142}
\end{equation*}
$$

concluding that as $V_{X}$ decreases, $V_{P}$ also drops, so that $I_{D 2}$ remains constant. In other words, variation of $V_{X}$ is less attenuated as it appears at $P$. If $V_{X}$ falls sufficiently, $V_{P}$ goes below $V_{b 1}-V_{T H 1}$, driving $M_{1}$ into the triode region.
image_name:Figure 3.73 Output swing of cascode stage
description:
[
name: M1, type: NMOS, ports: {S: GND, D: P, G: Vb1}
name: M2, type: NMOS, ports: {S: P, D: Vx, G: Vb2}
name: Vx, type: VoltageSource, ports: {Np: Vx, Nn: GND}
]
extrainfo:The circuit is a cascode stage with NMOS transistors M1 and M2. M1 is in the triode region when Vp < Vb1 - Vth1. The voltage source Vx is connected between the node Vx and ground.

### 3.6.1 Folded Cascode

The idea behind the cascode structure is to convert the input voltage to a current and apply the result to a common-gate stage. However, the input device and the cascode device need not be of the same type. For example, as depicted in Fig. 3.74(a), a PMOS-NMOS combination performs the same function. In order to bias $M_{1}$ and $M_{2}$, a current source must be added as in Fig. 3.74(b). Note that $\left|I_{D 1}\right|+I_{D 2}$ is equal to $I_{1}$ and hence constant. The small-signal operation is as follows. If $V_{i n}$ becomes more positive, $\left|I_{D 1}\right|$ decreases, forcing $I_{D 2}$ to increase and hence $V_{\text {out }}$ to drop. The voltage gain and output impedance of the circuit can be obtained as calculated for the NMOS-NMOS cascode of Fig. 3.59. Shown in Fig. 3.74(c) is an NMOS-PMOS cascode. The advantages and disadvantages of these types will be explained later.
image_name:(a)
description:
[
name: M1, type: PMOS, ports: {S: VDD, D: d1s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1s2, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: VDD, N2: Vout}
]
extrainfo:The circuit is a simple folded cascode amplifier. It utilizes a PMOS transistor (M1) and an NMOS transistor (M2) to achieve high gain. The input voltage (Vin) is applied to the gate of M1, and the output voltage (Vout) is taken across the resistor RD. The bias voltage (Vb) controls the gate of M2, allowing current to flow from VDD through M1 and M2 to ground, thus folding the small-signal current.
image_name:(b)
description:
[
name: M1, type: PMOS, ports: {S: VDD, D: X, G: Vin}
name: M2, type: NMOS, ports: {S: X, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
name: I1, type: CurrentSource, value: I1, ports: {Np: X, Nn: GND}
]
extrainfo:The circuit is a folded cascode amplifier with PMOS input and NMOS cascode transistor. It includes a resistor RD connected to the output and a current source I1 providing bias current. The PMOS transistor M1 receives the input signal Vin, and M2 is biased by Vb.
image_name:(c)
description:
[
name: M1, type: PMOS, ports: {S: GND, D: d1s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1s2, D: Vout, G: Vb}
name: RD, type: Resistor, value: RD, ports: {N1: Vout, N2: GND}
name: I1, type: CurrentSource, value: I1, ports: {Np: VDD, Nn: d1s2}
]
extrainfo:The circuit is a folded cascode amplifier with NMOS input and PMOS cascode transistor. The input is at Vin, and the output is at Vout. The current source I1 provides biasing from VDD to the node d1s2.
Figure 3.74 (a) Simple folded cascode; (b) folded cascode with proper biasing; (c) folded cascode with NMOS input.

The structures of Figs. 3.74(b) and (c) are called "folded cascode" stages because the small-signal current is "folded" up [in Fig. 3.74(b)] or down [in Fig. 3.74(c)]. We should mention as a point of contrast that the bias current of $M_{1}$ in Fig. 3.70 flows through $M_{2}$, i.e., it is "reused," whereas those of $M_{1}$ and $M_{2}$ in Fig. 3.74(b) add up to $I_{1}$. Thus, the total bias current in this case must be higher than that in Fig. 3.70 to achieve a comparable performance.

It is instructive to examine the large-signal behavior of a folded-cascode stage. Suppose that in Fig. 3.74(b), $V_{i n}$ decreases from $V_{D D}$ to zero. For $V_{i n}>V_{D D}-\left|V_{T H 1}\right|, M_{1}$ is off and $M_{2}$ carries all of $I_{1}{ }^{5}$ yielding $V_{\text {out }}=V_{D D}-I_{1} R_{D}$. For $V_{\text {in }}<V_{D D}-\left|V_{T H 1}\right|, M_{1}$ turns on in saturation, giving

$$
\begin{equation*}
I_{D 2}=I_{1}-\frac{1}{2} \mu_{p} C_{o x}\left(\frac{W}{L}\right)_{1}\left(V_{D D}-V_{i n}-\left|V_{T H 1}\right|\right)^{2} \tag{3.143}
\end{equation*}
$$

As $V_{i n}$ drops, $I_{D 2}$ decreases further, falling to zero if $I_{D 1}=I_{1}$. This occurs at $V_{i n}=V_{i n 1}$ if

$$
\begin{equation*}
\frac{1}{2} \mu_{p} C_{o x}\left(\frac{W}{L}\right)_{1}\left(V_{D D}-V_{i n 1}-\left|V_{T H 1}\right|\right)^{2}=I_{1} \tag{3.144}
\end{equation*}
$$

Thus,

$$
\begin{equation*}
V_{i n 1}=V_{D D}-\sqrt{\frac{2 I_{1}}{\mu_{p} C_{o x}(W / L)_{1}}}-\left|V_{T H 1}\right| \tag{3.145}
\end{equation*}
$$

If $V_{i n}$ falls below this level, $I_{D 1}$ tends to be greater than $I_{1}$, and $M_{1}$ enters the triode region so as to ensure $I_{D 1}=I_{1}$. The result is plotted in Fig. 3.75. The reader is encouraged to determine the input voltage at which $\left|I_{D 1}\right|=I_{D 2}$.
image_name:Figure 3.75
description:The graph in Figure 3.75 illustrates the large-signal characteristics of a folded cascode circuit. It is a plot of the output voltage \( V_{out} \) versus the input voltage \( V_{in} \). The graph is a typical voltage transfer characteristic curve.

1. **Axes Labels and Units:**
- The horizontal axis represents the input voltage \( V_{in} \), but no specific units are provided, suggesting it is in volts.
- The vertical axis represents the output voltage \( V_{out} \), again likely in volts.

2. **Overall Behavior and Trends:**
- The graph shows a steep drop from a high output voltage level to a lower one as the input voltage increases.
- Initially, \( V_{out} \) remains constant at \( V_{DD} \) as \( V_{in} \) is increased. This indicates that the transistor is in saturation.
- As \( V_{in} \) reaches \( V_{in1} \), the output voltage begins to decrease sharply, indicating the transition from saturation to the triode region.
- Beyond \( V_{DD} - |V_{TH1}| \), the output voltage approaches \( V_{DD} - R_D I_1 \), suggesting a linear relationship in the triode region.

3. **Key Features and Technical Details:**
- The graph starts at \( V_{DD} \) on the vertical axis, indicating the maximum output voltage when the transistor is fully on.
- The point \( V_{in1} \) marks the input voltage at which the transistor begins to leave saturation.
- The output voltage drops sharply after \( V_{in1} \) and continues to decrease until it reaches \( V_{DD} - R_D I_1 \).
- The transition point \( V_{DD} - |V_{TH1}| \) is crucial as it indicates the threshold voltage level beyond which the transistor fully enters the triode region.

4. **Annotations and Specific Data Points:**
- The graph includes dashed lines indicating the transition points at \( V_{in1} \) and \( V_{DD} - |V_{TH1}| \), helping to identify critical changes in the circuit behavior.
- \( V_{DD} - R_D I_1 \) is annotated on the vertical axis as the lowest output voltage level achieved in this scenario.

image_name:Figure 3.75 Large-signal characteristics of folded cascode
description:The graph in Figure 3.75 illustrates the large-signal characteristics of a folded cascode circuit. It is a plot showing the relationship between the input voltage \( V_{in} \) on the horizontal axis and the currents \( I_{D1} \) and \( I_{D2} \) on the vertical axis, labeled as \( I_1 \). The graph is depicted with a linear scale.

Axes Labels and Units:
- **Horizontal Axis:** Represents the input voltage \( V_{in} \).
- **Vertical Axis:** Represents the current \( I_1 \), with specific focus on \( I_{D1} \) and \( I_{D2} \).

Overall Behavior and Trends:
The graph shows two intersecting curves:
- **\( I_{D1} \):** Decreases as \( V_{in} \) increases.
- **\( I_{D2} \):** Increases as \( V_{in} \) increases.

The curves intersect at a point marked by \( V_{DD} - |V_{TH1}| \). This indicates a critical voltage level where the behavior of the circuit changes significantly.

Key Features and Technical Details:
- **Transition Points:** The graph includes dashed vertical lines at \( V_{in1} \) and \( V_{DD} - |V_{TH1}| \), marking significant transition points in the circuit's operation.
- **Behavior at Extremes:**
- As \( I_{D2} \) drops to zero, \( V_{X} \) rises, reaching \( V_{b} - V_{TH2} \).
- As \( M_{1} \) enters the triode region, \( V_{X} \) approaches \( V_{DD} \).

Annotations and Specific Data Points:
- The dashed lines help identify the points where \( V_{in} \) equals \( V_{in1} \) and \( V_{DD} - |V_{TH1}| \), which are critical for understanding the circuit's behavior.
- The lowest output voltage level is annotated as \( V_{DD} - R_D I_1 \) on the vertical axis, indicating the minimum voltage achievable in the scenario described.

This graph effectively demonstrates the interplay between the input voltage and the resulting currents in the folded cascode, highlighting key operational thresholds and transitions.

Figure 3.75 Large-signal characteristics of folded cascode.

What happens to $V_{X}$ in the above test? As $I_{D 2}$ drops, $V_{X}$ rises, reaching $V_{b}-V_{T H 2}$ for $I_{D 2}=0$. As $M_{1}$ enters the triode region, $V_{X}$ approaches $V_{D D}$.

#### Example 3.25

Calculate the output impedance of the folded cascode shown in Fig. 3.76(a), where $M_{3}$ operates as the bias current source.

#### Solution

Using the simplified model in Fig. 3.76(b) and Eq. (3.66), we have

$$
\begin{equation*}
R_{\text {out }}=\left[1+\left(g_{m 2}+g_{m b 2}\right) r_{O 2}\right]\left(r_{O 1} \| r_{O 3}\right)+r_{O 2} \tag{3.146}
\end{equation*}
$$

image_name:Figure 3.76(a)
description:
[
name: M1, type: PMOS, ports: {S: VDD, D: d1d3s2, G: Vin}
name: M2, type: NMOS, ports: {S: d1d3s2, D: Rout, G: Vb}
name: M3, type: NMOS, ports: {S: GND, D: d1d3s2, G: Vb3}
]
extrainfo:This is a folded cascode amplifier circuit with M3 acting as a bias current source. The output impedance is determined by the interaction of the transistors and the resistor Rout.
image_name:Figure 3.76(b)
description:
[
name: M2, type: NMOS, ports: {S: s2, D: Rout, G: Vb}
name: ro1||ro3, type: Resistor, value: ro1||ro3, ports: {N1: s2, N2: GND}
]
extrainfo:The circuit in (b) is a folded cascode configuration with a load connected to the output. M2 is the main amplifying transistor with M3 acting as a bias current source. The output impedance is influenced by the parallel combination of ro1 and ro3.

Thus, the circuit exhibits an output impedance lower than that of a nonfolded (also called "telescopic") cascode.

In order to achieve a high voltage gain, the load of a folded cascode can be implemented as a cascode itself (Fig. 3.77). This structure is studied more extensively in Chapter 9.
image_name:Figure 3.77
description:
[
name: M1, type: PMOS, ports: {S: VDD, D: P, G: Vin}
name: M2, type: NMOS, ports: {S: P, D: Vout, G: Vb}
name: M4, type: PMOS, ports: {S: s4d5, D: Vout, G: Vb2}
name: M5, type: PMOS, ports: {S: VDD, D: s4d5, G: Vb3}
name: I1, type: CurrentSource, value: I1, ports: {Np: P, Nn: GND}
]
extrainfo:The circuit is a folded cascode amplifier with a cascode load. M1 and M2 form the main amplifying stage, while M4 and M5 create the cascode load. I1 provides a bias current. The output impedance is influenced by the parallel combination of ro1 and ro3.

Figure 3.77 Folded cascode with cascode load.

Throughout this chapter, we have attempted to increase the output resistance of voltage amplifiers so as to obtain a high gain. This may seem to make the speed of the circuit quite susceptible to the load capacitance. However, as explained in Chapter 8, a high output impedance per se does not pose a serious issue if the amplifier is placed in a proper feedback loop.

## 3.7 ■ Choice of Device Models

In this chapter, we have developed various expressions for the properties of single-stage amplifiers. For example, the voltage gain of a degenerated common-source stage can be as simple as $-R_{D} /\left(R_{S}+g_{m}^{-1}\right)$ or as complex as Eq. (3.77). How does one choose a sufficiently accurate device model or expression?

The proper choice is not always straightforward, and making it is a skill gained through practice, experience, and intuition. However, some general principles in choosing the model for each transistor can be followed. First, break the circuit down into a number of familiar topologies. Next, concentrate on each subcircuit and use the simplest transistor model (a single voltage-dependent current source for

FETs operating in saturation) for all transistors. If the drain of a device is connected to a high impedance (e.g., the drain of another), then add $r_{O}$ to its model. At this point, the basic properties of most circuits can be determined by inspection. In a second, more accurate iteration, the body effect of devices whose source or bulk is not at ac ground can be included as well.

For bias calculations, it is usually adequate to neglect channel-length modulation and body effect in the first pass. These effects do introduce some error, but they can be included in the next iteration step—after the basic properties are understood.

In today's analog design, simulation of circuits is essential because the behavior of short-channel MOSFETs cannot be predicted accurately by hand calculations. Nonetheless, if the designer avoids a simple and intuitive analysis of the circuit and hence skips the task of gaining insight, then he/she cannot interpret the simulation results intelligently. For this reason, we say, "Don't let the computer think for you." Some say, "Don't be a SPICE monkey."
