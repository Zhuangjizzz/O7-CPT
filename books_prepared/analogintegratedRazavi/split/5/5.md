# CHAPTER 5 Current Mirrors and Biasing Techniques

Our study of single-stage and differential amplifiers in Chapters 3 and 4 points to the wide usage of current sources. In these circuits, current sources act as a large resistor without consuming excessive voltage headroom. We also noted that MOS devices operating in saturation can act as a current source.

Current sources find other applications in analog design as well. For example, some digital-to-analog (D/A) converters employ an array of current sources to produce an analog output proportional to the digital input. Also, current sources, in conjunction with "current mirrors," can perform useful functions on analog signals.

This chapter deals with the design of current mirrors and bias circuits. Following a review of basic current mirrors, we study the cascode mirror. Next, we analyze active current mirrors and describe the properties of differential pairs using such circuits as loads. Finally, we introduce various biasing techniques for amplifier stages.

## 5.1 - Basic Current Mirrors

Figure 5.1 illustrates two examples in which a current source proves useful. From our study in Chapter 2, recall that the output resistance and capacitance and the voltage headroom of a current source trade with the magnitude of the output current. In addition to these issues, several other aspects of current sources are important: supply, process, and temperature dependence; output noise current; and matching with other current sources. We defer the noise and matching considerations to Chapters 7 and 14, respectively.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-134.jpg?height=421&width=1441&top_left_y=1818&top_left_x=337)

Figure 5.1 Applications of current sources.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-135.jpg?height=314&width=272&top_left_y=245&top_left_x=563)

Figure 5.2 Definition of current by resistive divider.

How should a MOSFET be biased so as to operate as a stable current source? To gain a better view of the issues, let us consider the simple resistive biasing shown in Fig. 5.2. Assuming $M_{1}$ is in saturation, we can write

$$
\begin{equation*}
I_{\text {out }} \approx \frac{1}{2} \mu_{n} C_{o x} \frac{W}{L}\left(\frac{R_{2}}{R_{1}+R_{2}} V_{D D}-V_{T H}\right)^{2} \tag{5.1}
\end{equation*}
$$

This expression reveals various PVT dependencies of $I_{\text {out }}$. The overdrive voltage is a function of $V_{D D}$ and $V_{T H}$; the threshold voltage may vary by 50 to 100 mV from wafer to wafer. Furthermore, both $\mu_{n}$ and $V_{T H}$ exhibit temperature dependence. Thus, $I_{o u t}$ is poorly defined. The issue becomes more severe as the device is biased with a smaller overdrive voltage, e.g., to consume less headroom and support greater voltage swings at the drain. With a nominal overdrive of, say, 200 mV , a $50-\mathrm{mV}$ error in $V_{T H}$ results in a $44 \%$ error in the output current.

It is important to note that process and temperature dependencies exist even if the gate voltage is not a function of the supply voltage. In other words, if the gate-source voltage of a MOSFET is precisely defined, then its drain current is not! For this reason, we must seek other methods of biasing MOS current sources.

The design of current sources in analog circuits is based on "copying" currents from a reference, with the assumption that one precisely-defined current source is already available. While this method may appear to entail an endless loop, it is carried out as illustrated in Fig. 5.3. A relatively complex circuit-sometimes requiring external adjustments-is used to generate a stable reference current, $I_{R E F}$, which is then "cloned" to create many current sources in the system. We study the copying operation here and the reference generator (which is based on "bandgap" techniques) in Chapter 12.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-135.jpg?height=357&width=708&top_left_y=1635&top_left_x=345)

Figure 5.3 Use of a reference to generate various currents.

How do we generate copies of a reference current? For example, in Fig. 5.4, how do we guarantee that $I_{\text {out }}=I_{R E F}$ ? For a MOSFET, if $I_{D}=f\left(V_{G S}\right)$, where $f(\cdot)$ denotes the dependence of $I_{D}$ upon $V_{G S}$, then $V_{G S}=f^{-1}\left(I_{D}\right)$. That is, if a transistor is biased at $I_{R E F}$, then it produces $V_{G S}=f^{-1}\left(I_{R E F}\right)[F i g$. 5.5(a)]. Thus, if this voltage is applied to the gate and source terminals of a second MOSFET, the resulting current is $I_{\text {out }}=f\left[f^{-1}\left(I_{R E F}\right)\right]=I_{R E F}[$ Fig. $5.5(\mathrm{~b})]$. From another point of view, two identical MOS devices that have equal gate-source voltages and operate in saturation carry equal currents (if $\lambda=0$ ).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-136.jpg?height=975&width=1297&top_left_y=240&top_left_x=386)

The structure consisting of $M_{1}$ and $M_{2}$ in Fig. 5.5(b) is called a "current mirror." In the general case, the transistors need not be identical. Neglecting channel-length modulation, we can write

$$
\begin{align*}
I_{R E F} & =\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{1}\left(V_{G S}-V_{T H}\right)^{2}  \tag{5.2}\\
I_{o u t} & =\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{2}\left(V_{G S}-V_{T H}\right)^{2} \tag{5.3}
\end{align*}
$$

obtaining

$$
\begin{equation*}
I_{\text {out }}=\frac{(W / L)_{2}}{(W / L)_{1}} I_{R E F} \tag{5.4}
\end{equation*}
$$

The key property of this topology is that it allows precise copying of the current with no dependence on process and temperature. The translation from $I_{R E F}$ to $I_{\text {out }}$ merely involves the ratio of device dimensions, a quantity that can be controlled with reasonable accuracy.

It is important to appreciate the cause-and-effect relationships stipulated by $V_{G S}=f^{-1}\left(I_{R E F}\right)$ and $f\left[f^{-1}\left(I_{R E F}\right)\right]=I_{R E F}$. The former suggests that we must generate a $V_{G S}$ from $I_{R E F}$; i.e., $I_{R E F}$ is the cause and $V_{G S}$ is the effect. A MOSFET can perform this function only if it is configured as a diode while carrying a current of $I_{R E F}$ [ $M_{1}$ in Fig. 5.5(b)]. Similarly, the latter equation indicates that a transistor must sense $f^{-1}\left(I_{R E F}\right)\left(=V_{G S}\right)$ and generate $f\left[f^{-1}\left(I_{R E F}\right)\right]$. In this case, the cause is $V_{G S}$ and the effect is the output current, $f\left[f^{-1}\left(I_{R E F}\right)\right]$ [as provided by $M_{2}$ in Fig. 5.5(b)].

With the aid of these observations, we can understand why a circuit such as that in Fig. 5.6 does not perform current copying. Here, $V_{b}$ is not caused by $I_{R E F}$, and hence $I_{\text {out }}$ does not track $I_{R E F}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-137.jpg?height=350&width=383&top_left_y=245&top_left_x=505)

Figure 5.6 Circuit incapable of copying current.

#### Example 5.1

In Fig. 5.7, find the drain current of $M_{4}$ if all of the transistors are in saturation.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-137.jpg?height=303&width=552&top_left_y=801&top_left_x=400)

Figure 5.7

#### Solution

We have $I_{D 2}=I_{R E F}\left[(W / L)_{2} /(W / L)_{1}\right]$. Also, $\left|I_{D 3}\right|=\left|I_{D 2}\right|$ and $I_{D 4}=I_{D 3} \times\left[(W / L)_{4} /(W / L)_{3}\right]$. Thus, $\left|I_{D 4}\right|=$ $\alpha \beta I_{R E F}$, where $\alpha=(W / L)_{2} /(W / L)_{1}$ and $\beta=(W / L)_{4} /(W / L)_{3}$. Proper choice of $\alpha$ and $\beta$ can establish large or small ratios between $I_{D 4}$ and $I_{R E F}$. For example, $\alpha=\beta=5$ yields a magnification factor of 25 . Similarly, $\alpha=\beta=0.2$ can be utilized to generate a small, well-defined current.

We should also remark that the copy of a copy may not be as "clear" as the original. Owing to random "mismatches" between $M_{1}$ and $M_{2}$ in the above example, $I_{D 2}$ slightly deviates from its nominal value. Similarly, as $I_{D 2}$ is copied onto $I_{D 4}$, additional errors accumulate. We must therefore avoid long current mirror chains.

Current mirrors find wide application in analog circuits. Figure 5.8 illustrates a typical case, where a differential pair is biased by means of an NMOS mirror for the tail current source and a PMOS mirror
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-137.jpg?height=490&width=912&top_left_y=1740&top_left_x=530)

Figure 5.8 Current mirrors used to bias a differential amplifier.
for the load current sources. The device dimensions shown establish a drain current of $0.4 I_{T}$ in $M_{5}$ and $M_{6}$, reducing the drain current of $M_{3}$ and $M_{4}$ and hence increasing the amplifier's gain.

Sizing Issues Current mirrors usually employ the same length for all of the transistors so as to minimize errors due to the side-diffusion of the source and drain areas $\left(L_{D}\right)$. For example, in Fig. 5.8, the NMOS current sources must have the same channel length as $M_{0}$. This is because if $L_{\text {drawn }}$ is, say, doubled, then $L_{\text {eff }}=L_{\text {drawn }}-2 L_{D}$ is not. Furthermore, the threshold voltage of short-channel devices exhibits some dependence on the channel length (Chapter 17). Thus, current ratioing is achieved by scaling only the width of the transistors.

Suppose we wish to copy a reference current, $I_{R E F}$, and generate $2 I_{R E F}$. We begin with a width of $W_{R E F}$ for the diode-connected reference transistor and hence choose $2 W_{R E F}$ for the current source [Fig. 5.9(a)]. Unfortunately, direct scaling of the width also faces difficulties. As illustrated in Fig. 5.9(b), since the "corners" of the gate are poorly defined, if the drawn $W$ is doubled, the actual width does not exactly double. We thus prefer to employ a "unit" transistor and create copies by repeating such a device [Fig. 5.9(c)].
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-138.jpg?height=552&width=1522&top_left_y=861&top_left_x=274)

Figure 5.9 (a) Current mirror multiplying $I_{R E F}$ by 2, (b) effect of gate corner on current accuracy, and (c) more accurate current multiplication.

But how do we generate a current equal to $I_{R E F} / 2$ from $I_{R E F}$ ? In this case, the diode-connected device itself must consist of two units, each carrying $I_{R E F} / 2$. Figure 5.10(a) depicts an example for the generation of both $2 I_{R E F}$ and $I_{R E F} / 2$; each unit has a width of $W_{0}$ (and the same length).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-138.jpg?height=411&width=1440&top_left_y=1667&top_left_x=317)

Figure 5.10 Current mirrors providing $I_{R E F} / 2$ from $I_{R E F}$ by (a) half-width device and (b) series transistors.
The above approach requires a large number of unit transistors if many different currents must be generated. It is possible to reduce the complexity by scaling the lengths, but not directly. In order to avoid the errors due to $L_{D}$, we can, for example, double the equivalent length by placing two unit
transistors in series. Illustrated in Fig. 5.10(b), this approach preserves an effective length of $L_{\text {drawn }}-2 L_{D}$ for each unit, yielding an equivalent length of $2\left(L_{\text {drawn }}-2 L_{D}\right)$ for the composite device and hence halving the current. Note that this structure is not a cascode because the bottom device is in the triode region (why?).

We should also mention that current mirrors can process signals as well. In Fig. 5.5(b), for example, if $I_{R E F}$ increases by $\Delta I$, then $I_{\text {out }}$ increases by $\Delta I(W / L)_{2} /(W / L)_{1}$. That is, the circuit amplifies the small-signal current if $(W / L)_{2} /(W / L)_{1}>1$ (but at the cost of proportional multiplication of the bias current).

#### Example 5.2

Calculate the small-signal voltage gain of the circuit shown in Fig. 5.11.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-139.jpg?height=370&width=482&top_left_y=747&top_left_x=435)

Figure 5.11

#### Solution

The small-signal drain current of $M_{1}$ is equal to $g_{m 1} V_{i n}$. Since $I_{D 2}=I_{D 1}$ and $I_{D 3}=I_{D 2}(W / L)_{3} /(W / L)_{2}$, the small-signal drain current of $M_{3}$ is equal to $g_{m 1} V_{i n}(W / L)_{3} /(W / L)_{2}$, yielding a voltage gain of $g_{m 1} R_{L}(W / L)_{3} /(W / L)_{2}$.

## 5.2 ■ Cascode Current Mirrors

In our discussion of current mirrors thus far, we have neglected channel-length modulation. In practice, this effect produces significant error in copying currents, especially if minimum-length transistors are used so as to minimize the width and hence the output capacitance of the current source. For the simple mirror of Fig. 5.5(b), we can write

$$
\begin{align*}
I_{D 1} & =\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{1}\left(V_{G S}-V_{T H}\right)^{2}\left(1+\lambda V_{D S 1}\right)  \tag{5.5}\\
I_{D 2} & =\frac{1}{2} \mu_{n} C_{o x}\left(\frac{W}{L}\right)_{2}\left(V_{G S}-V_{T H}\right)^{2}\left(1+\lambda V_{D S 2}\right) \tag{5.6}
\end{align*}
$$

and hence

$$
\begin{equation*}
\frac{I_{D 2}}{I_{D 1}}=\frac{(W / L)_{2}}{(W / L)_{1}} \cdot \frac{1+\lambda V_{D S 2}}{1+\lambda V_{D S 1}} \tag{5.7}
\end{equation*}
$$

While $V_{D S 1}=V_{G S 1}=V_{G S 2}, V_{D S 2}$ may not equal $V_{G S 2}$ because of the circuitry fed by $M_{2}$. For example, in Fig. 5.8, the potential at node $P$ is determined by the input common-mode level and the gate-source voltage of $M_{1}$ and $M_{2}$, and it may not equal $V_{X}$.

In order to suppress the effect of channel-length modulation in Fig. 5.5(b), we can (1) force $V_{D S 2}$ to be equal to $V_{D S 1}$, or (2) force $V_{D S 1}$ to be equal to $V_{D S 2}$. These two principles lead to two different topologies.

First Approach We begin with the first principle and wish to ensure that $V_{D S 2}$ in Fig. 5.5(b) is both constant and equal to $V_{D S 1}$. Recall from Chapter 3 that a cascode device can shield a current source, thereby reducing the voltage variations across it. As shown in Fig. 5.12(a), even though the analog circuit may allow $V_{P}$ to vary substantially, $V_{Y}$ remains relatively constant. But how do we ensure that $V_{D S 2}=V_{D S 1}$ ? We must generate $V_{b}$ such that $V_{b}-V_{G S 3}=V_{D S 1}\left(=V_{G S 1}\right)$, i.e., $V_{b}=V_{G S 3}+V_{G S 1}$. In other words, $V_{b}$ can be established by two diode-connected devices in series [Fig. 5.12(b)], provided that $V_{G S 0}+V_{G S 1}=V_{G S 3}+V_{G S 1}$, and hence $V_{G S 0}=V_{G S 3}$. We now attach the $V_{b}$ generator of Fig. 5.12(b) to the cascode current source as shown in Fig. 5.12(c). The result allows accurate copying of the current even in the presence of body effect (why?).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-140.jpg?height=516&width=1220&top_left_y=772&top_left_x=425)

Figure 5.12 (a) Cascode current source, (b) modification of mirror circuit to generate the cascode bias voltage, and (c) cascode current mirror.

A few notes on the sizing of the transistors in Fig. 5.12(c) are warranted. As explained earlier, we typically select $L_{2}=L_{1}$ and scale $W_{2}$ (in integer units) with respect to $W_{1}$ to obtain the desired multiple of $I_{R E F}$. Similarly, for $V_{G S 3}$ to be equal to $V_{G S 0}$, we choose $L_{3}=L_{0}$ and scale $W_{3}$ with respect to $W_{0}$ by the same factor, i.e., $W_{3} / W_{0}=W_{2} / W_{1}$. In practice, $L_{3}$ and $L_{0}$ are equal to the minimum allowable value so as to minimize their width, while $L_{1}$ and $L_{2}$ may be longer in some cases. ${ }^{1}$

#### Example 5.3

In Fig. 5.13, sketch $V_{X}$ and $V_{Y}$ as a function of $I_{R E F}$. If $I_{R E F}$ requires 0.5 V to operate as a current source, what is its maximum value?

#### Solution

Since $M_{2}$ and $M_{3}$ are properly ratioed with respect to $M_{1}$ and $M_{0}$, we have $V_{Y}=V_{X} \approx \sqrt{2 I_{R E F} /\left[\mu_{n} C_{o x}(W / L)_{1}\right]}+$ $V_{T H 1}$. The behavior is plotted in Fig. 5.13(b).

To find the maximum value of $I_{R E F}$, we note that

$$
\begin{align*}
V_{N} & =V_{G S 0}+V_{G S 1}  \tag{5.8}\\
& =\sqrt{\frac{2 I_{R E F}}{\mu_{n} C_{o x}}}\left[\sqrt{\left(\frac{L}{W}\right)_{0}}+\sqrt{\left(\frac{L}{W}\right)_{1}}\right]+V_{T H 0}+V_{T H 1} \tag{5.9}
\end{align*}
$$

[^21]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-141.jpg?height=495&width=920&top_left_y=234&top_left_x=503)

Figure 5.13

Thus,

$$
\begin{equation*}
V_{D D}-\sqrt{\frac{2 I_{R E F}}{\mu_{n} C_{o x}}}\left[\sqrt{\left(\frac{L}{W}\right)_{0}}+\sqrt{\left(\frac{L}{W}\right)_{1}}\right]-V_{T H 0}-V_{T H 1}=0.5 \mathrm{~V} \tag{5.10}
\end{equation*}
$$

and hence

$$
\begin{equation*}
I_{R E F, \max }=\frac{\mu_{n} C_{o x}}{2} \frac{\left(V_{D D}-0.5 \mathrm{~V}-V_{T H 0}-V_{T H 1}\right)^{2}}{\left(\sqrt{(L / W)_{0}}+\sqrt{\left.(L / W)_{1}\right)^{2}}\right.} \tag{5.11}
\end{equation*}
$$

While operating as a current source with a high output impedance and accurate value, the topology of Fig. 5.12(c) nonetheless consumes substantial voltage headroom. For simplicity, let us neglect the body effect and assume that all of the transistors are identical. Then, the minimum allowable voltage at node $P$ is equal to

$$
\begin{align*}
V_{N}-V_{T H} & =V_{G S 0}+V_{G S 1}-V_{T H}  \tag{5.12}\\
& =\left(V_{G S 0}-V_{T H}\right)+\left(V_{G S 1}-V_{T H}\right)+V_{T H} \tag{5.13}
\end{align*}
$$

i.e., two overdrive voltages plus one threshold voltage. How does this value compare with that in Fig. 5.12(a) if $V_{b}$ could be chosen more arbitrarily? As shown in Fig. 5.14(a), $V_{b}$ could be so low
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-141.jpg?height=490&width=1105&top_left_y=1717&top_left_x=405)

Figure 5.14 (a) Cascode current source with minimum headroom voltage; (b) headroom consumed by a cascode mirror.
$\left(=V_{G S 3}+V_{G S 2}-V_{T H 2}\right)$ that the minimum allowable voltage at $P$ is merely two overdrive voltages. Thus, the cascode mirror of Fig. 5.12(c) "wastes" one threshold voltage in the headroom. This is because $V_{D S 2}=V_{G S 2}$, whereas $V_{D S 2}$ could be as low as $V_{G S 2}-V_{T H}$ while maintaining $M_{2}$ in saturation.

Figure 5.14 summarizes our discussion. In Fig. 5.14(a), $V_{b}$ is chosen to allow the lowest possible value of $V_{P}$, but the output current does not accurately track $I_{R E F}$ because $M_{1}$ and $M_{2}$ sustain unequal drain-source voltages. In Fig. 5.14(b), a higher accuracy is achieved, but the minimum level at $P$ is higher by one threshold voltage.

Before resolving this issue, it is instructive to examine the large-signal behavior of a cascode current source.

#### Example 5.4

In Fig. 5.15(a), assume that all of the transistors are identical and sketch $I_{X}$ and $V_{B}$ as $V_{X}$ drops from a large positive value.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-142.jpg?height=485&width=1489&top_left_y=823&top_left_x=280)

Figure 5.15

#### Solution

For $V_{X} \geq V_{N}-V_{T H}$, both $M_{2}$ and $M_{3}$ are in saturation, $I_{X}=I_{R E F}$ and $V_{B}=V_{A}$. As $V_{X}$ drops, which transistor enters the triode region first, $M_{3}$ or $M_{2}$ ? Suppose $M_{2}$ enters the triode region before $M_{3}$ does. For this to occur, $V_{D S 2}$ must drop and, since $V_{G S 2}$ is constant, so must $I_{D 2}$. This means that $V_{G S 3}$ increases while $I_{D 3}$ decreases, which is not possible if $M_{3}$ is still in saturation. Thus, $M_{3}$ enters the triode region first.

As $V_{X}$ falls below $V_{N}-V_{T H}, M_{3}$ enters the triode region, requiring a greater gate-source overdrive to carry the same current. Thus, as shown in Fig. 5.15 (b), $V_{B}$ begins to drop, causing $I_{D 2}$ and hence $I_{X}$ to decrease slightly. As $V_{X}$ and $V_{B}$ decrease further, eventually we have $V_{B}<V_{A}-V_{T H}$, and $M_{2}$ enters the triode region. At this point, $I_{D 2}$ begins to drop sharply. For $V_{X}=0, I_{X}=0$, and $M_{2}$ and $M_{3}$ operate in the deep triode region. Note that as $V_{X}$ drops below $V_{N}-V_{T H 3}$, the output impedance of the cascode falls rapidly because $g_{m 3}$ degrades in the triode region.

Second Approach In order to avoid the $V_{T H}$ penalty in the voltage headroom of the above cascode current source, we force $V_{D S 1}$ to be equal to $V_{D S 2}$ instead. To understand this principle, we return to Fig. 5.14(a) and recognize that the $V_{T H}$ headroom consumption is eliminated only if $V_{b}=V_{G S 3}+\left(V_{G S 2}-\right.$ $V_{T H 2}$ ), i.e., only if $V_{D S 2}$ is around one overdrive voltage. How can we then ensure that $V_{D S 1}=V_{D S 2}$ $\left(=V_{G S 2}-V_{T H 2}\right)$ ? Since $M_{1}$ is a diode-connected device, it appears impossible to expect a $V_{D S 1}$ less than one threshold.

A simple escape from the foregoing quandary is to create a deliberate voltage difference between the gate and drain of $M_{1}$ by a means of a resistor. Illustrated in Fig. 5.16(a), the idea is to choose $R_{1} I_{R E F} \approx V_{T H 1}$ and $V_{b}=V_{G S 3}+\left(V_{G S 1}-V_{T H 1}\right)$. Now, $V_{D S 1}=V_{G S 1}-R_{1} I_{R E F} \approx V_{G S 1}-V_{T H 1}$, which is equal to $V_{b}-V_{G S 3}$ and hence to $V_{D S 2}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-143.jpg?height=524&width=1079&top_left_y=240&top_left_x=426)

Figure 5.16 (a) Use of IR drop to improve accuracy of current mirror, (b) generation of $V_{b}$, and (c) alternative generation of $V_{b}$.

#### Example 5.5

Is the $M_{1}-R_{1}$ combination in Fig. 5.16(a) a diode-connected device? Assume $\lambda>0$.

#### Solution

From the small-signal equivalent shown in Fig. 5.17, we express the voltage drop across $R_{1}$ as $I_{X} R_{1}$ and write a KCL at the drain node:

$$
\begin{equation*}
\frac{V_{X}-I_{X} R_{1}}{r_{O}}+g_{m} V_{X}=I_{X} \tag{5.14}
\end{equation*}
$$

It follows that
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-143.jpg?height=322&width=579&top_left_y=1294&top_left_x=415)

Figure 5.17

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{1}+r_{O}}{1+g_{m} r_{O}} \tag{5.15}
\end{equation*}
$$

which reduces to $1 / g_{m}$ in the absence of channel-length modulation. (Is it a coincidence that this impedance is the same as that seen at the source of a common-gate stage with $\gamma=0$ ?!) Thus, from a small-signal point of view, the combination is close to a diode-connected device. From a large-signal point of view, $V_{G S 1} \approx \sqrt{2 I_{D} /\left[\mu_{n} C_{o x}(W / L)\right]}+$ $V_{T H}$ if $\lambda$ is small, suggesting diode-connected operation as well.

The circuit of Fig. 5.16(a) entails two issues. First, in the presence of PVT variations, it may be difficult to guarantee that $R_{1} I_{R E F} \approx V_{T H 1}$ as $R_{1}$ and $V_{T H}$ may vary differently. Second, the generation of $V_{b}=V_{G S 3}+\left(V_{G S 1}-V_{T H 1}\right)$ is not straightforward. Let us address the latter issue first. We seek an arrangement that adds one gate-source voltage to an overdrive, surmising that we must begin with a diodeconnected device. We consider the branch shown in Fig. 5.16(b) as a candidate and write $V_{b}=V_{G S 5}+R_{6} I_{6}$. We can readily choose $I_{6}$ and the dimensions of $M_{5}$ to ensure that $V_{G S 5}=V_{G S 3}$. However, the condition $R_{6} I_{6}=V_{G S 1}-V_{T H 1}=V_{G S 1}-R_{1} I_{R E F}$ translates to $R_{6} I_{6}+R_{1} I_{R E F}=V_{G S 1}$, which is difficult to meet
because the $I R$ products do not "track" the MOS gate-source voltage. For example, the value of the resistors may fall with temperature while $V_{G S}$ may rise.

Depicted in Fig. 5.16(c) is another example, where $M_{5}$ establishes the $V_{G S}$, and $M_{6}$ and $R_{6}$ the overdrive. We select $I_{6}$ and the device parameters such that

$$
\begin{align*}
& V_{G S 5}=V_{G S 3}  \tag{5.16}\\
& V_{G S 6}-R_{6} I_{6}=V_{G S 1}-V_{T H 1}  \tag{5.17}\\
& =V_{G S 1}-R_{1} I_{R E F} \tag{5.18}
\end{align*}
$$

observing that it is now possible to ensure that $V_{G S 6}$ and $V_{G S 1}$ track each other, and so do $R_{1} I_{R E F}$ and $R_{6} I_{6}$. For example, we may simply choose $I_{6}=I_{R E F}, R_{6}=R_{1}$, and $(W / L)_{6}=(W / L)_{1} .{ }^{2}$

To avoid the first issue mentioned above, we develop another circuit topology that forces the $V_{D S}$ of the diode-connected device to be equal to the $V_{D S}$ of the current source transistor. The level shift between the gate and drain voltages need not be created by a resistor. In particular, suppose we tie the output node of a cascode topology to its input [Fig. 5.18(a)]. In this case, $V_{D S 1}=V_{b}-V_{G S 0}$, and $V_{b}$ can be chosen to place $M_{1}$ at the edge of saturation. We now connect this branch to the main cascode current source as shown in Fig. 5.18(b), recognizing that $V_{D S 1}$ is forced to be equal to $V_{D S 2}$ if $V_{G S 0}=V_{G S 3}$. Called a "low-voltage cascode," this configuration finds wider usage than the regular cascode shown in Fig. 5.14(b).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-144.jpg?height=432&width=275&top_left_y=1121&top_left_x=651)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-144.jpg?height=428&width=393&top_left_y=1123&top_left_x=1023)
(b)

Figure 5.18 Modification of cascode mirror for low-voltage operation.

We must now answer two questions. First, how do we choose $V_{b}$ in Fig. 5.18(a) so that both $M_{1}$ and $M_{0}$ are in saturation? We must have $V_{b}-V_{T H 0} \leq V_{X}\left(=V_{G S 1}\right)$ for $M_{0}$ to be saturated and $V_{G S 1}-V_{T H 1} \leq V_{A}$ $\left(=V_{b}-V_{G S 0}\right)$ for $M_{1}$ to be saturated. Thus,

$$
\begin{equation*}
V_{G S 0}+\left(V_{G S 1}-V_{T H 1}\right) \leq V_{b} \leq V_{G S 1}+V_{T H 0} \tag{5.19}
\end{equation*}
$$

A solution exists if $V_{G S 0}+\left(V_{G S 1}-V_{T H 1}\right)<V_{G S 1}+V_{T H 0}$, i.e., if $V_{G S 0}-V_{T H 0}<V_{T H 1}$. We must therefore size $M_{0}$ to ensure that its overdrive is well below $V_{T H 1}$.

The second question is how to generate $V_{b}$. For minimal voltage headroom consumption, $V_{A}=V_{G S 1}-V_{T H 1}$, and hence $V_{b}$ must be equal to (or slightly greater than) $V_{G S 0}+\left(V_{G S 1}-V_{T H 1}\right)$. Figure 5.19(a) depicts an example where $M_{5}$ generates $V_{G S 5} \approx V_{G S 0}$ and $M_{6}$ together with $R_{b}$

[^22]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-145.jpg?height=536&width=1002&top_left_y=229&top_left_x=421)

Figure 5.19 Generation of gate voltage $V_{b}$ for cascode mirrors.
produces $V_{D S 6}=V_{G S 6}-R_{b} I_{1} \approx V_{G S 1}-V_{T H 1}$. Some inaccuracy nevertheless arises because $M_{5}$ does not suffer from body effect whereas $M_{0}$ does. Also, the magnitude of $R_{b} I_{1}$ is not well-controlled.

A simpler alternative is shown in Fig. 5.19(b), where the diode-connected transistor $M_{7}$ provides the necessary $V_{G S}$ and $M_{6}$ creates a $V_{D S}$ equal to the required overdrive.

#### Example 5.6

Shown in Fig. 5.20(a) is a differential pair along with its bias network. In this particular design, the voltage headroom is too small to allow the use of a cascode current source. Devise a method to reduce the current mirror error due to channel-length modulation.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-145.jpg?height=508&width=1036&top_left_y=1285&top_left_x=440)

Figure 5.20

#### Solution

Since the limited headroom does not allow us to make $V_{D S 2}$ equal to $V_{D S 1}$, we seek to make $V_{D S 1}$ equal to $V_{D S 2}$. As exemplified by Fig. 5.16(a), we can simply insert a resistor in series with the drain of $M_{1}$ and select the voltage drop across it such that $V_{D S 1}=V_{D S 2}$. However, if variations in the circuit preceding the differential pair change the common-mode level at $A$ and $B$, then $V_{D S 1} \neq V_{D S 2}$. We must therefore force the voltage at node $P$ upon the drain of $M_{1}$. Let us replicate the differential pair and insert the replica as shown in Fig. 5.20(b). Now, the voltages at $P^{\prime}$ and $P$ track even if the CM level at $A$ and $B$ varies. To ensure that $V_{P^{\prime}}=V_{P}$, the two differential pairs must incorporate the same lengths and scale their widths according to $W_{r} / W_{d}=I_{R E F} / I_{S S}$. Of course, if the CM level at $A$ and $B$ rises excessively, the replica transistors enter the triode region, introducing some error.

Example 5.7
Figure 5.21(a) shows an alternative current mirror exhibiting a high output impedance. Study the small-signal and large-signal properties of the circuit.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-146.jpg?height=370&width=449&top_left_y=427&top_left_x=431)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-146.jpg?height=364&width=683&top_left_y=430&top_left_x=939)
(b)

Figure 5.21

#### Nanometer Design Notes

Owing to severe channel-length modulation in nanometer devices, even the cascode current mirror may exhibit substantial mismatches. We choose $W / L=$ $5 \mu \mathrm{~m} / 40 \mathrm{~nm}$ for the devices in the circuit shown below and $I_{\text {REF }}=0.25 \mathrm{~mA}$. As $V_{X}$ is swept from low to high values, we observe that $I_{X}$ still varies noticeably even though all transistors are in saturation for $0.4 \mathrm{~V}<V_{X}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-146.jpg?height=212&width=238&top_left_y=1346&top_left_x=278)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-146.jpg?height=385&width=511&top_left_y=1570&top_left_x=139)

#### Solution

In this circuit, $M_{3}$ raises the output impedance by sensing the voltage change at node $X$ and adjusting the voltage at node $N$. For example, suppose $V_{X}$ rises by $\Delta V$ and tends to increase $I_{D 1}$ by $\Delta V / r_{O 1}$. Transistor $M_{3}$ then draws a current change of $g_{m 3} \Delta V$ from node $N$, causing $V_{N}$ to fall by approximately $g_{m 3} \Delta V / g_{m 2}$ and $I_{D 1}$ to decrease by $\left(g_{m 3} \Delta V / g_{m 2}\right) g_{m 1}$. In other words, if we choose $g_{m 3} g_{m 1} / g_{m 2} \approx r_{O 1}^{-1}$, the net change in $I_{D 1}$ is small.

The circuit displays interesting large-signal properties. Let us sweep $V_{X}$ from 0 to a high value and examine $I_{D 1}$. At $V_{X}=0, M_{1}$ operates in the deep triode region, carrying a zero current, and $M_{3}$ is off. As $V_{X}$ rises, so does $I_{D 1}$ proportionally, up to $V_{X}=V_{G S 1}-V_{T H 1}$. Beyond this point, $I_{D 1}$ varies more gradually [Fig. 5.21(b)]. If $V_{X}$ exceeds $V_{T H 3}, M_{3}$ turns on and begins to "regulate" $I_{D 1}$, creating a higher output impedance. However, for a sufficiently large $V_{X}, M_{3}$ absorbs all of $I_{R E F}$ and turns $M_{1}$ off.

While providing a high output impedance without a cascode device, the above circuit does pose its own voltage headroom limitation, i.e., $V_{X}$ must exceed $V_{T H 3}\left(>V_{D S, s a t}\right)$.

## 5.3 ■ Active Current Mirrors

As mentioned earlier and exemplified by the circuit of Fig. 5.11, current mirrors can also process signals, i.e., operate as "active" elements. Particularly useful is a type of mirror topology used in conjunction with differential pairs. In this section, we study this circuit and its properties. Shown in Fig. 5.22 and sometimes called a five-transistor "operational transconductance amplifier" (OTA), this topology finds application in many analog and digital systems and merits a detailed study here. Note that the output is single-ended; hence the circuit is sometimes used to convert differential signals to a single-ended output. We analyze a simpler topology with passive load before studying the OTA.

Differential Pair with Passive Load To generate a single-ended output, we may simply discard one output of a differential pair as shown in Fig. 5.23(a). Here, a current source in a "passive " mirror arrangement serves as the load. What is the small-signal gain, $A_{v}=V_{\text {out }} / V_{\text {in }}$, of this circuit? We
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-147.jpg?height=1143&width=1292&top_left_y=238&top_left_x=320)

Figure 5.23 (a) Differential pair with current-source load; (b) circuit for calculation of $G_{m}$; (c) circuit for calculation of $R_{\text {out }}$.
calculate $A_{v}$ using two different approaches, assuming $\gamma=0$ for simplicity. Owing to the asymmetry, the half-circuit concept cannot be applied directly here.

Writing $\left|A_{v}\right|=G_{m} R_{\text {out }}$, we must compute the short-circuit transconductance, $G_{m}$, and the output resistance, $R_{\text {out }}$. We recognize from Fig. $5.23(\mathrm{~b})$ that $M_{1}$ and $M_{2}$ become symmetric when the output is shorted to ac ground. Thus, $G_{m}=I_{o u t} / V_{i n}=\left(g_{m 1} V_{i n} / 2\right) / V_{i n}=g_{m 1} / 2$. As illustrated in Fig. 5.23(c), for the $R_{\text {out }}$ calculation, $M_{2}$ is degenerated by the source output impedance of $M_{1}, R_{d e g}=\left(1 / g_{m 1}\right) \| r_{O 1}$, thereby exhibiting an output impedance equal to $\left(1+g_{m 2} r_{O 2}\right) R_{d e g}+r_{O 2} a \approx 2 r_{O 2}$. It follows that $R_{\text {out }}=\left(2 r_{O 2}\right) \| r_{O 4}$, and

$$
\begin{equation*}
\left|A_{v}\right|=\frac{g_{m 1}}{2}\left[\left(2 r_{O 2}\right) \| r_{O 4}\right] \tag{5.20}
\end{equation*}
$$

Interestingly, if $r_{O 4} \rightarrow \infty$, then $A_{v} \rightarrow-g_{m 1} r_{O 2}$.
In our second approach, we calculate $V_{P} / V_{\text {in }}$ and $V_{\text {out }} / V_{P}$ in Fig. 5.23(a) and multiply the results to obtain $V_{\text {out }} / V_{\text {in }}$. With the aid of Fig. 5.24 and viewing $M_{1}$ as a source follower, we write

$$
\begin{equation*}
\frac{V_{P}}{V_{i n}}=\frac{R_{e q} \| r_{O 1}}{R_{e q} \| r_{O 1}+\frac{1}{g_{m 1}}} \tag{5.21}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-148.jpg?height=406&width=511&top_left_y=245&top_left_x=513)

Figure 5.24 Circuit for calculation of $V_{P} / V_{\text {in }}$.
where $R_{e q}$ denotes the resistance seen looking into the source of $M_{2}$. Since the drain of $M_{2}$ is terminated by a relatively large resistance, $r_{O 4}$, the value of $R_{e q}$ must be obtained from Eq. (3.117):

$$
\begin{equation*}
R_{e q}=\frac{r_{O 2}+r_{O 4}}{1+g_{m 2} r_{O 2}} \tag{5.22}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
\frac{V_{P}}{V_{i n}}=\frac{g_{m 1} r_{O 1}\left(r_{O 2}+r_{O 4}\right)}{\left(1+g_{m 1} r_{O 1}\right)\left(r_{O 2}+r_{O 4}\right)+\left(1+g_{m 2} r_{O 2}\right) r_{O 1}} \tag{5.23}
\end{equation*}
$$

We now calculate $V_{\text {out }} / V_{P}$. From Fig. 5.25,

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{P}}=\frac{\left(1+g_{m 2} r_{O 2}\right) r_{O 4}}{r_{O 2}+r_{O 4}} \tag{5.24}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-148.jpg?height=460&width=313&top_left_y=1340&top_left_x=612)

Figure 5.25 Circuit for calculation of $V_{\text {out }} / V_{P}$.

From (5.23) and (5.24), we have

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}} & =\frac{g_{m 2} r_{O 2} r_{O 4}}{2 r_{O 2}+r_{O 4}}  \tag{5.25}\\
& =\frac{g_{m 2}}{2}\left[\left(2 r_{O 2}\right) \| r_{O 4}\right] \tag{5.26}
\end{align*}
$$

Differential Pair with Active Load In the circuit of Fig. 5.23(a), the small-signal drain current of $M_{1}$ is "wasted." As conceptually shown in Fig. 5.26(a), it is desirable to utilize this current with proper polarity at the output. This can be accomplished by the five-transistor OTA shown in Fig. 5.26(b), where $M_{3}$ and $M_{4}$ are identical and operate as an active current mirror.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-149.jpg?height=506&width=1461&top_left_y=239&top_left_x=235)

Figure 5.26 (a) Concept of combining the drain currents of $M_{1}$ and $M_{2}$, (b) realization of (a), and (c) response of the circuit to differential inputs.

To see how $M_{3}$ enhances the gain, suppose the gate voltages of $M_{1}$ and $M_{2}$ change by equal and opposite amounts [Fig. 5.26(c)]. Consequently, $I_{D 1}$ increases, $V_{F}$ falls, and $I_{D 2}$ decreases. Thus, the output voltage rises by means of two mechanisms: $M_{2}$ draws less current from $X$ to ground and $M_{4}$ pushes a greater current from $V_{D D}$ to $X$. By contrast, in the circuit of Fig. 5.23(a), $M_{4}$ plays no active role in changing $V_{\text {out }}$ because its gate voltage is constant. The five-transistor OTA is also called a differential pair with active load.

### 5.3.1 Large-Signal Analysis

Let us study the large-signal behavior of the five-transistor OTA. To this end, we replace the ideal tail current source by a MOSFET as shown in Fig. 5.27(a). If $V_{i n 1}$ is much more negative than $V_{i n 2}, M_{1}$ is off, and so are $M_{3}$ and $M_{4}$. Since no current can flow from $V_{D D}$, both $M_{2}$ and $M_{5}$ operate in the deep triode region, carrying zero current. Thus, $V_{\text {out }}=0 .{ }^{3}$ As $V_{i n 1}$ approaches $V_{i n 2}, M_{1}$ turns on, drawing a fraction of $I_{D 5}$ from $M_{3}$ and turning $M_{4}$ on. The output voltage then depends on the difference between $I_{D 4}$ and $I_{D 2}$. For a small difference between $V_{i n 1}$ and $V_{i n 2}$, both $M_{2}$ and $M_{4}$ are saturated, providing a high gain [Fig. 5.27(b)]. As $V_{i n 1}$ becomes more positive than $V_{i n 2}, I_{D 1},\left|I_{D 3}\right|$, and $\left|I_{D 4}\right|$ increase and $I_{D 2}$ decreases, allowing $V_{\text {out }}$ to rise and eventually driving $M_{4}$ into the triode region. If $V_{i n 1}-V_{i n 2}$ is sufficiently large, $M_{2}$ turns off, $M_{4}$ operates in the deep triode region with zero current, and $V_{\text {out }}=V_{D D}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-149.jpg?height=544&width=1105&top_left_y=1631&top_left_x=416)

Figure 5.27 (a) Differential pair with active current mirror and realistic current source; (b) large-signal input-output characteristic.

[^23]Note that if $V_{i n 1}>V_{F}+V_{T H}$, then $M_{1}$ enters the triode region. Also, $V_{\text {out }}$ is in-phase with respect to $V_{i n 1}$ but $180^{\circ}$ out of phase with respect to $V_{i n 2}$.

The choice of the input common-mode voltage of the circuit is also important. For $M_{2}$ to be saturated, the output voltage cannot be less than $V_{i n, C M}-V_{T H}$. Thus, to allow maximum output swings, the input CM level must be as low as possible, with the minimum given by $V_{G S 1,2}+V_{D S 5, \min }$. The constraint imposed by the input CM level upon the output swing in this circuit is a critical drawback.

What is the output voltage of the circuit when $V_{\text {in1 }}=V_{\text {in } 2}$ ? With perfect symmetry, $V_{\text {out }}=V_{F}=$ $V_{D D}-\left|V_{G S 3}\right|$. This can be proved by contradiction as well. Suppose, for example, that $V_{\text {out }}<V_{F}$. Then, due to channel-length modulation, $M_{1}$ must carry a greater current than $M_{2}$ (and $M_{4}$ a greater current than $M_{3}$ ). In other words, the total current through $M_{1}$ is greater than half of $I_{S S}$. But this means that the total current through $M_{3}$ also exceeds $I_{S S} / 2$, violating the assumption that $M_{4}$ carries more current than $M_{3}$. In reality, however, asymmetries in the circuit may result in a large deviation in $V_{\text {out }}$, possibly driving $M_{2}$ or $M_{4}$ into the triode region. For example, if the threshold voltage of $M_{2}$ is slightly smaller than that of $M_{1}$, the former carries a greater current than the latter even with $V_{i n 1}=V_{i n 2}$, causing $V_{\text {out }}$ to drop significantly. For this reason, the circuit is rarely used in an open-loop configuration to amplify small signals. Nonetheless, the open-loop OTA proves useful as a differential to a single-ended converter for large swings, as illustrated by the following example.

#### Example 5.8

Some digital circuits operate with differential (complementary) signals having voltage swings less than $V_{D D}$. For example, the single-ended swing can be $300 \mathrm{mV}_{p p}$. Explain how a five-transistor OTA can convert the moderate-swing differential signals to a single-ended rail-to-rail signal.

#### Solution

Consider the OTA shown in Fig. 5.28, where $M_{1}$ and $M_{2}$ sense swings equal to $V_{2}-V_{1}=300 \mathrm{mV}$. With proper choice of $(W / L)_{1,2}$ and $I_{S S}$, we can guarantee that such a swing turns off one side. For example, if $M_{1}$ carries all of $I_{S S}$, then $M_{2}$ remains off, allowing $M_{4}$ to pull $V_{\text {out }}$ to $V_{D D}$. Conversely, when $M_{2}$ hogs $I_{S S}, M_{1}, M_{2}$, and $M_{4}$ turn off, $M_{2}$ and $M_{5}$ remain on with zero current, and $V_{\text {out }}=0$. The "push-pull" action between $M_{2}$ and $M_{4}$ thus produces rail-to-rail swings at the output.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-150.jpg?height=488&width=598&top_left_y=1431&top_left_x=464)

Figure 5.28
In practice, $V_{\text {out }}$ does not reach exactly $V_{D D}$ or zero if $V_{1}>V_{T H 1,2}$. The proof is left as an exercise for the reader. (Hint: if $M_{2}$ and $M_{5}$ are in the deep triode region, then $V_{P}$ approaches zero, possibly turning on $M_{1}$.) For this reason, the OTA is typically followed by a CMOS inverter to obtain rail-to-rail swings.

#### Example 5.9

Assuming perfect symmetry, sketch the output voltage of the circuit in Fig. 5.29(a) as $V_{D D}$ varies from 3 V to zero. Assume that for $V_{D D}=3 \mathrm{~V}$, all of the devices are saturated.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-151.jpg?height=560&width=1243&top_left_y=240&top_left_x=347)

Figure 5.29

#### Solution

For $V_{D D}=3 \mathrm{~V}$, symmetry requires that $V_{\text {out }}=V_{F}$. As $V_{D D}$ drops, so do $V_{F}$ and $V_{\text {out }}$ with a slope close to unity [Fig. 5.29(b)]. As $V_{F}$ and $V_{\text {out }}$ fall below $+1.5 \mathrm{~V}-V_{T H N}, M_{1}$ and $M_{2}$ enter the triode region, but their drain currents are constant if $M_{5}$ is saturated. Further decrease in $V_{D D}$ and hence $V_{F}$ and $V_{\text {out }}$ causes $V_{G S 1}$ and $V_{G S 2}$ to increase, eventually driving $M_{5}$ into the triode region. Thereafter, the bias current of all of the transistors drops, lowering the rate at which $V_{\text {out }}$ decreases. For $V_{D D}<\left|V_{T H P}\right|$, we have $V_{\text {out }}=0$.

#### Example 5.10

Sketch the large-signal input-output characteristic of the unity-gain buffer shown in Fig. 5.30(a) if the op amp is realized as a five-transistor OTA.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-151.jpg?height=487&width=1425&top_left_y=1416&top_left_x=248)

Figure 5.30

#### Solution

Drawing the circuit as shown in Fig. 5.30(b), we begin with $V_{i n}=0$ and note that $M_{1}, M_{3}$, and $M_{4}$ are off. Thus, $M_{5}$ enters the triode region with zero drain current and the diode-connected device $M_{2}$ sustains a zero $V_{G S} .{ }^{4}$ We therefore have $V_{\text {out }}=V_{P}=0[$ Fig. 5.30 (c) $]$. As $V_{\text {in }}$ rises and exceeds one threshold, $M_{1}$ begins to draw current from $M_{3}$,

[^24]turning $M_{4}$ and hence $M_{2}$ on. Note that, since $I_{D 3} \approx I_{D 4}$, we have $I_{D 1} \approx I_{D 2}$ and $V_{G S 1} \approx V_{G S 2}$. That is, $V_{\text {out }} \approx V_{\text {in }}$. This unity-gain action continues as $V_{i n}$ increases. For a sufficiently high $V_{i n}$, two phenomena occur: (a) $M_{1}$ enters the triode region if $V_{\text {in }}>V_{D D}-\left|V_{G S 3}\right|+V_{T H 1}$, and (b) $M_{4}$ enters the triode region if $V_{\text {out }}>V_{D D}-\left|V_{G S 4}-V_{T H 4}\right|$, and hence $V_{i n}>V_{D D}-\left|V_{G S 4}-V_{T H 4}\right|$. These two values are roughly equal if $V_{T H 1}$ and $\left|V_{T H 4}\right|$ are comparable. Beyond this point, $\left|I_{D 4}\right|<\left|I_{D 3}\right|$ (why?), and hence $V_{G S 1}>V_{G S 2}$, yielding $V_{\text {out }}<V_{i n}$. If $V_{i n}=V_{D D}$, then $M_{4}$ carries little current and $V_{\text {out }}$ incurs substantial error.

#### Nanometer Design Notes

The five-transistor OTA provides a limited gain in nanometer technologies and across a limited output range. With $V_{D D}=1 \mathrm{~V}, W / L=5 \mu / 40 \mathrm{~nm}$, a tail current of 0.25 mA , and input CM level of 0.5 V , we obtain the characteristic shown below. The slope plot also shows the steep drop in the gain as the NMOS or PMOS device tied to the output enters the triode region.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-152.jpg?height=768&width=511&top_left_y=1019&top_left_x=139)

### 5.3.2 Small-Signal Analysis

We now analyze the small-signal properties of the circuit shown in Fig. 5.27(a), assuming $\gamma=0$ for simplicity. Can we apply the half-circuit concept to calculate the differential gain here? As illustrated in Fig. 5.31, with small differential inputs, the voltage swings at nodes $F$ and $X$ are vastly different. This is because the diode-connected device $M_{3}$ yields a much lower voltage gain from the input to node $F$ than that from the input to node $X$. As a result, the effects of $V_{F}$ and $V_{X}$ at node $P$ (through $r_{O 1}$ and $r_{O 2}$, respectively) do not cancel each other, and this node cannot be considered a virtual ground. Using the lemma $\left|A_{v}\right|=G_{m} R_{\text {out }}$, we first perform an approximate analysis so as to develop insight and then carry out an exact calculation of the gain.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-152.jpg?height=524&width=598&top_left_y=1103&top_left_x=682)

Figure 5.31 Asymmetric swings in a differential pair with active current mirror.

Approximate Analysis For the calculation of $G_{m}$, consider Fig. 5.32(a). The circuit is not quite symmetric, but because the impedance seen at node $F$ is relatively low and the swing at this node small, the current returning from $F$ to $P$ through $r_{O 1}$ is negligible, and node $P$ can be approximated by a virtual ground [Fig. 5.32(b)]. Thus, $I_{D 1}=\left|I_{D 3}\right|=\left|I_{D 4}\right|=g_{m 1,2} V_{i n} / 2$ and $I_{D 2}=-g_{m 1,2} V_{i n} / 2$, yielding $I_{\text {out }}=-g_{m 1,2} V_{i n}$, and hence $\left|G_{m}\right|=g_{m 1,2}$. Note that, by virtue of active current mirror operation, this value is twice the transconductance of the circuit of Fig. 5.23(b).

Calculation of $R_{\text {out }}$ is less straightforward. We may surmise that the output resistance of this circuit is equal to that of the circuit in Fig. 5.23(c), namely, $\left(2 r_{O 2}\right) \| r_{O 4}$. In reality, however, the active mirror operation yields a different value because when a voltage is applied to the output to measure $R_{\text {out }}$, the gate voltage of $M_{4}$ does not remain constant. Rather than draw the entire equivalent circuit, we observe that for small signals, $I_{S S}$ is open [Fig. 5.33(a)], any current flowing into $M_{1}$ must flow out of $M_{2}$, and the role of the two transistors can be represented by a resistor $R_{X Y}=2 r_{O 1,2}$ [Fig. 5.33(b)]. As a result, the current drawn from $V_{X}$ by $R_{X Y}$ is mirrored by $M_{3}$ onto $M_{4}$ with unity gain. This current is equal to
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-153.jpg?height=557&width=1256&top_left_y=229&top_left_x=340)

Figure 5.32 (a) Circuit for calculation of $G_{m}$; (b) circuit of (a) with node $P$ grounded.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-153.jpg?height=500&width=1238&top_left_y=836&top_left_x=334)

Figure 5.33 (a) Circuit for calculating $R_{\text {out }}$; (b) substitution of a resistor for $M_{1}$ and $M_{2}$.
$V_{X} /\left[2 r_{O 1,2}+\left(1 / g_{m 3}\right) \| r_{O 3}\right]$. We multiply this current by $\left(1 / g_{m 3}\right) \| r_{O 3}$ to obtain the gate-source voltage of $M_{4}$ and then multiply the result by $g_{m 4}$. It follows that

$$
\begin{equation*}
I_{X}=\frac{V_{X}}{2 r_{O 1,2}+\frac{1}{g_{m 3}} \| r_{O 3}}\left[1+\left(\frac{1}{g_{m 3}} \| r_{O 3}\right) g_{m 4}\right]+\frac{V_{X}}{r_{O 4}} \tag{5.27}
\end{equation*}
$$

For $2 r_{O 1,2} \gg\left(1 / g_{m 3}\right) \| r_{O 3}$, we have

$$
\begin{equation*}
R_{\text {out }} \approx r_{O 2} \| r_{O 4} \tag{5.28}
\end{equation*}
$$

The overall voltage gain is approximately equal to $\left|A_{v}\right|=G_{m} R_{o u t}=g_{m 1,2}\left(r_{O 2} \| r_{O 4}\right)$, somewhat higher than that of the circuit in Fig. 5.23(a).
Exact Analysis We must compute both the $G_{m}$ and $R_{\text {out }}$ of the OTA. Let us determine the $G_{m}$, without grounding node $P$, by solving the equivalent circuit shown in Fig. 5.34. For the sake of brevity, we use the subscript 1 to denote both $M_{1}$ and $M_{2}$. Since the current flowing downward through $\left(1 / g_{m 3}\right) \| r_{O 3}$ (denoted by $r_{d}$ hereafter) is $-V_{4} / r_{d}, r_{O 1}$ sustains a voltage equal to $\left(-V_{4} / r_{d}-g_{m 1} V_{1}\right) r_{O 1}$. Adding this voltage to $V_{P}=V_{i n 1}-V_{1}$, we have

$$
\begin{equation*}
\left(-\frac{V_{4}}{r_{d}}-g_{m 1} V_{1}\right) r_{O 1}+V_{i n 1}-V_{1}=V_{4} \tag{5.29}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-154.jpg?height=398&width=1089&top_left_y=221&top_left_x=490)

Figure 5.34 Equivalent circuit of five-transistor OTA

We also recognize that the sum of $g_{m 2} V_{2}$ and the current flowing through $r_{O 2}$ is equal to $V_{4} / r_{d}$ (why?). That is

$$
\begin{equation*}
g_{m 2} V_{2}-\frac{V_{i n 2}-V_{2}}{r_{O 2}}=\frac{V_{4}}{r_{D}} \tag{5.30}
\end{equation*}
$$

Obtaining $V_{1}$ and $V_{2}$ from these equations in terms of $V_{4}$ and noting that $V_{1}-V_{2}=V_{i n 1}-V_{i n 2}$ and $I_{\text {out }}=g_{m 4} V_{4}+V_{4} / r_{d}$, we arrive at

$$
\begin{equation*}
I_{\text {out }}=-g_{m 1} r_{O 1} \frac{g_{m 4} r_{d}+1}{r_{d}+2 r_{O 1}}\left(V_{i n 1}-V_{i n 2}\right) \tag{5.31}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
G_{m}=-g_{m 1} r_{O 1} \frac{g_{m 4} r_{d}+1}{r_{d}+2 r_{O 1}} \tag{5.32}
\end{equation*}
$$

In the next step, we calculate $R_{\text {out }}$. Let us express the output admittance from Eq. (5.27) as

$$
\begin{align*}
\frac{I_{X}}{V_{X}} & =\frac{1+g_{m 4} r_{d}}{2 r_{O 1}+r_{d}}+\frac{1}{r_{O 4}}  \tag{5.33}\\
& =\frac{\left(1+g_{m 4} r_{d}\right) r_{O 4}+2 r_{O 1}+r_{d}}{\left(2 r_{O 1}+r_{d}\right) r_{O 4}} \tag{5.34}
\end{align*}
$$

and hence

$$
\begin{equation*}
G_{m} R_{o u t}=-g_{m 1} r_{O 1} \frac{\left(g_{m 4} r_{d}+1\right) r_{O 4}}{\left(g_{m 4} r_{d}+1\right) r_{O 4}+2 r_{O 1}+r_{d}} \tag{5.35}
\end{equation*}
$$

Since $r_{d}=r_{O 3} /\left(1+g_{m 3} r_{O 3}\right)$, this expression reduces to

$$
\begin{align*}
G_{m} R_{o u t} & =-g_{m 1} r_{O 1} r_{O 4} \frac{2 g_{m 3} r_{O 3}+1}{\left(2 g_{m 3} r_{O 3}+1\right) r_{O 4}+2 r_{O 1}\left(1+g_{m 3} r_{O 3}\right)+r_{O 3}}  \tag{5.36}\\
& =-\frac{g_{m 1} r_{O 1} r_{O 4}}{r_{O 1}+r_{O 3}} \cdot \frac{2 g_{m 3} r_{O 3}+1}{2\left(g_{m 3} r_{O 3}+1\right)} \tag{5.37}
\end{align*}
$$

We thus obtain a simple but exact expression for the gain:

$$
\begin{equation*}
\left|A_{v}\right|=g_{m 1}\left(r_{O 1}| | r_{O 4}\right) \frac{2 g_{m 4} r_{O 4}+1}{2\left(g_{m 4} r_{O 4}+1\right)} \tag{5.38}
\end{equation*}
$$

We can view this result as our approximate solution, $g_{m 1}\left(r_{O 1} \| r_{O 4}\right)$, multiplied by a "correction" factor that is less than unity. For example, if $g_{m 4} r_{O 4}=5$, then $\left|A_{v}\right|=0.92 g_{m 1}\left(r_{O 1} \| r_{O 4}\right)$.

#### Example 5.11

With the aid of the above results, determine the output response to an input CM change if mismatches are neglected.

#### Solution

To represent an input CM change, we choose $V_{i n 1}=V_{i n 2}$ in Fig. 5.34, obtaining from Eq. (5.31) $I_{o u t}=0$. The single-ended output voltage is therefore free from the input CM change.

#### Example 5.12

Calculate the small-signal voltage gain of the circuit shown in Fig. 5.35. How does the performance of this circuit compare with that of a differential pair with active mirror?
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-155.jpg?height=339&width=301&top_left_y=860&top_left_x=546)

Figure 5.35

#### Solution

We have $A_{v}=g_{m 1}\left(r_{O 1} \| r_{O 2}\right)$, similar to the value derived above. For given device dimensions, this circuit requires half of the bias current to achieve the same gain as a differential pair. However, advantages of differential operation (less sensitivity to CM noise and less distortion) often outweigh the power penalty.

The above calculations of the gain have assumed an ideal tail current source. In reality, the output impedance of this source affects the gain, but the error is relatively small.

Headroom Issues The five-transistor OTA does not easily lend itself to low-voltage operation as the diode-connected PMOS device tends to consume a substantial voltage headroom. To arrive at a modification, we observe that the gate voltage of this device need not be equal to its drain voltage. As shown in Fig. 5.36, we insert a resistor in series with the gate and draw a constant current from it, thereby
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-155.jpg?height=460&width=485&top_left_y=1819&top_left_x=439)

Figure 5.36 OTA headroom improvement by level shift.
allowing $V_{G}$ to be below $V_{F}$ by $R_{1} I_{1} \leq V_{T H 3}$. With this level shift, the input CM level can be higher, easing the design of the preceding stage and the tail current source. The value of $I_{1}$ must be much less than $I_{S S} / 2$ so as to introduce negligible asymmetry between the two sides of the circuit. The reader is encouraged to compute the input-referred offset voltage arising from $I_{1}$.

### 5.3.3 Common-Mode Properties

Let us now study the common-mode properties of the differential pair with active current mirror. We assume $\gamma=0$ for simplicity and leave a more general analysis including body effect for the reader. Our objective is to predict the consequences of a finite output impedance in the tail current source. As depicted in Fig. 5.37, a change in the input CM level leads to a change in the bias current of all of the transistors. How do we define the common-mode gain here? Recall from Chapter 4 that the CM gain represents the corruption of the output signal of interest due to variations in the input CM level. In the circuits of Chapter 3, the output signal was sensed differentially, and hence the CM gain was defined in terms of the output differential component generated by the input CM change. In the circuit of Fig. 5.37, on the other hand, the output signal of interest is sensed with respect to ground. Thus, we define the CM gain in terms of the single-ended output component produced by the input CM change:

$$
\begin{equation*}
A_{C M}=\frac{\Delta V_{\text {out }}}{\Delta V_{\text {in }, C M}} \tag{5.39}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-156.jpg?height=503&width=637&top_left_y=1206&top_left_x=473)

Figure 5.37 Differential pair with active current mirror sensing a common-mode change.

To determine $A_{C M}$, we observe that if the transistors are symmetric, $V_{\text {out }}=V_{F}$ for any input CM level (Section 5.3.1). For example, as $V_{i n, C M}$ increases, $V_{F}$ drops and so does $V_{\text {out }}$. In other words, nodes $F$ and $X$ can be shorted [Fig. 5.38(a)], resulting in the equivalent circuit shown in Fig. 5.38(b). Here, $M_{1}$ and $M_{2}$ appear in parallel and so do $M_{3}$ and $M_{4}$. It follows that

$$
\begin{align*}
A_{C M} & \approx \frac{-\frac{1}{2 g_{m 3,4}} \| \frac{r_{O 3,4}}{2}}{\frac{1}{2 g_{m 1,2}}+R_{S S}}  \tag{5.40}\\
& =\frac{-1}{1+2 g_{m 1,2} R_{S S}} \frac{g_{m 1,2}}{g_{m 3,4}} \tag{5.41}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-157.jpg?height=582&width=1096&top_left_y=234&top_left_x=423)

Figure 5.38 (a) Simplified circuit of Fig. 5.37; (b) equivalent circuit of (a).
where we have assumed that $1 /\left(2 g_{m 3,4}\right) \ll r_{O 3,4}$ and neglected the effect of $r_{O 1,2} / 2$. The CMRR is then given by

$$
\begin{align*}
\mathrm{CMRR} & =\left|\frac{A_{D M}}{A_{C M}}\right|  \tag{5.42}\\
& =g_{m 1,2}\left(r_{O 1,2} \| r_{O 3,4}\right) \frac{g_{m 3,4}\left(1+2 g_{m 1,2} R_{S S}\right)}{g_{m 1,2}}  \tag{5.43}\\
& =\left(1+2 g_{m 1,2} R_{S S}\right) g_{m 3,4}\left(r_{O 1,2} \| r_{O 3,4}\right) \tag{5.44}
\end{align*}
$$

For example, if $R_{S S}=r_{O}$ and $2 g_{m 1,2} r_{O} \gg 1$, then CMRR is on the order of $\left(g_{m} r_{O}\right)^{2}$.
Equation (5.41) indicates that, even with perfect symmetry, the output signal is corrupted by input CM variations. High-frequency common-mode noise therefore degrades the performance considerably as the capacitance shunting the tail current source exhibits a lower impedance.

#### Example 5.13

The CM gain of the circuit of Fig. 5.37 can be shown to be zero by a (flawed) argument. As shown in Fig. 5.39(a), if $V_{i n, C M}$ introduces a change of $\Delta I$ in the drain current of each input transistor, then $I_{D 3}$ also experiences the same change, and so does $I_{D 4}$. Thus, $M_{4}$ seemingly provides the additional current required by $M_{2}$, and the output voltage need not change, i.e., $A_{C M}=0$. Explain the flaw in this proof.

#### Solution

The assumption that $\Delta I_{D 4}$ completely cancels the effect of $\Delta I_{D 2}$ is incorrect. Consider the equivalent circuit shown in Fig. 5.39(b). Since

$$
\begin{equation*}
\Delta V_{F}=\Delta I_{1}\left(\frac{1}{g_{m 3}} \| r_{O 3}\right) \tag{5.45}
\end{equation*}
$$

we have

$$
\begin{align*}
\left|\Delta I_{D 4}\right| & =g_{m 4} \Delta V_{F}  \tag{5.46}\\
& =g_{m 4} \Delta I_{1} \frac{r_{O 3}}{1+g_{m 3} r_{O 3}} \tag{5.47}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-158.jpg?height=636&width=1187&top_left_y=243&top_left_x=446)

This current and $\Delta I_{2}\left(=\Delta I_{1}=\Delta I\right)$ give a net voltage change equal to

$$
\begin{align*}
\Delta V_{\text {out }} & =\left(\Delta I_{1} g_{m 4} \frac{r_{O 3}}{1+g_{m 3} r_{O 3}}-\Delta I_{2}\right) r_{O 4}  \tag{5.48}\\
& =-\Delta I \frac{1}{g_{m 3} r_{O 3}+1} r_{O 4} \tag{5.49}
\end{align*}
$$

which is equal to the voltage change at node $F$.

Effect of Mismatches It is also instructive to calculate the common-mode gain in the presence of mismatches. As an example, we consider the case where the input transistors exhibit slightly different transconductances [Fig. 5.40(a)]. How does $V_{\text {out }}$ depend on $V_{i n, C M}$ ? Since the change at nodes $F$ and $X$ is relatively small, we can compute the change in $I_{D 1}$ and $I_{D 2}$ while neglecting the effect of $r_{O 1}$ and $r_{O 2}$. As shown in Fig. 5.40(b), the voltage change at $P$ can be obtained by considering $M_{1}$ and $M_{2}$ as a single transistor (in a source follower configuration) with a transconductance equal to $g_{m 1}+g_{m 2}$, i.e.,

$$
\begin{equation*}
\Delta V_{P}=\Delta V_{i n, C M} \frac{R_{S S}}{R_{S S}+\frac{1}{g_{m 1}+g_{m 2}}} \tag{5.50}
\end{equation*}
$$

where body effect is neglected. The changes in the drain currents of $M_{1}$ and $M_{2}$ are therefore given by

$$
\begin{align*}
\Delta I_{D 1} & =g_{m 1}\left(\Delta V_{i n, C M}-\Delta V_{P}\right)  \tag{5.51}\\
& =\frac{\Delta V_{i n, C M}}{R_{S S}+\frac{1}{g_{m 1}+g_{m 2}}} \frac{g_{m 1}}{g_{m 1}+g_{m 2}}  \tag{5.52}\\
\Delta I_{D 2} & =g_{m 2}\left(\Delta V_{i n, C M}-\Delta V_{P}\right)  \tag{5.53}\\
& =\frac{\Delta V_{i n, C M}}{R_{S S}+\frac{1}{g_{m 1}+g_{m 2}}} \frac{g_{m 2}}{g_{m 1}+g_{m 2}} \tag{5.54}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-159.jpg?height=592&width=1166&top_left_y=242&top_left_x=385)

Figure 5.40 Differential pair with $g_{m}$ mismatch.

The change $\Delta I_{D 1}$ multiplied by $\left(1 / g_{m 3}\right) \| r_{O 3}$ yields $\left|\Delta I_{D 4}\right|=g_{m 4}\left[\left(1 / g_{m 3}\right) \| r_{O 3}\right] \Delta I_{D 1}$. The difference between this current and $\Delta I_{D 2}$ flows through the output impedance of the circuit, which is equal to $r_{O 4}$ because we have neglected the effect of $r_{O 1}$ and $r_{O 2}$ :

$$
\begin{align*}
\Delta V_{\text {out }} & =\left[\frac{g_{m 1} \Delta V_{\text {in,CM }}}{1+\left(g_{m 1}+g_{m 2}\right) R_{S S}} \frac{r_{O 3}}{r_{O 3}+\frac{1}{g_{m 3}}}-\frac{g_{m 2} \Delta V_{i n, C M}}{1+\left(g_{m 1}+g_{m 2}\right) R_{S S}}\right] r_{O 4}  \tag{5.55}\\
& =\frac{\Delta V_{i n, C M}}{1+\left(g_{m 1}+g_{m 2}\right) R_{S S}} \frac{\left(g_{m 1}-g_{m 2}\right) r_{O 3}-g_{m 2} / g_{m 3}}{r_{O 3}+\frac{1}{g_{m 3}}} r_{O 4} \tag{5.56}
\end{align*}
$$

If $r_{O 3} \gg 1 / g_{m 3}$, we have

$$
\begin{equation*}
\frac{\Delta V_{\text {out }}}{\Delta V_{\text {in }, C M}} \approx \frac{\left(g_{m 1}-g_{m 2}\right) r_{O 3}-g_{m 2} / g_{m 3}}{1+\left(g_{m 1}+g_{m 2}\right) R_{S S}} \tag{5.57}
\end{equation*}
$$

Compared to Eq. (5.41), this result contains the additional term $\left(g_{m 1}-g_{m 2}\right) r_{O 3}$ in the numerator, revealing the effect of transconductance mismatch on the common-mode gain.

### 5.3.4 Other Properties of Five-Transistor OTA

The five-transistor OTA suffers from two drawbacks with respect to the fully-differential topologies studied in Chapter 4. First, the circuit exhibits a finite CMRR even with perfectly-matched transistors. As depicted in Fig. 5.41(a), an input CM change directly corrupts $V_{\text {out }}$ in this OTA, but not the differential output in the fully-differential version [Fig. 5.41(b)].

Second, the supply rejection of this OTA is inferior. To understand this point, let us tie the inputs to a constant voltage and change $V_{D D}$ by a small amount, $\Delta V_{D D}$ [Fig. 5.42(a)]. How much does $V_{F}$ change? Viewing $M_{1}$ as a constant current source with a high output impedance, we recognize that $V_{G S 3}$ must remain relatively constant. That is, $\Delta V_{F} \approx \Delta V_{D D}$. With symmetric transistors, $V_{\text {out }}$ must also change by $\Delta V_{D D}$. In other words, the gain from $V_{D D}$ to $V_{\text {out }}$ is about unity.

Now consider the fully-differential topology in Fig. 5.42(b), where the PMOS current sources are biased by a current mirror arrangement. How do $V_{X}$ and $V_{Y}$ change here in response to a supply change
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-160.jpg?height=536&width=1287&top_left_y=239&top_left_x=437)

Figure 5.41 Input CM response of (a) five-transistor OTA and (b) fully-differential amplifier with current-source loads.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-160.jpg?height=592&width=1471&top_left_y=923&top_left_x=289)

Figure 5.42 (a) OTA with supply step, (b) fully-differential circuit with supply step, and (c) equivalent circuit of (b).
of $\Delta V_{D D}$ ? We note that $V_{G S 5}$ and hence $V_{G S 3}$ and $V_{G S 4}$ are constant, and, by virtue of symmetry, $V_{X}$ and $V_{Y}$ must change by equal amounts. We thus short $X$ and $Y$ and merge $M_{3}$ with $M_{4}$ and $M_{1}$ with $M_{2}$ [Fig. 5.42(c)]. If the output impedance of the cascode circuit consisting of $M_{1}+M_{2}$ and $I_{S S}$ is very high, then $\Delta V_{X}=\Delta V_{Y} \approx \Delta V_{D D}$ (why?). In this case, too, the output voltages change by $\Delta V_{D D}$, but their difference remains intact. We should caution the reader that this circuit requires common-mode feedback (Chapter 9).

## 5.4 ■ Biasing Techniques

The amplifier stages studied thus far must be properly biased so that, in the absence of the input signal, each transistor carries the required current and sustains the necessary terminal voltages. We recognize that the current establishes the transconductance and output resistance of the transistor while the terminal voltages determine the headroom and hence the allowable voltage swings. In this section, we consider a number of biasing techniques for CMOS circuits.

### 5.4.1 CS Biasing

Simple CS Stage We wish to create a certain drain current and desired $V_{G S}$ and $V_{D S}$ for a transistor in a CS configuration. Using the transistor's $I / V$ characteristics, we have determined its dimensions and must now tie the gate to a proper bias voltage [Fig. 5.43(a)]. But how do we ensure that $V_{B}$ does not "fight" $V_{i n}$ ? One solution is to couple $V_{i n}$ capacitively and establish a high impedance for $V_{B}$ so that $X$ has the same dc voltage as $V_{B}$ and the same signal voltage as $V_{i n}$ [Fig. 5.43(b)]. Noting that $C_{B}$ and $R_{B}$ form a high-pass filter, we select $1 /\left(2 \pi R_{B} C_{B}\right)$ lower than the lowest input frequency so that the ac gain from $V_{i n}$ to $V_{X}$ is near unity in the frequency range of interest.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-161.jpg?height=1033&width=1407&top_left_y=621&top_left_x=265)

Figure 5.43 CS stage biasing with (a) $V_{B}$ fighting $V_{i n}$, (b) ac coupling to set the dc value of $V_{X}$ to $V_{B}$, (c) use of a current mirror, (d) a large resistor realized by $M_{R}$, and (e) accurate $V_{G S}$ generation for $M_{R}$.

We now make several remarks. (1) Node $X$ in Fig. 5.43(b) must have a dc path to a voltage; if $R_{B}$ is removed, $X$ floats, sustaining a poorly-defined voltage. ${ }^{5}$ (2) As explained in Sec. 5.1, the bias voltage, $V_{B}$, must not be constant; rather, it must be generated by a diode-connected device [Fig. 5.43(c)]. (3) We typically select $I_{B}$ about one-tenth to one-fifth of $I_{D 1}$ so as to minimize the power consumed by the bias network. (4) The capacitor and the resistor may occupy a large chip area if $V_{i n}$ contains very low frequencies, e.g., in the audio range. (5) The capacitor introduces its own parasitics in the signal path (Chapter 19), degrading the high-frequency performance; even if chip area is not critical, the value of the capacitor is limited by these parasitic effects.

In applications requiring a large $R_{B} C_{B}$ product, one can replace $R_{B}$ with a long, narrow MOSFET operating in the deep triode region and bias this transistor with a small overdrive voltage, thus maximizing

[^25]its on-resistance [Fig. 5.43(d)]. But how do we guarantee that $M_{R}$ does not turn off with PVT variations? While small, the overdrive of $M_{R}$ must still be well-controlled, i.e., $V_{G}-V_{B}$ must still be around $V_{T H}$. This difference can be created by means of a diode-connected device [Fig. 5.43(e)]. If ( $W / L)_{C}$ is large, $V_{G S, C} \approx V_{T H}$, producing a high resistance in $M_{R}$. Using a long-channel model, the reader can prove that, in strong inversion,
\$\$

$$
\begin{equation*}
R_{o n, R}=\frac{(W / L)_{C}}{(W / L)_{R}} \frac{1}{g_{m, C}} \tag{5.58}
\end{equation*}
$$

\$\$

We conclude that $(W / L)_{C}$ must be maximized and $(W / L)_{R}$ minimized. In Problem 5.24, we reexamine the circuit in the subthreshold region.

Is it possible to remove the input coupling capacitor and provide the bias voltage from the preceding stage? Figure 5.44 depicts an example, where $V_{D D}-R_{D 2} I_{D 2}$ serves as the bias gate voltage of $M_{1}$. The principal difficulty here is that the bias conditions of $M_{1}$ are influenced by those of $M_{2}$. For example, if $I_{D 2}$ varies with PVT variations, so do $V_{X}$ and hence $I_{D 1}$. In such a cascade, the PVT variations are amplified because they are indistinguishable from the signal. Nonetheless, one can employ direct coupling between two stages if each has a low gain, e.g., around 2 or 3 . For a larger number of stages or higher gains, negative feedback may become necessary, especilly if the load resistors are replaced with current sources (Chapter 8).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-162.jpg?height=299&width=459&top_left_y=1085&top_left_x=539)

Figure 5.44 Direct coupling between two stages.

CS Stage with Current-Source Load We now turn our attention to the common-source stage with current-source load [Fig. 5.45(a)]. The foregoing techniques can be readily applied to both $M_{1}$ and $M_{2}$, yielding the circuit shown in Fig. 5.45(b). We note that $I_{D 1}$ and $I_{D 2}$ are copied from $I_{B 1}$ and $I_{B 2}$, respectively.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-162.jpg?height=526&width=1495&top_left_y=1684&top_left_x=277)

Figure 5.45 (a) CS stage with current-source load; (b) simple biasing; (c) self-biasing of current source; (d) use of $I_{G}$ to shift the output.

The CS stage with current-source load exemplifies a situation sometimes encountered in analog design: two high-impedance current sources, $M_{1}$ and $M_{2}$, fight each other. That is, if the copied currents in Fig. 5.45(b) are not exactly equal, each transistor wants to impose its own current. (Imagine what happens if two unequal ideal current sources are placed in series.) For example, if $I_{D 1}$ tends to be greater than $\left|I_{D 2}\right|$, then $V_{\text {out }}$ falls—possibly driving $M_{1}$ into the triode region—until $I_{D 1}$ becomes equal to $\left|I_{D 2}\right|$. To resolve this issue, we modify the circuit as shown in Fig. 5.45(c), where $M_{2}$ acts as a diode-connected device at dc, happily carrying the current imposed by $M_{1}$. At high frequencies, $C_{G}$ shorts the gate of $M_{2}$ to ground, yielding a small-signal gain equal to

$$
\begin{equation*}
A_{v}=-g_{m 1}\left(r_{O 1}\left\|r_{O 2}\right\| R_{G}\right) \tag{5.59}
\end{equation*}
$$

We therefore select $R_{G} \gg r_{O 1} \| r_{O 2}$ and $1 /\left(2 \pi R_{G} C_{G}\right)$ less than the lowest signal frequency of interest.
In the above CS stage, $M_{2}$ forces the bias value of $V_{\text {out }}$ to be as low as $V_{D D}-\left|V_{G S 2}\right|$. We can draw a constant current of $I_{G}$ from $R_{G}$ [Fig. $\left.5.45(\mathrm{~d})\right]$ so that $V_{N}$ is still low enough to provide the necessary $V_{G S}$ for $M_{2}$, but $V_{\text {out }}=V_{N}+I_{G} R_{G}$ is higher. The value of $I_{G}$ is chosen much less than the bias current.

#### Example 5.14

Compare the maximum allowable voltage swings in Figs. 5.45(c) and (d).

#### Solution

In Fig. 5.45(c), $V_{\text {out }}$ begins from $V_{D D}-\left|V_{G S 2}\right|$ and can rise to $V_{D D}-\left|V_{G S 2}-V_{T H 2}\right|$ and fall to $V_{G S 1}-V_{T H 1}$. However, as illustrated in Fig. 5.46(a), since the down swing is limited to $V_{D D}-\left|V_{G S 2}\right|-\left(V_{G S 1}-V_{T H 1}\right)$, the up swing cannot reach its maximum. Thus, the allowable peak-to-peak swing is about $2\left[V_{D D}-\left|V_{G S 2}\right|-\left(V_{G S 1}-V_{T H 1}\right)\right]$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-163.jpg?height=448&width=1490&top_left_y=1223&top_left_x=231)

Figure 5.46
In Fig. 5.45 (d), on the other hand, $I_{G} R_{G}$ can shift the operating point such that the down swing and the up swing are approximately equal. From Fig. 5.46(b), we have
$V_{D D}-\left|V_{G S 2}\right|+I_{G} R_{G}-\left(V_{G S 1}-V_{T H 1}\right) \approx V_{D D}-\left|V_{G S 2}-V_{T H 2}\right|-\left[V_{D D}-\left|V_{G S 2}\right|+I_{G} R_{G}\right]$
If the NMOS and PMOS overdrives are roughly equal, we must choose

$$
\begin{equation*}
I_{G} R_{G} \approx\left|V_{G S 2}\right|-\frac{V_{D D}}{2} \tag{5.61}
\end{equation*}
$$

in which case the output peak-to-peak swing can reach $2\left[V_{D D} / 2-\left(V_{G S 1}-V_{T H 1}\right)\right]$. Alternatively, we can choose $\left|V_{G S 2}\right|=V_{D D} / 2$ and apply no $I_{G}$. As explained in Chapter $7, M_{2}$ contributes less noise as its overdrive increases (while its bias current remains constant), making the former topology more attractive.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-164.jpg?height=464&width=1515&top_left_y=229&top_left_x=303)

Figure 5.47 (a) Complementary CS stage, (b) self-biased topology, (c) accurate definition of bias current, and (d) use of ac coupling at input.

Complementary CS Stage Let us now consider the problem of biasing for the CS stage with active current source [Fig. 5.47(a)]. As explained in Chapter 3, this topology exhibits considerable PVT dependence because $V_{G S 1}+\left|V_{G S 2}\right|=V_{D D}$. Also, in a manner similar to the CS stage of Fig. 5.45(b), $M_{1}$ and $M_{2}$ fight each other.

As a first step, consider the arrangement shown in Fig. 5.47(b), where a large resistor is tied between the drains and gates of the transistors. In the absence of signals, no current flows through $R_{F}$ and $V_{\text {out }}=V_{X}$; in essence, each transistor is configured as a diode-connected device and guaranteed to operate in saturation. The two devices therefore do not fight anymore: if for example, $M_{1}$ tends to carry a larger drain current, then $V_{\text {out }}$ and hence $V_{X}$ fall so that $I_{D 1}=\left|I_{D 2}\right|$.

To define the bias current accurately, we modify the circuit as shown in Fig. 5.47(c). Here, $I_{1}$ establishes the drain currents of $M_{1}$ and $M_{2}$, and $C_{1}$ creates a short circuit at the lowest signal frequency of interest, $\omega_{\min }$. The value of $C_{1}$ is chosen such that $M_{2}$ experiences negligible degeneration:

$$
\begin{equation*}
\frac{1}{C_{1} \omega_{\min }} \ll \frac{1}{g_{m 2}} \tag{5.62}
\end{equation*}
$$

Note that $I_{1}$ consumes additional voltage headroom in this case.
Since the bias voltage at node $X$ must track $V_{\text {out }}$, the input must be capacitively coupled [Fig. 5.47(d)]. In Problem 5.25, we compute the corner frequency of the high-pass filter formed by $C_{i n}$ and the remainder of the circuit. This frequency must be chosen lower than $\omega_{\min }$. With sufficiently large values for $C_{i n}$, $R_{F}$, and $C_{1}$, the voltage gain of the amplifier at signal frequencies of interest is still given by $\left(g_{m 1}+\right.$ $\left.g_{m 2}\right)\left(r_{O 1} \| r_{O 2}\right)$.

### 5.4.2 CG Biasing

In a common-gate stage, the transistor must carry a bias current while sensing the input at its source terminal. Thus, the source cannot be directly tied to the ground, requiring an intervening element that passes dc, e.g., a resistor, a current source, or an inductor. Figure 5.48(a) depicts an example where $M_{1}$ and $M_{B}$ form a current mirror so that $I_{D 1}$ is a multiple of $I_{B}$. For proper copying of $I_{B}$, we must ensure that $V_{G S 1}=V_{G S, B}$. We therefore choose $(W / L)_{1} /(W / L)_{B}$ equal to the desired ratio for $I_{D 1}$ and $I_{B}$ (e.g., in the range of 5 to 10 ) and apply the same ratio to $R_{B} / R_{S}$, i.e., $R_{B} / R_{S}=I_{D 1} / I_{B}$.

The circuit of Fig. 5.48(a) faces difficulties in low-voltage design. In the presence of a finite driving impedance, $R_{1}$ (i.e., the output impedance of the preceding stage), the signal experiences additional attenuation due to $R_{S}$. Neglecting channel-length modulation, we write the voltage gain from $V_{i n}$
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-165.jpg?height=431&width=1525&top_left_y=243&top_left_x=226)

Figure 5.48 CG stage with (a) resistive path from source to ground, (b) current-source biasing, and (c) low-voltage current mirror.
to $V_{X}$ as

$$
\begin{equation*}
\frac{V_{X}}{V_{i n}}=\frac{\frac{1}{g_{m 1}+g_{m b 1}} \| R_{S}}{\frac{1}{g_{m 1}+g_{m b 1}} \| R_{S}+R_{1}} \tag{5.63}
\end{equation*}
$$

concluding that $R_{S}$ must be much greater than $1 /\left(g_{m 1}+g_{m b 1}\right)$ to minimize this attenuation. However, since the gain from $V_{X}$ to $V_{\text {out }}$ is equal to $\left(g_{m 1}+g_{m b 1}\right) R_{D}$, this means that $R_{S}$ may reach or even exceed $R_{D}$. Thus, $R_{S}$ may sustain a large dc voltage drop, limiting the dc drop across $R_{D}$ and hence the voltage gain.

To remedy the situation, we replace $R_{S}$ with a current source [Fig. 5.48(b)]. Here, $M_{2}$ exhibits a high impedance but does not necessarily require a high $V_{D S}$. Copied from $I_{B}$, the drain current of $M_{2}$ does incur some error due to channel-length modulation because $V_{D S 2}<V_{D S, B}$. This issue is reminiscent of the cascode current mirror studied in Section 5.2 and can be resolved by means of a low-voltage cascode topology [Fig. 5.48(c)]. The bias voltage, $V_{b}$, is also generated as explained in Section 5.2.

### 5.4.3 Source Follower Biasing

Source followers are typically biased by means of a current source as shown in Fig. 5.49(a). If the mismatch between $I_{D 2}$ and $I_{B}$ due to channel-length modulation proves undesirable, a resistor can be placed in series with the drain of $M_{B}$ (Sec. 5.2). Defined by $M_{2}$, the bias current of $M_{1}$ is less sensitive to its gate voltage than in a CS amplifier, allowing direct connection to the preceding stage. In applications where the input dc voltage may vary considerably, capacitive coupling can be used [Fig. 5.49(b)]. Note that the gate voltage of $M_{1}$ begins at $V_{D D}$ and can swing up by one threshold before the transistor enters the triode region.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-165.jpg?height=362&width=1129&top_left_y=1886&top_left_x=383)

Figure 5.49 Source follower biasing with (a) current source and (b) ac coupling at input.

#### Example 5.15

A source follower serves as an output buffer for a CS stage. Study the performance with and without capacitive coupling between the two stages.

#### Solution

In Fig. 5.50(a), the minimum drain voltage of $M_{3}$ is given by $V_{G S 1}+V_{D S 2, \text { min }}$, leaving little for the allowable voltage drop across $R_{D}$. The CS voltage gain is therefore severely limited. In the circuit of Fig. 5.50(b), on the other hand, the first stage's gain can be independently maximized.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-166.jpg?height=363&width=1166&top_left_y=633&top_left_x=452)

Figure 5.50

### 5.4.4 Differential Pair Biasing

In addition to the tail current source, the gate voltage of a differential pair must also be defined. To maximize the voltage gain and/or output swings, we select the lowest input CM level, as shown in Fig. 5.51(a), equal to $V_{G S 1,2}+V_{D S 3, \min }$. This choice allows the drain voltages of $M_{1}$ and $M_{2}$ to be as low as $\left(V_{G S 1,2}-V_{T H 1,2}\right)+V_{D S 3, \min }$ (two overdrive voltages above ground) and hence maximum $R_{D}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-166.jpg?height=468&width=1380&top_left_y=1500&top_left_x=350)

Figure 5.51 (a) Choice of input CM level for a differential pair, and (b) cascaded pairs.

Since the bias currents of $M_{1}$ and $M_{2}$ in Fig. 5.51(a) are relatively insensitive to their gate voltages, we can directly connect their gates to the preceding stage [Fig. 5.51(b)]. This approach, however, constrains the overall voltage gain: if the bias value of $V_{X}$ and $V_{Y}$ is chosen equal to two overdrives above ground so as to maximize the gain of the first stage, then it is an excessively low common-mode level for the second stage (why?). For this reason, we may resort to capacitive coupling in some cases.
