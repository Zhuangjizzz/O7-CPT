# Frequency Response of Amplifiers

Our analysis of simple amplifiers has thus far focused on low-frequency characteristics, neglecting the effect of device and load capacitances. In most analog circuits, however, the speed trades with many other parameters such as gain, power dissipation, and noise. It is therefore necessary to understand the frequency-response limitations of each circuit.

In this chapter, we study the behavior of single-stage and differential amplifiers in the frequency domain. Following a review of basic concepts, we analyze the high-frequency response of commonsource and common-gate stages and source followers. Next, we deal with cascode and differential amplifiers. Finally, we consider the effect of active current mirrors on the frequency response of differential pairs.

## 6.1 â–  General Considerations

Recall that a MOS device exhibits four capacitances: $C_{G S}, C_{G D}, C_{D B}$, and $C_{S B}$. For this reason, the transfer function of CMOS circuits can rapidly become complicated, calling for approximations that simplify the circuit. In this section, we introduce two such approximations, namely, Miller's theorem and association of poles with nodes. We remind the reader that a two-terminal impedance, $Z$, is defined as $Z=V / I$, where $V$ and $I$ denote the voltage across and the current flowing through the device. For example, $Z=1 /(C s)$ for a capacitor. Also, the transfer function of a circuit yields the frequency response if we replace $s$ with $j \omega$, i.e., if we assume a sinusoidal input such as $A \cos \omega t$. For example, $H(j \omega)=(R C j \omega+1)^{-1}$ provides the magnitude and phase of a simple low-pass filter.

In this chapter, we are primarily interested in the magnitude of the transfer function (with $s=$ $j \omega)$. Figure 6.1 shows examples of magnitude response. We should also remark that, even if computed exactly, some transfer functions do not offer much insight. We therefore study numerous special cases by considering extreme conditions, e.g., if the load capacitance is very small or very large.

A few basic concepts are used extensively throughout this chapter and merit a brief review. (1) The magnitude of a complex number $a+j b$ is given by $\sqrt{a^{2}+b^{2}}$. (2) Zeros and poles are respectively defined as the roots of the numerator and denominator of the transfer function. (3) According to Bode's approximations, the slope of the magnitude of a transfer function increases by $20 \mathrm{~dB} /$ decade as $\omega$ passes a pole frequency and decreases by $20 \mathrm{~dB} /$ decade as $\omega$ passes a zero frequency.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-174.jpg?height=324&width=1448&top_left_y=235&top_left_x=306)

Figure 6.1 (a) Low-pass, (b) band-pass, and (c) high-pass frequency-response examples.

### 6.1.1 Miller Effect

An important phenomenon that occurs in many analog (and digital) circuits is related to the "Miller effect," as described by Miller in a theorem.
Miller's Theorem If the circuit of Fig. 6.2(a) can be converted to that of Fig. 6.2(b), then $Z_{1}=$ $Z /\left(1-A_{v}\right)$ and $Z_{2}=Z /\left(1-A_{v}^{-1}\right)$, where $A_{v}=V_{Y} / V_{X}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-174.jpg?height=339&width=1079&top_left_y=914&top_left_x=495)

Figure 6.2 Application of Miller effect to a floating impedance.

Proof The current flowing through $Z$ from $X$ to $Y$ is equal to $\left(V_{X}-V_{Y}\right) / Z$. For the two circuits to be equivalent, the same current must flow through $Z_{1}$. Thus,

$$
\begin{equation*}
\frac{V_{X}-V_{Y}}{Z}=\frac{V_{X}}{Z_{1}} \tag{6.1}
\end{equation*}
$$

that is

$$
\begin{equation*}
Z_{1}=\frac{Z}{1-\frac{V_{Y}}{V_{X}}} \tag{6.2}
\end{equation*}
$$

Similarly,

$$
\begin{equation*}
Z_{2}=\frac{Z}{1-\frac{V_{X}}{V_{Y}}} \tag{6.3}
\end{equation*}
$$

This decomposition of a "floating" impedance, $Z$, into two "grounded" impedances proves useful in analysis and design.

#### Example 6.1

Consider the circuit shown in Fig. 6.3(a), where the voltage amplifier has a negative gain equal to $-A$ and is otherwise ideal. Calculate the input capacitance of the circuit.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-175.jpg?height=439&width=1446&top_left_y=236&top_left_x=240)

Figure 6.3

#### Solution

Using Miller's theorem to convert the circuit to that shown in Fig. 6.3(b), we have $Z=1 /\left(C_{F} s\right)$ and $Z_{1}=$ $\left[1 /\left(C_{F} s\right)\right] /(1+A)$. That is, the input capacitance is equal to $C_{F}(1+A)$. We call this effect "Miller multiplication" of the capacitor.

Why is $C_{F}$ multiplied by $1+A$ ? Suppose, as depicted in Fig. 6.3(c), we measure the input capacitance by applying a voltage step at the input and calculating the charge supplied by the voltage source. A step equal to $\Delta V$ at $X$ results in a change of $-A \Delta V$ at $Y$, yielding a total change of $(1+A) \Delta V$ in the voltage across $C_{F}$. Thus, the charge drawn by $C_{F}$ from $V_{i n}$ is equal to $(1+A) C_{F} \Delta V$ and the equivalent input capacitance equal to $(1+A) C_{F}$.

#### Example 6.2

A student needs a large capacitor for a filter and decides to utilize the Miller multiplication of [Fig. 6.4(a)]. Explain the issues in this approach.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-175.jpg?height=444&width=1168&top_left_y=1340&top_left_x=379)

Figure 6.4

#### Solution

The issues relate to the amplifier, particularly to its output swing. As exemplified by the implementation in Fig. 6.4(b), if the voltage at $X$ swings by $V_{0}$, then $Y$ must accommodate a swing of $A V_{0}$ without saturating the amplifier. In addition, the dc level in $V_{i n}$ must be compatible with the input of the amplifier.

It is important to understand that (6.2) and (6.3) hold if we know a priori that the circuit of Fig. 6.2(a) can be converted to that of Fig. 6.2(b). That is, Miller's theorem does not stipulate the conditions under which this conversion is valid. If the impedance $Z$ forms the only signal path between $X$ and $Y$, then the conversion is often invalid. Illustrated in Fig. 6.5 for a simple resistive divider, the theorem gives a correct
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-176.jpg?height=267&width=941&top_left_y=243&top_left_x=564)

Figure 6.5 Improper application of Miller's theorem.
input impedance but an incorrect gain. Nevertheless, Miller's theorem proves useful in cases where the impedance $Z$ appears in parallel with the main signal (Fig. 6.6).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-176.jpg?height=237&width=342&top_left_y=706&top_left_x=592)

Main Signal Path

Figure 6.6 Typical case for valid application of Miller's theorem.

#### Example 6.3

Calculate the input resistance of the circuit shown in Fig. 6.7(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-176.jpg?height=411&width=265&top_left_y=1188&top_left_x=405)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-176.jpg?height=406&width=367&top_left_y=1190&top_left_x=759)
(b)

Figure 6.7

#### Solution

The reader can prove that the voltage gain from $X$ to $Y$ is equal to $1+\left(g_{m}+g_{m b}\right) r_{O}$. As shown in Fig. 6.7(b), the input resistance is given by the parallel combination of $r_{O} /\left(1-A_{v}\right)$ and $1 /\left(g_{m}+g_{m b}\right)$. Since $A_{v}$ is usually greater than unity, $r_{O} /\left(1-A_{v}\right)$ is a negative resistance. We therefore have

$$
\begin{align*}
R_{i n} & =\frac{r_{O}}{1-\left[1+\left(g_{m}+g_{m b}\right) r_{O}\right]} \| \frac{1}{g_{m}+g_{m b}}  \tag{6.4}\\
& =\frac{-1}{g_{m}+g_{m b}} \| \frac{1}{g_{m}+g_{m b}}  \tag{6.5}\\
& =\infty \tag{6.6}
\end{align*}
$$

This is the same result as obtained in Chapter 3 (Fig. 3.54) by direct calculation.

We should also mention that, strictly speaking, the value of $A_{v}=V_{Y} / V_{X}$ in (6.2) and (6.3) must be calculated at the frequency of interest, complicating the algebra significantly. To understand this point, let us return to Example 6.1 and assume an amplifier with a finite output resistance. Depicted in Fig. 6.8, the equivalent circuit reveals that $V_{Y} \neq-A V_{X}$ at high frequencies, and hence $C_{F}$ cannot be simply multiplied by $1+A$ to yield the input capacitance. However, in many cases we use the low-frequency value of $V_{Y} / V_{X}$ to gain insight into the behavior of the circuit. We call this approach "Miller's approximation."
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-177.jpg?height=347&width=569&top_left_y=549&top_left_x=412)

Figure 6.8 Equivalent circuit showing gain change at high frequencies.

#### Example 6.4

Determine the transfer function of the circuit shown in Fig. 6.9(a) using (a) direct analysis and (b) Miller's approximation.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-177.jpg?height=777&width=1461&top_left_y=1169&top_left_x=235)

Figure 6.9

#### Solution

(a) We note that the current flowing through $R_{S}$ is given by $\left(V_{i n}-V_{X}\right) / R_{S}$, yielding a voltage drop across $R_{\text {out }}$ equal to $\left(V_{\text {in }}-V_{X}\right) R_{\text {out }} / R_{S}$. It follows that

$$
\begin{equation*}
\frac{V_{\text {in }}-V_{X}}{R_{S}} R_{\text {out }}-A V_{X}=V_{\text {out }} \tag{6.7}
\end{equation*}
$$

We also equate the currents flowing through $R_{S}$ and $C_{F}$ :

$$
\begin{equation*}
\frac{V_{\text {in }}-V_{X}}{R_{S}}=\left(V_{X}-V_{\text {out }}\right) C_{F} s \tag{6.8}
\end{equation*}
$$

The reader can find $V_{X}$ from the first equation and substitute the result in the second, thereby obtaining

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{R_{\text {out }} C_{F} s-A}{\left[(A+1) R_{S}+R_{\text {out }}\right] C_{F} s+1} \tag{6.9}
\end{equation*}
$$

The circuit thus exhibits a zero at $\omega_{z}=A /\left(R_{\text {out }} C_{F}\right)$ and a pole at $\omega_{p}=-1 /\left[(A+1) R_{S} C_{F}+R_{\text {out }} C_{F}\right]$. Figure 6.9(b) plots the response for the case of $\left|\omega_{p}\right|<\left|\omega_{z}\right|$.
(b) Applying Miller's approximation, we decompose $C_{F}$ into $(1+A) C_{F}$ at the input and $C_{F} /\left(1+A^{-1}\right)$ at the output [Fig. 6.9(c)]. Since $V_{\text {out }} / V_{\text {in }}=\left(V_{X} / V_{\text {in }}\right)\left(V_{\text {out }} / V_{X}\right)$, we first write $V_{X} / V_{\text {in }}$ by considering $R_{S}$ and $(1+A) C_{F}$ as a voltage divider:

$$
\begin{align*}
\frac{V_{X}}{V_{\text {in }}} & =\frac{\frac{1}{(1+A) C_{F} s}}{\frac{1}{(1+A) C_{F} s}+R_{S}}  \tag{6.10}\\
& =\frac{1}{(1+A) R_{S} C_{F} s+1} \tag{6.11}
\end{align*}
$$

As for $V_{\text {out }} / V_{X}$, we first amplify $V_{X}$ by $-A$ and subject the result to the output voltage divider,

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{X}}=\frac{-A}{\frac{1}{1+A^{-1}} C_{F} R_{\text {out }} s+1} \tag{6.12}
\end{equation*}
$$

That is

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{-A}{\left[(1+A) R_{S} C_{F} s+1\right]\left(\frac{1}{1+A^{-1}} C_{F} R_{\text {out }} s+1\right)} \tag{6.13}
\end{equation*}
$$

Sadly, Miller's approximation has eliminated the zero and predicted two poles for the circuit! Despite these shortcomings, Miller's approximation can provide intuition in many cases. ${ }^{1}$

If applied to obtain the input-output transfer function, Miller's theorem cannot be used simultaneously to calculate the output impedance. To derive the transfer function, we apply a voltage source to the input of the circuit, obtaining a value for $V_{Y} / V_{X}$ in Fig. 6.2(a). On the other hand, to determine the output impedance, we must apply a voltage source to the output of the circuit, obtaining a value for $V_{X} / V_{Y}$ that may not be equal to the inverse of the $V_{Y} / V_{X}$ measured in the first test. For example, the circuit of Fig. 6.7 (b) may suggest that the output impedance is equal to

$$
\begin{align*}
R_{\text {out }} & =\frac{r_{O}}{1-1 / A_{v}}  \tag{6.14}\\
& =\frac{r_{O}}{1-\left[1+\left(g_{m}+g_{m b}\right) r_{O}\right]^{-1}}  \tag{6.15}\\
& =\frac{1}{g_{m}+g_{m b}}+r_{O} \tag{6.16}
\end{align*}
$$

[^26]whereas the actual value is equal to $r_{O}$ (if $X$ is grounded). Other subtleties of Miller's theorem are described in the Appendix C.

In summary, Miller's approximation divides a floating impedance by the low-frequency gain and faces the following limitations: (1) it may eliminate zeros, (2) it may predict additional poles, and (3) it does not correctly compute the "output" impedance.

### 6.1.2 Association of Poles with Nodes

Consider the simple cascade of amplifiers depicted in Fig. 6.10. Here, $A_{1}$ and $A_{2}$ are ideal voltage amplifiers, $R_{1}$ and $R_{2}$ model the output resistance of each stage, $C_{i n}$ and $C_{N}$ represent the input capacitance of each stage, and $C_{P}$ denotes the load capacitance. The overall transfer function can be written as

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{A_{1}}{1+R_{S} C_{\text {in }} s} \cdot \frac{A_{2}}{1+R_{1} C_{N} s} \cdot \frac{1}{1+R_{2} C_{P} s} \tag{6.17}
\end{equation*}
$$

The circuit exhibits three poles, each of which is determined by the total capacitance seen from each node to ground multiplied by the total resistance seen at the node to ground. We can therefore associate each pole with one node of the circuit, i.e., $\omega_{j}=\tau_{j}^{-1}$, where $\tau_{j}$ is the product of the capacitance and resistance seen at node $j$ to ground. From this perspective, we may say that "each node in the circuit contributes one pole to the transfer function."
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-179.jpg?height=252&width=976&top_left_y=1098&top_left_x=475)

Figure 6.10 Cascade of amplifiers.

The above statement is not valid in general. For example, in the circuit of Fig. 6.11, the location of the poles is difficult to calculate because $R_{3}$ and $C_{3}$ create interaction between $X$ and $Y$. Nevertheless, in many circuits, association of one pole with each node provides an intuitive approach to estimating the transfer function: we simply multiply the total equivalent capacitance by the total incremental (smallsignal) resistance (both from the node of interest to ground), thus obtaining an equivalent time constant and hence a pole frequency.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-179.jpg?height=364&width=665&top_left_y=1744&top_left_x=364)

Figure 6.11 Example of interaction between nodes.

#### Example 6.5

Neglecting channel-length modulation, compute the transfer function of the common-gate stage shown in Fig. 6.12(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-180.jpg?height=495&width=1087&top_left_y=244&top_left_x=491)

Figure 6.12 Common-gate stage with parasitic capacitances.

#### Solution

In this circuit, the capacitances contributed by $M_{1}$ are connected from the input and output nodes to ground [Fig. 6.12(b)]. At node $X, C_{S}=C_{G S}+C_{S B}$, giving a pole frequency

$$
\begin{equation*}
\omega_{i n}=\left[\left(C_{G S}+C_{S B}\right)\left(R_{S} \| \frac{1}{g_{m}+g_{m b}}\right)\right]^{-1} \tag{6.18}
\end{equation*}
$$

Similarly, at node $Y, C_{D}=C_{D G}+C_{D B}$, yielding a pole frequency

$$
\begin{equation*}
\omega_{\text {out }}=\left[\left(C_{D G}+C_{D B}\right) R_{D}\right]^{-1} \tag{6.19}
\end{equation*}
$$

The overall transfer function is thus given by

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{\left(g_{m}+g_{m b}\right) R_{D}}{1+\left(g_{m}+g_{m b}\right) R_{S}} \cdot \frac{1}{\left(1+\frac{s}{\omega_{\text {in }}}\right)\left(1+\frac{s}{\omega_{\text {out }}}\right)} \tag{6.20}
\end{equation*}
$$

where the first fraction represents the low-frequency gain of the circuit. Note that if we do not neglect $r_{O 1}$, the input and output nodes interact, making it difficult to calculate the poles.

#### Nanometer Design Notes

Defined as the frequency at which the small-signal current gain of a device is unity, the transit frequency, $f_{T}$, of MOSFETs increases with the overdrive, but flattens out as the vertical electric field reduces the mobility. Plotted below is the $f_{T}$ for an NMOS device with $W / L=5 \mu \mathrm{~m} / 40 \mathrm{~nm}$ and $V_{D S}=0.8 \mathrm{~V}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-180.jpg?height=385&width=513&top_left_y=1926&top_left_x=138)

As observed in Example 6.4, Miller's approximation converts a floating impedance to two grounded impedances, allowing us to associate one pole with each node. We apply this technique to various amplifier topologies in this chapter-but cautiously and retrospectively to avoid its pitfalls. It is also helpful to bear in mind that the $f_{T}$ of a MOS transistor is roughly equal to $g_{m} /\left(2 \pi C_{G S}\right)$ and can exceed 300 GHz in today's technologies. (However, since $f_{T} \propto V_{G S}-V_{T H}$, as we push the devices for low-voltage operation, we tend to reduce their $f_{T}$ 's.)

## 6.2 â–  Common-Source Stage

The common-source topology exhibits a relatively high input impedance while providing voltage gain and requiring a minimal voltage headroom. As such, it finds wide application in analog circuits and its frequency response is of interest.

Shown in Fig. 6.13(a) is a common-source stage driven by a finite source resistance, $R_{S} .{ }^{2}$ We identify all of the capacitances in the circuit, noting that $C_{G S}$ and $C_{D B}$ are "grounded" capacitances while $C_{G D}$ appears between the input and the output. In reality, the circuit also drives a load capacitance, which can be merged with $C_{D B}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-181.jpg?height=385&width=557&top_left_y=430&top_left_x=244)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-181.jpg?height=388&width=890&top_left_y=431&top_left_x=815)
(b)

Figure 6.13 (a) High-frequency model of a common-source stage, and (b) simplified circuit using Miller's approximation.

Miller's Approximation Assuming that $\lambda=0$ and $M_{1}$ operates in saturation, let us first estimate the transfer function by associating one pole with each node. The total capacitance seen from $X$ to ground is equal to $C_{G S}$ plus the Miller multiplication of $C_{G D}$, namely, $C_{G S}+\left(1-A_{v}\right) C_{G D}$, where $A_{v}=-g_{m} R_{D}$ [Fig. 6.13(b)]. The magnitude of the "input" pole is therefore given by

$$
\begin{equation*}
\omega_{i n}=\frac{1}{R_{S}\left[C_{G S}+\left(1+g_{m} R_{D}\right) C_{G D}\right]} \tag{6.21}
\end{equation*}
$$

At the output node, the total capacitance seen to ground is equal to $C_{D B}$ plus the Miller effect of $C_{G D}$, i.e., $C_{D B}+\left(1-A_{v}^{-1}\right) C_{G D} \approx C_{D B}+C_{G D}$ (if $\left.A_{v} \gg 1\right)$. Thus,

$$
\begin{equation*}
\omega_{\text {out }}=\frac{1}{R_{D}\left(C_{D B}+C_{G D}\right)} \tag{6.22}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-181.jpg?height=378&width=439&top_left_y=1573&top_left_x=457)

Figure 6.14 Model for calculation of output impedance.

Another approximation of the output pole can be obtained if $R_{S}$ is relatively large. Simplifying the circuit as shown in Fig. 6.14, where the effect of $R_{S}$ is neglected, the reader can prove that

$$
\begin{equation*}
Z_{X}=\frac{1}{C_{e q} s} \|\left(\frac{C_{G D}+C_{G S}}{C_{G D}} \cdot \frac{1}{g_{m 1}}\right) \tag{6.23}
\end{equation*}
$$

[^27]where $C_{e q}=C_{G D} C_{G S} /\left(C_{G D}+C_{G S}\right)$. Thus, the output pole is roughly equal to
\$\$

$$
\begin{equation*}
\omega_{\text {out }}=\frac{1}{\left[R_{D} \|\left(\frac{C_{G D}+C_{G S}}{C_{G D}} \cdot \frac{1}{g_{m 1}}\right)\right]\left(C_{e q}+C_{D B}\right)} \tag{6.24}
\end{equation*}
$$

\$\$

We should point out that the sign of $\omega_{\text {in }}$ and $\omega_{\text {out }}$ in the above equations is positive because we eventually write the denominator of the transfer function in the form of $\left(1+s / \omega_{\text {in }}\right)\left(1+s / \omega_{\text {out }}\right)$; i.e., the denominator vanishes at $s=-\omega_{i n}$ and $s=-\omega_{\text {out }}$. Alternatively, we could express the values of $\omega_{\text {in }}$ and $\omega_{\text {out }}$ with a negative sign and hence write the denominator as $\left(1-s / \omega_{\text {in }}\right)\left(1-s / \omega_{\text {out }}\right)$. We adopt the former notation in this book. We then surmise that the transfer function is

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{-g_{m} R_{D}}{\left(1+\frac{s}{\omega_{\text {in }}}\right)\left(1+\frac{s}{\omega_{\text {out }}}\right)} \tag{6.25}
\end{equation*}
$$

Note that $r_{O 1}$ and any load capacitance can easily be included here.
The primary error in this estimation is that we have not considered the existence of zeros in the circuit. Another concern stems from approximating the gain of the amplifier by $-g_{m} R_{D}$ whereas in reality the gain varies with frequency (for example, due to the capacitance at the output node).

Direct Analysis We now obtain the exact transfer function, investigating the validity of the above approach. Using the equivalent circuit depicted in Fig. 6.15, we can sum the currents at each node:

$$
\begin{align*}
\frac{V_{X}-V_{\text {in }}}{R_{S}}+V_{X} C_{G S} s+\left(V_{X}-V_{\text {out }}\right) C_{G D} s & =0  \tag{6.26}\\
\left(V_{\text {out }}-V_{X}\right) C_{G D} s+g_{m} V_{X}+V_{\text {out }}\left(\frac{1}{R_{D}}+C_{D B} S\right) & =0 \tag{6.27}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-182.jpg?height=291&width=820&top_left_y=1491&top_left_x=630)

Figure 6.15 Equivalent circuit of Fig. 6.13.
From (6.27), $V_{X}$ is obtained as

$$
\begin{equation*}
V_{X}=-\frac{V_{\text {out }}\left(C_{G D} s+\frac{1}{R_{D}}+C_{D B} s\right)}{g_{m}-C_{G D} s} \tag{6.28}
\end{equation*}
$$

which, upon substitution in (6.26), yields

$$
\begin{equation*}
-V_{\text {out }} \frac{\left[R_{S}^{-1}+\left(C_{G S}+C_{G D}\right) s\right]\left[R_{D}^{-1}+\left(C_{G D}+C_{D B}\right) s\right]}{g_{m}-C_{G D} s}-V_{\text {out }} C_{G D} s=\frac{V_{\text {in }}}{R_{S}} \tag{6.29}
\end{equation*}
$$

That is

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{\left(C_{G D} s-g_{m}\right) R_{D}}{R_{S} R_{D} \xi s^{2}+\left[R_{S}\left(1+g_{m} R_{D}\right) C_{G D}+R_{S} C_{G S}+R_{D}\left(C_{G D}+C_{D B}\right)\right] s+1} \tag{6.30}
\end{equation*}
$$

where $\xi=C_{G S} C_{G D}+C_{G S} C_{D B}+C_{G D} C_{D B}$. Note that the transfer function is of second order even though the circuit contains three capacitors. This is because the capacitors form a "loop," allowing only two independent initial conditions in the circuit and hence yielding a second-order differential equation for the time response.

#### Example 6.6

A student considers only $C_{G D}$ in Fig. 6.13(a) so as to obtain a one-pole response, reasons that the voltage gain drops by 3 dB (by a factor of $=\sqrt{2}$ ) at the pole frequency, and concludes that a better approximation of the Miller effect should multiply $C_{G D}$ by $1+g_{m} R_{D} \sqrt{2}$. Explain the flaw in this reasoning.

#### Solution

Setting $C_{G S}$ and $C_{D B}$ to zero, we obtain

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{\left(C_{G D} s-g_{m}\right) R_{D}}{\frac{s}{\omega_{0}}+1} \tag{6.31}
\end{equation*}
$$

where $\omega_{0}=R_{S}\left(1+g_{m} R_{D}\right) C_{G D}+R_{D} C_{G D}$. We note that $C_{G D}$ is multiplied by $1+g_{m} R_{D}$ in this exact analysis. So where is the flaw in the student's argument? It is true that the voltage gain in Fig. 6.13(a) falls by $\sqrt{2}$ at $\omega_{0}$, but this gain would be from $V_{\text {in }}$ to $V_{\text {out }}$ and not the gain seen by $C_{G D}$. The reader can readily express the transfer function from node $X$ to $V_{\text {out }}$ as

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{X}}(s)=\frac{\left(C_{G D} s-g_{m}\right) R_{D}}{R_{D} C_{G D}+1} \tag{6.32}
\end{equation*}
$$

observing that this gain begins to roll off at a higher frequency, namely, at $1 /\left(R_{D} C_{G D}\right)$. Thus, the multiplication of $C_{G D}$ by $1+g_{m} R_{D}$ is still justified.

Special Cases If manipulated judiciously, Eq. (6.30) reveals several interesting points about the circuit. While the denominator appears rather complicated, it can yield intuitive expressions for the two poles, $\omega_{p 1}$ and $\omega_{p 2}$, if we assume that $\left|\omega_{p 1}\right| \ll\left|\omega_{p 2}\right|$. This is called the "dominant pole" approximation. Writing the denominator as

$$
\begin{align*}
D & =\left(\frac{s}{\omega_{p 1}}+1\right)\left(\frac{s}{\omega_{p 2}}+1\right)  \tag{6.33}\\
& =\frac{s^{2}}{\omega_{p 1} \omega_{p 2}}+\left(\frac{1}{\omega_{p 1}}+\frac{1}{\omega_{p 2}}\right) s+1 \tag{6.34}
\end{align*}
$$

we recognize that the coefficient of $s$ is approximately equal to $1 / \omega_{p 1}$ if $\omega_{p 2}$ is much farther from the origin. It follows from (6.30) that the dominant pole is given by

$$
\begin{equation*}
\omega_{p 1}=\frac{1}{R_{S}\left(1+g_{m} R_{D}\right) C_{G D}+R_{S} C_{G S}+R_{D}\left(C_{G D}+C_{D B}\right)} \tag{6.35}
\end{equation*}
$$

How does this compare with the "input" pole given by (6.21)? The only difference results from the term $R_{D}\left(C_{G D}+C_{D B}\right)$, which may be negligible in some cases. The key point here is that the intuitive approach of associating a pole with the input node provides a rough estimate with much less effort. We also note that the Miller multiplication of $C_{G D}$ by the low-frequency gain of the amplifier is relatively accurate in this case. Of course, for a given set of values, we must check to ensure that $\omega_{p 1} \ll \omega_{p 2}$.

Other special cases are also of interest. We consider the case of $C_{G D}=0$ in Problem 6.26 and the case of $R_{D}=\infty$ below.

#### Example 6.7

The circuit shown in Fig. 6.16(a) is a special case where $R_{D} \rightarrow \infty$. Calculate the transfer function (with $\lambda=0$ ) and explain why the Miller effect vanishes as $C_{D B}$ (or the load capacitance) increases.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-184.jpg?height=465&width=1312&top_left_y=761&top_left_x=379)

Figure 6.16

#### Solution

Using (6.30) and letting $R_{D}$ approach infinity, we have

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s) & =\frac{C_{G D} s-g_{m}}{R_{S} \xi s^{2}+\left[g_{m} R_{S} C_{G D}+\left(C_{G D}+C_{D B}\right)\right] s}  \tag{6.36}\\
& =\frac{C_{G D} s-g_{m}}{s\left[R_{S}\left(C_{G S} C_{G D}+C_{G S} C_{D B}+C_{G D} C_{D B}\right) s+\left(g_{m} R_{S}+1\right) C_{G D}+C_{D B}\right]}
\end{align*}
$$

As expected, the circuit exhibits two poles-one at the origin because the dc gain is infinity [Fig. 6.16(b)]. The magnitude of the other pole is given by

$$
\begin{equation*}
\omega_{p 2} \approx \frac{\left(1+g_{m} R_{S}\right) C_{G D}+C_{D B}}{R_{S}\left(C_{G D} C_{G S}+C_{G S} C_{D B}+C_{G D} C_{D B}\right)} \tag{6.37}
\end{equation*}
$$

For a large $C_{D B}$ or load capacitance, this expression reduces to

$$
\begin{equation*}
\omega_{p 2} \approx \frac{1}{R_{S}\left(C_{G S}+C_{G D}\right)} \tag{6.38}
\end{equation*}
$$

indicating that $C_{G D}$ experiences no Miller multiplication. This can be explained by noting that, for a large $C_{D B}$, the voltage gain from node $X$ to the output begins to drop even at low frequencies. As a result, for frequencies close to $\left[R_{S}\left(C_{G S}+C_{G D}\right)\right]^{-1}$, the effective gain is quite small and $C_{G D}\left(1-A_{v}\right) \approx C_{G D}$. Such a case is an example where the application of the Miller effect using low-frequency gain does not provide a reasonable estimate.

From (6.30) and applying the dominant pole approximation, we can also estimate the second pole of the CS stage of Fig. 6.13(a). Since the coefficient of $s^{2}$ is equal to $\left(\omega_{p 1} \omega_{p 2}\right)^{-1}$, we have

$$
\begin{align*}
\omega_{p 2} & =\frac{1}{\omega_{p 1}} \cdot \frac{1}{R_{S} R_{D}\left(C_{G S} C_{G D}+C_{G S} C_{D B}+C_{G D} C_{D B}\right)}  \tag{6.39}\\
& =\frac{R_{S}\left(1+g_{m} R_{D}\right) C_{G D}+R_{S} C_{G S}+R_{D}\left(C_{G D}+C_{D B}\right)}{R_{S} R_{D}\left(C_{G S} C_{G D}+C_{G S} C_{D B}+C_{G D} C_{D B}\right)} \tag{6.40}
\end{align*}
$$

We emphasize that these results hold only if $\omega_{p 1} \ll \omega_{p 2}$.
As a special case, if $C_{G S} \gg\left(1+g_{m} R_{D}\right) C_{G D}+R_{D}\left(C_{G D}+C_{D B}\right) / R_{S}$, then

$$
\begin{align*}
\omega_{p 2} & \approx \frac{R_{S} C_{G S}}{R_{S} R_{D}\left(C_{G S} C_{G D}+C_{G S} C_{D B}\right)}  \tag{6.41}\\
& =\frac{1}{R_{D}\left(C_{G D}+C_{D B}\right)} \tag{6.42}
\end{align*}
$$

the same as (6.22). Thus, the "output" pole approach is valid only if $C_{G S}$ dominates the response.

The transfer function of (6.30) exhibits a zero given by $\omega_{z}=+g_{m} / C_{G D}$, an effect not predicted by Miller's approximation and (6.25). Located in the right half plane, the zero arises from direct coupling of the input to the output through $C_{G D}$. As illustrated in Fig. 6.17, $C_{G D}$ provides a feedthrough path that conducts the input signal to the output at very high frequencies, resulting in a slope in the frequency response that is less negative than $-40 \mathrm{~dB} / \mathrm{dec}$. Note that $g_{m} / C_{G D}>g_{m} / C_{G S}$ because $C_{G D}<C_{G S}$, implying that the zero lies beyond the transistor's $f_{T}$. However, as explained in Chapter 10, this zero falls to lower frequencies in cases where we deliberately add a capacitor between the gate and the drain, introducing other difficulties.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-185.jpg?height=409&width=1267&top_left_y=1381&top_left_x=324)

Figure 6.17 Feedforward path through $C_{G D}$ (log-log scale).
The zero, $s_{z}$, can also be computed by noting that the transfer function $V_{\text {out }}(s) / V_{\text {in }}(s)$ must drop to zero for $s=s_{z}$. For a finite $V_{i n}$, this means that $V_{\text {out }}\left(s_{z}\right)=0$, and hence the output can be shorted to ground at this (possibly complex) frequency with no current flowing through $R_{D}$ or the short (Fig. 6.18). Therefore, the currents through $C_{G D}$ and $M_{1}$ are equal and opposite:

$$
\begin{equation*}
V_{1} C_{G D} s_{z}=g_{m} V_{1} \tag{6.43}
\end{equation*}
$$

That is, $s_{z}=+g_{m} / C_{G D} .^{3}$

[^28]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-186.jpg?height=367&width=667&top_left_y=244&top_left_x=432)

Figure 6.18 Calculation of the zero in a CS stage.

#### Example 6.8

We have seen that the signals traveling through two paths within an amplifier may cancel each other at one frequency, creating a zero in the transfer function (Fig. 6.19). Can this occur if $H_{1}(s)$ and $H_{2}(s)$ are first-order low-pass circuits?
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-186.jpg?height=298&width=580&top_left_y=881&top_left_x=476)

Figure 6.19

#### Solution

Modeling $H_{1}(s)$ by $A_{1} /\left(1+s / \omega_{p 1}\right)$ and $H_{2}(s)$ by $A_{2} /\left(1+s / \omega_{p 2}\right)$, we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{\left(\frac{A_{1}}{\omega_{p 2}}+\frac{A_{2}}{\omega_{p 1}}\right) s+A_{1}+A_{2}}{\left(1+\frac{s}{\omega_{p 1}}\right)\left(1+\frac{s}{\omega_{p 2}}\right)} \tag{6.44}
\end{equation*}
$$

Indeed, the overall transfer function contains a zero.

#### Example 6.9

Determine the transfer function of the complementary CS stage shown in Fig. 6.20(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-186.jpg?height=300&width=409&top_left_y=1894&top_left_x=323)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-186.jpg?height=275&width=987&top_left_y=1917&top_left_x=756)
(b)

Figure 6.20

#### Solution

Since the corresponding terminals of $M_{1}$ and $M_{2}$ are shorted to one another in the small-signal model, we merge the two transistors, drawing the equivalent circuit as shown in Fig. 6.20(b). The circuit thus has the same transfer function as the simple CS stage studied above.

In high-speed applications, the input impedance of the common-source stage is also important. With the aid of Miller's approximation, we have from Fig. 6.21(a)

$$
\begin{equation*}
Z_{i n}=\frac{1}{\left[C_{G S}+\left(1+g_{m} R_{D}\right) C_{G D}\right] s} \tag{6.45}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-187.jpg?height=434&width=1407&top_left_y=736&top_left_x=265)

Figure 6.21 Calculation of input impedance of a CS stage.
But at high frequencies, the effect of the output node capacitance must be taken into account. Ignoring $C_{G S}$ for the moment and using the circuit of Fig. 6.21(b), we add the voltage drops across $R_{D} \|\left(C_{D B} s\right)^{-1}$ and $C_{G D}$, equating the result to $V_{X}$ :

$$
\begin{equation*}
\left(I_{X}-g_{m} V_{X}\right) \frac{R_{D}}{1+R_{D} C_{D B} S}+\frac{I_{X}}{C_{G D} S}=V_{X} \tag{6.46}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{1+R_{D}\left(C_{G D}+C_{D B}\right) s}{C_{G D} s\left(1+g_{m} R_{D}+R_{D} C_{D B} s\right)} \tag{6.47}
\end{equation*}
$$

The actual input impedance consists of the parallel combination of (6.47) and $1 /\left(C_{G S} S\right)$.
As a special case, suppose that at the frequency of interest, $\left|R_{D}\left(C_{G D}+C_{D B}\right) s\right| \ll 1$ and $\left|R_{D} C_{D B} s\right| \ll$ $1+g_{m} R_{D}$. Then, (6.47) reduces to $\left[\left(1+g_{m} R_{D}\right) C_{G D} S\right]^{-1}$ (as expected), indicating that the input impedance is primarily capacitive. At higher frequencies, however, (6.47) contains both real and imaginary parts. In fact, if $C_{G D}$ is large, it provides a low-impedance path between the gate and the drain of $M_{1}$, yielding the equivalent circuit of Fig. 6.21(c) and suggesting that $1 / g_{m 1}$ and $R_{D}$ appear in parallel with the input.

#### Example 6.10

Explain what happens to Eq. (6.47) if the circuit drives a large load capacitance.

#### Solution

Merged with $C_{D B}$, the large load capacitance reduces the numerator to $R_{D} C_{D B} S$ and the denominator to $C_{G D} s\left(R_{D} C_{D B} s\right)$, yielding $V_{X} / I_{X} \approx 1 /\left(C_{G D} s\right)$. In a manner similar to that in Example 6.7, the large load capacitance lowers the gain at high frequencies, suppressing Miller multiplication of $C_{G D}$.

## 6.3 â–  Source Followers

#### Nanometer Design Notes

While characterizing the intrinsic MOSFET, the $f_{T}$ overestimates how fast typical circuits can operate. A more "circuit-centric" measure is the gain-bandwidth product of a simple CS amplifier that is loaded by an identical stage. Shown below is the frequency response of such an amplifier, revealing a gain-bandwidth product of about 34 GHz if $W / L=5 \mu \mathrm{~m} / 40 \mathrm{~nm}, R_{D}=5 \mathrm{k} \Omega$, and the bias current is $130 \mu \mathrm{~A}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-188.jpg?height=385&width=498&top_left_y=804&top_left_x=145)

Source followers are occasionally employed as level shifters or buffers, affecting the overall frequency response. Consider the circuit depicted in Fig. 6.22(a), where $C_{L}$ represents the total capacitance seen at the output node to ground, including $C_{S B 1}$. The strong interaction between nodes $X$ and $Y$ through $C_{G S}$ in Fig. 6.22(a) makes it difficult to associate a pole with each node in a source follower. Neglecting channel-length modulation and body effect for simplicity and using the equivalent circuit shown in Fig. 6.22(b), we sum the currents at the output node:

$$
\begin{equation*}
V_{1} C_{G S} s+g_{m} V_{1}=V_{\text {out }} C_{L} s \tag{6.48}
\end{equation*}
$$

obtaining

$$
\begin{equation*}
V_{1}=\frac{C_{L} s}{g_{m}+C_{G S} S} V_{\text {out }} \tag{6.49}
\end{equation*}
$$

Also, noting that the voltage across $C_{G D}$ is equal to $V_{1}+V_{\text {out }}$ and beginning from $V_{i n}$, we add the voltage across $R_{S}$ to $V_{1}$ and $V_{\text {out }}$ :

$$
\begin{equation*}
V_{\text {in }}=R_{S}\left[V_{1} C_{G S} s+\left(V_{1}+V_{\text {out }}\right) C_{G D} s\right]+V_{1}+V_{\text {out }} \tag{6.50}
\end{equation*}
$$

Substituting for $V_{1}$ from (6.49), we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{g_{m}+C_{G S} s}{R_{S}\left(C_{G S} C_{L}+C_{G S} C_{G D}+C_{G D} C_{L}\right) s^{2}+\left(g_{m} R_{S} C_{G D}+C_{L}+C_{G S}\right) s+g_{m}} \tag{6.51}
\end{equation*}
$$

Interestingly, the transfer function contains a zero in the left half plane (and near the $f_{T}$ ). This is because the signal conducted by $C_{G S}$ at high frequencies adds with the same polarity to the signal produced by the intrinsic transistor. We study some special cases below.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-188.jpg?height=406&width=1174&top_left_y=1641&top_left_x=450)

Figure 6.22 (a) Source follower; (b) high-frequency equivalent circuit.

#### Example 6.11

Examine the source follower transfer function if $C_{L}=0$.

#### Solution

We have

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}} & =\frac{g_{m}+C_{G S} s}{R_{S} C_{G S} C_{G D} s^{2}+\left(g_{m} R_{S} C_{G D}+C_{G S}\right) s+g_{m}}  \tag{6.52}\\
& =\frac{g_{m}+C_{G S} s}{\left(1+R_{S} C_{G D} s\right)\left(g_{m}+C_{G S} s\right)}  \tag{6.53}\\
& =\frac{1}{1+R_{S} C_{G D} s} \tag{6.54}
\end{align*}
$$

The circuit now has only one pole at the input. Why does $C_{G S}$ disappear here? This is because, in the absence of channel-length modulation and body effect, the voltage gain from the gate to the source is equal to unity. Since a change of $\Delta V$ at the gate translates to an equal change at the source (Fig. 6.23), no current flows through $C_{G S}$. Consequently, $C_{G S}$ contributes neither a zero nor a pole. We say $C_{G S}$ is "bootstrapped" by the source follower. With $\lambda, \gamma>0$, the output change is less than $\Delta V$, requiring some change in the voltage across $C_{G S}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-189.jpg?height=326&width=410&top_left_y=882&top_left_x=489)

Figure 6.23 Bootstrapping of $C_{G S}$ in a source follower.

If the two poles of (6.51) are assumed far apart, then the lower one has a magnitude of

$$
\begin{align*}
\omega_{p 1} & \approx \frac{g_{m}}{g_{m} R_{S} C_{G D}+C_{L}+C_{G S}}  \tag{6.55}\\
& =\frac{1}{R_{S} C_{G D}+\frac{C_{L}+C_{G S}}{g_{m}}} \tag{6.56}
\end{align*}
$$

Also, if $R_{S}=0$, then $\omega_{p 1}=g_{m} /\left(C_{L}+C_{G S}\right)$ â€”as expected.
Let us now calculate the input impedance of the circuit, noting that $C_{G D}$ simply shunts the input and can be ignored initially. Shown in Fig. 6.24, the equivalent circuit includes body effect, but channel-length modulation can also be added by replacing $1 / g_{m b}$ with $\left(1 / g_{m b}\right) \| r_{O}$. The small-signal gate-source voltage of $M_{1}$ is equal to $I_{X} /\left(C_{G S} s\right)$, giving a source current of $g_{m} I_{X} /\left(C_{G S} s\right)$. Starting from the input and adding
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-189.jpg?height=350&width=521&top_left_y=1933&top_left_x=436)

Figure 6.24 Calculation of source follower input impedance.
the voltages, we have

$$
\begin{equation*}
V_{X}=\frac{I_{X}}{C_{G S} s}+\left(I_{X}+\frac{g_{m} I_{X}}{C_{G S} s}\right)\left(\frac{1}{g_{m b}} \| \frac{1}{C_{L} s}\right) \tag{6.57}
\end{equation*}
$$

that is

$$
\begin{equation*}
Z_{i n}=\frac{1}{C_{G S} S}+\left(1+\frac{g_{m}}{C_{G S} S}\right) \frac{1}{g_{m b}+C_{L} S} \tag{6.58}
\end{equation*}
$$

We consider some special cases. First, if $g_{m b}=0$ and $C_{L}=0$, then $Z_{i n}=\infty$, because $C_{G S}$ is entirely bootstrapped by the source follower and draws no current from the input. Second, at relatively low frequencies, $g_{m b} \gg\left|C_{L} s\right|$ and

$$
\begin{equation*}
Z_{i n} \approx \frac{1}{C_{G S} S}\left(1+\frac{g_{m}}{g_{m b}}\right)+\frac{1}{g_{m b}} \tag{6.59}
\end{equation*}
$$

indicating that the equivalent input capacitance is equal to $C_{G S} g_{m b} /\left(g_{m}+g_{m b}\right)$ and hence quite less than $C_{G S}$. In other words, the overall input capacitance is equal to $C_{G D}$ plus a fraction of $C_{G S}$-again because of bootstrapping.

#### Example 6.12

Apply Miller's approximation to the above circuit if $C_{L}=0$.

#### Solution

As illustrated in Fig. 6.25, the low-frequency gain from the gate to the source is equal to $\left(1 / g_{m b}\right) /\left[\left(1 / g_{m}\right)+\right.$ $\left.\left(1 / g_{m b}\right)\right]=g_{m} /\left(g_{m}+g_{m b}\right)$. The Miller multiplication of $C_{G S}$ at the input is thus equal to $C_{G S}\left[1-g_{m} /\left(g_{m}+g_{m b}\right)\right]=$ $C_{G S} g_{m b} /\left(g_{m}+g_{m b}\right)$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-190.jpg?height=321&width=603&top_left_y=1443&top_left_x=467)

Figure 6.25

At high frequencies, $g_{m b} \ll\left|C_{L} s\right|$ and

$$
\begin{equation*}
Z_{i n} \approx \frac{1}{C_{G S} s}+\frac{1}{C_{L} S}+\frac{g_{m}}{C_{G S} C_{L} s^{2}} \tag{6.60}
\end{equation*}
$$

For a given $s=j \omega$, the input impedance consists of the series combination of capacitors $C_{G S}$ and $C_{L}$ and a negative resistance equal to $-g_{m} /\left(C_{G S} C_{L} \omega^{2}\right)$ (Fig. 6.26). The negative resistance property can be utilized in oscillators (Chapter 15). It is important to bear in mind that a source follower driving a load capacitance exhibits a negative input resistance, possibly causing instability.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-191.jpg?height=333&width=920&top_left_y=251&top_left_x=508)

Figure 6.26 Negative resistance seen at the input of a source follower.

#### Example 6.13

Neglecting channel-length modulation and body effect, calculate the transfer function of the circuit shown in Fig. 6.27(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-191.jpg?height=434&width=1305&top_left_y=869&top_left_x=308)

Figure 6.27

#### Solution

Let us first identify all of the capacitances in the circuit. At node $X, C_{G D 1}$ and $C_{D B 2}$ are connected to ground and $C_{G S 1}$ and $C_{G D 2}$ to $Y$. At node $Y, C_{S B 1}, C_{G S 2}$, and $C_{L}$ are connected to ground. Similar to the source follower of Fig. 6.22(b), this circuit has three capacitances in a loop and hence a second-order transfer function. Using the equivalent circuit shown in Fig. 6.27(b), where $C_{X}=C_{G D 1}+C_{D B 2}, C_{X Y}=C_{G S 1}+C_{G D 2}$, and $C_{Y}=C_{S B 1}+C_{G S 2}+C_{L}$, we have $V_{1} C_{X Y} s+g_{m 1} V_{1}=V_{\text {out }} C_{Y} s$, and hence $V_{1}=V_{\text {out }} C_{Y} s /\left(C_{X Y} s+g_{m 1}\right)$. Also, since $V_{2}=V_{\text {out }}$, the summation of currents at node $X$ gives

$$
\begin{equation*}
\left(V_{1}+V_{\text {out }}\right) C_{X} s+g_{m 2} V_{\text {out }}+V_{1} C_{X Y} s=\frac{V_{\text {in }}-V_{1}-V_{\text {out }}}{R_{S}} \tag{6.61}
\end{equation*}
$$

Substituting for $V_{1}$ and simplifying the result, we obtain

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{g_{m 1}+C_{X Y} s}{R_{S} \xi s^{2}+\left[C_{Y}+g_{m 1} R_{S} C_{X}+\left(1+g_{m 2} R_{S}\right) C_{X Y}\right] s+g_{m 1}\left(1+g_{m 2} R_{S}\right)} \tag{6.62}
\end{equation*}
$$

where $\xi=C_{X} C_{Y}+C_{X} C_{X Y}+C_{Y} C_{X Y}$. As expected, (6.62) reduces to a form similar to (6.51) for $g_{m 2}=0$.

The output impedance of source followers is also of interest. In Fig. 6.22(a), the body effect and $C_{S B}$ simply yield an impedance in parallel with the output. Ignoring this impedance and neglecting $C_{G D}$, we note from the equivalent circuit of Fig. 6.28(a) that $V_{1} C_{G S} s+g_{m} V_{1}=-I_{X}$. Also, $V_{1} C_{G S} s R_{S}+V_{1}=-V_{X}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-192.jpg?height=421&width=1474&top_left_y=238&top_left_x=298)

Figure 6.28 Calculation of source follower output impedance.

Dividing both sides of these equations gives

$$
\begin{align*}
Z_{\text {out }} & =\frac{V_{X}}{I_{X}}  \tag{6.63}\\
& =\frac{R_{S} C_{G S} s+1}{g_{m}+C_{G S} s} \tag{6.64}
\end{align*}
$$

It is instructive to examine the magnitude of this impedance as a function of frequency. At low frequencies, $Z_{\text {out }} \approx 1 / g_{m}$, as expected. At very high frequencies, $Z_{\text {out }} \approx R_{S}$ (because $C_{G S}$ shorts the gate and the source). We therefore surmise that $\left|Z_{\text {out }}\right|$ varies as shown in Figs. 6.28(b) or (c). Which one of these variations is more realistic? Operating as buffers, source followers must lower the output impedance, i.e., $1 / g_{m}<R_{S}$. For this reason, the characteristic shown in Fig. 6.28(c) occurs more commonly than that in Fig. 6.28(b).

The behavior illustrated in Fig. 6.28(c) reveals an important attribute of source followers. Since the output impedance increases with frequency, we postulate that it contains an inductive component. To confirm this guess, we represent $Z_{\text {out }}$ by a first-order passive network, noting that $Z_{\text {out }}$ equals $1 / g_{m}$ at $\omega=0$ and $R_{S}$ at $\omega=\infty$. The network can therefore be realized as shown in Fig. 6.29 because $Z_{1}$ equals $R_{2}$ at $\omega=0$ and $R_{1}+R_{2}$ at $\omega=\infty$. In other words, $Z_{1}=Z_{\text {out }}$ if three conditions hold: $R_{2}=1 / g_{m}$, $R_{1}=R_{S}-1 / g_{m}$, and $L$ is chosen properly.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-192.jpg?height=285&width=436&top_left_y=1676&top_left_x=548)

Figure 6.29 Equivalent output impedance of a source follower.

To calculate $L$, we can simply obtain an expression for $Z_{1}$ in terms of the three components in Fig. 6.29 and equate the result to $Z_{\text {out }}$ found above. Alternatively, since $R_{2}$ is a series component of $Z_{1}$, we can subtract its value from $Z_{\text {out }}$, thereby obtaining an expression for the parallel combination of $R_{1}$ and $L$ :

$$
\begin{equation*}
Z_{\text {out }}-\frac{1}{g_{m}}=\frac{C_{G S} S\left(R_{S}-\frac{1}{g_{m}}\right)}{g_{m}+C_{G S} s} \tag{6.65}
\end{equation*}
$$

Inverting the result to obtain the admittance of the parallel circuit, we have

$$
\begin{equation*}
\frac{1}{Z_{\text {out }}-\frac{1}{g_{m}}}=\frac{1}{R_{S}-\frac{1}{g_{m}}}+\frac{1}{\frac{C_{G S} S}{g_{m}}\left(R_{S}-\frac{1}{g_{m}}\right)} \tag{6.66}
\end{equation*}
$$

We can thus identify the first term on the right-hand side as the inverse of $R_{1}$ and the second term as the inverse of an impedance equal to $\left(C_{G S} s / g_{m}\right)\left(R_{S}-1 / g_{m}\right)$, i.e., an inductor with the value

$$
\begin{equation*}
L=\frac{C_{G S}}{g_{m}}\left(R_{S}-\frac{1}{g_{m}}\right) \tag{6.67}
\end{equation*}
$$

Note that $C_{G S} / g_{m}$ is approximately equal to $\omega_{T}=2 \pi f_{T}$.

#### Example 6.14

Can we construct a (two-terminal) inductor from a source follower?

#### Solution

Yes, we can. Called an "active inductor," such a structure is shown in Fig. 6.30(a), providing an inductance of $\left(C_{G S 2} / g_{m 2}\right)\left(R_{S}-1 / g_{m 2}\right)$. But the inductor is not ideal because it also incurs a parallel resistance equal to $R_{1}=$ $R_{S}=1 / g_{m 2}$ and a series resistance equal to $1 / g_{m 2}$. Figure 6.30(b) depicts an application of active inductors: the inductance can partially cancel the load capacitance, $C_{L}$, at high frequencies, thus extending the bandwidth. However, the voltage headroom consumed by $M_{2}\left(=V_{G S 2}\right)$ limits the gain. Also, $C_{G D 2}$, which has been neglected in our analysis, limits the bandwidth enhancement.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-193.jpg?height=433&width=926&top_left_y=1269&top_left_x=500)

Figure 6.30

## 6.4 â–  Common-Gate Stage

As explained in Example 6.5, in a common-gate stage, the input and output nodes are "isolated" if channellength modulation is neglected. For a common-gate stage such as that in Fig. 6.31, the calculation of Example 6.5 suggested a transfer function

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{\left(g_{m}+g_{m b}\right) R_{D}}{1+\left(g_{m}+g_{m b}\right) R_{S}} \frac{1}{\left(1+\frac{C_{S}}{g_{m}+g_{m b}+R_{S}^{-1}} s\right)\left(1+R_{D} C_{D} s\right)} \tag{6.68}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-194.jpg?height=387&width=377&top_left_y=247&top_left_x=580)

Figure 6.31 Common-gate stage at high frequencies.

An important property of this circuit is that it exhibits no Miller multiplication of capacitances, potentially achieving a wide band. Note, however, that the low input impedance may load the preceding stage. Furthermore, since the voltage drop across $R_{D}$ is typically maximized to obtain a reasonable gain, the dc level of the input signal must be quite low. For these reasons, the CG stage finds two principal applications: as an amplifier in cases where a low input impedance is required (Chapter 3) and in cascode stages.

If channel-length modulation is not negligible, the calculations become quite complex. Recall from Chapter 3 that the input impedance of a common-gate topology does depend on the drain load if $\lambda \neq 0$. From Eq. (3.117), we can express the impedance seen looking into the source of $M_{1}$ in Fig. 6.31 as

$$
\begin{equation*}
Z_{i n} \approx \frac{Z_{L}}{\left(g_{m}+g_{m b}\right) r_{O}}+\frac{1}{g_{m}+g_{m b}} \tag{6.69}
\end{equation*}
$$

where $Z_{L}=R_{D} \|\left[1 /\left(C_{D} s\right)\right]$. Since $Z_{i n}$ now depends on $Z_{L}$, it is difficult to associate a pole with the input node.

#### Example 6.15

For the common-gate stage shown in Fig. 6.32(a), calculate the transfer function and the input impedance, $Z_{i n}$. Explain why $Z_{i n}$ becomes independent of $C_{L}$ as this capacitance increases.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-194.jpg?height=485&width=1218&top_left_y=1520&top_left_x=426)

Figure 6.32

#### Solution

Using the equivalent circuit shown in Fig. 6.32(b), we can write the current through $R_{S}$ as $-V_{\text {out }} C_{L} s+V_{1} C_{\text {in }} s$. Noting that the voltage across $R_{S}$ plus $V_{i n}$ must equal $-V_{1}$, we have

$$
\begin{equation*}
\left(-V_{\text {out }} C_{L} s+V_{1} C_{\text {in }} s\right) R_{S}+V_{\text {in }}=-V_{1} \tag{6.70}
\end{equation*}
$$

That is

$$
\begin{equation*}
V_{1}=-\frac{-V_{\text {out }} C_{L} s R_{S}+V_{\text {in }}}{1+C_{\text {in }} R_{S} s} \tag{6.71}
\end{equation*}
$$

We also observe that the voltage across $r_{O}$ minus $V_{1}$ equals $V_{\text {out }}$ :

$$
\begin{equation*}
r_{O}\left(-V_{\text {out }} C_{L} s-g_{m} V_{1}\right)-V_{1}=V_{\text {out }} \tag{6.72}
\end{equation*}
$$

Substituting for $V_{1}$ from (6.71), we obtain the transfer function:

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{1+g_{m} r_{O}}{r_{O} C_{L} C_{\text {in }} R_{S} s^{2}+\left[r_{O} C_{L}+C_{\text {in }} R_{S}+\left(1+g_{m} r_{O}\right) C_{L} R_{S}\right] s+1} \tag{6.73}
\end{equation*}
$$

The reader can prove that body effect can be included by simply replacing $g_{m}$ with $g_{m}+g_{m b}$. As expected, the gain at very low frequencies is equal to $1+g_{m} r_{O}$. For $Z_{i n}$, we can use (6.69) by replacing $Z_{L}$ with $1 /\left(C_{L} s\right)$, obtaining

$$
\begin{equation*}
Z_{i n}=\frac{1}{g_{m}+g_{m b}}+\frac{1}{C_{L} s} \cdot \frac{1}{\left(g_{m}+g_{m b}\right) r_{O}} \tag{6.74}
\end{equation*}
$$

We note that as $C_{L}$ or $s$ increases, $Z_{i n}$ approaches $1 /\left(g_{m}+g_{m b}\right)$, and hence the input pole can be defined as

$$
\begin{equation*}
\omega_{p, i n}=\frac{1}{\left(R_{S} \| \frac{1}{g_{m}+g_{m b}}\right) C_{i n}} \tag{6.75}
\end{equation*}
$$

Why does $Z_{i n}$ become independent of $C_{L}$ at high frequencies? This is because $C_{L}$ lowers the voltage gain of the circuit, thereby suppressing the effect of the negative resistance introduced by the Miller effect through $r_{O}$ (Fig. 6.7). In the limit, $C_{L}$ shorts the output node to ground, and $r_{O}$ affects the input impedance negligibly.

Our analysis of the CG frequency response has assumed a zero impedance in series with the gate. In practice, the bias network providing the gate voltage exhibits a finite impedance, altering the frequency response. Shown in Fig. 6.33(a) is an example in which this impedance is modeled by a resistor, $R_{G}$. If all of the device capacitances are included here, the circuit's transfer function is of third order. For simplicity, we consider only $C_{G S}$ here and only $C_{G D}$ in Appendix B. From the equivalent circuit in Fig. 6.33(b), ${ }^{4}$ we have $g_{m} V_{1}=-V_{\text {out }} / R_{D}$, and hence $V_{1}=-V_{\text {out }} /\left(g_{m} R_{D}\right)$. The current flowing through $R_{S}$ is equal to $V_{1} C_{G S} s+g_{m} V_{1}=-\left(C_{G S} s+g_{m}\right) V_{o u t} /\left(g_{m} R_{D}\right)$, and that through $R_{G}$ equal to $V_{1} C_{G S} s=$ $-C_{G S} s V_{\text {out }} /\left(g_{m} R_{D}\right)$. Writing a KVL around the input network, we have

$$
\begin{equation*}
V_{\text {in }}-\left(C_{G S}+g_{m}\right) \frac{V_{\text {out }}}{g_{m} R_{D}} R_{S}+\frac{V_{\text {out }}}{g_{m} R_{D}}-C_{G S} s \frac{V_{\text {out }}}{g_{m} R_{D}} R_{G}=0 \tag{6.76}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{g_{m} R_{D}}{\left(R_{G}+R_{S}\right) C_{G S} s+1+g_{m} R_{S}} \tag{6.77}
\end{equation*}
$$

yielding a pole at

$$
\begin{equation*}
\omega_{p}=\frac{1+g_{m} R_{S}}{\left(R_{G}+R_{S}\right) C_{G S}} \tag{6.78}
\end{equation*}
$$

Thus, $R_{G}$ directly adds to $R_{S}$ in this case, lowering the pole magnitude.

[^29]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-196.jpg?height=457&width=1238&top_left_y=240&top_left_x=421)

Figure 6.33 (a) CG stage with resistance in series with gate, and (b) equivalent circuit.

If a common-gate stage is driven by a relatively large source impedance, then the output impedance of the circuit drops at high frequencies. This effect is better described in the context of cascode circuits.

## 6.5 â–  Cascode Stage

As explained in Chapter 3, cascoding proves beneficial in increasing the voltage gain of amplifiers and the output impedance of current sources while providing shielding as well. The invention of the cascode (in the vacuum tube era), however, was motivated by the need for high-frequency amplifiers with a relatively high input impedance. Viewed as a cascade of a common-source stage and a common-gate stage, a cascode circuit offers the speed of the latter-by suppressing the Miller effect-and the input impedance of the former.

Let us consider the cascode shown in Fig. 6.34, first identifying all of the device capacitances. At node $A, C_{G S 1}$ is connected to ground and $C_{G D 1}$ to node $X$. At node $X, C_{D B 1}, C_{S B 2}$, and $C_{G S 2}$ are tied to ground, and at node $Y, C_{D B 2}, C_{G D 2}$, and $C_{L}$ are connected to ground. The Miller effect of $C_{G D 1}$ is determined by the gain from $A$ to $X$. As an approximation, we use the low-frequency value of this gain, which for low values of $R_{D}$ (or negligible channel-length modulation) is equal to $-g_{m 1} /\left(g_{m 2}+g_{m b 2}\right)$. Thus, if $M_{1}$ and $M_{2}$ have roughly equal dimensions, $C_{G D 1}$ is multiplied by approximately 2 rather than the large
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-196.jpg?height=603&width=644&top_left_y=1676&top_left_x=441)

Figure 6.34 High-frequency model of a cascode stage.
voltage gain in a simple common-source stage. We therefore say that the Miller effect is less significant in cascode amplifiers than in common-source stages. The pole associated with node $A$ is estimated as

$$
\begin{equation*}
\omega_{p, A}=\frac{1}{R_{S}\left[C_{G S 1}+\left(1+\frac{g_{m 1}}{g_{m 2}+g_{m b 2}}\right) C_{G D 1}\right]} \tag{6.79}
\end{equation*}
$$

We can also attribute a pole to node $X$. The total capacitance at this node is roughly equal to $2 C_{G D 1}+$ $C_{D B 1}+C_{S B 2}+C_{G S 2}$, giving a pole

$$
\begin{equation*}
\omega_{p, X}=\frac{g_{m 2}+g_{m b 2}}{2 C_{G D 1}+C_{D B 1}+C_{S B 2}+C_{G S 2}} \tag{6.80}
\end{equation*}
$$

How does this pole compare with $2 \pi f_{T} \approx g_{m 2} / C_{G S 2}$ ? The other capacitances in the denominator reduce the magnitude of $\omega_{p, X}$ to roughly $2 \pi f_{T} / 2$. Finally, the output node yields a third pole:

$$
\begin{equation*}
\omega_{p, Y}=\frac{1}{R_{D}\left(C_{D B 2}+C_{L}+C_{G D 2}\right)} \tag{6.81}
\end{equation*}
$$

The relative magnitudes of the three poles in a cascode circuit depend on the actual design parameters, but $\omega_{p, X}$ is typically quite a lot higher than the other two.

But what if $R_{D}$ in Fig. 6.34 is replaced by a current source so as to achieve a higher dc gain? We know from Chapter 3 that the impedance seen at node $X$ reaches high values if the load impedance at the drain of $M_{2}$ is large. For example, Eq. (3.117) predicts that the pole at node $X$ may be quite a lot lower than $\left(g_{m 2}+g_{m b 2}\right) / C_{X}$ if $R_{D}$ itself is the output impedance of a PMOS cascode current source. Interestingly, however, the overall transfer function is negligibly affected by this phenomenon. This can be better seen by an example.

#### Example 6.16

Consider the cascode stage shown in Fig. 6.35(a), where the load resistor is replaced by an ideal current source. Neglecting the capacitances associated with $M_{1}$, representing $V_{i n}$ and $M_{1}$ by a Norton equivalent as in Fig. 6.35(b), and assuming $\gamma=0$, compute the transfer function.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-197.jpg?height=579&width=1097&top_left_y=1657&top_left_x=420)

Figure 6.35 Simplified model of a cascode stage.

#### Solution

Since the current through $C_{X}$ is equal to $-V_{\text {out }} C_{Y} s-I_{\text {in }}$, we have $V_{X}=-\left(V_{\text {out }} C_{Y} s+I_{i n}\right) /\left(C_{X} s\right)$, and the smallsignal drain current of $M_{2}$ is $-g_{m 2}\left(-V_{\text {out }} C_{Y} s-I_{\text {in }}\right) /\left(C_{X} s\right)$. The current through $r_{O 2}$ is then equal to $-V_{\text {out }} C_{Y} s-$ $g_{m 2}\left(V_{\text {out }} C_{Y} s+I_{\text {in }}\right) /\left(C_{X} s\right)$. Noting that $V_{X}$ plus the voltage drop across $r_{O 2}$ is equal to $V_{\text {out }}$, we write

$$
\begin{equation*}
-r_{O 2}\left[\left(V_{\text {out }} C_{Y} s+I_{\text {in }}\right) \frac{g_{m 2}}{C_{X} s}+V_{\text {out }} C_{Y} s\right]-\left(V_{\text {out }} C_{Y} s+I_{\text {in }}\right) \frac{1}{C_{X} s}=V_{\text {out }} \tag{6.82}
\end{equation*}
$$

That is

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=-\frac{g_{m 2} r_{O 2}+1}{C_{X} s} \cdot \frac{1}{1+\left(1+g_{m 2} r_{O 2}\right) \frac{C_{Y}}{C_{X}}+C_{Y} r_{O 2} s} \tag{6.83}
\end{equation*}
$$

which, for $g_{m 2} r_{O 2} \gg 1$ and $g_{m 2} r_{O 2} C_{Y} / C_{X} \gg 1$ (i.e., $C_{Y}>C_{X}$ ), reduces to

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}} \approx-\frac{g_{m 2}}{C_{X} s} \frac{1}{\frac{C_{Y}}{C_{X}} g_{m 2}+C_{Y} s} \tag{6.84}
\end{equation*}
$$

and hence

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=-\frac{g_{m 1} g_{m 2}}{C_{Y} C_{X} s} \frac{1}{g_{m 2} / C_{X}+s} \tag{6.85}
\end{equation*}
$$

The magnitude of the pole at node $X$ is still given by $g_{m 2} / C_{X}$. This is because at high frequencies (as we approach this pole), $C_{Y}$ shunts the output node, dropping the gain and suppressing the Miller effect of $r_{O 2}$.

If a cascode structure is used as a current source, then the variation of its output impedance with frequency is of interest. Neglecting $C_{G D 1}$ and $C_{Y}$ in Fig. 6.35(a), we have

$$
\begin{equation*}
Z_{\text {out }}=\left(1+g_{m 2} r_{O 2}\right) Z_{X}+r_{O 2} \tag{6.86}
\end{equation*}
$$

where $Z_{X}=r_{O 1} \|\left(C_{X} s\right)^{-1}$. Thus, $Z_{\text {out }}$ contains a pole at $\left(r_{O 1} C_{X}\right)^{-1}$ and falls at frequencies higher than this value.

## 6.6 â–  Differential Pair

The versatility of differential pairs and their extensive use in analog systems motivate us to characterize their frequency response for both differential and common-mode signals.

### 6.6.1 Differential Pair with Passive Loads

Consider the simple differential pair shown in Fig. 6.36(a), with the differential half circuit and the common-mode equivalent circuit depicted in Figs. 6.36(b) and (c), respectively. For differential signals, the response is identical to that of a common-source stage, exhibiting Miller multiplication of $C_{G D}$. Note that since $+V_{i n 2} / 2$ and $-V_{i n 2} / 2$ are multiplied by the same transfer function, the number of poles in $V_{\text {out }} / V_{\text {in }}$ is equal to that of each path (rather than the sum of the number of poles in the two paths).

For common-mode signals, the total capacitance at node $P$ in Fig. 6.36(c) determines the highfrequency gain. Arising from $C_{G D 3}, C_{D B 3}, C_{S B 1}$, and $C_{S B 2}$, this capacitance can be quite substantial if $M_{1}-M_{3}$ are wide transistors. For example, limited voltage headroom often necessitates that $W_{3}$ be so large
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-199.jpg?height=493&width=1466&top_left_y=243&top_left_x=240)

Figure 6.36 (a) Differential pair; (b) half-circuit equivalent; (c) equivalent circuit for common-mode inputs.
that $M_{3}$ does not require a large drain-source voltage for operating in the saturation region. If only the mismatch between $M_{1}$ and $M_{2}$ is considered, the high-frequency common-mode gain can be calculated with the aid of Eq. (4.53). We replace $r_{O 3}$ with $r_{O 3} \|\left[1 /\left(C_{P} s\right)\right]$ and $R_{D}$ by $R_{D} \|\left[1 /\left(C_{L} s\right)\right]$, where $C_{L}$ denotes the total capacitance seen at each output node. ${ }^{5}$ Thus,

$$
\begin{equation*}
A_{v, C M}=-\frac{\Delta g_{m}\left[R_{D} \|\left(\frac{1}{C_{L} s}\right)\right]}{\left(g_{m 1}+g_{m 2}\right)\left[r_{O 3} \|\left(\frac{1}{C_{P} S}\right)\right]+1} \tag{6.87}
\end{equation*}
$$

This result suggests that the common-mode rejection of the circuit degrades considerably at high frequencies. In fact, writing the CMRR from Chapter 4 for this case gives

$$
\begin{align*}
\mathrm{CMRR} & \approx \frac{g_{m}}{\Delta g_{m}}\left[1+2 g_{m}\left(r_{O 3} \| \frac{1}{C_{P} s}\right)\right]  \tag{6.88}\\
& \approx \frac{g_{m}}{\Delta g_{m}} \frac{r_{O 3} C_{P} s+1+2 g_{m} r_{O 3}}{r_{O 3} C_{P} s+1} \tag{6.89}
\end{align*}
$$

where $g_{m}=\left(g_{m 1}+g_{m 2}\right) / 2$. We observe that this transfer function contains a zero at $\left(1+2 g_{m 3} r_{O 3}\right) /$ $\left(r_{O 3} C_{P}\right)$ and a pole at $1 /\left(r_{O 3} C_{P}\right)$. Since $2 g_{m 3} r_{O 3} \gg 1$, the magnitude of the zero is much greater than the pole and approximately equal to $2 g_{m 3} / C_{P}$. The CMRR response thus appears as shown in Fig. 6.37.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-199.jpg?height=439&width=626&top_left_y=1742&top_left_x=384)

Figure 6.37 CMRR for a differential pair vs. frequency.

[^30]As illustrated in Fig. 6.38, if the supply voltage contains high-frequency noise and the circuit exhibits mismatches, the resulting common-mode disturbance at node $P$ translates to a differential noise component at the output. This effect becomes more pronounced as the noise frequency exceeds $1 /\left(2 \pi r_{O 3} C_{P}\right)$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-200.jpg?height=444&width=903&top_left_y=454&top_left_x=555)

Figure 6.38 Effect of high-frequency supply noise in differential pairs.
We should emphasize that the circuit of Fig. 6.36(a) suffers from a trade-off between voltage headroom and CMRR. To minimize the headroom consumed by $M_{3}$, its width is maximized, introducing substantial capacitance at the sources of $M_{1}$ and $M_{2}$ and degrading the high-frequency CMRR. The issue becomes more serious at low supply voltages.

We now study the frequency response of differential pairs with high-impedance loads. Shown in Fig. 6.39(a) is a fully differential implementation. As with the topology of Fig. 6.36, this circuit can be analyzed for differential and common-mode signals separately. Note that here $C_{L}$ includes the drain junction capacitance and the gate-drain overlap capacitance of each PMOS transistor as well. Also,
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-200.jpg?height=815&width=1231&top_left_y=1393&top_left_x=396)

Figure 6.39 (a) Differential pair with current-source loads; (b) effect of differential swings at node $G$; (c) half-circuit equivalent.
as depicted in Fig. 6.39(b) for differential output signals, $C_{G D 3}$ and $C_{G D 4}$ conduct equal and opposite currents to node $G$, making this node an ac ground. (In practice, node $G$ is still bypassed to ground by means of a capacitor.)

The differential half circuit is depicted in Fig. 6.39(c), with the output resistance of $M_{1}$ and $M_{3}$ shown explicitly. This topology implies that Eq. (6.30) can be applied to this circuit if $R_{L}$ is replaced by $r_{O 1} \| r_{O 3}$. In practice, the relatively high value of this resistance makes the output pole, given by $\left[\left(r_{O 1} \| r_{O 3}\right) C_{L}\right]^{-1}$, the "dominant" pole. We return to this observation in Chapter 10. The common-mode behavior of the circuit is similar to that of Fig. 6.36(c).

### 6.6.2 Differential Pair with Active Load

Let us now consider a differential pair with an active current mirror (Fig. 6.40). How many poles does this circuit have? In contrast to the fully differential configuration of Fig. 6.39(a), this topology contains two signal paths with different transfer functions. The path consisting of $M_{3}$ and $M_{4}$ includes a pole at node $E$, approximately given by $g_{m 3} / C_{E}$, where $C_{E}$ denotes the total capacitance from $E$ to ground. This capacitance arises from $C_{G S 3}, C_{G S 4}, C_{D B 3}, C_{D B 1}$, and the Miller effect of $C_{G D 1}$ and $C_{G D 4}$. Even if only $C_{G S 3}$ and $C_{G S 4}$ are considered, the severe trade-off between $g_{m}$ and $C_{G S}$ of PMOS devices results in a pole that impacts the performance of the circuit. The pole associated with node $E$ is called a "mirror pole." Note that, as with the circuit of Fig. 6.39(a), both signal paths shown in Fig. 6.40 contain a pole at the output node.

In order to estimate the frequency response of the differential pair with an active current mirror, we construct the simplified model depicted in Fig. 6.41(a), where all other capacitances are neglected.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-201.jpg?height=1039&width=1348&top_left_y=1171&top_left_x=297)

Figure 6.41 (a) Simplified high-frequency model of differential pair with active current mirror; (b) circuit of (a) with a Thevenin equivalent.

Replacing $V_{i n}, M_{1}$, and $M_{2}$ by a Thevenin equivalent, we arrive at the circuit of Fig. 6.41(b), where $V_{X}=g_{m N} r_{O N} V_{i n}$ and $R_{X}=2 r_{O N}$ (why?). Here, the subscripts $P$ and $N$ refer to PMOS and NMOS devices, respectively, and we have assumed that $1 / g_{m P} \ll r_{O P}$. The small-signal voltage at $E$ is equal to

$$
\begin{equation*}
V_{E}=\left(V_{\text {out }}-V_{X}\right) \frac{\frac{1}{C_{E} S+g_{m P}}}{\frac{1}{C_{E} S+g_{m P}}+R_{X}} \tag{6.90}
\end{equation*}
$$

and the small-signal drain current of $M_{4}$ is $g_{m 4} V_{E}$. Noting that $-g_{m 4} V_{E}-I_{X}=V_{\text {out }}\left(C_{L} s+r_{O P}^{-1}\right)$, we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{g_{m N} r_{O N}\left(2 g_{m P}+C_{E} s\right) r_{O P}}{2 r_{O P} r_{O N} C_{E} C_{L} s^{2}+\left[\left(2 r_{O N}+r_{O P}\right) C_{E}+r_{O P}\left(1+2 g_{m P} r_{O N}\right) C_{L}\right] s+2 g_{m P}\left(r_{O N}+r_{O P}\right)} \tag{6.91}
\end{equation*}
$$

Since the mirror pole is typically much higher in magnitude than the output pole, we can utilize the results of Eq. (6.34) to write

$$
\begin{equation*}
\omega_{p 1} \approx \frac{2 g_{m P}\left(r_{O N}+r_{O P}\right)}{\left(2 r_{O N}+r_{O P}\right) C_{E}+r_{O P}\left(1+2 g_{m P} r_{O N}\right) C_{L}} \tag{6.92}
\end{equation*}
$$

Neglecting the first term in the denominator and assuming that $2 g_{m P} r_{O N} \gg 1$, we have

$$
\begin{equation*}
\omega_{p 1} \approx \frac{1}{\left(r_{O N} \| r_{O P}\right) C_{L}} \tag{6.93}
\end{equation*}
$$

an expected result. The second pole is then given by

$$
\begin{equation*}
\omega_{p 2} \approx \frac{g_{m P}}{C_{E}} \tag{6.94}
\end{equation*}
$$

which is also expected.
An interesting point revealed by Eq. (6.91) is a zero with a magnitude of $2 g_{m P} / C_{E}$ in the left half plane. The appearance of such a zero can be understood by noting that the circuit consists of a "slow path" $\left(M_{1}, M_{3}\right.$, and $\left.M_{4}\right)$ in parallel with a "fast path" ( $M_{1}$ and $M_{2}$ ). Representing the two by $A_{0} /[(1+$ $\left.\left.s / \omega_{p 1}\right)\left(1+s / \omega_{p 2}\right)\right]$ and $A_{0} /\left(1+s / \omega_{p 1}\right)$, respectively, we have

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}} & =\frac{A_{0}}{1+s / \omega_{p 1}}\left(\frac{1}{1+s / \omega_{p 2}}+1\right)  \tag{6.95}\\
& =\frac{A_{0}\left(2+s / \omega_{p 2}\right)}{\left(1+s / \omega_{p 1}\right)\left(1+s / \omega_{p 2}\right)} \tag{6.96}
\end{align*}
$$

That is, the system exhibits a zero at $2 \omega_{p 2}$. The zero can also be obtained by the method of Fig. 6.18 (Problem 6.15).

Comparing the circuits of Figs. 6.39(a) and 6.40, we conclude that the former entails no mirror pole, another advantage of fully differential circuits over single-ended topologies.

#### Example 6.17

Not all fully differential circuits are free from mirror poles. Figure 6.42(a) illustrates an example where current mirrors $M_{3}-M_{5}$ and $M_{4}-M_{6}$ "fold" the signal current. Estimate the low-frequency gain and the transfer function of this circuit.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-203.jpg?height=995&width=1466&top_left_y=240&top_left_x=240)

Figure 6.42

#### Solution

Neglecting channel-length modulation and using the differential half circuit shown in Fig. 6.42(b), we observe that $M_{5}$ multiplies the drain current of $M_{3}$ by $K$, yielding an overall low-frequency voltage gain $A_{v}=g_{m 1} K R_{D}$.

To obtain the transfer function, we utilize the equivalent circuit depicted in Fig. 6.42(c), including a source resistance $R_{S}$ for completeness. To simplify calculations, we assume that $R_{D} C_{L}$ is relatively small so that the Miller multiplication of $C_{G D 5}$ can be approximated as $C_{G D 5}\left(1+g_{m 5} R_{D}\right)$. The circuit thus reduces to that in Fig. 6.42(d), where $C_{X} \approx C_{G S 3}+C_{G S 5}+C_{D B 3}+C_{G D 5}\left(1+g_{m 5} R_{D}\right)+C_{D B 1}$. The overall transfer function is then equal to $V_{X} / V_{\text {in1 }}$ multiplied by $V_{\text {out } 1} / V_{X}$. The former is readily obtained from (6.30) by replacing $R_{D}$ with $1 / g_{m 3}$ and $C_{D B}$ with $C_{X}$, while the latter is

$$
\begin{equation*}
\frac{V_{\text {out } 1}}{V_{X}}(s)=-g_{m 5} R_{D} \frac{1}{1+R_{D} C_{L} s} \tag{6.97}
\end{equation*}
$$

Note that we have neglected the zero due to $C_{G D 5}$.

## 6.7 â–  Gain-Bandwidth Trade-Offs

In many applications, we wish to maximize both the gain and the bandwidth of amplifiers. For example, optical communication receivers employ an amplifier that must achieve a high gain and a wide bandwidth. This section deals with gain-bandwidth trade-offs encountered in high-speed design. As shown in Fig. 6.43, we are interested in both the $-3-\mathrm{dB}$ bandwidth, $\omega_{-3 d B}$, and the "unity-gain" bandwidth, $\omega_{u}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-204.jpg?height=365&width=716&top_left_y=240&top_left_x=405)

Figure 6.43 Frequency response showing $-3-\mathrm{dB}$ and unity-gain bandwidths.

### 6.7.1 One-Pole Circuits

In some circuits, the load capacitance seen at the output node produces a dominant pole, allowing a one-pole approximation. That is, we can say that the $-3-\mathrm{dB}$ bandwidth is equal to the pole frequency. For example, the CS stage of Fig. 6.44 exhibits an output pole given by $\omega_{p}=\left[\left(r_{O 1} \| r_{O 2}\right) C_{L}\right]^{-1}$ if other capacitances are neglected. Noting that the low-frequency gain is equal to $\left|A_{0}\right|=g_{m 1}\left(r_{O 1}| | r_{O 2}\right)$, we define the "gain-bandwidth" product (GBW) as

$$
\begin{align*}
\mathrm{GBW} & =A_{0} \omega_{p}  \tag{6.98}\\
& =g_{m 1}\left(r_{O 1} \| r_{O 2}\right) \frac{1}{2 \pi\left(r_{O 1} \| r_{O 2}\right) C_{L}}  \tag{6.99}\\
& =\frac{g_{m 1}}{2 \pi C_{L}}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-204.jpg?height=310&width=401&top_left_y=1310&top_left_x=568)

Figure 6.44 CS stage with one pole.
As an example, if $g_{m 1}=(100 \Omega)^{-1}$ and $C_{L}=50 \mathrm{fF}$, then GBW $=31.8 \mathrm{GHz}$. For a one-pole system, the gain-bandwidth product is approximately equal to the unity-gain bandwidth; this can be seen by writing

$$
\begin{equation*}
\frac{A_{0}}{\sqrt{1+\left(\frac{\omega_{u}}{\omega_{p}}\right)^{2}}}=1 \tag{6.101}
\end{equation*}
$$

and hence

$$
\begin{align*}
\omega_{u} & =\sqrt{A_{0}^{2}-1} \omega_{p}  \tag{6.102}\\
& \approx A_{0} \omega_{p} \tag{6.103}
\end{align*}
$$

if $A_{0}^{2} \gg 1$.

#### Example 6.18

Does cascoding increase the GBW product? Assume that the output pole is dominant.

#### Solution

No, it does not. Equation (6.100) suggests that the GBW product is independent of the output resistance. More specifically, if cascoding in Fig. 6.44 raises the output impedance by a factor of $K$, then $\left|A_{0}\right|\left(=G_{m} R_{\text {out }}\right)$ rises and $\omega_{p}$ fafls, both by a factor of $K$, yielding a constant GBW product.

### 6.7.2 Multi-Pole Circuits

It is possible to increase the GBW product by cascading two or more gain stages. Consider the amplifier shown in Fig. 6.45, where, for simplicity, we assume that the two stages are identical and neglect other capacitances. Associating one pole with each node, we write the transfer function as $\left(V_{\text {out }} / V_{X}\right)\left(V_{X} / V_{\text {in }}\right)$ :

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{A_{0}^{2}}{\left(1+\frac{s}{\omega_{p}}\right)^{2}} \tag{6.104}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-205.jpg?height=316&width=692&top_left_y=1020&top_left_x=348)

Figure 6.45 Cascaded CS stages.
where $A_{0}=g_{m N}\left(r_{O N} \| r_{O P}\right)$ and $\omega_{\underline{p}}=\left[\left(r_{O N} \| r_{O P}\right) C_{L}\right]^{-1}$. To obtain the $-3-\mathrm{dB}$ bandwidth, we equate the magnitude of $V_{\text {out }} / V_{\text {in }}$ to $A_{0}^{2} / \sqrt{2}$ :

$$
\begin{equation*}
\frac{A_{0}^{2}}{1+\frac{\omega_{-3 d B}^{2}}{\omega_{p}^{2}}}=\frac{A_{0}^{2}}{\sqrt{2}} \tag{6.105}
\end{equation*}
$$

and

$$
\begin{align*}
\omega_{-3 d B} & =\sqrt{\sqrt{2}-1} \omega_{p}  \tag{6.106}\\
& \approx 0.64 \omega_{p} \tag{6.107}
\end{align*}
$$

The GBW product thus rises to

$$
\begin{equation*}
\mathrm{GBW}=\sqrt{\sqrt{2}-1} A_{0}^{2} \omega_{p} \tag{6.108}
\end{equation*}
$$

a factor of $0.64 A_{0}$ greater than that in Eq. (6.103). Of course, the power consumption is doubled.
While raising the GBW product, cascading reduces the bandwidth, as evidenced by Eq. (6.107). In fact, we prove in Problem 6.25 that for $N$ identical stages,

$$
\begin{equation*}
\omega_{-3 d B}=\sqrt{\sqrt[N]{2}-1} \omega_{p} \tag{6.109}
\end{equation*}
$$

observing a steady decline in the bandwidth as $N$ increases. Another disadvantage of cascading is that the resulting multiple poles lead to instability if the circuit is placed in a negative-feedback loop (Chapter 10).

## 6.8 - Appendix A: Extra Element Theorem

Introduced by Middlebrook [1], the extra element theorem (EET) proves useful in calculating some transfer functions. Suppose the transfer function of a circuit is known and denoted by $H(s)$. Now, as shown in Fig. 6.46(a), we add an extra impedance $Z_{1}$ between two nodes of the circuit. We wish to determine the new transfer function, $G(s)$. Middlebrook proves that

$$
\begin{equation*}
G(s)=H(s) \frac{1+\frac{Z_{\text {out }, 0}}{Z_{1}}}{1+\frac{Z_{\text {in }, 0}}{Z_{1}}} \tag{6.110}
\end{equation*}
$$

i.e., the original transfer function is multiplied by a "correction factor." The terms $Z_{\text {out }, 0}$ and $Z_{\text {in }, 0}$ are quantities measured between nodes $A$ and $B$ in the absence of $Z_{1}$. The former is computed as depicted in Fig. 6.46(b): we apply a voltage source between $A$ and $B$ while $V_{i n}$ is present and choose their values so that $V_{\text {out }}=0$; then $Z_{\text {out }, 0}=V_{1} / I_{1}$. This calculation appears rather complex and unintuitive, but, as shown below, it is in fact quite simple. We should also remark that $Z_{\text {out }, 0}$ is not an impedance in the standard sense because it is obtained with a finite $V_{i n}$. The latter, $Z_{i n, 0}$, is simply equal to the impedance seen between $A$ and $B$ when $V_{i n}=0[$ Fig. 6.46(c)].
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-206.jpg?height=446&width=1476&top_left_y=1255&top_left_x=299)

Figure 6.46 (a) Circuit with extra parallel element, $Z_{1}$, (b) $Z_{\text {out }, 0}$ calculation, and (c) $Z_{\text {in }, 0}$ calculation.

This theorem is particularly useful for frequency-response analysis because we can begin with no capacitances in the circuit, find $H(s)$ as the low-frequency gain, add the capacitors one by one, and calculate the correction factors. Note that $H(s)$ cannot be zero or infinity because the EET's proof relies on division by $H(s)$.

#### Example 6.19

Using the EET, find the transfer function of the circuit in Fig. 6.47(a).

#### Solution

We first consider the circuit without $C_{F}$ and write $H(s)=-g_{m}\left(R_{D} \| r_{O}\right)$. Next, we find $Z_{\text {out }, 0}$ using the setup shown in Fig. 6.47(b), exploiting the condition that $V_{\text {out }}$ is zero and so is the current through $R_{D}$. Since $V_{\text {out }}=0$, we have $V_{G S}=V_{1}$ and $I_{1}=-g_{m} V_{G S}=-g_{m} V_{1}$. That is, $Z_{\text {out }, 0}=-1 / g_{m}$. Note that we resisted the temptation to
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-207.jpg?height=451&width=1545&top_left_y=238&top_left_x=229)

Figure 6.47
write equations involving $V_{i n}$. Also, the negative sign of $Z_{\text {out }, 0}$ does not imply a negative impedance between $A$ and $B$ because $V_{\text {in }} \neq 0$.

For $Z_{i n, 0}$, we have from Fig. 6.47(c), $V_{A}=I_{1} R_{S}=V_{G S}$. A KCL at node $B$ gives the current through $R_{D}$ as $g_{m} I_{1} R_{S}+I_{1}$, and a KVL across $R_{D}, V_{1}$, and $R_{S}$ leads to $I_{1} R_{D}\left(1+g_{m} R_{S}\right)-V_{1}+I_{1} R_{S}=0$. It follows that $Z_{i n, 0}=\left(1+g_{m} R_{S}\right) R_{D}+R_{S}=\left(1+g_{m} R_{D}\right) R_{S}+R_{D}$ and

$$
\begin{equation*}
G(s)=-g_{m}\left(R_{D} \| r_{O}\right) \frac{1-\frac{1}{g_{m}} C_{F} s}{1+\left[\left(1+g_{m} R_{D}\right) R_{S}+R_{D}\right] C_{F} s} \tag{6.111}
\end{equation*}
$$

We see that the EET beautifully predicts the zero and the pole produced by $C_{F}$.

#### Example 6.20

Repeat the above example while including both $C_{F}$ and a capacitor, $C_{B}$, from node $B$ to ground.

#### Solution

Since we have already obtained the transfer function with $C_{F}$ present, we must seek the $Z_{\text {out }, 0}$ and $Z_{i n, 0}$ corresponding to $C_{B}$. The arrangement depicted in Fig. 6.48(a) suggests that $Z_{\text {out }, 0}=0$ because the drain voltage must be zero while $V_{1}$ is not, requiring an infinite current to flow through $V_{1}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-207.jpg?height=429&width=1151&top_left_y=1591&top_left_x=388)

Figure 6.48
For $Z_{i n, 0}$, we note from Fig. 6.48(b) that $V_{G S}=V_{1} R_{S} C_{F} s /\left(R_{S} C_{F} s+1\right)$ and the current flowing through $C_{F}$ is equal to $V_{1} /\left[\left(C_{F} s\right)^{-1}+R_{S}\right]$. A KCL at the drain node gives

$$
\begin{equation*}
\frac{V_{1}}{R_{D}}+\frac{V_{1} C_{F} s}{R_{S} C_{F} s+1}+g_{m} V_{1} \frac{R_{S} C_{F} s}{R_{S} C_{F} s+1}=I_{1} \tag{6.112}
\end{equation*}
$$

Thus,

$$
\begin{equation*}
Z_{i n, 0}=\frac{R_{D}\left(R_{S} C_{F} s+1\right)}{\left[R_{S}\left(1+g_{m} R_{D}\right)+R_{D}\right] C_{F} s+1} \tag{6.113}
\end{equation*}
$$

Using Eq. (6.111), we write the new transfer function as

$$
\begin{align*}
G(s) & =-g_{m}\left(R_{D} \| r_{O}\right) \frac{1-\frac{C_{F}}{g_{m}} s}{1+\left[\left(1+g_{m} R_{D}\right) R_{S}+R_{D}\right] C_{F} s} \frac{1}{1+\frac{R_{D}\left(R_{S} C_{F} s+1\right) C_{B} s}{\left[R_{S}\left(1+g_{m} R_{D}\right)+R_{D}\right] C_{F} s+1}} \\
& =-g_{m}\left(R_{D} \| r_{O}\right) \frac{1-\frac{C_{F}}{g_{m}} s}{\left[R_{S}\left(1+g_{m} R_{D}\right)+R_{D}\right] C_{F} s+R_{D}\left(R_{S} C_{F} s+1\right) C_{B} s+1} \tag{6.114}
\end{align*}
$$

The EET can also be expressed for series elements [1]. That is, if the transfer function of a circuit is $H(s)$ before we insert an element, $Z_{1}$, in series with a branch, then the new transfer function is given by [1]

$$
\begin{equation*}
G(s)=H(s) \frac{1+\frac{Z_{1}}{Z_{\text {out }, 0}}}{1+\frac{Z_{1}}{Z_{\text {in }, 0}}} \tag{6.115}
\end{equation*}
$$

## 6.9 - Appendix B: Zero-Value Time Constant Method

Our analysis of frequency response in this chapter reveals considerable mathematical labor when the number of poles exceeds two. In some cases, we are content with estimating the dominant pole-if one exists-or the $-3-\mathrm{dB}$ bandwidth of the circuit. The "zero-value time constant" (ZVTC) method provides an approximation of these quantities. It also proves useful as an additional analysis tool.

Before delving into the ZVTC method, let us make an observation. Suppose a circuit contains one capacitor and no other storage elements and we wish to determine the pole of the system [Fig. 6.49(a)]. We can derive the transfer function $V_{\text {out }}(s) / V_{\text {in }}(s)$ and examine its denominator, $D(s)$. Alternatively, as shown in Fig. 6.49(b), we can set the input to zero, compute the resistance, $R_{1}$, seen by $C_{1}$, and express
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-208.jpg?height=478&width=1195&top_left_y=1774&top_left_x=440)

Figure 6.49 (a) General circuit containing one capacitor, and (b) resistance seen by $C_{1}$.
the pole as $1 /\left(R_{1} C_{1}\right)$. In Problem 6.23 , we prove why this is true, but the important point here is that this method often simplifies the analysis.

#### Example 6.21

A CG stage contains a resistance $R_{G}$ in series with the gate [Fig. 6.50(a)]. If only $C_{G D}$ is considered, determine the pole frequency.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-209.jpg?height=426&width=1235&top_left_y=548&top_left_x=348)

Figure 6.50

#### Solution

As illustrated in Fig. 6.50(b), we remove $C_{G D}$, set $V_{i n}$ to zero, and apply a voltage (or current) source to measure the resistance seen by this capacitor. The voltage across $R_{S}$ is equal to $g_{m} V_{1} R_{S}$, yielding

$$
\begin{equation*}
g_{m} V_{1} R_{S}+V_{1}=-I_{X} R_{G} \tag{6.116}
\end{equation*}
$$

and hence $V_{1}=-I_{X} R_{G} /\left(1+g_{m} R_{S}\right)$. Since the current flowing through $R_{D}$ is equal to $I_{X}-g_{m} V_{1}$, we have

$$
\begin{equation*}
-I_{X} R_{G}+V_{X}=\left(I_{X}-g_{m} V_{1}\right) R_{D} \tag{6.117}
\end{equation*}
$$

Substituting for $V_{1}$, we obtain

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=R_{D}+\left(\frac{g_{m} R_{D}}{1+g_{m} R_{S}}+1\right) R_{G}=R_{e q} \tag{6.118}
\end{equation*}
$$

The pole is given by $1 /\left(R_{e q} C_{G D}\right)$. The reader is encouraged to determine the circuit's transfer function directly and compare the mathematical labor.

Interestingly, as a result of $R_{G}$, the resistance seen by $C_{G D}$ rises from $R_{D}$ to $R_{D}$ plus a multiple of $R_{G}$, the multiple given by the low-frequency gain of the CG stage plus 1. It is also interesting to note that the circuit of Fig. 6.50(a) does not lend itself to Miller's approximation (why?).

As our first step toward developing the ZVTC method, let us determine the transfer function of the simple second-order circuit shown in Fig. 6.51. Since the current through $R_{2}$ is equal to $V_{\text {out }} C_{2} s$, and hence $V_{X}=R_{2} V_{\text {out }} C_{2} s+V_{\text {out }}$, we obtain the current through $C_{1}$ as $V_{X} C_{1} s=\left(1+R_{2} C_{2} s\right) C_{1} s V_{\text {out }}$. This current and that through $R_{2}$ flow through $R_{1}$, producing a voltage drop equal to $R_{1}\left(1+R_{2} C_{2} s\right) C_{1} s V_{\text {out }}+$ $R_{1} V_{\text {out }} C_{2}$ s. Writing a KVL around $V_{\text {in }}, R_{1}, R_{2}$, and $V_{\text {out }}$ gives

$$
\begin{equation*}
V_{\text {in }}=R_{1}\left(1+R_{2} C_{2} s\right) C_{1} s V_{\text {out }}+R_{1} C_{2} s V_{\text {out }}+R_{2} V_{\text {out }} C_{2} s+V_{\text {out }} \tag{6.119}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-210.jpg?height=206&width=562&top_left_y=245&top_left_x=487)

Figure 6.51 Second-order RC circuit.

It follows that

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}(s)=\frac{1}{R_{1} R_{2} C_{1} C_{2} s^{2}+\left[R_{1} C_{1}+\left(R_{1}+R_{2}\right) C_{2}\right] s+1} \tag{6.120}
\end{equation*}
$$

Recall from Sec. 6.2 that, if a dominant pole exists, then it is given by the inverse of the coefficient of $s$, $B_{s}$. We now focus on this coefficient, noting that it must have a time dimension and is therefore the sum of time constants. The first time constant, $R_{1} C_{1}$, contains a resistance equal to the resistance seen by $C_{1}$ as if $C_{2}$ were zero. ${ }^{6}$ Similarly, the second time constant, $\left(R_{1}+R_{2}\right) C_{2}$, arises from the resistance seen by $C_{2}$ as if $C_{1}$ were zero. We call $R_{1} C_{1}$ and $\left(R_{1}+R_{2}\right) C_{2}$ "zero-value" time constants because each is obtained by setting the other capacitor to zero.

Can we generalize this result? That is, can we say that the dominant pole is given by the inverse of the sum of all of the zero-value time constants? We must first prove that, even for higher-order systems, the dominant pole is equal to the inverse of the coefficient of $s$ in the denominator. Writing the denominator as

$$
\begin{equation*}
D(s)=\left(1+\frac{s}{\omega_{p 1}}\right)\left(1+\frac{s}{\omega_{p 2}}\right) \cdots\left(1+\frac{s}{\omega_{p n}}\right) \tag{6.121}
\end{equation*}
$$

we recognize that the coefficient of $s, B_{s}$, is equal to $\omega_{p 1}^{-1}+\omega_{p 2}^{-1}+\cdots+\omega_{p n}^{-1}$, which reduces to $\omega_{p 1}^{-1}$ if this pole is dominant.

Next, we must prove that $B_{s}$ is equal to the sum of the zero-value time constants of the circuit. Assuming that the circuit contains only capacitors as storage elements, ${ }^{7}$ we note that, since $B_{s}$ has a time dimension, it can be expressed as

$$
\begin{equation*}
B_{s}=R_{1} C_{1}+R_{2} C_{2}+\cdots+R_{n} C_{n} \tag{6.122}
\end{equation*}
$$

where $R_{1}-R_{n}$ are unknown. Note that $C_{1}-C_{n}$ denote the capacitors in the circuit, but $R_{1}-R_{n}$ may represent physical resistors or equivalent resistances (e.g., $1 / g_{m}$ ). How do we obtain $R_{1}-R_{n}$ ? If $C_{2}-C_{n}$ are set to zero, the order of the system falls to 1, i.e., $D(s)=B_{s} s+1=R_{1} C_{1} s+1$, where $R_{1}$ is the resistance seen by $C_{1}$. Similarly, if $C_{1}=C_{3}=\cdots=C_{n}=0$, we have $D(s)=R_{2} C_{2} s+1$, where $R_{2}$ is the resistance seen by $C_{2}$. Thus, the dominant pole is indeed equal to the inverse of the sum of the zero-value time constants. The reader is cautioned that, even though, $B_{s}=\omega_{p 1}^{-1}+\omega_{p 2}^{-1}+\cdots+\omega_{p 1}^{-n}=R_{1} C_{1}+R_{2} C_{2}+\cdots+R_{n} C_{n}$, we cannot conclude that $\omega_{p 1}^{-1}=R_{1} C_{1}, \omega_{p 2}^{-1}=R_{2} C_{2}$, etc. Also, note that this method neglects the effect of zeros.

The ZVTC method proves useful if we wish to estimate the -3-dB bandwidth of a circuit. Depicted in Fig. 6.52, the idea is to approximate the frequency response by a one-pole system, and hence the time response by a single exponential. The following example illustrates this point.

[^31]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-211.jpg?height=362&width=1372&top_left_y=239&top_left_x=277)

Figure 6.52 Approximation of the frequency and time responses by one-pole counterparts.

#### Example 6.22

Estimate the $-3-\mathrm{dB}$ bandwidth of a resistively-degenerated common-source stage. Assume $\lambda=\gamma=0$.

#### Solution

Shown in Fig. 6.53(a), the small-signal model is of third order, ${ }^{8}$ providing little intuition. The zero-value time constant method can give a rough estimate of the circuit's bandwidth, thereby revealing the contribution of each capacitor.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-211.jpg?height=452&width=1446&top_left_y=1019&top_left_x=245)

Figure 6.53

We begin with the time constant associated with $C_{G S}$ and set $C_{G D}$ and $C_{L}$ to zero. As depicted in Fig. 6.53(b), the resistance seen by $C_{G S}$ is $V_{X} / I_{X}$. We denote this resistance by $R_{C G S}$. Since $V_{1}=V_{X}$ and the current flowing through $R_{S}$ is equal to $g_{m} V_{1}-I_{X}=g_{m} V_{X}-I_{X}$, we write a KVL as follows:

$$
\begin{equation*}
I_{X} R_{G}=V_{X}+\left(g_{m} V_{X}-I_{X}\right) R_{S} \tag{6.123}
\end{equation*}
$$

obtaining

$$
\begin{equation*}
R_{C G S}=\frac{R_{G}+R_{S}}{1+g_{m} R_{S}} \tag{6.124}
\end{equation*}
$$

For the resistance seen by $C_{G D}$, we have from Example 6.21

$$
\begin{equation*}
R_{C G D}=R_{D}+\left(\frac{g_{m} R_{D}}{1+g_{m} R_{S}}+1\right) R_{G} \tag{6.125}
\end{equation*}
$$

[^32]Finally, the resistance seen by $C_{L}$ is simply equal to $R_{D}$. It follows that the $-3-\mathrm{dB}$ bandwidth is given by

$$
\begin{equation*}
\omega_{-3 d B}^{-1}=\frac{R_{G}+R_{S}}{1+g_{m} R_{S}} C_{G S}+\left[R_{D}+\left(\frac{g_{m} R_{D}}{1+g_{m} R_{S}}+1\right) R_{G}\right] C_{G D}+R_{D} C_{L} \tag{6.126}
\end{equation*}
$$

With no degeneration, this result reduces to Eq. (6.35). With a finite $R_{S}$, the effect of $C_{G S}$ and $R_{G}$ is reduced by a factor of $1+g_{m} R_{S}$, albeit at the cost of voltage gain.

#### Example 6.23

Repeat the above example for a common-gate stage containing a gate resistance of $R_{G}$ and a source resistance of $R_{S}$.

#### Solution

We draw the small-signal circuit as shown in Fig. 6.54. For the computation of zero-value time constants, the main input is set to zero. Thus, the resulting equivalent circuits are identical for CS and CG stages, yielding the same time constants and hence the same bandwidth. After all, the circuits in Figs. 6.53(a) and 6.54 are topologically identical and contain the same poles.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-212.jpg?height=449&width=728&top_left_y=918&top_left_x=671)

Figure 6.54
Does this result contradict our earlier assertion that the CG stage is free from the Miller effect? No, it does not. In a CG stage, we strive to avoid $R_{G}$, whereas in a CS stage, $R_{G}$ represents the preceding circuit's output resistance and is inevitable.

### 6.10 â–  Appendix C: Dual of Miller's Theorem

In Miller's theorem (Fig. 6.2), we readily observe that $Z_{1}+Z_{2}=Z$. This is no coincidence, and it has interesting implications. Redrawing Fig. 6.2 as shown in Fig. 6.55(a), we surmise that since the point between $Z_{1}$ and $Z_{2}$ can be grounded, then if we "walk" from $X$ toward $Y$ along the impedance $Z$, the
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-212.jpg?height=429&width=1108&top_left_y=1863&top_left_x=478)

Figure 6.55 Illustration of Miller's theorem, identifying a local zero potential a long $Z$.
local potential drops to zero at some intermediate point [Fig. 6.55(b)]. Indeed, for $V_{P}=0$, we have

$$
\begin{equation*}
\frac{Z_{a}}{Z_{a}+Z_{b}}\left(V_{Y}-V_{X}\right)+V_{X}=0 \tag{6.127}
\end{equation*}
$$

and, since $Z_{a}+Z_{b}=Z$,

$$
\begin{equation*}
Z_{a}=\frac{Z}{1-V_{Y} / V_{X}} \tag{6.128}
\end{equation*}
$$

Similarly,

$$
\begin{equation*}
Z_{b}=\frac{Z}{1-V_{X} / V_{Y}} \tag{6.129}
\end{equation*}
$$

In other words, $Z_{1}\left(=Z_{a}\right)$ and $Z_{2}\left(=Z_{b}\right)$ are such decompositions of $Z$ that provide an intermediate node having a zero potential. For example, since in the common-source stage of Fig. 6.13, $V_{X}$ and $V_{Y}$ have opposite polarities, the potential falls to zero at some point "inside" $C_{G D}$.

The above observation explains the difficulty with the transformation depicted in Fig. 6.5. Drawing Fig. 6.55(b) for this case as in Fig. 6.56(a), we recognize that the circuit is still valid before node $P$ is grounded because the current through $R_{1}+R_{2}$ must equal that through $-R_{2}$. However, if, as shown in Fig. 6.56(b), node $P$ is tied to ground, then the only current path between $X$ and $Y$ vanishes.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-213.jpg?height=241&width=532&top_left_y=1068&top_left_x=405)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-213.jpg?height=239&width=513&top_left_y=1069&top_left_x=1001)
(b)

Figure 6.56 Resistive divider with decomposition of $R_{1}$.
The concept of a local zero potential along the floating impedance $Z$ also allows us to develop the "dual" of Miller's theorem, i.e., decomposition in terms of admittances and current ratios. Suppose two loops carrying currents $I_{1}$ and $I_{2}$ share an admittance $Y$ [Fig. 6.57(a)]. Then, if $Y$ is properly decomposed into two parallel admittances $Y_{1}$ and $Y_{2}$, the current flowing between the two is zero [Fig. 6.57(b)], and the connection can be broken [Fig. 6.57(c)]. In Fig. 6.57(a), the voltage across $Y$ is equal to $\left(I_{1}-I_{2}\right) / Y$, and in Fig. 6.57(c), the voltage across $Y_{1}$ is $I_{1} / Y_{1}$. For the two circuits to be equivalent,

$$
\begin{equation*}
\frac{I_{1}-I_{2}}{Y}=\frac{I_{1}}{Y_{1}} \tag{6.130}
\end{equation*}
$$

and

$$
\begin{equation*}
Y_{1}=\frac{Y}{1-I_{2} / I_{1}} \tag{6.131}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-213.jpg?height=293&width=1313&top_left_y=1961&top_left_x=304)

Figure 6.57 (a) Two loops sharing admittance $Y$, (b) decomposition of $Y$ into $Y_{1}$ and $Y_{2}$ such that $I=0$, (c) equivalent circuit.

Note the duality between this expression and $Z_{1}=\left(1-V_{Y} / V_{X}\right) Z$. We also have

$$
\begin{equation*}
Y_{2}=\frac{Y}{1-I_{1} / I_{2}} \tag{6.132}
\end{equation*}
$$
