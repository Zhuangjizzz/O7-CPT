# CHAPTER 8 Feedback

On a mild August morning in 1927, Harold Black was riding the ferry from New York to New Jersey, where he worked at Bell Laboratories. Black and many other researchers had been investigating the problem of nonlinearity in amplifiers used in long-distance telephone networks, seeking a practical solution. While reading the newspaper on the ferry, Black was suddenly struck by an idea and began to draw a diagram on the newspaper, which would later be used as the evidence in his patent application. The idea is known to us as the negative-feedback amplifier.

Feedback is a powerful technique that finds wide application in analog circuits. For example, negative feedback allows high-precision signal processing, and positive feedback makes it possible to build oscillators. In this chapter, we consider only negative feedback and use the term feedback to mean that.

We begin with a general view of feedback circuits, describing important benefits that result from feedback. Next, we study four feedback topologies and their properties. We then deal with difficulties in feedback circuit analysis and introduce the two-port technique, Bode's technique, and Blackman's theorem as possible solutions.

## 8.1 ■ General Considerations

Figure 8.1 shows a negative-feedback system, where $H(s)$ and $G(s)$ are called the feedforward and the feedback networks, respectively. Since the output of $G(s)$ is equal to $G(s) Y(s)$, the input to $H(s)$, called the feedback error, is given by $X(s)-G(s) Y(s)$. That is

$$
\begin{equation*}
Y(s)=H(s)[X(s)-G(s) Y(s)] \tag{8.1}
\end{equation*}
$$

Thus,

$$
\begin{equation*}
\frac{Y(s)}{X(s)}=\frac{H(s)}{1+G(s) H(s)} \tag{8.2}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-274.jpg?height=239&width=601&top_left_y=2045&top_left_x=465)

Figure 8.1 General feedback system.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-275.jpg?height=270&width=618&top_left_y=244&top_left_x=326)

Figure 8.2 Similarity between output of feedback network and input signal.

We call $H(s)$ the "open-loop" transfer function and $Y(s) / X(s)$ the "closed-loop" transfer function. In most cases of interest in this book, $H(s)$ represents an amplifier and $G(s)$ is a frequency-independent quantity. In other words, a fraction of the output signal is sensed and compared with the input, generating an error term. In a well-designed negative-feedback system, the error term is minimized, thereby making the output of $G(s)$ an accurate "copy" of the input and hence the output of the system a faithful (scaled) replica of the input (Fig. 8.2). We also say that the input of $H(s)$ is a "virtual ground" because the signal amplitude at this point is small. In subsequent developments, we replace $G(s)$ by a frequency-independent quantity $\beta$ and call it the "feedback factor."

It is instructive to identify four elements in the feedback system of Fig. 8.1: (1) the feedforward amplifier, (2) a means of sensing the output, (3) the feedback network, and (4) a means of generating the feedback error, i.e., a subtractor (or an adder). These elements exist in every feedback system, even though they may not be obvious in cases such as a simple common-source stage with resistive degeneration.

### 8.1.1 Properties of Feedback Circuits

Before proceeding to the analysis of feedback circuits, we study some simple examples to describe the benefits of negative feedback.

Gain Desensitization Consider the common-source stage shown in Fig. 8.3(a), where the voltage gain is equal to $g_{m 1} r_{O 1}$. A critical drawback of this circuit is the poor definition of the gain: both $g_{m 1}$ and $r_{O 1}$ vary with process and temperature. Now suppose the circuit is configured as in Fig. 8.3(b), where the gate bias of $M_{1}$ is set by means not shown here (Chapter 13). Let us calculate the overall voltage gain of the circuit at relatively low frequencies such that $C_{2}$ draws a negligible (small-signal) current from the output node, i.e., $V_{o u t} / V_{X}=-g_{m 1} r_{O 1}$ because the entire drain current flows through $r_{O 1}$. Since $\left(V_{\text {out }}-V_{X}\right) C_{2} s=\left(V_{X}-V_{\text {in }}\right) C_{1} s$, we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=-\frac{1}{\left(1+\frac{1}{g_{m 1} r_{O 1}}\right) \frac{C_{2}}{C_{1}}+\frac{1}{g_{m 1} r_{O 1}}} \tag{8.3}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-275.jpg?height=345&width=818&top_left_y=1902&top_left_x=559)

Figure 8.3 (a) Simple common-source stage; (b) circuit of (a) with feedback.

If $g_{m 1} r_{O 1}$ is sufficiently large, the $1 /\left(g_{m 1} r_{O 1}\right)$ terms in the denominator can be neglected, yielding

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=-\frac{C_{1}}{C_{2}} \tag{8.4}
\end{equation*}
$$

Compared to $g_{m 1} r_{O 1}$, this gain can be controlled with much higher accuracy because it is given by the ratio of two capacitors. If $C_{1}$ and $C_{2}$ are made of the same material, then process and temperature variations do not change $C_{1} / C_{2}$.

The above example reveals that negative feedback provides gain "desensitization," i.e., the closed-loop gain is less sensitive to device parameters than the open-loop gain is. One may also say that negative feedback "stabilizes" the gain and hence "improves the stability." But this nomenclature may be confused with frequency stability (Chapter 10), which typically worsens as a result of negative feedback. Illustrated for a more general case in Fig. 8.4, gain desensitization can be quantified by writing

$$
\begin{align*}
\frac{Y}{X} & =\frac{A}{1+\beta A}  \tag{8.5}\\
& \approx \frac{1}{\beta}\left(1-\frac{1}{\beta A}\right) \tag{8.6}
\end{align*}
$$

where we have assumed that $\beta A \gg 1$. We note that the closed-loop gain is determined, to the first order by the feedback factor, $\beta$. More important, even if the open-loop gain, $A$, varies by a factor of, say, 2 , $Y / X$ varies by a small percentage because $1 /(\beta A) \ll 1$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-276.jpg?height=224&width=465&top_left_y=1153&top_left_x=531)

Figure 8.4 Simple feedback system.
Called the "loop gain," the quantity $\beta A$ plays an important role in feedback systems. ${ }^{1}$ We see from (8.6) that the higher $\beta A$ is, the less sensitive $Y / X$ will be to variations in $A$. From another perspective, the accuracy of the closed-loop gain improves by maximizing $\beta A$. Note that as $\beta$ increases, the closedloop gain, $Y / X \approx 1 / \beta$, decreases, suggesting a trade-off between precision and the closed-loop gain. In other words, we begin with a high-gain amplifier and apply feedback to obtain a low, but less sensitive, closed-loop gain. Another conclusion here is that the output of the feedback network is equal to $\beta Y=$ $X \cdot \beta A /(1+\beta A)$, approaching $X$ as $\beta A$ becomes much greater than unity. This result agrees with the illustration in Fig. 8.2.

The calculation of the loop gain can proceed as follows. As illustrated in Fig. 8.5, we set the main input to (ac) zero, break the loop at some point, inject a test signal in the "right direction," follow the signal around the loop, and obtain the value that returns to the break point. The negative of the transfer function thus derived is the loop gain. Note that the loop gain is a dimensionless quantity. In Fig. 8.5, we have $V_{t} \beta(-1) A=V_{F}$ and hence $V_{F} / V_{t}=-\beta A$. Similarly, as depicted in Fig. 8.6, for the simple feedback circuit, we can write $V_{X}=V_{t} C_{2} /\left(C_{1}+C_{2}\right)$ and $^{2}$

$$
\begin{equation*}
V_{t} \frac{C_{2}}{C_{1}+C_{2}}\left(-g_{m 1} r_{O 1}\right)=V_{F} \tag{8.7}
\end{equation*}
$$

[^44]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-277.jpg?height=314&width=562&top_left_y=240&top_left_x=413)

Figure 8.5 Computation of loop gain.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-277.jpg?height=368&width=457&top_left_y=615&top_left_x=471)

Figure 8.6 Computation of loop gain in a simple feedback circuit.

That is

$$
\begin{equation*}
\frac{V_{F}}{V_{t}}=-\frac{C_{2}}{C_{1}+C_{2}} g_{m 1} r_{O 1} \tag{8.8}
\end{equation*}
$$

Note that the current drawn by $C_{2}$ from the output is neglected here. This issue will be addressed in Sec. 8.5.

#### Example 8.1

Determine the loop gain for the feedback common-gate stage shown in Fig. 8.7(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-277.jpg?height=426&width=370&top_left_y=1439&top_left_x=345)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-277.jpg?height=339&width=306&top_left_y=1449&top_left_x=820)
(b)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-277.jpg?height=303&width=380&top_left_y=1452&top_left_x=1208)
(c)

Figure 8.7

#### Solution

In order to compute the loop gain, we must first set the main input to (ac) zero, arriving at the arrangement shown in Fig. 8.7(b). Redrawing the circuit as in Fig. 8.7(c), we recognize that this topology is identical to the CS stage of Fig. 8.3(b) with $V_{i n}=0$. The loop gain is therefore given by Eq. (8.8).

The important point here is that, when computing the loop gain, we no longer know where the main input and output terminals are. Thus, seemingly different circuit topologies may have the same loop gain.

We should emphasize that the desensitization of gain by feedback leads to many other properties of feedback systems. Our examination of Eq. (8.6) indicates that large variations in $A$ affect $Y / X$ negligibly if $\beta A$ is large. Such variations can arise from different sources: process, temperature, frequency, and loading. For example, if $A$ drops at high frequencies, $Y / X$ varies to a lesser extent, and the bandwidth is increased. Similarly, if $A$ decreases because the amplifier drives a heavy load, $Y / X$ is not affected much. These concepts become clearer below.

Terminal Impedance Modification As a second example, let us study the circuit shown in Fig. 8.8(a), where a capacitive voltage divider senses the output voltage of a common-gate stage, applying the result to the gate of current source $M_{2}$ and hence returning a signal to the input. ${ }^{3}$ Our objective is to compute the input resistance at relatively low frequencies with and without feedback. Neglecting channellength modulation and the current drawn by $C_{1}$, we break the feedback loop as shown in Fig. 8.8(b) and write

$$
\begin{equation*}
R_{i n, \text { open }}=\frac{1}{g_{m 1}+g_{m b 1}} \tag{8.9}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-278.jpg?height=516&width=1394&top_left_y=971&top_left_x=338)

Figure 8.8 (a) Common-gate circuit with feedback; (b) open-loop circuit; (c) calculation of input resistance.
For the closed-loop circuit, as depicted in Fig. 8.8(c), we write $V_{\text {out }}=\left(g_{m 1}+g_{m b 1}\right) V_{X} R_{D}$ and

$$
\begin{align*}
V_{P} & =V_{\text {out }} \frac{C_{1}}{C_{1}+C_{2}}  \tag{8.10}\\
& =\left(g_{m 1}+g_{m b 1}\right) V_{X} R_{D} \frac{C_{1}}{C_{1}+C_{2}} \tag{8.11}
\end{align*}
$$

Thus, the small-signal drain current of $M_{2}$ equals $g_{m 2}\left(g_{m 1}+g_{m b 1}\right) V_{X} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$. Adding this current to the drain current of $M_{1}$ with proper polarity yields $I_{X}$ :

$$
\begin{align*}
I_{X} & =\left(g_{m 1}+g_{m b 1}\right) V_{X}+g_{m 2}\left(g_{m 1}+g_{m b 1}\right) \frac{C_{1}}{C_{1}+C_{2}} R_{D} V_{X}  \tag{8.12}\\
& =\left(g_{m 1}+g_{m b 1}\right)\left(1+g_{m 2} R_{D} \frac{C_{1}}{C_{1}+C_{2}}\right) V_{X} \tag{8.13}
\end{align*}
$$

[^45]It follows that

$$
\begin{align*}
R_{\text {in,closed }} & =V_{X} / I_{X}  \tag{8.14}\\
& =\frac{1}{g_{m 1}+g_{m b 1}} \frac{1}{1+g_{m 2} R_{D} \frac{C_{1}}{C_{1}+C_{2}}} \tag{8.15}
\end{align*}
$$

We therefore conclude that this type of feedback reduces the input resistance by a factor of $1+$ $g_{m 2} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$. The reader can prove that the quantity $g_{m 2} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$ is the loop gain.

Let us now consider the circuit of Fig. 8.9(a) as an example of output impedance modification by feedback. Here $M_{1}, R_{S}$, and $R_{D}$ constitute a common-source stage and $C_{1}, C_{2}$, and $M_{2}$ sense the output voltage, ${ }^{4}$ returning a current equal to $\left[C_{1} /\left(C_{1}+C_{2}\right)\right] V_{\text {out }} g_{m 2}$ to the source of $M_{1}$. The reader can prove that the feedback is indeed negative. To compute the output resistance at relatively low frequencies, we set the input to zero [Fig. 8.9(b)] and write

$$
\begin{equation*}
I_{D 1}=V_{X} \frac{C_{1}}{C_{1}+C_{2}} g_{m 2} \frac{R_{S}}{R_{S}+\frac{1}{g_{m 1}+g_{m b 1}}} \tag{8.16}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-279.jpg?height=431&width=474&top_left_y=1060&top_left_x=429)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-279.jpg?height=431&width=498&top_left_y=1060&top_left_x=998)
(b)

Figure 8.9 (a) CS stage with feedback; (b) calculation of output resistance.
Since $I_{X}=V_{X} / R_{D}+I_{D 1}$, we have

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{D}}{1+\frac{g_{m 2} R_{S}\left(g_{m 1}+g_{m b 1}\right) R_{D}}{\left(g_{m 1}+g_{m b 1}\right) R_{S}+1} \frac{C_{1}}{C_{1}+C_{2}}} \tag{8.17}
\end{equation*}
$$

Equation (8.17) implies that this type of feedback decreases the output resistance. The denominator of (8.17) is indeed equal to one plus the loop gain.

Bandwidth Modification. The next example illustrates the effect of negative feedback on the bandwidth. Suppose the feedforward amplifier has a one-pole transfer function:

$$
\begin{equation*}
A(s)=\frac{A_{0}}{1+\frac{s}{\omega_{0}}} \tag{8.18}
\end{equation*}
$$

[^46]where $A_{0}$ denotes the low-frequency gain and $\omega_{0}$ is the $3-\mathrm{dB}$ bandwidth. What is the transfer function of the closed-loop system? From (8.5), we have
\$\$

$$
\begin{align*}
\frac{Y}{X}(s) & =\frac{\frac{A_{0}}{1+\frac{s}{\omega_{0}}}}{1+\beta \frac{A_{0}}{1+\frac{s}{\omega_{0}}}}  \tag{8.19}\\
& =\frac{A_{0}}{1+\beta A_{0}+\frac{s}{\omega_{0}}}  \tag{8.20}\\
& =\frac{\frac{A_{0}}{1+\beta A_{0}}}{1+\frac{s}{\left(1+\beta A_{0}\right) \omega_{0}}} \tag{8.21}
\end{align*}
$$

\$\$

The numerator of (8.21) is simply the closed-loop gain at low frequencies-as predicted by (8.5)-and the denominator reveals a pole at $\left(1+\beta A_{0}\right) \omega_{0}$. Thus, the $3-\mathrm{dB}$ bandwidth has increased by a factor of $1+\beta A_{0}$, albeit at the cost of a proportional reduction in the gain (Fig. 8.10).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-280.jpg?height=296&width=1310&top_left_y=1097&top_left_x=380)

Figure 8.10 Bandwidth modification as a result of feedback.
The increase in the bandwidth fundamentally originates from the gain desensitization property of feedback. Recall from (8.6) that, if $A$ is large enough, the closed-loop gain remains approximately equal to $1 / \beta$ even if $A$ experiences substantial variations. In the example of Fig. $8.10, A$ varies with frequency rather than process or temperature, but negative feedback still suppresses the effect of this variation. Of course, at high frequencies, $A$ drops to such low levels that $\beta A$ becomes comparable with unity and the closed-loop gain falls below $1 / \beta$.

Equation (8.21) suggests that the "gain-bandwidth product" of a one-pole system is equal to $A_{0} \omega_{0}$ and does not change much with feedback, making the reader wonder how feedback improves the speed if a high gain is required. Suppose we need to amplify a 20-MHz square wave by a factor of 100 and maximum bandwidth, but we have only a single-pole amplifier with an open-loop gain of 100 and 3-dB bandwidth of 10 MHz . If the input is applied to the open-loop amplifier, the response appears as shown in Fig. 8.11(a), exhibiting a long risetime and falltime because the time constant is equal to $1 /\left(2 \pi f_{3-\mathrm{dB}}\right) \approx 16 \mathrm{~ns}$.

Now suppose we apply feedback to the amplifier such that the gain and bandwidth are modified to 10 and 100 MHz , respectively. Placing two of these amplifiers in a cascade [Fig. 8.11(b)], we obtain a much faster response with an overall gain of 100 . Of course, the cascade consumes twice as much power, but it would be quite difficult to achieve this performance with the original amplifier even if its power dissipation were doubled.

Nonlinearity Reduction An important property of negative feedback is the reduction of nonlinearity in analog circuits. A nonlinear characteristic is one that departs from a straight line, i.e., one whose slope varies (Fig. 8.12). A familiar example is the input-output characteristic of differential pairs. Note that
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-281.jpg?height=687&width=1113&top_left_y=230&top_left_x=412)

Figure 8.11 Amplification of a 20-MHz square wave by (a) a 10-MHz amplifier and (b) a cascade of two $100-\mathrm{MHz}$ feedback amplifiers.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-281.jpg?height=326&width=1000&top_left_y=1000&top_left_x=466)

Figure 8.12 Input-output characteristic of a nonlinear amplifier (a) before and (b) after applying feedback.
the slope can be viewed as the small-signal gain. We predict that, even though the gain of an open-loop amplifier varies from $A_{1}$ to $A_{2}$ in Fig. 8.12, a closed-loop feedback system incorporating such an amplifier exhibits less gain variation and hence a higher linearity. To quantify this effect, we note that the open-loop gain ratio between regions 1 and 2 in Fig. 8.12 is equal to

$$
\begin{equation*}
r_{\text {open }}=\frac{A_{2}}{A_{1}} \tag{8.22}
\end{equation*}
$$

For example, $r_{\text {open }}=0.9$ means that the gain falls by $10 \%$ from region 1 to region 2 . Assuming $A_{2}=$ $A_{1}-\Delta A$, we can write

$$
\begin{equation*}
r_{\text {open }}=1-\frac{\Delta A}{A_{1}} \tag{8.23}
\end{equation*}
$$

Let us place this amplifier in a negative-feedback loop. For the closed-loop gain ratio, we have

$$
\begin{align*}
r_{\text {closed }} & =\frac{\frac{A_{2}}{1+\beta A_{2}}}{\frac{A_{1}}{1+\beta A_{1}}}  \tag{8.24}\\
& =\frac{1+\frac{1}{\beta A_{1}}}{1+\frac{1}{\beta A_{2}}} \tag{8.25}
\end{align*}
$$

It follows that

$$
\begin{align*}
r_{\text {closed }} & \approx 1-\frac{\frac{1}{\beta A_{2}}-\frac{1}{\beta A_{1}}}{1+\frac{1}{\beta A_{2}}}  \tag{8.26}\\
& \approx 1-\frac{A_{1}-A_{2}}{1+\beta A_{2}} \frac{1}{A_{1}}  \tag{8.27}\\
& \approx 1-\frac{\Delta A}{1+\beta A_{2}} \frac{1}{A_{1}} \tag{8.28}
\end{align*}
$$

Comparison of (8.23) and (8.28) suggests that the gain ratio is much closer to 1 in the latter if the loop gain, $1+\beta A_{2}$, is large.

We study nonlinearity and its behavior in feedback systems more extensively in Chapter 14.

### 8.1.2 Types of Amplifiers

Most of the circuits studied thus far can be considered "voltage amplifiers" because they sense a voltage at the input and produce a voltage at the output. However, three other types of amplifiers can also be constructed such that they sense or produce currents. Shown in Fig. 8.13, the four configurations have quite different properties: (1) circuits sensing a voltage must exhibit a high input impedance (a voltmeter measures a voltage with minimal loading) whereas those sensing a current must provide a low input impedance (a current meter inserted in a wire must negligibly disturb the current); (2) circuits generating a voltage must exhibit a low output impedance (as a voltage source) while those generating a current must provide a high output impedance (as a current source). Note that the gains of transimpedance and transconductance ${ }^{5}$ amplifiers have a dimension of resistance and conductance, respectively. For example, a transimpedance amplifier may have a gain of $2 \mathrm{k} \Omega$, which means that it produces a $2-\mathrm{V}$ output in response to a $1-\mathrm{mA}$ input. Also, we use the sign conventions depicted in Fig. 8.13; for example, the transimpedance $R_{0}=V_{\text {out }} / I_{\text {in }}$ if $I_{\text {in }}$ flows into the amplifier.

Voltage Amp
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-282.jpg?height=459&width=291&top_left_y=1593&top_left_x=326)
(a)

Transimpedance Amp.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-282.jpg?height=444&width=276&top_left_y=1599&top_left_x=690)
(b)

Transconductance Amp.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-282.jpg?height=450&width=270&top_left_y=1596&top_left_x=1084)
(c)

Current Amp.

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-282.jpg?height=461&width=276&top_left_y=1593&top_left_x=1468)
(d)

Figure 8.13 Types of amplifiers along with their idealized models.

[^47]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-283.jpg?height=264&width=275&top_left_y=247&top_left_x=385)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-283.jpg?height=304&width=226&top_left_y=245&top_left_x=735)
(b)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-283.jpg?height=223&width=209&top_left_y=288&top_left_x=1038)
(c)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-283.jpg?height=247&width=226&top_left_y=266&top_left_x=1329)
(d)

Figure 8.14 Simple implementations of four types of amplifiers.

Figure 8.14 illustrates simple implementations of each amplifier. In Fig. 8.14(a), a common-source stage senses and produces Voltages, and in Fig. 8.14(b), a common-gate circuit serves as a transimpedance amplifier, converting the source current to a voltage at the drain. In Fig. 8.14(c), a common-source transistor operates as a transconductance amplifier (also called a $V / I$ converter), generating an output current in response to an input voltage, and in Fig. 8.14(d), a common-gate device senses and produces currents.

The circuits of Fig. 8.14 may not provide adequate performance in many applications. For example, the circuits of Figs. 8.14(a) and (b) suffer from a relatively high output impedance. Figure 8.15 depicts modifications that alter the output impedance or increase the gain.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-283.jpg?height=411&width=1507&top_left_y=1106&top_left_x=238)

Figure 8.15 Four types of amplifiers with improved performance.

#### Example 8.2

Calculate the gain of the transconductance amplifier shown in Fig. 8.15(c).

#### Solution

The gain in this case is defined as $G_{m}=I_{\text {out }} / V_{\text {in }}$. That is

$$
\begin{align*}
G_{m} & =\frac{V_{X}}{V_{\text {in }}} \cdot \frac{I_{\text {out }}}{V_{X}}  \tag{8.29}\\
& =-g_{m 1}\left(r_{O 1} \| R_{D}\right) \cdot g_{m 2} \tag{8.30}
\end{align*}
$$

While most familiar amplifiers are of the voltage-voltage type, the other three configurations do find usage. For example, transimpedance amplifiers are an integral part of optical fiber receivers because they must sense the current produced by a photodiode, eventually generating a voltage that can be processed by subsequent circuits.

#### Example 8.3

Reconstruct the models of Fig. 8.13 for nonideal amplifiers.

#### Solution

A nonideal voltage amplifier draws current from its input and exhibits a finite output impedance, as depicted in Fig. 8.16(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-284.jpg?height=518&width=1141&top_left_y=517&top_left_x=464)

Figure 8.16

A nonideal transimpedance amplifier may have finite input and output impedances [Fig. 8.16(b)]. Note that $Z_{\text {in }}$ is in parallel with the input port in Fig. 8.16(a) and in series with the input port in Fig. 8.16(b). This is to ensure a meaningful result in the ideal case: if $Z_{\text {in }}$ goes to infinity in the former or to zero in the latter, the models reduce to those of Fig. 8.13.

The reader is encouraged to justify the models shown in Figs. 8.16(c) and (d) for the other two amplifier types. We should mention that these amplifiers may also have internal feedback from their output to their input, e.g., due to $C_{G D}$, but we neglect that for now.

### 8.1.3 Sense and Return Mechanisms

Placing a circuit in a feedback loop requires sensing the output signal and returning (a fraction) of the result to the summing node at the input. With voltage or current quantities as input and output signals, we can identify four types of feedback: voltage-voltage, voltage-current, current-current, and currentvoltage, where the first entry in each case denotes the quantity sensed at the output and the second the type of signal returned to the input. ${ }^{6}$

It is instructive to review methods of sensing and summing voltages or currents. To sense a voltage, we place a voltmeter in parallel with the corresponding port [Fig. 8.17(a)], ideally introducing no loading.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-284.jpg?height=314&width=1275&top_left_y=1838&top_left_x=397)

Figure 8.17 Sensing (a) a voltage by a voltmeter; (b) a current by a current meter; (c) a current by a small resistor.

[^48]When used in a feedback system, this type of sensing is also called "shunt feedback" (regardless of the quantity returned to the input).

To sense a current, a current meter is inserted in series with the signal [Fig. 8.17(b)], ideally exhibiting zero series resistance. Thus, this type of sensing is also called "series feedback." In practice, a small resistor replaces the current meter [Fig. 8.17(c)], with the voltage drop across the resistor serving as a measure of the output current.

The addition of the feedback signal and the input signal can be performed in the voltage domain or current domain. To add two quantities, we place them in series if they are voltages and in parallel if they are currents (Fig. 8.18).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-285.jpg?height=265&width=142&top_left_y=636&top_left_x=472)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-285.jpg?height=259&width=206&top_left_y=644&top_left_x=709)
(b)

Figure 8.18 Addition of (a) voltages and (b) currents.

To visualize the methods of Figs. 8.17 and 8.18, we consider a number of practical implementations. A voltage can be sensed by a resistive (or capacitive) divider in parallel with the port [Fig. 8.19(a)] and a
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-285.jpg?height=1140&width=1474&top_left_y=1105&top_left_x=231)

Figure 8.19 Practical means of sensing and adding voltages and currents.
current by placing a small resistor in series with the wire and sensing the voltage across it [Figs. 8.19(b) and (c)]. To subtract two voltages, a differential pair can be used [Fig. 8.19(d)]. Alternatively, a single transistor can perform voltage subtraction as shown in Figs. 8.19(e) and (f) because $I_{D 1}$ is a function of $V_{i n}-V_{F}$. Subtraction of currents can be accomplished as depicted in Fig. 8.19(g) or (h). Note that for voltage subtraction, the input and feedback signals are applied to two distinct nodes, whereas for current subtraction, they are applied to a single node. This observation proves helpful in identifying the type of feedback.

While ideally having no influence on the operation of the open-loop amplifier itself, the feedback network in reality introduces loading effects that must be taken into account. This issue is discussed in Sec. 8.5.

## 8.2 ■ Feedback Topologies

In this section, we study four "canonical" topologies resulting from placing each of the four amplifier types in a negative-feedback loop. As depicted in Fig. 8.20, $X$ and $Y$ can be a current or a voltage quantity. The main amplifier is called the "feedforward" or simply the "forward" amplifier, around which we apply feedback to improve the performance.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-286.jpg?height=323&width=601&top_left_y=1009&top_left_x=468)

Figure 8.20 Canonical feedback system.

We should remark that some feedback circuits do not conform to the four canonical topologies. We return to this point later in the chapter, but the intuition gained from the analysis of these topologies proves essential to analog design. For example, we greatly benefit from the knowledge that one type of feedback lowers the output impedance while another raises it.

### 8.2.1 Voltage-Voltage Feedback

This topology senses the output voltage and returns the feedback signal as a voltage. ${ }^{7}$ Following the conceptual illustrations of Figs. 8.17 and 8.18, we note that the feedback network is connected in parallel with the output and in series with the input port (Fig. 8.21). An ideal feedback network in this case exhibits infinite input impedance and zero output impedance because it senses a voltage and generates a voltage. We can therefore write $V_{F}=\beta V_{\text {out }}, V_{e}=V_{\text {in }}-V_{F}, V_{\text {out }}=A_{0}\left(V_{\text {in }}-\beta V_{\text {out }}\right)$, and hence

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{A_{0}}{1+\beta A_{0}} \tag{8.31}
\end{equation*}
$$

We recognize that $\beta A_{0}$ is the loop gain and that the overall gain has dropped by $1+\beta A_{0}$. Note that here both $A_{0}$ and $\beta$ are dimensionless quantities.

As a simple example of voltage-voltage feedback, suppose we employ a differential voltage amplifier with single-ended output as the feedforward amplifier and a resistive divider as the feedback network

[^49]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-287.jpg?height=408&width=636&top_left_y=247&top_left_x=379)

Figure 8.21 Voltage-voltage feedback.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-287.jpg?height=327&width=419&top_left_y=733&top_left_x=528)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-287.jpg?height=322&width=423&top_left_y=720&top_left_x=987)
(b)

Figure 8.22 (a) Amplifier with output sensed by a resistive divider; (b) voltage-voltage feedback amplifier.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-287.jpg?height=403&width=739&top_left_y=1192&top_left_x=322)

Figure 8.23 Effect of voltage-voltage feedback on output resistance.
[Fig. 8.22(a)]. The divider senses the output voltage, producing a fraction thereof as the feedback signal $V_{F}$. Following the block diagram of Fig. 8.21, we place $V_{F}$ in series with the input of the amplifier to perform subtraction of voltages [Fig. 8.22(b)].

How does voltage-voltage feedback modify the input and output impedances? Let us first consider the output impedance. Recall that a negative-feedback system attempts to make the output an accurate (scaled) replica of the input. Now suppose, as shown in Fig. 8.23, we load the output by a resistor $R_{L}$, gradually decreasing its value. While in the open-loop configuration, the output would simply drop in proportion to $R_{L} /\left(R_{L}+R_{\text {out }}\right)$, in the feedback system, $V_{\text {out }}$ is maintained as a reasonable replica of $V_{\text {in }}$ even though $R_{L}$ decreases. That is, so long as the loop gain remains much greater than unity, $V_{\text {out }} / V_{\text {in }} \approx 1 / \beta$, regardless of the value of $R_{L}$. From another point of view, since the circuit stabilizes ("regulates") the output voltage amplitude despite load variations, it behaves as a voltage source, thus exhibiting a low output impedance. This property fundamentally originates from the gain desensitization provided by feedback.

In order to formally prove that voltage feedback lowers the output impedance, we consider the simple model in Fig. 8.24, where $R_{\text {out }}$ represents the output impedance of the feedforward amplifier. Setting the input to zero and applying a voltage at the output, we write $V_{F}=\beta V_{X}, V_{e}=-\beta V_{X}, V_{M}=-\beta A_{0} V_{X}$,
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-288.jpg?height=291&width=593&top_left_y=218&top_left_x=467)

Figure 8.24 Calculation of output resistance of a voltage-voltage feedback circuit.
and hence $I_{X}=\left[V_{X}-\left(-\beta A_{0} V_{X}\right)\right] / R_{\text {out }}$ (if the current drawn by the feedback network is neglected). It follows that

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{\text {out }}}{1+\beta A_{0}} \tag{8.32}
\end{equation*}
$$

Thus, the output impedance and the gain are lowered by the same factor. In the circuit of Fig. 8.22(b), for example, the output impedance is lowered by $1+A_{0} R_{2} /\left(R_{1}+R_{2}\right)$.

#### Example 8.4

The circuit shown in Fig. 8.25(a) is an implementation of the feedback configuration depicted in Fig. 8.22(b), but with the resistors replaced by capacitors. (The bias network of $M_{2}$ is not shown.) Calculate the closed-loop gain and output resistance of the amplifier at relatively low frequencies.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-288.jpg?height=531&width=1474&top_left_y=1164&top_left_x=303)

Figure 8.25

#### Solution

At low frequencies, $C_{1}$ and $C_{2}$ draw a negligible current from the output node. To find the open-loop voltage gain, we break the feedback loop as shown in Fig. 8.25(b), grounding the top plate of $C_{1}$ to ensure zero voltage feedback. The open-loop gain is thus equal to $g_{m 1}\left(r_{O 2} \| r_{O 4}\right)$.

We must also compute the loop gain, $\beta A_{0}$. With the aid of Fig. 8.25(c), we have

$$
\begin{equation*}
V_{F}=-V_{t} \frac{C_{1}}{C_{1}+C_{2}} g_{m 1}\left(r_{O 2} \| r_{O 4}\right) \tag{8.33}
\end{equation*}
$$

That is

$$
\begin{equation*}
\beta A_{0}=\frac{C_{1}}{C_{1}+C_{2}} g_{m 1}\left(r_{O 2} \| r_{O 4}\right) \tag{8.34}
\end{equation*}
$$

and hence

$$
\begin{equation*}
A_{\text {closed }}=\frac{g_{m 1}\left(r_{O 2} \| r_{O 4}\right)}{1+\frac{C_{1}}{C_{1}+C_{2}} g_{m 1}\left(r_{O 2} \| r_{O 4}\right)} \tag{8.35}
\end{equation*}
$$

As expected, if $\beta A_{0} \gg 1$, then $A_{\text {closed }} \approx 1+C_{2} / C_{1}$.
The open-loop output resistance of the circuit is equal to $r_{O 2} \| r_{O 4}$ (Chapter 5). It follows that

$$
\begin{equation*}
R_{\text {out }, \text { closed }}=\frac{r_{O 2} \| r_{O 4}}{1+\frac{C_{1}}{C_{1}+C_{2}} g_{m 1}\left(r_{O 2} \| r_{O 4}\right)} \tag{8.36}
\end{equation*}
$$

It is interesting to note that if $\beta A_{0} \gg 1$, then

$$
\begin{equation*}
R_{\text {out }, \text { closed }} \approx\left(1+\frac{C_{2}}{C_{1}}\right) \frac{1}{g_{m 1}} \tag{8.37}
\end{equation*}
$$

In other words, even if the open-loop amplifier suffers from a high output resistance, the closed-loop output resistance is independent of $r_{O 2} \| r_{O 4}$, simply because the open-loop gain scales with $r_{O 2} \| r_{O 4}$ as well.

#### Example 8.5

Figure 8.26(a) shows an inverting amplifier using an op amp, and Fig. 8.26(b) illustrates a circuit implementation incorporating capacitors rather than resistors for the feedback network. Determine the loop gain and output impedance of the latter at low frequencies.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-289.jpg?height=704&width=1143&top_left_y=1226&top_left_x=394)

Figure 8.26

#### Solution

With $V_{i n}$ set to zero, this circuit becomes indistinguishable from that in Fig. 8.25(a). Thus, the loop gain is given by (8.34) and the output impedance by (8.36).

The circuits in Figs. 8.25(a) and 8.26(b) appear similar, but provide different closed-loop gains, approximately $1+C_{2} / C_{1}$ and $-C_{2} / C_{1}$, respectively. Thus, for a gain of, say, $4, C_{2} / C_{1} \approx 3$ in the former and $C_{2} / C_{1} \approx 4$ in the latter. Which topology exhibits a higher loop gain in this case?

Voltage-voltage feedback also modifies the input impedance. Comparing the configurations in Fig. 8.27, we note that the input impedance of the feedforward amplifier sustains the entire input voltage in Fig. 8.27(a), but only a fraction of $V_{i n}$ in Fig. 8.27(b). As a result, the current drawn by $R_{i n}$ in the feedback topology is less than that in the open-loop system, suggesting that returning a voltage quantity to the input increases the input impedance.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-290.jpg?height=485&width=1479&top_left_y=475&top_left_x=300)

Figure 8.27 Effect of voltage-voltage feedback on input resistance.
The foregoing observation can be confirmed analytically with the aid of Fig. 8.28. Since $V_{e}=I_{X} R_{i n}$ and $V_{F}=\beta A_{0} I_{X} R_{i n}$, we have $V_{e}=V_{X}-V_{F}=V_{X}-\beta A_{0} I_{X} R_{i n}$. Thus, $I_{X} R_{i n}=V_{X}-\beta A_{0} I_{X} R_{i n}$, and

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=R_{i n}\left(1+\beta A_{0}\right) \tag{8.38}
\end{equation*}
$$

The input impedance therefore increases by the ubiquitous factor $1+\beta A_{0}$, bringing the circuit closer to an ideal voltage amplifier.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-290.jpg?height=285&width=505&top_left_y=1348&top_left_x=526)

Figure 8.28 Calculation of input impedance of a voltage-voltage feedback circuit.

#### Example 8.6

Figure 8.29(a) shows a common-gate topology placed in a voltage-voltage feedback configuration. Note that the summation of the feedback voltage and the input voltage is accomplished by applying the former to the gate and the latter to the source. ${ }^{8}$ Calculate the input resistance at low frequencies if channel-length modulation is negligible.

#### Solution

Breaking the loop as depicted in Fig. 8.29(b), we recognize that the open-loop input resistance is equal to ( $g_{m 1}+$ $\left.g_{m b 1}\right)^{-1}$. To find the loop gain, we set the input to zero and inject a test signal in to the loop [Fig. 8.29(c)], obtaining $V_{F} / V_{t}=-g_{m 1} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$. The closed-loop input impedance is then equal to

$$
\begin{equation*}
R_{\text {in, }, \text { closed }}=\frac{1}{g_{m 1}+g_{m b 1}}\left(1+\frac{C_{1}}{C_{1}+C_{2}} g_{m 1} R_{D}\right) \tag{8.39}
\end{equation*}
$$

[^50]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-291.jpg?height=545&width=1222&top_left_y=224&top_left_x=357)

Figure 8.29

The increase in the input impedance can be explained as follows. Suppose the input voltage decreases by $\Delta V$, causing the output voltage to fall. As a result, the gate voltage of $M_{1}$ decreases, thereby lowering the gate-source voltage of $M_{1}$ and yielding a change in $V_{G S 1}$ that is less than $\Delta V$. This means that the drain current changes by an amount less than $\left(g_{m}+g_{m b}\right) \Delta V$. By contrast, if the gate of $M_{1}$ were connected to a constant potential, the gate-source voltage would change by $\Delta V$, resulting in a larger current change.

In summary, voltage-voltage feedback decreases the output impedance and increases the input impedance, thereby proving useful as a "buffer" stage that can be interposed between a high-impedance source and a low-impedance load.

### 8.2.2 Current-Voltage Feedback

In some circuits, it is desirable or simpler to sense the output current to perform feedback. The current is actually sensed by placing a (preferably small) resistor in series with the output and using the voltage drop across the resistor as the feedback information. This voltage may even serve as the return signal that is directly subtracted from the input.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-291.jpg?height=424&width=652&top_left_y=1555&top_left_x=368)

Figure 8.30 Current-voltage feedback.

Let us consider the general current-voltage feedback system illustrated in Fig. 8.30. ${ }^{9}$ Since the feedback network senses the output current and returns a voltage, its feedback factor, $\beta$, has the dimension of resistance and is denoted by $R_{F}$. It is important to note that a $G_{m}$ stage must be loaded ("terminated") by a finite impedance, $Z_{L}$, to ensure that it can deliver its output current. If $Z_{L}=\infty$, then an ideal $G_{m}$

[^51]stage would sustain an infinite output voltage. We write $V_{F}=R_{F} I_{\text {out }}, V_{e}=V_{\text {in }}-R_{F} I_{\text {out }}$, and hence $I_{\text {out }}=G_{m}\left(V_{\text {in }}-R_{F} I_{\text {out }}\right)$. It follows that
\$\$

$$
\begin{equation*}
\frac{I_{\text {out }}}{V_{\text {in }}}=\frac{G_{m}}{1+G_{m} R_{F}} \tag{8.40}
\end{equation*}
$$

\$\$

An ideal feedback network in this case exhibits zero input and output impedances.
It is instructive to confirm that $G_{m} R_{F}$ is indeed the loop gain. As shown in Fig. 8.31, we set the input voltage to zero and break the loop by disconnecting the feedback network from the output and replacing it with a short at the output (if the feedback network is ideal). We then inject the test signal $I_{t}$, producing $V_{F}=R_{F} I_{t}$, and hence $I_{\text {out }}=-G_{m} R_{F} I_{t}$. Thus, the loop gain is equal to $G_{m} R_{F}$ and the transconductance of the amplifier is reduced by $1+G_{m} R_{F}$ when feedback is applied.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-292.jpg?height=359&width=513&top_left_y=776&top_left_x=509)

Figure 8.31 Calculation of loop gain for current-voltage feedback.

Is it realistic to assume that the input impedance of the feedback network is zero? Why do we use a test current rather than a test voltage? Does the type of test source affect the loop gain calculations? These questions are addressed later in this chapter.

Sensing the current at the output of a feedback system increases the output impedance. This is because the system attempts to make the output current a faithful replica of the input signal (with a proportionality factor if the input is a voltage quantity). Consequently, the system delivers the same current waveform as the load varies, in essence approaching an ideal current source and hence exhibiting a high output impedance.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-292.jpg?height=426&width=654&top_left_y=1554&top_left_x=441)

Figure 8.32 Calculation of output resistance of a current-voltage feedback amplifier.

To prove the above result, we consider the current-voltage feedback topology shown in Fig. 8.32, where $R_{\text {out }}$ represents the finite output impedance of the feedforward amplifier. ${ }^{10}$ The feedback network produces a voltage $V_{F}$ proportional to $I_{X}: V_{F}=R_{F} I_{X}$, and the current generated by $G_{m}$ equals $-R_{F} I_{X} G_{m}$. As a

[^52]result, $-R_{F} I_{X} G_{m}=I_{X}-V_{X} / R_{\text {out }}$, yielding
\$\$

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=R_{\text {out }}\left(1+G_{m} R_{F}\right) \tag{8.41}
\end{equation*}
$$

\$\$

The output impedance therefore increases by a factor of $1+G_{m} R_{F}$.

#### Example 8.7

Rechargeable batteries must be charged by a constant current (rather than a constant voltage) to avoid damage. The battery charger must therefore generate a constant current from a golden reference, $V_{R E F}$. As shown in Fig. 8.33(a), we can insert a small resistor $r$ in the output current path, apply the voltage across $r$ to an amplifier $A_{1}$, and subtract the output of $A_{1}$ from $V_{R E F}$. Calculate the output current and impedance of this circuit, assuming $\left|Z_{L}\right| \ll r_{O}$ (the output resistance of $M_{1}$ ).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-293.jpg?height=503&width=1355&top_left_y=755&top_left_x=306)

Figure 8.33

#### Solution

With a high loop gain, the output voltage of $A_{1}$ is approximately equal to $V_{R E F}$, and hence $I_{\text {out }}=\left(V_{R E F} / A_{1}\right) / r$. Using the circuit of Fig. 8.33(b) to determine the loop gain, we have

$$
\begin{equation*}
\frac{V_{F}}{V_{t}} \approx-g_{m} r A_{1} \tag{8.42}
\end{equation*}
$$

Thus, the open-loop output impedance seen by $Z_{L}$ is multiplied by $1+g_{m} r A_{1}$, yielding

$$
\begin{equation*}
R_{\text {out }, \text { closed }}=\left(1+g_{m} r A_{1}\right)\left(r_{O}+r\right) \tag{8.43}
\end{equation*}
$$

We observe that $Z_{L}$ is now driven by a better current source.

As with voltage-voltage feedback, current-voltage feedback increases the input impedance by a factor equal to one plus the loop gain. As illustrated in Fig. 8.34, we have $I_{X} R_{\text {in }} G_{m}=I_{\text {out }}$. Thus, $V_{e}=$ $V_{X}-G_{m} R_{F} I_{X} R_{i n}$ and

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=R_{i n}\left(1+G_{m} R_{F}\right) \tag{8.44}
\end{equation*}
$$

The reader can show that the loop gain is indeed equal to $G_{m} R_{F}$.
In summary, current-voltage feedback increases both the input and the output impedances while decreasing the feedforward transconductance. As explained in Chapter 9, the high output impedance proves useful in high-gain op amps.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-294.jpg?height=428&width=611&top_left_y=247&top_left_x=468)

Figure 8.34 Calculation of input resistance of a current-voltage feedback amplifier.

### 8.2.3 Voltage-Current Feedback

In this type of feedback, the output voltage is sensed and a proportional current is returned to the summing point at the input. ${ }^{11}$ Note that the feedforward path incorporates a transimpedance amplifier with gain $R_{0}$ and the feedback factor has a dimension of conductance.

A voltage-current feedback topology is shown in Fig. 8.35. Sensing a voltage and producing a current, the feedback network is characterized by a transconductance $g_{m F}$, ideally exhibiting infinite input and output impedances. Since $I_{F}=g_{m F} V_{\text {out }}$ and $I_{e}=I_{\text {in }}-I_{F}$, we have $V_{\text {out }}=R_{0} I_{e}=R_{0}\left(I_{\text {in }}-g_{m F} V_{\text {out }}\right)$. It follows that

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{R_{0}}{1+g_{m F} R_{0}} \tag{8.45}
\end{equation*}
$$

The reader can prove that $g_{m F} R_{0}$ is indeed the loop gain, concluding that this type of feedback lowers the transimpedance by a factor equal to one plus the loop gain.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-294.jpg?height=424&width=672&top_left_y=1289&top_left_x=430)

Figure 8.35 Voltage-current feedback.

#### Example 8.8

Calculate the transimpedance, $V_{\text {out }} / I_{\text {in }}$, of the circuit shown in Fig. 8.36(a) at relatively low frequencies. Assume that $\lambda=0$. (The bias network of $M_{1}$ is not shown.)

#### Solution

In this circuit, the capacitive divider $C_{1}-C_{2}$ senses the output voltage, applying the result to the gate of $M_{1}$ and producing a current that is subtracted from $I_{i n}$. The open-loop transimpedance equals that of the core common-gate stage, $R_{D}$. The loop gain is obtained by setting $I_{i n}$ to zero and breaking the loop at the output [Fig. 8.36(b)]:

$$
\begin{equation*}
-V_{t} \frac{C_{1}}{C_{1}+C_{2}} g_{m 1} R_{D}=V_{F} \tag{8.46}
\end{equation*}
$$

[^53]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-295.jpg?height=511&width=939&top_left_y=236&top_left_x=496)

Figure 8.36
Thus, the overall transimpedance is equal to

$$
\begin{equation*}
R_{t o t}=\frac{R_{D}}{1+\frac{C_{1}}{C_{1}+C_{2}} g_{m 1} R_{D}} \tag{8.47}
\end{equation*}
$$

#### Example 8.9

We know from the previous example that

$$
\begin{equation*}
R_{i n}=\frac{1}{g_{m 2}} \frac{1}{1+\frac{C_{1}}{C_{1}+C_{2}} g_{m 1} R_{D}} \tag{8.48}
\end{equation*}
$$

A student repeats the analysis, but with the input driven by a voltage source, concluding that the loop gain is zero and the input impedance is not affected by the feedback loop. Explain the flaw in the student's argument.

#### Solution

Consider the arrangement shown in Fig. 8.37(a). We know that $R_{i n}$ is affected by the feedback because $M_{1}$ generates a current in response to $V_{i n}$. On the other hand, it appears from Fig. 8.37(b) that the loop gain is zero in this case. How do we reconcile these two views?
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-295.jpg?height=452&width=508&top_left_y=1618&top_left_x=435)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-295.jpg?height=446&width=433&top_left_y=1621&top_left_x=1059)
(b)

Figure 8.37
We must recall that returning current to the input assumes that the circuit is driven by a current source; i.e., our generic negative-feedback system requires that the returned quantity and the input have the same dimension. In other
words, the circuit of Fig. 8.37(a) does not map to our canonical feedback system because it returns a current but is driven by a voltage. We therefore cannot compute the loop gain by setting the input voltage to zero and breaking the loop. Of course, the input impedance is still given by Eq. (8.48). We will return to this circuit in Sec. 8.6.4 and apply Blackman's theorem to it.

Following our reasoning for the other two types of feedback studied above, we surmise that voltagecurrent feedback decreases both the input and the output impedances. As shown in Fig. 8.38(a) and noted in Example 8.3, the input resistance of $R_{0}$ appears in series with its input port. We write $I_{F}=I_{X}-V_{X} / R_{i n}$ and $\left(V_{X} / R_{i n}\right) R_{0} g_{m F}=I_{F}$. Thus,

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{i n}}{1+g_{m F} R_{0}} \tag{8.49}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-296.jpg?height=523&width=1428&top_left_y=827&top_left_x=326)

Figure 8.38 Calculation of (a) input and (b) output impedance of a voltage-current feedback amplifier.
Similarly, from Fig. 8.38(b), we have $I_{F}=V_{X} g_{m F}, I_{e}=-I_{F}$, and $V_{M}=-R_{0} g_{m F} V_{X}$. Neglecting the input current of the feedback network, we write $I_{X}=\left(V_{X}-V_{M}\right) / R_{\text {out }}=\left(V_{X}+g_{m F} R_{0} V_{X}\right) / R_{\text {out }}$. That is

$$
\begin{equation*}
\frac{V_{X}}{I_{X}}=\frac{R_{\text {out }}}{1+g_{m F} R_{0}} \tag{8.50}
\end{equation*}
$$

#### Example 8.10

Calculate the input and output impedances of the circuit shown in Fig. 8.39(a). For simplicity, assume that $R_{F} \gg R_{D}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-296.jpg?height=385&width=851&top_left_y=1851&top_left_x=607)

Figure 8.39

#### Solution

In this circuit, $R_{F}$ senses the output voltage and returns a current to the input. Breaking the loop as depicted in Fig. 8.39(b), we calculate the loop gain as $g_{m} R_{D}$. Thus, the open-loop input impedance, $R_{F}$, is divided by $1+g_{m} R_{D}$ :

$$
\begin{equation*}
R_{\text {in, closed }}=\frac{R_{F}}{1+g_{m} R_{D}} \tag{8.51}
\end{equation*}
$$

Similarly,

$$
\begin{align*}
R_{\text {out }, \text { closed }} & =\frac{R_{D}}{1+g_{m} R_{D}}  \tag{8.52}\\
& =\frac{1}{g_{m}} \| R_{D} \tag{8.53}
\end{align*}
$$

Note that $R_{\text {out,closed }}$ is in fact the parallel combination of a diode-connected transistor and $R_{D}$.
The reduction of the input impedance agrees with Miller's prediction: since the voltage gain from the gate of $M_{1}$ to its drain is approximately equal to $-g_{m} R_{D}$, the feedback resistor equivalently produces a grounded resistance at the input equal to $R_{F} /\left(1+g_{m} R_{D}\right)$.

An important application of amplifiers with low input impedance is in fiber optic receivers, where light received through a fiber is converted to a current by a reverse-biased photodiode. This current is typically converted to a voltage for further amplification and processing. Shown in Fig. 8.40(a), such conversion can be accomplished by a simple resistor, but at the cost of bandwidth because the diode suffers from a relatively large junction capacitance. For this reason, the feedback topology of Fig. 8.40(b) is usually employed, where $R_{1}$ is placed around the voltage amplifier $A$ to form a "transimpedance amplifier" (TIA). The input impedance is $R_{1} /(1+A)$ and the output voltage is approximately $-R_{1} I_{D 1}$. The bandwidth thus increases from $1 /\left(2 \pi R_{1} C_{D 1}\right)$ to $(1+A) /\left(2 \pi R_{1} C_{D 1}\right)$ if $A$ itself is a wideband amplifier.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-297.jpg?height=429&width=1405&top_left_y=1391&top_left_x=263)

Figure 8.40 Detection of current produced by a photodiode by (a) resistor $R_{1}$ and (b) a transimpedance amplifier.

### 8.2.4 Current-Current Feedback

Figure 8.41 illustrates this type of feedback. ${ }^{12}$ Here, the feedforward amplifier is characterized by a current gain, $A_{I}$, and the feedback network by a current ratio, $\beta$. In a fashion similar to the previous derivations, the reader can easily prove that the closed-loop current gain is equal to $A_{I} /\left(1+\beta A_{I}\right)$, the input impedance is divided by $1+\beta A_{I}$ and the output impedance is multiplied by $1+\beta A_{I}$.

[^54]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-298.jpg?height=432&width=723&top_left_y=240&top_left_x=673)

Figure 8.41 Current-current feedback.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-298.jpg?height=421&width=426&top_left_y=799&top_left_x=555)

Figure 8.42

Figure 8.42 illustrates an example of current-current feedback. Here, since the source and drain currents of $M_{2}$ are equal (at low frequencies), resistor $R_{S}$ is inserted in the source network to monitor the output current. Resistor $R_{F}$ plays the same role as in Fig. 8.39.

### 8.3 Effect of Feedback on Noise

反馈并不能提高电路的噪声性能！

Feedback does not improve the noise performance of circuits. Let us first consider the simple case illustrated in Fig. 8.43(a), where the open-loop voltage amplifier $A_{1}$ is characterized by only an inputreferred noise voltage and the feedback network is noiseless. We have $\left(V_{\text {in }}-\beta V_{\text {out }}+V_{n}\right) A_{1}=V_{\text {out }}$, and hence

$$
\begin{equation*}
V_{\text {out }}=\left(V_{\text {in }}+V_{n}\right) \frac{A_{1}}{1+\beta A_{1}} \tag{8.54}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-298.jpg?height=352&width=1225&top_left_y=1899&top_left_x=427)

Figure 8.43 Feedback around a noisy circuit.

Thus, the circuit can be simplified as shown in Fig. 8.43(b), revealing that the input-referred noise of the overall circuit is still equal to $V_{n}$. This analysis can be extended to all four feedback topologies to prove that the input-referred noise voltage and current remain the same if the feedback network introduces no noise. In practice, the feedback network itself may contain resistors or transistors, degrading the overall noise performance.

It is important to note that in Fig. 8.43(a), the output of interest is the same as the quantity sensed by the feedback network. This need not always be the case. For example, in the circuit of Fig. 8.44, the output is provided at the drain of $M_{1}$ whereas the feedback network senses the voltage at the source of $M_{1}$. In such cases, the input-referred noise of the closed-loop circuit may not be equal to that of the open-loop circuit even if the feedback network is noiseless. As an example, let us consider the topology of Fig. 8.44 and, for simplicity, take only the noise of $R_{D}, V_{n, R D}$, into account. The reader can prove that the closed-loop voltage gain is equal to $-A_{1} g_{m} R_{D} /\left[1+\left(1+A_{1}\right) g_{m} R_{S}\right]$ if $\lambda=\gamma=0$, and hence the input-referred noise voltage due to $R_{D}$ is

$$
\begin{equation*}
\left|V_{n, i n, \text { closed }}\right|=\frac{\left|V_{n, R D}\right|}{A_{1} R_{D}}\left[\frac{1}{g_{m}}+\left(1+A_{1}\right) R_{S}\right] \tag{8.55}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-299.jpg?height=390&width=469&top_left_y=942&top_left_x=457)

Figure 8.44 Noisy circuit with feedback sensing the source voltage.

For the open-loop circuit, on the other hand, the input-referred noise is

$$
\begin{equation*}
\left|V_{n, \text { in }, \text { open }}\right|=\frac{\left|V_{n, R D}\right|}{A_{1} R_{D}}\left[\frac{1}{g_{m}}+R_{S}\right] \tag{8.56}
\end{equation*}
$$

Interestingly, as $A_{1} \rightarrow \infty,\left|V_{n, \text { in, closed }}\right| \rightarrow\left|V_{n, R D}\right| R_{S} / R_{D}$ whereas $\left|V_{n, \text { in }, \text { open }}\right| \rightarrow 0$.
8.4 - Feedback Analysis Difficulties

Our study of feedback systems has made some simplifying assumptions that may not hold in all circuits. In this section, we point out five difficulties that arise in the analysis of feedback circuits, and in subsequent sections, we deal with some of them.

The analysis approach described previously proceeds as follows: (a) break the loop and obtain the open-loop gain and input and output impedances, (b) determine the loop gain, $\beta A_{0}$, and hence the closed-
loop parameters from their open-loop counterparts, and (c) use the loop gain to study properties such as open-loop gain and input and output impedances, (b) determine the loop gain, $\beta A_{0}$, and hence the closed-
loop parameters from their open-loop counterparts, and (c) use the loop gain to study properties such as stability (Chapter 10), etc. However, this approach faces issues in some circuits.

The first difficulty relates to breaking the loop and stems from the "loading" effects imposed by the feedback network upon the feedforward amplifier. For example, in the noninverting amplifier of Fig. 8.45(a) and its simple implementation shown in Fig. 8.45(b), the feedback branch consisting of $R_{1}$
and $R_{2}$ may draw a significant signal current from the op amp, reducing its open-loop gain. Figure 8.45(c) Fig. 8.45(a) and its simple implementation shown in Fig. 8.45(b), the feedback branch consisting of $R_{1}$
and $R_{2}$ may draw a significant signal current from the op amp, reducing its open-loop gain. Figure 8.45(c) depicts another case, in which the open-loop gain of the forward CS stage falls if $R_{F}$ is not very large. In both cases, this "output" loading results from the nonideal input impedance of the feedback network.

实际上，反馈网络往往会包含电阻或者电容，这会降低整体的噪声性能
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-299.jpg?height=21&width=1402&top_left_y=2292&top_left_x=245)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-300.jpg?height=1123&width=1036&top_left_y=238&top_left_x=519)

Figure 8.45 (a) Noninverting amplifier, (b) implementation using a differential pair, (c) implementation using a CS stage, and (d) implementation using a two-stage amplifier.

As another example, consider the arrangement shown in Fig. 8.45(d), where $R_{1}$ and $R_{2}$ sense $V_{\text {out }}$ and return a voltage to the source of $M_{1}$. Since the output impedance of the feedback network may not be sufficiently small, we surmise that $M_{1}$ is degenerated appreciably even as far as the open-loop forward amplifier is concerned. This circuit exemplifies "input loading" due to the nonideal output impedance of the feedback network.

The important question that we must address with regard to loading is, how do we break the loop while properly including output and input loading effects?

#### Example 8.11

Can the loop be broken at the gate of $M_{2}$ in Fig. 8.45(d) without concern for loading effects?

#### Solution

As illustrated in Fig. 8.46, such an attempt provides the loop gain while avoiding loading issues. However, we are also interested in the open-loop gain and the open-loop input and output impedances, which cannot be obtained from this configuration. We must therefore develop a methodical approach to constructing the open-loop system such that the loading effects are included.

The second difficulty is that some circuits cannot be clearly decomposed into a forward amplifier and a feedback network. In the two-stage network of Fig. 8.47, it is unclear whether $R_{D 2}$ belongs to the
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-301.jpg?height=469&width=462&top_left_y=247&top_left_x=466)

Figure 8.46
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-301.jpg?height=426&width=431&top_left_y=778&top_left_x=481)

Figure 8.47 Feedback circuit without a clearly-distinguishable feedback network.
feedforward amplifier or the feedback network. We might choose the former case, reasoning that $M_{2}$ needs a load so as to operate as a voltage amplifier, but such a choice seems arbitrary.

The third difficulty in feedback analysis is that some circuits do not readily map to the four canonical topologies studied in the previous sections. For example, a simple degenerated common-source stage does contain feedback because the source resistance measures the drain current, converts it to voltage, and subtracts the result from the input [Fig. 8.48(a)]. However, it is not immediately clear which feedback topology represents this arrangement because the sensed quantity, $I_{D 1}$, is different from the output of interest, $V_{\text {out }}$ [Fig. 8.48(b)].
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-301.jpg?height=421&width=303&top_left_y=1621&top_left_x=512)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-301.jpg?height=370&width=508&top_left_y=1631&top_left_x=906)
(b)

Figure 8.48 (a) CS stage and (b) block diagram showing the output and sense ports.
The fourth difficulty is that the general feedback system analyzed thus far assumes unilateral stages, i.e., signal propagation in only one direction around the loop. In practice, however, the loop may contain bilateral circuits, allowing signals to flow from the output toward the input through a path other than the
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-302.jpg?height=449&width=572&top_left_y=242&top_left_x=477)

Figure 8.49 Example of circuit with more than one feedback mechanism.
nominal feedback path. In Fig. 8.47, for example, the signal leaks from the drain of $M_{2}$ to its gate through $C_{G D 2}$ at high frequencies.

The fifth difficulty arises in circuits containing multiple feedback mechanisms (loosely called "multiloop" circuits). In the topology of Fig. 8.49, for example, $R_{F}$ provides feedback around the circuit, and $C_{G S 2}$ around $M_{2}$. We can also say that the source follower itself contains degeneration and hence feedback. We must then ask, which loop should be broken and what exactly do we mean by "loop gain" in this case? Table 8.1 summarizes the five issues described here.

Table 8.1 Feedback analysis difficulties.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-302.jpg?height=531&width=1645&top_left_y=1082&top_left_x=148)

In this chapter, we introduce three methods of feedback circuit analysis. Outlined in Table 8.2, the first employs two-port models to analyze the four canonical topologies while including loading effects.

Table 8.2 Three methods of feedback analysis.

| Two-Port Method | Bode's Method | Middlebrook's Method |
| :---: | :---: | :---: |
| - Computes open-loop and closed-loop quantities and the loop gain. <br> - Includes loading effects. <br> - Neglects feedforward through feedback network. <br> - Can be applied recursively to multiple feedback mechanisms. <br> - Does not apply to noncanonical topologies. | - Computes closed-loop quantities without breaking the loop. <br> - Applies to any topology. <br> - Provides loop gain only if one feedback mechanism is present. | - Computes closed-loop quantities without breaking the loop. <br> - Applies to any topology. <br> - Provides loop gain only if local and global loops are distinguishable. <br> - Reveals effect of reverse loop gain in nonunilateral loops. |

This method proves more efficient than direct analysis of the circuit (with no knowledge of feedback) if the loop is assumed unilateral, i.e., the forward propagation of the input signal through the feedback network is neglected, and so is the backward propagation of the signal through the forward amplifier. The other two methods do not attempt to break the loop and yield the closed-loop quantities exactly but with lengthier algebra.

## 8.5 ■ Effect of Loading

The problem of loading manifests itself when we need to break the feedback loop so as to identify the open-loop system, e.g., calculate the open-loop gain and the input and output impedances. To arrive at the proper procedure for including the feedback network terminal impedances, we first review models of two-port networks.

### 8.5.1 Two-Port Network Models

The simplified amplifier and feedback network models employed in the previous sections may not suffice in general. We must therefore resort to accurate two-port models. For example, the feedback network placed around the feedforward amplifier can be considered a two-port circuit sensing and producing voltages or currents. Recall from basic circuit theory that a two-port linear (and time-invariant) network can be represented by any of the four models shown in Fig. 8.50. The "Z model" in Fig. 8.50(a) consists of input and output impedances in series with current-dependent voltage sources, whereas the "Y model" in Fig. 8.50(b) comprises input and output admittances in parallel with voltage-dependent current sources. The "hybrid models" of Figs. 8.50(c) and (d) incorporate a combination of impedances and admittances and voltage sources and current sources. Each model is described by two equations. For the Z model, we have

$$
\begin{align*}
& V_{1}=Z_{11} I_{1}+Z_{12} I_{2}  \tag{8.57}\\
& V_{2}=Z_{21} I_{1}+Z_{22} I_{2} \tag{8.58}
\end{align*}
$$

Each Z parameter has a dimension of impedance and is obtained by leaving one port open, e.g., $Z_{11}=$ $V_{1} / I_{1}$ when $I_{2}=0$. Similarly, for the Y model,

$$
\begin{align*}
& I_{1}=Y_{11} V_{1}+Y_{12} V_{2}  \tag{8.59}\\
& I_{2}=Y_{21} V_{1}+Y_{22} V_{2} \tag{8.60}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-303.jpg?height=510&width=1525&top_left_y=1717&top_left_x=216)

Figure 8.50 Linear two-port network models.
where each Y parameter is calculated by shorting one port, e.g., $Y_{11}=I_{1} / V_{1}$ when $V_{2}=0$. For the H model,

$$
\begin{align*}
& V_{1}=H_{11} I_{1}+H_{12} V_{2}  \tag{8.61}\\
& I_{2}=H_{21} I_{1}+H_{22} V_{2} \tag{8.62}
\end{align*}
$$

and for the G model,

$$
\begin{align*}
I_{1} & =G_{11} V_{1}+G_{12} I_{2}  \tag{8.63}\\
V_{2} & =G_{21} V_{1}+G_{22} I_{2} \tag{8.64}
\end{align*}
$$

Note that, for example, $Y_{11}$ may not be equal to the inverse of $Z_{11}$ because the two are obtained under different conditions: the output is shorted for the former but left open for the latter.

It is instructive to compare the general two-port models with the simplified amplifier representations that we have used in the previous sections. For example, let us consider the voltage amplifier model in Example 8.3 vis-à-vis the Z model. We observe that (1) absent in the former, $Z_{12} I_{2}$ represents the amplifier's internal feedback, e.g., due to $C_{G D}$; (2) if $Z_{12}$ is zero, then $Z_{11}$ is equal to $Z_{i n}$, the input impedance calculated with the output left open; and (3) $Z_{22}$ is not necessarily equal to $Z_{\text {out }}$ : the former is computed with the input port left open and the latter with the input shorted.

The most important drawback of the Z model for our purposes is that its output generator, $Z_{21} I_{1}$, is controlled by the input current rather than the input voltage. For a MOS circuit with the input applied to the gate, this model becomes meaningless if the input capacitance is neglected. The H model entails the same difficulty.

Do any of the two-port models agree with our intuitive picture of voltage amplifiers? Yes, the G model is close. If the internal feedback, $G_{12} I_{2}$, is neglected, then $G_{11}\left(=I_{1} / V_{1}\right.$ with $\left.I_{2}=0\right)$ represents the inverse of the input impedance, and $G_{22}\left(=V_{2} / I_{2}\right.$ with $\left.V_{1}=0\right)$ the output impedance. The reader can try this exercise for the other three types of amplifiers.

### 8.5.2 Loading in Voltage-Voltage Feedback

As mentioned before, the Z and H models fail to represent voltage amplifiers if the input current is very small—as in a simple CS stage. We therefore choose the G model here. ${ }^{13}$ The complete equivalent circuit is shown in Fig. 8.51(a), where the forward and feedback network parameters are denoted by upper-case and lower-case letters, respectively. Since the input port of the feedback network is connected to the output port of the forward amplifier, $g_{11}$ and $g_{12} I_{\text {in }}$ are tied to $V_{\text {out }}$.

It is possible to solve this circuit exactly, but we simplify the analysis by neglecting two quantities: the amplifier's internal feedback, $G_{12} V_{\text {out }}$, and the "forward" propagation of the input signal through the feedback network, $g_{12} I_{i n}$. In other words, the loop is "unilateralized." Figure 8.51(b) depicts the resulting circuit with our intuitive amplifier notations ( $Z_{i n}, Z_{\text {out }}, A_{0}$ ) added to indicate equivalencies. Let us first directly compute the closed-loop voltage gain. Recognizing that $g_{11}$ is an admittance and $g_{22}$ an impedance, we write a KVL around the input network and a KCL at the output node:

$$
\begin{array}{r}
V_{\text {in }}=V_{e}+g_{22} \frac{V_{e}}{Z_{\text {in }}}+g_{21} V_{\text {out }} \\
g_{11} V_{\text {out }}+\frac{V_{\text {out }}-A_{0} V_{e}}{Z_{\text {out }}}=0 \tag{8.66}
\end{array}
$$

[^55]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-305.jpg?height=1031&width=995&top_left_y=227&top_left_x=509)

Figure 8.51 Voltage-voltage feedback circuit with (a) feedback network represented by a G model and (b) a simplified G model.

Finding $V_{e}$ from the latter equation and substituting the result in the former, we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{A_{0}}{\left(1+\frac{g_{22}}{Z_{\text {in }}}\right)\left(1+g_{11} Z_{\text {out }}\right)+g_{21} A_{0}} \tag{8.67}
\end{equation*}
$$

It is desirable to express the closed-loop gain in the familiar form, $A_{v, \text { open }} /\left(1+\beta A_{v, \text { open }}\right)$. To this end, we divide the numerator and the denominator by $\left(1+g_{22} / Z_{\text {in }}\right)\left(1+g_{11} Z_{\text {out }}\right)$ :

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{\frac{A_{0}}{\left(1+\frac{g_{22}}{Z_{\text {in }}}\right)\left(1+g_{11} Z_{\text {out }}\right)}}{1+g_{21} \frac{A_{0}}{\left(1+\frac{g_{22}}{Z_{\text {in }}}\right)\left(1+g_{11} Z_{\text {out }}\right)}} \tag{8.68}
\end{equation*}
$$

We can thus write

$$
\begin{align*}
A_{v, \text { open }} & =\frac{A_{0}}{\left(1+\frac{g_{22}}{Z_{\text {in }}}\right)\left(1+g_{11} Z_{\text {out }}\right)}  \tag{8.69}\\
\beta & =g_{21} \tag{8.70}
\end{align*}
$$

Let us now interpret these results. The equivalent open-loop gain contains a factor $A_{0}$, i.e., the original amplifier's voltage gain (before immersion in feedback). But this gain is attenuated by two factors, namely, $1+g_{22} / Z_{\text {in }}$ and $1+g_{11} Z_{\text {out }}$. Interestingly, we can write $1+g_{22} / Z_{\text {in }}=\left(Z_{\text {in }}+g_{22}\right) / Z_{\text {in }}$, concluding that $A_{0}$ is multiplied by $Z_{i n} /\left(Z_{i n}+g_{22}\right)$, which reminds us of a voltage divider. Similarly, $1+g_{11} Z_{\text {out }}=\left(g_{11}^{-1}+Z_{\text {out }}\right) / g_{11}^{-1}$, whose inverse points to another voltage divider. The loaded forward amplifier now emerges as shown in Fig. 8.52. Note that this model excludes the two generators $G_{12} V_{\text {out }}$ and $g_{12} I_{i n}$, which are generally not negligible.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-306.jpg?height=373&width=720&top_left_y=569&top_left_x=675)

Figure 8.52 Proper method of including loading in a voltage-voltage feedback circuit.
The reader may wonder why we go to the trouble of finding the open-loop parameters while the closed-loop circuit in Fig. 8.51(a) can be solved exactly. The key principle here is that the rules depicted in Fig. 8.52 afford us a quick and intuitive understanding of the circuit that would not be possible from the direct analysis of Fig. 8.51(a). Specifically, we recognize that the finite input and output impedances of the feedback network reduce the output voltage and the voltage seen by the input of the main amplifier, respectively.

It is important to note that $g_{11}$ and $g_{22}$ in Fig. 8.50 are computed as follows:

$$
\begin{align*}
& g_{11}=\left.\frac{I_{1}}{V_{1}}\right|_{I 2=0}  \tag{8.71}\\
& g_{22}=\left.\frac{V_{2}}{I_{2}}\right|_{V 1=0} \tag{8.72}
\end{align*}
$$

Thus, as illustrated in Fig. 8.53, $g_{11}$ is obtained by leaving the output of the feedback network open whereas $g_{22}$ is calculated by shorting the input of the feedback network.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-306.jpg?height=322&width=603&top_left_y=1701&top_left_x=467)

Figure 8.53 Conceptual view of opening a voltage-voltage feedback loop with proper loading.

Another important result of the foregoing analysis is that the loop gain, i.e., the second term in the denominator of (8.68), is simply equal to the loaded open-loop gain multiplied by $g_{21}$. Thus, a separate calculation of the loop gain is not necessary. Also, the open-loop input and output impedances obtained from Fig. 8.52 are scaled by $1+g_{21} A_{v, \text { open }}$ to yield the closed-loop values. Again, we must bear in mind that this loop gain neglects the effect of $G_{12} V_{\text {out }}$ and $g_{12} I_{i n}$.

#### Example 8.12

For the circuit shown in Fig. 8.54(a), calculate the open-loop and closed-loop gains assuming $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-307.jpg?height=474&width=1169&top_left_y=388&top_left_x=384)

Figure 8.54

#### Solution

The circuit consists of two common-source stages, with $R_{F}$ and $R_{S}$ sensing the output voltage and returning a fraction thereof to the source of $M_{1}$. This transistor subtracts the returned voltage from $V_{i n}$. The reader can prove that the feedback is indeed negative. Following the procedure illustrated in Fig. 8.53, we identify $R_{F}$ and $R_{S}$ as the feedback network and construct the open-loop circuit as shown in Fig. 8.54(b). Note that the loading effect in the input network is obtained by shorting the right terminal of $R_{F}$ to ground and that in the output by leaving the left terminal of $R_{F}$ open. Neglecting channel-length modulation and body effect for simplicity, we observe that $M_{1}$ is degenerated by the feedback network and

$$
\begin{equation*}
A_{v, \text { open }}=\frac{V_{Y}}{V_{\text {in }}}=\frac{-R_{D 1}}{R_{F} \| R_{S}+1 / g_{m 1}}\left\{-g_{m 2}\left[R_{D 2} \|\left(R_{F}+R_{S}\right)\right]\right\} \tag{8.73}
\end{equation*}
$$

To compute the closed-loop gain, we first find the loop gain as $g_{21} A_{v, \text { open }}$. Recall from (8.64) that $g_{21}=V_{2} / V_{1}$ with $I_{2}=0$. For the voltage divider consisting of $R_{F}$ and $R_{S}, g_{21}=R_{S} /\left(R_{F}+R_{S}\right)$. The closed-loop gain is simply equal to $A_{v, \text { closed }}=A_{v, \text { open }} /\left(1+g_{21} A_{v, \text { open }}\right)$.

Can we include $R_{D 2}$ in the feedback network rather than in the forward amplifier? Yes, we can ascribe a finite $r_{O}$ to $M_{2}$ and proceed while considering $R_{D 2}, R_{F}$, and $R_{S}$ as the feedback network. The result is slightly different from that obtained above.

The above analysis neglects the forward amplifier's internal feedback (e.g., due to $C_{G D 2}$ ) and the propagation of the input signal from the source of $M_{1}$ and through $R_{F}$ to the output. (Transistor $M_{1}$ also operates as a source follower in this case.)

#### Example 8.13

A student eager to understand the approximations leading to the circuit in Fig. 8.51(b) decides to use an H model for the forward amplifier and obtain an exact solution. Perform this analysis and explain the results.

#### Solution

Illustrated in Fig. 8.55, this representation is attractive as it allows a simple series connection of voltages and impedances at the input and a parallel connection at the output. Writing a KVL and a KCL gives

$$
\begin{array}{r}
V_{\text {in }}=I_{\text {in }} H_{11}+H_{12} V_{\text {out }}+I_{\text {in }} g_{22}+g_{21} V_{\text {out }} \\
H_{22} V_{\text {out }}+H_{21} I_{\text {in }}+g_{11} V_{\text {out }}+g_{12} I_{\text {in }}=0 \tag{8.75}
\end{array}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-308.jpg?height=441&width=879&top_left_y=243&top_left_x=595)

Figure 8.55

Finding $I_{i n}$ from the latter and replacing it in the former, we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{-\frac{H_{21}+g_{12}}{\left(H_{22}+g_{11}\right)\left(H_{11}+g_{22}\right)}}{1-\left(H_{12}+g_{21}\right) \frac{H_{21}+g_{12}}{\left(H_{22}+g_{11}\right)\left(H_{11}+g_{22}\right)}} \tag{8.76}
\end{equation*}
$$

We can thus define

$$
\begin{align*}
A_{v, \text { open }} & =-\frac{H_{21}+g_{12}}{\left(H_{22}+g_{11}\right)\left(H_{11}+g_{22}\right)}  \tag{8.77}\\
\beta & =H_{12}+g_{21} \tag{8.78}
\end{align*}
$$

If we assume that $g_{12} \ll H_{21}$ and $H_{12} \ll g_{21}$, then

$$
\begin{align*}
A_{v, \text { open }} & =\frac{-H_{21}}{\left(H_{22}+g_{11}\right)\left(H_{11}+g_{22}\right)}  \tag{8.79}\\
\beta & =g_{21} \tag{8.80}
\end{align*}
$$

and the attenuation factors $H_{22}+g_{11}$ and $H_{11}+g_{22}$ can be interpreted in the same manner as those in Eq. (8.69). This approach therefore explicitly reveals the simplifying approximations, namely, $g_{12} \ll H_{21}$ and $H_{12} \ll g_{21}$. Unfortunately, however, for a MOS gate input, $H_{21}$ (the "current gain") approaches infinity, making the model difficult to use.

### 8.5.3 Loading in Current-Voltage Feedback

In this case, the feedback network appears in series with the output so as to sense the current. We represent the forward amplifier and the feedback network by Y and Z models, respectively (Fig. 8.56), neglecting the generators $Y_{12} V_{\text {out }}$ and $z_{12} I_{\text {in }}$. We wish to compute the closed-loop gain, $I_{\text {out }} / V_{\text {in }}$, and therefrom determine how the open-loop parameters can be obtained in the presence of loading. Noting that $I_{i n}=Y_{11} V_{e}$ and $I_{2}=I_{i n}$, we write two KVLs:

$$
\begin{align*}
V_{\text {in }} & =V_{e}+Y_{11} V_{e} z_{22}+z_{21} I_{\text {out }}  \tag{8.81}\\
-I_{\text {out }} z_{11} & =\frac{I_{\text {out }}-Y_{21} V_{e}}{Y_{22}} \tag{8.82}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-309.jpg?height=468&width=870&top_left_y=245&top_left_x=528)

Figure 8.56 Current-voltage feedback circuit with loading.

Finding $V_{e}$ from the latter and substituting in the former, we have

$$
\begin{equation*}
\frac{I_{\text {out }}}{V_{\text {in }}}=\frac{\frac{Y_{21}}{\left(1+z_{22} Y_{11}\right)\left(1+z_{11} Y_{22}\right)}}{1+z_{21} \frac{Y_{21}}{\left(1+z_{22} Y_{11}\right)\left(1+z_{11} Y_{22}\right)}} \tag{8.83}
\end{equation*}
$$

We can thus visualize the open-loop gain and the feedback factor as

$$
\begin{align*}
G_{m, \text { open }} & =\frac{Y_{21}}{\left(1+z_{22} Y_{11}\right)\left(1+z_{11} Y_{22}\right)}  \tag{8.84}\\
\beta & =z_{21} \tag{8.85}
\end{align*}
$$

Note that $Y_{21}$ is in fact the transconductance gain, $G_{m}$, of the original amplifier. The two attenuation factors $\left(1+z_{22} Y_{11}\right)^{-1}$ and $\left(1+z_{11} Y_{22}\right)^{-1}$ respectively correspond to voltage division at the input and current division at the output, allowing us to construct the loaded open-loop forward amplifier as shown in Fig. 8.57. Since $z_{22}=V_{2} / I_{2}$ with $I_{1}=0$ and $z_{11}=V_{1} / I_{1}$ with $I_{2}=0$, we arrive at the conceptual picture depicted in Fig. 8.58 for properly breaking the feedback. Note that the loop gain is equal to $z_{21} G_{m, \text { open }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-309.jpg?height=288&width=652&top_left_y=1595&top_left_x=368)

Figure 8.57 Current-voltage feedback circuit with proper loading of feedback network.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-309.jpg?height=327&width=570&top_left_y=1952&top_left_x=409)

Figure 8.58 Conceptual view of opening the loop in current-voltage feedback.

#### Example 8.14

A PMOS current source delivers a current to a load, e.g., the rechargeable battery in a cell phone [Fig. 8.59(a)]. We wish to make this current less PVT-dependent by means of negative feedback. As shown in Fig. 8.59(b), we convert the output current to voltage by a small series resistor, $r_{M}$, compare this voltage with a reference by means of an amplifier, and return the result to the gate of $M_{1}$. Determine the output current and the impedance seen by the load.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-310.jpg?height=531&width=1569&top_left_y=490&top_left_x=194)

Figure 8.59

#### Solution

We view $V_{b}$ as the input voltage and recognize that $r_{M}$ sustains a voltage approximately equal to $V_{b}$ if the loop gain is high. That is, $I_{\text {out }} \approx V_{b} / r_{M}$. But let us analyze this arrangement more accurately. Redrawing the circuit as in Fig. 8.59(c), we identify $A_{1}$ and $M_{1}$ as the forward transconductance amplifier and $r_{M}$ as the feedback network. The procedure depicted in Fig. 8.58 leads to the open-loop topology of Fig. 8.59(d), and hence

$$
\begin{align*}
G_{m, \text { open }} & =\frac{I_{\text {out }}}{V_{b}}  \tag{8.86}\\
& \approx A_{1} g_{m} \tag{8.87}
\end{align*}
$$

where the current flowing through $r_{O}$ is neglected. The feedback factor $\beta=z_{21}=r_{M}$. Thus, the closed-loop output current is given by

$$
\begin{equation*}
I_{\text {out }}=\frac{A_{1} g_{m}}{1+A_{1} g_{m} r_{M}} V_{b} \tag{8.88}
\end{equation*}
$$

In the open-loop configuration, the load sees an impedance of $r_{O}+r_{M}$. Since feedback regulates the output current, the impedance seen by the load rises by a factor of $1+A_{1} g_{m} r_{M}$, reaching $Z_{\text {out }}=\left(1+A_{1} g_{m} r_{M}\right)\left(r_{O}+r_{M}\right)$.

A critical point emerging from this example is that the output impedance of a current-voltage feedback topology must be obtained by breaking the output current path and measuring the impedance between the resulting two nodes [e.g., $X$ and $Y$ in Fig. 8.59(b)]. In the above calculations, the "impedance seen by the load" is in fact computed by replacing the load with a voltage source and measuring the current through it.

### 8.5.4 Loading in Voltage-Current Feedback

In this configuration, the forward (transimpedance) amplifier generates an output voltage in response to the input current and can thus be represented by a Z model. Sensing the output voltage and returning a proportional current, the feedback network lends itself to a Y model. The equivalent circuit is shown in Fig. 8.60, where the effect of $Z_{12}$ and $y_{12}$ is neglected. As in previous cases, we compute the closed-loop
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-311.jpg?height=473&width=902&top_left_y=245&top_left_x=530)

Figure 8.60 Voltage-current feedback circuit with loading.
gain, $V_{\text {out }} / I_{\text {in }}$, by writing two equations:

$$
\begin{array}{r}
I_{\text {in }}=I_{e}+I_{e} Z_{11} y_{22}+y_{21} V_{\text {out }} \\
y_{11} V_{\text {out }}+\frac{V_{\text {out }}-Z_{21} I_{e}}{Z_{22}}=0 \tag{8.90}
\end{array}
$$

Eliminating $I_{e}$, we obtain

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{\frac{Z_{21}}{\left(1+y_{22} Z_{11}\right)\left(1+y_{11} Z_{22}\right)}}{1+y_{21} \frac{Z_{21}}{\left(1+y_{22} Z_{11}\right)\left(1+y_{11} Z_{22}\right)}} \tag{8.91}
\end{equation*}
$$

Thus, the equivalent open-loop gain and feedback factor are given by

$$
\begin{align*}
R_{0, \text { open }} & =\frac{Z_{21}}{\left(1+y_{22} Z_{11}\right)\left(1+y_{11} Z_{22}\right)}  \tag{8.92}\\
\beta & =y_{21} \tag{8.93}
\end{align*}
$$

Interpreting the attenuation factors in $R_{0, \text { open }}$ as current division at the input and voltage division at the output, we arrive at the conceptual view in Fig. 8.61. The loop gain is given by $y_{21} R_{0, \text { open }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-311.jpg?height=332&width=659&top_left_y=1719&top_left_x=367)

Figure 8.61 Conceptual view of opening the loop in voltage-current feedback.

#### Example 8.15

Figure 8.62(a) shows a transimpedance amplifier topology commonly used in optical communication systems. Determine the circuit's gain and input and output impedances if $\lambda=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-312.jpg?height=393&width=1294&top_left_y=231&top_left_x=388)

Figure 8.62

#### Solution

We can view the feedback resistor, $R_{F}$, as a network that senses the output voltage, converts it to current, and returns the result to the input. Following Figure 8.61, we construct the loaded open-loop amplifier as shown in Fig. 8.62(b), and express the open-loop gain as

$$
\begin{equation*}
R_{0, \text { open }}=-R_{F} g_{m}\left(R_{F} \| R_{D}\right) \tag{8.94}
\end{equation*}
$$

The feedback factor, $y_{21}\left(=I_{2} / V_{1}\right.$ with $\left.V_{2}=0\right)$ is equal to $-1 / R_{F}$. It follows that the closed-loop gain is equal to

$$
\begin{equation*}
\frac{V_{\text {out }}}{I_{\text {in }}}=\frac{-R_{F} g_{m}\left(R_{F} \| R_{D}\right)}{1+g_{m}\left(R_{F} \| R_{D}\right)} \tag{8.95}
\end{equation*}
$$

which, if $g_{m}\left(R_{F} \| R_{D}\right) \gg 1$, reduces to $-R_{F}$, an expected result (why?). The closed-loop input impedance is

$$
\begin{equation*}
R_{i n}=\frac{R_{F}}{1+g_{m}\left(R_{F} \| R_{D}\right)} \tag{8.96}
\end{equation*}
$$

which is approximately equal to $\left(1+R_{F} / R_{D}\right)\left(1 / g_{m}\right)$ if the above condition holds. Similarly, the closed-loop output impedance is given by

$$
\begin{equation*}
R_{\text {out }}=\frac{R_{F} \| R_{D}}{1+g_{m}\left(R_{F} \| R_{D}\right)} \tag{8.97}
\end{equation*}
$$

which amounts to $1 / g_{m}$ if $g_{m}\left(R_{F} \| R_{D}\right) \gg 1$. Note that if $\lambda>0$, we can simply replace $R_{D}$ with $R_{D} \| r_{O}$ in all of the foregoing equations.

This transconductance amplifier is simple enough that we can solve it directly, and the reader is encouraged to do so. But we can readily identify two inconsistencies. First, breaking the loop at the gate of $M_{1}$ yields a loop gain of $g_{m} R_{D}$ rather than $g_{m}\left(R_{D} \| R_{F}\right)$. Second, the closed-loop output impedance [with $I_{i n}$ set to zero in Fig. 8.62(a)] is simply equal to $R_{D} \|\left(1 / g_{m}\right)=R_{D} /\left(1+g_{m} R_{D}\right)$. The value derived above can be expressed as $R_{D} /\left(1+g_{m} R_{D}+R_{D} / R_{F}\right)$, revealing the extra term $R_{D} / R_{F}$. These errors arise from the approximate nature of the model.

#### Example 8.16

Calculate the voltage gain of the circuit shown in Fig. 8.63(a).

#### Solution

What type of feedback is used in this circuit? Resistor $R_{F}$ senses the output voltage and returns a proportional current to node $X$. Thus, the feedback can be considered as the voltage-current type. However, in the general representation of Fig. 8.60(a), the input signal is a current quantity, whereas in this example, it is a voltage quantity. For this reason, we replace $V_{i n}$ and $R_{S}$ by a Norton equivalent [Fig. 8.63(b)] and view $R_{S}$ as the input resistance of the main amplifier. Opening the loop according to Fig. 8.61 and neglecting channel-length modulation, we write the open-loop gain
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-313.jpg?height=403&width=1361&top_left_y=239&top_left_x=283)

Figure 8.63
from Fig. 8.63(c) as

$$
\begin{align*}
R_{0, \text { open }} & =\left.\frac{V_{\text {out }}}{I_{N}}\right|_{\text {open }}  \tag{8.98}\\
& =-\left(R_{S} \| R_{F}\right) g_{m}\left(R_{F} \| R_{D}\right) \tag{8.99}
\end{align*}
$$

where $I_{N}=V_{\text {in }} / R_{S}$. We also calculate the loop gain as $y_{21} R_{0, \text { open }}$. Thus, the circuit of Fig. 8.63(a) exhibits a voltage gain of

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{1}{R_{S}} \cdot \frac{-\left(R_{S} \| R_{F}\right) g_{m}\left(R_{F} \| R_{D}\right)}{1+g_{m}\left(R_{F} \| R_{D}\right) R_{S} /\left(R_{S}+R_{F}\right)} \tag{8.100}
\end{equation*}
$$

Interestingly, if $R_{F}$ is replaced by a capacitor, this analysis does not yield a zero in the transfer function because we have neglected the reverse transmission of the feedback network (from the output of the feedback network to its input). The input and output impedances of the circuit are also interesting to calculate. This is left as an exercise for the reader. The reader is also encouraged to apply this solution to the circuit of Fig. 8.3(b).

### 8.5.5 Loading in Current-Current Feedback

The forward amplifier in this case generates an output current in response to the input current and can be represented by an H model, and so can the feedback network. Shown in Fig. 8.64 is the equivalent circuit with the $H_{12}$ and $h_{12}$ generators neglected. We write

$$
\begin{align*}
I_{\text {in }} & =I_{e} H_{11} h_{22}+h_{21} I_{\text {out }}+I_{e}  \tag{8.101}\\
I_{\text {out }} & =-I_{\text {out }} h_{11} H_{22}+H_{21} I_{e} \tag{8.102}
\end{align*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-313.jpg?height=436&width=756&top_left_y=1803&top_left_x=585)

Figure 8.64 Equivalent circuit for current-current feedback.
and hence

$$
\begin{equation*}
\frac{I_{\text {out }}}{I_{\text {in }}}=\frac{\frac{H_{21}}{\left(1+h_{22} H_{11}\right)\left(1+h_{11} H_{22}\right)}}{1+h_{21} \frac{H_{21}}{\left(1+h_{22} H_{11}\right)\left(1+h_{11} H_{22}\right)}} \tag{8.103}
\end{equation*}
$$

As in previous topologies, we define the equivalent open-loop current gain and the feedback factor as

$$
\begin{align*}
A_{I, \text { open }} & =\frac{H_{21}}{\left(1+h_{22} H_{11}\right)\left(1+h_{11} H_{22}\right)}  \tag{8.104}\\
\beta & =h_{21} \tag{8.105}
\end{align*}
$$

The conceptual view of the broken loop is depicted in Fig. 8.65, and the loop gain is equal to $h_{21} A_{I, \text { open }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-314.jpg?height=329&width=590&top_left_y=819&top_left_x=473)

Figure 8.65 Conceptual view of loading in current-current feedback.

#### Example 8.17

Calculate the open-loop and closed-loop gains of the circuit shown in Fig. 8.66(a). Assume that $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-314.jpg?height=513&width=1069&top_left_y=1329&top_left_x=500)

Figure 8.66

#### Solution

In this circuit, $R_{S}$ and $R_{F}$ sense the output current and return a fraction thereof to the input. Breaking the loop according to Fig. 8.65, we arrive at the circuit in Fig. 8.66(b), where we have

$$
\begin{equation*}
A_{I, \text { open }}=-\left(R_{F}+R_{S}\right) g_{m 1} R_{D} \frac{1}{R_{S} \| R_{F}+1 / g_{m 2}} \tag{8.106}
\end{equation*}
$$

The loop gain is given by $h_{21} A_{I, \text { open }}$, where, from (8.62), $h_{21}=I_{2} / I_{1}$ with $V_{2}=0$. For the feedback network consisting of $R_{S}$ and $R_{F}$, we have $h_{21}=-R_{S} /\left(R_{S}+R_{F}\right)$. The closed-loop gain equals $A_{I, \text { open }} /\left(1+h_{21} A_{I, \text { open }}\right)$.

### 8.5.6 Summary of Loading Effects

The results of our study of loading are summarized in Fig. 8.67. The analysis is carried out in three steps: (1) open the loop with proper loading and calculate the open-loop gain, $A_{O L}$, and the open-loop input and output impedances; (2) determine the feedback ratio, $\beta$, and hence the loop gain, $\beta A_{O L}$; and (3) calculate the closed-loop gain and input and output impedances by scaling the open-loop values by a factor of $1+\beta A_{O L}$. Note that in the equations defining $\beta$, the subscripts 1 and 2 refer to the input and output ports of the feedback network, respectively.

In this chapter, we have described two methods of obtaining the loop gain: (1) by breaking the loop at an arbitrary point, as shown in Fig. 8.5, and (2) by calculating $A_{O L}$ and $\beta$, as illustrated in Fig. 8.67. The two methods may yield slightly different results due to the issues outlined in Table 8.1.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-315.jpg?height=805&width=1471&top_left_y=691&top_left_x=238)

Figure 8.67 Summary of loading effects.

## 8.6 ■ Bode's Analysis of Feedback Circuits

Bode's approach provides a rigorous solution for a circuit's closed-loop parameters (whether it includes feedback or not), but it does not tell us much about the loop gain in the presence of multiple feedback mechanisms. The analysis presented in this section was originally described by Bode in his 1945 classic textbook Network Analysis and Feedback Network Design. Since this approach is somewhat less intuitive, we encourage the reader to be patient and read this section in several sittings.

### 8.6.1 Observations

Before delving into Bode's analysis, we should make two simple, yet new observations with regard to circuit equations.

First, consider the general circuit shown in Fig. 8.68(a), where one transistor is explicitly shown in its ideal form. We know from our small-signal gain and transfer function analyses in previous chapters that $V_{\text {out }}$ can eventually be expressed as $A_{v} V_{\text {in }}$ or $H(s) V_{\text {in }}$. But, what happens if we denote the dependent current source by $I_{1}$ and do not make the substitution $I_{1}=g_{m} V_{1}$ yet? Then, $V_{\text {out }}$ is obtained as a function
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-316.jpg?height=396&width=1489&top_left_y=235&top_left_x=285)

Figure 8.68 (a) Circuit containing a dependent source, (b) circuit example, and (c) $V_{1}$ as a signal of interest.
of both $V_{\text {in }}$ and $I_{1}$ :

$$
\begin{equation*}
V_{\text {out }}=A V_{\text {in }}+B I_{1} \tag{8.107}
\end{equation*}
$$

As an example, in the degenerated common-source stage of Fig. 8.68(b), we note that the current flowing upward through $R_{D}$ (and downward through $R_{S}$ ) is equal to $-V_{\text {out }} / R_{D}$, and hence the voltage drop across $r_{O}$ is given by $\left(-V_{\text {out }} / R_{D}-I_{1}\right) r_{O}$. A KVL around the output network thus yields

$$
\begin{equation*}
V_{\text {out }}=\left(-\frac{V_{\text {out }}}{R_{D}}-I_{1}\right) r_{O}-\frac{V_{\text {out }}}{R_{D}} R_{S} \tag{8.108}
\end{equation*}
$$

and

$$
\begin{equation*}
V_{\text {out }}=\frac{-r_{O}}{1+\frac{r_{O}+R_{S}}{R_{D}}} I_{1} \tag{8.109}
\end{equation*}
$$

In this case, $A=0$ and $B=-r_{O} R_{D} /\left(R_{D}+r_{O}+R_{S}\right)$.
Second, let us return to the general circuit in Fig. 8.68(a) and consider $V_{1}$ as the signal of interest, i.e., we wish to compute $V_{1}$ as a function of $V_{i n}$ in the form of $A_{v} V_{i n}$ or $H(s) V_{i n}$. This is always possible by pretending that $V_{1}$ is the "output," as conceptually illustrated in Fig. 8.68(c). In a manner similar to Eq. (8.107), $V_{1}$ can be written as

$$
\begin{equation*}
V_{1}=C V_{i n}+D I_{1} \tag{8.110}
\end{equation*}
$$

if we temporarily forget that $I_{1}=g_{m} V_{1}$. In Fig. 8.68(b), for example, we express the current though $R_{S}$ (and $\left.R_{D}\right)$ as $\left(V_{i n}-V_{1}\right) R_{S}$, subtract this current from $I_{1}$, and let the result flow through $r_{O}$. A KVL around the output network gives

$$
\begin{equation*}
V_{i n}-V_{1}-\left(I_{1}-\frac{V_{i n}-V_{1}}{R_{S}}\right) r_{O}=-\frac{V_{i n}-V_{1}}{R_{S}} R_{D} \tag{8.111}
\end{equation*}
$$

and hence

$$
\begin{equation*}
V_{1}=V_{i n}-\frac{r_{O} R_{S}}{R_{D}+r_{O}+R_{S}} I_{1} \tag{8.112}
\end{equation*}
$$

That is, $C=1$ and $D=-r_{O} R_{S} /\left(R_{D}+r_{O}+R_{S}\right)$.

In summary, in a given circuit containing at least one transistor (whether there is feedback or not), we can eventually reach two equations that express $V_{\text {out }}$ and $V_{1}$ in terms of $V_{\text {in }}$ and $I_{1}$. To obtain $V_{\text {out }} / V_{\text {in }}$, we solve the two equations while applying the knowledge that $I_{1}$ is in fact equal to $g_{m} V_{1}$.

The foregoing developments and, in particular, Eqs. (8.107) and (8.110) appear unnecessarily tedious. After all, we can directly solve the circuit in Fig. 8.68(b) with less algebra. However, the interpretation of the coefficients $A, B, C$, and $D$ affords a simple and elegant approach to feedback analysis.

### 8.6.2 Interpretation of Coefficients

We now focus on Eqs. (8.107) and (8.110) and ask whether the $A-D$ coefficients can be directly calculated for a given circuit. We begin with $A$ :

$$
\begin{equation*}
A=\frac{V_{\text {out }}}{V_{\text {in }}} \text { with } I_{1}=0 \tag{8.113}
\end{equation*}
$$

This result implies that $A$ is obtained as the voltage gain of the circuit if the dependent current source is set to zero, which can be readily accomplished by "disabling" the transistor, i.e., by forcing the transistor's $g_{m}$ to zero. We can consider $V_{\text {out }}$ in this case as the "feedthrough" of the input signal (in the absence of the ideal transistor) [Fig. 8.69(a)]. In the CS example, $V_{\text {out }}=0$ if $I_{1}=0$ because no current flows through $R_{S}, r_{O}$, and $R_{D}$. That is, $A=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-317.jpg?height=698&width=1626&top_left_y=1026&top_left_x=237)

Figure 8.69 Setups for the calculation of (a) $A$, (b) $B$, (c) $C$, and (d) $D$.

As for the $B$ coefficient in (8.107), we have

$$
\begin{equation*}
B=\frac{V_{\text {out }}}{I_{1}} \text { with } V_{\text {in }}=0 \tag{8.114}
\end{equation*}
$$

That is, we set the input to zero and compute $V_{\text {out }}$ as a result of $I_{1}$ [Fig. 8.69(b)], pretending that $I_{1}$ is an independent source. ${ }^{14}$ In the CS example,

$$
\begin{equation*}
\left(-\frac{V_{\text {out }}}{R_{D}}-I_{1}\right) r_{O}-\frac{V_{\text {out }}}{R_{D}} R_{S}=V_{\text {out }} \tag{8.115}
\end{equation*}
$$

[^56]and hence
\$\$

$$
\begin{equation*}
V_{\text {out }}=\frac{-r_{O} R_{D}}{R_{D}+r_{O}+R_{S}} I_{1} \tag{8.116}
\end{equation*}
$$

\$\$

Thus, $B=-r_{O} R_{D} /\left(R_{D}+r_{O}+R_{S}\right)$.
The $C$ coefficient in (8.110) is interpreted as

$$
\begin{equation*}
C=\frac{V_{1}}{V_{i n}} \text { with } I_{1}=0 \tag{8.117}
\end{equation*}
$$

i.e., the transfer function from the input to $V_{1}$ with the transistor's $g_{m}$ set to zero [Fig. 8.69(c)]. In the CS circuit, no current flows through $R_{S}$ under this condition, yielding $V_{1}=V_{i n}$ and $C=1$.

Finally, the $D$ coefficient is obtained as

$$
\begin{equation*}
D=\frac{V_{1}}{I_{1}} \text { with } V_{i n}=0 \tag{8.118}
\end{equation*}
$$

which, as illustrated in Fig. 8.69(d), represents the transfer function from $I_{1}$ to $V_{1}$ with the input at zero. In the CS stage, the current flowing through $R_{S}$ (and $R_{D}$ ) under this condition is equal to $-V_{1} / R_{S}$, producing a voltage drop of $\left(-V_{1} / R_{S}-I_{1}\right) r_{O}$ across $r_{O}$. A KVL around the output network yields

$$
\begin{equation*}
-V_{1}-\left(\frac{V_{1}}{R_{S}}+I_{1}\right) r_{O}=\frac{V_{1}}{R_{S}} R_{D} \tag{8.119}
\end{equation*}
$$

We therefore have

$$
\begin{equation*}
V_{1}=-\frac{r_{O} R_{S}}{R_{D}+r_{O}+R_{S}} I_{1} \tag{8.120}
\end{equation*}
$$

and hence $D=-r_{O} R_{S} /\left(R_{D}+r_{O}+R_{S}\right)$.
In summary, the $A-D$ coefficients are computed as shown in Fig. 8.70: (1) we disable the transistor by setting its $g_{m}$ to zero and obtain $A$ and $C$ as the feedthroughs from $V_{i n}$ to $V_{\text {out }}$ and to $V_{1}$, respectively, and (2) we set the input to zero and calculate $B$ and $D$ as the gain from $I_{1}$ to $V_{\text {out }}$ and to $V_{1}$, respectively. From another perspective, the former step finds the responses to $V_{i n}$ with $g_{m}=0$, and the latter, to $I_{1}$ with $V_{i n}=0$. We can even say that the circuit is excited each time by one input, either $V_{i n}$ or $I_{1}$, and generates two outputs of interest, $V_{\text {out }}$ and $V_{1}$. The reader may still not see the reason for these derivations, but patience is a virtue!
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-318.jpg?height=505&width=1071&top_left_y=1740&top_left_x=502)

Figure 8.70 Summary of computations for $A-D$.

#### Example 8.18

Compute the $A-D$ coefficients for the circuit shown in Fig. 8.71(a).
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-319.jpg?height=428&width=1385&top_left_y=370&top_left_x=276)

Figure 8.71

#### Solution

Following the procedures illustrated in Fig. 8.70, we first set $I_{1}$ (i.e., $g_{m}$ ) to zero and determine the feedthrough components $V_{\text {out }} / V_{\text {in }}$ and $V_{1} / V_{\text {in }}$. From Fig. 8.71(b), we have

$$
\begin{align*}
A & =\frac{V_{\text {out }}}{V_{\text {in }}}  \tag{8.121}\\
& =\frac{R_{D}}{R_{D}+R_{S}+R_{F}} \tag{8.122}
\end{align*}
$$

and

$$
\begin{align*}
C & =\frac{V_{1}}{V_{i n}}  \tag{8.123}\\
& =\frac{R_{F}+R_{D}}{R_{D}+R_{S}+R_{F}} \tag{8.124}
\end{align*}
$$

Next, we set $V_{\text {in }}$ to zero and calculate the transfer functions from $I_{1}$ to $V_{\text {out }}$ and to $V_{1}$ [Fig. 8.71(c)]:

$$
\begin{align*}
B & =\frac{V_{\text {out }}}{I_{1}}  \tag{8.125}\\
& =-R_{D} \|\left(R_{S}+R_{F}\right)  \tag{8.126}\\
& =-\frac{R_{D}\left(R_{S}+R_{F}\right)}{R_{D}+R_{S}+R_{F}} \tag{8.127}
\end{align*}
$$

and

$$
\begin{align*}
D & =\frac{V_{1}}{I_{1}}  \tag{8.128}\\
& =\frac{R_{S}}{R_{S}+R_{F}} \frac{V_{\text {out }}}{I_{1}}  \tag{8.129}\\
& =-\frac{R_{S} R_{D}}{R_{D}+R_{S}+R_{F}} \tag{8.130}
\end{align*}
$$

For our subsequent studies, we must refresh our memory about loop gain calculations.

Example 8.19
Determine the exact loop gain for the circuit of Fig. 8.71(a).

#### Solution

We prefer to break the loop at a port that does not entail loading effects. Let us do so at the gate of $M_{1}$, as depicted in Fig. 8.72(a). Applying a test voltage, $V_{t}$, and calculating the feedback voltage, $V_{F}$, we have

$$
\begin{align*}
\text { Loop Gain } & =-\frac{V_{F}}{V_{t}}  \tag{8.131}\\
& =g_{m}\left[R_{D} \|\left(R_{S}+R_{F}\right)\right] \frac{R_{S}}{R_{S}+R_{F}}  \tag{8.132}\\
& =\frac{g_{m} R_{S} R_{D}}{R_{D}+R_{S}+R_{F}} \tag{8.133}
\end{align*}
$$

Note that the loop gain and the $D$ coefficient in (8.130) differ by only a factor of $-g_{m}$. We return to this point below.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-320.jpg?height=336&width=547&top_left_y=877&top_left_x=495)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-320.jpg?height=332&width=431&top_left_y=879&top_left_x=1142)
(b)

Figure 8.72
Alternatively, we can break the loop at the top terminal of the dependent current source. Illustrated in Fig. 8.72(b), the idea is to draw a test current, $I_{t}$, from node $X$ and measure the resulting feedback voltage, $V_{F}$, recognizing that the ratio $-V_{F} / I_{t}$ must be multiplied by $g_{m}$ to arrive at the loop gain:

$$
\begin{equation*}
V_{F}=-I_{t}\left[R_{D} \|\left(R_{S}+R_{F}\right)\right] \frac{R_{S}}{R_{S}+R_{F}} \tag{8.134}
\end{equation*}
$$

and thus

$$
\begin{align*}
\text { Loop Gain } & =-\frac{g_{m} V_{F}}{I_{t}}  \tag{8.135}\\
& =\frac{g_{m} R_{S} R_{D}}{R_{D}+R_{S}+R_{F}} \tag{8.136}
\end{align*}
$$

We see a similarity between the calculation of $D$ in Fig. 8.69(d) and the calculation of the loop gain in Fig. 8.72(b). In both cases, we set the input to zero, apply $I_{1}$ or $I_{t}$, and measure the controlling voltage, $V_{1}$. We therefore surmise that $D$ and the loop gain may be related. We will keep the reader in suspense for now.

### 8.6.3 Bode's Analysis

We have seen in the previous section that the $A-D$ coefficients can be computed relatively easily. We now express $V_{\text {out }} / V_{\text {in }}$ in terms of these coefficients. Since

$$
\begin{align*}
V_{\text {out }} & =A V_{\text {in }}+B I_{1}  \tag{8.137}\\
V_{1} & =C V_{\text {in }}+D I_{1} \tag{8.138}
\end{align*}
$$

and, in the actual circuit, $I_{1}=g_{m} V_{1}$, we have

$$
\begin{equation*}
V_{1}=\frac{C}{1-g_{m} D} V_{i n} \tag{8.139}
\end{equation*}
$$

The closed-loop gain is therefore equal to

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=A+\frac{g_{m} B C}{1-g_{m} D} \tag{8.140}
\end{equation*}
$$

As expected, the first term represents the input-output feedthrough, manifesting itself when $g_{m}=0$. We can also write

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{A+g_{m}(B C-A D)}{1-g_{m} D} \tag{8.141}
\end{equation*}
$$

In contrast to direct analysis of the closed-loop circuit, Bode's method decomposes the computation into several simpler steps. While our formulation has assumed a dependent current source, the results are applicable to dependent voltage sources as well. Let us solve some circuits using Bode's approach.

#### Example 8.20

Determine the voltage gain of the degenerated CS stage shown in Fig. 8.69.

#### Solution

Utilizing the results obtained for Fig. 8.69 and noting that $A=0$ and $C=1$, we have

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}} & =\frac{g_{m} \frac{-r_{O} R_{D}}{R_{D}+r_{O}+R_{S}}}{1+g_{m} \frac{r_{O} R_{S}}{R_{D}+r_{O}+R_{S}}}  \tag{8.142}\\
& =\frac{-g_{m} r_{O} R_{D}}{R_{D}+r_{O}+\left(1+g_{m} r_{O}\right) R_{S}} \tag{8.143}
\end{align*}
$$

The reader is encouraged to repeat this analysis in the presence of body effect.

#### Example 8.21

Determine the voltage gain of the feedback amplifier shown in Fig. 8.71(a) without breaking the loop.

#### Solution

With the aid of the results obtained in Example 8.18, we obtain

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}} & =\frac{R_{D}}{R_{D}+R_{S}+R_{F}}+\frac{-g_{m} \frac{R_{D}\left(R_{S}+R_{F}\right)\left(R_{F}+R_{D}\right)}{\left(R_{D}+R_{S}+R_{F}\right)^{2}}}{1+\frac{g_{m} R_{S} R_{D}}{R_{D}+R_{S}+R_{F}}}  \tag{8.144}\\
& =\frac{R_{D}}{R_{D}+R_{S}+R_{F}}+\frac{-g_{m} R_{D}\left(R_{S}+R_{F}\right)\left(R_{F}+R_{D}\right)}{\left(R_{D}+R_{S}+R_{F}+g_{m} R_{S} R_{D}\right)\left(R_{D}+R_{S}+R_{F}\right)} \tag{8.145}
\end{align*}
$$

Note that this result is exact, with the first term representing the circuit's direct feedthrough in the absence of transistor action $\left(g_{m}=0\right)$.

Under what condition does the above loop gain reduce to the familiar, ideal form $-R_{F} / R_{S}$ ? We may surmise that $R_{D}$ must be small enough not to "feel" the loading effect of $R_{F}$. But the condition $R_{D} \ll R_{F}$ does not yield a voltage gain of $-R_{F} / R_{S}$. After all, this ideal value also presumes a high open-loop gain. Thus, we need two conditions, namely, $R_{D} \ll R_{F}$ and $g_{m} R_{D} \gg 1$ for the above result to reduce to $-R_{F} / R_{S}$.

Let us make a useful observation. If $A=0$, Eq. (8.140) yields $V_{\text {out }} / V_{\text {in }}=g_{m} B C /\left(1-g_{m} D\right)$, a result resembling the generic feedback equation $A_{0} /\left(1+\beta A_{0}\right)$. We therefore loosely call $g_{m} B C$ the "open-loop" gain.

Return Ratio and Loop Gain As mentioned in Example 8.19, the quantity $D\left(=V_{1} / I_{1}\right.$ with $\left.V_{\text {in }}=0\right)$ and the loop gain appear to be related. In fact, the closed-loop gain expression in Eq. (8.141) may suggest that $1-g_{m} D=1+$ loop gain, and hence loop gain $=-g_{m} D$. This is not a coincidence: in both cases, we set the main input to zero, break the loop by replacing the dependent source with an independent source, and compute the returned quantity.

In his original treatment of feedback, Bode introduces the term "return ratio" (RR) to refer to $-g_{m} D$ and ascribes it to a given dependent source in the circuit [1]. Thus, the return ratio, obtained by injecting a voltage in place of $V_{G S}$ or a current in place of $I_{D}$, appears to be the same as the true loop gain ${ }^{15}$ even if the loop cannot be completely broken. In fact, the return ratio is equal to the loop gain if the circuit contains only one feedback mechanism and the loop traverses the transistor of interest. We elaborate on this point later.

#### Example 8.22

Determine the voltage gain of the source follower shown in Fig. 8.73(a) using Bode's method. Assume that $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-322.jpg?height=288&width=288&top_left_y=1247&top_left_x=425)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-322.jpg?height=308&width=349&top_left_y=1247&top_left_x=758)
(b)

Figure 8.73

#### Solution

Figure 8.73(b) depicts the small-signal model. To compute the $A$ and $C$ coefficients, Fig. 8.70 suggests setting $g_{m}$ to zero, which results in

$$
\begin{align*}
A & =\frac{V_{\text {out }}}{V_{\text {in }}}=0  \tag{8.146}\\
C & =\frac{V_{1}}{V_{\text {in }}}=1 \tag{8.147}
\end{align*}
$$

For the $B$ and and $D$ coefficients, we set $V_{i n}$ to zero and apply a current source $I_{1}$ in lieu of $g_{m} V_{1}$ :

$$
\begin{align*}
& B=\frac{V_{\text {out }}}{I_{1}}=R_{S}  \tag{8.148}\\
& D=\frac{V_{1}}{I_{1}}=-R_{S} \tag{8.149}
\end{align*}
$$

[^57]From (8.140) or (8.141), we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=\frac{g_{m} R_{S}}{1+g_{m} R_{S}} \tag{8.150}
\end{equation*}
$$

The return ratio associated with the dependent source is equal to $-g_{m} D=g_{m} R_{S}$.
A peculiar result occurs here if $R_{S}$ approaches an ideal current source: the return ratio, $g_{m} R_{S}$, goes to infinity, and so does $B$. Since (8.140) was obtained by dividing by $B$ and $D$, in general it may give an incorrect value if $B$ or $D$ is infinite. In the case of the source follower, however, (8.140) produces a correct result.

#### Example 8.23

Figure 8.74(a) shows a circuit in which one transistor, $M_{1}$, resides outside the feedback loop. Using Bode's method, compute $V_{\text {out }} / V_{\text {in }}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-323.jpg?height=329&width=405&top_left_y=819&top_left_x=494)

Figure 8.74

#### Solution

We first obtain $A$ and $C$ by setting $g_{m 1}$ to zero:

$$
\begin{align*}
& A=\frac{V_{\text {out }}}{V_{\text {in }}}=0  \tag{8.151}\\
& C=\frac{V_{1}}{V_{\text {in }}}=\frac{g_{m 2} R_{S}}{1+g_{m 2} R_{S}} \tag{8.152}
\end{align*}
$$

Next, we set $V_{i n}$ to zero and apply $I_{1}$ in lieu of $M_{1}$ :

$$
\begin{align*}
& B=\frac{V_{\text {out }}}{I_{1}}=-R_{D}  \tag{8.153}\\
& D=\frac{V_{1}}{I_{1}}=0 \tag{8.154}
\end{align*}
$$

As expected, the return ratio for $M_{1}$ is zero. We thus have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=g_{m 1}\left(-R_{D} \frac{g_{m 2} R_{S}}{1+g_{m 2} R_{S}}\right) \tag{8.155}
\end{equation*}
$$

Alternatively, the gain can be obtained by treating $M_{2}$ as the dependent source of interest. The return ratio for $M_{2}$ is the same as that found for the source follower in the above example. Even though the circuit contains one feedback mechanism, the two return rations are unequal because the feedback loop does not traverse $M_{1}$.

#### Example 8.24

Calculate the closed-loop gain of the circuit shown in Fig. 8.75(a). Assume that $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-324.jpg?height=457&width=985&top_left_y=240&top_left_x=545)

Figure 8.75

#### Solution

We calculate the $A-D$ coefficients with the aid of the conceptual diagram in Fig. 8.70. We can select either transistor as the device of interest. Setting $g_{m 1}$ to zero, we obtain

$$
\begin{align*}
A & =\frac{V_{\text {out }}}{I_{\text {in }}} \text { with } g_{m 1}=0  \tag{8.156}\\
& =R_{S} \tag{8.157}
\end{align*}
$$

because, in the absence of $M_{1}, I_{i n}$ simply flows through $R_{S}$, producing a feedthrough component at the output. For $C$, we note that $V_{1}=I_{i n} R_{S}\left(-g_{m 2} R_{D}\right)-I_{i n} R_{S}$, and hence

$$
\begin{align*}
C & =\frac{V_{1}}{I_{i n}} \text { with } g_{m 1}=0  \tag{8.158}\\
& =-\left(1+g_{m 2} R_{D}\right) R_{S} \tag{8.159}
\end{align*}
$$

We now set $I_{i n}$ to zero and inject an independent current source in place of $M_{1}$, as shown in Fig. 8.75(b). Since $V_{\text {out }}=I_{1} R_{S}$,

$$
\begin{align*}
B & =\frac{V_{\text {out }}}{I_{1}} \text { with } I_{\text {in }}=0  \tag{8.160}\\
& =R_{S} \tag{8.161}
\end{align*}
$$

Also, $V_{1}=I_{1} R_{S}\left(-g_{m 2} R_{D}\right)-I_{1} R_{S}=-I_{1} R_{S}\left(1+g_{m 2} R_{D}\right)$ and

$$
\begin{align*}
D & =\frac{V_{1}}{I_{1}} \text { with } I_{i n}=0  \tag{8.162}\\
& =-R_{S}\left(1+g_{m 2} R_{D}\right) \tag{8.163}
\end{align*}
$$

Equation (8.140) thus gives

$$
\begin{align*}
\frac{V_{\text {out }}}{I_{\text {in }}} & =A+\frac{g_{m 1} B C}{1-g_{m 1} D}  \tag{8.164}\\
& =R_{S}-\frac{g_{m 1}\left(1+g_{m 2} R_{D}\right) R_{S}^{2}}{1+g_{m 1} R_{S}\left(1+g_{m 2} R_{D}\right)}  \tag{8.165}\\
& =\frac{R_{S}}{1+g_{m 1} R_{S}\left(1+g_{m 2} R_{D}\right)} \tag{8.166}
\end{align*}
$$

The reader is encouraged to repeat the derivation with $M_{2}$ as the dependent source of interest.

### 8.6.4 Blackman's Impedance Theorem

Continuing our effort to compute the closed-loop parameters of a feedback system without breaking the loop, we now study Blackman's theorem, which determines the impedance seen at any port of a general circuit. This theorem can be proved using Bode's approach.

Consider the general circuit depicted in Fig. 8.76(a), where the impedance between nodes $P$ and $Q$ is of interest. As in Bode's analysis, we have explicitly shown one of the transistors by its ideal model, the voltage-dependent current source $I_{1}$. Let us pretend that $I_{i n}$ is the input signal and $V_{i n}$ the output signal so that we can utilize Bode's results:

$$
\begin{align*}
V_{i n} & =A I_{i n}+B I_{1}  \tag{8.167}\\
V_{1} & =C I_{i n}+D I_{1} \tag{8.168}
\end{align*}
$$

It follows that

$$
\begin{equation*}
Z_{i n}=\frac{V_{i n}}{I_{i n}}=A+\frac{g_{m} B C}{1-g_{m} D} \tag{8.169}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-325.jpg?height=380&width=1369&top_left_y=1055&top_left_x=281)

Figure 8.76 (a) Arrangement for calculating a port impedance, (b) calculation of $T_{o c}$, and (c) calculation of $T_{s c}$.
where $g_{m}$ denotes the transconductance of the transistor modeled by $I_{1}$ in Fig. 8.76(a). We now manipulate this result in three steps so as to obtain a more intuitive expression. First, we recognize from (8.168) that, if $I_{i n}=0$, then $V_{1} / I_{1}=D$. We call $-g_{m} D$ the "open-circuit loop gain" (because the port of interest is left open) and denote it by $T_{o c}$ [Fig. 8.76(b)]. Second, we note from (8.167) that, if $V_{i n}=0$, then $I_{i n}=(-B / A) I_{1}$, and hence, from (8.168),

$$
\begin{equation*}
\frac{V_{1}}{I_{1}}=\frac{A D-B C}{A} \tag{8.170}
\end{equation*}
$$

We call $-g_{m}$ times this quantity the "short-circuit" loop gain (because $V_{i n}=0$ ) and denote it by $T_{s c}$ [Fig. 8.76(c)]. Note that the circuit topology changes in these two cases. Both $T_{o c}$ and $T_{s c}$ can be viewed as return ratios associated with $I_{1}$ for the two circuit topologies. In summary,

$$
\begin{align*}
T_{o c} & =-\left.g_{m} \frac{V_{1}}{I_{1}}\right|_{I i n=0}  \tag{8.171}\\
T_{s c} & =-\left.g_{m} \frac{V_{1}}{I_{1}}\right|_{V i n=0} \tag{8.172}
\end{align*}
$$

In the third step, we use $T_{o c}$ and $T_{s c}$ to rewrite Eq. (8.169) as

$$
\begin{align*}
Z_{i n}=\frac{V_{i n}}{I_{i n}} & =\frac{A-g_{m}(B C-A D)}{1-g_{m} D}  \tag{8.173}\\
& =A \frac{1+T_{s c}}{1+T_{o c}} \tag{8.174}
\end{align*}
$$

Originally derived by Blackman [2], this result lends itself to a great deal of intuition if we recall that $A=V_{i n} / I_{i n}$ with $I_{1}=0$, i.e., when the transistor under consideration is disabled. We roughly view $A$ as the "open-loop" impedance because it is obtained without the transistor in the feedback loop. In addition, we observe that (1) if $\left|T_{s c}\right| \ll 1$, then $Z_{i n} \approx A /\left(1+T_{o c}\right)$; that is, the open-loop impedance is divided by $1+T_{o c}$; and (2) if $\left|T_{o c}\right| \ll 1$, then $Z_{i n} \approx A\left(1+T_{s c}\right)$; i.e., the open-loop impedance is multiplied by $1+T_{s c}$. Reminiscent of closed-loop input and output impedances derived in previous sections, these two cases nonetheless reveal that, in general, the closed-loop impedance cannot be expressed as $Z_{\text {in }}$ multiplied or divided by ( $1+$ the loop gain $)$.

#### Example 8.25

Determine the output impedance of a degenerated CS stage [Fig. 8.77(a)]. Assume that $\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-326.jpg?height=347&width=227&top_left_y=1005&top_left_x=532)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-326.jpg?height=303&width=314&top_left_y=1047&top_left_x=837)
(b)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-326.jpg?height=285&width=341&top_left_y=1061&top_left_x=1192)
(c)

Figure 8.77

#### Solution

We must compute three quantities. First, with the transistor disabled,

$$
\begin{equation*}
A=r_{O}+R_{S} \tag{8.175}
\end{equation*}
$$

Second, with the port of interest left open [Fig. 8.77(b)], we have

$$
\begin{align*}
T_{o c} & =-g_{m} \frac{V_{1}}{I_{1}}  \tag{8.176}\\
& =0 \tag{8.177}
\end{align*}
$$

because no current flows through $R_{S}$. Third, with the port of interest shorted [Fig. 8.77(c)], we obtain

$$
\begin{align*}
T_{s c} & =-g_{m} \frac{V_{1}}{I_{1}}  \tag{8.178}\\
& =+g_{m}\left(R_{S} \| r_{O}\right) \tag{8.179}
\end{align*}
$$

It follows from Eq. (8.174) that

$$
\begin{align*}
Z_{\text {out }} & =\left(r_{O}+R_{S}\right)\left[1+g_{m}\left(R_{S} \| r_{O}\right)\right]  \tag{8.180}\\
& =\left(1+g_{m} r_{O}\right) R_{S}+r_{O} \tag{8.181}
\end{align*}
$$

The reader is encouraged to repeat the analysis while including body effect.

#### Example 8.26

Compute the output impedance of the circuit shown in Fig. 8.78(a). Assume that $\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-327.jpg?height=375&width=1456&top_left_y=386&top_left_x=240)

Figure 8.78

#### Solution

The difficulty with this circuit is that it does not map into one of the four canonical topologies: amplifier $A_{1}$ senses the voltage at the source of $M_{1}$ whereas the output is taken at the drain. Fortunately, Blackman's theorem is impervious to such departures. Again, we proceed in three steps. With the transistor disabled,

$$
\begin{equation*}
A=r_{O}+R_{S} \tag{8.182}
\end{equation*}
$$

If the output is left open [Fig. 8.78(b)], no current flows through $R_{S}$, and hence $T_{o c}=0$. With the output shorted [Fig. 8.78(c)],

$$
\begin{equation*}
T_{s c}=g_{m}\left(R_{S} \| r_{O}\right) A_{1} \tag{8.183}
\end{equation*}
$$

Thus,

$$
\begin{align*}
Z_{\text {out }} & =\left(r_{O}+R_{S}\right)\left[1+g_{m}\left(R_{S} \| r_{O}\right) A_{1}\right]  \tag{8.184}\\
& =r_{O}+R_{S}+g_{m} r_{O} R_{S} A_{1}  \tag{8.185}\\
& =\left(1+g_{m} r_{O}\right) A_{1} R_{S}+r_{O} \tag{8.186}
\end{align*}
$$

To the first order, the factor $1+g_{m} r_{O}$ is "boosted" by another factor of $A_{1}$.

#### Example 8.27

Determine the output impedance of the source follower shown in Fig. 8.79(a). Assume that $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-327.jpg?height=295&width=283&top_left_y=1881&top_left_x=432)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-327.jpg?height=244&width=272&top_left_y=1963&top_left_x=814)
(b)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-327.jpg?height=190&width=270&top_left_y=1964&top_left_x=1228)
(c)

Figure 8.79

#### Solution

With $g_{m}=0$, the output impedance, and hence $A$, are infinity. The two loop gains are obtained from Figs. 8.79(b) and (c) as $T_{s c}=0$ and $T_{o c}=\infty$, respectively. These difficulties arise because the proof of Blackman's theorem divides by $A$, tacitly assuming that $A<\infty$. One can avoid this situation by placing a resistor in parallel with the port of interest and letting it approach infinity in the end result. This is left as an exercise for the reader.

#### Example 8.28

Using Blackman's theorem, determine the input impedance of the circuit shown in Fig. 8.37(a). Assume that $\lambda=$ $\gamma=0$.

#### Solution

We set $g_{m 2}$ to zero to compute $A$, observing that $A=\infty$ ! Since the derivation of Blackman's expression relies on dividing by $A$, we know that $A=\infty$ may invalidate the result. This is one drawback of Blackman's approach. The situation becomes even more interesting if we attempt to compute $T_{o c}$. As depicted in Fig. 8.80, we apply an independent small-signal circuit source $I_{1}$ and seek $V_{1}$. The voltage at the gate of $M_{1}$ is equal to $-I_{1} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$, yielding a drain current of $-g_{m 1} I_{1} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$. This current must be equal to $I_{1}$, and hence

$$
\begin{equation*}
\left(1+g_{m 1} R_{D} \frac{C_{1}}{C_{1}+C_{2}}\right) I_{1}=0 \tag{8.187}
\end{equation*}
$$

This relation cannot hold because $g_{m 1} R_{D} C_{1} /\left(C_{1}+C_{2}\right)$ is not necessarily zero and $I_{1}$ itself is an external stimulus and nonzero. This nonsensical result arises because two ideal current sources, namely, $I_{1}$ and $M_{1}$, are placed in series. Similarly, $V_{1}$ cannot be calculated because the drain voltage of $M_{1}$ is not defined.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-328.jpg?height=447&width=349&top_left_y=1208&top_left_x=591)

Figure 8.80

#### Example 8.29

A student wrestling with the above example decides to attach a resistance from the drain of $M_{1}$ to ground and let its value go to infinity in the final result. Does this rescue Blackman's theorem?

#### Solution

As shown in Fig. 8.81, $A=R_{T}$. Moreover, we can now compute $T_{o c}$ by writing a KCL at the drain of $M_{1}$ :

$$
\begin{equation*}
-g_{m 1} I_{1} R_{D} \frac{C_{1}}{C_{1}+C_{2}}-\frac{V_{1}}{R_{T}}=I_{1} \tag{8.188}
\end{equation*}
$$

and hence

$$
\begin{equation*}
T_{o c}=-g_{m 2} \frac{V_{1}}{I_{1}}=g_{m 2}\left(1+g_{m 1} R_{D} \frac{C_{1}}{C_{1}+C_{2}}\right) R_{T} \tag{8.189}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-329.jpg?height=449&width=416&top_left_y=247&top_left_x=489)

Figure 8.81

This result suggests that $T_{o c} \rightarrow \infty$ as $R_{T} \rightarrow \infty$. Since $T_{s c}=0$ (why?), we have

$$
\begin{align*}
R_{\text {in }} & =A \frac{1+T_{s c}}{1+T_{o c}}  \tag{8.190}\\
& =R_{T} \frac{1}{1+g_{m 2}\left(1+g_{m 1} R_{D} \frac{C_{1}}{C_{1}+C_{2}}\right) R_{T}} \tag{8.191}
\end{align*}
$$

If $R_{T} \rightarrow \infty, R_{i n}$ approaches $1 / g_{m 2}$ divided by the loop gain.
It is peculiar that the return ratio of $M_{2}$ is not equal to that of $M_{1}$ even though the circuit appears to have only one feedback mechanism. But looks can be deceiving: $M_{2}$ is degenerated by $R_{T}$, experiencing local feedback. We can say $M_{2}$ sees infinite degeneration if $R_{T}=\infty$, and hence has an infinite return ratio.

#### Example 8.30

Using Blackman's theorem, determine $R_{i n}$ in Fig. 8.82(a). Assume that $\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-329.jpg?height=370&width=296&top_left_y=1434&top_left_x=605)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-329.jpg?height=329&width=329&top_left_y=1434&top_left_x=998)
(b)

Figure 8.82

#### Solution

With $g_{m}=0$, we have $A=R_{D}+r_{O}$. If the input port is shorted, no feedback is present and $T_{s c}=0$. With the input port open [Fig. 8.82(b)], we observe that no current flows through $R_{D}, I_{1}$ generates a voltage of $-I_{1} r_{O}$ across $r_{O}$, and $V_{1}=-I_{1} r_{O}$. That is, $T_{o c}=g_{m} r_{O}$. It follows that

$$
\begin{equation*}
R_{i n}=\frac{R_{D}+r_{O}}{1+g_{m} r_{O}} \tag{8.192}
\end{equation*}
$$

as expected.

It is interesting to note that $T_{o c}>0$ even though the feedback through $r_{O}$ is positive. This occurs because the circuit contains two feedback mechanisms, one through $r_{O}$ and another due to degeneration of $M_{1}$ by an infinite source resistance. In such a case, the sign of $T_{o c}$ does not reveal the polarity of feedback. This point becomes clearer in the next example.

#### Example 8.31

Determine the return ratios of $M_{1}$ and $M_{2}$ in Fig. 8.83(a), assuming $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-330.jpg?height=390&width=387&top_left_y=614&top_left_x=429)
(a)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-330.jpg?height=395&width=319&top_left_y=627&top_left_x=896)
(b)
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-330.jpg?height=390&width=347&top_left_y=630&top_left_x=1289)
(c)

Figure 8.83

#### Solution

In this circuit, $R_{S}$ degenerates both $M_{1}$ and $M_{2}$, and $M_{2}$ returns a voltage to the source of $M_{1}$ with positive feedback. Injecting a current as shown in Fig. 8.83(b), we note that $R_{S}$ carries a current of $-V_{1} / R_{S}$, leading to $I_{D 2}=-I_{1}-V_{1} / R_{S}$, and hence $V_{G S 2}=\left(-I_{1}-V_{1} / R_{S}\right) / g_{m 2}$. Adding the voltage drops across $R_{D}$ and $R_{S}$ to $V_{G S 2}$, we have

$$
\begin{equation*}
I_{1} R_{D}-\frac{I_{1}}{g_{m 2}}-\frac{V_{1}}{g_{m 2} R_{S}}-V_{1}=0 \tag{8.193}
\end{equation*}
$$

and

$$
\begin{align*}
R R_{1} & =-g_{m 1} \frac{V_{1}}{I_{1}}  \tag{8.194}\\
& =\frac{1-g_{m 2} R_{D}}{1+g_{m 2} R_{S}} g_{m 1} R_{S} \tag{8.195}
\end{align*}
$$

For $R R_{2}$, the arrangement in Fig. 8.83(c) yields $I_{D 1}=-I_{2} R_{S} /\left(R_{S}+1 / g_{m 1}\right)=-I_{2} g_{m 1} R_{S} /\left(1+g_{m 1} R_{S}\right)$. Adding the voltage drops across $R_{D}$ and $R_{S}$ to $V_{2}$, we obtain

$$
\begin{equation*}
-\frac{I_{2} g_{m 1} R_{S}}{1+g_{m 1} R_{S}} R_{D}+V_{2}+I_{2} \frac{1 / g_{m 1}}{R_{S}+1 / g_{m 1}} R_{S}=0 \tag{8.196}
\end{equation*}
$$

It follows that

$$
\begin{equation*}
R R_{2}=\frac{1-g_{m 1} R_{D}}{1+g_{m 1} R_{S}} g_{m 2} R_{S} \tag{8.197}
\end{equation*}
$$

The return ratios are unequal and can assume positive or negative values independently.

## 8.7 ■ Middlebrook's Method

Middlebrook exploits the "Dissection Theorem" to derive the closed-loop transfer function without breaking the loop and while revealing the effect of backward (reverse) propagation in non-unilateral loops [5, 6]. This theorem states that any transfer function, $H(s)$, can be dissected into a product of the form

$$
\begin{equation*}
H(s)=H_{\infty} \frac{1+\frac{1}{T_{2}}}{1+\frac{1}{T_{1}}} \tag{8.198}
\end{equation*}
$$

where $H_{\text {infty }}, T_{1}$, and $T_{2}$ are simpler transfer functions corresponding to special cases, e.g., with some signal in the loop forced to zero. These quantities are computed as follows. As shown in Fig. 8.84, we insert a voltage source, $V_{t}$, in series with a branch of the circuit and inject a current, $I_{t}$, to either side of $V_{t}$. We now have four new quantities, namely, $V_{1}, V_{2}, I_{1}$, and $I_{2}$. (Note the polarity of $V_{1}$.) The key point here is that the loop is not broken, and hence loading effects are immaterial. The "ideal" transfer function, $H_{\infty}$, is obtained as follows:

$$
\begin{equation*}
H_{\infty}(s)=\left.\frac{V_{\text {out }}}{V_{\text {in }}}\right|_{V 1=0, I 1=0} \tag{8.199}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-331.jpg?height=365&width=664&top_left_y=1188&top_left_x=370)

Figure 8.84 Illustration of Middlebrook's method.
i.e., we choose $V_{t}$ and $I_{t}$ such that $V_{1}$ and $I_{1}$ are forced to zero. The other two transfer functions are more involved. Middlebrook shows that

$$
\begin{equation*}
\frac{1}{T_{1}}=\frac{1}{T_{i}}+\frac{1}{T_{v}}+\frac{1}{T_{i}^{\prime} T_{v}^{\prime}} \tag{8.200}
\end{equation*}
$$

where $V_{i n}=0$ and

$$
\begin{align*}
T_{i} & =\left.\frac{I_{1}}{I_{2}}\right|_{V 1=0} \quad \text { (Short-circuit forward current loop gain) }  \tag{8.201}\\
T_{v} & =\left.\frac{V_{1}}{V_{2}}\right|_{I 1=0} \quad \text { (Open-circuit forward voltage loop gain) }  \tag{8.202}\\
\frac{1}{T_{i}^{\prime}} & =\left.\frac{I_{2}}{I_{1}}\right|_{V 2=0} \quad \text { (Short-circuit reverse current loop gain) }  \tag{8.203}\\
\frac{1}{T_{v}^{\prime}} & =\left.\frac{V_{2}}{V_{1}}\right|_{I 2=0} \quad \text { (Open-circuit reverse voltage loop gain) } \tag{8.204}
\end{align*}
$$

The computation of $T_{2}$ is similar, except that it requires $V_{\text {out }}$ (rather than $V_{i n}$ ) to be forced to zero. We observe that Middlebrook's approach is generally more laborious than Bode's method.

Middlebrook's formulation provides insight regarding the forward (usually desirable) and reverse (usually undesirable) signal propagation around a nonunilateral loop. With no reverse propagation, we have $1 / T_{i}^{\prime}=1 / T_{v}^{\prime}=0$ and $T_{1}=T_{i} \| T_{v}$, e.g., the parallel combination of the two forward loop gains. Middlebrook denotes this quantity by $T_{f w d}$. In a similar fashion, we can define the total reverse loop gain as $T_{\text {rev }}=\left(1 / T_{i}^{\prime}\right) \|\left(1 / T_{v}^{\prime}\right)$ and manipulate Eq. (8.200) to reach

$$
\begin{equation*}
T_{1}=\frac{T_{f w d}}{1+T_{r e v}} \tag{8.205}
\end{equation*}
$$

The interesting observation here is that the equivalent loop gain is degraded if the reverse loop gain, $T_{r e v}$, becomes comparable to unity-even if it remains much less than $T_{f w d}$. Middlebrook, however, recognizes that this interpretation is valid only if (a) $V_{t}$ and $I_{t}$ are injected such that $V_{1}$ and $I_{1}$ are the "error" signal, a vague definition, and (b) $V_{t}$ and $I_{t}$ are injected inside the major loop and outside any minor loops, again a vague condition. For example, a degenerated CS stage with $\lambda>0$ eludes both of these conditions.

## 8.8 - Loop Gain Calculation Issues

### 8.8.1 Preliminary Concepts

The loop gain plays a central role in feedback systems, as evidenced by the universal factor $1+\beta A$ in the closed-loop expressions of gain, bandwidth, input and output impedances, and nonlinearity. In addition, if the poles and zeros in the loop are considered, then the loop gain [called the "loop transmission," $T(s)$, in this case] reveals the circuit's stability properties. For these reasons, we must often determine the loop gain even if we are not interested in the open-loop parameters of the circuit.

According to the procedure illustrated in Fig. 8.5, the loop gain calculation should be straightforward: we set the input to zero, break the loop at some point, apply a test signal, follow this signal around the loop (in the proper direction), and obtain the returned signal. However, in some cases, the situation is more complex, eliciting two questions: (1) Can we break the loop at any arbitrary point? (2) Should the test signal be a voltage or a current? We remind the reader that in such a test, the actual input and output disappear; i.e., the loop gain does not depend on where the main input and output ports are.

For example, consider the two-stage amplifier shown in Fig. 8.85(a), where the resistive divider consisting of $R_{1}$ and $R_{2}$ senses the output voltage and returns a fraction thereof to the source of $M_{1}$. As illustrated in Fig. 8.85(b), we set $V_{i n}$ to zero, break the loop at node $X$, apply a test signal to the right terminal of $R_{1}$, and measure the resulting $V_{F}{ }^{16}$ But is this test setup correct? First, we note that in Fig. 8.85(a), $R_{1}$ draws an ac current from $R_{D 2}$, but in Fig. 8.85(b), it does not. That is, the gain associated with the second common-source stage has been altered. Second, why did we decide to apply a test voltage? Can we apply a test current and measure a returned current?

To address the first issue, we surmise that it is best to break the loop at the gate of a MOSFET. We can break the loop at the gate of $M_{2}$ [Fig. 8.85(c)] and thus not alter the gain associated with the first stage-at least at low frequencies. The reader is encouraged to derive the loop gain using Figs. 8.85(b) and (c) and show that they are not equal.

What if we must include $C_{G S}$ of $M_{2}$ [Fig. 8.86(a)]? Then, we break the loop after $C_{G S 2}$ [Fig. 8.86(b)] to ensure that the load seen by $M_{1}$ remains unchanged. But is it always possible to break the loop at the

[^58]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-333.jpg?height=532&width=1425&top_left_y=236&top_left_x=248)

Figure 8.85 (a) Two-stage feedback amplifier, (b) breaking the loop at the left terminal of $R_{1}$, and (c) breaking the loop at the gate of $M_{2}$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-333.jpg?height=510&width=1156&top_left_y=918&top_left_x=385)

Figure 8.86 (a) Two-stage amplifier including $C_{G S 2}$, and (b) breaking the loop at the gate of $M_{2}$.
gate of a MOSFET? Yes, indeed. For the feedback to be negative, the signal must be sensed by at least one gate in the loop because only the common-source topology inverts signals.

Let us now turn our attention to the second issue, namely, the type of the test signal. In the foregoing study, we naturally chose a test voltage, $V_{t}$, because we replaced the controlling voltage of a MOSFET with an independent source. Under what condition can we apply a test current? In Fig. 8.85(a), for example, we can break the loop at the drain of $M_{2}$, inject a current $I_{t}$, and measure the current returned by $M_{2}$ [Fig. 8.87(a)]. The reader can prove that $I_{F} / I_{t}$ in this case is the same as $V_{F} / V_{t}$ in Fig. 8.85(c).

But what exactly should we do with the drain node of $M_{2}$ in Fig. 8.87(a)? If tied to ac ground, this node does not experience the voltage excursions present in the closed-loop circuit—an issue when $r_{O 2}$ is taken into account. We can merge $r_{O 2}$ with $R_{D 2}$ in this case, but not if $M_{2}$ is degenerated. Thus, in general, we cannot inject $I_{t}$ without altering some aspects of the circuit.

Not all hope is lost yet. Suppose we replace the controlled current source of $M_{2}$ with an independent current source, $I_{t}$, and compute the returned $V_{G S}$ as $V_{F}$ [Fig. 8.87(b)]. Since in the original circuit, the dependent source and $V_{G S 2}$ were related by a factor of $g_{m 2}$, we can now write the loop gain as $\left(-V_{F} / I_{t}\right) \times g_{m 2}$. This approach is feasible even if $M_{2}$ is degenerated. We recognize that this result is the same as the return ratio of $M_{2}$.

At low frequencies, the loop gain can be computed with the aid of the following observation. Since the circuit incorporates negative feedback, the loop must traverse the gate of a transistor (only the CS stage
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-334.jpg?height=504&width=917&top_left_y=237&top_left_x=576)

Figure 8.87 (a) Breaking the loop at the drain of $M_{2}$, and (b) replacing dependent source of $M_{2}$ with an independent source.
inverts). ${ }^{17}$ We can therefore break the loop at this gate without the need for including loading effects. Of course, this method applies only if the loop has only one feedback mechanism.

In summary, the "best" place to break a feedback loop is (a) the gate-source of a MOSFET if voltage injection is desired, or (b) the dependent current source of a MOSFET if current injection is desired (provided that the returned quantity is $V_{G S}$ of the MOSFET). Of course, these two methods are related because they differ by only a factor of $g_{m}$.

Unfortunately, the foregoing techniques face difficulties in some cases. For example, suppose we include $C_{G D 2}$ in Fig. 8.85(a). We inject a test voltage or current as before, but the issue is that $C_{G D 2}$ does not allow a "clean" break. As shown in Fig. 8.88, even though we provide the gate-source voltage by the independent source, $V_{t}, C_{G D 2}$ still creates "local" feedback from the drain of $M_{2}$ to its gate, raising the question of whether the loop gain should be obtained by nulling all feedback mechanisms. We should also mention that the method of current and voltage injection proposed by Middlebrook in [3] applies only if the loop is unilateral.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-334.jpg?height=470&width=598&top_left_y=1476&top_left_x=469)

Figure 8.88 Two-stage amplifier
including $C_{D 2}$.

### 8.8.2 Difficulties with Return Ratio

Bode's method enables us to compute the closed-loop transfer function in terms of four simpler transfer functions-without the need for breaking the loop. But we are also interested in the loop gain as it

[^59]![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-335.jpg?height=520&width=906&top_left_y=242&top_left_x=510)

Figure 8.89 Equivalent circuits for the calculation of the return ratios for (a) $M_{1}$, and (b) $M_{2}$.
determines the consequences of applying feedback to a given circuit, e.g., the increase in the bandwidth, the reduction in the nonlinearity, and the stability behavior.

We may view the return ratio associated with a given dependent source as the loop gain, but circuits containing more than one feedback mechanism may exhibit different return ratios for different sources. As an example, we consider again the two-stage amplifier shown in Fig. 8.85(a), recognizing that $R_{1}$ and $R_{2}$ provide both "global" feedback and "local" feedback (by degenerating $M_{1}$ ). With the aid of the equivalent circuits shown in Fig. 8.89, the reader can show that the return ratios for $M_{1}$ and $M_{2}$ are respectively given by

$$
\begin{equation*}
\text { Return Ratio }_{M 1}=\frac{g_{m 1} R_{2}\left(R_{1}+R_{D 2}+g_{m 2} R_{D 2} R_{D 1}\right)}{R_{1}+R_{2}+R_{D 2}} \tag{8.206}
\end{equation*}
$$

and

$$
\begin{equation*}
\text { Return Ratio }_{M 2}=\frac{g_{m 1} g_{m 2} R_{2} R_{D 1} R_{D 2}}{\left(1+g_{m 1} R_{2}\right)\left(R_{1}+R_{D 2}\right)+R_{2}} \tag{8.207}
\end{equation*}
$$

If, as in our standard loop gain calculations, we break the loop at the gate of $M_{2}$, we obtain a value equal to the return ratio for $M_{2}$. It is unclear which return ratio should be considered the loop gain.

Why are the two return ratios different here? This is because disabling $M_{1}$ (by making $I_{1}$ an independent source) removes both feedback mechanisms whereas disabling $M_{2}$ still retains the degeneration experienced by $M_{1}$.

Another method of loop gain calculation is to inject a signal without breaking the loop, as shown in Fig. 8.90, and write $Y / W=1 /\left(1+\beta A_{0}\right)$, and hence

$$
\begin{equation*}
\text { Loop Gain }=\left(\frac{Y}{W}\right)^{-1}-1 \tag{8.208}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-335.jpg?height=286&width=475&top_left_y=1988&top_left_x=459)

Figure 8.90 Another method of loop gain calculation.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-336.jpg?height=336&width=992&top_left_y=242&top_left_x=544)

Figure 8.91 Different injection points in a nonunilateral circuit.

But this method tacitly assumes a unilateral loop, yielding different loop gains for different injection points if the loop is not unilateral. For example, the circuit of Fig. 8.71(a) can be excited as shown in Figs. 8.91(a) or (b), producing different values for $(Y / W)^{-1}-1$.

The exact calculation of the loop gain for non-unilateral or multiloop circuits is beyond the scope of this book.

## 8.9 ■ Alternative Interpretations of Bode's Method

Bode's results can be manipulated to produce other forms that offer new insights.
Asymptotic Gain Form Let us return to $V_{\text {out }} / V_{\text {in }}=A+g_{m} B C /\left(1-g_{m} D\right)$ and note that $V_{\text {out }} / V_{\text {in }}=A$ if $g_{m}=0$ (the dependent source is disabled) and $V_{\text {out }} / V_{\text {in }}=A-B C / D$ if $g_{m} \rightarrow \infty$ (the dependent source is very "strong"). We denote these values of $V_{\text {out }} / V_{\text {in }}$ by $H_{0}$ and $H_{\infty}$, respectively, and $-g_{m} D$ by $T$. It is helpful to consider $H_{0}$ as the direct feedthrough and $H_{\infty}$ as the "ideal" gain, i.e., if the dependent source were infinitely strong (or the loop gain were infinite). It follows that

$$
\begin{align*}
\frac{V_{\text {out }}}{V_{\text {in }}} & =H_{0}+\frac{g_{m} B C}{1+T}  \tag{8.209}\\
& =H_{0} \frac{1+T}{1+T}+\frac{g_{m} B C}{1+T}  \tag{8.210}\\
& =\frac{H_{0}}{1+T}+\frac{T\left(H_{0}+g_{m} B C / T\right)}{1+T} \tag{8.211}
\end{align*}
$$

Since $H_{0}+g_{m} B C / T=A-g_{m} B C /\left(g_{m} D\right)=A-B C / D=H_{\infty}$, we have

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=H_{\infty} \frac{T}{1+T}+H_{0} \frac{1}{1+T} \tag{8.212}
\end{equation*}
$$

Called the "asymptotic gain equation" [4], this form reveals that the gain consists of an ideal value multiplied by $T /(1+T)$ and a direct feedthrough multiplied by $1 /(1+T)$. The calculations are somewhat simpler here if we recognize from $V_{1}=C V_{i n}+D I_{1}$ and $I_{1}=g_{m} V_{1}$ that $V_{1}=C V_{i n} /\left(1-g_{m} D\right) \rightarrow 0$ if $g_{m} \rightarrow \infty$ (provided that $V_{i n}<\infty$ ). This is similar to how a virtual ground is created if the loop gain is large.

#### Example 8.32

Calculate the voltage gain of the circuit shown in Fig. 8.92(a) using the asymptotic gain method. Assume that $\lambda=\gamma=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-337.jpg?height=478&width=1469&top_left_y=240&top_left_x=239)

Figure 8.92

#### Solution

Suppose $M_{1}$ is the dependent source of interest. If $g_{m 1}=0$, then $V_{i n}$ propagates through $R_{1}$ and $R_{2}$ and sees an impedance of $\left(1 / g_{m 2}\right) \| R_{S}$ at the source of $M_{2}$. Thus,

$$
\begin{equation*}
H_{0}=\frac{\left(1 / g_{m 2}\right) \| R_{S}}{\left(1 / g_{m 2}\right) \| R_{S}+R_{1}+R_{2}} \tag{8.213}
\end{equation*}
$$

If $g_{m 1}=\infty$, then $V_{G S 1}=0$ (like a virtual ground), yielding a current of $V_{i n} / R_{1}$ through $R_{1}$ and $R_{2}$. That is

$$
\begin{equation*}
H_{\infty}=-\frac{R_{2}}{R_{1}} \tag{8.214}
\end{equation*}
$$

an expected result because $M_{1}$ and $M_{2}$ operate as an op amp with an infinite open-loop gain [Fig. 8.92(b)]. To determine the return ratio for $M_{1}$, we set $V_{i n}$ to zero, replace $M_{1}$ 's dependent source with an independent source, $I_{1}$, and express $V_{X}$ as $-I_{1} R_{D}$. Since $M_{2}$ sees a load resistance of $R_{S} \|\left(R_{1}+R_{2}\right)$, we have $V_{\text {out }}=-I_{1} R_{D}\left[R_{S} \|\left(R_{1}+\right.\right.$ $\left.\left.R_{2}\right)\right] /\left[1 / g_{m 2}+R_{S} \|\left(R_{1}+R_{2}\right)\right]$. The gate voltage of $M_{1}$ is equal to $V_{\text {out }} R_{1} /\left(R_{1}+R_{2}\right)$, leading to

$$
\begin{equation*}
T_{1}=g_{m 1} R_{D} \frac{g_{m 2}\left[R_{S} \|\left(R_{1}+R_{2}\right)\right]}{1+g_{m 2}\left[R_{S} \|\left(R_{1}+R_{2}\right)\right]} \frac{R_{1}}{R_{1}+R_{2}} \tag{8.215}
\end{equation*}
$$

We must now substitute for $H_{\infty}, T$, and $H_{0}$ in Eq. (8.212) to obtain the closed-loop gain—a laborious task left for the reader. This example suggests that the direct analysis of the circuit (without knowledge of feedback) may in fact be simpler in some cases, as is true for this circuit.

It is instructive to repeat the foregoing calculations if $M_{2}$ is the dependent source of interest. For $g_{m 2}=0, V_{\text {in }}$ is simply divided according to

$$
\begin{equation*}
H_{0}=\frac{R_{S}}{R_{S}+R_{1}+R_{2}} \tag{8.216}
\end{equation*}
$$

For $g_{m 2}=\infty$, we have $V_{G S 2}=0, V_{X}=V_{\text {out }}$, and hence a current of $-V_{\text {out }} / R_{D}$ flowing through $M_{1}$. It follows that $V_{G S 1}=-V_{\text {out }} /\left(g_{m 1} R_{D}\right)$ and $\left[V_{\text {in }}+V_{\text {out }} /\left(g_{m 1} R_{D}\right)\right] / R_{1}=\left[-V_{\text {out }} /\left(g_{m 1} R_{D}\right)-V_{\text {out }}\right] / R_{2}$. We therefore have

$$
\begin{equation*}
H_{\infty}=\frac{-g_{m 1} R_{2} R_{D}}{R_{1}+R_{2}+g_{m 1} R_{1} R_{D}} \tag{8.217}
\end{equation*}
$$

This result is also expected if we consider $M_{2}$ an ideal unity-gain buffer (due to its infinite $g_{m}$ ) and redraw the circuit as shown in Fig. 8.92(c).

The return ratio for $M_{2}$ can be found as

$$
\begin{equation*}
T_{2}=\frac{g_{m 2} R_{S}\left(g_{m 1} R_{1} R_{D}+R_{1}+R_{2}\right)}{R_{S}+R_{1}+R_{2}} \tag{8.218}
\end{equation*}
$$

Again, these values must be substituted in (8.212) to compute the closed-loop gain.

Double-Null Method Blackman's impedance theorem raises an interesting question: Can we write the transfer function of a circuit in a form similar to $A\left(1+T_{s c}\right) /\left(1+T_{o c}\right)$ ? In other words, can we generalize the result to a case in which $I_{i n}$ is replaced by an arbitrary input and $V_{i n}$ by an arbitrary output? To understand the rationale for this question, let us observe that (1) $T_{o c}$ is the return ratio with $I_{i n}=0$, i.e., $T_{o c}$ denotes the RR with the input set to zero in Fig. 8.76(a); and (2) $T_{s c}$ is the RR with $V_{i n}=0$, i.e., $T_{s c}$ represents the return ratio with the output forced to zero. Figure 8.93 conceptually illustrates the setups for these two measurements, with one "nulling" the input and the other, the output. We make a slight change in our notation and postulate that the transfer function of a given circuit can be written as

$$
\begin{equation*}
\frac{V_{\text {out }}}{V_{\text {in }}}=A \frac{1+T_{\text {out }, 0}}{1+T_{\text {in }, 0}} \tag{8.219}
\end{equation*}
$$

where $A=V_{\text {out }} / V_{\text {in }}$ with the dependent source set to zero, and $T_{\text {out }, 0}$ and $T_{\text {in }, 0}$ respectively denote the return ratios for $V_{\text {out }}=0$ and $V_{\text {in }}=0$.
![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-338.jpg?height=364&width=1138&top_left_y=827&top_left_x=463)

Figure 8.93 Conceptual illustration of $T_{\text {in }, 0}$ and $T_{\text {out }, 0}$.
The proof of (8.219) is similar to that of Blackman's theorem. Beginning from

$$
\begin{align*}
V_{\text {out }} & =A V_{\text {in }}+B I_{1}  \tag{8.220}\\
V_{1} & =C V_{\text {in }}+D I_{1} \tag{8.221}
\end{align*}
$$

we recognize that, if $V_{\text {in }}=0$, then $V_{1} / I_{1}=D$, and hence $T_{i n, 0}=-g_{m} D$. On the other hand, if $V_{\text {out }}=0$, then $V_{\text {in }}=(-B / A) I_{1}$, and hence $V_{1} / I_{1}=(A D-B C) / A$, i.e., $T_{\text {out }, 0}=-g_{m}(A D-B C) / A$. Combining these results indeed yields (8.219). Note that division by $A$ in these calculations assumes that $A \neq 0$, a critical point revisited below.

Equation (8.219) offers interesting insights. The quantity $T_{\text {out }, 0}$ reveals that, even though $V_{\text {in }}$ and $I_{1}$ are chosen so as to drive $V_{\text {out }}$ to zero, there is still an "internal" feedback loop emanating from $I_{1}$ and producing a finite value for $V_{1}$. The generic system of Fig. 8.1, on the other hand, does not lend itself to this perspective because its feedback network, $G(s)$, directly senses the output. The following example illustrates this point.

Example 8.33
Determine $V_{\text {out }} / V_{\text {in }}$ in Fig. 8.94(a), assuming $\lambda=\gamma=0$. Note that the feedback network does not sense the main output here.

#### Solution

If $M_{1}$ is the dependent source of interest and $g_{m 1}=0$, then the voltage at the source of $M_{2}$ is equal to $V_{i n}\left(R_{S} \| g_{m 2}^{-1}\right) /$ $\left(R_{S} \| g_{m 2}^{-1}+R_{1}+R_{2}\right)$, yielding

$$
\begin{equation*}
A=g_{m 2} R_{D 2} \frac{R_{S} \| g_{m 2}^{-1}}{R_{S} \| g_{m 2}^{-1}+R_{1}+R_{2}} \tag{8.222}
\end{equation*}
$$

![](https://cdn.mathpix.com/cropped/2024_10_28_134d5d788a0919ac264dg-339.jpg?height=503&width=1212&top_left_y=238&top_left_x=362)

Figure 8.94

To obtain $T_{\text {out }, 0}$, we choose $V_{\text {in }}$ and $I_{1}$ so as to produce $V_{\text {out }}=0$, and hence $V_{G S 2}=0$ and $I_{D 2}=0$ [Fig. 8.94(b)]. The source voltage of $M_{2}$ is therefore equal to $-I_{1} R_{D 1}$ and also equal to $V_{i n} R_{S} /\left(R_{1}+R_{2}+R_{S}\right)$. Similarly, $V_{1}=V_{i n}\left(R_{2}+R_{S}\right) /\left(R_{1}+R_{2}+R_{S}\right)$ and

$$
\begin{align*}
T_{\text {out }, 0} & =-g_{m 1} \frac{V_{1}}{I_{1}}  \tag{8.223}\\
& =g_{m 1} R_{D 1} \frac{R_{2}+R_{S}}{R_{S}} \tag{8.224}
\end{align*}
$$

The nonzero $T_{\text {out }, 0}$ implies that $I_{1}$ still controls $V_{1}$ through an internal loop even though $V_{\text {out }}=0$. The loop gain with $V_{i n}=0$ is given by Eq. (8.215).

What if $M_{2}$ is the dependent source of interest? Then, for $g_{m 2}=0$, we have $V_{\text {out }}=0$, and hence $A=0$. Equation (8.219) thus fails to hold because its derivation has assumed that $A \neq 0$. This shortcoming of the double-null method manifests itself in many CMOS circuits, even in a simple degenerated common-source stage.
